<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
        
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title>out_cms |  vanse</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/favicon.ico" />
       
<link rel="stylesheet" href="/dist/main.css">

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/css/remixicon.min.css"
      />
      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
       
 

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    </head>
  </html>
</html>


<body>
  <div id="app">
    
      <canvas class="fireworks"></canvas>
      <style>
        .fireworks {
          position: fixed;
          left: 0;
          top: 0;
          z-index: 99999;
          pointer-events: none;
        }
      </style>
      
      
    <main class="content on">
      <section class="outer">
  <article
  id="post-out_cms"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h1 class="article-title sea-center" style="border-left:0" itemprop="name">
  out_cms
</h1>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/archives/out_cms.html" class="article-date">
  <time datetime="2021-12-17T12:14:02.000Z" itemprop="datePublished">2021-12-17</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/project/">project</a>
  </div>
  
<div class="word_count">
    <span class="post-time">
        <span class="post-meta-item-icon">
            <i class="ri-quill-pen-line"></i>
            <span class="post-meta-item-text"> 字数统计:</span>
            <span class="post-count">32.7k</span>
        </span>
    </span>

    <span class="post-time">
        &nbsp; | &nbsp;
        <span class="post-meta-item-icon">
            <i class="ri-book-open-line"></i>
            <span class="post-meta-item-text"> 阅读时长≈</span>
            <span class="post-count">171 分钟</span>
        </span>
    </span>
</div>
 
    </div>
     
	
	 
		 
			
				
    <div class="tocbot"></div>




   
			 
		
		
		 
	
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><ul>
<li>教案: 看点咨询系统</li>
<li>时间: 2021/12/12</li>
<li>整理人: vanse(刘聪)</li>
<li>授课对象: 宿州学院2019级</li>
<li>地点: 安徽宿州学院(钉钉授课)</li>
</ul>
<h1 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h1><h2 id="软件安装"><a href="#软件安装" class="headerlink" title="软件安装"></a>软件安装</h2><p><strong>必装</strong></p>
<ul>
<li>jdk</li>
<li>idea</li>
<li>maven</li>
<li>mysql(sqlyog)</li>
</ul>
<p><strong>选装</strong></p>
<p>firefox浏览器以及RestClient插件</p>
<p>nginx</p>
<p>redis</p>
<p>node(vue-element-template)</p>
<h2 id="前置知识"><a href="#前置知识" class="headerlink" title="前置知识"></a>前置知识</h2><p>maven</p>
<p>springboot</p>
<p>mysql</p>
<p>mybatis</p>
<h1 id="项目介绍"><a href="#项目介绍" class="headerlink" title="项目介绍"></a>项目介绍</h1><h2 id="1-背景"><a href="#1-背景" class="headerlink" title="1.背景"></a>1.背景</h2><p>​    在日常生活中，内容管理系统占到所有系统的80%以上，比如个人博客，腾讯新闻，今日头条，搜狐新 闻等。 这些都是我们日常生活中经常使用到的系统，它的核心就是可以概括为内容（资讯），一篇文章就是一个资讯，大家越来越喜欢将生活中的所见所闻简述出来。</p>
<p>如图：</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20210317215643452.png" alt="image-20210317215643452"></p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20210317215652686.png" alt="image-20210317215652686"></p>
<blockquote>
<p>可以看出，目前来讲对于资讯系统的需求量是非常大的</p>
</blockquote>
<p>​    通用的看点资讯管理系统，采用前后台分离开发的技术，将系统分为前台页面展示以及后台资讯管理系统。对于后台系统是基本上是通用的，而前台可根据不同客户的需求去修改定制。</p>
<p>  (不涉及页面  使用某些前端模板)</p>
<h2 id="2-简介"><a href="#2-简介" class="headerlink" title="2.简介"></a>2.简介</h2><p>看点资讯系统最核心的数据是内容，例如文章、新闻等，所以后台主要功能是实现这些内容的管理，例如栏目管理、评论管理、用户管理以及角色管理等，对于前台可以灵活得展示后台的数据。<br>例如，</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20210317215829625.png" alt="image-20210317215829625"></p>
<h2 id="3-技术"><a href="#3-技术" class="headerlink" title="3.技术"></a>3.技术</h2><p>后台采用的技术：</p>
<ul>
<li>springboot</li>
<li>spring</li>
<li>springmvc</li>
<li>mybatis</li>
<li>jwt</li>
</ul>
<p>数据库：</p>
<ul>
<li>mysql    </li>
</ul>
<p>文档管理：</p>
<ul>
<li>swagger</li>
</ul>
<p>架构选取：</p>
<ul>
<li>三层架构<ul>
<li>controller   springmvc(servlet) 对外暴露api接口</li>
<li>service  处理业务逻辑  参数/返回/事务/日志/分页…</li>
<li>dao 数据访问层</li>
</ul>
</li>
</ul>
<h2 id="4-功能"><a href="#4-功能" class="headerlink" title="4.功能"></a>4.功能</h2><h3 id="4-1-用户模块"><a href="#4-1-用户模块" class="headerlink" title="4.1 用户模块"></a>4.1 用户模块</h3><blockquote>
<p>对应的实体类为User</p>
</blockquote>
<p>1、新增用户</p>
<ul>
<li>参数1：User</li>
</ul>
<p>2、编辑用户</p>
<ul>
<li>参数1：User</li>
</ul>
<p>3、查询用户（分页）</p>
<ul>
<li>参数1：Integer num(页数)</li>
<li>参数2：Integer size（每页显示多少条数据）</li>
</ul>
<p>4、删除用户（批量，注销用户）</p>
<ul>
<li>参数1：List<Long> ids</li>
</ul>
<p>5、禁用或解封用户信息（更新用户状态）</p>
<ul>
<li>参数1：Integer id</li>
<li>参数2：Integer status</li>
</ul>
<p>6、根据用户名获取用户信息</p>
<ul>
<li>参数1：String username</li>
</ul>
<p>7、登录</p>
<ul>
<li>参数1：String username</li>
<li>参数2：String password</li>
</ul>
<h3 id="4-2-角色模块"><a href="#4-2-角色模块" class="headerlink" title="4.2 角色模块"></a>4.2 角色模块</h3><blockquote>
<p>对应的实体类为Role</p>
</blockquote>
<p>1、新增角色</p>
<ul>
<li>参数1：Role r</li>
</ul>
<p>2、编辑角色</p>
<ul>
<li>参数1：Role r</li>
</ul>
<p>3、查询角色（分页）</p>
<ul>
<li>参数1：Integer num(页数)</li>
<li>参数2：Integer size（每页显示多少条数据）</li>
</ul>
<p>4、批量删除角色</p>
<ul>
<li>参数1：List<Long> ids</li>
</ul>
<h3 id="4-3-资讯模块"><a href="#4-3-资讯模块" class="headerlink" title="4.3 资讯模块"></a>4.3 资讯模块</h3><blockquote>
<p>资讯在这里主要指的的是文章，对应的实体类为Article</p>
</blockquote>
<p>1、新增资讯</p>
<ul>
<li>参数1：Article article</li>
</ul>
<p>2、编辑资讯</p>
<ul>
<li>参数1：Article article</li>
</ul>
<p>3、查询资讯（分页）</p>
<ul>
<li>参数1：Integer num(页数)</li>
<li>参数2：Integer size（每页显示多少条数据）</li>
</ul>
<p>4、批量删除资讯</p>
<ul>
<li>参数1：List<Integer > ids</li>
</ul>
<p>5、审核资讯</p>
<ul>
<li>参数1：Integer id</li>
<li>参数2：Integer status</li>
</ul>
<p>6、根据类别ID查询，分页获取资讯信息，并且按照阅读量降序排</p>
<ul>
<li>参数1：Integer categoryId</li>
<li>参数2：Integer pageNum</li>
<li>参数3：Integer pageSize</li>
</ul>
<p>7、根据用户分页获取资讯信息</p>
<ul>
<li>参数1：Integer userId</li>
<li>参数2：Integer pageNum</li>
<li>参数3：Integer pageSize</li>
</ul>
<h3 id="4-4-类别模块"><a href="#4-4-类别模块" class="headerlink" title="4.4 类别模块"></a>4.4 类别模块</h3><blockquote>
<p>类别也就是栏目： Category</p>
</blockquote>
<p>1、新增类别</p>
<ul>
<li>参数1：Category category</li>
</ul>
<p>2、编辑类别</p>
<ul>
<li>参数1：Category category</li>
</ul>
<p>3、查询类别（分页）</p>
<ul>
<li>参数1：Integer num(页数)</li>
<li>参数2：Integer size（每页显示多少条数据）</li>
</ul>
<p>4、批量删除类别</p>
<ul>
<li>参数1：List<Integer > ids</li>
</ul>
<p>5、更新类别序号</p>
<ul>
<li>参数1：Integer id</li>
<li>参数2：Integer no</li>
</ul>
<p>6、按照序号升序分页获取类别信息</p>
<ul>
<li>参数1：Integer num(页数)</li>
<li>参数2：Integer size（每页显示多少条数据）</li>
</ul>
<h3 id="4-5-评论模块"><a href="#4-5-评论模块" class="headerlink" title="4.5 评论模块"></a>4.5 评论模块</h3><blockquote>
<p>对应的实体类为Comment</p>
</blockquote>
<p>1、新增评论</p>
<ul>
<li>参数1：Comment comment</li>
</ul>
<p>2、编辑评论</p>
<ul>
<li>参数1：Comment comment</li>
</ul>
<p>3、批量删除评论</p>
<ul>
<li>参数1：List<Integer > ids</li>
</ul>
<p>4、查询评论（分页）</p>
<ul>
<li>参数1：Integer num(页数)</li>
<li>参数2：Integer size（每页显示多少条数据）</li>
</ul>
<p>5、分页获取指定文章下所有的评论</p>
<ul>
<li>参数1：Integer articleId</li>
<li>参数2：Integer num</li>
<li>参数3：Integer size</li>
</ul>
<h2 id="5-字典"><a href="#5-字典" class="headerlink" title="5.字典"></a>5.字典</h2><p>1、用户表，cms_user</p>
<ul>
<li>一个用户有一个角色</li>
<li>一个角色有多个用户</li>
</ul>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20210317221131577.png" alt="image-20210317221131577"></p>
<p>2、角色表，cms_role</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20210317221149140.png" alt="image-20210317221149140"></p>
<p>3、文章类别表，cms_category</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20210317221204520.png" alt="image-20210317221204520"></p>
<p>4、文章表，cms_article</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20210317221220121.png" alt="image-20210317221220121"></p>
<p>5、评论表，cms_comment</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20210317221235341.png" alt="image-20210317221235341"></p>
<p>快速原型  前端画出来  </p>
<h2 id="6-原型图"><a href="#6-原型图" class="headerlink" title="6.原型图"></a>6.原型图</h2><p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20210317230950797.png" alt="image-20210317230950797"></p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20210317231012612.png" alt="image-20210317231012612"></p>
<h1 id="项目搭建"><a href="#项目搭建" class="headerlink" title="项目搭建"></a>项目搭建</h1><h2 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h2><p>创建项目前确保环境</p>
<ul>
<li>maven正确配置</li>
<li>安装lombok插件(可选)  简化get/set/toString </li>
<li>mybatisx插件(可选)  简化Mybatis操作</li>
</ul>
<p>maven</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211212125329906.png" alt="image-20211212125329906"></p>
<p>插件</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211212125253757.png" alt="image-20211212125253757"></p>
<p><strong>打开idea,点击create new project</strong></p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211212120353767.png" alt="image-20211212120353767"></p>
<p><strong>本次以Spring Initializer的方式创建springboot项目</strong></p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211212120543562.png" alt="image-20211212120543562"></p>
<p><strong>选择项目配置</strong></p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211212121736620.png" alt="image-20211212121736620"></p>
<p><strong>挑选依赖</strong></p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211212122105673.png" alt="image-20211212122105673"></p>
<p><strong>自定义项目存放路径</strong></p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211212122303953.png" alt="image-20211212122303953"></p>
<p><strong>创建成功后的页面</strong></p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211212122743250.png" alt="image-20211212122743250"></p>
<h3 id="pom"><a href="#pom" class="headerlink" title="pom"></a>pom</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.briup<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cms<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>cms<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--web集成了springmvc json等配置--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--mybatis集成--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!--分页插件--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--热部署 ctrl+F9--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!--mysql驱动--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.39<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--lombock 需要额外安装插件</span></span><br><span class="line"><span class="comment">				&lt;dependency&gt;</span></span><br><span class="line"><span class="comment">            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">            &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">            &lt;optional&gt;true&lt;/optional&gt;</span></span><br><span class="line"><span class="comment">        &lt;/dependency&gt;</span></span><br><span class="line"><span class="comment">			--&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!--测试单元--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">excludes</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">exclude</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="properties"><a href="#properties" class="headerlink" title="properties"></a>properties</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">8989</span></span><br><span class="line"><span class="comment">#配置数据源</span></span><br><span class="line"><span class="meta">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="meta">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/cms_jd2017?characterEncoding=utf8&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=GMT%2B8</span></span><br><span class="line"><span class="meta">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">spring.datasource.password</span>=<span class="string">root</span></span><br></pre></td></tr></table></figure>



<h3 id="main"><a href="#main" class="headerlink" title="main"></a>main</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CmsApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(CmsApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211212123536298.png" alt="image-20211212123536298"></p>
<p>访问<a target="_blank" rel="noopener" href="http://localhost:8989/">网址</a>  以下界面代表启动成功</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211212124022919.png" alt="image-20211212124022919"></p>
<h2 id="逆向工程"><a href="#逆向工程" class="headerlink" title="逆向工程"></a>逆向工程</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p><a target="_blank" rel="noopener" href="http://mybatis.org/generator/">Mybatis-Generator</a></p>
<p>MyBatis Generator (MBG) 是 MyBatis <a target="_blank" rel="noopener" href="http://mybatis.org/">MyBatis</a>的代码生成器。它将为所有版本的 MyBatis 生成代码。它将内省一个数据库表（或多个表）并生成可用于访问表的工件。这减少了设置对象和配置文件以与数据库表交互的初始麻烦。MBG 试图对大量简单的 CRUD（创建、检索、更新、删除）的数据库操作产生重大影响。您仍然需要为连接查询或存储过程编写 SQL 和对象代码。</p>
<p>MBG 生成不同风格和不同语言的代码，这取决于它的配置方式。例如，MBG 可以生成 Java 或 Kotlin 代码。MBG 可以生成与 MyBatis3 兼容的 XML - 尽管现在被认为是 MBG 的遗留用途。生成代码的较新样式不需要 XML。</p>
<p>根据它的配置方式，MyBatis Generator 可能会生成：</p>
<ul>
<li><p>与表结构匹配的 Java 或 Kotlin 类。这可能包括：</p>
<ul>
<li>匹配表主键的类（如果有主键）</li>
<li>匹配表的非主键字段的类（BLOB 字段除外）</li>
<li>一个包含表的 BLOB 字段的类（如果表有 BLOB 字段）</li>
<li>启用动态选择、更新和删除的类</li>
</ul>
<p>这些类之间有适当的继承关系。请注意，生成器可以配置为生成不同类型的 POJO 层次结构 - 例如，如果您愿意，您可以选择为每个表生成单个域对象。</p>
</li>
<li><p>在某些情况下，MBG 会生成 MyBatis3 Compatible SQL Map XML Files。MBG 为配置中的每个表上的简单 CRUD 函数生成 SQL。生成的 SQL 语句包括：</p>
<ul>
<li>插入</li>
<li>按主键更新</li>
<li>示例更新（使用动态 where 子句）</li>
<li>按主键删除</li>
<li>删除示例（使用动态 where 子句）</li>
<li>按主键选择</li>
<li>按示例选择（使用动态 where 子句）</li>
<li>举例数</li>
</ul>
<p>根据表的结构，这些语句有不同的变体（例如，如果表没有主键，则 MBG 不会通过主键函数生成更新）。</p>
</li>
<li><p>适当使用上述对象的 Java 或 Kotlin 客户端类、接口和 Kotlin 扩展方法。客户端类的生成是可选的。MBG 将生成一个与 MyBatis 3.x 映射器基础设施配合使用的映射器接口</p>
</li>
</ul>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><blockquote>
<p>pom.xml 引入逆向工程插件 </p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!--逆向工程依赖--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.generator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-generator-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--逆向工程插件配置--&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--逆向工程插件配置--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.generator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-generator-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--逆向工程的文件模板--&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">configurationFile</span>&gt;</span>src/main/resources/generatorConfig.xml<span class="tag">&lt;/<span class="name">configurationFile</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">verbose</span>&gt;</span>true<span class="tag">&lt;/<span class="name">verbose</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">overwrite</span>&gt;</span>true<span class="tag">&lt;/<span class="name">overwrite</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.generator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-generator-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.39<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<blockquote>
<p>准备逆向工程配置文件 src/main/resources/generatorConfig.xml</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">generatorConfiguration</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">generatorConfiguration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context</span> <span class="attr">id</span>=<span class="string">&quot;MyBatis3&quot;</span> <span class="attr">targetRuntime</span>=<span class="string">&quot;MyBatis3&quot;</span> <span class="attr">defaultModelType</span>=<span class="string">&quot;flat&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 防止xml追加 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">type</span>=<span class="string">&quot;org.mybatis.generator.plugins.UnmergeableXmlMappersPlugin&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 取消所有注释 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">commentGenerator</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suppressAllComments&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suppressDate&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">commentGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">jdbcConnection</span></span></span><br><span class="line"><span class="tag">                <span class="attr">driverClass</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">connectionURL</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/cms_jd2017?characterEncoding=utf8<span class="symbol">&amp;amp;</span>useUnicode=true<span class="symbol">&amp;amp;</span>useSSL=false<span class="symbol">&amp;amp;</span>serverTimezone=GMT%2B8&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">userId</span>=<span class="string">&quot;root&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">password</span>=<span class="string">&quot;root&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 指定生成的类型为java类型，避免数据库中number等类型字段 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaTypeResolver</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;forceBigDecimals&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaTypeResolver</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 对应的实体类 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaModelGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;com.briup.cms.entity&quot;</span> <span class="attr">targetProject</span>=<span class="string">&quot;../cms/src/main/java&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaModelGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--对应的XXXMapper.xml文件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sqlMapGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;mapper&quot;</span> <span class="attr">targetProject</span>=<span class="string">&quot;../cms/src/main/resources&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">sqlMapGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 对应的XXXMapper.java文件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaClientGenerator</span> <span class="attr">type</span>=<span class="string">&quot;XMLMAPPER&quot;</span> <span class="attr">targetPackage</span>=<span class="string">&quot;com.briup.cms.mapper&quot;</span> <span class="attr">targetProject</span>=<span class="string">&quot;../cms/src/main/java&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaClientGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">&quot;cms_%&quot;</span> <span class="attr">enableCountByExample</span>=<span class="string">&quot;false&quot;</span> <span class="attr">enableDeleteByExample</span>=<span class="string">&quot;false&quot;</span> <span class="attr">enableSelectByExample</span>=<span class="string">&quot;false&quot;</span> <span class="attr">enableUpdateByExample</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">domainObjectRenamingRule</span> <span class="attr">searchString</span>=<span class="string">&quot;^Cms&quot;</span> <span class="attr">replaceString</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--&lt;table tableName=&quot;logging&quot; domainObjectName=&quot;LoggingAccessInfo&quot; enableCountByExample=&quot;false&quot; enableDeleteByExample=&quot;false&quot; enableSelectByExample=&quot;false&quot; enableUpdateByExample=&quot;false&quot;&gt;&lt;/table&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">generatorConfiguration</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<blockquote>
<p>执行逆向工程插件</p>
</blockquote>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211212134345813.png" alt="image-20211212134345813"></p>
<h3 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h3><p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211212134504358.png" alt="image-20211212134504358"></p>
<h2 id="插入测试"><a href="#插入测试" class="headerlink" title="插入测试"></a>插入测试</h2><h3 id="main-1"><a href="#main-1" class="headerlink" title="main"></a>main</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.briup.cms.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CmsApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(CmsApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="properties-1"><a href="#properties-1" class="headerlink" title="properties"></a>properties</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#设置mybatis映射文件路径</span></span><br><span class="line"><span class="meta">mybatis.mapper-locations</span>=<span class="string">classpath:/mapper/**/*.xml</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>三层结构规范  </p>
</blockquote>
<ul>
<li>controller  api接口层 和页面交互</li>
<li>service 业务逻辑层</li>
<li>dao 数据访问层</li>
</ul>
<h3 id="service"><a href="#service" class="headerlink" title="service"></a>service</h3><p>接口  com.briup.cms.service.UserService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 插入用户</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(User user)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现类  com.briup.cms.service.UserServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        userMapper.insert(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="controller"><a href="#controller" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;insert&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(User user)</span></span>&#123;</span><br><span class="line">        userService.insert(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h3><p>访问 <a target="_blank" rel="noopener" href="http://localhost:8989/user/insert?username=jack&amp;status=0">http://localhost:8989/user/insert?username=jack&amp;status=0</a></p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211212155551100.png" alt="image-20211212155551100"></p>
<h2 id="查找测试"><a href="#查找测试" class="headerlink" title="查找测试"></a>查找测试</h2><h3 id="service-1"><a href="#service-1" class="headerlink" title="service"></a>service</h3><p>接口  com.briup.cms.service.UserService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 插入用户</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(User user)</span></span>;</span><br><span class="line">    <span class="comment">// 查找用户详情</span></span><br><span class="line">    <span class="function">User <span class="title">findById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现类  com.briup.cms.service.UserServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        userMapper.insert(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">findById</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userMapper.selectByPrimaryKey(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="controller-1"><a href="#controller-1" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    <span class="comment">// 插入用户</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;insert&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(User user)</span></span>&#123;</span><br><span class="line">        <span class="comment">// 将来前端传用户数据</span></span><br><span class="line">        userService.insert(user);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 查找用户详情</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;info&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">info</span><span class="params">(<span class="keyword">int</span> id)</span></span>&#123;</span><br><span class="line">        User user = userService.findById(id);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="效果-1"><a href="#效果-1" class="headerlink" title="效果"></a>效果</h3><p>访问 <a target="_blank" rel="noopener" href="http://localhost:8989/user/info?id=4">http://localhost:8989/user/info?id=4</a></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;id&quot;</span>: <span class="number">4</span>,</span><br><span class="line">  <span class="attr">&quot;birthday&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">&quot;gender&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">&quot;image&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">&quot;password&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">&quot;phone&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">&quot;realName&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">&quot;registerTime&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">&quot;status&quot;</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;username&quot;</span>: <span class="string">&quot;tom&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;roleId&quot;</span>: <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>问题</code></p>
<ul>
<li>参数都是通过?查询字符串进行拼接</li>
<li>都是@RequestMapping方式的请求</li>
</ul>
<h2 id="rest风格"><a href="#rest风格" class="headerlink" title="rest风格"></a>rest风格</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><blockquote>
<p>对于前后端分离的项目，前后端之间的交互大多数是采用json的形式来传递数据，在这种情况下，数据的展现完全由前端负责，后端只需要把数据相关的接口暴露出来让前端去进行请求调用即可。</p>
</blockquote>
<p>在不考虑视图层的数据展现问题的情况下，后端可以创建出RSETFul风格的接口，供前端进行调用访问。</p>
<p>REST（Representational State Transfer），是2000年Roy Fielding博士在他的博士论文中所提出的一种软件架构模式。</p>
<p>REST就是一种设计API的模式。最常用的数据格式是JSON。由于JSON能直接被JavaScript读取，所以，以JSON格式编写的REST风格的API具有简单、易读、易用的特点。</p>
<p><strong>Rest架构的主要原则</strong></p>
<ol>
<li><p>系统中所有事物都被抽象为资源</p>
</li>
<li><p>每个资源有唯一的资源标识符</p>
</li>
<li><p>同一个资源具有多种表现形式(xml,json等)</p>
</li>
<li><p>对资源的各种操作不会改变资源标识符</p>
</li>
<li><p>所有的操作都是无状态的</p>
</li>
<li><p>符合REST原则的架构方式即可称为RESTful</p>
</li>
</ol>
<p><strong>RESTful的web服务是一种面向资源的架构设计，ROA(The Resource-Oriented Architecture)。</strong></p>
<p><strong>传统风格接口：</strong></p>
<table>
<thead>
<tr>
<th align="center">操作</th>
<th align="center">http请求方法</th>
<th align="center">传统接口</th>
</tr>
</thead>
<tbody><tr>
<td align="center">查询</td>
<td align="center">get</td>
<td align="center">/user/getinfo?id=1</td>
</tr>
<tr>
<td align="center">创建</td>
<td align="center">post</td>
<td align="center">/user/create</td>
</tr>
<tr>
<td align="center">修改</td>
<td align="center">post</td>
<td align="center">/user/update</td>
</tr>
<tr>
<td align="center">删除</td>
<td align="center">get</td>
<td align="center">/user/delete?id=1</td>
</tr>
</tbody></table>
<p><strong>RESTFul风格接口：</strong></p>
<table>
<thead>
<tr>
<th align="center">操作</th>
<th align="center">http请求方法</th>
<th align="center">传统接口</th>
</tr>
</thead>
<tbody><tr>
<td align="center">查询</td>
<td align="center">get</td>
<td align="center">/user/1</td>
</tr>
<tr>
<td align="center">创建</td>
<td align="center">post</td>
<td align="center">/user</td>
</tr>
<tr>
<td align="center">修改</td>
<td align="center">put</td>
<td align="center">/user</td>
</tr>
<tr>
<td align="center">删除</td>
<td align="center">delete</td>
<td align="center">/user/1</td>
</tr>
</tbody></table>
<h3 id="改造"><a href="#改造" class="headerlink" title="改造"></a>改造</h3><blockquote>
<p>使用Rest风格改造UserController</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  插入用户</span></span><br><span class="line"><span class="comment">     *  使用rest风格传参</span></span><br><span class="line"><span class="comment">     *  前端向后端传递json格式数据,后端向前端返回json格式数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;insert&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span></span>&#123;</span><br><span class="line">        <span class="comment">// 将来前端传用户数据</span></span><br><span class="line">        userService.insert(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查找用户详情</span></span><br><span class="line"><span class="comment">     * 访问规则: http://localhost:8989/user/info/4</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;info/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">info</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> <span class="keyword">int</span> id)</span></span>&#123;</span><br><span class="line">        User user = userService.findById(id);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>此时注意测试方法</p>
</blockquote>
<p><strong>测试查询用户</strong></p>
<p><a target="_blank" rel="noopener" href="http://localhost:8989/user/info/4">http://localhost:8989/user/info/4</a></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;id&quot;</span>: <span class="number">4</span>,</span><br><span class="line">  <span class="attr">&quot;birthday&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">&quot;gender&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">&quot;image&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">&quot;password&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">&quot;phone&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">&quot;realName&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">&quot;registerTime&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">&quot;status&quot;</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;username&quot;</span>: <span class="string">&quot;tom&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;roleId&quot;</span>: <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>测试插入用户</strong></p>
<ul>
<li>post请求</li>
<li>参数为json</li>
<li>使用RestClient插件/postman</li>
</ul>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211212162533779.png" alt="image-20211212162533779"></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注意 最有一个参数不要写,</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;gender&quot;</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;password&quot;</span>: <span class="string">&quot;vanse&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;phone&quot;</span>: <span class="string">&quot;13500000000&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;realName&quot;</span>: <span class="string">&quot;老刘&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;status&quot;</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;username&quot;</span>: <span class="string">&quot;vanse&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>问题</code></p>
<ul>
<li>响应数据格式不规范<ul>
<li>添加没有返回数据</li>
<li>查询返回了用户数据</li>
</ul>
</li>
</ul>
<h2 id="统一响应"><a href="#统一响应" class="headerlink" title="统一响应"></a>统一响应</h2><h3 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h3><blockquote>
<p>前后端分离规定了响应格式数据</p>
</blockquote>
<p>格式如下:</p>
<ul>
<li>code 状态码 200 401 403 415 </li>
<li>msg  提示消息 “操作成功” 删除成功  添加成功</li>
<li>data  数据  查询</li>
</ul>
<p><strong>导入工具类</strong></p>
<ul>
<li>Result  封装了统一响应结果<ul>
<li>code</li>
<li>msg</li>
<li>data</li>
</ul>
</li>
<li>ResultCode 一般来说 code和msg都是固定搭配 所以封装枚举类<ul>
<li>404 路径错误</li>
<li>401 未认证</li>
<li>403 无权限</li>
<li>500 服务器异常</li>
</ul>
</li>
</ul>
<p><strong>com.briup.cms.utils.ResultCode</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.cms.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 统一并自定义返回状态码，如有需求可以另外增加</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">ResultCode</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/* 成功状态码 */</span></span><br><span class="line">	SUCCESS(<span class="number">1</span>, <span class="string">&quot;操作成功&quot;</span>),</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/* 参数错误：10001-19999 */</span></span><br><span class="line">	PARAM_IS_INVALID(<span class="number">10001</span>, <span class="string">&quot;参数无效&quot;</span>),</span><br><span class="line">	PARAM_IS_BLANK(<span class="number">10002</span>, <span class="string">&quot;参数为空&quot;</span>),</span><br><span class="line">	PARAM_TYPE_BIND_ERROR(<span class="number">10003</span>, <span class="string">&quot;参数类型错误&quot;</span>),</span><br><span class="line">	PARAM_NOT_COMPLETE(<span class="number">10004</span>, <span class="string">&quot;参数缺失&quot;</span>),</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/* 用户错误：20001-29999*/</span></span><br><span class="line">	USER_NOT_LOGIN(<span class="number">20001</span>, <span class="string">&quot;用户未登录&quot;</span>),</span><br><span class="line">	USER_LOGIN_ERROR(<span class="number">20002</span>, <span class="string">&quot;账号不存在或密码错误&quot;</span>),</span><br><span class="line">	USER_ACCOUNT_FORBIDDEN(<span class="number">20003</span>, <span class="string">&quot;账号已被禁用&quot;</span>),</span><br><span class="line">	USER_NOT_EXIST(<span class="number">20004</span>, <span class="string">&quot;用户不存在&quot;</span>),</span><br><span class="line">	USER_HAS_EXISTED(<span class="number">20005</span>, <span class="string">&quot;用户已存在&quot;</span>),</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/* 业务错误：30001-39999 */</span></span><br><span class="line">	SPECIFIED_QUESTIONED_USER_NOT_EXIST(<span class="number">30001</span>, <span class="string">&quot;业务逻辑出现问题&quot;</span>),</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/* 系统错误：40001-49999 */</span></span><br><span class="line">	SYSTEM_INNER_ERROR(<span class="number">40001</span>, <span class="string">&quot;系统内部错误，请稍后重试&quot;</span>),</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/* 数据错误：50001-599999 */</span></span><br><span class="line">	DATA_NONE(<span class="number">50001</span>, <span class="string">&quot;数据未找到&quot;</span>),</span><br><span class="line">	DATA_WRONG(<span class="number">50002</span>, <span class="string">&quot;数据错误&quot;</span>),</span><br><span class="line">	DATA_EXISTED(<span class="number">50003</span>, <span class="string">&quot;数据已存在&quot;</span>),</span><br><span class="line">	DATA_USEING(<span class="number">50004</span>,<span class="string">&quot;该数据正在被引用&quot;</span>),</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/* 接口错误：60001-69999 */</span></span><br><span class="line">	INTERFACE_INNER_INVOKE_ERROR(<span class="number">60001</span>, <span class="string">&quot;内部系统接口调用异常&quot;</span>),</span><br><span class="line">	INTERFACE_OUTTER_INVOKE_ERROR(<span class="number">60002</span>, <span class="string">&quot;外部系统接口调用异常&quot;</span>),</span><br><span class="line">	INTERFACE_FORBID_VISIT(<span class="number">60003</span>, <span class="string">&quot;该接口禁止访问&quot;</span>),</span><br><span class="line">	INTERFACE_ADDRESS_INVALID(<span class="number">60004</span>, <span class="string">&quot;接口地址无效&quot;</span>),</span><br><span class="line">	INTERFACE_REQUEST_TIMEOUT(<span class="number">60005</span>, <span class="string">&quot;接口请求超时&quot;</span>),</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/* 权限错误：70001-79999 */</span></span><br><span class="line">	PERMISSION_NO_ACCESS(<span class="number">70001</span>, <span class="string">&quot;无访问权限&quot;</span>);</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> Integer code;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> String message;</span><br><span class="line"></span><br><span class="line">	ResultCode(Integer code, String message) &#123;</span><br><span class="line">		<span class="keyword">this</span>.code = code;</span><br><span class="line">		<span class="keyword">this</span>.message = message;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">code</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.code;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">message</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.message;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>com.briup.cms.utils.Result</strong>  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.cms.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 统一Controller中RESTFul风格接口返回的结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Result</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> Integer code;</span><br><span class="line">	<span class="keyword">private</span> String msg;</span><br><span class="line">	<span class="keyword">private</span> Object data;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="title">Result</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="title">Result</span><span class="params">(Integer code, String msg)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.code = code;</span><br><span class="line">		<span class="keyword">this</span>.msg = msg;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setResultCode</span><span class="params">(ResultCode code)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.code = code.code();</span><br><span class="line">		<span class="keyword">this</span>.msg = code.message();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 操作失败，自定义code和msg</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title">failure</span><span class="params">(Integer code, String msg)</span> </span>&#123;</span><br><span class="line">		Result result = <span class="keyword">new</span> Result(code,msg);</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 操作成功，没有返回的数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title">success</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Result result = <span class="keyword">new</span> Result();</span><br><span class="line">		result.setResultCode(ResultCode.SUCCESS); <span class="comment">// 1 s</span></span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 操作成功，有返回的数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title">success</span><span class="params">(Object data)</span> </span>&#123;</span><br><span class="line">		Result result = <span class="keyword">new</span> Result();</span><br><span class="line">		result.setResultCode(ResultCode.SUCCESS);</span><br><span class="line">		result.setData(data);</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 操作失败，没有返回的数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title">failure</span><span class="params">(ResultCode resultCode)</span> </span>&#123;</span><br><span class="line">		Result result = <span class="keyword">new</span> Result();</span><br><span class="line">		result.setResultCode(resultCode);</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 操作失败，有返回的数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title">failure</span><span class="params">(ResultCode resultCode, Object data)</span> </span>&#123;</span><br><span class="line">		Result result = <span class="keyword">new</span> Result();</span><br><span class="line">		result.setResultCode(resultCode);</span><br><span class="line">		result.setData(data);</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="改造-1"><a href="#改造-1" class="headerlink" title="改造"></a>改造</h3><blockquote>
<p>使用统一响应 改造UserController</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  插入用户</span></span><br><span class="line"><span class="comment">     *  使用rest风格传参</span></span><br><span class="line"><span class="comment">     *  前端向后端传递json格式数据,后端向前端返回json格式数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;insert&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">insert</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span></span>&#123;</span><br><span class="line">        <span class="comment">// 将来前端传用户数据</span></span><br><span class="line">        userService.insert(user);</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查找用户详情</span></span><br><span class="line"><span class="comment">     * 访问规则: http://localhost:8989/user/info/4</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;info/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">info</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> <span class="keyword">int</span> id)</span></span>&#123;</span><br><span class="line">        User user = userService.findById(id);</span><br><span class="line">        <span class="keyword">return</span> Result.success(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>测试查询 <a target="_blank" rel="noopener" href="http://localhost:8989/user/info/4">http://localhost:8989/user/info/4</a></strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;code&quot;</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">&quot;msg&quot;</span>: <span class="string">&quot;操作成功&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;data&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;id&quot;</span>: <span class="number">4</span>,</span><br><span class="line">    <span class="attr">&quot;birthday&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">&quot;gender&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">&quot;image&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">&quot;password&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">&quot;phone&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">&quot;realName&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">&quot;registerTime&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">&quot;status&quot;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">&quot;username&quot;</span>: <span class="string">&quot;tom&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;roleId&quot;</span>: <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>测试插入</strong></p>
<ul>
<li><a target="_blank" rel="noopener" href="http://localhost:8989/user/insert">http://localhost:8989/user/insert</a></li>
<li>post</li>
<li>Content-Type: application/json</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;code&quot;</span>:<span class="number">1</span>,</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>:<span class="string">&quot;操作成功&quot;</span>,</span><br><span class="line">    <span class="string">&quot;data&quot;</span>:<span class="keyword">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code> 问题</code></p>
<ul>
<li>如果出现了异常,统一响应格式将失效</li>
<li>并且页面出现堆砌错误数据</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@GetMapping(&quot;info/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="comment">// 手动模拟异常 模板只能映射ids</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Result <span class="title">info</span><span class="params">(<span class="meta">@PathVariable(&quot;ids&quot;)</span> <span class="keyword">int</span> id)</span></span>&#123;</span><br><span class="line">        User user = userService.findById(id);</span><br><span class="line">       <span class="keyword">return</span> Result.success(user);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211212172552207.png" alt="image-20211212172552207"></p>
<h2 id="全局异常处理"><a href="#全局异常处理" class="headerlink" title="全局异常处理"></a>全局异常处理</h2><blockquote>
<p>使用aop 将异常全局处理 并同样返回统一响应(响应错误数据)</p>
</blockquote>
<p><strong>com.briup.cms.exception.GlobelException</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobelExceptionHandler</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">handlerException</span><span class="params">(Exception e)</span></span>&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">         <span class="keyword">return</span> Result.failure(<span class="number">500</span>,<span class="string">&quot;后台接口异常: &quot;</span>+e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>继续测试 <a target="_blank" rel="noopener" href="http://localhost:8989/user/info/-1">http://localhost:8989/user/info/-1</a></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;code&quot;</span>: <span class="number">500</span>,</span><br><span class="line">  <span class="attr">&quot;msg&quot;</span>: <span class="string">&quot;后台接口异常&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;data&quot;</span>: <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>刚刚模拟的是系统异常,属于非可控情况,可以自定义异常,并返回友好提示</strong></p>
<p><strong>com.briup.cms.exception.CustomerException</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">    <span class="keyword">private</span> ResultCode resultCode;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomerException</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomerException</span><span class="params">(ResultCode resultCode)</span> </span>&#123;</span><br><span class="line">        message = resultCode.message();</span><br><span class="line">        <span class="keyword">this</span>.resultCode = resultCode;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>在UsreServiceImpl中抛出自定义异常</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> User <span class="title">findById</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span>(id &lt;= <span class="number">0</span>)&#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> CustomerException(ResultCode.PARAM_IS_INVALID);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> userMapper.selectByPrimaryKey(id);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<p>继续测试 <a target="_blank" rel="noopener" href="http://localhost:8989/user/info/-1">http://localhost:8989/user/info/-1</a></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;code&quot;</span>: <span class="number">10001</span>,</span><br><span class="line">  <span class="attr">&quot;msg&quot;</span>: <span class="string">&quot;参数无效&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;data&quot;</span>: <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211212173448522.png" alt="image-20211212173448522"></p>
<p><code>问题</code></p>
<ul>
<li><p>后端测试较麻烦 尤其是post请求,json等格式</p>
</li>
<li><p>前后端分离的情况下 前端如何知道后台的接口路径去测试并对接页面呢?</p>
</li>
</ul>
<h2 id="swagger"><a href="#swagger" class="headerlink" title="swagger"></a>swagger</h2><h3 id="概述-2"><a href="#概述-2" class="headerlink" title="概述"></a>概述</h3><blockquote>
<p>项目采用前后台分离的架构进行开发，后台可以使用Swagger，生成在线API文档，方便前端人员对接使用</p>
</blockquote>
<p><code>Swagger </code>是一个规范和完整的框架，用于生成、描述、调用和可视化 RESTful 风格的 Web 服务。</p>
<p><a target="_blank" rel="noopener" href="https://swagger.io/">Swagger官网</a></p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211110235217141.png" alt="image-20211110235217141"></p>
<p><a target="_blank" rel="noopener" href="https://petstore.swagger.io/?_ga=2.236238660.419502645.1636559508-49422942.1636559508">配置生成的在线API文档样例：</a></p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211110235430680.png" alt="image-20211110235430680"></p>
<p><code>springfox </code>，是一个开源的API Doc的框架， 它的前身是swagger-springmvc，可以将我们的Controller中<br>的方法以文档的形式展现。</p>
<p><a target="_blank" rel="noopener" href="http://springfox.github.io/springfox/">springfox官网</a></p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211110235736768.png" alt="image-20211110235736768"></p>
<p><code>springfox-swagger2 </code>，它是整合springmvc和swagger2的一个项目，项目中使用swagger时，要引入它<br>的<a target="_blank" rel="noopener" href="https://mvnrepository.com/artifact/io.springfox/springfox-swagger2">依赖</a></p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211110235947547.png" alt="image-20211110235947547"></p>
<h3 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h3><p><strong>引入swagger依赖</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- swagger-ui依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--swagger依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.swagger<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>swagger-models<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.swagger<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>swagger-models<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p><strong>配置swagger</strong></p>
<p>com.briup.cms.config.Swagger2Config</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Swagger2Config</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211212174208946.png" alt="image-20211212174208946"></p>
<p><code>问题</code></p>
<ul>
<li>除UserController,还显示了默认接口</li>
<li>页面自定义信息</li>
</ul>
<p><strong>改造Swagger2Config</strong></p>
<p> 自定义扫描接口路径</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Swagger2Config</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Docket <span class="title">docket</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">// 配置swagger2类型 获取api构建器</span></span><br><span class="line">        <span class="comment">// 扫描的包 包下的路径</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2)</span><br><span class="line">                .select()</span><br><span class="line">                .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.briup.cms.controller&quot;</span>)) <span class="comment">// 那些包需要扫描</span></span><br><span class="line">                .paths(PathSelectors.any())  <span class="comment">// 包下的那些路径需要扫描</span></span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>此时页面只会扫描controller接口</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211212205921161.png" alt="image-20211212205921161"></p>
<p>页面显示自定义</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Swagger2Config</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Docket <span class="title">docket</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">// 配置swagger2类型 获取api构建器</span></span><br><span class="line">        <span class="comment">// 扫描的包 包下的路径</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2)</span><br><span class="line">                .apiInfo(apiInfo()) <span class="comment">// 引用自定义方法apiInfo()</span></span><br><span class="line">                .select()</span><br><span class="line">                .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.briup.cms.controller&quot;</span>)) <span class="comment">// 那些包需要扫描</span></span><br><span class="line">                .paths(PathSelectors.any())  <span class="comment">// 包下的那些路径需要扫描</span></span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// public static final ApiInfo DEFAULT = new ApiInfo(&quot;Api Documentation&quot;, &quot;Api Documentation&quot;, &quot;1.0&quot;, &quot;urn:tos&quot;,</span></span><br><span class="line"><span class="comment">//          DEFAULT_CONTACT, &quot;Apache 2.0&quot;, &quot;http://www.apache.org/licenses/LICENSE-2.0&quot;, new ArrayList&lt;VendorExtension&gt;());</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> ApiInfo <span class="title">apiInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ApiInfoBuilder()</span><br><span class="line">                .title(<span class="string">&quot;cms&quot;</span>)</span><br><span class="line">                .description(<span class="string">&quot;看点咨询系统(宿州学院)&quot;</span>)</span><br><span class="line">                .version(<span class="string">&quot;1.0&quot;</span>)</span><br><span class="line">                .contact(<span class="keyword">new</span> Contact(<span class="string">&quot;briup&quot;</span>,<span class="string">&quot;http://www.briup.com&quot;</span>,<span class="string">&quot;wangsidandan@gmail.com&quot;</span>))</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211212210135861.png" alt="image-20211212210135861"></p>
<p><code>问题</code></p>
<p>前端能否看懂swagger的配置以及如何传参</p>
<h3 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h3><p><code>@Api</code> ，用来指定当前API模块的名称<br><code>@ApiOperation </code>，用来设置API方法的简介说明<br><code>@ApiImplicitParams</code> ，用来设置API方法的参数，可以有多个参数<br><code>@ApiImplicitParam </code>，用来设置一个参数的详细信息</p>
<ul>
<li>name，参数的名称</li>
<li>value，参数的介绍</li>
<li>dataType，参数的数据类型，例如String</li>
<li>required，是否为必须参数</li>
<li>defaultValue，默认填入输入框的值</li>
<li>paramType，参数的类型：<ul>
<li>path    /user/{id} </li>
<li>query /user?id=</li>
<li>body 正文</li>
<li>header 请求头</li>
<li>form 请求表单</li>
</ul>
</li>
</ul>
<p><code>@ApiModel</code></p>
<ul>
<li>放在Bean上</li>
<li>该注解要配合post请求,@RequestBody才能生效</li>
<li>作用为给model解释</li>
<li>搭配 @ApiModelProperty一起使用</li>
</ul>
<p><code>ApiModelProperty</code></p>
<ul>
<li>放在属性上</li>
</ul>
<h3 id="改造-2"><a href="#改造-2" class="headerlink" title="改造"></a>改造</h3><p><strong>UserController</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;user&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;用户模块&quot;)</span> <span class="comment">//区分模块</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  插入用户</span></span><br><span class="line"><span class="comment">     *  使用rest风格传参</span></span><br><span class="line"><span class="comment">     *  前端向后端传递json格式数据,后端向前端返回json格式数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;添加用户&quot;,notes = &quot;json传参&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;insert&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">insert</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span></span>&#123;</span><br><span class="line">        <span class="comment">// 将来前端传用户数据</span></span><br><span class="line">        userService.insert(user);</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查找用户详情</span></span><br><span class="line"><span class="comment">     * 访问规则: http://localhost:8989/user/info/4</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;查看用户详情&quot;,notes = &quot;rest传参 用户id&quot;)</span></span><br><span class="line">    <span class="meta">@ApiImplicitParams(&#123;</span></span><br><span class="line"><span class="meta">            @ApiImplicitParam(name = &quot;id&quot;,value = &quot;用户id&quot;,required = true,dataType = &quot;int&quot;,paramType = &quot;path&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;info/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">info</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> <span class="keyword">int</span> id)</span></span>&#123;</span><br><span class="line">        User user = userService.findById(id);</span><br><span class="line">        <span class="keyword">return</span> Result.success(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>User</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiModel(&quot;用户模型&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ApiModelProperty(name = &quot;id&quot;,value = &quot;用户id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">  <span class="meta">@ApiModelProperty(name = &quot;birthday&quot;,value = &quot;用户生日&quot;,example = &quot;2000-01-01 00:00:00&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">    <span class="meta">@ApiModelProperty(name = &quot;gender&quot;,value = &quot;用户性别&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer gender;</span><br><span class="line">    <span class="meta">@ApiModelProperty(name = &quot;image&quot;,value = &quot;用户头像&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String image;</span><br><span class="line">    <span class="meta">@ApiModelProperty(name = &quot;password&quot;,value = &quot;用户密码&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="meta">@ApiModelProperty(name = &quot;phone&quot;,value = &quot;用户电话&quot;,example = &quot;13500000000&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line">    <span class="meta">@ApiModelProperty(name = &quot;realName&quot;,value = &quot;真实姓名&quot;,example = &quot;tom&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String realName;</span><br><span class="line">    <span class="meta">@ApiModelProperty(name = &quot;registerTime&quot;,value = &quot;用户id&quot;,hidden = true)</span></span><br><span class="line">    <span class="keyword">private</span> Date registerTime;</span><br><span class="line">    <span class="meta">@ApiModelProperty(name = &quot;status&quot;,value = &quot;用户状态 有默认值&quot;,example = &quot;0&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line">    <span class="meta">@ApiModelProperty(name = &quot;username&quot;,value = &quot;用户姓名&quot;,example = &quot;追风少年&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="meta">@ApiModelProperty(name = &quot;roleId&quot;,value = &quot;角色id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer roleId;</span><br><span class="line">     <span class="comment">//,,, 省略get/set</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注册时有些数据不能让用户填写,如用户状态(默认可用),注册时间等</p>
</blockquote>
<p><strong>改造UserServiceImpl</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">       user.setStatus(<span class="number">0</span>);</span><br><span class="line">       user.setRegisterTime(<span class="keyword">new</span> Date());</span><br><span class="line">       userMapper.insert(user);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211212212819571.png" alt="image-20211212212819571"></p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211212212849088.png" alt="image-20211212212849088"></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;birthday&quot;</span>: <span class="string">&quot;2000-01-01 08:00:00&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;gender&quot;</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;image&quot;</span>: <span class="string">&quot;string&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;password&quot;</span>: <span class="string">&quot;000&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;phone&quot;</span>: <span class="number">13500000000</span>,</span><br><span class="line">  <span class="attr">&quot;realName&quot;</span>: <span class="string">&quot;tom&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;username&quot;</span>: <span class="string">&quot;追风少年&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>至此,架构搭建完成  可以专注自己的业务模块 从controller 到 service 到dao</p>
</blockquote>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211212213127484.png" alt="image-20211212213127484"></p>
<h1 id="用户模块"><a href="#用户模块" class="headerlink" title="用户模块"></a>用户模块</h1><h2 id="接口"><a href="#接口" class="headerlink" title="==接口=="></a>==接口==</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 插入用户</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(User user)</span></span>;</span><br><span class="line">    <span class="comment">// 查找用户详情(回显数据)</span></span><br><span class="line">    <span class="function">User <span class="title">findById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line">    <span class="comment">//分页获取所有用户信息</span></span><br><span class="line">    <span class="function">PageUtil&lt;User&gt; <span class="title">getAll</span><span class="params">(PageUtil&lt;User&gt; page)</span></span>;</span><br><span class="line">    <span class="comment">//更新学生信息</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(User user)</span></span>;</span><br><span class="line">    <span class="comment">// 删除单个用户</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deleteById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">    <span class="comment">//批量删除用户信息</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deleteUserInBatch</span><span class="params">(List&lt;Integer&gt; ids)</span></span>;</span><br><span class="line">    <span class="comment">//修改用户的状态</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">updateUserStatus</span><span class="params">(Integer id,Integer status)</span></span>;</span><br><span class="line">    <span class="comment">//登录</span></span><br><span class="line">    <span class="function">User <span class="title">login</span><span class="params">(String username,String password)</span></span>;</span><br><span class="line">    <span class="comment">//根据用户名获取用户信息</span></span><br><span class="line">    <span class="function">User <span class="title">findUserByUsername</span><span class="params">(String username)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="新增"><a href="#新增" class="headerlink" title="新增"></a>新增</h2><p><a href="#%E6%8F%92%E5%85%A5%E6%B5%8B%E8%AF%95">插入测试</a>已完成 补充插入的细节</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 用户名和密码不能为空</span></span><br><span class="line">        <span class="keyword">if</span>(!StringUtils.hasText(user.getUsername()) || !StringUtils.hasText(user.getPassword()))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> CustomerException(ResultCode.PARAM_IS_BLANK);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 用户名不能重复</span></span><br><span class="line">        User userFromDB = findUserByUsername(user.getUsername());</span><br><span class="line">        <span class="keyword">if</span>(userFromDB != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> CustomerException(ResultCode.DATA_EXISTED);</span><br><span class="line">        &#125;</span><br><span class="line">        user.setStatus(<span class="number">0</span>);</span><br><span class="line">        user.setRegisterTime(<span class="keyword">new</span> Date());</span><br><span class="line">        userMapper.insert(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">findUserByUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userExtendMapper.findUserByUsername(username);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<p><strong>com.briup.cms.mapper.extend.UserExtendMapper</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserExtendMapper</span> </span>&#123;</span><br><span class="line">    <span class="function">User <span class="title">findUserByUsername</span><span class="params">(String username)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>src/mapper/extend/UserExtendMapper.xml</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.briup.cms.mapper.extend.UserExtendMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findUserByUsername&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.briup.cms.entity.User&quot;</span>&gt;</span></span><br><span class="line">        select <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;com.briup.cms.mapper.UserMapper.Base_Column_List&quot;</span>/&gt;</span> from cms_user</span><br><span class="line">        where username = #&#123;username&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;birthday&quot;</span>: <span class="string">&quot;2000-01-01 00:00:00&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;gender&quot;</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">&quot;image&quot;</span>: <span class="string">&quot;string&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;password&quot;</span>: <span class="string">&quot;000&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;phone&quot;</span>: <span class="number">13500000000</span>,</span><br><span class="line">  <span class="attr">&quot;realName&quot;</span>: <span class="string">&quot;tom&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;username&quot;</span>: <span class="string">&quot;追风少年8&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h2><h3 id="utils"><a href="#utils" class="headerlink" title="utils"></a>utils</h3><p>com.briup.cms.utils.PageUtil</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ApiModel(&quot;分页模型&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PageUtil</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 当前页</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(name = &quot;pageNumber&quot;,value = &quot;当前页&quot;,example = &quot;1&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer pageNumber;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 每页条数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(name = &quot;pageSize&quot;,value = &quot;每页数量&quot;,example = &quot;5&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer pageSize;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 总条数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(hidden = true)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> total;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 数据列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(hidden = true)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;T&gt; list;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 搜索条件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(name = &quot;params&quot;,value = &quot;查询条件&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Object&gt; params = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">8</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="mapper"><a href="#mapper" class="headerlink" title="mapper"></a>mapper</h3><p>com.briup.cms.mapper.extend.UserExtendMapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserExtendMapper</span> </span>&#123;</span><br><span class="line">    <span class="function">User <span class="title">findUserByUsername</span><span class="params">(String username)</span></span>;</span><br><span class="line">    <span class="function">Page&lt;User&gt; <span class="title">getAll</span><span class="params">()</span></span>; <span class="comment">// 返回PageHelper带的分页Page</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>src/mapper/extend/UserExtendMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getAll&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;com.briup.cms.mapper.UserMapper.BaseResultMap&quot;</span>&gt;</span></span><br><span class="line">        select <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;com.briup.cms.mapper.UserMapper.Base_Column_List&quot;</span>/&gt;</span> from cms_user</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="service-2"><a href="#service-2" class="headerlink" title="service"></a>service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PageUtil&lt;User&gt; <span class="title">getAll</span><span class="params">(PageUtil&lt;User&gt; pageUtil)</span> </span>&#123;</span><br><span class="line">        PageHelper.startPage(pageUtil.getPageNumber(),pageUtil.getPageSize());</span><br><span class="line">        Page all = userExtendMapper.getAll();</span><br><span class="line">        pageUtil.setList(all.getResult());</span><br><span class="line">        pageUtil.setTotal(all.getTotal());</span><br><span class="line">        <span class="keyword">return</span> pageUtil;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h3 id="controller-2"><a href="#controller-2" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;分页查找用户&quot;, notes = &quot;提供分页条件&quot;)</span></span><br><span class="line">   <span class="meta">@PostMapping(&quot;findByPage&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Result <span class="title">findByPage</span><span class="params">(<span class="meta">@RequestBody</span> PageUtil&lt;User&gt; pageUtil)</span> </span>&#123;</span><br><span class="line">       pageUtil= userService.getAll(pageUtil);</span><br><span class="line">       <span class="keyword">return</span> Result.success(pageUtil);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<h3 id="效果-2"><a href="#效果-2" class="headerlink" title="效果"></a>效果</h3><p><strong>请求</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;pageNumber&quot;</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">&quot;pageSize&quot;</span>: <span class="number">5</span>,</span><br><span class="line">  <span class="attr">&quot;params&quot;</span>: &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>PageHelpler从第1页开始分页</code></p>
<p><strong>结果</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;code&quot;</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">&quot;msg&quot;</span>: <span class="string">&quot;操作成功&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;data&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;pageNumber&quot;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">&quot;pageSize&quot;</span>: <span class="number">5</span>,</span><br><span class="line">    <span class="attr">&quot;total&quot;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">&quot;list&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;id&quot;</span>: <span class="number">9</span>,</span><br><span class="line">        <span class="attr">&quot;birthday&quot;</span>: <span class="string">&quot;2000-01-01T00:00:00.000+00:00&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;gender&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">&quot;image&quot;</span>: <span class="string">&quot;string&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;password&quot;</span>: <span class="string">&quot;000&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;phone&quot;</span>: <span class="string">&quot;13500000000&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;realName&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;registerTime&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;status&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">&quot;username&quot;</span>: <span class="string">&quot;追风少年&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;roleId&quot;</span>: <span class="literal">null</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;id&quot;</span>: <span class="number">10</span>,</span><br><span class="line">        <span class="attr">&quot;birthday&quot;</span>: <span class="string">&quot;2000-01-01T00:00:00.000+00:00&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;gender&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">&quot;image&quot;</span>: <span class="string">&quot;string&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;password&quot;</span>: <span class="string">&quot;000&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;phone&quot;</span>: <span class="string">&quot;13500000000&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;realName&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;registerTime&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;status&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">&quot;username&quot;</span>: <span class="string">&quot;追风少年2&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;roleId&quot;</span>: <span class="literal">null</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;params&quot;</span>: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>时间格式有问题</code></p>
<p>application.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.jackson.date-format</span>=<span class="string">yyyy-MM-dd HH:mm:ss</span></span><br><span class="line"><span class="meta">spring.jackson.time-zone</span>=<span class="string">GMT+8</span></span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">       <span class="attr">&quot;id&quot;</span>: <span class="number">12</span>,</span><br><span class="line">       <span class="attr">&quot;birthday&quot;</span>: <span class="string">&quot;2000-01-01 08:00:00&quot;</span>,</span><br><span class="line">       <span class="attr">&quot;gender&quot;</span>: <span class="number">0</span>,</span><br><span class="line">       <span class="attr">&quot;image&quot;</span>: <span class="string">&quot;string&quot;</span>,</span><br><span class="line">       <span class="attr">&quot;password&quot;</span>: <span class="string">&quot;000&quot;</span>,</span><br><span class="line">       <span class="attr">&quot;phone&quot;</span>: <span class="string">&quot;13500000000&quot;</span>,</span><br><span class="line">       <span class="attr">&quot;realName&quot;</span>: <span class="string">&quot;tom&quot;</span>,</span><br><span class="line">       <span class="attr">&quot;registerTime&quot;</span>: <span class="string">&quot;2021-12-13 12:18:55&quot;</span>,</span><br><span class="line">       <span class="attr">&quot;status&quot;</span>: <span class="number">0</span>,</span><br><span class="line">       <span class="attr">&quot;username&quot;</span>: <span class="string">&quot;追风少年3&quot;</span>,</span><br><span class="line">       <span class="attr">&quot;roleId&quot;</span>: <span class="literal">null</span></span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>



<h2 id="回显"><a href="#回显" class="headerlink" title="回显"></a>回显</h2><p><a href="#%E6%9F%A5%E6%89%BE%E6%B5%8B%E8%AF%95">查找测试</a>已完成 将来可级联所属角色</p>
<h2 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h2><h3 id="service-3"><a href="#service-3" class="headerlink" title="service"></a>service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 约定名字不可以修改 页面直接禁用组件即可,否则会出现和数据库同名</span></span><br><span class="line">        <span class="comment">// 或者做数据匹配判断</span></span><br><span class="line">        userMapper.updateByPrimaryKeySelective(user);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="controller-3"><a href="#controller-3" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;修改用户&quot;, notes = &quot;json传参&quot;)</span></span><br><span class="line">    <span class="meta">@PutMapping(&quot;update&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">update</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 将来前端传用户数据</span></span><br><span class="line">        userService.update(user);</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;birthday&quot;</span>: <span class="string">&quot;2000-01-01 00:00:00&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;gender&quot;</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">&quot;id&quot;</span>: <span class="number">17</span>,</span><br><span class="line">  <span class="attr">&quot;image&quot;</span>: <span class="string">&quot;string&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;password&quot;</span>: <span class="string">&quot;000&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;phone&quot;</span>: <span class="number">13500000000</span>,</span><br><span class="line">  <span class="attr">&quot;realName&quot;</span>: <span class="string">&quot;老刘&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;status&quot;</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="更新用户状态"><a href="#更新用户状态" class="headerlink" title="更新用户状态"></a>更新用户状态</h2><h3 id="service-4"><a href="#service-4" class="headerlink" title="service"></a>service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateUserStatus</span><span class="params">(Integer id, Integer status)</span> </span>&#123;</span><br><span class="line">        User temp = <span class="keyword">new</span> User();</span><br><span class="line">        temp.setId(id);</span><br><span class="line">        temp.setStatus(status);</span><br><span class="line">        userMapper.updateByPrimaryKeySelective(temp);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="controller-4"><a href="#controller-4" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;将用户禁用&quot;, notes = &quot;rest传参&quot;)</span></span><br><span class="line">    <span class="meta">@ApiImplicitParams(&#123;</span></span><br><span class="line"><span class="meta">            @ApiImplicitParam(name = &quot;id&quot;, value = &quot;用户id&quot;, required = true, dataType = &quot;int&quot;, paramType = &quot;path&quot;),</span></span><br><span class="line"><span class="meta">            @ApiImplicitParam(name = &quot;status&quot;, value = &quot;用户状态&quot;, required = true, dataType = &quot;int&quot;, paramType = &quot;path&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="meta">@PutMapping(&quot;updateStatus/&#123;id&#125;/&#123;status&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">updateStatus</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> <span class="keyword">int</span> id,<span class="meta">@PathVariable(&quot;status&quot;)</span> <span class="keyword">int</span> status)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 将来前端传用户数据</span></span><br><span class="line">        userService.updateUserStatus(id,status);</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211213151028757.png" alt="image-20211213151028757"></p>
<h2 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h2><h3 id="service-5"><a href="#service-5" class="headerlink" title="service"></a>service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteById</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">       userMapper.deleteByPrimaryKey(id);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<h3 id="controller-5"><a href="#controller-5" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;删除单个用户&quot;,notes = &quot;rest风格&quot;)</span></span><br><span class="line">    <span class="meta">@ApiImplicitParams(&#123;</span></span><br><span class="line"><span class="meta">            @ApiImplicitParam(name = &quot;id&quot;, value = &quot;用户id&quot;, required = true, dataType = &quot;int&quot;, paramType = &quot;path&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/delete/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">deleteBatch</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> <span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        userService.deleteById(id);</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h2 id="批量删除"><a href="#批量删除" class="headerlink" title="批量删除"></a>批量删除</h2><h3 id="mapper-1"><a href="#mapper-1" class="headerlink" title="mapper"></a>mapper</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteUserInBatch&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">        delete from cms_user</span><br><span class="line">        where id in</span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span> <span class="attr">item</span>=<span class="string">&quot;id&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span> &gt;</span></span><br><span class="line">            #&#123;id&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="service-6"><a href="#service-6" class="headerlink" title="service"></a>service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteUserInBatch</span><span class="params">(List&lt;Integer&gt; ids)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 循环调用sql</span></span><br><span class="line">        <span class="comment">//ids.forEach(id -&gt; userMapper.deleteByPrimaryKey(id));</span></span><br><span class="line">        <span class="comment">// 批量调用sql</span></span><br><span class="line">       userExtendMapper.deleteUserInBatch(ids);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h3 id="controller-6"><a href="#controller-6" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;批量删除&quot;,notes = &quot;需要传递多个id&quot;)</span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/deleteBatch&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">deleteBatch</span><span class="params">(<span class="meta">@ApiParam(value = &quot;批量id&quot;)</span><span class="meta">@RequestBody</span> List&lt;Integer&gt; ids)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// @ApiParam 默认是json格式</span></span><br><span class="line">        userService.deleteUserInBatch(ids);</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  <span class="number">18</span>,<span class="number">19</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>



<h2 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h2><h3 id="vo"><a href="#vo" class="headerlink" title="vo"></a>vo</h3><p>com.briup.cms.vo.UserVo</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserVo</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ApiModelProperty(name = &quot;username&quot;,value = &quot;用户名&quot;,example = &quot;vanse&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="meta">@ApiModelProperty(name = &quot;password&quot;,value = &quot;密码&quot;,example = &quot;vanse&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="service-7"><a href="#service-7" class="headerlink" title="service"></a>service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">login</span><span class="params">(String username, String password)</span> </span>&#123;</span><br><span class="line">        User userFromDB = findUserByUsername(username);</span><br><span class="line">        <span class="keyword">if</span>(userFromDB == <span class="keyword">null</span> || !password.equals(userFromDB.getPassword()))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> CustomerException(ResultCode.USER_LOGIN_ERROR);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> userFromDB;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="controller-7"><a href="#controller-7" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;认证模块&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;登录&quot;,notes = &quot;传json&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;login&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">login</span><span class="params">(<span class="meta">@RequestBody</span> UserVo userVo)</span></span>&#123;</span><br><span class="line">       User user = userService.login(userVo.getUsername(),userVo.getPassword());</span><br><span class="line">       <span class="keyword">return</span> Result.success();  </span><br><span class="line"><span class="comment">//       String token = UUID.randomUUID().toString() + &quot;-&quot; + user.getId();</span></span><br><span class="line"><span class="comment">//       return Result.success(token);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;password&quot;</span>: <span class="string">&quot;vanse&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;username&quot;</span>: <span class="string">&quot;vanse&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>思考: 登录成功后是否需要将用户存session</code></p>
<h2 id="当前用户信息"><a href="#当前用户信息" class="headerlink" title="当前用户信息"></a>当前用户信息</h2><blockquote>
<p>暂时不用 将来对接前台使用</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/resource/info&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Result <span class="title">info</span><span class="params">(HttpServletRequest request)</span></span>&#123;</span><br><span class="line">       String token = request.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">       <span class="comment">// 取出token中的信息</span></span><br><span class="line">       Map&lt;String, Object&gt; map = JwtUtil.getInfo(token);</span><br><span class="line">       <span class="keyword">return</span> Result.success(map);</span><br><span class="line">   &#125;</span><br><span class="line"><span class="meta">@PostMapping(&quot;/resource/logout&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Result <span class="title">login</span><span class="params">()</span></span>&#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;去除token&quot;</span>);</span><br><span class="line">       <span class="keyword">return</span> Result.success(<span class="string">&quot;退出成功&quot;</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<h1 id="jwt"><a href="#jwt" class="headerlink" title="jwt"></a>jwt</h1><h2 id="概述-3"><a href="#概述-3" class="headerlink" title="概述"></a>概述</h2><p>传统的Web应用中，使用session来存在用户的信息，每次用户认证通过以后，服务器需要创建一条记录<br>保存用户信息，通常是在内存中。</p>
<ul>
<li>随着认证通过的用户越来越多，服务器的在这里的开销就会越来越大,</li>
<li>由于Session是在内存中的，这就带来一些扩展性的问题<ul>
<li>servlet依赖于web容器    </li>
</ul>
</li>
</ul>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20210318005044861.png" alt="image-20210318005044861"></p>
<blockquote>
<p>JSON Web Token (JWT,token的一种)，是一个开放标准(RFC 7519)，它定义了一种紧凑的、自包含的方式，用于作为JSON对象在各方之间安全地传输信息。该信息可以被验证和信任，因为它是数字签名的。</p>
</blockquote>
<ul>
<li>JWT存放在客户端（前端），每次请求的请求头中，携带此JWT发送给服务器，服务器端负责接收<br>和验证</li>
<li>服务器端可以不用存储JWT，这样可以降低服务器的内存的开销</li>
<li>JWT和语言无关，扩展起来非常方便，无论是PC端还是移动端，都可以很容易的使用</li>
<li>不受cookie的限制</li>
</ul>
<p>如图：</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20210318005232445.png" alt="image-20210318005232445"></p>
<blockquote>
<p>注意，session和JWT的主要区别就是保存的位置，session是保存在服务端的，而JWT是保存在客户<br>端的</p>
</blockquote>
<blockquote>
<p>注意，JWT就是一个固定格式的字符串</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://jwt.io/">JWT官网</a></p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20210318005358285.png" alt="image-20210318005358285"></p>
<h2 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h2><p>JWT固定各种的字符串，由三部分组成：</p>
<ul>
<li>Header，头部</li>
<li>Payload，载荷</li>
<li>Signature，签名</li>
</ul>
<blockquote>
<p>注意，把这三部分使用点（.）连接起来，就是一个JWT字符串</p>
</blockquote>
<p>如图：</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20210319084618060.png" alt="image-20210319084618060"></p>
<h3 id="头部"><a href="#头部" class="headerlink" title="头部"></a>头部</h3><blockquote>
<p>header一般的由两部分组成：token的类型（“JWT”）和算法名称（比如：HMAC SHA256或者RSA等等）。</p>
</blockquote>
<p>JWT里验证和签名使用的算法列表如下：</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20210319084933149.png" alt="image-20210319084933149"></p>
<p>例如，</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;alg&quot;</span>: <span class="string">&quot;HS256&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;typ&quot;</span>: <span class="string">&quot;JWT&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="载荷"><a href="#载荷" class="headerlink" title="载荷"></a>载荷</h3><blockquote>
<p>payload主要用来包含声明（claims ），这个声明一般是关于实体(通常是用户)和其他数据的声明。</p>
</blockquote>
<p>声明有三种类型:</p>
<ul>
<li>registered</li>
<li>public</li>
<li>private</li>
</ul>
<p>具体如下：</p>
<p>Registered claims : 这里有一组预定义的声明，它们不是强制的，但是推荐。</p>
<ul>
<li>iss: jwt签发者</li>
<li>sub: jwt所面向的用户</li>
<li>aud: 接收jwt的一方</li>
<li>exp: jwt的过期时间，这个过期时间必须要大于签发时间 </li>
<li>nbf: 定义在什么时间之前，该jwt都是不可用的</li>
<li>iat: jwt的签发时间</li>
<li>jti: jwt的唯一身份标识，主要用来作为一次性token，从而回避重放攻击</li>
</ul>
<p>Public claims : 可以随意定义</p>
<ul>
<li>自定义数据:存放在token中存放的key-value值</li>
</ul>
<p>Private claims : 用于在同意使用它们的各方之间共享信息，并且不是注册的或公开的声明</p>
<p>例如，</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;iss&quot;</span>: <span class="string">&quot;briup&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;iat&quot;</span>: <span class="number">1446593502</span>,</span><br><span class="line">    <span class="attr">&quot;exp&quot;</span>: <span class="number">1446594722</span>,</span><br><span class="line">    <span class="attr">&quot;aud&quot;</span>: <span class="string">&quot;www.briup.com&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;sub&quot;</span>: <span class="string">&quot;briup@briup.com&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;username&quot;</span>: <span class="string">&quot;tom&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，不要在JWT的payload或header中放置敏感信息，除非它们是加密的</p>
</blockquote>
<p>把头部和载荷分别进行Base64编码之后得到两个字符串，然后再将这两个编码后的字符串用英文句号.<br>连接在一起（头部在前），形成新的字符串：</p>
<p><code>eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJhdWQiOiI2MmI2OWNlZC02YWNlLTRmYzAtOTk5MS00YWUwMjIxODQ0OTciLCJleHAiOjE2MDYwNTQzNjl9</code></p>
<p><a target="_blank" rel="noopener" href="http://tool.chinaz.com/tools/base64.aspx">测试编码</a></p>
<p>###签名</p>
<p>最后，将上面拼接完的字符串用HS256算法进行加密，在加密的时候，还需要提供一个密钥（secret）。加密后的内容也是一个字符串，这个字符串就是签名。</p>
<p>把这个签名拼接在刚才的字符串后面就能得到完整的JWT字符串。<br>header部分和payload部分如果被篡改，由于篡改者不知道密钥是什么，也无法生成新的signature部分，<br>服务端也就无法通过。</p>
<blockquote>
<p>在JWT中，消息体是透明的，使用签名可以保证消息不被篡改。</p>
</blockquote>
<blockquote>
<p>确保密钥不会泄露,否则会被篡改</p>
</blockquote>
<p>例如，使用HMACSHA256加密算法，配合秘钥，将前俩部进行加密，生成签名</p>
<p><code>HMACSHA256(base64UrlEncode(header) + &quot;.&quot; + base64UrlEncode(payload), secret)</code></p>
<p>例如，将Header、Payload、Signature三部分使用点（.）连接起来</p>
<p><code>eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJhdWQiOiI2MmI2OWNlZC02YWNlLTRmYzAtOTk5MS00Y WUwMjIxODQ0OTciLCJleHAiOjE2MDYwNTQzNjl9.DNVhr36j66JpQBfcYoo64IRp84dKiQeaq7axHTBcP9 E</code></p>
<p>例如，使用官网提供的工具，可以对该JWT进行验证和解析（不要放敏感信息）</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20210319085334765.png" alt="image-20210319085334765"></p>
<blockquote>
<p>注意，在代码中，我们使用JWT封装的工具类，也可以完成此操作 sso</p>
</blockquote>
<h2 id="整合"><a href="#整合" class="headerlink" title="整合"></a>整合</h2><h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.auth0<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>java-jwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.11.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="工具类"><a href="#工具类" class="headerlink" title="工具类"></a>工具类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.cms.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.auth0.jwt.JWT;</span><br><span class="line"><span class="keyword">import</span> com.auth0.jwt.JWTVerifier;</span><br><span class="line"><span class="keyword">import</span> com.auth0.jwt.algorithms.Algorithm;</span><br><span class="line"><span class="keyword">import</span> com.auth0.jwt.exceptions.JWTDecodeException;</span><br><span class="line"><span class="keyword">import</span> com.auth0.jwt.exceptions.JWTVerificationException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JwtUtil</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 过期时间5分钟</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> EXPIRE_TIME = <span class="number">5</span> * <span class="number">60</span> * <span class="number">1000</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * jwt 密钥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SECRET = <span class="string">&quot;jwt_secret&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成签名，五分钟后过期</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> info，Map的value只能存放的值的类型为：Map, List, Boolean, Integer, Long, Double, String and Date</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">sign</span><span class="params">(String userId,Map&lt;String,Object&gt; info)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Date date = <span class="keyword">new</span> Date(System.currentTimeMillis() + EXPIRE_TIME);</span><br><span class="line">            Algorithm algorithm = Algorithm.HMAC256(SECRET);</span><br><span class="line">            <span class="keyword">return</span> JWT.create()</span><br><span class="line">                    <span class="comment">// 将 user id 保存到 token 里面</span></span><br><span class="line">                    .withAudience(userId)</span><br><span class="line">                    <span class="comment">// 存放自定义数据</span></span><br><span class="line">                    .withClaim(<span class="string">&quot;info&quot;</span>, info)</span><br><span class="line">                    <span class="comment">// 五分钟后token过期</span></span><br><span class="line">                    .withExpiresAt(date)</span><br><span class="line">                    <span class="comment">// token 的密钥</span></span><br><span class="line">                    .sign(algorithm);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        	e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据token获取userId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> token</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getUserId</span><span class="params">(String token)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String userId = JWT.decode(token).getAudience().get(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">return</span> userId;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JWTDecodeException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据token获取自定义数据info</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> token</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String,Object&gt; <span class="title">getInfo</span><span class="params">(String token)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> JWT.decode(token).getClaim(<span class="string">&quot;info&quot;</span>).asMap();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JWTDecodeException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 校验token</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> token</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">checkSign</span><span class="params">(String token)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Algorithm algorithm = Algorithm.HMAC256(SECRET);</span><br><span class="line">            JWTVerifier verifier = JWT.require(algorithm)</span><br><span class="line">                    <span class="comment">// .withClaim(&quot;username&quot;, username)</span></span><br><span class="line">                    .build();</span><br><span class="line">            verifier.verify(token);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JWTVerificationException exception) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;token 无效，请重新获取&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="改造登录"><a href="#改造登录" class="headerlink" title="改造登录"></a>改造登录</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;认证模块&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;登录&quot;,notes = &quot;传json&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;login&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">login</span><span class="params">(<span class="meta">@RequestBody</span> UserVo userVo)</span></span>&#123;</span><br><span class="line">       User user = userService.login(userVo.getUsername(),userVo.getPassword());</span><br><span class="line">       Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">       map.put(<span class="string">&quot;username&quot;</span>,user.getUsername());</span><br><span class="line">       map.put(<span class="string">&quot;image&quot;</span>,user.getImage());</span><br><span class="line">       String token = JwtUtil.sign(String.valueOf(user.getId()), map);</span><br><span class="line">       <span class="keyword">return</span> Result.success(token);</span><br><span class="line"><span class="comment">//       String token = UUID.randomUUID().toString() + &quot;-&quot; + user.getId();</span></span><br><span class="line"><span class="comment">//       return Result.success(token);</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="拦截器"><a href="#拦截器" class="headerlink" title="拦截器"></a>拦截器</h3><p>com.briup.cms.interceptors.JwtInteceptors</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 拦截认证资源</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JwtInteceptors</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">       		 <span class="comment">// 可以放行预检请求</span></span><br><span class="line">		<span class="keyword">if</span>(!(handler <span class="keyword">instanceof</span> HandlerMethod))&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 从请求头中获取token</span></span><br><span class="line">		String token = request.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">		<span class="comment">// 判断token是否为空 空直接抛异常 </span></span><br><span class="line">		<span class="keyword">if</span>(token == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;无token,请登录&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 校验token</span></span><br><span class="line">		JwtUtil.checkSign(token);</span><br><span class="line">		<span class="comment">// 取出token中的信息</span></span><br><span class="line">		String userId = JwtUtil.getUserId(token);</span><br><span class="line">		System.out.println(userId);</span><br><span class="line">		Map&lt;String, Object&gt; info = JwtUtil.getInfo(token);</span><br><span class="line">		info.forEach((k,v)-&gt;&#123;</span><br><span class="line">			System.out.println(k+<span class="string">&quot;=&quot;</span>+v);</span><br><span class="line">		&#125;);</span><br><span class="line">		<span class="comment">// 放行</span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="mvc配置"><a href="#mvc配置" class="headerlink" title="mvc配置"></a>mvc配置</h3><p>com.briup.cms.config.MvcConfig</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MvcConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">		registry.addInterceptor(<span class="keyword">new</span> JwtInteceptors())</span><br><span class="line">		.addPathPatterns(<span class="string">&quot;/resource/**&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="资源"><a href="#资源" class="headerlink" title="资源"></a>资源</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;resource&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;测试模块&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResourceController</span> </span>&#123;</span><br><span class="line">	<span class="meta">@GetMapping(&quot;hello&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p><strong>直接访问</strong></p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211112093343903.png" alt="image-20211112093343903"></p>
<p><strong>获取token</strong></p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211112093718429.png" alt="image-20211112093718429"></p>
<p><strong>携带请求头</strong></p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211112093811250.png" alt="image-20211112093811250"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line">gender=0</span><br><span class="line">username=wangsidandan</span><br></pre></td></tr></table></figure>



<p><strong>修改token，故意写错后，再访问测试</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;code&quot;</span>:<span class="number">500</span>,<span class="attr">&quot;msg&quot;</span>:<span class="string">&quot;服务器异常: token 无效，请重新获取&quot;</span>,<span class="attr">&quot;data&quot;</span>:<span class="literal">null</span>&#125;</span><br></pre></td></tr></table></figure>

<p><strong>获取新的token测试通过后，等待5分钟后，再次访问</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;code&quot;</span>:<span class="number">500</span>,<span class="attr">&quot;msg&quot;</span>:<span class="string">&quot;服务器异常: token 无效，请重新获取&quot;</span>,<span class="attr">&quot;data&quot;</span>:<span class="literal">null</span>&#125;</span><br></pre></td></tr></table></figure>



<h3 id="swagger-1"><a href="#swagger-1" class="headerlink" title="swagger"></a>swagger</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/auth&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;测试模块&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthController</span> </span>&#123;</span><br><span class="line">	<span class="meta">@ApiOperation(value = &quot;测试&quot;,notes = &quot;token放请求头&quot;)</span></span><br><span class="line">	<span class="meta">@ApiImplicitParams(&#123;</span></span><br><span class="line"><span class="meta">		@ApiImplicitParam(name = &quot;token&quot;,value = &quot;token值&quot;,dataType = &quot;string&quot;,paramType = &quot;header&quot;,required = true)</span></span><br><span class="line"><span class="meta">	&#125;)</span></span><br><span class="line">	<span class="meta">@GetMapping(&quot;/hello&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>问题</code></p>
<p>每个需要拦截的资源都要手动配置token</p>
<h2 id="全局配置"><a href="#全局配置" class="headerlink" title="全局配置"></a>全局配置</h2><h3 id="1-概述"><a href="#1-概述" class="headerlink" title="1.概述"></a>1.概述</h3><blockquote>
<p>很多请求中，会携带token到服务器端进行认证，token有效时才可以进行本次访问，调用相应的接口</p>
</blockquote>
<p>使用swagger进行接口测试后，可以给swagger中测试的接口，添加全局的参数，让每一个接口都含义指定的参数，这样就不需要每一个接上添加swagger的注解了。</p>
<h3 id="2-使用"><a href="#2-使用" class="headerlink" title="2.使用"></a>2.使用</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.cms.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.common.base.Predicate;</span><br><span class="line"><span class="keyword">import</span> com.google.common.base.Predicates;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.ApiInfoBuilder;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.PathSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.RequestHandlerSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.ApiInfo;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.ApiKey;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.AuthorizationScope;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.Contact;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.SecurityReference;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spi.DocumentationType;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spi.service.contexts.SecurityContext;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spring.web.plugins.Docket;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.swagger2.annotations.EnableSwagger2;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/12/12-12-12-17:40</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：com.briup.cms.config</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Swagger2Config</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Docket <span class="title">docket</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">// 配置swagger2类型 获取api构建器</span></span><br><span class="line">        <span class="comment">// 扫描的包 包下的路径</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2)</span><br><span class="line">                .apiInfo(apiInfo()) <span class="comment">// 引用自定义方法apiInfo()</span></span><br><span class="line">                .select()</span><br><span class="line">                .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.briup.cms.controller&quot;</span>)) <span class="comment">// 那些包需要扫描</span></span><br><span class="line">                .paths(PathSelectors.any())  <span class="comment">// 包下的那些路径需要扫描</span></span><br><span class="line">                .build()</span><br><span class="line">                .securitySchemes(security()).securityContexts(securityContexts())</span><br><span class="line">                .ignoredParameterTypes(HttpServletRequest.class, HttpServletResponse.class);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// public static final ApiInfo DEFAULT = new ApiInfo(&quot;Api Documentation&quot;, &quot;Api Documentation&quot;, &quot;1.0&quot;, &quot;urn:tos&quot;,</span></span><br><span class="line"><span class="comment">//          DEFAULT_CONTACT, &quot;Apache 2.0&quot;, &quot;http://www.apache.org/licenses/LICENSE-2.0&quot;, new ArrayList&lt;VendorExtension&gt;());</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> ApiInfo <span class="title">apiInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ApiInfoBuilder()</span><br><span class="line">                .title(<span class="string">&quot;cms&quot;</span>)</span><br><span class="line">                .description(<span class="string">&quot;看点咨询系统(宿州学院)&quot;</span>)</span><br><span class="line">                .version(<span class="string">&quot;1.0&quot;</span>)</span><br><span class="line">                .contact(<span class="keyword">new</span> Contact(<span class="string">&quot;briup&quot;</span>,<span class="string">&quot;http://www.briup.com&quot;</span>,<span class="string">&quot;wangsidandan@gmail.com&quot;</span>))</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置认证中显示的显示的基本信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> List&lt;ApiKey&gt; <span class="title">security</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Collections.singletonList(<span class="keyword">new</span> ApiKey(<span class="string">&quot;Authorization&quot;</span>, <span class="string">&quot;token&quot;</span>, <span class="string">&quot;header&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置认证规则</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> List&lt;SecurityContext&gt; <span class="title">securityContexts</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        List&lt;String&gt; antPaths = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">        antPaths.add(<span class="string">&quot;/resource/**&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Collections.singletonList(SecurityContext.builder().securityReferences(defaultAuth())</span><br><span class="line">                .forPaths(antPathsCondition(antPaths)).build());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回认证路径的条件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Predicate&lt;String&gt; <span class="title">antPathsCondition</span><span class="params">(List&lt;String&gt; antPaths)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        List&lt;Predicate&lt;String&gt;&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        antPaths.forEach(path -&gt; list.add(PathSelectors.ant(path)));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Predicates.or(list);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置认证的范围，以及认证的类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> List&lt;SecurityReference&gt; <span class="title">defaultAuth</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        AuthorizationScope authorizationScope = <span class="keyword">new</span> AuthorizationScope(<span class="string">&quot;global&quot;</span>, <span class="string">&quot;accessEverything&quot;</span>);</span><br><span class="line">        AuthorizationScope[] authorizationScopes = <span class="keyword">new</span> AuthorizationScope[<span class="number">1</span>];</span><br><span class="line">        authorizationScopes[<span class="number">0</span>] = authorizationScope;</span><br><span class="line">        <span class="keyword">return</span> Collections.singletonList(<span class="keyword">new</span> SecurityReference(<span class="string">&quot;Authorization&quot;</span>, authorizationScopes));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这里比之前新增的代码如下：</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20210321171405316.png" alt="image-20210321171405316"></p>
<blockquote>
<p>注意，新增代码如图所示，以及下面新增的几个方法</p>
</blockquote>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20210321171428922.png" alt="image-20210321171428922"></p>
<blockquote>
<p>注意，这里会显示一个“锁”的图标，表示这里有些接口是需要认证的</p>
</blockquote>
<p>展开模块后，访问路径符合要求接口，也会显示“锁”的图标</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20210321171450952.png" alt="image-20210321171450952"></p>
<p>点击锁的图标，添加请求头中的统一认证信息（token）：</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20210321171509563.png" alt="image-20210321171509563"></p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20210321171519876.png" alt="image-20210321171519876"></p>
<p>点击认证按钮后，进行访问测试：</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20210321171537958.png" alt="image-20210321171537958"></p>
<p>注意，这时候，有“锁”图标的接口，在访问的时候，都会携带刚刚设置的请求头中的认证信息token值</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20210321171609118.png" alt="image-20210321171609118"></p>
<p>注意，这时候，无“锁”图标的接口，在访问的时候，默认是不会携带设置的请求头信息的</p>
<h1 id="cors"><a href="#cors" class="headerlink" title="cors"></a>cors</h1><h2 id="概述-4"><a href="#概述-4" class="headerlink" title="概述"></a>概述</h2><p>跨域访问，是指从一个域名的网页去请求另一个域名的资源。比如从<a target="_blank" rel="noopener" href="http://www.baidu.com/">www.baidu.com</a> 页面去请求 <a target="_blank" rel="noopener" href="http://www.google.com/">www.google.com</a> 的资源。但是一般情况下不能这么做跨域访问，因为有浏览器的“<strong>同源策略</strong>”存在，这是浏览器对JavaScript施加的安全限制。</p>
<blockquote>
<p>跨域，指的是浏览器不能执行其他网站的脚本。它是由浏览器的同源策略造成的，是浏览器对JavaScript施加的安全限制。</p>
</blockquote>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20210321224558036.png" alt="image-20210321224558036"></p>
<p><strong>“同源策略”</strong>简单的说，就是A网站页面访问B网站的资源受限（跨域访问），除非A和B是“同源”。<br><strong>“同源”</strong>是指三个相同，协议相同、域名相同、端口相同，只有有任何一个地方不同，就认为是跨域。</p>
<p>例如，<br>网页A的地址为， <a target="_blank" rel="noopener" href="http://www.example.com/dir/page.html">http://www.example.com/dir/page.html</a><br>假设，网页A要访问的网页B地址为：</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://www.example.com/dir2/other.html">http://www.example.com/dir2/other.html</a> ： 同源（正常访问）</li>
<li><a target="_blank" rel="noopener" href="https://www.example.com/dir/other.html">https://www.example.com/dir/other.html</a> ：不同源（协议不同，跨域）</li>
<li><a target="_blank" rel="noopener" href="http://vip.www.example.com/dir/other.html">http://vip.www.example.com/dir/other.html</a> ：不同源（域名不同，跨域）</li>
<li><a target="_blank" rel="noopener" href="http://www.example.com:81/dir/other.html">http://www.example.com:81/dir/other.html</a> ：不同源（端口不同，跨域）</li>
</ul>
<p>随着互联网的发展，“同源政策”越来越严格，目前，如果非同源（跨域），共有三种行为受到限制：</p>
<ul>
<li>Cookie 、LocalStorage、IndexDB 无法访问</li>
<li>DOM 无法获取</li>
<li>AJAX请求不能发送</li>
</ul>
<p>浏览器的用“同源策略”来限制跨域访问的目的是为了安全，例如，假设没有跨域访问的限制</p>
<ul>
<li><p>用户访问<a target="_blank" rel="noopener" href="http://www.mybank.com/">www.mybank.com</a> ，登陆并进行网银操作，这时cookie、token等数据信息存放在浏览器中</p>
</li>
<li><p>用户访问<a target="_blank" rel="noopener" href="http://www.abc.com/">www.abc.com</a></p>
</li>
<li><p>这时<a target="_blank" rel="noopener" href="http://www.abc.com/">www.abc.com</a> 网站就可以在拿到银行的cookie或token等，然后发起对<a target="_blank" rel="noopener" href="http://www.mybank.com/">www.mybank.com</a> 的操作</p>
</li>
</ul>
<p>我们在项目中，需要设置对跨域访问的支持，是因为项目的架构需要，例如</p>
<ul>
<li>公司内部有多个不同的子系统，例如A和B，分别部署在不同的服务器上，其域名也不相同</li>
<li>由于公司内部的数据需要，现在A系统中，跨域访问B系统，从而获取内部的一些信息资源</li>
</ul>
<blockquote>
<p>注意，在前后端分离的项目中，前端页面部署在一个服务器上，后端项目部署在另一个服务器上，从前端页面上发送ajax请求到后端系统中，这种情况，就属于跨域访问</p>
</blockquote>
<h2 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h2><p>1、新建项目，springboot-html</p>
<img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20210321230538847.png" alt="image-20210321230538847" style="zoom:50%;" />



<p>2、页面代码：ajax.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>test<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;script src=&quot;https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js&quot;&gt;&lt;/script&gt;--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--不需要写static--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/jquery.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">        $(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;.btn1&quot;</span>).on(<span class="string">&quot;click&quot;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="attr">type</span>: <span class="string">&quot;GET&quot;</span>,</span></span><br><span class="line"><span class="javascript">                    <span class="attr">url</span> : <span class="string">&quot;http://localhost:8989/hi&quot;</span>,</span></span><br><span class="line"><span class="javascript">                    <span class="attr">success</span>: <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                        <span class="built_in">console</span>.log(msg);</span></span><br><span class="line"><span class="javascript">                    &#125;,</span></span><br><span class="line"><span class="javascript">                    <span class="attr">error</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                        alert(<span class="string">&#x27;error&#x27;</span>);</span></span><br><span class="line"><span class="javascript">                    &#125;</span></span><br><span class="line"><span class="javascript">                &#125;);</span></span><br><span class="line"><span class="javascript">            &#125;);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        &#125;);</span></span><br><span class="line"><span class="javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn1&quot;</span>&gt;</span>test1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>3、pom文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>4、配置文件application.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">9999</span></span><br></pre></td></tr></table></figure>

<p>5、Controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.cms.web.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@GetMapping(&quot;/ajax&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;ajax&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>6、运行访问</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20210321231102544.png" alt="image-20210321231102544"></p>
<p><strong>再构建提供接口访问的后端项目</strong></p>
<p>1、新建项目，springboot-cors</p>
<img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20210321231146093.png" alt="image-20210321231146093" style="zoom:67%;" />

<p>2、pom文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>3、配置文件，application.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">8989</span></span><br></pre></td></tr></table></figure>

<p>4、Controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.cms.web.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@GetMapping(&quot;/hi&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>5、启动，访问</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20210321231321782.png" alt="image-20210321231321782"></p>
<p>最后，访问springboot-html项目中的ajax.html页面，点击页面中的按钮，发送ajax请求，访问springbootcors<br>项目中的接口：</p>
<p>当前页面的访问地址： <a target="_blank" rel="noopener" href="http://localhost:9999/ajax">http://localhost:9999/ajax</a><br>点击按钮后请求地址： <a target="_blank" rel="noopener" href="http://localhost:8989/hi">http://localhost:8989/hi</a><br>可以看出，此时这俩个地址，属于“非同源”，本次访问属于跨域访问。</p>
<p>点击后，控制台上输出的错误信息：<br>已拦截跨源请求：同源策略禁止读取位于 <a target="_blank" rel="noopener" href="http://localhost:8989/hi">http://localhost:8989/hi</a> 的远程资源。<br>（原因：CORS 头缺少 ‘Access-Control-Allow-Origin’）。</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20210321232022681.png" alt="image-20210321232022681"></p>
<p>点开网络模块，查看具体的请求信息：<br>请求头中，自动添加了信息 Origin: <a target="_blank" rel="noopener" href="http://localhost:9999/">http://localhost:9999</a> ，通知服务器本次是跨域访问</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20210321232136576.png" alt="image-20210321232136576"></p>
<p>从本次响应的内容中，可以看到，其实响应的内容已经成功返回了，但是由于浏览器的同源政策，把这些结果都给舍弃了。并且执行了Ajax中的回调函数error</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20210321232221184.png" alt="image-20210321232221184"></p>
<h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>避开同源政策给跨域访问带来的限制，方式有很多：</p>
<ol>
<li>nginx</li>
<li>CORS（主要）</li>
<li>JSONP</li>
<li>WebSocket</li>
<li>Node.js</li>
<li>document.domain+iframe</li>
<li>other</li>
</ol>
<p>这里主要说下nginx反向代理和CORS跨域资源共享，这俩种跨域解决方案</p>
<h3 id="3-1-nginx"><a href="#3-1-nginx" class="headerlink" title="3.1 nginx"></a>3.1 nginx</h3><p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20210322064446018.png" alt="image-20210322064446018"></p>
<p>Nginx是一款开源的、高性能的HTTP和反向代理服务器</p>
<ul>
<li>也是一个IMAP/POP3/SMTP代理服务器</li>
<li>由C语言编写，其系统开销、CPU使用效率都很优秀</li>
<li>性能稳定、功能丰富、配置简洁</li>
<li>服务器中没有web容器</li>
</ul>
<p>正向代理，一般需要自己手动进行配置：(<strong>已知代理服务器</strong>)<br>代理服务器和客户端在同一个网络中。</p>
<p>例如，我们访问不了某个网站B，但是能访问某个代理服务器P，这个代理服务器P却可以访问到网络B，<br>那么我就先自己手动配置连上代理服务器P，然后让代理服务器P帮我访问网站B，并把结果返回。</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211005101017166.png" alt="image-20211005101017166"></p>
<p>反向代理，一般是指以代理服务器来接收网络上的请求，然后将请求再转发给内部网络上的其他服务<br>器：<br>代理服务器和Web服务器在同一个网络中。一般不需要用户自己设置服务器，用户甚至感受不到自己访问的是反向代理服务器。</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20210322064703065.png" alt="image-20210322064703065"></p>
<p>例如，Nginx的反向代理功能，解决访问跨域问题，或者实现多个服务器负载均衡的效果。</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20210322064734300.png" alt="image-20210322064734300"></p>
<p>1、修改nginx的配置文件nginx.conf</p>
<p>修改前的配置文件为：</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20210322064805891.png" alt="image-20210322064805891"></p>
<p>修改后的配置文件为：</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20210322064827250.png" alt="image-20210322064827250"></p>
<blockquote>
<p>特别注意，nginx启动的时候，一定不要存放在有中文的路径中，如果启动失败，查看错误的日志记录</p>
</blockquote>
<p>conf.config</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line">#user  nobody;</span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">#error_log  logs/error.log;</span><br><span class="line">#error_log  logs/error.log  notice;</span><br><span class="line">#error_log  logs/error.log  info;</span><br><span class="line"></span><br><span class="line">#pid        logs/nginx.pid;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    #log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">    #                  &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">    #                  &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class="line"></span><br><span class="line">    #access_log  logs/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line">    #keepalive_timeout  0;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    #gzip  on;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  localhost;</span><br><span class="line"></span><br><span class="line">        #charset koi8-r;</span><br><span class="line"></span><br><span class="line">        #access_log  logs/host.access.log  main;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            root   html;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        #error_page  404              /404.html;</span><br><span class="line"></span><br><span class="line">        # redirect server error pages to the static page /50x.html</span><br><span class="line">        #</span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        # proxy the PHP scripts to Apache listening on 127.0.0.1:80</span><br><span class="line">        #</span><br><span class="line">        #location ~ \.php$ &#123;</span><br><span class="line">        #    proxy_pass   http://127.0.0.1;</span><br><span class="line">        #&#125;</span><br><span class="line"></span><br><span class="line">        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span><br><span class="line">        #</span><br><span class="line">        #location ~ \.php$ &#123;</span><br><span class="line">        #    root           html;</span><br><span class="line">        #    fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">        #    fastcgi_index  index.php;</span><br><span class="line">        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span><br><span class="line">        #    include        fastcgi_params;</span><br><span class="line">        #&#125;</span><br><span class="line"></span><br><span class="line">        # deny access to .htaccess files, if Apache&#x27;s document root</span><br><span class="line">        # concurs with nginx&#x27;s one</span><br><span class="line">        #</span><br><span class="line">        #location ~ /\.ht &#123;</span><br><span class="line">        #    deny  all;</span><br><span class="line">        #&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    # another virtual host using mix of IP-, name-, and port-based configuration</span><br><span class="line">    #</span><br><span class="line">    #server &#123;</span><br><span class="line">    #    listen       8000;</span><br><span class="line">    #    listen       somename:8080;</span><br><span class="line">    #    server_name  somename  alias  another.alias;</span><br><span class="line"></span><br><span class="line">    #    location / &#123;</span><br><span class="line">    #        root   html;</span><br><span class="line">    #        index  index.html index.htm;</span><br><span class="line">    #    &#125;</span><br><span class="line">    #&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    # HTTPS server</span><br><span class="line">    #</span><br><span class="line">    #server &#123;</span><br><span class="line">    #    listen       443 ssl;</span><br><span class="line">    #    server_name  localhost;</span><br><span class="line"></span><br><span class="line">    #    ssl_certificate      cert.pem;</span><br><span class="line">    #    ssl_certificate_key  cert.key;</span><br><span class="line"></span><br><span class="line">    #    ssl_session_cache    shared:SSL:1m;</span><br><span class="line">    #    ssl_session_timeout  5m;</span><br><span class="line"></span><br><span class="line">    #    ssl_ciphers  HIGH:!aNULL:!MD5;</span><br><span class="line">    #    ssl_prefer_server_ciphers  on;</span><br><span class="line"></span><br><span class="line">    #    location / &#123;</span><br><span class="line">    #        root   html;</span><br><span class="line">    #        index  index.html index.htm;</span><br><span class="line">    #    &#125;</span><br><span class="line">    #&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>其中：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location /html &#123;</span><br><span class="line">    rewrite ^/html/(.*)$ /$1 break;</span><br><span class="line">    proxy_pass http://localhost:9999/;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>当访问指定地址 <a target="_blank" rel="noopener" href="http://localhost/html">http://localhost/html</a> 的时候，会先重写URI地址</li>
<li>URI符合正则表达式^/api/(.*)$ 的地址会被重写为 /$1</li>
<li>$1表示正则表达式中第一个()中的字符串</li>
<li>最后把重写后的新地址，转发给<a target="_blank" rel="noopener" href="http://localhost:9999/">http://localhost:9999/</a></li>
</ul>
<p>例如，<br>浏览器中访问<a target="_blank" rel="noopener" href="http://localhost/html/ajax">http://localhost/html/ajax</a><br>nginx代理后，先重写地址，将/html/ajax，重写为/ajax<br>然后转发给<a target="_blank" rel="noopener" href="http://localhost:9999/">http://localhost:9999/</a> ，最终访问的是<a target="_blank" rel="noopener" href="http://localhost:9999/ajax">http://localhost:9999/ajax</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location /api &#123;</span><br><span class="line">    rewrite ^/api/(.*)$ /$1 break;</span><br><span class="line">    proxy_pass http://localhost:8989/;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，和上面的描述的含义相同</p>
</blockquote>
<p>2、ajax页面中，新增按钮和ajax请求</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">  $(&quot;.btn2&quot;).on(&quot;click&quot;,function()&#123;</span><br><span class="line">                $.ajax(&#123;</span><br><span class="line">                    type: &quot;GET&quot;,</span><br><span class="line">                    url : &quot;/api/hi&quot;,</span><br><span class="line">                    success: function(msg)&#123;</span><br><span class="line">                        console.log(msg);</span><br><span class="line">                    &#125;,</span><br><span class="line">                    error: function()&#123;</span><br><span class="line">                        alert(&#x27;error&#x27;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn2&quot;</span>&gt;</span>test2<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>3、启动nginx服务器，访问地址</p>
<p><a target="_blank" rel="noopener" href="http://localhost/html/ajax">http://localhost/html/ajax</a></p>
<blockquote>
<p>注意，此时访问springboot-html项目中的页面地址，和之前是不一样的</p>
</blockquote>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20210322074942961.png" alt="image-20210322074942961"></p>
<p>没有使用nginx之前，访问springboot-html中页面的地址： <a target="_blank" rel="noopener" href="http://localhost:9999/ajax">http://localhost:9999/ajax</a></p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20210322070308045.png" alt="image-20210322070308045"></p>
<p>使用nginx之后，访问springboot-html中页面的地址： <a target="_blank" rel="noopener" href="http://localhost/html/ajax">http://localhost/html/ajax</a></p>
<p>4、点击按钮2，发送ajax请求</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20210322075035934.png" alt="image-20210322075035934"></p>
<blockquote>
<p>可以看出，此时ajax请求已经成功了</p>
</blockquote>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20210322075121167.png" alt="image-20210322075121167"></p>
<blockquote>
<p>注意，此时ajax请求的地址为： <a target="_blank" rel="noopener" href="http://localhost/api/hi">http://localhost/api/hi</a></p>
</blockquote>
<blockquote>
<p>可以看出，已完成跨域访问，但其实是使用nginx代理服务器来“欺骗”浏览器，让浏览器认为是 “同源访问”</p>
</blockquote>
<p>如图：</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20210322070521188.png" alt="image-20210322070521188"></p>
<blockquote>
<p>浏览器中，从始至终都是访问<a target="_blank" rel="noopener" href="http://localhost/">http://localhost/</a> 下面的资源，所以浏览器认为一直是“同源访问”</p>
</blockquote>
<blockquote>
<p>浏览器不知道的是，它访问的服务器是一个nginx代理服务器，它会接收浏览器请求，重写URI地址<br>后，转发给真正的服务器。</p>
</blockquote>
<h3 id="3-2-cors"><a href="#3-2-cors" class="headerlink" title="3.2 cors"></a>3.2 cors</h3><h4 id="1、概念"><a href="#1、概念" class="headerlink" title="1、概念"></a>1、概念</h4><p>CORS(Cross-origin resource sharing)，是一个W3C标准，全称是”跨域资源共享”。</p>
<ul>
<li>整个CORS通信过程，都是浏览器自动完成，不需要用户参与。</li>
<li>对于开发者来说，CORS通信与同源的AJAX通信没有差别，代码完全一样。</li>
<li>浏览器一旦发现AJAX请求跨源，就会自动添加一些附加的头信息。（Origin）</li>
<li>有时还会多出一次附加的请求，但用户不会有感觉。（options方式的请求）</li>
</ul>
<h4 id="2、分类"><a href="#2、分类" class="headerlink" title="2、分类"></a>2、分类</h4><p>浏览器将CORS请求分成两类：</p>
<ul>
<li>简单请求（simple request）</li>
<li>非简单请求（not-so-simple request）</li>
</ul>
<p>只要同时满足以下两大条件，就属于简单请求：</p>
<p>请求方法是以下三种方法之一<br>    GET<br>    POST<br>    HEAD<br>HTTP的头信息不超出以下几种字段<br>    Accept<br>    Accept-Language</p>
<p>​    Content-Language<br>​    Last-Event-ID<br>​    Content-Type，该字段的值只能是以下三种</p>
<p>​        application/x-www-form-urlencoded</p>
<p>​        multipart/form-data<br>​        text/plain</p>
<blockquote>
<p>注意，只要不能同时满足上面两个条件，就属于非简单请求。</p>
</blockquote>
<h4 id="3、简单请求"><a href="#3、简单请求" class="headerlink" title="3、简单请求"></a>3、简单请求</h4><p>对于简单请求，浏览器直接发出CORS请求，同时在请求头中增加一个Origin字段。<br>该字段表示，本次请求来自哪个源（协议 + 域名 + 端口），服务器根据这个值，决定是否同意这次请<br>求。</p>
<p>Origin指定的源，即使不在服务器许可范围内，服务器还是会返回一个正常的HTTP响应，但是响应头中<br>不含指定Access-Control-Allow-Origin字段，浏览器这时候就知道本次跨域访问失败。<br>但是这个时候，响应状态可能是200，同时在一些工具中还能看到正确的返回值。<br>例如，</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20210322070848847.png" alt="image-20210322070848847"></p>
<p>其中，</p>
<ol>
<li>浏览器在请求头中自动添加了Origin 字段</li>
<li>服务器在响应中没有添加Access-Control-Allow-Origin 字段（说明服务器不支持此请求跨域访<br>问）</li>
<li>响应的状态码是200，并且从响应内容中可以看到正确的返回内容</li>
<li>同时，浏览器会抛出一个错误，被ajax的核心对象XMLHttpRequest的onerror 回调函数捕获</li>
</ol>
<p>如果Origin指定的域名在服务器的许可范围内，服务器返回的响应，会多出几个头信息字段：</p>
<ol>
<li><p>Access-Control-Allow-Origin<br>该字段是必须的。<br>它的值要么是请求时Origin字段的值，要么是一个*，表示接受任意域名的跨域请求。</p>
</li>
<li><p>Access-Control-Allow-Credentials</p>
<p>该字段可选<br>表示是否允许发送Cookie。<br>设为true，即表示服务器已经允许了，跨域请求中可以携带Cookie。<br>但是这需要AJAX中设置withCredentials=true进行配合。<br>如果服务器不要浏览器发送Cookie，删除该字段即可。</p>
</li>
</ol>
<p><code>3. Access-Control-Expose-Headers</code></p>
<p>​    该字段可选<br>​    列出了哪些首部可以作为响应的一部分暴露给外部。<br>​    默认情况下，只有七种可以暴露给外部<br>​    Cache-Control<br>​    Content-Language<br>​    Content-Length<br>​    Content-Type<br>​    Expires<br>​    Last-Modified<br>​    Pragma</p>
<p>​    如果想要让客户端可以访问到其他的首部信息，可以将它们在Access-Control-Expose-Headers里面指定</p>
<h4 id="4、非简单请求"><a href="#4、非简单请求" class="headerlink" title="4、非简单请求"></a>4、非简单请求</h4><p>非简单请求是那种对服务器有特殊要求的请求，比如请求方法是PUT或DELETE，或者Content-Type字段的类型是application/json。<br>非简单请求的CORS请求，会在正式通信之前，增加一次HTTP查询请求，称为”预检”请求（preflight）。<br>浏览器先询问服务器，当前网页所在的域名是否在服务器的许可名单之中，以及可以使用哪些HTTP动词<br>和头信息字段。只有得到肯定答复，浏览器才会发出正式的XMLHttpRequest请求，否则就报错。</p>
<p>例如，</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;.btn1&quot;</span>).on(<span class="string">&quot;click&quot;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">$.ajax(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">        <span class="attr">url</span> : <span class="string">&quot;http://localhost:8989/hi&quot;</span>,</span><br><span class="line">        <span class="attr">contentType</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">        <span class="attr">success</span>: <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(msg);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">error</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        alert(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，在请求头中，指定contentType为application/json</p>
</blockquote>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20210322071208502.png" alt="image-20210322071208502"></p>
<blockquote>
<p>可以看出，请求头中有Content-Type:application/json 字段，属于非简单请求，浏览器会提前发送一个option方式的“预检请求”(预检请求会缓存)</p>
</blockquote>
<p>在这个“预检请求”的响应中，服务器会返回一些数据来通知浏览器，服务器对跨域请求的要求</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20210322071259213.png" alt="image-20210322071259213"></p>
<p>如果浏览器否定了“预检”请求，也会返回一个正常的HTTP回应，但是没有任何CORS相关的头信息字段。<br>这时，浏览器就会认定，服务器不同意预检请求，因此触发一个错误，被XMLHttpRequest对象的onerror<br>回调函数捕获。</p>
<blockquote>
<p>测试简单请求和非简单请求</p>
</blockquote>
<p>==“预检”成功的常见响应头部字段有：==</p>
<ul>
<li>Access-Control-Allow-Origin 配置ip</li>
<li>Access-Control-Allow-Methods 配置请求方式</li>
<li>Access-Control-Allow-Headers 配置请求头</li>
<li>Access-Control-Allow-Credentials 配置是否信任cookie<br>标签允许客户端携带验证信息，例如 cookie<pre><code>Access-Control-Max-Age
表示预检请求的返回结果（即Access-Control-Allow-Methods 和Access-Control-Allow-Headers提供的信息） 可以被缓存多久。
</code></pre>
</li>
</ul>
<p>注意，ajax跨域访问的时候，如果需要在请求中携带cookie，需要有以下设置</p>
<ol>
<li><p>前端ajax请求中，指定withCredentials属性为ture</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$.ajax(&#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">    <span class="attr">url</span> : <span class="string">&quot;http://localhost:8989/hi&quot;</span>,</span><br><span class="line">    <span class="attr">xhrFields</span>:&#123;</span><br><span class="line">   		 <span class="attr">withCredentials</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">success</span>: <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(msg);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">error</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    alert(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
<li><p>后端响应头中，设置Access-Control-Allow-Credentials属性为true</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//允许跨域携带cookie</span></span><br><span class="line">response.setHeader(<span class="string">&quot;Access-Control-Allow-Credentials&quot;</span>, <span class="string">&quot;true&quot;</span>);</span><br></pre></td></tr></table></figure></li>
</ol>
<ol start="3">
<li>后端响应头中，设置Access-Control-Allow-Origin属性为具体的值，而不是能通配符*</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//response.setHeader(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;);</span></span><br><span class="line">response.setHeader(<span class="string">&quot;Access-Control-Allow-Origin&quot;</span>, <span class="string">&quot;http://127.0.0.1:9999&quot;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 允许cookie的情况下 前端配置 后台配置</span></span><br><span class="line">	<span class="meta">@GetMapping(&quot;/hi&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">(HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">		response.setHeader(<span class="string">&quot;Access-Control-Allow-Credentials&quot;</span>, <span class="string">&quot;true&quot;</span>);</span><br><span class="line">		response.setHeader(<span class="string">&quot;Access-Control-Allow-Origin&quot;</span>, <span class="string">&quot;http://localhost:9999&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">   <span class="comment">// 不允许cookie的情况下</span></span><br><span class="line">   <span class="meta">@GetMapping(&quot;/hi&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">(HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">		response.setHeader(<span class="string">&quot;Access-Control-Allow-Origin&quot;</span>, <span class="string">&quot;*&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>前端访问 <a target="_blank" rel="noopener" href="http://localhost:9999/ajax">http://localhost:9999/ajax</a> 后台就配 localhost</p>
<p>此时无法处理预检查请求</p>
</blockquote>
<h4 id="5、使用"><a href="#5、使用" class="headerlink" title="5、使用"></a>5、使用</h4><p>springboot-html项目中的ajax.html页面：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>test<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;script src=&quot;https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js&quot;&gt;&lt;/script&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/jquery.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">        $(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;.btn1&quot;</span>).on(<span class="string">&quot;click&quot;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="attr">type</span>: <span class="string">&quot;GET&quot;</span>,</span></span><br><span class="line"><span class="javascript">                    <span class="attr">url</span> : <span class="string">&quot;http://localhost:8989/hi&quot;</span>,</span></span><br><span class="line"><span class="javascript">                    <span class="attr">success</span>: <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                        <span class="built_in">console</span>.log(msg);</span></span><br><span class="line"><span class="javascript">                    &#125;,</span></span><br><span class="line"><span class="javascript">                    <span class="attr">error</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                        alert(<span class="string">&#x27;error&#x27;</span>);</span></span><br><span class="line"><span class="javascript">                    &#125;</span></span><br><span class="line"><span class="javascript">                &#125;);</span></span><br><span class="line"><span class="javascript">            &#125;);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;.btn2&quot;</span>).on(<span class="string">&quot;click&quot;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="attr">type</span>: <span class="string">&quot;GET&quot;</span>,</span></span><br><span class="line"><span class="javascript">                    <span class="attr">url</span> : <span class="string">&quot;/api/hi&quot;</span>,</span></span><br><span class="line"><span class="javascript">                    <span class="attr">success</span>: <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                        <span class="built_in">console</span>.log(msg);</span></span><br><span class="line"><span class="javascript">                    &#125;,</span></span><br><span class="line"><span class="javascript">                    <span class="attr">error</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                        alert(<span class="string">&#x27;error&#x27;</span>);</span></span><br><span class="line"><span class="javascript">                    &#125;</span></span><br><span class="line"><span class="javascript">                &#125;);</span></span><br><span class="line"><span class="javascript">            &#125;);</span></span><br><span class="line"><span class="javascript">            </span></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;.btn3&quot;</span>).on(<span class="string">&quot;click&quot;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="attr">type</span>: <span class="string">&quot;GET&quot;</span>,</span></span><br><span class="line"><span class="javascript">                    <span class="attr">url</span> : <span class="string">&quot;http://localhost:8989/hi&quot;</span>,</span></span><br><span class="line"><span class="javascript">                    <span class="attr">success</span>: <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                        <span class="built_in">console</span>.log(msg);</span></span><br><span class="line"><span class="javascript">                    &#125;,</span></span><br><span class="line"><span class="javascript">                    <span class="attr">error</span>: <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                        alert(<span class="string">&#x27;error&#x27;</span>);</span></span><br><span class="line"><span class="javascript">                    &#125;</span></span><br><span class="line"><span class="javascript">                &#125;);</span></span><br><span class="line"><span class="javascript">            &#125;);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        &#125;);</span></span><br><span class="line"><span class="javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn1&quot;</span>&gt;</span>test1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn2&quot;</span>&gt;</span>test2<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn3&quot;</span>&gt;</span>test3<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这里主要测试的是test3按钮</p>
</blockquote>
<p>springboot-cors项目中的Controller：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.cms.web.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@GetMapping(&quot;/hi&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>springboot-cors项目中的配置类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.cms.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.CorsRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addMapping(<span class="string">&quot;/**&quot;</span>)<span class="comment">//映射所有路径</span></span><br><span class="line">        .allowedOrigins(<span class="string">&quot;*&quot;</span>)<span class="comment">//运行所有客户端访问</span></span><br><span class="line">        .allowCredentials(<span class="keyword">false</span>)<span class="comment">//不允许携带cookie</span></span><br><span class="line">        .allowedMethods(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>, <span class="string">&quot;PUT&quot;</span>, <span class="string">&quot;DELETE&quot;</span>, <span class="string">&quot;OPTIONS&quot;</span>)<span class="comment">//</span></span><br><span class="line">        支持的方法</span><br><span class="line">        .allowedHeaders(<span class="string">&quot;*&quot;</span>)<span class="comment">//运行所有请求头字段</span></span><br><span class="line">        .maxAge(<span class="number">3600</span>);<span class="comment">//允许客户端缓存“预检请求”中获取的信息，3600秒</span></span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这里主要配置了跨域访问的属性</p>
</blockquote>
<p>启动俩个项目，访问页面，点击按钮，测试ajax跨域访问：</p>
<blockquote>
<p>可以看出，此时ajax请求进行跨域访问，已经成功</p>
</blockquote>
<blockquote>
<p>注意，此时可以尝试在ajax请求中，设置contentType: application/json ,观察是否会发出“预检”请求</p>
</blockquote>
<p>同时，也可以修改ajax请求，让其写的cookie和指定字段的头部：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;.btn3&quot;</span>).on(<span class="string">&quot;click&quot;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">        <span class="attr">url</span> : <span class="string">&quot;http://localhost:8989/hi&quot;</span>,</span><br><span class="line">        <span class="attr">xhrFields</span>:&#123;</span><br><span class="line">        <span class="attr">withCredentials</span>: <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">headers</span>:&#123;</span><br><span class="line">        <span class="attr">token</span>:<span class="string">&quot;aaa.bbb.ccc&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">contentType</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">        <span class="attr">success</span>: <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(msg);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">error</span>: <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;</span><br><span class="line">        alert(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>此时，对应的后端跨域设置为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addMapping(<span class="string">&quot;/**&quot;</span>)</span><br><span class="line">        .allowedOrigins(<span class="string">&quot;http://localhost:9999&quot;</span>)</span><br><span class="line">        .allowCredentials(<span class="keyword">true</span>)</span><br><span class="line">        .allowedMethods(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>, <span class="string">&quot;PUT&quot;</span>, <span class="string">&quot;DELETE&quot;</span>, <span class="string">&quot;OPTIONS&quot;</span>)</span><br><span class="line">        .allowedHeaders(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">        .maxAge(<span class="number">3600</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="6、其他"><a href="#6、其他" class="headerlink" title="6、其他"></a>6、其他</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> </span>&#123;</span><br><span class="line">    registry.addMapping(<span class="string">&quot;/**&quot;</span>)<span class="comment">//映射所有路径</span></span><br><span class="line">    .allowedOrigins(<span class="string">&quot;*&quot;</span>)<span class="comment">//运行所有客户端访问</span></span><br><span class="line">    .allowCredentials(<span class="keyword">false</span>)<span class="comment">//不允许携带cookie</span></span><br><span class="line">    .allowedMethods(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>, <span class="string">&quot;PUT&quot;</span>, <span class="string">&quot;DELETE&quot;</span>, <span class="string">&quot;OPTIONS&quot;</span>)<span class="comment">//支持的方法</span></span><br><span class="line">    .allowedHeaders(<span class="string">&quot;*&quot;</span>)<span class="comment">//运行所有请求头字段</span></span><br><span class="line">    .maxAge(<span class="number">3600</span>);<span class="comment">//允许客户端缓存“预检请求”中获取的信息，3600秒</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在此配置中，如果设置allowCredentials(true) ，那么allowedOrigins(“*”) 这里就不能使用通<br>配符了，必须要写一个或者多个（可变参数）客户端的地址<br>例如， allowedOrigins(“<a href="http://127.0.0.1:9999&quot;">http://127.0.0.1:9999&quot;</a>)</p>
<p>另外，如果只是想让Controller中的某一个方法或者几个方法被跨域访问，那么可以在方法上使用<br>@CrossOrigin 注解，例如</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@CrossOrigin(origins = &#123;&quot;http://127.0.0.1:9999&quot;&#125;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/hi&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，此时就不需要在配置类中做其他配置了，直接一个注解就可以让该方法被跨域访问了</p>
</blockquote>
<h1 id="角色模块"><a href="#角色模块" class="headerlink" title="角色模块"></a>角色模块</h1><h2 id="接口-1"><a href="#接口-1" class="headerlink" title="接口"></a>接口</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">RoleService</span> </span>&#123;</span><br><span class="line">    <span class="comment">//获取所有角色信息</span></span><br><span class="line">    <span class="function">List&lt;Role&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//新增角色信息</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">save</span><span class="params">(Role role)</span></span>;</span><br><span class="line">    <span class="comment">// 删除角色信息</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">delete</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="添加"><a href="#添加" class="headerlink" title="添加"></a>添加</h2><h3 id="mapper-2"><a href="#mapper-2" class="headerlink" title="mapper"></a>mapper</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findByName&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.briup.cms.entity.Role&quot;</span>&gt;</span></span><br><span class="line">    select <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;com.briup.cms.mapper.RoleMapper.Base_Column_List&quot;</span>/&gt;</span></span><br><span class="line">    from cms_role</span><br><span class="line">    where name = #&#123;name&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="service-8"><a href="#service-8" class="headerlink" title="service"></a>service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Role role)</span> </span>&#123;</span><br><span class="line">       String name = role.getName();</span><br><span class="line">       <span class="keyword">if</span> (!StringUtils.hasText(name)) &#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> CustomerException(ResultCode.PARAM_IS_BLANK);</span><br><span class="line">       &#125;</span><br><span class="line">	Role roleFromDB = roleExtendMapper.findByName(name);</span><br><span class="line">       <span class="keyword">if</span>(roleFromDB != <span class="keyword">null</span>)&#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> CustomerException(ResultCode.DATA_EXISTED);</span><br><span class="line">	&#125;</span><br><span class="line">       roleMapper.insertSelective(role);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<h3 id="controller-8"><a href="#controller-8" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line">	<span class="meta">@ApiOperation(value = &quot;添加角色&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Result <span class="title">save</span><span class="params">(<span class="meta">@RequestBody</span> Role role)</span> </span>&#123;</span><br><span class="line">		roleService.save(role);</span><br><span class="line">		<span class="keyword">return</span> Result.success();</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>



<h2 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h2><h3 id="mapper-3"><a href="#mapper-3" class="headerlink" title="mapper"></a>mapper</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.briup.cms.entity.Role&quot;</span>&gt;</span></span><br><span class="line">        select <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;com.briup.cms.mapper.RoleMapper.Base_Column_List&quot;</span>/&gt;</span></span><br><span class="line">        from cms_role</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="service-9"><a href="#service-9" class="headerlink" title="service"></a>service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> List&lt;Role&gt; <span class="title">findAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> roleExtendMapper.findAll();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<h3 id="controller-9"><a href="#controller-9" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;findAll&quot;)</span></span><br><span class="line">	<span class="meta">@ApiOperation(value = &quot;查询所有&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Result <span class="title">findAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> Result.success(roleService.findAll());</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>



<h2 id="删除-1"><a href="#删除-1" class="headerlink" title="删除"></a>删除</h2><h3 id="service-10"><a href="#service-10" class="headerlink" title="service"></a>service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        roleMapper.deleteByPrimaryKey(id);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="controller-10"><a href="#controller-10" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping(&quot;delete/&#123;id&#125;&quot;)</span></span><br><span class="line">	<span class="meta">@ApiOperation(value = &quot;删除角色&quot;)</span></span><br><span class="line">	<span class="meta">@ApiImplicitParams(&#123;</span></span><br><span class="line"><span class="meta">			@ApiImplicitParam(name = &quot;id&quot;, value = &quot;角色id&quot;, required = true, dataType = &quot;int&quot;, paramType = &quot;path&quot;)</span></span><br><span class="line"><span class="meta">	&#125;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Result <span class="title">delete</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span> </span>&#123;</span><br><span class="line">		roleService.delete(id);</span><br><span class="line">		<span class="keyword">return</span> Result.success();</span><br><span class="line">	&#125;	</span><br></pre></td></tr></table></figure>

<blockquote>
<p>删除看上去没有任何问题 此时有角色了,回头来看用户模块</p>
</blockquote>
<h2 id="用户新增"><a href="#用户新增" class="headerlink" title="==用户新增=="></a>==用户新增==</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;birthday&quot;</span>: <span class="string">&quot;2000-01-01 00:00:00&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;gender&quot;</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;image&quot;</span>: <span class="string">&quot;string&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;password&quot;</span>: <span class="string">&quot;briup&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;phone&quot;</span>: <span class="number">13500000000</span>,</span><br><span class="line">  <span class="attr">&quot;realName&quot;</span>: <span class="string">&quot;briup&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;roleId&quot;</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">&quot;username&quot;</span>: <span class="string">&quot;briup&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="用户查询"><a href="#用户查询" class="headerlink" title="==用户查询=="></a>==用户查询==</h2><h3 id="entity"><a href="#entity" class="headerlink" title="entity"></a>entity</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserExtend</span> <span class="keyword">extends</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Role role;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="mapper-4"><a href="#mapper-4" class="headerlink" title="mapper"></a>mapper</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;userWithRole&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">extends</span>=<span class="string">&quot;com.briup.cms.mapper.UserMapper.BaseResultMap&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">type</span>=<span class="string">&quot;com.briup.cms.entity.extend.UserExtend&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;role&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.briup.cms.entity.Role&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">select</span>=<span class="string">&quot;com.briup.cms.mapper.RoleMapper.selectByPrimaryKey&quot;</span> <span class="attr">column</span>=<span class="string">&quot;role_id&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getAll&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;userWithRole&quot;</span>&gt;</span></span><br><span class="line">        select <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;com.briup.cms.mapper.UserMapper.Base_Column_List&quot;</span>/&gt;</span></span><br><span class="line">        from cms_user</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="service-11"><a href="#service-11" class="headerlink" title="service"></a>service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> PageUtil&lt;UserExtend&gt; <span class="title">getAll</span><span class="params">(PageUtil&lt;UserExtend&gt; pageUtil)</span> </span>&#123;</span><br><span class="line">       PageHelper.startPage(pageUtil.getPageNumber(),pageUtil.getPageSize());</span><br><span class="line">       Map&lt;String, Object&gt; params = pageUtil.getParams();</span><br><span class="line">       <span class="comment">//params.put(&quot;gender&quot;,0);</span></span><br><span class="line">       Page all = userExtendMapper.getAll(params);</span><br><span class="line">       pageUtil.setList(all.getResult());</span><br><span class="line">       pageUtil.setTotal(all.getTotal());</span><br><span class="line">       <span class="keyword">return</span> pageUtil;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>重新测试</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;code&quot;</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">&quot;msg&quot;</span>: <span class="string">&quot;操作成功&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;data&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;pageNumber&quot;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">&quot;pageSize&quot;</span>: <span class="number">5</span>,</span><br><span class="line">    <span class="attr">&quot;total&quot;</span>: <span class="number">6</span>,</span><br><span class="line">    <span class="attr">&quot;list&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;id&quot;</span>: <span class="number">21</span>,</span><br><span class="line">        <span class="attr">&quot;birthday&quot;</span>: <span class="string">&quot;2000-01-01 00:00:00&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;gender&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">&quot;image&quot;</span>: <span class="string">&quot;string&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;password&quot;</span>: <span class="string">&quot;briup&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;phone&quot;</span>: <span class="string">&quot;13500000000&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;realName&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;registerTime&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;status&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">&quot;username&quot;</span>: <span class="string">&quot;briup&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;roleId&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;role&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">          <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;管理员&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;admin&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;params&quot;</span>: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="级联删除"><a href="#级联删除" class="headerlink" title="==级联删除=="></a>==级联删除==</h2><blockquote>
<p>如果用户有角色外键关联的情况下,角色无法删除  (外键约束)</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Caused by: com.mysql.jdbc.exceptions.jdbc4.MySQLIntegrityConstraintViolationException: Cannot delete or update a parent row: a foreign key constraint fails (`cms_jd2017`.`cms_user`, CONSTRAINT `FKpgvo8dl2imh6ags819okkslx9` FOREIGN KEY (`role_id`) REFERENCES `cms_role` (`id`))</span><br><span class="line">	at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)</span><br><span class="line">	at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)</span><br><span class="line">	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)</span><br><span class="line">	at java.lang.reflect.Constructor.newInstance(Constructor.java:423)</span><br></pre></td></tr></table></figure>



<ul>
<li>级联删除用户(慎用)</li>
<li>删除外键置空 (将来可以给用户重新分配角色)</li>
</ul>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211213223030967.png" alt="image-20211213223030967"></p>
<h1 id="分类模块"><a href="#分类模块" class="headerlink" title="分类模块"></a>分类模块</h1><h2 id="接口-2"><a href="#接口-2" class="headerlink" title="接口"></a>接口</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.cms.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.cms.entity.Category;</span><br><span class="line"><span class="keyword">import</span> com.briup.cms.utils.PageUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CategoryService</span> </span>&#123;</span><br><span class="line">	<span class="comment">//分页获取所有分类 并按序号升序</span></span><br><span class="line">	<span class="function">PageUtil&lt;Category&gt; <span class="title">findAll</span><span class="params">(PageUtil&lt;Category&gt; pageUtil)</span></span>;</span><br><span class="line">	<span class="comment">//新增分类或者更新分类</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">saveCategory</span><span class="params">(Category category)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">updateCategory</span><span class="params">(Category category)</span></span>;</span><br><span class="line">	<span class="comment">//批量删除分类</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">deleteCategoryInBatch</span><span class="params">(List&lt;Integer&gt; ids)</span></span>;</span><br><span class="line">	<span class="comment">//更新分类序号</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">updateCategoryNo</span><span class="params">(Integer id, Integer no)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="查询所有"><a href="#查询所有" class="headerlink" title="查询所有"></a>查询所有</h2><blockquote>
<p>含排序 分页 所在父目录</p>
</blockquote>
<h3 id="mapper-5"><a href="#mapper-5" class="headerlink" title="mapper"></a>mapper</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.briup.cms.mapper.extend.CategoryExtendMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;categoryWithParent&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.briup.cms.entity.extend.CategoryExtend&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">extends</span>=<span class="string">&quot;com.briup.cms.mapper.CategoryMapper.BaseResultMap&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;category&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">javaType</span>=<span class="string">&quot;com.briup.cms.entity.Category&quot;</span> <span class="attr">column</span>=<span class="string">&quot;parent_id&quot;</span> <span class="attr">select</span>=<span class="string">&quot;com.briup.cms.mapper.CategoryMapper.selectByPrimaryKey&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;categoryWithParent&quot;</span>&gt;</span></span><br><span class="line">        select <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;com.briup.cms.mapper.CategoryMapper.Base_Column_List&quot;</span>/&gt;</span></span><br><span class="line">        from cms_category</span><br><span class="line">        order by no desc</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="service-12"><a href="#service-12" class="headerlink" title="service"></a>service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> PageUtil&lt;Category&gt; <span class="title">findAll</span><span class="params">(PageUtil&lt;Category&gt; pageUtil)</span> </span>&#123;</span><br><span class="line">		PageHelper.startPage(pageUtil.getPageNumber(),pageUtil.getPageSize());</span><br><span class="line">		Page&lt;Category&gt; all = categoryExtendMapper.findAll(pageUtil.getParams());</span><br><span class="line">		pageUtil.setList(all.getResult());</span><br><span class="line">		pageUtil.setTotal(all.getTotal());</span><br><span class="line">		<span class="keyword">return</span> pageUtil;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h3 id="controller-11"><a href="#controller-11" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;查询目录&quot;,notes = &quot;分页并且顺序查询&quot; )</span></span><br><span class="line">	<span class="meta">@PostMapping(&quot;/findAll&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Result <span class="title">findAllSortbyno</span><span class="params">(<span class="meta">@RequestBody</span> PageUtil&lt;Category&gt; pageUtil)</span> </span>&#123;</span><br><span class="line">		PageUtil&lt;Category&gt; page = categoryService.findAll(pageUtil);</span><br><span class="line">		<span class="keyword">return</span> Result.success(page);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h2 id="查询父目录"><a href="#查询父目录" class="headerlink" title="查询父目录"></a>查询父目录</h2><blockquote>
<p>补充: 添加分类之前要查询一级目录提供选择</p>
</blockquote>
<h3 id="mapper-6"><a href="#mapper-6" class="headerlink" title="mapper"></a>mapper</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;parentCategory&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;com.briup.cms.mapper.CategoryMapper.BaseResultMap&quot;</span>&gt;</span></span><br><span class="line">       select <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;com.briup.cms.mapper.CategoryMapper.Base_Column_List&quot;</span>/&gt;</span></span><br><span class="line">       from cms_category</span><br><span class="line">       where parent_id = 0</span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="service-13"><a href="#service-13" class="headerlink" title="service"></a>service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Category&gt; <span class="title">findParentCategory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> categoryExtendMapper.parentCategory();</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h3 id="controller-12"><a href="#controller-12" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;查询父目录&quot;)</span></span><br><span class="line">	<span class="meta">@GetMapping(&quot;/findParentCategory&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Result <span class="title">findParentCategory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		List&lt;Category&gt; parentCategory= categoryService.findParentCategory();</span><br><span class="line">		<span class="keyword">return</span> Result.success(parentCategory);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>



<h2 id="新增目录"><a href="#新增目录" class="headerlink" title="新增目录"></a>新增目录</h2><h3 id="mapper-7"><a href="#mapper-7" class="headerlink" title="mapper"></a>mapper</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findByName&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.briup.cms.entity.Category&quot;</span>&gt;</span></span><br><span class="line">        select <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;com.briup.cms.mapper.CategoryMapper.Base_Column_List&quot;</span>/&gt;</span></span><br><span class="line">        from cms_category</span><br><span class="line">        where name = #&#123;name&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="service-14"><a href="#service-14" class="headerlink" title="service"></a>service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveCategory</span><span class="params">(Category category)</span> </span>&#123;</span><br><span class="line">		String name = category.getName();</span><br><span class="line">		<span class="keyword">if</span>(!StringUtils.hasText(name))&#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> CustomerException(ResultCode.PARAM_IS_BLANK);</span><br><span class="line">		&#125;</span><br><span class="line">		Category categoryFromDB = categoryExtendMapper.findByName(name);</span><br><span class="line">		<span class="keyword">if</span>(categoryFromDB != <span class="keyword">null</span>)&#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> CustomerException(ResultCode.DATA_EXISTED);</span><br><span class="line">		&#125;</span><br><span class="line">		category.setNo(<span class="number">0</span>);</span><br><span class="line">		<span class="keyword">if</span>(category.getParentId() == <span class="keyword">null</span>)&#123;</span><br><span class="line">			category.setParentId(<span class="number">0</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		categoryMapper.insertSelective(category);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h3 id="controller-13"><a href="#controller-13" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;新增&quot;,notes = &quot;json格式&quot;)</span></span><br><span class="line">	<span class="meta">@PostMapping(&quot;/save&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Result <span class="title">saveCategory</span><span class="params">(<span class="meta">@RequestBody</span> Category category)</span> </span>&#123;</span><br><span class="line">		categoryService.saveCategory(category);</span><br><span class="line">		<span class="keyword">return</span> Result.success();</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>





<h2 id="更新目录"><a href="#更新目录" class="headerlink" title="更新目录"></a>更新目录</h2><h3 id="service-15"><a href="#service-15" class="headerlink" title="service"></a>service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateCategory</span><span class="params">(Category category)</span> </span>&#123;</span><br><span class="line">		categoryMapper.updateByPrimaryKeySelective(category);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h3 id="controller-14"><a href="#controller-14" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;更新&quot;,notes = &quot;json格式&quot;)</span></span><br><span class="line">	<span class="meta">@PutMapping(&quot;/update&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Result <span class="title">updateCategory</span><span class="params">(<span class="meta">@RequestBody</span> Category category)</span> </span>&#123;</span><br><span class="line">		categoryService.updateCategory(category);</span><br><span class="line">		<span class="keyword">return</span> Result.success();</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>



<h2 id="更新分类排序"><a href="#更新分类排序" class="headerlink" title="更新分类排序"></a>更新分类排序</h2><h3 id="service-16"><a href="#service-16" class="headerlink" title="service"></a>service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateCategoryNo</span><span class="params">(Integer id, Integer no)</span> </span>&#123;</span><br><span class="line">		Category category = <span class="keyword">new</span> Category();</span><br><span class="line">		category.setId(id);</span><br><span class="line">		category.setNo(no);</span><br><span class="line">		categoryMapper.updateByPrimaryKeySelective(category);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>



<h3 id="controller-15"><a href="#controller-15" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;更新分类排序&quot;,notes = &quot;改变排序字段&quot;)</span></span><br><span class="line">	<span class="meta">@PutMapping(&quot;/update/&#123;id&#125;/&#123;no&#125;&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Result <span class="title">updateCategoryNo</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">			<span class="meta">@ApiParam(name = &quot;id&quot;,value = &quot;分类id&quot;,required = true)</span> <span class="meta">@PathVariable(&quot;id&quot;)</span> <span class="keyword">int</span> id,</span></span></span><br><span class="line"><span class="params"><span class="function">			<span class="meta">@ApiParam(name = &quot;no&quot;,value = &quot;排序字段&quot;,required = true)</span>  <span class="meta">@PathVariable(&quot;no&quot;)</span> <span class="keyword">int</span> no)</span> </span>&#123;</span><br><span class="line">		categoryService.updateCategoryNo(id, no);</span><br><span class="line">		<span class="keyword">return</span> Result.success();</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>



<h2 id="删除目录"><a href="#删除目录" class="headerlink" title="删除目录"></a>删除目录</h2><h3 id="mapper-8"><a href="#mapper-8" class="headerlink" title="mapper"></a>mapper</h3><p>CategoryExtendMapper</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findByParentId&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.briup.cms.entity.Category&quot;</span>&gt;</span></span><br><span class="line">        select <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;com.briup.cms.mapper.CategoryMapper.Base_Column_List&quot;</span>/&gt;</span></span><br><span class="line">        from cms_category</span><br><span class="line">        where parent_id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ArticleExtendMapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span><br><span class="line">&lt;mapper namespace=<span class="string">&quot;com.briup.cms.mapper.extend.ArticleExtendMapper&quot;</span>&gt;</span><br><span class="line">    &lt;select id=<span class="string">&quot;findByCategoryId&quot;</span> resultType=<span class="string">&quot;com.briup.cms.entity.Article&quot;</span>&gt;</span><br><span class="line">        select &lt;include refid=<span class="string">&quot;com.briup.cms.mapper.ArticleMapper.Base_Column_List&quot;</span>/&gt;</span><br><span class="line">        from cms_article</span><br><span class="line">        where category_id = #&#123;id&#125;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure>



<h3 id="service-17"><a href="#service-17" class="headerlink" title="service"></a>service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteCategoryInBatch</span><span class="params">(List&lt;Integer&gt; ids)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">for</span> (Integer id : ids)&#123;</span><br><span class="line">			<span class="comment">// 看该目录是否被引用</span></span><br><span class="line">				<span class="comment">// select * from cms_category where parent_id = id</span></span><br><span class="line">			<span class="comment">// 是不是父目录</span></span><br><span class="line">			List&lt;Category&gt; categoryChildren = categoryExtendMapper.findByParentId(id);</span><br><span class="line">			<span class="keyword">if</span>(!CollectionUtils.isEmpty(categoryChildren))&#123;</span><br><span class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> CustomerException(ResultCode.DATA_USEING);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">// 目录下是不是有文章</span></span><br><span class="line">			List&lt;Article&gt; articleList = articleExtendMapper.findByCategoryId(id);</span><br><span class="line">			<span class="keyword">if</span>(!CollectionUtils.isEmpty(articleList))&#123;</span><br><span class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> CustomerException(ResultCode.DATA_USEING);</span><br><span class="line">			&#125;</span><br><span class="line">			categoryMapper.deleteByPrimaryKey(id);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>



<h3 id="controller-16"><a href="#controller-16" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;删除目录&quot;,notes = &quot;提供多个id,批量删除&quot;)</span></span><br><span class="line">	<span class="meta">@DeleteMapping(&quot;/deleteBatch&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Result <span class="title">deleteCategoryInBatch</span><span class="params">(<span class="meta">@ApiParam(&quot;id列表&quot;)</span><span class="meta">@RequestBody</span> List&lt;Integer&gt;ids)</span> </span>&#123;</span><br><span class="line">		categoryService.deleteCategoryInBatch(ids);</span><br><span class="line">		<span class="keyword">return</span> Result.success();</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>





<h1 id="文章模块"><a href="#文章模块" class="headerlink" title="文章模块"></a>文章模块</h1><h2 id="接口-3"><a href="#接口-3" class="headerlink" title="接口"></a>接口</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ArticleService</span> </span>&#123;</span><br><span class="line">	<span class="comment">//发布资讯或者编辑资讯</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">saveOrUpdateArticle</span><span class="params">(Article article)</span><span class="keyword">throws</span> ServiceException</span>;</span><br><span class="line">	<span class="comment">//分页获取所有资讯</span></span><br><span class="line">	<span class="comment">//pageNum:页码，pageSize：一页显示多少条数据</span></span><br><span class="line">	<span class="function">Page&lt;Article&gt; <span class="title">findAll</span><span class="params">(Integer pageNum,Integer pageSize)</span><span class="keyword">throws</span> ServiceException</span>;</span><br><span class="line">	<span class="comment">//批量删除资讯</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">deleteArticleInBatch</span><span class="params">(List&lt;Integer&gt; ids)</span><span class="keyword">throws</span> ServiceException</span>;</span><br><span class="line">	<span class="comment">//管理员审核资讯</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">updateArticleStatus</span><span class="params">(Integer id,String status)</span><span class="keyword">throws</span> ServiceException</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 查询分类下的文章</span></span><br><span class="line">	<span class="function">List&lt;Article&gt; <span class="title">findByCategoryId</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="添加文章"><a href="#添加文章" class="headerlink" title="添加文章"></a>添加文章</h2><h3 id="mapper-9"><a href="#mapper-9" class="headerlink" title="mapper"></a>mapper</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.briup.cms.mapper.extend.ArticleExtendMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findByTitle&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.briup.cms.entity.Article&quot;</span>&gt;</span></span><br><span class="line">        select <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;com.briup.cms.mapper.ArticleMapper.Base_Column_List&quot;</span>/&gt;</span></span><br><span class="line">        from cms_article</span><br><span class="line">        where title = #&#123;title&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="service-18"><a href="#service-18" class="headerlink" title="service"></a>service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Article article)</span> </span>&#123;</span><br><span class="line">       String title = article.getTitle();</span><br><span class="line">       <span class="keyword">if</span> (!StringUtils.hasText(title)) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> CustomerException(ResultCode.PARAM_IS_BLANK);</span><br><span class="line">       &#125;</span><br><span class="line">       Article articleFromDB = articleExtendMapper.findByTitle(title);</span><br><span class="line">       <span class="keyword">if</span> (articleFromDB != <span class="keyword">null</span>) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> CustomerException(ResultCode.DATA_USEING);</span><br><span class="line">       &#125;</span><br><span class="line">       article.setPublishTime(<span class="keyword">new</span> Date());</span><br><span class="line">       article.setReadTimes(<span class="number">0</span>);</span><br><span class="line">       article.setThumbDown(<span class="number">0</span>);</span><br><span class="line">       article.setThumbUp(<span class="number">0</span>);</span><br><span class="line">       article.setStatus(<span class="number">0</span>);</span><br><span class="line">       articleMapper.insertSelective(article);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<h3 id="controller-17"><a href="#controller-17" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;新增文章&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Result <span class="title">save</span><span class="params">(<span class="meta">@RequestBody</span> Article article)</span> </span>&#123;</span><br><span class="line">	articleService.save(article);</span><br><span class="line">	<span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="修改文章"><a href="#修改文章" class="headerlink" title="修改文章"></a>修改文章</h2><h3 id="service-19"><a href="#service-19" class="headerlink" title="service"></a>service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Article article)</span> </span>&#123;</span><br><span class="line">       articleMapper.updateByPrimaryKeySelective(article);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="controller-18"><a href="#controller-18" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;修改文章&quot;)</span></span><br><span class="line">	<span class="meta">@PutMapping</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Result <span class="title">update</span><span class="params">(<span class="meta">@RequestBody</span> Article article)</span> </span>&#123;</span><br><span class="line">		articleService.update(article);</span><br><span class="line">		<span class="keyword">return</span> Result.success();</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>



<h2 id="分页查询-1"><a href="#分页查询-1" class="headerlink" title="分页查询"></a>分页查询</h2><h3 id="mapper-10"><a href="#mapper-10" class="headerlink" title="mapper"></a>mapper</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;resultWithCascade&quot;</span> <span class="attr">extends</span>=<span class="string">&quot;com.briup.cms.mapper.ArticleMapper.BaseResultMap&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">type</span>=<span class="string">&quot;com.briup.cms.entity.extend.ArticleExtend&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;user&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.briup.cms.entity.User&quot;</span> <span class="attr">column</span>=<span class="string">&quot;user_id&quot;</span> <span class="attr">select</span>=<span class="string">&quot;com.briup.cms.mapper.UserMapper.selectByPrimaryKey&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;category&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.briup.cms.entity.Category&quot;</span> <span class="attr">column</span>=<span class="string">&quot;category_id&quot;</span> <span class="attr">select</span>=<span class="string">&quot;com.briup.cms.mapper.CategoryMapper.selectByPrimaryKey&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;resultWithCascade&quot;</span>&gt;</span></span><br><span class="line">        select <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;com.briup.cms.mapper.ArticleMapper.Base_Column_List&quot;</span>/&gt;</span></span><br><span class="line">        from cms_article</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="service-20"><a href="#service-20" class="headerlink" title="service"></a>service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> PageUtil&lt;Article&gt; <span class="title">findAll</span><span class="params">(PageUtil pageUtil)</span> </span>&#123;</span><br><span class="line">       PageHelper.startPage(pageUtil.getPageNumber(), pageUtil.getPageSize());</span><br><span class="line">       Page all = articleExtendMapper.findAll(pageUtil.getParams());</span><br><span class="line">       pageUtil.setList(all.getResult());</span><br><span class="line">       pageUtil.setTotal(all.getTotal());</span><br><span class="line">       <span class="keyword">return</span> pageUtil;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<h3 id="controller-19"><a href="#controller-19" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;分页查询文章&quot;)</span></span><br><span class="line">	<span class="meta">@PostMapping(&quot;findAll&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Result <span class="title">findAll</span><span class="params">(<span class="meta">@RequestBody</span> PageUtil pageUtil)</span> </span>&#123;</span><br><span class="line">		PageUtil&lt;Article&gt; page = articleService.findAll(pageUtil);</span><br><span class="line">		<span class="keyword">return</span> Result.success(page);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>



<h2 id="审核咨询"><a href="#审核咨询" class="headerlink" title="审核咨询"></a>审核咨询</h2><h3 id="service-21"><a href="#service-21" class="headerlink" title="service"></a>service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateArticleStatus</span><span class="params">(Integer id, Integer status)</span> </span>&#123;</span><br><span class="line">	Article article = <span class="keyword">new</span> Article();</span><br><span class="line">	article.setId(id);</span><br><span class="line">	article.setStatus(status);</span><br><span class="line">	articleMapper.updateByPrimaryKeySelective(article);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h3 id="controller-20"><a href="#controller-20" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;修改文章状态&quot;, notes = &quot;提供id和status&quot;)</span></span><br><span class="line"><span class="meta">@PutMapping(&quot;&#123;id&#125;/&#123;status&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Result <span class="title">updateArticleStatus</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">		<span class="meta">@ApiParam(name = &quot;id&quot;,value = &quot;文章id&quot;,required = true)</span>	<span class="meta">@PathVariable(&quot;id&quot;)</span>Integer id,</span></span></span><br><span class="line"><span class="params"><span class="function">		<span class="meta">@ApiParam(name = &quot;status&quot;,value = &quot;审核状态&quot;,required = true)</span> <span class="meta">@PathVariable(&quot;status&quot;)</span> Integer status)</span> </span>&#123;</span><br><span class="line">	articleService.updateArticleStatus(id, status);</span><br><span class="line">	<span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="删除文章"><a href="#删除文章" class="headerlink" title="删除文章"></a>删除文章</h2><h3 id="service-22"><a href="#service-22" class="headerlink" title="service"></a>service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteById</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        articleMapper.deleteByPrimaryKey(id);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h3 id="controller-21"><a href="#controller-21" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping(&quot;delete/&#123;id&#125;&quot;)</span></span><br><span class="line">	<span class="meta">@ApiOperation(value = &quot;删除文章&quot;)</span></span><br><span class="line">	<span class="meta">@ApiImplicitParams(&#123;</span></span><br><span class="line"><span class="meta">			@ApiImplicitParam(name = &quot;id&quot;, value = &quot;文章id&quot;, required = true, dataType = &quot;int&quot;, paramType = &quot;path&quot;)</span></span><br><span class="line"><span class="meta">	&#125;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Result <span class="title">deleteBatch</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span> </span>&#123;</span><br><span class="line">		articleService.deleteById(id);</span><br><span class="line">		<span class="keyword">return</span> Result.success();</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h2 id="批量删除-1"><a href="#批量删除-1" class="headerlink" title="批量删除"></a>批量删除</h2><h3 id="service-23"><a href="#service-23" class="headerlink" title="service"></a>service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteArticleInBatch</span><span class="params">(List&lt;Integer&gt; ids)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">for</span> (Integer id : ids) &#123;</span><br><span class="line">           deleteById(id);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="controller-22"><a href="#controller-22" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;批量删除文章&quot;, notes = &quot;提供id集合&quot;)</span></span><br><span class="line">	<span class="meta">@DeleteMapping</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Result <span class="title">deleteBatch</span><span class="params">(<span class="meta">@ApiParam(value = &quot;文章id&quot;)</span> <span class="meta">@RequestBody</span> List&lt;Integer&gt; ids)</span> </span>&#123;</span><br><span class="line">		articleService.deleteArticleInBatch(ids);</span><br><span class="line">		<span class="keyword">return</span> Result.success();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h1 id="评论"><a href="#评论" class="headerlink" title="评论"></a>评论</h1><h2 id="接口-4"><a href="#接口-4" class="headerlink" title="接口"></a>接口</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.cms.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.cms.utils.PageUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.cms.entity.Comment;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CommentService</span> </span>&#123;</span><br><span class="line">	<span class="comment">//分页获取所有评论</span></span><br><span class="line">	<span class="function">PageUtil&lt;Comment&gt; <span class="title">findAll</span><span class="params">(PageUtil pageUtil)</span></span>;</span><br><span class="line">	<span class="comment">//新增评论或者更新评论</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">saveComment</span><span class="params">(Comment comment)</span></span>;</span><br><span class="line">	<span class="comment">//批量删除评论</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">deleteCommentInBatch</span><span class="params">(List&lt;Integer&gt; ids)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="新增-1"><a href="#新增-1" class="headerlink" title="新增"></a>新增</h2><h3 id="service-24"><a href="#service-24" class="headerlink" title="service"></a>service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveComment</span><span class="params">(Comment comment)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(!StringUtils.hasText(comment.getContent()))&#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> CustomerException(ResultCode.PARAM_IS_BLANK);</span><br><span class="line">		&#125;</span><br><span class="line">		comment.setTime(<span class="keyword">new</span> Date());</span><br><span class="line">		commentMapper.insertSelective(comment);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>



<h3 id="controller-23"><a href="#controller-23" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;添加评论&quot;,notes = &quot;参数为json格式&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Result <span class="title">save</span><span class="params">(<span class="meta">@RequestBody</span> Comment comment)</span> </span>&#123;</span><br><span class="line">	commentService.saveComment(comment);</span><br><span class="line">	<span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="分页"><a href="#分页" class="headerlink" title="分页"></a>分页</h2><h3 id="mapper-11"><a href="#mapper-11" class="headerlink" title="mapper"></a>mapper</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.briup.cms.mapper.extend.CommentExtendMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;resultWithCascade&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.briup.cms.entity.extend.CommentExtend&quot;</span> <span class="attr">extends</span>=<span class="string">&quot;com.briup.cms.mapper.CommentMapper.BaseResultMap&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;comment&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.briup.cms.entity.Comment&quot;</span> <span class="attr">column</span>=<span class="string">&quot;comment_id&quot;</span> <span class="attr">select</span>=<span class="string">&quot;com.briup.cms.mapper.CommentMapper.selectByPrimaryKey&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;article&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.briup.cms.entity.Article&quot;</span> <span class="attr">column</span>=<span class="string">&quot;article_id&quot;</span> <span class="attr">select</span>=<span class="string">&quot;com.briup.cms.mapper.ArticleMapper.selectByPrimaryKey&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;user&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.briup.cms.entity.User&quot;</span> <span class="attr">column</span>=<span class="string">&quot;user_id&quot;</span> <span class="attr">select</span>=<span class="string">&quot;com.briup.cms.mapper.UserMapper.selectByPrimaryKey&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;resultWithCascade&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">        select <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;com.briup.cms.mapper.CommentMapper.Base_Column_List&quot;</span>/&gt;</span></span><br><span class="line">        from cms_comment</span><br><span class="line">         <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;articleId != null&quot;</span>&gt;</span></span><br><span class="line">                article_id = #&#123;articleId&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="service-25"><a href="#service-25" class="headerlink" title="service"></a>service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> PageUtil&lt;Comment&gt; <span class="title">findAll</span><span class="params">(PageUtil pageUtil)</span> </span>&#123;</span><br><span class="line">		PageHelper.startPage(pageUtil.getPageNumber(),pageUtil.getPageSize());</span><br><span class="line">		Page&lt;Comment&gt; page = commentExtendMapper.findAll(pageUtil.getParams());</span><br><span class="line">		pageUtil.setTotal(page.getTotal());</span><br><span class="line">		pageUtil.setList(page.getResult());</span><br><span class="line">		<span class="keyword">return</span> pageUtil;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>



<h3 id="controller-24"><a href="#controller-24" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;分页查询评论&quot;, notes = &quot;提供当前页码和每页显示条数&quot;)</span></span><br><span class="line">	<span class="meta">@PostMapping(&quot;findAll&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Result <span class="title">findAll</span><span class="params">(<span class="meta">@RequestBody</span> PageUtil pageUtil)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> Result.success(commentService.findAll(pageUtil));</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>



<h2 id="删除-2"><a href="#删除-2" class="headerlink" title="删除"></a>删除</h2><h3 id="service-26"><a href="#service-26" class="headerlink" title="service"></a>service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteCommentInBatch</span><span class="params">(List&lt;Integer&gt; ids)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">for</span>(Integer id : ids)&#123;</span><br><span class="line">			commentMapper.deleteByPrimaryKey(id);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>



<h3 id="controller-25"><a href="#controller-25" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;批量删除评论&quot;, notes = &quot;提供id集合&quot;)</span></span><br><span class="line">	<span class="meta">@DeleteMapping</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Result <span class="title">deleteBatch</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">			<span class="meta">@ApiParam(&quot;ids&quot;)</span><span class="meta">@RequestBody</span> List&lt;Integer&gt; ids)</span> </span>&#123;</span><br><span class="line">		commentService.deleteCommentInBatch(ids);</span><br><span class="line">		<span class="keyword">return</span> Result.success();</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>





<h1 id="页面"><a href="#页面" class="headerlink" title="页面"></a>页面</h1><h2 id="软件安装-1"><a href="#软件安装-1" class="headerlink" title="软件安装"></a>软件安装</h2><ul>
<li>node14</li>
<li>vscode</li>
</ul>
<blockquote>
<p>npm使用</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看npm版本</span></span><br><span class="line">npm -v</span><br><span class="line"><span class="meta">#</span><span class="bash">经过下面的配置，以后所有的 npm install 都会经过淘宝的镜像地址下载</span></span><br><span class="line">npm config set registry https://registry.npm.taobao.org </span><br><span class="line"><span class="meta">#</span><span class="bash">查看npm配置信息</span></span><br><span class="line">npm config list</span><br><span class="line">npm install #根据package.json中的配置下载依赖，初始化项目</span><br><span class="line">npm uninstall 包名</span><br></pre></td></tr></table></figure>





<h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><h3 id="安装模板"><a href="#安装模板" class="headerlink" title="安装模板"></a>安装模板</h3><blockquote>
<p>vueAdmin-template是基于vue-element-admin的一套后台管理系统基础模板（最少精简版），可作为模板进行二次开发。</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 解压压缩包</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入目录</span></span><br><span class="line">cd vue-admin-template-master</span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装依赖</span></span><br><span class="line">npm install</span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动。执行后，浏览器自动弹出并访问http://localhost:9528/</span></span><br><span class="line">npm run dev</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211214160805909.png" alt="image-20211214160805909"></p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211214155752274.png" alt="image-20211214155752274"></p>
<h3 id="改造模板"><a href="#改造模板" class="headerlink" title="改造模板"></a>改造模板</h3><blockquote>
<p>登录页面修改 src/views/login/index.vue</p>
</blockquote>
<p>第6行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;h3 class=&quot;title&quot;&gt;看点咨询系统&lt;/h3&gt;</span><br></pre></td></tr></table></figure>

<p>第44行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-button :loading=&quot;loading&quot; type=&quot;primary&quot; style=&quot;width:100%;margin-bottom:30px;&quot; @click.native.prevent=&quot;handleLogin&quot;&gt;登录&lt;/el-button&gt;</span><br></pre></td></tr></table></figure>

<p>第46-49</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- &lt;div class=&quot;tips&quot;&gt;</span><br><span class="line">        &lt;span style=&quot;margin-right:20px;&quot;&gt;username: admin&lt;/span&gt;</span><br><span class="line">        &lt;span&gt; password: any&lt;/span&gt;</span><br><span class="line">      &lt;/div&gt; --&gt;</span><br></pre></td></tr></table></figure>

<p>第68-74</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> validatePassword = <span class="function">(<span class="params">rule, value, callback</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (value.length === <span class="number">0</span>) &#123;</span><br><span class="line">        callback(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;Please enter the correct user password&#x27;</span>))</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        callback()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>第144行</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">&quot;../../../bg.jpg&quot;</span>) fixed;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211214163034847.png" alt="image-20211214163034847"></p>
<blockquote>
<p>导航栏 src/layout/components/navbar.vue</p>
</blockquote>
<p>第13行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-dropdown-menu slot=&quot;dropdown&quot; class=&quot;user-dropdown&quot;&gt;</span><br><span class="line">          &lt;router-link to=&quot;/&quot;&gt;</span><br><span class="line">            &lt;el-dropdown-item&gt;</span><br><span class="line">             首页</span><br><span class="line">            &lt;/el-dropdown-item&gt;</span><br><span class="line">          &lt;/router-link&gt;</span><br><span class="line">          &lt;!-- &lt;a target=&quot;_blank&quot; href=&quot;https://github.com/PanJiaChen/vue-admin-template/&quot;&gt;</span><br><span class="line">            &lt;el-dropdown-item&gt;Github&lt;/el-dropdown-item&gt;</span><br><span class="line">          &lt;/a&gt;</span><br><span class="line">          &lt;a target=&quot;_blank&quot; href=&quot;https://panjiachen.github.io/vue-element-admin-site/#/&quot;&gt;</span><br><span class="line">            &lt;el-dropdown-item&gt;Docs&lt;/el-dropdown-item&gt;</span><br><span class="line">          &lt;/a&gt; --&gt;</span><br><span class="line">          &lt;el-dropdown-item divided @click.native=&quot;logout&quot;&gt;</span><br><span class="line">            &lt;span style=&quot;display:block;&quot;&gt;退出&lt;/span&gt;</span><br><span class="line">          &lt;/el-dropdown-item&gt;</span><br><span class="line">        &lt;/el-dropdown-menu&gt;</span><br></pre></td></tr></table></figure>

<img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211214165713821.png" alt="image-20211214165713821" style="zoom:33%;" />

<blockquote>
<p>侧边栏 </p>
</blockquote>
<p>src/componentsBreadcrumb/index.vue 第35-37 </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="built_in">this</span>.isDashboard(first)) &#123;</span><br><span class="line">        matched = [&#123; <span class="attr">path</span>: <span class="string">&#x27;/dashboard&#x27;</span>, <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;&#x27;</span> &#125;&#125;].concat(matched)</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<p>src/router/index.js 第46-56</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">   <span class="attr">component</span>: Layout,</span><br><span class="line">   <span class="attr">redirect</span>: <span class="string">&#x27;/dashboard&#x27;</span>,</span><br><span class="line">   <span class="attr">children</span>: [&#123;</span><br><span class="line">     <span class="attr">path</span>: <span class="string">&#x27;dashboard&#x27;</span>,</span><br><span class="line">     <span class="attr">name</span>: <span class="string">&#x27;首页&#x27;</span>,</span><br><span class="line">     <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/dashboard/index&#x27;</span>),</span><br><span class="line">     <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;首页&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;dashboard&#x27;</span> &#125;</span><br><span class="line">   &#125;]</span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211214170002256.png" alt="image-20211214170002256"></p>
<blockquote>
<p>页面标题 src/settings.js</p>
</blockquote>
<p>第3行</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">title: <span class="string">&#x27;看点咨询系统&#x27;</span>,</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211214170538978.png" alt="image-20211214170538978"></p>
<blockquote>
<p>国际化使用中文 src/main.js</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> locale <span class="keyword">from</span> <span class="string">&#x27;element-ui/lib/locale/lang/zh-CN&#x27;</span> <span class="comment">// lang i18n</span></span><br></pre></td></tr></table></figure>



<h2 id="登录-1"><a href="#登录-1" class="headerlink" title="登录"></a>登录</h2><blockquote>
<p>去除mock环境</p>
</blockquote>
<p>vue.config.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">第<span class="number">39</span>行</span><br><span class="line"><span class="comment">//before: require(&#x27;./mock/mock-server.js&#x27;)</span></span><br></pre></td></tr></table></figure>

<p>.env.development</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">VUE_APP_BASE_API = &#x27;http://localhost:8989&#x27;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>修改登录相关api路径 src/api/user.js</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/auth/login&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">    data</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/resource/info&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">logout</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/resource/logout&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<blockquote>
<p>修改store中的user.js   src/store/modules/user.js</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; login, logout, getInfo &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/user&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getToken, setToken, removeToken &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/auth&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; resetRouter &#125; <span class="keyword">from</span> <span class="string">&#x27;@/router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getDefaultState = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">token</span>: getToken(),</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="attr">avatar</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> state = getDefaultState()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mutations = &#123;</span><br><span class="line">  <span class="attr">RESET_STATE</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">Object</span>.assign(state, getDefaultState())</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">SET_TOKEN</span>: <span class="function">(<span class="params">state, token</span>) =&gt;</span> &#123;</span><br><span class="line">    state.token = token</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">SET_NAME</span>: <span class="function">(<span class="params">state, name</span>) =&gt;</span> &#123;</span><br><span class="line">    state.name = name</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">SET_AVATAR</span>: <span class="function">(<span class="params">state, avatar</span>) =&gt;</span> &#123;</span><br><span class="line">    state.avatar = avatar</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> actions = &#123;</span><br><span class="line">  <span class="comment">// user login</span></span><br><span class="line">  <span class="function"><span class="title">login</span>(<span class="params">&#123; commit &#125;, userInfo</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; username, password &#125; = userInfo</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      login(&#123; <span class="attr">username</span>: username.trim(), <span class="attr">password</span>: password &#125;).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; data &#125; = response</span><br><span class="line">        commit(<span class="string">&#x27;SET_TOKEN&#x27;</span>, data.token)</span><br><span class="line">        setToken(data.token)</span><br><span class="line">        resolve()</span><br><span class="line">      &#125;).catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">        reject(error)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// get user info</span></span><br><span class="line">  <span class="function"><span class="title">getInfo</span>(<span class="params">&#123; commit, state &#125;</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      getInfo(state.token).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> data  = response.data;</span><br><span class="line">        <span class="keyword">if</span> (!data) &#123;</span><br><span class="line">          <span class="keyword">return</span> reject(<span class="string">&#x27;Verification failed, please Login again.&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> &#123; username, image &#125; = data</span><br><span class="line"></span><br><span class="line">        commit(<span class="string">&#x27;SET_NAME&#x27;</span>, username)</span><br><span class="line">        commit(<span class="string">&#x27;SET_AVATAR&#x27;</span>, image)</span><br><span class="line">        resolve(data)</span><br><span class="line">      &#125;).catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">        reject(error)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// user logout</span></span><br><span class="line">  <span class="function"><span class="title">logout</span>(<span class="params">&#123; commit, state &#125;</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      logout(state.token).then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        removeToken() <span class="comment">// must remove  token  first</span></span><br><span class="line">        resetRouter()</span><br><span class="line">        commit(<span class="string">&#x27;RESET_STATE&#x27;</span>)</span><br><span class="line">        resolve()</span><br><span class="line">      &#125;).catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">        reject(error)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// remove token</span></span><br><span class="line">  <span class="function"><span class="title">resetToken</span>(<span class="params">&#123; commit &#125;</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">      removeToken() <span class="comment">// must remove  token  first</span></span><br><span class="line">      commit(<span class="string">&#x27;RESET_STATE&#x27;</span>)</span><br><span class="line">      resolve()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">namespaced</span>: <span class="literal">true</span>,</span><br><span class="line">  state,</span><br><span class="line">  mutations,</span><br><span class="line">  actions</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<blockquote>
<p>修改请求拦截器 src/utils/request.js</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; MessageBox, Message &#125; <span class="keyword">from</span> <span class="string">&#x27;element-ui&#x27;</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getToken &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/auth&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// create an axios instance</span></span><br><span class="line"><span class="keyword">const</span> service = axios.create(&#123;</span><br><span class="line">  <span class="attr">baseURL</span>: process.env.VUE_APP_BASE_API, <span class="comment">// url = base url + request url</span></span><br><span class="line">  <span class="comment">// withCredentials: true, // send cookies when cross-domain requests</span></span><br><span class="line">  <span class="attr">timeout</span>: <span class="number">5000</span> <span class="comment">// request timeout</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// request interceptor</span></span><br><span class="line">service.interceptors.request.use(</span><br><span class="line">  <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// do something before request is sent</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (store.getters.token) &#123;</span><br><span class="line">      <span class="comment">// let each request carry token</span></span><br><span class="line">      <span class="comment">// [&#x27;X-Token&#x27;] is a custom headers key</span></span><br><span class="line">      <span class="comment">// please modify it according to the actual situation</span></span><br><span class="line">      config.headers[<span class="string">&#x27;token&#x27;</span>] = getToken()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> config</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// do something with request error</span></span><br><span class="line">    <span class="built_in">console</span>.log(error) <span class="comment">// for debug</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// response interceptor</span></span><br><span class="line">service.interceptors.response.use(</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * If you want to get http information such as headers or status</span></span><br><span class="line"><span class="comment">   * Please return  response =&gt; response</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Determine the request status by custom code</span></span><br><span class="line"><span class="comment">   * Here is just an example</span></span><br><span class="line"><span class="comment">   * You can also judge the status by HTTP Status Code</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> res = response.data</span><br><span class="line"></span><br><span class="line">    <span class="comment">// if the custom code is not 20000, it is judged as an error.</span></span><br><span class="line">    <span class="keyword">if</span> (res.code !== <span class="number">1</span>) &#123;</span><br><span class="line">      Message(&#123;</span><br><span class="line">        <span class="attr">message</span>: res.message || <span class="string">&#x27;Error&#x27;</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">        <span class="attr">duration</span>: <span class="number">5</span> * <span class="number">1000</span></span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 50008: Illegal token; 50012: Other clients logged in; 50014: Token expired;</span></span><br><span class="line">      <span class="comment">// if (res.code === 50008 || res.code === 50012 || res.code === 50014) &#123;</span></span><br><span class="line">      <span class="comment">//   // to re-login</span></span><br><span class="line">      <span class="comment">//   MessageBox.confirm(&#x27;You have been logged out, you can cancel to stay on this page, or log in again&#x27;, &#x27;Confirm logout&#x27;, &#123;</span></span><br><span class="line">      <span class="comment">//     confirmButtonText: &#x27;Re-Login&#x27;,</span></span><br><span class="line">      <span class="comment">//     cancelButtonText: &#x27;Cancel&#x27;,</span></span><br><span class="line">      <span class="comment">//     type: &#x27;warning&#x27;</span></span><br><span class="line">      <span class="comment">//   &#125;).then(() =&gt; &#123;</span></span><br><span class="line">      <span class="comment">//     store.dispatch(&#x27;user/resetToken&#x27;).then(() =&gt; &#123;</span></span><br><span class="line">      <span class="comment">//       location.reload()</span></span><br><span class="line">      <span class="comment">//     &#125;)</span></span><br><span class="line">      <span class="comment">//   &#125;)</span></span><br><span class="line">      <span class="comment">// &#125;</span></span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(<span class="keyword">new</span> <span class="built_in">Error</span>(res.message || <span class="string">&#x27;Error&#x27;</span>))</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> res</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;err&#x27;</span> + error) <span class="comment">// for debug</span></span><br><span class="line">    Message(&#123;</span><br><span class="line">      <span class="attr">message</span>: error.message,</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">      <span class="attr">duration</span>: <span class="number">5</span> * <span class="number">1000</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> service</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>登录成功后显示</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211214222946130.png" alt="image-20211214222946130"></p>
<blockquote>
<p>修改登录首页配置 </p>
</blockquote>
<p><strong>显示用户信息 src/layout/components/Navbar.vue</strong></p>
<p>第9-11行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;avatar-wrapper&quot;&gt;</span><br><span class="line">          &lt;div class=&quot;avatar-name&quot;&gt;欢迎您：&#123;&#123; name &#125;&#125;&lt;/div&gt;</span><br><span class="line">          &lt;img :src=&quot;avatar+&#x27;?imageView2/1/w/80/h/80&#x27;&quot; class=&quot;user-avatar&quot;&gt;</span><br><span class="line">          &lt;i class=&quot;el-icon-caret-bottom&quot; /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>第122行</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 文字布局</span><br><span class="line">       <span class="selector-class">.avatar-name</span> &#123;</span><br><span class="line">         <span class="attribute">display</span>: inline-block;</span><br><span class="line">         <span class="attribute">line-height</span>: <span class="number">50px</span>;</span><br><span class="line">         <span class="attribute">position</span>: relative;</span><br><span class="line">         <span class="attribute">top</span>: -<span class="number">15px</span>;</span><br><span class="line">         <span class="attribute">right</span>: <span class="number">10px</span>;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>



<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211214223958085.png" alt="image-20211214223958085"></p>
<p><strong>首页轮播图</strong>  src/views/dashboard/index.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;dashboard-container&quot;&gt;</span><br><span class="line">    &lt;el-carousel</span><br><span class="line">      class=&quot;carou&quot;</span><br><span class="line">      autoplay</span><br><span class="line">      height=&quot;400px&quot;</span><br><span class="line">      :interval=&quot;5000&quot;</span><br><span class="line">      arrow=&quot;always&quot;</span><br><span class="line">      type=&quot;card&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;el-carousel-item v-for=&quot;item in images&quot; :key=&quot;item.id&quot;&gt;</span><br><span class="line">        &lt;el-image</span><br><span class="line">          style=&quot;width: 80%; height: 100%; border-radius: 50px&quot;</span><br><span class="line">          :src=&quot;item.url&quot;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;/el-carousel-item&gt;</span><br><span class="line">    &lt;/el-carousel&gt;</span><br><span class="line">   </span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;Dashboard&quot;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      images: [</span><br><span class="line">        &#123; id: 1, url: &quot;http://r3tsx6mgn.hn-bkt.clouddn.com/2.jpg&quot; &#125;,</span><br><span class="line">        &#123; id: 2, url: &quot;http://r3tsx6mgn.hn-bkt.clouddn.com/3.jpg&quot; &#125;,</span><br><span class="line">        &#123; id: 4, url: &quot;http://r3tsx6mgn.hn-bkt.clouddn.com/4.jpg&quot; &#125;,</span><br><span class="line">        &#123;id: 5,url: &quot;http://r3tsx6mgn.hn-bkt.clouddn.com/20210924_212052_06.jpg&quot;&#125;,</span><br><span class="line">        // 本地图片</span><br><span class="line">        &#123;id: 6,url: require(&#x27;./images/1.jpg&#x27;)&#125;</span><br><span class="line">      ],</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class="line">/* .dashboard &#123;</span><br><span class="line">  &amp;-container &#123;</span><br><span class="line">    margin: 30px;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; */</span><br><span class="line"></span><br><span class="line">.images-parent &#123;</span><br><span class="line">  display: flex;</span><br><span class="line">  justify-content: flex-start;</span><br><span class="line">  margin-top: 30px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.images &#123;</span><br><span class="line">  flex: 1;</span><br><span class="line">  &amp; img &#123;</span><br><span class="line">    width: 90%;</span><br><span class="line">    height: 100%;</span><br><span class="line">    border-radius: 50%;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.el-carousel__item &#123;</span><br><span class="line">  border-radius: 50px;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211214230306767.png" alt="image-20211214230306767"></p>
<h2 id="角色模块-1"><a href="#角色模块-1" class="headerlink" title="角色模块"></a>角色模块</h2><h3 id="查询所有-1"><a href="#查询所有-1" class="headerlink" title="查询所有"></a>查询所有</h3><p>页面编写 src/views/cms/role/list.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div&gt;hello&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>



<p>页面路由 src/router/index.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/role&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;角色管理&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: Layout,</span><br><span class="line">    <span class="attr">redirect</span>: <span class="string">&#x27;/role/list&#x27;</span>,</span><br><span class="line">    <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;角色管理&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;table&#x27;</span> &#125;,</span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;list&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;角色列表&#x27;</span>,</span><br><span class="line">      <span class="attr">hidden</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/cms/role/list&#x27;</span>),</span><br><span class="line">      <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;角色列表&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;table&#x27;</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br></pre></td></tr></table></figure>



<p>axios封装接口  src/api/role.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> group_name = <span class="string">&#x27;/role&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">findAll</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> request(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;group_name&#125;</span>/findAll`</span>,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">save</span>(<span class="params">role</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> request(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;group_name&#125;</span>/save`</span>,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">            <span class="attr">data</span>: role</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">deleteById</span>(<span class="params">id</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> request(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;group_name&#125;</span>/delete/<span class="subst">$&#123;id&#125;</span>`</span>,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;delete&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改 src/views/cms/role/list.vue 调用接口 渲染数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;!-- 需要放到div块中 --&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;el-button type=&quot;primary&quot; @click=&quot;save&quot;&gt;添加&lt;/el-button&gt;</span><br><span class="line">    &lt;!-- 数据表格 start --&gt;</span><br><span class="line">    &lt;el-table</span><br><span class="line">      :data=&quot;tableData&quot;</span><br><span class="line">      style=&quot;width: 100%&quot;</span><br><span class="line">      :row-class-name=&quot;tableRowClassName&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;name&quot; label=&quot;名称&quot; width=&quot;180&quot;&gt; &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;description&quot; label=&quot;描述&quot;&gt; &lt;/el-table-column&gt;</span><br><span class="line"></span><br><span class="line">      &lt;el-table-column label=&quot;操作&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">          &lt;el-button</span><br><span class="line">            size=&quot;mini&quot;</span><br><span class="line">            type=&quot;danger&quot;</span><br><span class="line">            @click=&quot;handleDelete(scope.row.id)&quot;</span><br><span class="line">            &gt;删除&lt;/el-button</span><br><span class="line">          &gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">    &lt;/el-table&gt;</span><br><span class="line">    &lt;!-- 数据表格 end --&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &lt;script&gt;</span><br><span class="line">import roleApi from &quot;@/api/role.js&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      tableData: [],</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    this.findAll();</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    findAll() &#123;</span><br><span class="line">      roleApi</span><br><span class="line">        .findAll()</span><br><span class="line">        .then((resp) =&gt; &#123;</span><br><span class="line">          this.tableData = resp.data;</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch((error) =&gt; &#123;</span><br><span class="line">          console.log(error);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    save() &#123;&#125;,</span><br><span class="line">    handleDelete(id) &#123;&#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line"></span><br><span class="line">.el-table .warning-row &#123;</span><br><span class="line">  background: oldlace;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.el-table .success-row &#123;</span><br><span class="line">  background: #f0f9eb;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>



<p>调整边距 src/layout/index.vue 第5行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;main-container&quot;&gt;</span><br><span class="line">     &lt;div :class=&quot;&#123;&#x27;fixed-header&#x27;:fixedHeader&#125;&quot;&gt;</span><br><span class="line">       &lt;navbar /&gt;</span><br><span class="line">     &lt;/div&gt;</span><br><span class="line">     &lt;!-- 边距调整 --&gt;</span><br><span class="line">     &lt;div style=&quot;padding:2em&quot;&gt;</span><br><span class="line">         &lt;app-main /&gt;</span><br><span class="line">     &lt;/div&gt;</span><br><span class="line">     </span><br><span class="line">   &lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211215161229752.png" alt="image-20211215161229752"></p>
<h3 id="删除-3"><a href="#删除-3" class="headerlink" title="删除"></a>删除</h3><p>修改 src/views/cms/role/list.vue 调用接口 渲染数据</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">handleDelete</span>(<span class="params">id</span>)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.$confirm(<span class="string">&quot;此操作将永久删除该文件, 是否继续?&quot;</span>, <span class="string">&quot;提示&quot;</span>, &#123;</span><br><span class="line">        <span class="attr">confirmButtonText</span>: <span class="string">&quot;确定&quot;</span>,</span><br><span class="line">        <span class="attr">cancelButtonText</span>: <span class="string">&quot;取消&quot;</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;warning&quot;</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">        .then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// 删除</span></span><br><span class="line">          roleApi.deleteById(id).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.$message.success(<span class="string">&quot;删除成功&quot;</span>);</span><br><span class="line">            <span class="built_in">this</span>.findAll();</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">this</span>.$message(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;info&quot;</span>,</span><br><span class="line">            <span class="attr">message</span>: <span class="string">&quot;已取消删除&quot;</span>,</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211215212530385.png" alt="image-20211215212530385"></p>
<h3 id="添加-1"><a href="#添加-1" class="headerlink" title="添加"></a>添加</h3><p>修改 src/views/cms/role/list.vue 调用接口 渲染数据</p>
<blockquote>
<p>主要新增了 添加按钮  和添加的对话框 以及添加的相应方法</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;!-- 需要放到div块中 --&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;el-button type=&quot;primary&quot; @click=&quot;toSave&quot;&gt;添加&lt;/el-button&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 表格数据 start --&gt;</span><br><span class="line">    &lt;el-table</span><br><span class="line">      :data=&quot;tableData&quot;</span><br><span class="line">      style=&quot;width: 100%&quot;</span><br><span class="line">      :row-class-name=&quot;tableRowClassName&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;name&quot; label=&quot;名称&quot; width=&quot;180&quot;&gt; &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;description&quot; label=&quot;描述&quot;&gt; &lt;/el-table-column&gt;</span><br><span class="line"></span><br><span class="line">      &lt;el-table-column label=&quot;操作&quot; width=&quot;100&quot;&gt; </span><br><span class="line">        &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">          &lt;el-button</span><br><span class="line">            size=&quot;mini&quot;</span><br><span class="line">            type=&quot;danger&quot;</span><br><span class="line">            @click=&quot;handleDelete(scope.row.id)&quot;</span><br><span class="line">            &gt;删除&lt;/el-button</span><br><span class="line">          &gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">    &lt;/el-table&gt;</span><br><span class="line">       &lt;!-- 表格数据 end --&gt;</span><br><span class="line"></span><br><span class="line"> &lt;!-- 添加对话框 start--&gt;</span><br><span class="line">    &lt;el-dialog title=&quot;添加角色&quot; :visible.sync=&quot;dialogFormVisible&quot;&gt;</span><br><span class="line">      &lt;el-form :model=&quot;role&quot; label-width=&quot;100px&quot;&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;角色名称&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;role.name&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;角色描述&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;role.description&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">      &lt;div slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">        &lt;el-button @click=&quot;dialogFormVisible = false&quot;&gt;取 消&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;saveRole&quot;&gt;确 定&lt;/el-button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/el-dialog&gt;</span><br><span class="line">    &lt;!-- 添加对话框 end --&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> &lt;script&gt;</span><br><span class="line">import roleApi from &quot;@/api/role.js&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      tableData: [],</span><br><span class="line">      dialogFormVisible: false,</span><br><span class="line">      role:&#123;&#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    this.findAll();</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    tableRowClassName(&#123; row, rowIndex &#125;) &#123;</span><br><span class="line">      if (rowIndex === 1) &#123;</span><br><span class="line">        return &quot;warning-row&quot;;</span><br><span class="line">      &#125; else if (rowIndex === 3) &#123;</span><br><span class="line">        return &quot;success-row&quot;;</span><br><span class="line">      &#125;</span><br><span class="line">      return &quot;&quot;;</span><br><span class="line">    &#125;,</span><br><span class="line">    toSave() &#123;</span><br><span class="line">      this.dialogFormVisible = true;</span><br><span class="line">    &#125;,</span><br><span class="line">   saveRole()&#123;</span><br><span class="line">      roleApi</span><br><span class="line">        .save(this.role)</span><br><span class="line">        .then(res=&gt;&#123;</span><br><span class="line">            this.$message.success(res.msg);</span><br><span class="line">            this.dialogFormVisible=false;</span><br><span class="line">            this.findAll();</span><br><span class="line"></span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(error=&gt;&#123;</span><br><span class="line">            console.log(error);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211215212743608.png" alt="image-20211215212743608"></p>
<p><code>问题</code></p>
<p>继续添加对话框,上一次的数据还在</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.$message.success(res.msg);</span><br><span class="line"><span class="built_in">this</span>.dialogFormVisible=<span class="literal">false</span>;</span><br><span class="line"><span class="built_in">this</span>.findAll();</span><br><span class="line"><span class="comment">// 清空表单数据 否则会自动绑定数据回显</span></span><br><span class="line"><span class="built_in">this</span>.role = &#123;&#125;;</span><br></pre></td></tr></table></figure>



<h2 id="用户模块-1"><a href="#用户模块-1" class="headerlink" title="用户模块"></a>用户模块</h2><h3 id="api"><a href="#api" class="headerlink" title="api"></a>api</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 分页查询</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">findByPage</span>(<span class="params">page</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/user/findByPage&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: page</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">insert</span>(<span class="params">user</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/user/insert&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: user</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params">user</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/user/update&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;put&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: user</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">info</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/user/info/<span class="subst">$&#123;id&#125;</span>`</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">deleteById</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/user/delete/<span class="subst">$&#123;id&#125;</span>`</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;delete&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">deleteBatch</span>(<span class="params">ids</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/user/deleteBatch&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;delete&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: ids</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">updateStatus</span>(<span class="params">id,status</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/user/updateStatus/<span class="subst">$&#123;id&#125;</span>/<span class="subst">$&#123;status&#125;</span>`</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;put&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="router"><a href="#router" class="headerlink" title="router"></a>router</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/user&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;用户管理&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: Layout,</span><br><span class="line">    <span class="attr">redirect</span>: <span class="string">&#x27;/user/list&#x27;</span>,</span><br><span class="line">    <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;用户管理&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;table&#x27;</span> &#125;,</span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;list&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;用户列表&#x27;</span>,</span><br><span class="line">        <span class="attr">hidden</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/cms/user/list&#x27;</span>),</span><br><span class="line">        <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;用户列表&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;table&#x27;</span> &#125;</span><br><span class="line">      &#125;]</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>



<h3 id="分页用户"><a href="#分页用户" class="headerlink" title="分页用户"></a>分页用户</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- 表格数据 start --&gt;</span><br><span class="line">    &lt;el-table :data=&quot;dataPage.list&quot; stripe style=&quot;width: 100%&quot;&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;id&quot; label=&quot;编号&quot; width=&quot;100&quot;&gt; &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;username&quot; label=&quot;姓名&quot; width=&quot;100&quot;&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;phone&quot; label=&quot;手机&quot;&gt; &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;realName&quot; label=&quot;昵称&quot;&gt; &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;gender&quot; label=&quot;性别&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">          &#123;&#123; scope.row.gender === 0 ? &quot;男&quot; : &quot;女&quot; &#125;&#125;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;birthday&quot; label=&quot;生日&quot; width=&quot;150&quot;&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;registerTime&quot; label=&quot;注册时间&quot; width=&quot;150&quot;&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;status&quot; label=&quot;状态&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">          &#123;&#123; scope.row.status === 0 ? &quot;正常&quot; : &quot;禁用&quot; &#125;&#125;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;image&quot; label=&quot;头像&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">          &lt;img :src=&quot;scope.row.image&quot; alt=&quot;&quot; width=&quot;40px&quot; height=&quot;40px&quot; /&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;role.name&quot; label=&quot;角色&quot;&gt; &lt;/el-table-column&gt;</span><br><span class="line">      &lt;!-- 用户操作按钮 start --&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;操作&quot; width=&quot;150&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">          &lt;el-button size=&quot;mini&quot; @click=&quot;toUpdate(scope.row.id)&quot;</span><br><span class="line">            &gt;编辑&lt;/el-button</span><br><span class="line">          &gt;</span><br><span class="line">          &lt;el-button size=&quot;mini&quot; type=&quot;danger&quot; @click=&quot;deleteById(scope.row.id)&quot;</span><br><span class="line">            &gt;删除&lt;/el-button</span><br><span class="line">          &gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;!-- 用户操作按钮 end --&gt;</span><br><span class="line">    &lt;/el-table&gt;</span><br><span class="line">    &lt;!-- 表格数据 end--&gt;</span><br><span class="line">    &lt;!-- 分页 start --&gt;</span><br><span class="line">       &lt;el-pagination</span><br><span class="line">        @size-change=&quot;handleSizeChange&quot;</span><br><span class="line">        @current-change=&quot;handleCurrentChange&quot;</span><br><span class="line">        :current-page.sync=&quot;paramsPage.pageNumber&quot;</span><br><span class="line">        :page-sizes=&quot;[5, 10, 15, 25]&quot;</span><br><span class="line">        :page-size=&quot;paramsPage.pageSize&quot;</span><br><span class="line">        layout=&quot;sizes, prev, pager, next&quot;</span><br><span class="line">        :total=&quot;dataPage.total&quot;</span><br><span class="line">        &gt;</span><br><span class="line">        &lt;/el-pagination&gt;</span><br><span class="line">         &lt;!-- 分页 end --&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">// 注意 user.js导出的都是单个函数</span><br><span class="line">import &#123; findByPage &#125; from &quot;@/api/user.js&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      userList: [],</span><br><span class="line">      paramsPage: &#123;</span><br><span class="line">        // 查询传参page对象</span><br><span class="line">        pageNumber: 1,</span><br><span class="line">        pageSize: 5,</span><br><span class="line">        params: &#123;&#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      dataPage:&#123;&#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    findAll() &#123;</span><br><span class="line">      console.log(&quot;分页查询&quot;);</span><br><span class="line">      findByPage(this.paramsPage)</span><br><span class="line">        .then((res) =&gt; &#123;</span><br><span class="line">         this.dataPage = res.data;</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch((error) =&gt; &#123;</span><br><span class="line">          console.log(error);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    handleSizeChange(val) &#123;</span><br><span class="line">      this.paramsPage.pageSize = val;</span><br><span class="line">      this.findAll();</span><br><span class="line">    &#125;,</span><br><span class="line">    handleCurrentChange(val) &#123;</span><br><span class="line">      this.paramsPage.pageNumber = val;</span><br><span class="line">      this.findAll();</span><br><span class="line">    &#125;,</span><br><span class="line">    toSave()&#123;</span><br><span class="line">        this.dialogFormVisible = true;</span><br><span class="line">    &#125;,</span><br><span class="line">    saveUser()&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    this.findAll();</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>



<h3 id="添加用户"><a href="#添加用户" class="headerlink" title="添加用户"></a>添加用户</h3><blockquote>
<p>添加用户需要选择角色 </p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">    <span class="function"><span class="title">findRole</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        roleApi</span><br><span class="line">        .findAll()</span><br><span class="line">        .then(<span class="function">(<span class="params">resp</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">//this.$store.commit(&#x27;setRoleList&#x27;,resp.data);</span></span><br><span class="line">          <span class="built_in">this</span>.roleList = resp.data;</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(error);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">created</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.findRole();</span><br><span class="line">    <span class="built_in">this</span>.findAll();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>添加用户</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">      &lt;el-button type=&quot;primary&quot; @click=&quot;toSave&quot;&gt;添加&lt;/el-button&gt;</span><br><span class="line">      &lt;!-- 表格数据 start --&gt;</span><br><span class="line">    &lt;el-table :data=&quot;dataPage.list&quot; stripe style=&quot;width: 100%&quot;&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;id&quot; label=&quot;编号&quot; width=&quot;100&quot;&gt; &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;username&quot; label=&quot;姓名&quot; width=&quot;100&quot;&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;phone&quot; label=&quot;手机&quot;&gt; &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;realName&quot; label=&quot;昵称&quot;&gt; &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;gender&quot; label=&quot;性别&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">          &#123;&#123; scope.row.gender === 0 ? &quot;男&quot; : &quot;女&quot; &#125;&#125;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;birthday&quot; label=&quot;生日&quot; width=&quot;150&quot;&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;registerTime&quot; label=&quot;注册时间&quot; width=&quot;150&quot;&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;status&quot; label=&quot;状态&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">          &#123;&#123; scope.row.status === 0 ? &quot;正常&quot; : &quot;禁用&quot; &#125;&#125;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;image&quot; label=&quot;头像&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">          &lt;img :src=&quot;scope.row.image&quot; alt=&quot;&quot; width=&quot;40px&quot; height=&quot;40px&quot; /&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;role.name&quot; label=&quot;角色&quot;&gt; &lt;/el-table-column&gt;</span><br><span class="line">      &lt;!-- 用户操作按钮 start --&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;操作&quot; width=&quot;150&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">          &lt;el-button size=&quot;mini&quot; @click=&quot;toUpdate(scope.row.id)&quot;</span><br><span class="line">            &gt;编辑&lt;/el-button</span><br><span class="line">          &gt;</span><br><span class="line">          &lt;el-button size=&quot;mini&quot; type=&quot;danger&quot; @click=&quot;deleteById(scope.row.id)&quot;</span><br><span class="line">            &gt;删除&lt;/el-button</span><br><span class="line">          &gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;!-- 用户操作按钮 end --&gt;</span><br><span class="line">    &lt;/el-table&gt;</span><br><span class="line">    &lt;!-- 表格数据 end--&gt;</span><br><span class="line">    &lt;!-- 分页 start --&gt;</span><br><span class="line">        &lt;el-pagination</span><br><span class="line">        @size-change=&quot;handleSizeChange&quot;</span><br><span class="line">        @current-change=&quot;handleCurrentChange&quot;</span><br><span class="line">        :current-page.sync=&quot;paramsPage.pageNumber&quot;</span><br><span class="line">        :page-sizes=&quot;[5, 10, 15, 25]&quot;</span><br><span class="line">        :page-size=&quot;paramsPage.pageSize&quot;</span><br><span class="line">        layout=&quot;sizes, prev, pager, next&quot;</span><br><span class="line">        :total=&quot;dataPage.total&quot;</span><br><span class="line">        &gt;</span><br><span class="line">        &lt;/el-pagination&gt;</span><br><span class="line">         &lt;!-- 分页 end --&gt;</span><br><span class="line">    &lt;!-- 添加对话框 start--&gt;</span><br><span class="line">    &lt;el-dialog title=&quot;添加用户&quot; :visible.sync=&quot;dialogFormVisible&quot;&gt;</span><br><span class="line">      &lt;el-form :model=&quot;user&quot; label-width=&quot;100px&quot;&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;昵称&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;user.username&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">         &lt;el-form-item label=&quot;真实姓名&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;user.realName&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;用户密码&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;user.password&quot; autocomplete=&quot;off&quot; show-password&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">         &lt;el-form-item label=&quot;电话&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;user.phone&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;生日&quot;&gt;</span><br><span class="line">          &lt;el-date-picker</span><br><span class="line">            v-model=&quot;user.birthday&quot;</span><br><span class="line">            type=&quot;datetime&quot;</span><br><span class="line">            placeholder=&quot;选择日期时间&quot;</span><br><span class="line">            value-format=&quot;yyyy-MM-dd HH:mm:ss&quot;</span><br><span class="line">          &gt;</span><br><span class="line">          &lt;/el-date-picker&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;用户性别&quot;&gt;</span><br><span class="line">          &lt;el-radio v-model=&quot;user.gender&quot; :label=&quot;0&quot;&gt;男&lt;/el-radio&gt;</span><br><span class="line">          &lt;el-radio v-model=&quot;user.gender&quot; :label=&quot;1&quot;&gt;女&lt;/el-radio&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;角色&quot;&gt;</span><br><span class="line">          &lt;el-select style=&quot;width: 100%&quot; v-model=&quot;user.roleId&quot; clearable placeholder=&quot;请选择&quot;&gt;</span><br><span class="line">            &lt;el-option</span><br><span class="line">              v-for=&quot;item in roleList&quot;</span><br><span class="line">              :key=&quot;item.id&quot;</span><br><span class="line">              :label=&quot;item.name&quot;</span><br><span class="line">              :value=&quot;item.id&quot;</span><br><span class="line">            &gt;&lt;/el-option&gt;</span><br><span class="line">          &lt;/el-select&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">      &lt;div slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">        &lt;el-button @click=&quot;dialogFormVisible = false&quot;&gt;取 消&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;saveUser&quot;&gt;确 定&lt;/el-button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/el-dialog&gt;</span><br><span class="line">    &lt;!-- 添加对话框 end --&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">// 注意 user.js导出的都是单个函数</span><br><span class="line">// import &#123; save, update, deleteById, query, updateStatus &#125; from &quot;@/api/user&quot;;</span><br><span class="line">import &#123; findByPage,insert &#125; from &quot;@/api/user.js&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line"> </span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      userList: [],</span><br><span class="line">      paramsPage: &#123;</span><br><span class="line">        // 查询传参page对象</span><br><span class="line">        pageNumber: 1,</span><br><span class="line">        pageSize: 5,</span><br><span class="line">        params: &#123;&#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      dataPage:&#123;&#125;,</span><br><span class="line">      dialogFormVisible: false,</span><br><span class="line">      user:&#123;&#125;,</span><br><span class="line">      roleList: &#123;&#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">     findRole()&#123;</span><br><span class="line">        roleApi</span><br><span class="line">        .findAll()</span><br><span class="line">        .then((resp) =&gt; &#123;</span><br><span class="line">          //this.$store.commit(&#x27;setRoleList&#x27;,resp.data);</span><br><span class="line">          this.roleList = resp.data;</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch((error) =&gt; &#123;</span><br><span class="line">          console.log(error);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    findAll() &#123;</span><br><span class="line">      findByPage(this.paramsPage)</span><br><span class="line">        .then((res) =&gt; &#123;</span><br><span class="line">         this.dataPage = res.data;</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch((error) =&gt; &#123;</span><br><span class="line">          console.log(error);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    handleSizeChange(val) &#123;</span><br><span class="line">      this.paramsPage.pageSize = val;</span><br><span class="line">      this.findAll();</span><br><span class="line">    &#125;,</span><br><span class="line">    handleCurrentChange(val) &#123;</span><br><span class="line">      this.paramsPage.pageNumber = val;</span><br><span class="line">      this.findAll();</span><br><span class="line">    &#125;,</span><br><span class="line">    toSave()&#123;</span><br><span class="line">        this.dialogFormVisible = true;</span><br><span class="line">    &#125;,</span><br><span class="line">    saveUser()&#123;</span><br><span class="line">        insert(this.user)</span><br><span class="line">            .then(res =&gt; &#123;</span><br><span class="line">                this.$message.success(res.msg);</span><br><span class="line">                this.dialogFormVisible = false;</span><br><span class="line">                // 清空值</span><br><span class="line">                this.user = &#123;&#125;;</span><br><span class="line">                this.findAll();</span><br><span class="line">            &#125;)</span><br><span class="line">            .catch(error=&gt;&#123;</span><br><span class="line">                console.log(error);</span><br><span class="line">            &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    this.findRole();</span><br><span class="line">    this.findAll();</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211216013916031.png" alt="image-20211216013916031"></p>
<h3 id="修改用户"><a href="#修改用户" class="headerlink" title="修改用户"></a>修改用户</h3><blockquote>
<p>约定 名字不可修改</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;el-button type=&quot;primary&quot; @click=&quot;toSave&quot;&gt;添加&lt;/el-button&gt;</span><br><span class="line">    &lt;!-- 表格数据 start --&gt;</span><br><span class="line">    &lt;el-table :data=&quot;dataPage.list&quot; stripe style=&quot;width: 100%&quot;&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;id&quot; label=&quot;编号&quot; width=&quot;100&quot;&gt; &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;username&quot; label=&quot;姓名&quot; width=&quot;100&quot;&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;phone&quot; label=&quot;手机&quot;&gt; &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;realName&quot; label=&quot;昵称&quot;&gt; &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;gender&quot; label=&quot;性别&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">          &#123;&#123; scope.row.gender === 0 ? &quot;男&quot; : &quot;女&quot; &#125;&#125;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;birthday&quot; label=&quot;生日&quot; width=&quot;150&quot;&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;registerTime&quot; label=&quot;注册时间&quot; width=&quot;150&quot;&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;status&quot; label=&quot;状态&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">          &#123;&#123; scope.row.status === 0 ? &quot;正常&quot; : &quot;禁用&quot; &#125;&#125;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;image&quot; label=&quot;头像&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">          &lt;img :src=&quot;scope.row.image&quot; alt=&quot;&quot; width=&quot;40px&quot; height=&quot;40px&quot; /&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;role.name&quot; label=&quot;角色&quot;&gt; &lt;/el-table-column&gt;</span><br><span class="line">      &lt;!-- 用户操作按钮 start --&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;操作&quot; width=&quot;150&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">          &lt;el-button size=&quot;mini&quot; type=&quot;primary&quot; @click=&quot;toUpdate(scope.row)&quot;</span><br><span class="line">            &gt;编辑&lt;/el-button</span><br><span class="line">          &gt;</span><br><span class="line">          &lt;el-button size=&quot;mini&quot; type=&quot;danger&quot; @click=&quot;deleteById(scope.row.id)&quot;</span><br><span class="line">            &gt;删除&lt;/el-button</span><br><span class="line">          &gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;!-- 用户操作按钮 end --&gt;</span><br><span class="line">    &lt;/el-table&gt;</span><br><span class="line">    &lt;!-- 表格数据 end--&gt;</span><br><span class="line">    &lt;!-- 分页 start --&gt;</span><br><span class="line">    &lt;el-pagination</span><br><span class="line">      @size-change=&quot;handleSizeChange&quot;</span><br><span class="line">      @current-change=&quot;handleCurrentChange&quot;</span><br><span class="line">      :current-page.sync=&quot;paramsPage.pageNumber&quot;</span><br><span class="line">      :page-sizes=&quot;[5, 10, 15, 25]&quot;</span><br><span class="line">      :page-size=&quot;paramsPage.pageSize&quot;</span><br><span class="line">      layout=&quot;sizes, prev, pager, next&quot;</span><br><span class="line">      :total=&quot;dataPage.total&quot;</span><br><span class="line">    &gt;</span><br><span class="line">    &lt;/el-pagination&gt;</span><br><span class="line">    &lt;!-- 分页 end --&gt;</span><br><span class="line">    &lt;!-- 添加对话框 start--&gt;</span><br><span class="line">    &lt;el-dialog title=&quot;添加用户&quot; :visible.sync=&quot;dialogFormVisible&quot;&gt;</span><br><span class="line">      &lt;el-form :model=&quot;user&quot; label-width=&quot;100px&quot;&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;昵称&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;user.username&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;真实姓名&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;user.realName&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;用户密码&quot;&gt;</span><br><span class="line">          &lt;el-input</span><br><span class="line">            v-model=&quot;user.password&quot;</span><br><span class="line">            autocomplete=&quot;off&quot;</span><br><span class="line">            show-password</span><br><span class="line">          &gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;电话&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;user.phone&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;生日&quot;&gt;</span><br><span class="line">          &lt;el-date-picker</span><br><span class="line">            v-model=&quot;user.birthday&quot;</span><br><span class="line">            type=&quot;datetime&quot;</span><br><span class="line">            placeholder=&quot;选择日期时间&quot;</span><br><span class="line">            value-format=&quot;yyyy-MM-dd HH:mm:ss&quot;</span><br><span class="line">          &gt;</span><br><span class="line">          &lt;/el-date-picker&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;用户性别&quot;&gt;</span><br><span class="line">          &lt;el-radio v-model=&quot;user.gender&quot; :label=&quot;0&quot;&gt;男&lt;/el-radio&gt;</span><br><span class="line">          &lt;el-radio v-model=&quot;user.gender&quot; :label=&quot;1&quot;&gt;女&lt;/el-radio&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;角色&quot;&gt;</span><br><span class="line">          &lt;el-select</span><br><span class="line">            style=&quot;width: 100%&quot;</span><br><span class="line">            v-model=&quot;user.roleId&quot;</span><br><span class="line">            clearable</span><br><span class="line">            placeholder=&quot;请选择&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            &lt;el-option</span><br><span class="line">              v-for=&quot;item in roleList&quot;</span><br><span class="line">              :key=&quot;item.id&quot;</span><br><span class="line">              :label=&quot;item.name&quot;</span><br><span class="line">              :value=&quot;item.id&quot;</span><br><span class="line">            &gt;&lt;/el-option&gt;</span><br><span class="line">          &lt;/el-select&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">      &lt;div slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">        &lt;el-button @click=&quot;dialogFormVisible = false&quot;&gt;取 消&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;saveUser&quot;&gt;确 定&lt;/el-button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/el-dialog&gt;</span><br><span class="line">    &lt;!-- 添加对话框 end --&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 修改抽屉 start --&gt;</span><br><span class="line">    &lt;el-drawer title=&quot;修改用户&quot; :visible.sync=&quot;drawer&quot; :direction=&quot;direction&quot;&gt;</span><br><span class="line">      &lt;!-- 复制对话框用户表单数据即可 --&gt;</span><br><span class="line">      &lt;el-form :model=&quot;user&quot; label-width=&quot;100px&quot;&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;昵称&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;user.username&quot; autocomplete=&quot;off&quot; readonly&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;真实姓名&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;user.realName&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;用户密码&quot;&gt;</span><br><span class="line">          &lt;el-input</span><br><span class="line">            v-model=&quot;user.password&quot;</span><br><span class="line">            autocomplete=&quot;off&quot;</span><br><span class="line">            show-password</span><br><span class="line">          &gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;电话&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;user.phone&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;生日&quot;&gt;</span><br><span class="line">          &lt;el-date-picker</span><br><span class="line">            v-model=&quot;user.birthday&quot;</span><br><span class="line">            type=&quot;datetime&quot;</span><br><span class="line">            placeholder=&quot;选择日期时间&quot;</span><br><span class="line">            value-format=&quot;yyyy-MM-dd HH:mm:ss&quot;</span><br><span class="line">          &gt;</span><br><span class="line">          &lt;/el-date-picker&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;用户性别&quot;&gt;</span><br><span class="line">          &lt;el-radio v-model=&quot;user.gender&quot; :label=&quot;0&quot;&gt;男&lt;/el-radio&gt;</span><br><span class="line">          &lt;el-radio v-model=&quot;user.gender&quot; :label=&quot;1&quot;&gt;女&lt;/el-radio&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;角色&quot;&gt;</span><br><span class="line">          &lt;el-select</span><br><span class="line">            style=&quot;width: 100%&quot;</span><br><span class="line">            v-model=&quot;user.roleId&quot;</span><br><span class="line">            clearable</span><br><span class="line">            placeholder=&quot;请选择&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            &lt;el-option</span><br><span class="line">              v-for=&quot;item in roleList&quot;</span><br><span class="line">              :key=&quot;item.id&quot;</span><br><span class="line">              :label=&quot;item.name&quot;</span><br><span class="line">              :value=&quot;item.id&quot;</span><br><span class="line">            &gt;&lt;/el-option&gt;</span><br><span class="line">          &lt;/el-select&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">        &lt;el-button @click=&quot;drawer = false&quot;&gt;取 消&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;updateUser&quot;&gt;确 定&lt;/el-button&gt;</span><br><span class="line">    &lt;/el-drawer&gt;</span><br><span class="line">    &lt;!-- 修改抽屉 end --&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">// 注意 user.js导出的都是单个函数</span><br><span class="line">// import &#123; save, update, deleteById, query, updateStatus &#125; from &quot;@/api/user&quot;;</span><br><span class="line">import &#123; findByPage, insert,update &#125; from &quot;@/api/user.js&quot;;</span><br><span class="line">import roleApi from &quot;@/api/role.js&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      userList: [],</span><br><span class="line">      paramsPage: &#123;</span><br><span class="line">        // 查询传参page对象</span><br><span class="line">        pageNumber: 1,</span><br><span class="line">        pageSize: 5,</span><br><span class="line">        params: &#123;&#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      dataPage: &#123;&#125;,</span><br><span class="line">      dialogFormVisible: false,</span><br><span class="line">      user: &#123;&#125;,</span><br><span class="line">      roleList: &#123;&#125;,</span><br><span class="line">      drawer: false, // 是否开启抽屉</span><br><span class="line">      direction: &quot;rtl&quot;// 抽屉打开方向</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  // watch必须放在data后面</span><br><span class="line">  // watch: &#123;</span><br><span class="line">  //   &quot;$store.getters.roleList&quot;: function (newVal, oldVal) &#123;</span><br><span class="line">  //     console.log(&#x27;new Val&#x27;);</span><br><span class="line">  //     console.log(newVal);</span><br><span class="line">  //     this.roleList = newVal;</span><br><span class="line">  //   &#125;,</span><br><span class="line">  // &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    findRole()&#123;</span><br><span class="line">        roleApi</span><br><span class="line">        .findAll()</span><br><span class="line">        .then((resp) =&gt; &#123;</span><br><span class="line">          //this.$store.commit(&#x27;setRoleList&#x27;,resp.data);</span><br><span class="line">          this.roleList = resp.data;</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch((error) =&gt; &#123;</span><br><span class="line">          console.log(error);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    findAll() &#123;</span><br><span class="line">      findByPage(this.paramsPage)</span><br><span class="line">        .then((res) =&gt; &#123;</span><br><span class="line">          this.dataPage = res.data;</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch((error) =&gt; &#123;</span><br><span class="line">          console.log(error);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    handleSizeChange(val) &#123;</span><br><span class="line">      this.paramsPage.pageSize = val;</span><br><span class="line">      this.findAll();</span><br><span class="line">    &#125;,</span><br><span class="line">    handleCurrentChange(val) &#123;</span><br><span class="line">      this.paramsPage.pageNumber = val;</span><br><span class="line">      this.findAll();</span><br><span class="line">    &#125;,</span><br><span class="line">    toSave() &#123;</span><br><span class="line">      this.dialogFormVisible = true;</span><br><span class="line">    &#125;,</span><br><span class="line">    saveUser() &#123;</span><br><span class="line">      insert(this.user)</span><br><span class="line">        .then((res) =&gt; &#123;</span><br><span class="line">          this.$message.success(res.msg);</span><br><span class="line">          this.dialogFormVisible = false;</span><br><span class="line">          // 清空值</span><br><span class="line">          this.user = &#123;&#125;;</span><br><span class="line">          this.findAll();</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch((error) =&gt; &#123;</span><br><span class="line">          console.log(error);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    toUpdate(row) &#123;</span><br><span class="line">      this.user = row; // 回显数据</span><br><span class="line">      this.drawer = true;</span><br><span class="line">    &#125;,</span><br><span class="line">    updateUser()&#123;</span><br><span class="line">      update(this.user)</span><br><span class="line">        .then(res =&gt; &#123;</span><br><span class="line">          this.$message.success(res.msg);</span><br><span class="line">          this.drawer = false;</span><br><span class="line">          this.user = &#123;&#125;;</span><br><span class="line">          this.findAll();</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    this.findRole();</span><br><span class="line">    this.findAll();</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="删除用户"><a href="#删除用户" class="headerlink" title="删除用户"></a>删除用户</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">deleteById</span>(<span class="params">id</span>)</span>&#123;</span><br><span class="line">        <span class="comment">//deleteById(id)</span></span><br><span class="line">        <span class="built_in">this</span>.$confirm(<span class="string">&quot;此操作将永久删除该文件, 是否继续?&quot;</span>, <span class="string">&quot;提示&quot;</span>, &#123;</span><br><span class="line">        <span class="attr">confirmButtonText</span>: <span class="string">&quot;确定&quot;</span>,</span><br><span class="line">        <span class="attr">cancelButtonText</span>: <span class="string">&quot;取消&quot;</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;warning&quot;</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">        .then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// 删除</span></span><br><span class="line">            deleteById(id).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.$message.success(<span class="string">&quot;删除成功&quot;</span>);</span><br><span class="line">            <span class="built_in">this</span>.findAll();</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">this</span>.$message(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;info&quot;</span>,</span><br><span class="line">            <span class="attr">message</span>: <span class="string">&quot;已取消删除&quot;</span>,</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="批量删除-2"><a href="#批量删除-2" class="headerlink" title="批量删除"></a>批量删除</h3><blockquote>
<p>需要提供批量选择框</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-button type=<span class="string">&quot;danger&quot;</span> @click=<span class="string">&quot;deleteBatch&quot;</span>&gt;批量删除&lt;/el-button&gt;</span><br><span class="line">    &lt;!-- @selection-change绑定多选事件 --&gt;</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">el-table</span> <span class="attr">:data</span>=<span class="string">&quot;dataPage.list&quot;</span> <span class="attr">stripe</span> <span class="attr">style</span>=<span class="string">&quot;width: 100%&quot;</span>  @<span class="attr">selection-change</span>=<span class="string">&quot;handleSelectionChange&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="comment">&lt;!-- 批量选择框 --&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">type</span>=<span class="string">&quot;selection&quot;</span> <span class="attr">width</span>=<span class="string">&quot;55&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">el-table</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取批量操作的值</span></span><br><span class="line">    <span class="function"><span class="title">handleSelectionChange</span>(<span class="params">val</span>)</span>&#123;</span><br><span class="line">      <span class="comment">// 默认val是批量的值的集合  此处只需要批量id 需要映射处理</span></span><br><span class="line">      <span class="built_in">this</span>.ids = val.map(<span class="function"><span class="params">item</span> =&gt;</span> item.id);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">deleteBatch</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">         <span class="built_in">this</span>.$confirm(<span class="string">&quot;此操作将永久删除该文件, 是否继续?&quot;</span>, <span class="string">&quot;提示&quot;</span>, &#123;</span><br><span class="line">        <span class="attr">confirmButtonText</span>: <span class="string">&quot;确定&quot;</span>,</span><br><span class="line">        <span class="attr">cancelButtonText</span>: <span class="string">&quot;取消&quot;</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;warning&quot;</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">        .then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 批量删除</span></span><br><span class="line">            deleteBatch(<span class="built_in">this</span>.ids).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.$message.success(<span class="string">&quot;删除成功&quot;</span>);</span><br><span class="line">            <span class="built_in">this</span>.findAll();</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">this</span>.$message(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;info&quot;</span>,</span><br><span class="line">            <span class="attr">message</span>: <span class="string">&quot;已取消删除&quot;</span>,</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211216110254387.png" alt="image-20211216110254387"></p>
<h3 id="禁用用户"><a href="#禁用用户" class="headerlink" title="禁用用户"></a>禁用用户</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"> &lt;!-- 用户操作按钮 start --&gt;</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;操作&quot;</span> <span class="attr">width</span>=<span class="string">&quot;300&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">template</span> <span class="attr">slot-scope</span>=<span class="string">&quot;scope&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;toUpdate(scope.row)&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            &gt;</span>编辑<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span> <span class="attr">type</span>=<span class="string">&quot;danger&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;deleteById(scope.row.id)&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            &gt;</span>删除<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">v-if</span>=<span class="string">&quot;scope.row.status== &#x27;0&#x27;&quot;</span>  <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span> <span class="attr">type</span>=<span class="string">&quot;danger&quot;</span> <span class="attr">plain</span> @<span class="attr">click</span>=<span class="string">&quot;updateStatus(scope.row.id,1)&quot;</span>&gt;</span>禁用<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">v-if</span>=<span class="string">&quot;scope.row.status== &#x27;1&#x27;&quot;</span>  <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">plain</span> @<span class="attr">click</span>=<span class="string">&quot;updateStatus(scope.row.id,0)&quot;</span>&gt;</span>启用<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span></span><br><span class="line">      &lt;!-- 用户操作按钮 end --&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改用户状态</span></span><br><span class="line">    <span class="function"><span class="title">updateStatus</span>(<span class="params">id,status</span>)</span>&#123;</span><br><span class="line">        updateStatus(id,status)</span><br><span class="line">          .then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.$message.success(res.msg);</span><br><span class="line">            <span class="built_in">this</span>.findAll();</span><br><span class="line">          &#125;)</span><br><span class="line">          .catch(<span class="function"><span class="params">error</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(error);</span><br><span class="line">          &#125;)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/vanse/images/raw/master/cms_mybatis/image-20211216111901944.png" alt="image-20211216111901944"></p>
<blockquote>
<p>页面格子太满 先将生日 注册时间等详情隐藏  将来需要查看详情提供接口即可</p>
</blockquote>
<h2 id="分类模块-1"><a href="#分类模块-1" class="headerlink" title="分类模块"></a>分类模块</h2><h3 id="api-1"><a href="#api-1" class="headerlink" title="api"></a>api</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> group_name = <span class="string">&#x27;/category&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">findAll</span>(<span class="params">data</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> request(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;group_name&#125;</span>/findAll`</span>,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">            data</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">findParentCategory</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> request(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;group_name&#125;</span>/findParentCategory`</span>,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>           </span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">save</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> request(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;group_name&#125;</span>/save`</span>,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">            data</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">update</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> request(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;group_name&#125;</span>/update`</span>,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;put&#x27;</span>,</span><br><span class="line">            data</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">deleteBatch</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> request(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;group_name&#125;</span>/deleteBatch`</span>,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;delete&#x27;</span>,</span><br><span class="line">            data</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">updateNo</span>(<span class="params">id,no</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> request(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;group_name&#125;</span>/updateNo/<span class="subst">$&#123;id&#125;</span>/<span class="subst">$&#123;no&#125;</span>`</span>,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;put&#x27;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="router-1"><a href="#router-1" class="headerlink" title="router"></a>router</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   <span class="attr">path</span>: <span class="string">&#x27;/category&#x27;</span>,</span><br><span class="line">   <span class="attr">name</span>: <span class="string">&#x27;分类管理&#x27;</span>,</span><br><span class="line">   <span class="attr">component</span>: Layout,</span><br><span class="line">   <span class="attr">redirect</span>: <span class="string">&#x27;/category/list&#x27;</span>,</span><br><span class="line">   <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;分类管理&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;table&#x27;</span> &#125;,</span><br><span class="line">   <span class="attr">children</span>: [</span><br><span class="line">     &#123;</span><br><span class="line">       <span class="attr">path</span>: <span class="string">&#x27;list&#x27;</span>,</span><br><span class="line">       <span class="attr">name</span>: <span class="string">&#x27;分类列表&#x27;</span>,</span><br><span class="line">       <span class="attr">hidden</span>: <span class="literal">true</span>,</span><br><span class="line">       <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/cms/category/list&#x27;</span>),</span><br><span class="line">       <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;分类列表&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;table&#x27;</span> &#125;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">   ]</span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure>



<h3 id="list-vue"><a href="#list-vue" class="headerlink" title="list.vue"></a>list.vue</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;el-button type=&quot;primary&quot; @click=&quot;toSave&quot;&gt;添加&lt;/el-button&gt;</span><br><span class="line">    &lt;el-button type=&quot;danger&quot; @click=&quot;deleteBatch&quot;&gt;批量删除&lt;/el-button&gt;</span><br><span class="line">    &lt;!-- 表格数据 start --&gt;</span><br><span class="line">    &lt;!-- @selection-change绑定多选事件 --&gt;</span><br><span class="line">    &lt;el-table</span><br><span class="line">      :data=&quot;dataPage.list&quot;</span><br><span class="line">      stripe</span><br><span class="line">      style=&quot;width: 100%&quot;</span><br><span class="line">      @selection-change=&quot;handleSelectionChange&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;!-- 批量选择框 --&gt;</span><br><span class="line">      &lt;el-table-column type=&quot;selection&quot; width=&quot;55&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;id&quot; label=&quot;编号&quot; width=&quot;50&quot;&gt; &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;name&quot; label=&quot;名称&quot; width=&quot;100&quot;&gt; &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;description&quot; label=&quot;描述&quot;&gt; &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;no&quot; label=&quot;序号&quot;&gt; &lt;/el-table-column&gt;</span><br><span class="line"></span><br><span class="line">      &lt;el-table-column prop=&quot;category.name&quot; label=&quot;父目录&quot;&gt; &lt;/el-table-column&gt;</span><br><span class="line">      &lt;!-- 用户操作按钮 start --&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;操作&quot; width=&quot;300&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">          &lt;el-button size=&quot;mini&quot; type=&quot;primary&quot; @click=&quot;toUpdate(scope.row)&quot;</span><br><span class="line">            &gt;编辑&lt;/el-button</span><br><span class="line">          &gt;</span><br><span class="line">          &lt;!-- &lt;el-button size=&quot;mini&quot; type=&quot;danger&quot;&gt;更新序号&lt;/el-button&gt; --&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;!-- 用户操作按钮 end --&gt;</span><br><span class="line">    &lt;/el-table&gt;</span><br><span class="line">    &lt;!-- 表格数据 end--&gt;</span><br><span class="line">    &lt;!-- 分页 start --&gt;</span><br><span class="line">    &lt;el-pagination</span><br><span class="line">      @size-change=&quot;handleSizeChange&quot;</span><br><span class="line">      @current-change=&quot;handleCurrentChange&quot;</span><br><span class="line">      :current-page.sync=&quot;paramsPage.pageNumber&quot;</span><br><span class="line">      :page-sizes=&quot;[5, 10, 15, 25]&quot;</span><br><span class="line">      :page-size=&quot;paramsPage.pageSize&quot;</span><br><span class="line">      layout=&quot;sizes, prev, pager, next&quot;</span><br><span class="line">      :total=&quot;dataPage.total&quot;</span><br><span class="line">    &gt;</span><br><span class="line">    &lt;/el-pagination&gt;</span><br><span class="line">    &lt;!-- 分页 end --&gt;</span><br><span class="line">    &lt;!-- 添加对话框 start--&gt;</span><br><span class="line">    &lt;el-dialog title=&quot;添加分类&quot; :visible.sync=&quot;dialogFormVisible&quot;&gt;</span><br><span class="line">      &lt;el-form :model=&quot;category&quot; label-width=&quot;100px&quot;&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;分类名称&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;category.name&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;分类描述&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;category.description&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">         &lt;el-form-item label=&quot;父目录&quot;&gt;</span><br><span class="line">          &lt;el-select</span><br><span class="line">            style=&quot;width: 100%&quot;</span><br><span class="line">            v-model=&quot;category.parentId&quot;</span><br><span class="line">            clearable</span><br><span class="line">            placeholder=&quot;请选择&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            &lt;el-option</span><br><span class="line">              v-for=&quot;item in parentCategory&quot;</span><br><span class="line">              :key=&quot;item.id&quot;</span><br><span class="line">              :label=&quot;item.name&quot;</span><br><span class="line">              :value=&quot;item.id&quot;</span><br><span class="line">            &gt;&lt;/el-option&gt;</span><br><span class="line">          &lt;/el-select&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">      &lt;div slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">        &lt;el-button @click=&quot;dialogFormVisible = false&quot;&gt;取 消&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;save&quot;&gt;确 定&lt;/el-button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/el-dialog&gt;</span><br><span class="line">    &lt;!-- 添加对话框 end --&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 修改抽屉 start --&gt;</span><br><span class="line">    &lt;!-- 复制对话框用户表单数据即可 --&gt;</span><br><span class="line">    &lt;el-drawer title=&quot;修改用户&quot; :visible.sync=&quot;drawer&quot; :direction=&quot;direction&quot;&gt;</span><br><span class="line">      &lt;el-form :model=&quot;category&quot; label-width=&quot;100px&quot;&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;名称&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;category.name&quot; autocomplete=&quot;off&quot; readonly&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;描述&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;category.description&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">         &lt;el-form-item label=&quot;分类序号&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;category.no&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;父目录&quot;&gt;</span><br><span class="line">          &lt;el-select</span><br><span class="line">            style=&quot;width: 100%&quot;</span><br><span class="line">            v-model=&quot;category.parentId&quot;</span><br><span class="line">            clearable</span><br><span class="line">            placeholder=&quot;请选择&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            &lt;el-option</span><br><span class="line">              v-for=&quot;item in parentCategory&quot;</span><br><span class="line">              :key=&quot;item.id&quot;</span><br><span class="line">              :label=&quot;item.name&quot;</span><br><span class="line">              :value=&quot;item.id&quot;</span><br><span class="line">            &gt;&lt;/el-option&gt;</span><br><span class="line">          &lt;/el-select&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">        &lt;el-button @click=&quot;drawer = false&quot;&gt;取 消&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;update&quot;&gt;确 定&lt;/el-button&gt;</span><br><span class="line">    &lt;/el-drawer&gt;</span><br><span class="line">    &lt;!-- 修改抽屉 end --&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import categoryApi from &#x27;@/api/category&#x27;</span><br><span class="line">import category from &#x27;@/api/category&#x27;;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      paramsPage: &#123;</span><br><span class="line">        // 分页传参数据</span><br><span class="line">        // 查询传参page对象</span><br><span class="line">        pageNumber: 1,</span><br><span class="line">        pageSize: 5,</span><br><span class="line">        params: &#123;&#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      dataPage: &#123;&#125;,</span><br><span class="line">      dialogFormVisible: false,</span><br><span class="line">      category: &#123;&#125;,</span><br><span class="line">      drawer: false,  // 抽屉</span><br><span class="line">      direction: &quot;rtl&quot;,// 抽屉打开方向</span><br><span class="line">      ids: [],  // 批量删除id数组</span><br><span class="line">      parentCategory: []</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    findAll() &#123;</span><br><span class="line">        categoryApi.findAll(this.paramsPage)</span><br><span class="line">          .then(res =&gt; &#123;</span><br><span class="line">            this.dataPage = res.data;</span><br><span class="line">          &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    handleSelectionChange(val)&#123;</span><br><span class="line">        this.ids = val.map(item =&gt; item.id);</span><br><span class="line">    &#125;,</span><br><span class="line">    handleSizeChange(val)&#123;</span><br><span class="line">        this.paramsPage.pageSize = val;</span><br><span class="line">        this.findAll();</span><br><span class="line">    &#125;,</span><br><span class="line">    handleCurrentChange(val)&#123;</span><br><span class="line">        this.paramsPage.pageNumber = val;</span><br><span class="line">        this.findAll();</span><br><span class="line">    &#125;,</span><br><span class="line">    toSave() &#123;</span><br><span class="line">      this.findParentCategory();</span><br><span class="line">      this.dialogFormVisible = true;</span><br><span class="line">    &#125;,</span><br><span class="line">    findParentCategory()&#123;</span><br><span class="line">      categoryApi.findParentCategory()</span><br><span class="line">        .then(res=&gt;&#123;</span><br><span class="line">          this.parentCategory = res.data;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    save() &#123;</span><br><span class="line">      categoryApi.save(this.category)</span><br><span class="line">        .then(res=&gt;&#123;</span><br><span class="line">          this.$message.success(res.msg);</span><br><span class="line">          this.findAll();</span><br><span class="line">          this.dialogFormVisible = false;</span><br><span class="line">          this.category=&#123;&#125;;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    toUpdate(row)&#123;</span><br><span class="line">      categoryApi.findParentCategory()</span><br><span class="line">      this.category = row;</span><br><span class="line">      this.drawer = true;</span><br><span class="line">    &#125;,</span><br><span class="line">    update() &#123;</span><br><span class="line">      category.update(this.category)</span><br><span class="line">        .then(res=&gt;&#123;</span><br><span class="line">          this.$message.success(res.msg);</span><br><span class="line">          this.drawer = false;</span><br><span class="line">          this.findAll();</span><br><span class="line">          this.category = &#123;&#125;;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    updateNo() &#123;</span><br><span class="line">      categoryApi.updateNo(id,no)</span><br><span class="line">    &#125;,</span><br><span class="line">    deleteBatch() &#123;</span><br><span class="line">      categoryApi.deleteBatch(this.ids)</span><br><span class="line">        .then(res=&gt;&#123;</span><br><span class="line">          this.$message.success(res.msg);</span><br><span class="line">          this.findAll();</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    this.findParentCategory(); // 必须加 否则更新无法使用父目录</span><br><span class="line">    this.findAll();</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p><img src="image/image-20211219183505648.png" alt="image-20211219183505648"></p>
<h2 id="文章模块-1"><a href="#文章模块-1" class="headerlink" title="文章模块"></a>文章模块</h2><blockquote>
<p>对于管理系统来说 文章只有查询 审核 删除 (新增 修改是门户网站的功能)</p>
</blockquote>
<h3 id="api-2"><a href="#api-2" class="headerlink" title="api"></a>api</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> group_name = <span class="string">&#x27;/article&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">// 分页查询文章 也可查询某分类下的文章</span></span><br><span class="line">    <span class="function"><span class="title">findAll</span>(<span class="params">data</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> request(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;group_name&#125;</span>/findAll`</span>,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">            data</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">deleteById</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> request(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;group_name&#125;</span>/delete/<span class="subst">$&#123;data&#125;</span>`</span>,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;delete&#x27;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">deleteBatch</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> request(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;group_name&#125;</span>/deleteBatch`</span>,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;delete&#x27;</span>,</span><br><span class="line">            data</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">updateStatus</span>(<span class="params">id,status</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> request(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;group_name&#125;</span>/updateStatus/<span class="subst">$&#123;id&#125;</span>/<span class="subst">$&#123;status&#125;</span>`</span>,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;put&#x27;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="router-2"><a href="#router-2" class="headerlink" title="router"></a>router</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/article&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;文章管理&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: Layout,</span><br><span class="line">    <span class="attr">redirect</span>: <span class="string">&#x27;/article/list&#x27;</span>,</span><br><span class="line">    <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;文章管理&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;table&#x27;</span> &#125;,</span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;list&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;文章列表&#x27;</span>,</span><br><span class="line">        <span class="attr">hidden</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/cms/article/list&#x27;</span>),</span><br><span class="line">        <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;文章列表&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;table&#x27;</span> &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>



<h3 id="list-vue-1"><a href="#list-vue-1" class="headerlink" title="list.vue"></a>list.vue</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;el-button size=&quot;mini&quot; type=&quot;danger&quot; @click=&quot;deleteBatch&quot;</span><br><span class="line">      &gt;批量删除&lt;/el-button</span><br><span class="line">    &gt;</span><br><span class="line">    &lt;!-- 表格数据 start --&gt;</span><br><span class="line">    &lt;!-- @selection-change绑定多选事件 --&gt;</span><br><span class="line">    &lt;el-table</span><br><span class="line">      :data=&quot;dataPage.list&quot;</span><br><span class="line">      stripe</span><br><span class="line">      style=&quot;width: 100%&quot;</span><br><span class="line">      @selection-change=&quot;handleSelectionChange&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;!-- 批量选择框 --&gt;</span><br><span class="line">      &lt;el-table-column type=&quot;selection&quot; width=&quot;55&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;id&quot; label=&quot;编号&quot; width=&quot;50&quot;&gt; &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;title&quot; label=&quot;标题&quot; width=&quot;100&quot;&gt; &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;readTimes&quot; label=&quot;阅读量&quot;&gt; &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;thumbUp&quot; label=&quot;赞数&quot;&gt; &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;thumbDown&quot; label=&quot;踩数&quot;&gt; &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;publishTime&quot; label=&quot;发布时间&quot; width=&quot;150&quot;&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;status&quot; label=&quot;状态&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">          &lt;span v-if=&quot;scope.row.status == 0&quot;&gt;未审核&lt;/span&gt;</span><br><span class="line">          &lt;span v-if=&quot;scope.row.status == 1&quot;&gt;通过&lt;/span&gt;</span><br><span class="line">          &lt;span v-if=&quot;scope.row.status == 2&quot;&gt;驳回&lt;/span&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;category.name&quot; label=&quot;分类&quot;&gt; &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;user.username&quot; label=&quot;作者&quot;&gt; &lt;/el-table-column&gt;</span><br><span class="line">      &lt;!-- 用户操作按钮 start --&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;操作&quot; width=&quot;300&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">          &lt;el-button size=&quot;mini&quot; type=&quot;danger&quot; @click=&quot;deleteById(scope.row.id)&quot;</span><br><span class="line">            &gt;删除&lt;/el-button</span><br><span class="line">          &gt;</span><br><span class="line">          &lt;el-button</span><br><span class="line">            size=&quot;mini&quot;</span><br><span class="line">            type=&quot;primary&quot;</span><br><span class="line">            @click=&quot;toUpdateStatus(scope.row)&quot;</span><br><span class="line">            &gt;审核&lt;/el-button</span><br><span class="line">          &gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;!-- 用户操作按钮 end --&gt;</span><br><span class="line">    &lt;/el-table&gt;</span><br><span class="line">    &lt;!-- 表格数据 end--&gt;</span><br><span class="line">    &lt;!-- 分页 start --&gt;</span><br><span class="line">    &lt;el-pagination</span><br><span class="line">      @size-change=&quot;handleSizeChange&quot;</span><br><span class="line">      @current-change=&quot;handleCurrentChange&quot;</span><br><span class="line">      :current-page.sync=&quot;paramsPage.pageNumber&quot;</span><br><span class="line">      :page-sizes=&quot;[5, 10, 15, 25]&quot;</span><br><span class="line">      :page-size=&quot;paramsPage.pageSize&quot;</span><br><span class="line">      layout=&quot;sizes, prev, pager, next&quot;</span><br><span class="line">      :total=&quot;dataPage.total&quot;</span><br><span class="line">    &gt;</span><br><span class="line">    &lt;/el-pagination&gt;</span><br><span class="line">    &lt;!-- 分页 end --&gt;</span><br><span class="line">    &lt;!-- 添加对话框 start--&gt;</span><br><span class="line">    &lt;el-dialog title=&quot;审核&quot; :visible.sync=&quot;dialogFormVisible&quot;&gt;</span><br><span class="line">      &lt;el-form :model=&quot;article&quot; label-width=&quot;100px&quot;&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;内容&quot;&gt;</span><br><span class="line">          &lt;el-input</span><br><span class="line">            type=&quot;textarea&quot;</span><br><span class="line">            :rows=&quot;20&quot;</span><br><span class="line">            v-model=&quot;article.content&quot;</span><br><span class="line">            autocomplete=&quot;off&quot;</span><br><span class="line">          &gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">      &lt;div slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;pass(article.id,1)&quot;&gt;通过&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;warning&quot; @click=&quot;nopass(article.id,2)&quot;&gt;驳回&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button @click=&quot;dialogFormVisible = false&quot;&gt;取 消&lt;/el-button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/el-dialog&gt;</span><br><span class="line">    &lt;!-- 添加对话框 end --&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import articleApi from &quot;@/api/article&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      paramsPage: &#123;</span><br><span class="line">        pageNumber: 1,</span><br><span class="line">        pageSize: 5,</span><br><span class="line">        params: &#123;&#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      dataPage: &#123;&#125;,</span><br><span class="line">      ids: [],</span><br><span class="line">      dialogFormVisible: false,</span><br><span class="line">      article: &#123;&#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    findAll() &#123;</span><br><span class="line">      articleApi.findAll(this.paramsPage).then((res) =&gt; &#123;</span><br><span class="line">        this.dataPage = res.data;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    handleSizeChange(val) &#123;</span><br><span class="line">      this.paramsPage.pageSize = val;</span><br><span class="line">      this.findAll();</span><br><span class="line">    &#125;,</span><br><span class="line">    handleCurrentChange(val) &#123;</span><br><span class="line">      this.paramsPage.pageNumber = val;</span><br><span class="line">      this.findAll();</span><br><span class="line">    &#125;,</span><br><span class="line">    toUpdateStatus(row) &#123;</span><br><span class="line">      this.dialogFormVisible = true;</span><br><span class="line">      this.article = row;</span><br><span class="line">    &#125;,</span><br><span class="line">    pass(id,status) &#123;</span><br><span class="line">      articleApi.updateStatus(id,status)</span><br><span class="line">        .then(res=&gt;&#123;</span><br><span class="line">            this.$message.success(res.msg);</span><br><span class="line">            this.findAll();</span><br><span class="line">        &#125;)</span><br><span class="line">      this.dialogFormVisible = false;</span><br><span class="line">    &#125;,</span><br><span class="line">    nopass(id,status) &#123;</span><br><span class="line">       articleApi.updateStatus(id,status)</span><br><span class="line">        .then(res=&gt;&#123;</span><br><span class="line">            this.$message.success(res.msg);</span><br><span class="line">            this.findAll();</span><br><span class="line">        &#125;)</span><br><span class="line">      this.dialogFormVisible = false;</span><br><span class="line">    &#125;,</span><br><span class="line">    deleteById(id) &#123;</span><br><span class="line">      articleApi.deleteById(id).then((res) =&gt; &#123;</span><br><span class="line">        this.$message.success(res.msg);</span><br><span class="line">        this.findAll();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    handleSelectionChange(val) &#123;</span><br><span class="line">      this.ids = val.map((item) =&gt; item.id);</span><br><span class="line">    &#125;,</span><br><span class="line">    deleteBatch() &#123;</span><br><span class="line">      articleApi.deleteBatch(this.ids).then((res) =&gt; &#123;</span><br><span class="line">        this.$message.success(res.msg);</span><br><span class="line">        this.findAll();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    this.findAll();</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p><img src="image/image-20211219233636832.png" alt="image-20211219233636832"></p>
<p><img src="image/image-20211219233646916.png" alt="image-20211219233646916"></p>
<h2 id="评论模块"><a href="#评论模块" class="headerlink" title="评论模块"></a>评论模块</h2><blockquote>
<p>添加评论是门户网站的功能</p>
</blockquote>
<h3 id="api-3"><a href="#api-3" class="headerlink" title="api"></a>api</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> group_name = <span class="string">&#x27;/comment&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">findAll</span>(<span class="params">data</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> request(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;group_name&#125;</span>/findAll`</span>,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">            data</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">deleteBatch</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> request(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;group_name&#125;</span>/deleteBatch`</span>,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;delete&#x27;</span>,</span><br><span class="line">            data</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="router-3"><a href="#router-3" class="headerlink" title="router"></a>router</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   <span class="attr">path</span>: <span class="string">&#x27;/comment&#x27;</span>,</span><br><span class="line">   <span class="attr">name</span>: <span class="string">&#x27;评论管理&#x27;</span>,</span><br><span class="line">   <span class="attr">component</span>: Layout,</span><br><span class="line">   <span class="attr">redirect</span>: <span class="string">&#x27;/comment/list&#x27;</span>,</span><br><span class="line">   <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;评论管理&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;table&#x27;</span> &#125;,</span><br><span class="line">   <span class="attr">children</span>: [</span><br><span class="line">     &#123;</span><br><span class="line">       <span class="attr">path</span>: <span class="string">&#x27;list&#x27;</span>,</span><br><span class="line">       <span class="attr">name</span>: <span class="string">&#x27;评论列表&#x27;</span>,</span><br><span class="line">       <span class="attr">hidden</span>: <span class="literal">true</span>,</span><br><span class="line">       <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/cms/comment/list&#x27;</span>),</span><br><span class="line">       <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;评论列表&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;table&#x27;</span> &#125;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">   ]</span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure>



<h3 id="vue"><a href="#vue" class="headerlink" title="vue"></a>vue</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span> <span class="attr">type</span>=<span class="string">&quot;danger&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;deleteBatch&quot;</span>&gt;</span>批量删除<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- 表格数据 start --&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- @selection-change绑定多选事件 --&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">el-table</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">      <span class="attr">:data</span>=<span class="string">&quot;dataPage.list&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">      <span class="attr">stripe</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">      <span class="attr">style</span>=<span class="string">&quot;width: 100%&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">      @<span class="attr">selection-change</span>=<span class="string">&quot;handleSelectionChange&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">    &gt;</span></span></span><br><span class="line"><span class="xml">      <span class="comment">&lt;!-- 批量选择框 --&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">type</span>=<span class="string">&quot;selection&quot;</span> <span class="attr">width</span>=<span class="string">&quot;55&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">prop</span>=<span class="string">&quot;id&quot;</span> <span class="attr">label</span>=<span class="string">&quot;编号&quot;</span> <span class="attr">width</span>=<span class="string">&quot;50&quot;</span>&gt;</span> <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">prop</span>=<span class="string">&quot;content&quot;</span> <span class="attr">label</span>=<span class="string">&quot;内容&quot;</span> <span class="attr">width</span>=<span class="string">&quot;100&quot;</span>&gt;</span> <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">prop</span>=<span class="string">&quot;time&quot;</span> <span class="attr">label</span>=<span class="string">&quot;发布时间&quot;</span> <span class="attr">width</span>=<span class="string">&quot;150&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">prop</span>=<span class="string">&quot;comment.content&quot;</span> <span class="attr">label</span>=<span class="string">&quot;父评论&quot;</span>&gt;</span> <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">prop</span>=<span class="string">&quot;article.title&quot;</span> <span class="attr">label</span>=<span class="string">&quot;文章&quot;</span>&gt;</span> <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">prop</span>=<span class="string">&quot;user.username&quot;</span> <span class="attr">label</span>=<span class="string">&quot;作者&quot;</span>&gt;</span> <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">el-table</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- 表格数据 end--&gt;</span></span></span><br><span class="line"><span class="xml">     <span class="comment">&lt;!-- 分页 start --&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">el-pagination</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">      @<span class="attr">size-change</span>=<span class="string">&quot;handleSizeChange&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">      @<span class="attr">current-change</span>=<span class="string">&quot;handleCurrentChange&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">      <span class="attr">:current-page.sync</span>=<span class="string">&quot;paramsPage.pageNumber&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">      <span class="attr">:page-sizes</span>=<span class="string">&quot;[5, 10, 15, 25]&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">      <span class="attr">:page-size</span>=<span class="string">&quot;paramsPage.pageSize&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">      <span class="attr">layout</span>=<span class="string">&quot;sizes, prev, pager, next&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">      <span class="attr">:total</span>=<span class="string">&quot;dataPage.total&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">    &gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">el-pagination</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- 分页 end --&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span></span><br><span class="line"><span class="javascript"><span class="xml"><span class="keyword">import</span> commentApi <span class="keyword">from</span> <span class="string">&#x27;@/api/comment&#x27;</span></span></span></span><br><span class="line"><span class="javascript"><span class="xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">    <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">      <span class="attr">paramsPage</span>: &#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">        <span class="comment">// 分页传参数据</span></span></span></span><br><span class="line"><span class="javascript"><span class="xml">        <span class="comment">// 查询传参page对象</span></span></span></span><br><span class="line"><span class="javascript"><span class="xml">        <span class="attr">pageNumber</span>: <span class="number">1</span>,</span></span></span><br><span class="line"><span class="javascript"><span class="xml">        <span class="attr">pageSize</span>: <span class="number">5</span>,</span></span></span><br><span class="line"><span class="javascript"><span class="xml">        <span class="attr">params</span>: &#123;&#125;,</span></span></span><br><span class="line"><span class="javascript"><span class="xml">      &#125;,</span></span></span><br><span class="line"><span class="javascript"><span class="xml">      <span class="attr">dataPage</span>: &#123;&#125;,</span></span></span><br><span class="line"><span class="javascript"><span class="xml">      <span class="attr">ids</span>: [], <span class="comment">// 批量删除id数组</span></span></span></span><br><span class="line"><span class="javascript"><span class="xml">    &#125;;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">  &#125;,</span></span></span><br><span class="line"><span class="javascript"><span class="xml">  <span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">    <span class="function"><span class="title">findAll</span>(<span class="params"></span>)</span> &#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">        commentApi.findAll(<span class="built_in">this</span>.paramsPage)</span></span></span><br><span class="line"><span class="javascript"><span class="xml">            .then(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">                <span class="built_in">this</span>.dataPage = res.data;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">            &#125;)</span></span></span><br><span class="line"><span class="javascript"><span class="xml">    &#125;,</span></span></span><br><span class="line"><span class="javascript"><span class="xml">     <span class="function"><span class="title">handleSizeChange</span>(<span class="params">val</span>)</span> &#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">      <span class="built_in">this</span>.paramsPage.pageSize = val;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">      <span class="built_in">this</span>.findAll();</span></span></span><br><span class="line"><span class="javascript"><span class="xml">    &#125;,</span></span></span><br><span class="line"><span class="javascript"><span class="xml">    <span class="function"><span class="title">handleCurrentChange</span>(<span class="params">val</span>)</span> &#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">      <span class="built_in">this</span>.paramsPage.pageNumber = val;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">      <span class="built_in">this</span>.findAll();</span></span></span><br><span class="line"><span class="javascript"><span class="xml">    &#125;,</span></span></span><br><span class="line"><span class="javascript"><span class="xml">    <span class="function"><span class="title">handleSelectionChange</span>(<span class="params">val</span>)</span>&#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">        <span class="built_in">this</span>.ids = val.map(<span class="function"><span class="params">item</span>=&gt;</span>item.id);</span></span></span><br><span class="line"><span class="javascript"><span class="xml">    &#125;,</span></span></span><br><span class="line"><span class="javascript"><span class="xml">    <span class="function"><span class="title">deleteBatch</span>(<span class="params"></span>)</span> &#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">        commentApi.deleteBatch(<span class="built_in">this</span>.ids)</span></span></span><br><span class="line"><span class="javascript"><span class="xml">             .then(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">                <span class="built_in">this</span>.$message.success(res.msg);</span></span></span><br><span class="line"><span class="javascript"><span class="xml">                <span class="built_in">this</span>.findAll();</span></span></span><br><span class="line"><span class="javascript"><span class="xml">            &#125;)</span></span></span><br><span class="line"><span class="javascript"><span class="xml">    &#125;,</span></span></span><br><span class="line"><span class="javascript"><span class="xml">  &#125;,</span></span></span><br><span class="line"><span class="javascript"><span class="xml">  <span class="function"><span class="title">created</span>(<span class="params"></span>)</span> &#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">    <span class="built_in">this</span>.findAll();</span></span></span><br><span class="line"><span class="javascript"><span class="xml">  &#125;,</span></span></span><br><span class="line"><span class="javascript"><span class="xml">&#125;;</span></span></span><br><span class="line"><span class="javascript"><span class="xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>





<h1 id="头像上传"><a href="#头像上传" class="headerlink" title="头像上传"></a>头像上传</h1><h2 id="后端"><a href="#后端" class="headerlink" title="后端"></a>后端</h2><p><strong>QiniuUtil</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.cms.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.gson.Gson;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.common.QiniuException;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.common.Zone;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.http.Response;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.storage.BucketManager;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.storage.Configuration;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.storage.UploadManager;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.storage.model.DefaultPutRet;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.util.Auth;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> okhttp3.OkHttpClient;</span><br><span class="line"><span class="keyword">import</span> okhttp3.Request;</span><br><span class="line"><span class="keyword">import</span> okhttp3.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 七牛云工具类</span></span><br><span class="line"><span class="comment"> * http://r3tsx6mgn.hn-bkt.clouddn.com/ 域名</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QiniuUtil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String accessKey = <span class="string">&quot;M1J6WgMIOisq7Bg8vyCii3SKe9GMGNOgtmUhVWWT&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String secretKey = <span class="string">&quot;gOCD2k-nsqnTqU3u-s-WmTd8YXXZGvRlnpaVt_iC&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String bucket = <span class="string">&quot;cms-briup1&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String BASE_URL = <span class="string">&quot;http://r4el9vwrh.hd-bkt.clouddn.com/&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String upToken;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> UploadManager uploadManager;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> BucketManager bucketManager;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        <span class="comment">// 构造一个带指定Zone对象的配置类  东区</span></span><br><span class="line">        Configuration cfg = <span class="keyword">new</span> Configuration(Zone.zone0());</span><br><span class="line">        <span class="comment">// 获取上传管理器</span></span><br><span class="line">        uploadManager = <span class="keyword">new</span> UploadManager(cfg);</span><br><span class="line">        <span class="comment">// 默认不指定key的情况下，以文件内容的hash值作为文件名</span></span><br><span class="line">        Auth auth = Auth.create(accessKey, secretKey);</span><br><span class="line">        <span class="comment">// 获取空间（bucket）管理器</span></span><br><span class="line">        bucketManager = <span class="keyword">new</span> BucketManager(auth, cfg);</span><br><span class="line">        <span class="comment">// 获取上传token</span></span><br><span class="line">        upToken = auth.uploadToken(bucket);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * @Description 上传文件到七牛云</span></span><br><span class="line"><span class="comment">     * @Date 2021/6/1 9:21</span></span><br><span class="line"><span class="comment">     * @Param [filePath: 需要上传文件的位置, fileName: 指定存在七牛云的标识,不传有默认值]</span></span><br><span class="line"><span class="comment">     * @return void</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">upload2Qiniu</span><span class="params">(String filePath, String fileName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Response response = uploadManager.put(filePath, fileName, upToken);</span><br><span class="line">            <span class="comment">//解析上传成功的结果</span></span><br><span class="line">            DefaultPutRet putRet = <span class="keyword">new</span> Gson().fromJson(response.bodyString(), DefaultPutRet.class);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (QiniuException ex) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;上传七牛云图片失败 &#123;&#125;&quot;</span>,ex.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * @Description 上传文件到七牛云</span></span><br><span class="line"><span class="comment">     * @Date 2021/6/1 9:21</span></span><br><span class="line"><span class="comment">     * @Param [filePath: 需要上传文件的字节数组: 指定存在七牛云的标识,不传有默认值]</span></span><br><span class="line"><span class="comment">     * @return String  返回七牛云的标识  后续通过拼接域名+标识即可访问到图片</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">upload2Qiniu</span><span class="params">(<span class="keyword">byte</span>[] bytes, String fileName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Response response = uploadManager.put(bytes, fileName, upToken);</span><br><span class="line">            <span class="comment">//解析上传成功的结果</span></span><br><span class="line">            DefaultPutRet putRet = <span class="keyword">new</span> Gson().fromJson(response.bodyString(), DefaultPutRet.class);</span><br><span class="line">            <span class="keyword">return</span> putRet.key;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (QiniuException ex) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;上传七牛云图片失败 &#123;&#125;&quot;</span>,ex.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重载方法: 上传到七牛云 不传唯一标识</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">upload2Qiniu</span><span class="params">(<span class="keyword">byte</span>[] bytes)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> upload2Qiniu(bytes,<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * @Description `删除七牛云的文件</span></span><br><span class="line"><span class="comment">     * @Date 2021/6/1 9:22</span></span><br><span class="line"><span class="comment">     * @Param [fileName] 七牛云的唯一标识</span></span><br><span class="line"><span class="comment">     * @return void</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">deleteFileFromQiniu</span><span class="params">(String fileName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            bucketManager.delete(bucket, fileName);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (QiniuException ex) &#123;</span><br><span class="line">            <span class="comment">//如果遇到异常，说明删除失败</span></span><br><span class="line">            log.error(<span class="string">&quot;删除七牛云图片失败 &#123;&#125; &#123;&#125;&quot;</span>,ex.code(),ex.response.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">deleteFileFromQiniu</span><span class="params">(List&lt;String&gt; list)</span> </span>&#123;</span><br><span class="line">        list.forEach(QiniuUtil::deleteFileFromQiniu);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * @Description 通过http get下载图片资源</span></span><br><span class="line"><span class="comment">    * @Date 2021/6/1 9:24</span></span><br><span class="line"><span class="comment">    * @Param [url: 七牛云地址, filepath: 下载位置, picKey: 将来拼接filepath+picKye拼接本地下载路径]</span></span><br><span class="line"><span class="comment">    * @return void</span></span><br><span class="line"><span class="comment">    **/</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">download</span><span class="params">(String filepath, String picKey)</span> </span>&#123;</span><br><span class="line">        String url = BASE_URL + picKey;</span><br><span class="line">        OkHttpClient client = <span class="keyword">new</span> OkHttpClient();</span><br><span class="line">        Request req = <span class="keyword">new</span> Request.Builder().url(url).build();</span><br><span class="line">        okhttp3.Response resp = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            resp = client.newCall(req).execute();</span><br><span class="line">            <span class="keyword">if</span> (resp.isSuccessful()) &#123;</span><br><span class="line">                ResponseBody body = resp.body();</span><br><span class="line">                InputStream is = body.byteStream();</span><br><span class="line">                <span class="keyword">byte</span>[] data = readInputStream(is);</span><br><span class="line"></span><br><span class="line">                <span class="comment">//判断文件夹是否存在，不存在则创建</span></span><br><span class="line">                File file = <span class="keyword">new</span> File(filepath);</span><br><span class="line">                <span class="keyword">if</span> (!file.exists() &amp;&amp; !file.isDirectory()) &#123;</span><br><span class="line">                    file.mkdirs();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(!filepath.endsWith(<span class="string">&quot;/&quot;</span>))&#123;</span><br><span class="line">                    filepath = filepath+<span class="string">&quot;/&quot;</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                File imgFile = <span class="keyword">new</span> File(filepath + picKey + <span class="string">&quot;.jpg&quot;</span>);</span><br><span class="line">                FileOutputStream fops = <span class="keyword">new</span> FileOutputStream(imgFile);</span><br><span class="line">                fops.write(data);</span><br><span class="line">                fops.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            log.error(<span class="string">&quot;下载七牛云图片失败&#123;&#125;&quot;</span>,e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 读取字节输入流内容</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> is</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] readInputStream(InputStream is) &#123;</span><br><span class="line">        ByteArrayOutputStream writer = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">        <span class="keyword">byte</span>[] buff = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span> * <span class="number">2</span>];</span><br><span class="line">        <span class="keyword">int</span> len = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> ((len = is.read(buff)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                writer.write(buff, <span class="number">0</span>, len);</span><br><span class="line">            &#125;</span><br><span class="line">            is.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> writer.toByteArray();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//FileInputStream file = new FileInputStream();</span></span><br><span class="line">        upload2Qiniu(<span class="string">&quot;C:\\Users\\vanse\\Pictures\\bg.jpg&quot;</span>,<span class="string">&quot;bg&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/upload&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;文件上传&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UploadController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    <span class="meta">@PostMapping(&quot;/image&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">uploadImage</span><span class="params">(MultipartFile file)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">       String image = QiniuUtil.upload2Qiniu(file.getBytes(), file.getOriginalFilename());</span><br><span class="line">        <span class="keyword">return</span> Result.success( QiniuUtil.BASE_URL+image);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h2><p>user.vue</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;el-button type=&quot;primary&quot; @click=&quot;toSave&quot;&gt;添加&lt;/el-button&gt;</span><br><span class="line">    &lt;el-button type=&quot;danger&quot; @click=&quot;deleteBatch&quot;&gt;批量删除&lt;/el-button&gt;</span><br><span class="line">    &lt;!-- 表格数据 start --&gt;</span><br><span class="line">    &lt;!-- @selection-change绑定多选事件 --&gt;</span><br><span class="line">    &lt;el-table</span><br><span class="line">      :data=&quot;dataPage.list&quot;</span><br><span class="line">      stripe</span><br><span class="line">      style=&quot;width: 100%&quot;</span><br><span class="line">      @selection-change=&quot;handleSelectionChange&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;!-- 批量选择框 --&gt;</span><br><span class="line">      &lt;el-table-column type=&quot;selection&quot; width=&quot;55&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;id&quot; label=&quot;编号&quot; width=&quot;50&quot;&gt; &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;username&quot; label=&quot;姓名&quot; width=&quot;100&quot;&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;phone&quot; label=&quot;手机&quot;&gt; &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;realName&quot; label=&quot;昵称&quot;&gt; &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;gender&quot; label=&quot;性别&quot; width=&quot;50&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">          &#123;&#123; scope.row.gender === 0 ? &quot;男&quot; : &quot;女&quot; &#125;&#125;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;!-- &lt;el-table-column prop=&quot;birthday&quot; label=&quot;生日&quot; width=&quot;150&quot;&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;registerTime&quot; label=&quot;注册时间&quot; width=&quot;150&quot;&gt;</span><br><span class="line">      &lt;/el-table-column&gt; --&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;status&quot; label=&quot;状态&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">          &#123;&#123; scope.row.status === 0 ? &quot;正常&quot; : &quot;禁用&quot; &#125;&#125;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;image&quot; label=&quot;头像&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">          &lt;img :src=&quot;scope.row.image&quot; alt=&quot;&quot; width=&quot;40px&quot; height=&quot;40px&quot; /&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;role.name&quot; label=&quot;角色&quot;&gt; &lt;/el-table-column&gt;</span><br><span class="line">      &lt;!-- 用户操作按钮 start --&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;操作&quot; width=&quot;300&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">          &lt;el-button size=&quot;mini&quot; type=&quot;primary&quot; @click=&quot;toUpdate(scope.row)&quot;</span><br><span class="line">            &gt;编辑&lt;/el-button</span><br><span class="line">          &gt;</span><br><span class="line">          &lt;el-button size=&quot;mini&quot; type=&quot;danger&quot; @click=&quot;deleteById(scope.row.id)&quot;</span><br><span class="line">            &gt;删除&lt;/el-button</span><br><span class="line">          &gt;</span><br><span class="line">          &lt;el-button</span><br><span class="line">            v-if=&quot;scope.row.status == &#x27;0&#x27;&quot;</span><br><span class="line">            size=&quot;mini&quot;</span><br><span class="line">            type=&quot;danger&quot;</span><br><span class="line">            plain</span><br><span class="line">            @click=&quot;updateStatus(scope.row.id, 1)&quot;</span><br><span class="line">            &gt;禁用&lt;/el-button</span><br><span class="line">          &gt;</span><br><span class="line">          &lt;el-button</span><br><span class="line">            v-if=&quot;scope.row.status == &#x27;1&#x27;&quot;</span><br><span class="line">            size=&quot;mini&quot;</span><br><span class="line">            type=&quot;primary&quot;</span><br><span class="line">            plain</span><br><span class="line">            @click=&quot;updateStatus(scope.row.id, 0)&quot;</span><br><span class="line">            &gt;启用&lt;/el-button</span><br><span class="line">          &gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;!-- 用户操作按钮 end --&gt;</span><br><span class="line">    &lt;/el-table&gt;</span><br><span class="line">    &lt;!-- 表格数据 end--&gt;</span><br><span class="line">    &lt;!-- 分页 start --&gt;</span><br><span class="line">    &lt;el-pagination</span><br><span class="line">      @size-change=&quot;handleSizeChange&quot;</span><br><span class="line">      @current-change=&quot;handleCurrentChange&quot;</span><br><span class="line">      :current-page.sync=&quot;paramsPage.pageNumber&quot;</span><br><span class="line">      :page-sizes=&quot;[5, 10, 15, 25]&quot;</span><br><span class="line">      :page-size=&quot;paramsPage.pageSize&quot;</span><br><span class="line">      layout=&quot;sizes, prev, pager, next&quot;</span><br><span class="line">      :total=&quot;dataPage.total&quot;</span><br><span class="line">    &gt;</span><br><span class="line">    &lt;/el-pagination&gt;</span><br><span class="line">    &lt;!-- 分页 end --&gt;</span><br><span class="line">    &lt;!-- 添加对话框 start--&gt;</span><br><span class="line">    &lt;el-dialog title=&quot;添加用户&quot; :visible.sync=&quot;dialogFormVisible&quot;&gt;</span><br><span class="line">      &lt;el-form :model=&quot;user&quot; label-width=&quot;100px&quot;&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;昵称&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;user.username&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;真实姓名&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;user.realName&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;用户密码&quot;&gt;</span><br><span class="line">          &lt;el-input</span><br><span class="line">            v-model=&quot;user.password&quot;</span><br><span class="line">            autocomplete=&quot;off&quot;</span><br><span class="line">            show-password</span><br><span class="line">          &gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;电话&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;user.phone&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;生日&quot;&gt;</span><br><span class="line">          &lt;el-date-picker</span><br><span class="line">            v-model=&quot;user.birthday&quot;</span><br><span class="line">            type=&quot;datetime&quot;</span><br><span class="line">            placeholder=&quot;选择日期时间&quot;</span><br><span class="line">            value-format=&quot;yyyy-MM-dd HH:mm:ss&quot;</span><br><span class="line">          &gt;</span><br><span class="line">          &lt;/el-date-picker&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;用户性别&quot;&gt;</span><br><span class="line">          &lt;el-radio v-model=&quot;user.gender&quot; :label=&quot;0&quot;&gt;男&lt;/el-radio&gt;</span><br><span class="line">          &lt;el-radio v-model=&quot;user.gender&quot; :label=&quot;1&quot;&gt;女&lt;/el-radio&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;角色&quot;&gt;</span><br><span class="line">          &lt;el-select</span><br><span class="line">            style=&quot;width: 100%&quot;</span><br><span class="line">            v-model=&quot;user.roleId&quot;</span><br><span class="line">            clearable</span><br><span class="line">            placeholder=&quot;请选择&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            &lt;el-option</span><br><span class="line">              v-for=&quot;item in roleList&quot;</span><br><span class="line">              :key=&quot;item.id&quot;</span><br><span class="line">              :label=&quot;item.name&quot;</span><br><span class="line">              :value=&quot;item.id&quot;</span><br><span class="line">            &gt;&lt;/el-option&gt;</span><br><span class="line">          &lt;/el-select&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;头像&quot;&gt;</span><br><span class="line">          &lt;!-- &lt;el-input type=&quot;file&quot; v-model=&quot;user.image&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt; --&gt;</span><br><span class="line">          &lt;el-upload</span><br><span class="line">            class=&quot;avatar-uploader&quot;</span><br><span class="line">            action=&quot;http://localhost:8989/upload/image&quot;</span><br><span class="line">            :show-file-list=&quot;false&quot;</span><br><span class="line">            :on-success=&quot;handleAvatarSuccess&quot;</span><br><span class="line">            :before-upload=&quot;beforeAvatarUpload&quot;&gt;</span><br><span class="line">            &lt;img v-if=&quot;user.image&quot; :src=&quot;user.image&quot; class=&quot;avatar&quot; width=&quot;40px&quot; height=&quot;40px&quot; /&gt;</span><br><span class="line">            &lt;i v-else class=&quot;el-icon-plus avatar-uploader-icon&quot;&gt;&lt;/i&gt;</span><br><span class="line">          &lt;/el-upload&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">      &lt;div slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">        &lt;el-button @click=&quot;dialogFormVisible = false&quot;&gt;取 消&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;saveUser&quot;&gt;确 定&lt;/el-button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/el-dialog&gt;</span><br><span class="line">    &lt;!-- 添加对话框 end --&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 修改抽屉 start --&gt;</span><br><span class="line">    &lt;el-drawer title=&quot;修改用户&quot; :visible.sync=&quot;drawer&quot; :direction=&quot;direction&quot;&gt;</span><br><span class="line">      &lt;!-- 复制对话框用户表单数据即可 --&gt;</span><br><span class="line">      &lt;el-form :model=&quot;user&quot; label-width=&quot;100px&quot;&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;昵称&quot;&gt;</span><br><span class="line">          &lt;el-input</span><br><span class="line">            v-model=&quot;user.username&quot;</span><br><span class="line">            autocomplete=&quot;off&quot;</span><br><span class="line">            readonly</span><br><span class="line">          &gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;真实姓名&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;user.realName&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;用户密码&quot;&gt;</span><br><span class="line">          &lt;el-input</span><br><span class="line">            v-model=&quot;user.password&quot;</span><br><span class="line">            autocomplete=&quot;off&quot;</span><br><span class="line">            show-password</span><br><span class="line">          &gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;电话&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;user.phone&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;生日&quot;&gt;</span><br><span class="line">          &lt;el-date-picker</span><br><span class="line">            v-model=&quot;user.birthday&quot;</span><br><span class="line">            type=&quot;datetime&quot;</span><br><span class="line">            placeholder=&quot;选择日期时间&quot;</span><br><span class="line">            value-format=&quot;yyyy-MM-dd HH:mm:ss&quot;</span><br><span class="line">          &gt;</span><br><span class="line">          &lt;/el-date-picker&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;用户性别&quot;&gt;</span><br><span class="line">          &lt;el-radio v-model=&quot;user.gender&quot; :label=&quot;0&quot;&gt;男&lt;/el-radio&gt;</span><br><span class="line">          &lt;el-radio v-model=&quot;user.gender&quot; :label=&quot;1&quot;&gt;女&lt;/el-radio&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;角色&quot;&gt;</span><br><span class="line">          &lt;el-select</span><br><span class="line">            style=&quot;width: 100%&quot;</span><br><span class="line">            v-model=&quot;user.roleId&quot;</span><br><span class="line">            clearable</span><br><span class="line">            placeholder=&quot;请选择&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            &lt;el-option</span><br><span class="line">              v-for=&quot;item in roleList&quot;</span><br><span class="line">              :key=&quot;item.id&quot;</span><br><span class="line">              :label=&quot;item.name&quot;</span><br><span class="line">              :value=&quot;item.id&quot;</span><br><span class="line">            &gt;&lt;/el-option&gt;</span><br><span class="line">          &lt;/el-select&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">      &lt;el-button @click=&quot;drawer = false&quot;&gt;取 消&lt;/el-button&gt;</span><br><span class="line">      &lt;el-button type=&quot;primary&quot; @click=&quot;updateUser&quot;&gt;确 定&lt;/el-button&gt;</span><br><span class="line">    &lt;/el-drawer&gt;</span><br><span class="line">    &lt;!-- 修改抽屉 end --&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">// 注意 user.js导出的都是单个函数</span><br><span class="line">// import &#123; save, update, deleteById, query, updateStatus &#125; from &quot;@/api/user&quot;;</span><br><span class="line">import &#123;</span><br><span class="line">  findByPage,</span><br><span class="line">  insert,</span><br><span class="line">  update,</span><br><span class="line">  deleteById,</span><br><span class="line">  deleteBatch,</span><br><span class="line">  updateStatus,</span><br><span class="line">&#125; from &quot;@/api/user.js&quot;;</span><br><span class="line">import roleApi from &quot;@/api/role.js&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      userList: [], // 用户表格数据</span><br><span class="line">      paramsPage: &#123;</span><br><span class="line">        // 分页传参数据</span><br><span class="line">        // 查询传参page对象</span><br><span class="line">        pageNumber: 1,</span><br><span class="line">        pageSize: 5,</span><br><span class="line">        params: &#123;&#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      dataPage: &#123;&#125;, // 分页返回的数据</span><br><span class="line">      dialogFormVisible: false, // 开启dialog</span><br><span class="line">      user: &#123;&#125;, // 添加或更新提交的表单项</span><br><span class="line">      roleList: &#123;&#125;, // 角色下拉列表选择框</span><br><span class="line">      drawer: false, // 是否开启抽屉</span><br><span class="line">      direction: &quot;rtl&quot;, // 抽屉打开方向</span><br><span class="line">      ids: [], // 批量删除id数组</span><br><span class="line">    </span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  // watch必须放在data后面</span><br><span class="line">  // watch: &#123;</span><br><span class="line">  //   &quot;$store.getters.roleList&quot;: function (newVal, oldVal) &#123;</span><br><span class="line">  //     console.log(&#x27;new Val&#x27;);</span><br><span class="line">  //     console.log(newVal);</span><br><span class="line">  //     this.roleList = newVal;</span><br><span class="line">  //   &#125;,</span><br><span class="line">  // &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    findRole() &#123;</span><br><span class="line">      roleApi</span><br><span class="line">        .findAll()</span><br><span class="line">        .then((resp) =&gt; &#123;</span><br><span class="line">          //this.$store.commit(&#x27;setRoleList&#x27;,resp.data);</span><br><span class="line">          this.roleList = resp.data;</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch((error) =&gt; &#123;</span><br><span class="line">          console.log(error);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    findAll() &#123;</span><br><span class="line">      findByPage(this.paramsPage)</span><br><span class="line">        .then((res) =&gt; &#123;</span><br><span class="line">          this.dataPage = res.data;</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch((error) =&gt; &#123;</span><br><span class="line">          console.log(error);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    handleSizeChange(val) &#123;</span><br><span class="line">      this.paramsPage.pageSize = val;</span><br><span class="line">      this.findAll();</span><br><span class="line">    &#125;,</span><br><span class="line">    handleCurrentChange(val) &#123;</span><br><span class="line">      this.paramsPage.pageNumber = val;</span><br><span class="line">      this.findAll();</span><br><span class="line">    &#125;,</span><br><span class="line">    toSave() &#123;</span><br><span class="line">      this.dialogFormVisible = true;</span><br><span class="line">    &#125;,</span><br><span class="line">    saveUser() &#123;</span><br><span class="line">      insert(this.user)</span><br><span class="line">        .then((res) =&gt; &#123;</span><br><span class="line">          this.$message.success(res.msg);</span><br><span class="line">          this.dialogFormVisible = false;</span><br><span class="line">          // 清空值</span><br><span class="line">          this.user = &#123;&#125;;</span><br><span class="line">          this.findAll();</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch((error) =&gt; &#123;</span><br><span class="line">          console.log(error);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    toUpdate(row) &#123;</span><br><span class="line">      this.user = row; // 回显数据</span><br><span class="line">      this.drawer = true;</span><br><span class="line">    &#125;,</span><br><span class="line">    updateUser() &#123;</span><br><span class="line">      update(this.user).then((res) =&gt; &#123;</span><br><span class="line">        this.$message.success(res.msg);</span><br><span class="line">        this.drawer = false;</span><br><span class="line">        this.user = &#123;&#125;;</span><br><span class="line">        this.findAll();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    deleteById(id) &#123;</span><br><span class="line">      this.$confirm(&quot;此操作将永久删除该文件, 是否继续?&quot;, &quot;提示&quot;, &#123;</span><br><span class="line">        confirmButtonText: &quot;确定&quot;,</span><br><span class="line">        cancelButtonText: &quot;取消&quot;,</span><br><span class="line">        type: &quot;warning&quot;,</span><br><span class="line">      &#125;)</span><br><span class="line">        .then(() =&gt; &#123;</span><br><span class="line">          // 删除</span><br><span class="line">          deleteById(id).then((res) =&gt; &#123;</span><br><span class="line">            this.$message.success(&quot;删除成功&quot;);</span><br><span class="line">            this.findAll();</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(() =&gt; &#123;</span><br><span class="line">          this.$message(&#123;</span><br><span class="line">            type: &quot;info&quot;,</span><br><span class="line">            message: &quot;已取消删除&quot;,</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    // 批量操作的值</span><br><span class="line">    handleSelectionChange(val) &#123;</span><br><span class="line">      // 默认val是批量的值的集合  此处只需要批量id 需要映射处理</span><br><span class="line">      this.ids = val.map((item) =&gt; item.id);</span><br><span class="line">      console.log(this.ids);</span><br><span class="line">    &#125;,</span><br><span class="line">    deleteBatch() &#123;</span><br><span class="line">      this.$confirm(&quot;此操作将永久删除该文件, 是否继续?&quot;, &quot;提示&quot;, &#123;</span><br><span class="line">        confirmButtonText: &quot;确定&quot;,</span><br><span class="line">        cancelButtonText: &quot;取消&quot;,</span><br><span class="line">        type: &quot;warning&quot;,</span><br><span class="line">      &#125;)</span><br><span class="line">        .then(() =&gt; &#123;</span><br><span class="line">          // 批量删除</span><br><span class="line">          deleteBatch(this.ids).then((res) =&gt; &#123;</span><br><span class="line">            this.$message.success(&quot;删除成功&quot;);</span><br><span class="line">            this.findAll();</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(() =&gt; &#123;</span><br><span class="line">          this.$message(&#123;</span><br><span class="line">            type: &quot;info&quot;,</span><br><span class="line">            message: &quot;已取消删除&quot;,</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    // 修改用户状态</span><br><span class="line">    updateStatus(id, status) &#123;</span><br><span class="line">      updateStatus(id, status)</span><br><span class="line">        .then((res) =&gt; &#123;</span><br><span class="line">          this.$message.success(res.msg);</span><br><span class="line">          this.findAll();</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch((error) =&gt; &#123;</span><br><span class="line">          console.log(error);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    // 文件上传</span><br><span class="line">    handleAvatarSuccess(res, file) &#123;</span><br><span class="line">     // this.user.image = URL.createObjectURL(file.raw);</span><br><span class="line">     URL.createObjectURL(file.raw);</span><br><span class="line">     this.user.image = res.data;</span><br><span class="line">    &#125;,</span><br><span class="line">    beforeAvatarUpload(file) &#123;</span><br><span class="line">      const isJPG = file.type === &quot;image/jpeg&quot;;</span><br><span class="line">      const isLt2M = file.size / 1024 / 1024 &lt; 2;</span><br><span class="line"></span><br><span class="line">      if (!isJPG) &#123;</span><br><span class="line">        this.$message.error(&quot;上传头像图片只能是 JPG 格式!&quot;);</span><br><span class="line">      &#125;</span><br><span class="line">      if (!isLt2M) &#123;</span><br><span class="line">        this.$message.error(&quot;上传头像图片大小不能超过 2MB!&quot;);</span><br><span class="line">      &#125;</span><br><span class="line">      return isJPG &amp;&amp; isLt2M;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    this.findRole();</span><br><span class="line">    this.findAll();</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="image/image-20211220163849887.png" alt="image-20211220163849887"></p>
<h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">onSubmit()&#123;</span><br><span class="line">            request.request(&#123;</span><br><span class="line">                url:<span class="string">&quot;http://localhost:8888/cms/article/save&quot;</span>,</span><br><span class="line">                method:<span class="string">&quot;post&quot;</span>,</span><br><span class="line">                headers:&#123;</span><br><span class="line">                    <span class="string">&quot;Content-Type&quot;</span>:<span class="string">&quot;application/x-www-form-urlencoded&quot;</span></span><br><span class="line">                &#125;,</span><br><span class="line">                data:qs.stringify(<span class="keyword">this</span>.form)</span><br><span class="line">            &#125;).then(response=&gt;&#123;</span><br><span class="line">               <span class="comment">// 提示成功</span></span><br><span class="line">                <span class="keyword">this</span>.$message(&#123;</span><br><span class="line">                message: response.message,</span><br><span class="line">                type: <span class="string">&#x27;success&#x27;</span></span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="comment">//返回列表页</span></span><br><span class="line">                <span class="keyword">this</span>.back();</span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line">                </span><br><span class="line">    toEditArticle()&#123;</span><br><span class="line">      <span class="keyword">this</span>.$router.push(&#123;</span><br><span class="line">        path:<span class="string">&#x27;/article/editor&#x27;</span>,</span><br><span class="line">        query:row</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">跳转接受参数</span><br><span class="line">  created()&#123;</span><br><span class="line">        <span class="keyword">this</span>.form=<span class="keyword">this</span>.$route.query;</span><br><span class="line">    &#125;,</span><br><span class="line">            </span><br></pre></td></tr></table></figure>

 
      <!-- reward -->
      
      <div id="reword-out">
        <div id="reward-btn">
          打赏
        </div>
      </div>
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/out/" rel="tag">out</a></li></ul>

    </footer>
  </div>

   
  <nav class="article-nav">
    
    
      <a href="/archives/hexo.html" class="article-nav-link">
        <strong class="article-nav-caption">下一篇</strong>
        <div class="article-nav-title">hexo</div>
      </a>
    
  </nav>

  
   
<div class="gitalk" id="gitalk-container"></div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css">


<script src="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js"></script>


<script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script>

<script type="text/javascript">
  var gitalk = new Gitalk({
    clientID: 'abdf20cf8f71fc88e695',
    clientSecret: '050f9f7209fbd2e9f446fb0ade695e4e5dd12e84',
    repo: 'hexo_comment',
    owner: 'wangsidandan',
    admin: ['wangsidandan'],
    // id: location.pathname,      // Ensure uniqueness and length less than 50
    id: md5(location.pathname),
    distractionFreeMode: false,  // Facebook-like distraction free mode
    pagerDirection: 'last'
  })

  gitalk.render('gitalk-container')
</script>

     
</article>

</section>
      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2015-2021
        <i class="ri-heart-fill heart_icon"></i> vanse
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>访问人数:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>浏览次数:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.svg" alt="vanse"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/playlist">音乐</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/photos">相册</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/friends">友链</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="https://gitee.com/vanse/images/raw/master/bruip_course/aliapy.png">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="https://gitee.com/vanse/images/raw/master/bruip_course/wechat.png">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->
 
<script src="/js/tocbot.min.js"></script>

<script>
  tocbot.init({
    tocSelector: ".tocbot",
    contentSelector: ".article-entry",
    headingSelector: "h1, h2, h3, h4, h5, h6",
    hasInnerContainers: true,
    scrollSmooth: true,
    scrollContainer: "main",
    positionFixedSelector: ".tocbot",
    positionFixedClass: "is-position-fixed",
    fixedSidebarOffset: "auto",
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script>

<script src="/js/clickBoom1.js"></script>
 
<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->
 
<script src="/js/dz.js"></script>
 
<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    <div id="music">
    
    
    
    <iframe frameborder="no" border="1" marginwidth="0" marginheight="0" width="200" height="52"
        src="//music.163.com/outchain/player?type=2&id=506654324&auto=0&height=32"></iframe>
</div>

<style>
    #music {
        position: fixed;
        right: 15px;
        bottom: 0;
        z-index: 998;
    }
</style>
    
    
<script>
  const password = "hi briup";
  const lock_password = window.sessionStorage.getItem("lock_password");
  console.log(password, lock_password);
  if (lock_password !== password) {
    Swal.fire({
      title: "请输入访问密码",
      input: "password",
      inputAttributes: {
        autocapitalize: "off",
      },
      showCancelButton: false,
      showLoaderOnConfirm: true,
      allowOutsideClick: false,
      confirmButtonText: "确定",
    }).then((result) => {
      console.log(result);
      if (result.isConfirmed) {
        console.log(password);
        if (result.value === password) {
          window.sessionStorage.setItem("lock_password", result.value);
        } else {
          Swal.fire({
            icon: "error",
            title: "密码错误，请重试",
            confirmButtonText: "确定",
            allowOutsideClick: false,
          }).then(() => {
            window.location.reload();
          });
        }
      }
    });
  }
</script>


  </div>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>

</html>