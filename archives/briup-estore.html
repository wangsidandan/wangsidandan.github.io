<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
        
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title>briup-estore |  vanse</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/favicon.ico" />
       
<link rel="stylesheet" href="/dist/main.css">

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/css/remixicon.min.css"
      />
      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
       
 

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    </head>
  </html>
</html>


<body>
  <div id="app">
    
      <canvas class="fireworks"></canvas>
      <style>
        .fireworks {
          position: fixed;
          left: 0;
          top: 0;
          z-index: 99999;
          pointer-events: none;
        }
      </style>
      
      
    <main class="content on">
      <section class="outer">
  <article
  id="post-briup-estore"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h1 class="article-title sea-center" style="border-left:0" itemprop="name">
  briup-estore
</h1>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/archives/briup-estore.html" class="article-date">
  <time datetime="2022-06-22T03:16:44.000Z" itemprop="datePublished">2022-06-22</time>
</a>   
<div class="word_count">
    <span class="post-time">
        <span class="post-meta-item-icon">
            <i class="ri-quill-pen-line"></i>
            <span class="post-meta-item-text"> 字数统计:</span>
            <span class="post-count">25.1k</span>
        </span>
    </span>

    <span class="post-time">
        &nbsp; | &nbsp;
        <span class="post-meta-item-icon">
            <i class="ri-book-open-line"></i>
            <span class="post-meta-item-text"> 阅读时长≈</span>
            <span class="post-count">131 分钟</span>
        </span>
    </span>
</div>
 
    </div>
     
	
	 
		 
			
				
    <div class="tocbot"></div>




   
			 
		
		
		 
	
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><ul>
<li>教程：estore</li>
<li>整理人：vanse(刘聪)</li>
<li>时间：2022/6/23</li>
<li>项目托管平台: git</li>
<li>类别: 实训</li>
</ul>
<h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><h2 id="jdk"><a href="#jdk" class="headerlink" title="jdk"></a>jdk</h2><blockquote>
<p>软件安装</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221120998.png" alt="image-20220620140907997"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221120310.png" alt="image-20220620140923080"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221120167.png" alt="image-20220620141008065"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221120329.png" alt="image-20220620141128675"></p>
<blockquote>
<p>配置环境变量</p>
</blockquote>
<p>JAVA_HOME，指定JDK的安装目录，例如，JAVA_HOME=C:\Program Files\Java\jdk1.8.0_74</p>
<p>PATH，把JDK中java命令所在目录配置到原有的PATH中，可以配置到PATH的最前面。例如，PATH=%JAVA_HOME%\bin;…;…;….;  这里也可以不引用JAVA_HOME的变量值。</p>
<p>CLASSPATH，指定将来要运行加载的class文件所在位置，这个路径将来可能随时变换，可以先配置为当前路径，将来使用的时候再具体配置即可。例如，CLASSPATH=.</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221120426.png" alt="image-20200719235633621"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221120185.png" alt="image-20200719235718118"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221120644.png" alt="image-20220620141644896"></p>
<h2 id="maven"><a href="#maven" class="headerlink" title="maven"></a>maven</h2><p>1、安装JDK，并且配置环境变量JAVA_HOME</p>
<ul>
<li>JDK必须是1.7以上</li>
<li>==JAVA_HOME中配置的路径一定是JDK的路径，而不是JRE的路径==</li>
</ul>
<p>2、下载好的Maven，在指定目录解压即可</p>
<ul>
<li>Maven所在路径中最好不要出现中文、空格<br><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221121454.png" alt="image-20200914170734336"></li>
</ul>
<p>3、配置Maven的环境变量</p>
<ul>
<li>M2_HOME=D:\briup\apache-maven-3.6.3</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221121510.png" alt="image-20200914170946623"></p>
<p>4、配置Path变量</p>
<ul>
<li><p>Path=%M2_HOME%\bin;%Path%</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221121850.png" alt="image-20200914171139809"></p>
</li>
</ul>
<p>5、测试安装是否成功</p>
<ul>
<li><p><strong>重新</strong>打开一个新终端窗口</p>
</li>
<li><p>输入命令：<code>mvn -v</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221121615.png" alt="image-20200914171335774"></p>
</li>
</ul>
<p>项目中所依赖的第三方jar，最终都会下载存放到自己电脑中的本地仓库中，本地仓库的位置可以自己指定，也可以使用默认路径：<code>$&#123;user.home&#125;/.m2/repository</code></p>
<ul>
<li><p>在磁盘中创建文件夹 maven_repository(随意指定)</p>
</li>
<li><p>maven和该文件夹绑定即可  之前安装的maven软件conf/settings.xml中可以配置关系</p>
</li>
<li><p>第56行</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!-- localRepository</span></span><br><span class="line"><span class="comment">   | The path to the local repository maven will use to store artifacts.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | Default: $&#123;user.home&#125;/.m2/repository</span></span><br><span class="line"><span class="comment">  &lt;localRepository&gt;/path/to/local/repo&lt;/localRepository&gt;</span></span><br><span class="line"><span class="comment">  &lt;localRepository&gt;D:/briup/repository&lt;/localRepository&gt;</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">localRepository</span>&gt;</span>D:/maven_repository<span class="tag">&lt;/<span class="name">localRepository</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="oracle"><a href="#oracle" class="headerlink" title="oracle"></a>oracle</h2><blockquote>
<p>数据库安装</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221121951.png" alt="image-20220620143744462"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221121433.png" alt="image-20220620143756390"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221121749.png" alt="image-20220620143807766"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221121402.png" alt="image-20220620143819246"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221121266.png" alt="image-20220620143906505"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221121409.png" alt="image-20220620143950751"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221121858.png" alt="image-20220620145401117"></p>
<blockquote>
<p>数据库管理</p>
</blockquote>
<p>可以使用<code>system</code>用户登录，登录密码是安装oracle过程中，自己手动输入的密码：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221121792.png" alt="image-20200901152342508"></p>
<p><strong>登录后，可以界面来创建自己的账号：</strong></p>
<p>例如，</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221121123.png" alt="image-20200901152718180"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221121218.png" alt="image-20200901152740517"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221121737.png" alt="image-20200901152806613"></p>
<p>输入用户名和密码，选中赋予的权限，然后点击创建即可：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221121610.png" alt="image-20200901152941645"></p>
<blockquote>
<p>注意，自己单独使用时，密码不要写的太复杂了，建议和用户名一致，这样方便记忆</p>
</blockquote>
<blockquote>
<p>注意，之后尽量使用自己新建的账户登录，不要使用管理员账户，因为权限太大，容易误操作</p>
</blockquote>
<p><strong>登录后，可以界面来执行sql语句：</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221121693.png" alt="image-20200901153514518"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221121987.png" alt="image-20200901153558704"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221122343.png" alt="image-20200901153657127"></p>
<blockquote>
<p>在编辑框中，用鼠标选中要执行的sql语句，然后ctrl+enter 即可执行被选中的sql语句</p>
</blockquote>
<blockquote>
<p>改变语言环境</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 中文</span></span><br><span class="line"><span class="keyword">alter</span> session <span class="keyword">set</span> nls_language<span class="operator">=</span><span class="string">&#x27;simplified chinese&#x27;</span>;</span><br><span class="line"><span class="comment">-- 英文</span></span><br><span class="line"><span class="keyword">alter</span> session <span class="keyword">set</span> nls_language<span class="operator">=</span>english;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">C:\Users\vanse<span class="operator">&gt;</span>sqlplus briup<span class="operator">/</span>briup</span><br><span class="line"></span><br><span class="line"><span class="keyword">SQL</span><span class="operator">*</span>Plus: <span class="keyword">Release</span> <span class="number">10.2</span><span class="number">.0</span><span class="number">.1</span><span class="number">.0</span> <span class="operator">-</span> Production <span class="keyword">on</span> 星期一 <span class="number">6</span>月 <span class="number">20</span> <span class="number">15</span>:<span class="number">06</span>:<span class="number">59</span> <span class="number">2022</span></span><br><span class="line"></span><br><span class="line">Copyright (c) <span class="number">1982</span>, <span class="number">2005</span>, Oracle.  <span class="keyword">All</span> rights reserved.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">连接到:</span><br><span class="line">Oracle Database <span class="number">10</span>g Express Edition <span class="keyword">Release</span> <span class="number">10.2</span><span class="number">.0</span><span class="number">.1</span><span class="number">.0</span> <span class="operator">-</span> Production</span><br><span class="line"></span><br><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span> <span class="keyword">alter</span> session <span class="keyword">set</span> nls_language<span class="operator">=</span><span class="string">&#x27;simplified chinese&#x27;</span>;</span><br><span class="line"></span><br><span class="line">会话已更改。</span><br><span class="line"></span><br><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>





<h2 id="navicat"><a href="#navicat" class="headerlink" title="navicat"></a>navicat</h2><p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221122793.png" alt="image-20220620145545335"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221122833.png" alt="image-20220620145554260"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221128549.png" alt="image-20220620145618813"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221122540.png" alt="image-20220620145628865"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221122031.png" alt="image-20220620145639182"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221122630.png" alt="image-20220620145745602"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221122601.png" alt="image-20220620145836442"></p>
<blockquote>
<p>如果连接报错 </p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221122524.png" alt="image-20220620154755237"></p>
<blockquote>
<p>执行脚本</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221122107.png" alt="image-20220620152228434"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221122240.png" alt="image-20220620152315521"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> session <span class="keyword">set</span> nls_language<span class="operator">=</span><span class="string">&#x27;simplified chinese&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> es_category(</span><br><span class="line">	categoryId number(<span class="number">12</span>) <span class="keyword">primary</span> key,</span><br><span class="line">	name varchar2(<span class="number">255</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">	description varchar2(<span class="number">255</span>),</span><br><span class="line">	parent_id number(<span class="number">12</span>) <span class="keyword">references</span> es_category(categoryId)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> es_book(</span><br><span class="line">	bookId number(<span class="number">12</span>) <span class="keyword">primary</span> key,</span><br><span class="line">	name varchar2(<span class="number">255</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">	price number(<span class="number">7</span>,<span class="number">2</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">	author varchar2(<span class="number">100</span>),</span><br><span class="line">	publisher varchar2(<span class="number">100</span>),</span><br><span class="line">	pubDate <span class="type">date</span>,</span><br><span class="line">	description varchar2(<span class="number">255</span>),</span><br><span class="line">	category_id number(<span class="number">7</span>) <span class="keyword">references</span> es_category(categoryId)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> es_customer(</span><br><span class="line">	customerId number(<span class="number">7</span>) <span class="keyword">primary</span> key,</span><br><span class="line">	name varchar2(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">	password varchar2(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">	zipCode varchar2(<span class="number">10</span>),</span><br><span class="line">	address varchar2(<span class="number">255</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">	telephone varchar2(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">	email varchar2(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> es_shopAddress(</span><br><span class="line">	saId number(<span class="number">7</span>) <span class="keyword">primary</span> key, </span><br><span class="line">	receiveName varchar2(<span class="number">255</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">	address varchar2(<span class="number">255</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">	phone varchar2(<span class="number">15</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">	customer_id number(<span class="number">7</span>) <span class="keyword">references</span> es_customer(customerId)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> es_orderForm(</span><br><span class="line">	orderFormId number(<span class="number">12</span>) <span class="keyword">primary</span> key,</span><br><span class="line">	cost number(<span class="number">9</span>,<span class="number">2</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">	orderDate <span class="type">date</span> <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">	shopAddress_id number(<span class="number">7</span>) <span class="keyword">references</span> es_ShopAddress(saId),</span><br><span class="line">	customer_id number(<span class="number">7</span>) <span class="keyword">references</span> es_customer(customerId)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> es_orderLine(</span><br><span class="line">	orderLineId number(<span class="number">12</span>) <span class="keyword">primary</span> key,</span><br><span class="line">	num number(<span class="number">9</span>) <span class="keyword">not</span> <span class="keyword">null</span>, </span><br><span class="line">	cost number(<span class="number">9</span>,<span class="number">2</span>) <span class="keyword">not</span> <span class="keyword">null</span>, </span><br><span class="line">	book_id number(<span class="number">12</span>) <span class="keyword">references</span> es_book(bookId),</span><br><span class="line">	orderForm_id number(<span class="number">12</span>) <span class="keyword">references</span> es_orderForm(orderFormId)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">--添加初始数据</span></span><br><span class="line"><span class="comment">--分类数据</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_category(categoryid,name,description) <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;文学&#x27;</span>,<span class="string">&#x27;文学的描述&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_category(categoryid,name,description) <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;社会科学&#x27;</span>,<span class="string">&#x27;社会科学的描述&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_category(categoryid,name,description) <span class="keyword">values</span>(<span class="number">4</span>,<span class="string">&#x27;小说&#x27;</span>,<span class="string">&#x27;小说的描述&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_category(categoryid,name,description) <span class="keyword">values</span>(<span class="number">3</span>,<span class="string">&#x27;计算机与互联网&#x27;</span>,<span class="string">&#x27;计算机与互联网的描述&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_category(categoryid,name,description) <span class="keyword">values</span>(<span class="number">5</span>,<span class="string">&#x27;传记&#x27;</span>,<span class="string">&#x27;传记的描述&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_category(categoryid,name,description) <span class="keyword">values</span>(<span class="number">6</span>,<span class="string">&#x27;历史&#x27;</span>,<span class="string">&#x27;历史的描述&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_category(categoryid,name,description) <span class="keyword">values</span>(<span class="number">7</span>,<span class="string">&#x27;医学&#x27;</span>,<span class="string">&#x27;医学的描述&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_category <span class="keyword">values</span>(<span class="number">8</span>,<span class="string">&#x27;文学1类&#x27;</span>,<span class="string">&#x27;文学1类的描述&#x27;</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_category <span class="keyword">values</span>(<span class="number">9</span>,<span class="string">&#x27;文学2类&#x27;</span>,<span class="string">&#x27;文学2类的描述&#x27;</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_category <span class="keyword">values</span>(<span class="number">10</span>,<span class="string">&#x27;文学3类&#x27;</span>,<span class="string">&#x27;文学3类的描述&#x27;</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_category <span class="keyword">values</span>(<span class="number">11</span>,<span class="string">&#x27;社会科学1&#x27;</span>,<span class="string">&#x27;社会科学1类的描述&#x27;</span>,<span class="number">2</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_category <span class="keyword">values</span>(<span class="number">12</span>,<span class="string">&#x27;社会科学2&#x27;</span>,<span class="string">&#x27;社会科学2类的描述&#x27;</span>,<span class="number">2</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_category <span class="keyword">values</span>(<span class="number">13</span>,<span class="string">&#x27;社会科学3&#x27;</span>,<span class="string">&#x27;社会科学3类的描述&#x27;</span>,<span class="number">2</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_category <span class="keyword">values</span>(<span class="number">14</span>,<span class="string">&#x27;小说1&#x27;</span>,<span class="string">&#x27;小说1类的描述&#x27;</span>,<span class="number">3</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_category <span class="keyword">values</span>(<span class="number">15</span>,<span class="string">&#x27;小说2&#x27;</span>,<span class="string">&#x27;小说2类的描述&#x27;</span>,<span class="number">3</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_category <span class="keyword">values</span>(<span class="number">16</span>,<span class="string">&#x27;小说3&#x27;</span>,<span class="string">&#x27;小说3类的描述&#x27;</span>,<span class="number">3</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_category <span class="keyword">values</span>(<span class="number">17</span>,<span class="string">&#x27;计算机1&#x27;</span>,<span class="string">&#x27;计算机1类的描述&#x27;</span>,<span class="number">4</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_category <span class="keyword">values</span>(<span class="number">18</span>,<span class="string">&#x27;计算机2&#x27;</span>,<span class="string">&#x27;计算机2类的描述&#x27;</span>,<span class="number">4</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_category <span class="keyword">values</span>(<span class="number">19</span>,<span class="string">&#x27;计算机3&#x27;</span>,<span class="string">&#x27;计算机3类的描述&#x27;</span>,<span class="number">4</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_category <span class="keyword">values</span>(<span class="number">20</span>,<span class="string">&#x27;传记1&#x27;</span>,<span class="string">&#x27;传记1类的描述&#x27;</span>,<span class="number">5</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_category <span class="keyword">values</span>(<span class="number">21</span>,<span class="string">&#x27;传记2&#x27;</span>,<span class="string">&#x27;传记2类的描述&#x27;</span>,<span class="number">5</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_category <span class="keyword">values</span>(<span class="number">22</span>,<span class="string">&#x27;传记3&#x27;</span>,<span class="string">&#x27;传记3类的描述&#x27;</span>,<span class="number">5</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_category <span class="keyword">values</span>(<span class="number">23</span>,<span class="string">&#x27;历史类1&#x27;</span>,<span class="string">&#x27;历史1类的描述&#x27;</span>,<span class="number">6</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_category <span class="keyword">values</span>(<span class="number">24</span>,<span class="string">&#x27;历史类2&#x27;</span>,<span class="string">&#x27;历史2类的描述&#x27;</span>,<span class="number">6</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_category <span class="keyword">values</span>(<span class="number">25</span>,<span class="string">&#x27;历史类3&#x27;</span>,<span class="string">&#x27;历史3类的描述&#x27;</span>,<span class="number">6</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_category <span class="keyword">values</span>(<span class="number">26</span>,<span class="string">&#x27;医学类1&#x27;</span>,<span class="string">&#x27;医学类1的描述&#x27;</span>,<span class="number">7</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_category <span class="keyword">values</span>(<span class="number">27</span>,<span class="string">&#x27;医学类2&#x27;</span>,<span class="string">&#x27;医学2类的描述&#x27;</span>,<span class="number">7</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_category <span class="keyword">values</span>(<span class="number">28</span>,<span class="string">&#x27;医学类3&#x27;</span>,<span class="string">&#x27;医学3类的描述&#x27;</span>,<span class="number">7</span>);</span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--图书数据</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_book <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;文学类书1&#x27;</span>,<span class="number">20.0</span>,<span class="string">&#x27;作者张三&#x27;</span>,<span class="string">&#x27;出版社x&#x27;</span>,<span class="string">&#x27;10-10月-07&#x27;</span>,<span class="string">&#x27;文学1类&#x27;</span>,<span class="number">8</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_book <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;文学类书2&#x27;</span>,<span class="number">20.0</span>,<span class="string">&#x27;作者张三&#x27;</span>,<span class="string">&#x27;出版社x&#x27;</span>,<span class="string">&#x27;10-10月-07&#x27;</span>,<span class="string">&#x27;文学2类&#x27;</span>,<span class="number">9</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_book <span class="keyword">values</span>(<span class="number">3</span>,<span class="string">&#x27;文学类书3&#x27;</span>,<span class="number">20.0</span>,<span class="string">&#x27;作者张三&#x27;</span>,<span class="string">&#x27;出版社x&#x27;</span>,<span class="string">&#x27;10-10月-07&#x27;</span>,<span class="string">&#x27;文学3类&#x27;</span>,<span class="number">10</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_book <span class="keyword">values</span>(<span class="number">4</span>,<span class="string">&#x27;社会科学书1&#x27;</span>,<span class="number">20.0</span>,<span class="string">&#x27;作者张三&#x27;</span>,<span class="string">&#x27;出版社x&#x27;</span>,<span class="string">&#x27;10-10月-07&#x27;</span>,<span class="string">&#x27;社会科学1类&#x27;</span>,<span class="number">11</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_book <span class="keyword">values</span>(<span class="number">5</span>,<span class="string">&#x27;社会科学书2&#x27;</span>,<span class="number">20.0</span>,<span class="string">&#x27;作者张三&#x27;</span>,<span class="string">&#x27;出版社x&#x27;</span>,<span class="string">&#x27;10-10月-07&#x27;</span>,<span class="string">&#x27;社会科学2类&#x27;</span>,<span class="number">12</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_book <span class="keyword">values</span>(<span class="number">6</span>,<span class="string">&#x27;社会科学书3&#x27;</span>,<span class="number">20.0</span>,<span class="string">&#x27;作者张三&#x27;</span>,<span class="string">&#x27;出版社x&#x27;</span>,<span class="string">&#x27;10-10月-07&#x27;</span>,<span class="string">&#x27;社会科学3类&#x27;</span>,<span class="number">13</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_book <span class="keyword">values</span>(<span class="number">7</span>,<span class="string">&#x27;小说书1&#x27;</span>,<span class="number">20.0</span>,<span class="string">&#x27;作者张三&#x27;</span>,<span class="string">&#x27;出版社x&#x27;</span>,<span class="string">&#x27;10-10月-07&#x27;</span>,<span class="string">&#x27;小说1类&#x27;</span>,<span class="number">14</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_book <span class="keyword">values</span>(<span class="number">8</span>,<span class="string">&#x27;小说书2&#x27;</span>,<span class="number">20.0</span>,<span class="string">&#x27;作者张三&#x27;</span>,<span class="string">&#x27;出版社x&#x27;</span>,<span class="string">&#x27;07-10月-07&#x27;</span>,<span class="string">&#x27;小说2类&#x27;</span>,<span class="number">15</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_book <span class="keyword">values</span>(<span class="number">9</span>,<span class="string">&#x27;小说书3&#x27;</span>,<span class="number">20.0</span>,<span class="string">&#x27;作者张三&#x27;</span>,<span class="string">&#x27;出版社x&#x27;</span>,<span class="string">&#x27;10-10月-07&#x27;</span>,<span class="string">&#x27;小说3类&#x27;</span>,<span class="number">16</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_book <span class="keyword">values</span>(<span class="number">10</span>,<span class="string">&#x27;计算机1书1&#x27;</span>,<span class="number">20.0</span>,<span class="string">&#x27;作者张三&#x27;</span>,<span class="string">&#x27;出版社x&#x27;</span>,<span class="string">&#x27;10-10月-07&#x27;</span>,<span class="string">&#x27;计算机1类&#x27;</span>,<span class="number">17</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_book <span class="keyword">values</span>(<span class="number">11</span>,<span class="string">&#x27;计算机2书2&#x27;</span>,<span class="number">20.0</span>,<span class="string">&#x27;作者张三&#x27;</span>,<span class="string">&#x27;出版社x&#x27;</span>,<span class="string">&#x27;09-10月-07&#x27;</span>,<span class="string">&#x27;计算机2类&#x27;</span>,<span class="number">18</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_book <span class="keyword">values</span>(<span class="number">12</span>,<span class="string">&#x27;计算机3书3&#x27;</span>,<span class="number">20.0</span>,<span class="string">&#x27;作者张三&#x27;</span>,<span class="string">&#x27;出版社x&#x27;</span>,<span class="string">&#x27;10-10月-07&#x27;</span>,<span class="string">&#x27;计算机3类&#x27;</span>,<span class="number">19</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_book <span class="keyword">values</span>(<span class="number">13</span>,<span class="string">&#x27;传记书1&#x27;</span>,<span class="number">20.0</span>,<span class="string">&#x27;作者张三&#x27;</span>,<span class="string">&#x27;出版社x&#x27;</span>,<span class="string">&#x27;10-10月-07&#x27;</span>,<span class="string">&#x27;传记1类&#x27;</span>,<span class="number">20</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_book <span class="keyword">values</span>(<span class="number">14</span>,<span class="string">&#x27;传记书2&#x27;</span>,<span class="number">20.0</span>,<span class="string">&#x27;作者张三&#x27;</span>,<span class="string">&#x27;出版社x&#x27;</span>,<span class="string">&#x27;15-10月-07&#x27;</span>,<span class="string">&#x27;传记2类&#x27;</span>,<span class="number">21</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_book <span class="keyword">values</span>(<span class="number">15</span>,<span class="string">&#x27;传记书3&#x27;</span>,<span class="number">20.0</span>,<span class="string">&#x27;作者张三&#x27;</span>,<span class="string">&#x27;出版社x&#x27;</span>,<span class="string">&#x27;10-10月-07&#x27;</span>,<span class="string">&#x27;传记3类&#x27;</span>,<span class="number">22</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_book <span class="keyword">values</span>(<span class="number">16</span>,<span class="string">&#x27;历史类书1&#x27;</span>,<span class="number">20.0</span>,<span class="string">&#x27;作者张三&#x27;</span>,<span class="string">&#x27;出版社x&#x27;</span>,<span class="string">&#x27;17-10月-07&#x27;</span>,<span class="string">&#x27;历史1类&#x27;</span>,<span class="number">23</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_book <span class="keyword">values</span>(<span class="number">17</span>,<span class="string">&#x27;历史类书2&#x27;</span>,<span class="number">20.0</span>,<span class="string">&#x27;作者张三&#x27;</span>,<span class="string">&#x27;出版社x&#x27;</span>,<span class="string">&#x27;22-10月-07&#x27;</span>,<span class="string">&#x27;历史2类&#x27;</span>,<span class="number">24</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_book <span class="keyword">values</span>(<span class="number">18</span>,<span class="string">&#x27;历史类书3&#x27;</span>,<span class="number">20.0</span>,<span class="string">&#x27;作者张三&#x27;</span>,<span class="string">&#x27;出版社x&#x27;</span>,<span class="string">&#x27;10-10月-07&#x27;</span>,<span class="string">&#x27;历史3类&#x27;</span>,<span class="number">25</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_book <span class="keyword">values</span>(<span class="number">19</span>,<span class="string">&#x27;医学类书1&#x27;</span>,<span class="number">20.0</span>,<span class="string">&#x27;作者张三&#x27;</span>,<span class="string">&#x27;出版社x&#x27;</span>,<span class="string">&#x27;10-10月-07&#x27;</span>,<span class="string">&#x27;文学1类&#x27;</span>,<span class="number">26</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_book <span class="keyword">values</span>(<span class="number">20</span>,<span class="string">&#x27;医学类书2&#x27;</span>,<span class="number">20.0</span>,<span class="string">&#x27;作者张三&#x27;</span>,<span class="string">&#x27;出版社x&#x27;</span>,<span class="string">&#x27;10-10月-07&#x27;</span>,<span class="string">&#x27;文学2类&#x27;</span>,<span class="number">27</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> es_book <span class="keyword">values</span>(<span class="number">21</span>,<span class="string">&#x27;医学类书3&#x27;</span>,<span class="number">20.0</span>,<span class="string">&#x27;作者张三&#x27;</span>,<span class="string">&#x27;出版社x&#x27;</span>,<span class="string">&#x27;10-10月-07&#x27;</span>,<span class="string">&#x27;文学3类&#x27;</span>,<span class="number">28</span>);</span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询序列</span></span><br><span class="line"><span class="keyword">select</span> sequence_name <span class="keyword">from</span> user_sequences</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建序列</span></span><br><span class="line"><span class="keyword">create</span> sequence es_customer_id;</span><br><span class="line"><span class="keyword">create</span> sequence es_shopAddress_id;</span><br><span class="line"><span class="keyword">create</span> sequence es_orderForm_id;</span><br><span class="line"><span class="keyword">create</span> sequence es_orderline_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除序列</span></span><br><span class="line"><span class="keyword">drop</span> sequence ES_CUSTOMER_ID;</span><br><span class="line"><span class="keyword">drop</span> sequence ES_SHOPADDRESS_ID;</span><br><span class="line"><span class="keyword">drop</span> sequence ES_ORDERFORM_ID;</span><br><span class="line"><span class="keyword">drop</span> sequence ES_ORDERLINE_ID;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>也可直接导入sql脚本</p>
</blockquote>
<h2 id="tomcat"><a href="#tomcat" class="headerlink" title="tomcat"></a>tomcat</h2><p>将下载完成的压缩包，直接解压到文件中即可，例如</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221122462.png" alt="image-20200928203849722"></p>
<blockquote>
<p>注意，这个解压安装的路径中，不要有中文、空格、特殊符号等</p>
</blockquote>
<h2 id="idea"><a href="#idea" class="headerlink" title="idea"></a>idea</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221122821.jpg" alt="img"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221122862.jpg" alt="img"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221122968.jpg" alt="img"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221122533.jpg" alt="img"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221123189.jpg" alt="img"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221123762.jpg" alt="img"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221123188.jpg" alt="img"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221123745.jpg" alt="img"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221123956.jpg" alt="img"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Dfile.encoding=UTF-8</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221123167.png" alt="image-20220620161704708"></p>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><ul>
<li>基本配置</li>
<li>编码</li>
<li>集成maven</li>
<li>相关插件(lombock mybatisx .ignore)</li>
<li>…</li>
</ul>
<h2 id="git"><a href="#git" class="headerlink" title="git"></a>git</h2><h3 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h3><blockquote>
<p>注意，安装步骤全都选择默认的配置即可，直接一路选择next下一步，即可完成</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221123383.png" alt="image-20220621001137664"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221123908.png" alt="image-20220621001150515"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221124871.png" alt="image-20220621001209579"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221124144.png" alt="image-20220621001222452"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221124190.png" alt="image-20220621001235074"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221124302.png" alt="image-20220621001248942"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221124174.png" alt="image-20220621001301837"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221124524.png" alt="image-20220621001316161"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221124439.png" alt="image-20220621001332096"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221124670.png" alt="image-20220621001347434"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221124763.png" alt="image-20220621001403725"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221124705.png" alt="image-20220621001415746"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221124809.png" alt="image-20220621001429378"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221124683.png" alt="image-20220621001439386"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221124726.png" alt="image-20220621001451297"></p>
<ul>
<li>Git GUI Here ，Git提供的图形化界面工具 </li>
<li>Git Bash Here ，Git提供的命令行工具</li>
</ul>
<p>查看不同级别的配置文件:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看系统config</span></span><br><span class="line">git config --system --list</span><br><span class="line"><span class="comment">#查看当前用户（global）配置</span></span><br><span class="line">git config --global  --list</span><br><span class="line"><span class="comment">#查看当前仓库配置信息</span></span><br><span class="line">git config --<span class="built_in">local</span>  --list</span><br></pre></td></tr></table></figure>

<p>设置用户全局的用户名和邮箱，这个会生成到当前用户的所有git管理的项目中</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置名称</span></span><br><span class="line">git config --global user.name <span class="string">&quot;briup&quot;</span></span><br><span class="line"><span class="comment"># 设置邮箱</span></span><br><span class="line">git config --global user.email <span class="string">&quot;briup@qq.com&quot;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221124494.png" alt="image-20220621002124273"></p>
<p><code>注意，如果你希望在一个特定的项目中使用不同的名称或邮箱地址，可以使用  --local 在项目重新 设置</code></p>
<h3 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 新建一个目录，将其初始化为Git代码库</span></span><br><span class="line">git init [project-name]</span><br><span class="line"><span class="comment"># 克隆一个远程仓库到本地</span></span><br><span class="line">git <span class="built_in">clone</span> [url]</span><br><span class="line"><span class="comment"># 查看指定文件状态</span></span><br><span class="line">git status [filename]</span><br><span class="line"><span class="comment"># 执行添加命令，将readme.txt文件添加到 staged暂存区</span></span><br><span class="line">git add readme.txt</span><br><span class="line"><span class="comment"># 将暂存区的readme文件进行commit提交</span></span><br><span class="line">git commit -m <span class="string">&#x27;create new file readme&#x27;</span></span><br><span class="line"><span class="comment"># 恢复改变之前</span></span><br><span class="line">git reset</span><br><span class="line"><span class="comment"># 关联远程仓库</span></span><br><span class="line">git remote add origin git地址</span><br><span class="line"><span class="comment"># 提交到远程仓库</span></span><br><span class="line">git push -u origin master</span><br><span class="line"><span class="comment"># 拉取项目</span></span><br><span class="line">git pull</span><br><span class="line"><span class="comment"># 克隆项</span></span><br></pre></td></tr></table></figure>



<h3 id="码云"><a href="#码云" class="headerlink" title="码云"></a>码云</h3><blockquote>
<p>注册账号</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221124151.png" alt="image-20220621002514246"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221124940.png" alt="image-20220621002525447"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221124032.png" alt="image-20220621002555044"></p>
<p><code>注意，这里可以使用【个人空间地址】、【绑定邮箱地址】、【绑定电话号码】进行登录</code></p>
<blockquote>
<p>创建仓库</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221603478.png" alt="image-20220622153051045"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221603472.png" alt="image-20220622153139411"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221603884.png" alt="image-20220622153222951"></p>
<h3 id="集成idea"><a href="#集成idea" class="headerlink" title="集成idea"></a>集成idea</h3><p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221603795.png" alt="image-20220622153459323"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221603824.png" alt="image-20220622153535867"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221603295.png" alt="image-20220622153621699"></p>
<p><code>忽略不需要提交的文件</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221603584.png" alt="image-20220622154228013"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221603283.png" alt="image-20220622154404569"></p>
<p>.gitignore</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Created by .ignore support plugin (hsz.mobi)</span></span><br><span class="line"><span class="comment">### Java template</span></span><br><span class="line"><span class="comment"># Compiled class file</span></span><br><span class="line">*.class</span><br><span class="line"></span><br><span class="line"><span class="comment"># Log file</span></span><br><span class="line">*.<span class="built_in">log</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># BlueJ files</span></span><br><span class="line">*.ctxt</span><br><span class="line"></span><br><span class="line"><span class="comment"># Mobile Tools for Java (J2ME)</span></span><br><span class="line">.mtj.tmp/</span><br><span class="line"></span><br><span class="line"><span class="comment"># Package Files #</span></span><br><span class="line">*.jar</span><br><span class="line">*.war</span><br><span class="line">*.nar</span><br><span class="line">*.ear</span><br><span class="line">*.zip</span><br><span class="line">*.tar.gz</span><br><span class="line">*.rar</span><br><span class="line"></span><br><span class="line"><span class="comment"># virtual machine crash logs, see http://www.java.com/en/download/help/error_hotspot.xml</span></span><br><span class="line">hs_err_pid*</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义添加</span></span><br><span class="line">.idea/</span><br><span class="line">target/</span><br></pre></td></tr></table></figure>



<p><code>添加到暂存区</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221603138.png" alt="image-20220622154642622"></p>
<p><code>提交代码</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221603596.png" alt="image-20220622154712923"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221603769.png" alt="image-20220622155133205"></p>
<p><code>推送到远程仓库</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221603888.png" alt="image-20220622155242351"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221603639.png" alt="image-20220622155326043"></p>
<p><code>如果是第一次提交 需要输入账号和密码</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221603038.png" alt="image-20220622155459593"></p>
<h3 id="协作开发"><a href="#协作开发" class="headerlink" title="协作开发"></a>协作开发</h3><blockquote>
<p>别人的私有仓库你是搜索查找不到的</p>
</blockquote>
<p>我们克隆别人的项目到本地，只能进行本地操作，无法将修改推送到别人的远程仓库中,但是，如果tom这时候将jack加入到这个远程仓库的开发成员中，那么jack也可以进行push和pull操作了</p>
<p>来到仓库主界面：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221603757.png" alt="image-20220622155916260"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221603020.png" alt="image-20220622160129307"></p>
<p><code>注意，这里截图中，使用用户注册时候的【姓名】进行的搜索，所以有很多相同名字的用户（姓名 可以重复），但是这里显示的名字后面还有灰色字体，这个就是该用户对于的个人空间地址（一定 是唯一的）</code></p>
<h1 id="前置知识"><a href="#前置知识" class="headerlink" title="前置知识"></a>前置知识</h1><h2 id="oracle-1"><a href="#oracle-1" class="headerlink" title="oracle"></a>oracle</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- demo表</span></span><br><span class="line"><span class="comment">-- 属性 类型  int id</span></span><br><span class="line"><span class="comment">-- oracle数字类型 number</span></span><br><span class="line"><span class="comment">-- oracle字符类型 varchar2</span></span><br><span class="line"><span class="comment">-- oralce支持的字段都是大写</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> demo(</span><br><span class="line">		id number(<span class="number">8</span>),</span><br><span class="line">		name VARCHAR2(<span class="number">20</span>),</span><br><span class="line">		age number(<span class="number">3</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删表</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> demo2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入数据(默认不提交 navicat 自动提交)</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> demo(id,name,age)</span><br><span class="line"><span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;briup&#x27;</span>,<span class="number">18</span>);</span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"><span class="comment">-- 主键自增 oracle不支持自增</span></span><br><span class="line"><span class="comment">-- 借助序列自增</span></span><br><span class="line"><span class="keyword">select</span> sequence_name <span class="keyword">from</span> user_sequences</span><br><span class="line"><span class="keyword">select</span> table_name <span class="keyword">from</span> user_tables</span><br><span class="line"><span class="comment">-- 创建序列</span></span><br><span class="line"><span class="keyword">create</span> sequence my_seq</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 借助哑表 dual 查序列</span></span><br><span class="line"><span class="keyword">select</span> my_seq.nextval <span class="keyword">from</span> dual</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> demo(name,age)</span><br><span class="line"><span class="keyword">values</span>(<span class="string">&#x27;briup&#x27;</span>,<span class="number">18</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改数据</span></span><br><span class="line">update demo <span class="keyword">set</span> name <span class="operator">=</span> <span class="string">&#x27;vanse&#x27;</span></span><br><span class="line"><span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询数据</span></span><br><span class="line"><span class="keyword">select</span> id,name,age <span class="keyword">from</span> demo;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除数据</span></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> demo</span><br><span class="line"><span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>



<h2 id="jsp"><a href="#jsp" class="headerlink" title="jsp"></a>jsp</h2><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;%--</span><br><span class="line">  Created by IntelliJ IDEA.</span><br><span class="line">  User: vanse</span><br><span class="line">  Date: <span class="number">2022</span>/<span class="number">6</span>/<span class="number">24</span></span><br><span class="line">  Time: <span class="number">11</span>:<span class="number">21</span></span><br><span class="line">  To change <span class="keyword">this</span> template use File | Settings | File Templates.</span><br><span class="line">--%&gt;</span><br><span class="line">&lt;%--jsp前缀--%&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> isELIgnored=<span class="string">&quot;false&quot;</span> %&gt;</span><br><span class="line">&lt;%--html代码--%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;注册&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;%--表单--%&gt;</span><br><span class="line">    &lt;%--style每个标签 内置css--%&gt;</span><br><span class="line">&lt;%--</span><br><span class="line">    border: 边框 1px <span class="number">1</span>个像素</span><br><span class="line">    solid 实线</span><br><span class="line">    black 线的颜色</span><br><span class="line">    width 宽度</span><br><span class="line">    height 高度</span><br><span class="line">--%&gt;</span><br><span class="line">    &lt;div style=<span class="string">&quot;border: 1px solid black;width: 208px;height: 80px&quot;</span>&gt;</span><br><span class="line">        &lt;%--action 数据提交的位置 java后台--%&gt;</span><br><span class="line">        &lt;%--将来后台代码的路径 register--%&gt;</span><br><span class="line">            &lt;%--name: 将数据提交到后台--%&gt;</span><br><span class="line">            &lt;%--默认提交方式 是get 数据拼接在地址栏后面--%&gt;</span><br><span class="line">            &lt;%--post提交: 数据放在请求体中--%&gt;</span><br><span class="line">        &lt;form action=<span class="string">&quot;/register&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">            账号&amp;nbsp;&amp;nbsp;&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;username&quot;</span> placeholder=<span class="string">&quot;请输入账号&quot;</span>&gt;&lt;br/&gt;</span><br><span class="line">            密码&amp;nbsp;&amp;nbsp;&lt;input type=<span class="string">&quot;password&quot;</span> name=<span class="string">&quot;password&quot;</span> placeholder=<span class="string">&quot;请输入密码&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">           &lt;div style=<span class="string">&quot;margin-left: 42px;margin-top: 5px;&quot;</span>&gt;</span><br><span class="line">               &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;注册&quot;</span>&gt;</span><br><span class="line">               &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;登录&quot;</span>&gt;</span><br><span class="line">           &lt;/div&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="servlet"><a href="#servlet" class="headerlink" title="servlet"></a>servlet</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>Servlet技术可以扩展服务器端的功能，让java代码在服务器端也能成为一种资源（动态资源），客户端浏览器可以通过指定的资源地址（URI），来访问这个java代码（Servlet），同时在Servlet代码中，还可以使用IO流把结果写回给浏览器。</p>
<p>按照Servlet规范要求，编写一个Servlet程序，只需要让自己的类实现<code>javax.servlet.Servlet</code>接口就可以了，但是该接口也有一些默认的实现类，所以除了实现接口的方式之外，我们也可以继承它默认的几个实现类，并且重写指定方法，也同样可以完成Servlet程序的编写。</p>
<p><strong>servlet依赖</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><p><strong>LoginServlet</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.demo.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse(lc))</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022/6/24-06-24-16:56</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：登录api</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// 需要实现servlet规范</span></span><br><span class="line">    <span class="comment">// implements Servlet</span></span><br><span class="line">    <span class="comment">//HttpServlet 该类已经实现了Servlet</span></span><br><span class="line"><span class="comment">// 该类的访问路径</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/login&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 该类的作用: 接收前端数据</span></span><br><span class="line"><span class="comment">     * 表单如果使用了get请求</span></span><br><span class="line"><span class="comment">     * post请求 将来页面请求/resgister 自动调用Post方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">       doGet(req,resp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">// soutm soutv</span></span><br><span class="line">        <span class="comment">// HttpServletRequest 封装了请求相关的方法</span></span><br><span class="line">        <span class="comment">// 获取参数 参数乱码</span></span><br><span class="line">        req.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>); <span class="comment">// ISO-8859-1 -&gt; UTF-8</span></span><br><span class="line">        resp.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        String username = req.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;username = &quot;</span> + username);</span><br><span class="line">        <span class="comment">// 新的编码字符串</span></span><br><span class="line">        <span class="comment">//username = new String(username.getBytes(&quot;ISO-8859-1&quot;),&quot;UTF-8&quot;);</span></span><br><span class="line"></span><br><span class="line">        String password = req.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;password = &quot;</span> + password);</span><br><span class="line">        <span class="comment">// 获取session范围对象 没有session对象会自动创建session</span></span><br><span class="line">        HttpSession session = req.getSession();</span><br><span class="line">        <span class="comment">// 获取application范围对象 context 泛指上下文</span></span><br><span class="line">        ServletContext application = req.getServletContext();</span><br><span class="line">        <span class="comment">// 页面跳转</span></span><br><span class="line">            <span class="comment">// 如果登录成功(查数据库)  跳转首页</span></span><br><span class="line">        <span class="comment">// 模拟内存数据</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;briup&quot;</span>.equals(username) &amp;&amp; <span class="string">&quot;123&quot;</span>.equals(password))&#123;</span><br><span class="line">            <span class="comment">// 登录成功 跳转首页</span></span><br><span class="line">            <span class="comment">// 请求转发   index.jsp</span></span><br><span class="line">            <span class="comment">// 获取请求转发器 一次请求</span></span><br><span class="line">            <span class="comment">//req.getRequestDispatcher(&quot;/index.jsp&quot;).forward(req,resp);</span></span><br><span class="line">            session.setAttribute(<span class="string">&quot;username&quot;</span>,username);</span><br><span class="line">            <span class="comment">// 重定向 (两次请求)</span></span><br><span class="line">            <span class="comment">// 重定向 (两次请求)</span></span><br><span class="line">            resp.sendRedirect(<span class="string">&quot;/index.jsp&quot;</span>);</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">// 登录失败 重新跳转登录页面</span></span><br><span class="line">            session.setAttribute(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;账户有误&quot;</span>);</span><br><span class="line"><span class="comment">//            req.getRequestDispatcher(&quot;/login.jsp&quot;).forward(req,resp);</span></span><br><span class="line">            <span class="comment">// 重定向</span></span><br><span class="line">            resp.sendRedirect(<span class="string">&quot;/login.jsp&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>login.jsp</strong></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">&lt;%--</span><br><span class="line">  Created by IntelliJ IDEA.</span><br><span class="line">  User: vanse</span><br><span class="line">  Date: <span class="number">2022</span>/<span class="number">6</span>/<span class="number">24</span></span><br><span class="line">  Time: <span class="number">11</span>:<span class="number">21</span></span><br><span class="line">  To change <span class="keyword">this</span> template use File | Settings | File Templates.</span><br><span class="line">--%&gt;</span><br><span class="line">&lt;%--jsp前缀--%&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> isELIgnored=<span class="string">&quot;false&quot;</span> %&gt;</span><br><span class="line">&lt;%--html代码--%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;注册&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="comment">/*js弹框*/</span></span><br><span class="line">   <span class="keyword">var</span> msg =  <span class="string">&quot;$&#123;msg&#125;&quot;</span>;</span><br><span class="line">   <span class="comment">// js 条件如果是空 &quot;&quot; undefined</span></span><br><span class="line">    <span class="keyword">if</span>(msg)&#123;</span><br><span class="line">        <span class="comment">// console.log(msg)</span></span><br><span class="line">        <span class="comment">// if条件为真</span></span><br><span class="line">        window.alert(msg);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 把session中的msg移除掉</span></span><br><span class="line">    &lt;%</span><br><span class="line">        HttpSession session1 = request.getSession();</span><br><span class="line">        session1.removeAttribute(<span class="string">&quot;msg&quot;</span>);</span><br><span class="line">    %&gt;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;%--表单--%&gt;</span><br><span class="line">    &lt;%--style每个标签 内置css--%&gt;</span><br><span class="line">&lt;%--</span><br><span class="line">    border: 边框 1px <span class="number">1</span>个像素</span><br><span class="line">    solid 实线</span><br><span class="line">    black 线的颜色</span><br><span class="line">    width 宽度</span><br><span class="line">    height 高度</span><br><span class="line">--%&gt;</span><br><span class="line">    &lt;div style=<span class="string">&quot;border: 1px solid black;width: 208px;height: 80px&quot;</span>&gt;</span><br><span class="line">        &lt;%--action 数据提交的位置 java后台--%&gt;</span><br><span class="line">        &lt;%--将来后台代码的路径 register--%&gt;</span><br><span class="line">            &lt;%--name: 将数据提交到后台--%&gt;</span><br><span class="line">            &lt;%--默认提交方式 是get 数据拼接在地址栏后面--%&gt;</span><br><span class="line">            &lt;%--post提交: 数据放在请求体中--%&gt;</span><br><span class="line">        &lt;form action=<span class="string">&quot;/login&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">            账号&amp;nbsp;&amp;nbsp;&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;username&quot;</span> placeholder=<span class="string">&quot;请输入账号&quot;</span>&gt;&lt;br/&gt;</span><br><span class="line">            密码&amp;nbsp;&amp;nbsp;&lt;input type=<span class="string">&quot;password&quot;</span> name=<span class="string">&quot;password&quot;</span> placeholder=<span class="string">&quot;请输入密码&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">           &lt;div style=<span class="string">&quot;margin-left: 42px;margin-top: 5px;&quot;</span>&gt;</span><br><span class="line">               &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;登录&quot;</span>&gt;</span><br><span class="line">           &lt;/div&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><strong>index.jsp</strong></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;%-- isELIgnored=<span class="string">&quot;false&quot;</span> 不忽略el表达式 快速取值--%&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> isELIgnored=<span class="string">&quot;false&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h2&gt;Hello World!&lt;/h2&gt;</span><br><span class="line">    欢迎您! $&#123;username&#125;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h3 id="集成tomcat"><a href="#集成tomcat" class="headerlink" title="集成tomcat"></a>集成tomcat</h3><p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221125889.png" alt="image-20220103133043937"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221125167.png" alt="image-20220103133114835"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221125193.png" alt="image-20220103133222346"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221125652.png" alt="image-20220103133501639"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221125963.png" alt="image-20220103133518468"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221125915.png" alt="image-20220103133534530"></p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/shej123/p/10312806.html">解决</a>Idea中整合tomcat乱码的问题 启动tomcat时添加vm参数  -Dfile.encoding=UTF-8</p>
</blockquote>
<h2 id="mybatis"><a href="#mybatis" class="headerlink" title="mybatis"></a>mybatis</h2><h3 id="起源"><a href="#起源" class="headerlink" title="起源"></a>起源</h3><p><code>MyBatis</code> 是一款优秀的持久层开源框架，它支持自定义 SQL、存储过程以及高级映射。<code>MyBatis</code>免除了几乎所有的 JDBC 代码以及设置参数和获取结果集的工作。<code>MyBatis</code>可以通过简单的 XML 或注解来配置和映射原始类型、接口和 Java POJO（Plain Old java Objects，普通老式 Java 对象）为数据库中的记录。</p>
<p>MyBatis的前身是iBATIS，iBATIS于2002年由ClintonBegin创建。MyBatis3是iBATIS的全新设计，支持注解和Mapper。</p>
<p>MyBatis流行的主要原因在于它的简单性和易使用性。在Java应用程序中，数据持久化层涉及到的工作有：</p>
<ul>
<li>将从数据库查询到的数据生成所需要的Java对象</li>
<li>将Java对象中的数据通SQL持久化到数据库中</li>
</ul>
<p>MyBatis通过抽象底层的JDBC代码，自动化封装SQL结果集产生Java对象、Java对象的数据持久化数据库中的过程使得对SQL的使用变得容易。</p>
<h3 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h3><blockquote>
<p>开源的orm映射框架 (封装了jdbc)</p>
</blockquote>
<ul>
<li><p>依赖 mybaits/驱动/lombok</p>
</li>
<li><p>实体/表  orm</p>
</li>
<li><p>mybatis配置</p>
<ul>
<li><p>核心配置文件(数据源,映射文件)</p>
</li>
<li><p>映射器</p>
<ul>
<li>映射接口(和sql文件绑定)<ul>
<li>调用接口方法就能执行sql</li>
</ul>
</li>
<li>映射文件 xml</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>mybatis四大组件</strong></p>
<ul>
<li>SqlSessionFactoryBuilder(构建器模式)(核心配置文件)</li>
<li>SqlSessionFactory(工厂模式)</li>
<li>SqlSession(Connection) 主体</li>
<li>映射器</li>
</ul>
<h3 id="实现-1"><a href="#实现-1" class="headerlink" title="实现"></a>实现</h3><h4 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h4><p><strong>pom.xml</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--mybatis--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.oracle.ojdbc/ojdbc8 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.oracle.ojdbc<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ojdbc8<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>19.3.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.projectlombok/lombok --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--lomboc 简化set/get/toString/构造器方法--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--测试单元jar--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--&lt;scope&gt;compile&lt;/scope&gt;--&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="核心配置"><a href="#核心配置" class="headerlink" title="核心配置"></a>核心配置</h4><p><strong>mybatis-config.xml</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--外置数据源--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;db.properties&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--数据源--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--映射文件位置 将来只需要加载核心配置文件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;mapper/UserMapper.xml&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="映射接口"><a href="#映射接口" class="headerlink" title="映射接口"></a>映射接口</h4><p><strong>UserMapper</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.mybatis.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.mybatis.entity.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse(lc))</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022/6/25-06-25-16:22</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：映射接口 -&gt; 和映射文件一致</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 接口中的方法要和映射文件的sql一致</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insertUser</span><span class="params">(User user)</span></span>; <span class="comment">// 插入用户</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">updateUser</span><span class="params">(User user)</span></span>; <span class="comment">// 修改用户</span></span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">query</span><span class="params">()</span></span>;  <span class="comment">// 查询所有用户</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deleteById</span><span class="params">(<span class="keyword">int</span> id)</span></span>; <span class="comment">// 根据id删除</span></span><br><span class="line">    <span class="function">User <span class="title">queryById</span><span class="params">(<span class="keyword">int</span> id)</span></span>; <span class="comment">// 根据id查询</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="映射文件"><a href="#映射文件" class="headerlink" title="映射文件"></a>映射文件</h4><p><strong>src/main/resources/mapper/UserMapper.xml</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.briup.mybatis.mapper.UserMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.briup.mybatis.entity.User&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        insert into t_user(id,username,password,age)</span><br><span class="line">        values (my_seq.nextval,#&#123;username&#125;,#&#123;password&#125;,#&#123;age&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.briup.mybatis.entity.User&quot;</span>&gt;</span></span><br><span class="line">        update t_user set username=#&#123;username&#125;,password=#&#123;password&#125;</span><br><span class="line">        where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--根据id删除--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">        delete from t_user</span><br><span class="line">        where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        resultType: 封装的返回类型</span></span><br><span class="line"><span class="comment">        前提: 列名和字段名 使用resultType 才能自动映射</span></span><br><span class="line"><span class="comment">            xml -&gt;  java</span></span><br><span class="line"><span class="comment">            conn.prepareStatement(sql);</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;query&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.briup.mybatis.entity.User&quot;</span>&gt;</span></span><br><span class="line">        select id,username,password,age from t_user</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--复杂映射--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--resultmap</span></span><br><span class="line"><span class="comment">        手动映射</span></span><br><span class="line"><span class="comment">        处理多表的关系</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;userMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.briup.mybatis.entity.User&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--User中的属性 手动映射--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--id 独立--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--其他属性--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;username&quot;</span> <span class="attr">column</span>=<span class="string">&quot;user_name&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--如果列名和属性名一致 可省略--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;result property=&quot;password&quot; column=&quot;password&quot;/&gt;</span></span><br><span class="line"><span class="comment">        &lt;result property=&quot;age&quot; column=&quot;age&quot;/&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;queryById&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;userMap&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">        select id,user_name,password,age from t_user</span><br><span class="line">        where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- &lt;select id=&quot;queryById&quot; resultType=&quot;com.briup.mybatis.entity.User&quot; parameterType=&quot;int&quot;&gt;</span></span><br><span class="line"><span class="comment">        select id,user_name as username,password,age from t_user</span></span><br><span class="line"><span class="comment">        where id = #&#123;id&#125;</span></span><br><span class="line"><span class="comment">    &lt;/select&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="加载函数"><a href="#加载函数" class="headerlink" title="加载函数"></a>加载函数</h4><p><strong>TestUser</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.briup.mybatis.entity.User;</span><br><span class="line"><span class="keyword">import</span> com.briup.mybatis.mapper.UserMapper;</span><br><span class="line"><span class="keyword">import</span> com.briup.mybatis.utils.SqlSessionUtil;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse(lc))</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022/6/25-06-25-17:15</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：测试mybatis</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestUser</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">// 使用mybatis 操作数据库</span></span><br><span class="line">        <span class="comment">// 核心配置文件 -&gt; Inputstream</span></span><br><span class="line">        <span class="comment">// TestUser.class.getClassLoader().getResourceAsStream(&quot;xml&quot;);</span></span><br><span class="line">        <span class="comment">// alt+shift+z</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            InputStream in = Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line">            <span class="comment">// 构建器对象</span></span><br><span class="line">            SqlSessionFactoryBuilder builder = <span class="keyword">new</span> SqlSessionFactoryBuilder();</span><br><span class="line">            <span class="comment">// 工厂对象</span></span><br><span class="line">            SqlSessionFactory factory = builder.build(in);</span><br><span class="line">            <span class="comment">// SqlSession连接对象</span></span><br><span class="line">            SqlSession session = factory.openSession();</span><br><span class="line">            <span class="comment">// 调用接口中方法</span></span><br><span class="line">            System.out.println(session);</span><br><span class="line">            UserMapper userMapper = session.getMapper(UserMapper.class);</span><br><span class="line">            User user = <span class="keyword">new</span> User(<span class="number">1</span>,<span class="string">&quot;briup&quot;</span>,<span class="string">&quot;000&quot;</span>,<span class="number">18</span>);</span><br><span class="line">            userMapper.insertUser(user);</span><br><span class="line">            <span class="comment">// 需要手动提交事务</span></span><br><span class="line">            session.commit();</span><br><span class="line">            <span class="comment">// 关闭资源</span></span><br><span class="line">            session.close();</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">// alt + shift + m</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            InputStream in = Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line">            <span class="comment">// 构建器对象</span></span><br><span class="line">            SqlSessionFactoryBuilder builder = <span class="keyword">new</span> SqlSessionFactoryBuilder();</span><br><span class="line">            <span class="comment">// 工厂对象</span></span><br><span class="line">            SqlSessionFactory factory = builder.build(in);</span><br><span class="line">            <span class="comment">// SqlSession连接对象</span></span><br><span class="line">            SqlSession session = factory.openSession();</span><br><span class="line">            <span class="comment">// 调用接口中方法</span></span><br><span class="line">            UserMapper userMapper = session.getMapper(UserMapper.class);</span><br><span class="line">            User user = <span class="keyword">new</span> User(<span class="number">1</span>,<span class="string">&quot;vanse&quot;</span>,<span class="string">&quot;vanse&quot;</span>,<span class="number">18</span>);</span><br><span class="line">            userMapper.updateUser(user);</span><br><span class="line">            <span class="comment">// 需要手动提交事务</span></span><br><span class="line">            session.commit();</span><br><span class="line">            <span class="comment">// 关闭资源</span></span><br><span class="line">            session.close();</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update2</span><span class="params">()</span></span>&#123;</span><br><span class="line">        SqlSession session = SqlSessionUtil.getSqlSession();</span><br><span class="line"></span><br><span class="line">        UserMapper userMapper = session.getMapper(UserMapper.class);</span><br><span class="line">        User user = <span class="keyword">new</span> User(<span class="number">1</span>,<span class="string">&quot;vanse&quot;</span>,<span class="string">&quot;123&quot;</span>,<span class="number">18</span>);</span><br><span class="line">        userMapper.updateUser(user);</span><br><span class="line"></span><br><span class="line">        session.commit();</span><br><span class="line">        session.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询(查数据 不需要事务)</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">query</span><span class="params">()</span></span>&#123;</span><br><span class="line">        SqlSession session = SqlSessionUtil.getSqlSession();</span><br><span class="line"></span><br><span class="line">        UserMapper userMapper = session.getMapper(UserMapper.class);</span><br><span class="line">        <span class="comment">// 查询用户</span></span><br><span class="line">        List&lt;User&gt; userList = userMapper.query();</span><br><span class="line">        <span class="comment">// userList.iter</span></span><br><span class="line">        <span class="keyword">for</span> (User user : userList) &#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line">        session.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 删除</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteById</span><span class="params">()</span></span>&#123;</span><br><span class="line">        SqlSession sqlSession = SqlSessionUtil.getSqlSession();</span><br><span class="line">        UserMapper userMapper = sqlSession.getMapper(UserMapper.class);</span><br><span class="line">        <span class="comment">// 代码的红色是报错</span></span><br><span class="line">        userMapper.deleteById(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        sqlSession.commit();</span><br><span class="line">        sqlSession.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据id查询</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">queryById</span><span class="params">()</span></span>&#123;</span><br><span class="line">        SqlSession sqlSession = SqlSessionUtil.getSqlSession();</span><br><span class="line">        UserMapper mapper = sqlSession.getMapper(UserMapper.class);</span><br><span class="line">        System.out.println(mapper.queryById(<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h3><p><strong>pom.xml</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 日志框架log4j的依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>log4j.properties</strong></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">log4j.rootLogger</span>=<span class="string">DEBUG, stdout </span></span><br><span class="line"><span class="meta">log4j.appender.stdout</span>=<span class="string">org.apache.log4j.ConsoleAppender </span></span><br><span class="line"><span class="meta">log4j.appender.stdout.layout</span>=<span class="string">org.apache.log4j.PatternLayout </span></span><br><span class="line"><span class="meta">log4j.appender.stdout.layout.ConversionPattern</span>=<span class="string">%d [%-5p] %c - %m%n</span></span><br><span class="line"><span class="comment">#show sql</span></span><br><span class="line"><span class="meta">log4j.logger.java.sql.ResultSet</span>=<span class="string">INFO  </span></span><br><span class="line"><span class="meta">log4j.logger.org.apache</span>=<span class="string">INFO  </span></span><br><span class="line"><span class="meta">log4j.logger.java.sql.Connection</span>=<span class="string">DEBUG  </span></span><br><span class="line"><span class="meta">log4j.logger.java.sql.Statement</span>=<span class="string">DEBUG  </span></span><br><span class="line"><span class="meta">log4j.logger.java.sql.PreparedStatement</span>=<span class="string">DEBUG </span></span><br></pre></td></tr></table></figure>



<h3 id="封装"><a href="#封装" class="headerlink" title="封装"></a>封装</h3><p><strong>SqlSessionUtil</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.mybatis.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse(lc))</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022/6/26-06-26-9:13</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：SqlSession工具类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SqlSessionUtil</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 单例模式</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SqlSessionFactory factory = <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">// 获取工厂</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SqlSessionFactory <span class="title">getSqlSessionFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        InputStream in = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            in = Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line">            <span class="comment">// 获取工厂对象</span></span><br><span class="line">            <span class="keyword">if</span> (factory == <span class="keyword">null</span>) &#123;</span><br><span class="line">                factory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(in);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> factory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 静态方法 手动提交</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SqlSession <span class="title">getSqlSession</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getSqlSession(<span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 给定参数 (true: 自定提交  false: 手动提交)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SqlSession <span class="title">getSqlSession</span><span class="params">(<span class="keyword">boolean</span> autocommit)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getSqlSessionFactory().openSession(autocommit);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h2 id="三层架构"><a href="#三层架构" class="headerlink" title="三层架构"></a>三层架构</h2><p>在web项目的代码结构中，经常会使用到三层架构：</p>
<ul>
<li>web层  servlet/filter/listener</li>
<li>service层 </li>
<li>dao层</li>
</ul>
<p>web层中代码的主要任务：</p>
<ul>
<li>接收客户端传来的参数</li>
<li>把参数封装成对象   saveUser(user)</li>
<li>把封装好的对象/数据传给service</li>
<li>根据service层的处理结果决定把那个页面/数据返回给客户端</li>
</ul>
<p>service层中代码的主要任务：</p>
<ul>
<li>接收web层传过来的对象/数据(如果有的话)</li>
<li>根据这些信息进行业务逻辑处理</li>
</ul>
<p>例如，完成一个登录功能，web层接收到用户名和密码之后，把数据传给service层，service层就要根据这些信息来判断用户名是否存在、密码是否正确、用户是否有权限、用户状态当前是否可用、用户是否推送信息、是否给用户相关提示等，这些都属于登录的业务逻辑处理</p>
<p>dao层中代码的主要任务：</p>
<ul>
<li>接受service传的参数(如果有的话)</li>
<li>和数据库进行交互</li>
<li>把交互结果返回给service层</li>
</ul>
<p><strong>思考，项目的代码为何要分层编写，全部代码写到一个类中进行实现，是否可以？</strong></p>
<p>web</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/login&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        req.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        String username = req.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        String password = req.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">        UserService userService = <span class="keyword">new</span> UserServiceImpl();</span><br><span class="line">        User user = userService.login(username, password);</span><br><span class="line">        req.getSession().setAttribute(<span class="string">&quot;user&quot;</span>,user);</span><br><span class="line">        resp.sendRedirect(<span class="string">&quot;index.jsp&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>service</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.before.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.before.bean.User;</span><br><span class="line"><span class="keyword">import</span> com.briup.before.mapper.UserMapper;</span><br><span class="line"><span class="keyword">import</span> com.briup.before.service.UserService;</span><br><span class="line"><span class="keyword">import</span> com.sun.deploy.util.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse(lc))</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022/6/22-06-22-4:54</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：com.briup.before.service.impl</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">login</span><span class="params">(String username, String password)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            InputStream in = Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line">            SqlSessionFactory factory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(in);</span><br><span class="line">            SqlSession session = factory.openSession();</span><br><span class="line">            UserMapper userMapper = session.getMapper(UserMapper.class);</span><br><span class="line">            User user = userMapper.login(username, password);</span><br><span class="line">            <span class="keyword">if</span> (user == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;用户名或者密码有误&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> user;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>dao</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function">User <span class="title">login</span><span class="params">(<span class="meta">@Param(&quot;username&quot;)</span> String username, <span class="meta">@Param(&quot;password&quot;)</span> String password)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;select id=<span class="string">&quot;login&quot;</span> resultType=<span class="string">&quot;com.briup.before.bean.User&quot;</span>&gt;</span><br><span class="line">          select * from t_user</span><br><span class="line">          where username=#&#123;username&#125; and password=#&#123;password&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<p><strong>其他</strong></p>
<ul>
<li>工具类</li>
<li>过滤器</li>
<li>…</li>
</ul>
<h1 id="estore"><a href="#estore" class="headerlink" title="estore"></a>estore</h1><h2 id="项目概述"><a href="#项目概述" class="headerlink" title="项目概述"></a>项目概述</h2><h3 id="概述-2"><a href="#概述-2" class="headerlink" title="概述"></a>概述</h3><p><strong>estore</strong>系统，也成为网上商城，主要业务是完成在线购物的功能。</p>
<p>estore系统包括前台商家系统、买家系统及后台管理员操作系统，其功能包括：</p>
<ul>
<li>用户浏览</li>
<li>购物车</li>
<li>商品管理</li>
<li>用户管理</li>
<li>订单管理</li>
<li>配送管理</li>
<li>广告推广</li>
<li>…</li>
</ul>
<p>如图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221609144.png" alt="image-20201025221024414"></p>
<h3 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h3><p>通过该项目的编写，需要完成的学习目标如下：</p>
<ul>
<li>掌握软件开发流程</li>
<li>完成软件开发项目</li>
<li>积累软件开发经验</li>
<li>巧用软件开发技术</li>
<li>熟悉电商业务模型</li>
<li>发扬团队合作精神</li>
<li>提高语言表达能力</li>
<li>锻炼文档书写能力</li>
<li>分析解决问题能力</li>
</ul>
<h3 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h3><p>软件开发的流程，大致可以分为：</p>
<ul>
<li>软件需求分析（Software Requirements Analysis）</li>
<li>数据建模（ Data Model ）</li>
<li>编码/单元测试（Coding）</li>
<li>联合调试（Integration）</li>
<li>系统测试（Testing）</li>
<li>运行维护（Installation &amp; Maintenance)</li>
</ul>
<p>###模型</p>
<p>常见的软件开发过程模块主要分为：</p>
<ul>
<li>瀑布模型</li>
<li>快速原型模型</li>
<li>螺旋模型</li>
</ul>
<p><strong>1、瀑布模型</strong></p>
<blockquote>
<p>它是线性模型的一种，在所有模型中占有重要地位，是所有其他模型的一个基础</p>
</blockquote>
<p>每一个阶段执行一次，按线性顺序进行软件开发。</p>
<p>如图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221610422.png" alt="image-20201025222756402"></p>
<p>在该模型中，测试阶段处于软件实现后，必须在代码完成后留出足够的时间来进行测试，否则将导致测试不充分，并且很多问题到项目后期才暴露。</p>
<p>瀑布模型的优点：</p>
<ul>
<li>开发的各个阶段比较清晰</li>
<li>强调早期计划及需求调查</li>
<li>适合需求稳定的产品开发</li>
</ul>
<p>瀑布模型的缺点：</p>
<ul>
<li>依赖于早期的需求调查，不适应需求的变化</li>
<li>单一流程不可逆</li>
<li>风险往往延至后期才显露，失去及早纠正的机会</li>
<li>问题在项目后期才开始暴露</li>
<li>前面未发现的错误会传递并扩散到后面的阶段，可能导致项目失败</li>
</ul>
<p><strong>2、快速原型模型</strong></p>
<blockquote>
<p>它是沿用瀑布模型的线性思想，细化了各个阶段，在某些重要关注的阶段之间掺入迭代的思想</p>
</blockquote>
<p>在开发真实系统之前，构造一个原型，在该原型的基础上，逐渐完成整个系统的开发工作。</p>
<p>例如，</p>
<p>第一步，建造一个快速原型，实现用户与系统的交互，用户对原型进行评价，进一步细化软件的需求。通过逐步调整原型使其满足用户的要求，开发人员可以确定用户的真正需求是什么。</p>
<p>第二步，是在第一步的基础上开发出用户满意的软件产品。</p>
<p>如图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221610754.png" alt="image-20201025223354574"></p>
<blockquote>
<p>注意，原型中，只是粗糙的对功能进行实现，和用户进行沟通、测试、评价、修改，迭代这个过程，最终获取用户真正想要的软件功能</p>
</blockquote>
<p>快速原型模型优点：</p>
<ul>
<li>克服瀑布模型的缺点，更好地满足用户的需求并减少由于软件需求不明确带来的项目开发风险。</li>
<li>适合预先不能确切定义需求的软件系统的开发。</li>
</ul>
<p>快速原型模型缺点：</p>
<ul>
<li>不适合大型系统的开发，对于小型的、灵活性高的系统较为合适</li>
<li>前提要有一个展示性的产品原型，并且需要专门学习相应的工具使用</li>
</ul>
<p>有很多专门快速创建原型的工具，例如，<strong>Axure</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221610825.png" alt="image-20201025225936217"></p>
<p>构建完成后，可以在浏览器中发布预览：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221610482.png" alt="image-20201025230039406"></p>
<p><strong>3、螺旋模型</strong></p>
<blockquote>
<p>螺旋模型是以快速原型模型为基础，在每个项目阶段使用瀑布模型法</p>
</blockquote>
<p>这种模型的每一个周期都包括需求定义、风险分析、工程实现和评审4个阶段，由这4个阶段进行迭代。</p>
<p>螺旋模型即是一种引入了风险分析与规避机制的过程模型，是瀑布模型、快速原型方法和风险分析方法的有机结合。</p>
<p>螺旋模型最大的特点在于引入了其他模型不具备的风险分析，使软件在无法排除重大风险时有机会停止，以减小损失。</p>
<p>如图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221610266.png" alt="image-20201025230811641"></p>
<p>螺旋模型沿着螺线进行若干次迭代，图中的四个象限代表了以下活动： </p>
<ul>
<li>制定计划：确定软件目标，选定实施方案，弄清项目开发的限制条件</li>
<li>风险分析：分析评估所选方案，考虑如何识别和消除风险</li>
<li>实施工程：实施软件开发和验证</li>
<li>客户评估：评价开发工作，提出修正建议，制定下一步计划</li>
</ul>
<p>每轮循环包含如下六个步骤：</p>
<ol>
<li>确定目标</li>
<li>识别并化解风险</li>
<li>评估</li>
<li>开发并测试当前阶段</li>
<li>规划下一阶段</li>
<li>确定进入下一阶段的方法步骤</li>
</ol>
<p>螺旋模型强调<strong>风险分析</strong>，使得开发人员和用户对每个演化层出现的风险有所了解，继而做出应有的反应，因此特别适用于庞大、复杂并具有高风险的系统。</p>
<p>螺旋模型优点：</p>
<ul>
<li>螺旋模型很大程度上是一种风险驱动的方法体系</li>
<li>每个阶段之前及经常发生的循环之前，都必须首先进行风险评估</li>
</ul>
<p>螺旋模型缺点：</p>
<ul>
<li>采用螺旋模型需要具有相当丰富的风险评估经验和专门知识</li>
<li>在风险较大的项目开发中，如果未能够及时标识风险，势必造成重大损失</li>
<li>过多的迭代次数会增加开发成本，延迟提交时间</li>
</ul>
<h3 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h3><p>在当前项目中，我们采用之前介绍过的三层架构：</p>
<ul>
<li>web层，负责和客户端交互</li>
<li>service层，负责处理业务逻辑功能</li>
<li>dao层，负责和数据库交互</li>
</ul>
<p>如图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221610242.png" alt="image-20201025231923231"></p>
<h3 id="技术"><a href="#技术" class="headerlink" title="技术"></a>技术</h3><p>该项目中所采用的技术：</p>
<ul>
<li>前端技术<ul>
<li>html、css、js、ajax、jquery</li>
</ul>
</li>
<li>后端技术<ul>
<li>servlet、jsp、jdbc、mybaits</li>
</ul>
</li>
<li>数据库<ul>
<li>oracle、mysql</li>
</ul>
</li>
</ul>
<h3 id="用例"><a href="#用例" class="headerlink" title="用例"></a>用例</h3><p>系统中，用户核心功能的用例图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221610842.png" alt="image-20201025235346234"></p>
<h3 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h3><p>系统中一些主要功能说明：</p>
<ul>
<li>注册<ul>
<li>需要判断注册的用户名是否已经在数据库中存在</li>
<li>最后将注册信息保存到数据库中</li>
</ul>
</li>
<li>登录<ul>
<li>查看登陆的用户名是否存在</li>
<li>查看密码是否正确</li>
</ul>
</li>
<li>购物车<ul>
<li>增加订单项</li>
<li>查看购物车</li>
<li>删除订单项</li>
<li>修改订单项</li>
</ul>
</li>
<li>订单<ul>
<li>查看订单</li>
<li>提交订单</li>
<li>删除订单</li>
</ul>
</li>
</ul>
<h3 id="ER图"><a href="#ER图" class="headerlink" title="ER图"></a>ER图</h3><p>系统中的ER图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221609612.png" alt="image-20201025235451555"></p>
<h2 id="项目准备"><a href="#项目准备" class="headerlink" title="项目准备"></a>项目准备</h2><h3 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h3><h4 id="导入表"><a href="#导入表" class="headerlink" title="导入表"></a>导入表</h4><p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221134871.png" alt="image-20210909101745687"></p>
<h4 id="数据字典"><a href="#数据字典" class="headerlink" title="数据字典"></a>数据字典</h4><p>该系统的数据字典如下：</p>
<p><strong>es_customer，用户表</strong></p>
<table>
<thead>
<tr>
<th>列名</th>
<th>类型</th>
<th>约束</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>int</td>
<td>primary key</td>
<td>编号</td>
</tr>
<tr>
<td>name</td>
<td>varchar</td>
<td>not null</td>
<td>用户名</td>
</tr>
<tr>
<td>password</td>
<td>varchar</td>
<td>not null</td>
<td>密码</td>
</tr>
<tr>
<td>zipCode</td>
<td>varchar</td>
<td>-</td>
<td>邮编</td>
</tr>
<tr>
<td>address</td>
<td>varchar</td>
<td>-</td>
<td>地址</td>
</tr>
<tr>
<td>telephone</td>
<td>varchar</td>
<td>-</td>
<td>电话</td>
</tr>
<tr>
<td>email</td>
<td>varchar</td>
<td>-</td>
<td>邮箱</td>
</tr>
</tbody></table>
<p><strong>es_book，书籍表</strong></p>
<table>
<thead>
<tr>
<th>列名</th>
<th>类型</th>
<th>约束</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>int</td>
<td>primary key</td>
<td>书籍编号</td>
</tr>
<tr>
<td>name</td>
<td>varchar</td>
<td>not null</td>
<td>书籍名字</td>
</tr>
<tr>
<td>price</td>
<td>varchar</td>
<td>not null</td>
<td>书籍价格</td>
</tr>
<tr>
<td>author</td>
<td>varchar</td>
<td>-</td>
<td>书籍作者</td>
</tr>
<tr>
<td>publisher</td>
<td>varchar</td>
<td>-</td>
<td>书籍出版社</td>
</tr>
<tr>
<td>pubDate</td>
<td>date</td>
<td>-</td>
<td>发布时间</td>
</tr>
<tr>
<td>description</td>
<td>varchar</td>
<td>-</td>
<td>书籍描述</td>
</tr>
<tr>
<td>image</td>
<td>varchar</td>
<td>-</td>
<td>书籍图片</td>
</tr>
<tr>
<td>category_id</td>
<td>int</td>
<td>foreign key</td>
<td>书籍类别编号</td>
</tr>
</tbody></table>
<p><strong>es_category，书籍分类表</strong></p>
<table>
<thead>
<tr>
<th>列名</th>
<th>类型</th>
<th>约束</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>int</td>
<td>primary key</td>
<td>书籍分类编号</td>
</tr>
<tr>
<td>name</td>
<td>varchar</td>
<td>not null</td>
<td>书籍分类名字</td>
</tr>
<tr>
<td>description</td>
<td>varchar</td>
<td>not null</td>
<td>书籍分类描述</td>
</tr>
<tr>
<td>parent_id</td>
<td>int</td>
<td>foreign key</td>
<td>父类别编号</td>
</tr>
</tbody></table>
<p><strong>es_orderform，订单表</strong></p>
<table>
<thead>
<tr>
<th>列名</th>
<th>类型</th>
<th>约束</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>int</td>
<td>primary key</td>
<td>订单编号</td>
</tr>
<tr>
<td>cost</td>
<td>double</td>
<td>not null</td>
<td>订单金额</td>
</tr>
<tr>
<td>orderDate</td>
<td>date</td>
<td>not null</td>
<td>订单时间</td>
</tr>
<tr>
<td>shopAddress_id</td>
<td>int</td>
<td>foreign key</td>
<td>收货地址编号</td>
</tr>
<tr>
<td>customer_id</td>
<td>int</td>
<td>foreign key</td>
<td>客户编号</td>
</tr>
</tbody></table>
<p><strong>es_orderline，订单项表</strong></p>
<table>
<thead>
<tr>
<th>列名</th>
<th>类型</th>
<th>约束</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>int</td>
<td>primary key</td>
<td>订单项编号</td>
</tr>
<tr>
<td>num</td>
<td>int</td>
<td>not null</td>
<td>商品数量</td>
</tr>
<tr>
<td>cost</td>
<td>date</td>
<td>not null</td>
<td>订单项金额</td>
</tr>
<tr>
<td>book_id</td>
<td>int</td>
<td>foreign key</td>
<td>书籍编号</td>
</tr>
<tr>
<td>orderForm_id</td>
<td>int</td>
<td>foreign key</td>
<td>订单编号</td>
</tr>
</tbody></table>
<p><strong>es_shopaddress，收货地址表</strong></p>
<table>
<thead>
<tr>
<th>列名</th>
<th>类型</th>
<th>约束</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>int</td>
<td>primary key</td>
<td>收货地址编号</td>
</tr>
<tr>
<td>receiveName</td>
<td>varchar</td>
<td>not null</td>
<td>收货人姓名</td>
</tr>
<tr>
<td>address</td>
<td>varchar</td>
<td>not null</td>
<td>收货人地址</td>
</tr>
<tr>
<td>phone</td>
<td>varchar</td>
<td>not null</td>
<td>收货人电话</td>
</tr>
<tr>
<td>customer_id</td>
<td>int</td>
<td>foreign key</td>
<td>客户编号</td>
</tr>
</tbody></table>
<h4 id="表分析"><a href="#表分析" class="headerlink" title="表分析"></a>表分析</h4><blockquote>
<p>所有表都没有物理外键，而是逻辑外键</p>
</blockquote>
<p>es_customer</p>
<ul>
<li>顾客表 一个顾客有一个地址</li>
</ul>
<p>es_shopaddress</p>
<ul>
<li>地址表 顾客外键</li>
</ul>
<p>es_category</p>
<ul>
<li>商品分类表 一个分类有多个商品</li>
<li>一级分类/二级分类(自关联)<ul>
<li>二级分类的parentId是一级分类的id</li>
<li>一级分类: ==select * from category where parent_id = 0==</li>
<li>二级分类: ==select * from category where parent_id = 一级分类id*==</li>
</ul>
</li>
</ul>
<p>es_book</p>
<ul>
<li>商品表  分类外键</li>
</ul>
<p>es_orderline</p>
<ul>
<li>订单项 购买一次就是一个订单项</li>
</ul>
<p>es_order</p>
<ul>
<li>订单 一个订单有多个订单项</li>
</ul>
<h3 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h3><p>1.选择骨架</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221134599.png" alt="image-20210909102255356"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221134811.png" alt="image-20210909102357621"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221134172.png" alt="image-20210909102441644"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221134019.png" alt="image-20210909102503907"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221134615.png" alt="image-20210909102607551"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221134846.png" alt="image-20210909102802026"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221134173.png" alt="image-20210909102933930"></p>
<ul>
<li>java -&gt; Sources Root</li>
<li>resources-&gt; Resources Root</li>
</ul>
<p><code>2.pom.xml</code></p>
<blockquote>
<p>注意: 如果是mysql8 最好使用mysql8的驱动</p>
<p>同时: 驱动为 com.mysql.cj.jdbc.Driver</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 引入servlet3.1的依赖 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 引入jstl的依赖，jsp页面中会使用到 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 引入Mybatis的依赖 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.oracle.ojdbc<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ojdbc8<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>19.3.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        &lt;dependency&gt;</span></span><br><span class="line"><span class="comment">            &lt;groupId&gt;mysql&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">            &lt;version&gt;5.1.38&lt;/version&gt;</span></span><br><span class="line"><span class="comment">        &lt;/dependency&gt;</span></span><br><span class="line"><span class="comment">         --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 日志框架log4j的依赖 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alipay.sdk<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>alipay-sdk-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.8.10.ALL<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--json--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.11.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.8.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi-ooxml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>完善结构</code></p>
<h3 id="配置tomcat"><a href="#配置tomcat" class="headerlink" title="配置tomcat"></a>配置tomcat</h3><p><code>添加tomcat</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221134752.png" alt="image-20210909111027889"></p>
<p><code>部署项目到tomcat</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221134114.png" alt="image-20210909111300375"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221135538.png" alt="image-20210909111319079"></p>
<p><code>配置项目部署路径</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221135501.png" alt="image-20210909111353934"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221135615.png" alt="image-20210909111518671"></p>
<p><code>启动tomcat</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221135005.png" alt="image-20210909111604743"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221135672.png" alt="image-20210909144741405"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221135744.png" alt="编码"></p>
<h3 id="测试连接"><a href="#测试连接" class="headerlink" title="测试连接"></a>测试连接</h3><p><a href="###%E6%A1%88%E4%BE%8B">参考案例</a></p>
<h2 id="顾客模块"><a href="#顾客模块" class="headerlink" title="顾客模块"></a>顾客模块</h2><h3 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h3><h4 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h4><ul>
<li>获取页面参数<ul>
<li>判断name和password是否为空</li>
<li>判断name是否存在</li>
</ul>
</li>
<li>注册用户<ul>
<li>正常: 跳转登录页面</li>
<li>错误: 获取错误信息,重新跳转注册页面</li>
</ul>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221125445.png" alt="image-20210910094134124"></p>
<h4 id="RegisterServlet"><a href="#RegisterServlet" class="headerlink" title="RegisterServlet"></a>RegisterServlet</h4><blockquote>
<p>注意: 不同的请求方式可以访问同一接口有不同功能</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.estore.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.estore.entity.Customer;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.service.IUserService;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.service.impl.UserServiceImpl;</span><br><span class="line"><span class="keyword">import</span> org.apache.taglibs.standard.tag.common.sql.DataSourceUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse(lc))</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022/5/31-05-31-10:33</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>： 用户注册接口 (接收/响应数据)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/userRegister&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserRegisterServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 1.接收参数 并封装Customer对象</span></span><br><span class="line">        String name = req.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        String password = req.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">        String zipCode = req.getParameter(<span class="string">&quot;zipCode&quot;</span>);</span><br><span class="line">        String address = req.getParameter(<span class="string">&quot;address&quot;</span>);</span><br><span class="line">        String telephone = req.getParameter(<span class="string">&quot;telephone&quot;</span>);</span><br><span class="line">        String email = req.getParameter(<span class="string">&quot;email&quot;</span>);</span><br><span class="line">        Customer customer = <span class="keyword">new</span> Customer(name,password,zipCode,address,telephone,email);</span><br><span class="line">        <span class="comment">// 2.交给service判断 用户名不能为空</span></span><br><span class="line">        IUserService userService = <span class="keyword">new</span> UserServiceImpl();</span><br><span class="line">        <span class="comment">// 3.判断是否注册成功</span></span><br><span class="line">        String path=<span class="string">&quot;login.jsp&quot;</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            userService.register(customer);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace(); <span class="comment">// 打印异常信息</span></span><br><span class="line">            <span class="comment">// 失败 重新注册  请求转发</span></span><br><span class="line">            <span class="comment">// 将该错误信息存到request中,将来页面取出</span></span><br><span class="line">            req.getSession().setAttribute(<span class="string">&quot;error&quot;</span>,<span class="string">&quot;注册失败 &quot;</span> +e.getMessage());</span><br><span class="line">            path = <span class="string">&quot;register.jsp&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="CustomerServiceImpl"><a href="#CustomerServiceImpl" class="headerlink" title="CustomerServiceImpl"></a>CustomerServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.estore.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.estore.dao.ICustomerDao;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.entity.Customer;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.service.IUserService;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.utils.MD5Util;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.utils.MyBatisSqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse(lc))</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022/5/31-05-31-11:01</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：顾客业务实现</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">IUserService</span> </span>&#123;</span><br><span class="line">    SqlSession session = MyBatisSqlSessionFactory.openSession();</span><br><span class="line">    ICustomerDao customerDao = session.getMapper(ICustomerDao.class);</span><br><span class="line"></span><br><span class="line">     <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(Customer customer)</span> </span>&#123;</span><br><span class="line">        String name = customer.getName();</span><br><span class="line">        <span class="comment">// 1.校验用户</span></span><br><span class="line">            <span class="comment">// 1.用户名不能为空</span></span><br><span class="line">        <span class="keyword">if</span> (name == <span class="keyword">null</span> || <span class="string">&quot;&quot;</span>.equals(name.trim())) &#123;</span><br><span class="line">            <span class="comment">// 参数是message new RuntimeException(message);</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;用户名不能为空&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">            <span class="comment">// 2.用户名不能已经在数据库存在 (携带用户名去数据库查)</span></span><br><span class="line">        Customer cusomerFromDB = findByName(name);</span><br><span class="line">        <span class="keyword">if</span> (cusomerFromDB != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;用户名已经存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 2.注册用户(调用dao)</span></span><br><span class="line">        customer.setPassword(customer.getPassword());</span><br><span class="line">        customerDao.register(customer);</span><br><span class="line">        <span class="comment">// 注意事务的提交</span></span><br><span class="line">        session.commit();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name 用户名称</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 该用户对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Customer <span class="title">findByName</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">        <span class="comment">// 去数据库查</span></span><br><span class="line">        <span class="keyword">return</span> customerDao.findByName(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>注意: 注册需要提交 commit</code></p>
<h4 id="CustomerMapper-xml"><a href="#CustomerMapper-xml" class="headerlink" title="CustomerMapper.xml"></a>CustomerMapper.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> </span></span><br><span class="line"><span class="meta"><span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.briup.dao.CustomerMapper&quot;</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Customer&quot;</span> <span class="attr">id</span>=<span class="string">&quot;CustomerResult&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;password&quot;</span> <span class="attr">column</span>=<span class="string">&quot;password&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;zipCode&quot;</span> <span class="attr">column</span>=<span class="string">&quot;zipCode&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;address&quot;</span> <span class="attr">column</span>=<span class="string">&quot;address&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;telephone&quot;</span> <span class="attr">column</span>=<span class="string">&quot;telephone&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findCustomerByName&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;string&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;CustomerResult&quot;</span>&gt;</span></span><br><span class="line">		select </span><br><span class="line">			id,name,password,zipCode,address,telephone,email</span><br><span class="line">		from 	</span><br><span class="line">			es_customer</span><br><span class="line">		where </span><br><span class="line">			name = #&#123;name&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;saveCustomer&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Customer&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		insert into es_customer(name,password,zipCode,address,telephone,email)</span><br><span class="line">		values(#&#123;name&#125;,#&#123;password&#125;,#&#123;zipCode&#125;,#&#123;address&#125;,#&#123;telephone&#125;,#&#123;email&#125;)</span><br><span class="line">		</span><br><span class="line">	<span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="register-jsp"><a href="#register-jsp" class="headerlink" title="register.jsp"></a>register.jsp</h4><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;tabs&quot;</span>&gt;</span><br><span class="line">     &lt;c:choose&gt;</span><br><span class="line">         &lt;c:when test=<span class="string">&quot;$&#123;empty error&#125;&quot;</span>&gt;</span><br><span class="line">             &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;phone current&quot;</span>&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;用户注册，请将信息填写完整&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">         &lt;/c:when&gt;</span><br><span class="line">         &lt;c:otherwise&gt;</span><br><span class="line">             &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;phone current&quot;</span>&gt;&lt;span style=<span class="string">&quot;color: red&quot;</span>&gt;$&#123;error&#125;&lt;/span&gt;&lt;/li&gt;</span><br><span class="line">         &lt;/c:otherwise&gt;</span><br><span class="line">     &lt;/c:choose&gt;</span><br><span class="line">     &lt;c:remove <span class="keyword">var</span>=<span class="string">&quot;error&quot;</span> scope=<span class="string">&quot;session&quot;</span>/&gt;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;li&gt;</span><br><span class="line">    &lt;span&gt;&lt;b&gt;*&lt;/b&gt;用户名：&lt;/span&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;name&quot;</span> id=<span class="string">&quot;name&quot;</span>/&gt;</span><br><span class="line">    &lt;span id=<span class="string">&quot;tip&quot;</span> style=<span class="string">&quot;width: 110px;text-align: justify;padding-left: 10px&quot;</span>&gt;&lt;/span&gt;</span><br><span class="line">&lt;/li&gt;</span><br></pre></td></tr></table></figure>

<p><code>注意: 1.idea骨架创建webapp 默认页面忽略了el表达式 2.引入jq必须写双标签</code></p>
<h3 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h3><h4 id="分析-1"><a href="#分析-1" class="headerlink" title="分析"></a>分析</h4><ul>
<li>获取到账户密码</li>
<li>校验是否是账户错误还是密码错误</li>
<li>成功 跳转到商城首页<ul>
<li>失败 回退到登录页面 并提示错误信息</li>
</ul>
</li>
</ul>
<h4 id="LoginServlet"><a href="#LoginServlet" class="headerlink" title="LoginServlet"></a>LoginServlet</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.estore.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.estore.constant.EstoreConstant;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.entity.Customer;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.service.IUserService;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.service.impl.UserServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.*;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse(lc))</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022/5/31-05-31-15:42</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：登录接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/userLogin&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserLoginServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 1.获取用户名和密码</span></span><br><span class="line">        String name = req.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        String password = req.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">        String auto = req.getParameter(<span class="string">&quot;auto&quot;</span>);</span><br><span class="line">        <span class="comment">// 2.调用service校验用户名和密码</span></span><br><span class="line">        IUserService userService = <span class="keyword">new</span> UserServiceImpl();</span><br><span class="line">        <span class="comment">// 3.跳转页面</span></span><br><span class="line">        String path = <span class="string">&quot;index.jsp&quot;</span>;</span><br><span class="line">        HttpSession session = req.getSession();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 登录成功  跳转首页(重定向)</span></span><br><span class="line">            Customer customer = userService.login(name, password);</span><br><span class="line">            session.setAttribute(<span class="string">&quot;customer&quot;</span>, customer);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="comment">// 登录失败  重新登录(请求转发 提示信息)</span></span><br><span class="line">            path = <span class="string">&quot;login.jsp&quot;</span>;</span><br><span class="line">            session.setAttribute(<span class="string">&quot;error&quot;</span>, <span class="string">&quot;登录失败 &quot;</span> +e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        resp.sendRedirect(path);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="CustomerServiceImpl-1"><a href="#CustomerServiceImpl-1" class="headerlink" title="CustomerServiceImpl"></a>CustomerServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Customer <span class="title">login</span><span class="params">(String name, String password)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 校验用户名是否错误 这里没有校验密码</span></span><br><span class="line">    Customer customer = customerMapper.findByName(name);</span><br><span class="line">    <span class="keyword">if</span>(customer == <span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;账户名有误&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 校验错误是否错误</span></span><br><span class="line">    <span class="keyword">if</span>(!password.equals((customer.getPassword())))&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;密码有误&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> customer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="login-jsp"><a href="#login-jsp" class="headerlink" title="login.jsp"></a>login.jsp</h4><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=<span class="string">&quot;/userLogin&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">    &lt;h1&gt;账号登陆&lt;/h1&gt;</span><br><span class="line">    &lt;c:choose&gt;</span><br><span class="line">        &lt;c:when test=<span class="string">&quot;$&#123;empty error&#125;&quot;</span>&gt;</span><br><span class="line">            &lt;h2&gt;公共场所请不要泄露您的密码，以防止账号丢失&lt;/h2&gt;</span><br><span class="line">        &lt;/c:when&gt;</span><br><span class="line">        &lt;c:otherwise&gt;</span><br><span class="line">            &lt;h2&gt;$&#123;error&#125;&lt;/h2&gt;</span><br><span class="line">        &lt;/c:otherwise&gt;</span><br><span class="line">    &lt;/c:choose&gt;</span><br><span class="line">    &lt;c:remove <span class="keyword">var</span>=<span class="string">&quot;error&quot;</span> scope=<span class="string">&quot;session&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>

<p>&lt;c:remove&gt;</p>
<h4 id="index-jsp"><a href="#index-jsp" class="headerlink" title="index.jsp"></a>index.jsp</h4><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;%--登录后才显示退出--%&gt;</span><br><span class="line">&lt;c:choose&gt;</span><br><span class="line">    &lt;c:when test=<span class="string">&quot;$&#123;!empty customer&#125;&quot;</span>&gt;</span><br><span class="line">        &lt;li&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;&lt;span style=<span class="string">&quot;color: green;font-weight: bold&quot;</span>&gt;$&#123;customer.name&#125;&lt;/span&gt;&lt;/a&gt;|&lt;/li&gt;</span><br><span class="line">        &lt;li&gt;&lt;a href=<span class="string">&quot;/userLogout&quot;</span>&gt;退出&lt;/a&gt;|&lt;/li&gt;</span><br><span class="line">    &lt;/c:when&gt;</span><br><span class="line">    &lt;c:otherwise&gt;</span><br><span class="line">        &lt;li&gt;&lt;a href=<span class="string">&quot;login.jsp&quot;</span>&gt;请登录&lt;/a&gt;|&lt;/li&gt;</span><br><span class="line">    &lt;/c:otherwise&gt;</span><br><span class="line">&lt;/c:choose&gt;</span><br><span class="line">&lt;li&gt;&lt;a href=<span class="string">&quot;orderList&quot;</span>&gt;我的订单&lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;jt_down&quot;</span>&gt;&lt;/span&gt;&lt;/a&gt;|&lt;/li&gt;</span><br><span class="line">&lt;li&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;关注杰普&lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;jt_down&quot;</span>&gt;&lt;/span&gt;&lt;/a&gt;|&lt;/li&gt;</span><br><span class="line">&lt;li&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;网站导航&lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;jt_down&quot;</span>&gt;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span><br></pre></td></tr></table></figure>



<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221126245.png" alt="image-20210909163711524"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221128737.png" alt="image-20210909163739415"></p>
<h3 id="注销"><a href="#注销" class="headerlink" title="注销"></a>注销</h3><h4 id="分析-2"><a href="#分析-2" class="headerlink" title="==分析=="></a>==分析==</h4><ul>
<li>如果注销用户,所有存在session的数据例如购物车都应该清除</li>
<li>销毁session即可</li>
</ul>
<h4 id="LogoutServlet"><a href="#LogoutServlet" class="headerlink" title="LogoutServlet"></a>LogoutServlet</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/logoutServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogoutServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		</span><br><span class="line">		req.getSession().invalidate();</span><br><span class="line">		</span><br><span class="line">		String path = <span class="string">&quot;/login.jsp&quot;</span>;</span><br><span class="line">		</span><br><span class="line">		resp.sendRedirect(req.getContextPath()+path);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="ajax校验"><a href="#ajax校验" class="headerlink" title="ajax校验"></a>ajax校验</h3><p>==为什么需要前后端都校验==</p>
<ul>
<li>前端显示友好</li>
<li>后端控制业务，防止页面操作问题</li>
</ul>
<h4 id="分析-3"><a href="#分析-3" class="headerlink" title="分析"></a>分析</h4><ul>
<li>输入框绑定离焦事件 发送ajax请求</li>
<li>后台根据用户名查找用户是否存在</li>
<li>响应提示信息</li>
</ul>
<h4 id="CheckServlet"><a href="#CheckServlet" class="headerlink" title="CheckServlet"></a>CheckServlet</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.estore.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.estore.dto.Result;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.entity.Customer;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.service.IUserService;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.service.impl.UserServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse(lc))</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022/6/1-06-01-9:42</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：ajax校验用户名是否存在</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/userCheck&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserCheckServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        String name = req.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        resp.setContentType(<span class="string">&quot;text/json;charset=utf-8&quot;</span>);</span><br><span class="line">        PrintWriter writer = resp.getWriter();</span><br><span class="line"></span><br><span class="line">        IUserService userService = <span class="keyword">new</span> UserServiceImpl();</span><br><span class="line">        ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Customer customer = userService.findByName(name);</span><br><span class="line">            Result result = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">if</span> (customer != <span class="keyword">null</span>) &#123;</span><br><span class="line">                result = <span class="keyword">new</span> Result(<span class="string">&quot;用户名已经存在&quot;</span>,<span class="string">&quot;red&quot;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                result = <span class="keyword">new</span> Result(<span class="string">&quot;用户名可用&quot;</span>,<span class="string">&quot;green&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            writer.write(objectMapper.writeValueAsString(result));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="register-jsp-1"><a href="#register-jsp-1" class="headerlink" title="register.jsp"></a>register.jsp</h4><blockquote>
<p>注意:　改造之前的service findByName方法</p>
</blockquote>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span> src=<span class="string">&quot;js/jquery-1.12.3.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    <span class="comment">// ajax校验</span></span><br><span class="line">    $(function()&#123;</span><br><span class="line">        $(<span class="string">&quot;#name&quot;</span>).on(<span class="string">&quot;blur&quot;</span>,function () &#123;</span><br><span class="line">            <span class="keyword">var</span> name = $(<span class="keyword">this</span>).val();</span><br><span class="line">            $.ajax(&#123;</span><br><span class="line">                type: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">                url: <span class="string">&quot;/userCheck&quot;</span>,</span><br><span class="line">                data: <span class="string">&quot;name=&quot;</span>+name,</span><br><span class="line">                dataType: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">                success: function (result) &#123;</span><br><span class="line">                    $(<span class="string">&quot;#tip&quot;</span>).text(result.msg).css(&#123;<span class="string">&quot;color&quot;</span>:result.color&#125;).hide().slideDown(<span class="number">2000</span>).slideUp(<span class="number">2000</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"> &lt;li&gt;</span><br><span class="line">     &lt;span&gt;&lt;b&gt;*&lt;/b&gt;用户名：&lt;/span&gt;</span><br><span class="line">     &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;name&quot;</span> id=<span class="string">&quot;name&quot;</span>/&gt;</span><br><span class="line">     &lt;span id=<span class="string">&quot;tip&quot;</span> style=<span class="string">&quot;width: 110px;text-align: justify;padding-left: 10px&quot;</span>&gt;$&#123;msg&#125;&lt;/span&gt;</span><br><span class="line">&lt;/li&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>用户名或者密码为空不能注册</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;form&quot;</span>).on(<span class="string">&quot;submit&quot;</span>,function()&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>($(<span class="string">&quot;#name&quot;</span>).val() &amp;&amp; $(<span class="string">&quot;#password&quot;</span>).val())&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            alert(<span class="string">&quot;用户名或密码不能为空&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>



<blockquote>
<p>用户名已经存在也不能注册</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">$(function()&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// true-用户名可用</span></span><br><span class="line">		<span class="comment">// false-用户名被占用</span></span><br><span class="line">		<span class="keyword">var</span> flag = <span class="keyword">false</span>;</span><br><span class="line">		<span class="comment">//console.log($(&quot;#name&quot;));</span></span><br><span class="line">		$(<span class="string">&quot;#name&quot;</span>).on(<span class="string">&quot;blur&quot;</span>,function()&#123;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">var</span> name = $(<span class="string">&quot;#name&quot;</span>).val();</span><br><span class="line">			<span class="keyword">if</span>(name &amp;&amp; name.trim())&#123;</span><br><span class="line">				$.ajax(&#123;</span><br><span class="line">					type: <span class="string">&quot;get&quot;</span>,</span><br><span class="line">					url: <span class="string">&quot;checkNameServlet&quot;</span>,</span><br><span class="line">					data: <span class="string">&quot;name=&quot;</span>+$(<span class="string">&quot;#name&quot;</span>).val(),</span><br><span class="line">					dataType: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">					success: function(result)&#123;</span><br><span class="line">						</span><br><span class="line">						<span class="keyword">if</span>(<span class="string">&quot;用户名可用&quot;</span> == result.trim())&#123;</span><br><span class="line">							flag = <span class="keyword">true</span>;</span><br><span class="line">						&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">							flag = <span class="keyword">false</span>;</span><br><span class="line">						&#125;</span><br><span class="line">						$(<span class="string">&quot;#show-result&quot;</span>).html(result);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;);</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//console.log($(&quot;form&quot;));</span></span><br><span class="line">		$(<span class="string">&quot;form&quot;</span>).on(<span class="string">&quot;submit&quot;</span>,function()&#123;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">if</span>($(<span class="string">&quot;#name&quot;</span>).val() &amp;&amp; $(<span class="string">&quot;#password&quot;</span>).val())&#123;</span><br><span class="line">				<span class="keyword">if</span>(flag)&#123;</span><br><span class="line">					<span class="keyword">return</span> <span class="keyword">true</span></span><br><span class="line">				&#125;</span><br><span class="line">				alert(<span class="string">&quot;用户名不可用，就先不提交了&quot;</span>);</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			alert(<span class="string">&quot;用户名或密码不能为空&quot;</span>);</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125;);</span><br><span class="line">		</span><br><span class="line">	&#125;);</span><br></pre></td></tr></table></figure>





<h4 id="CustomerService"><a href="#CustomerService" class="headerlink" title="CustomerService"></a>CustomerService</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Customer <span class="title">findCustomerByName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        SqlSession sqlSession = MyBatisSqlSessionFactory.openSession();</span><br><span class="line">        customerMapper = sqlSession.getMapper(CustomerMapper.class);</span><br><span class="line">        <span class="keyword">return</span> customerMapper.findCustomerByName(name);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>





<h2 id="书籍模块"><a href="#书籍模块" class="headerlink" title="书籍模块"></a>书籍模块</h2><h3 id="查看所有目录"><a href="#查看所有目录" class="headerlink" title="查看所有目录"></a>查看所有目录</h3><h4 id="分析-4"><a href="#分析-4" class="headerlink" title="==分析=="></a>==分析==</h4><ul>
<li>访问首页 即可查看所有数据</li>
<li>此时数据应该随应用启动便查找(监听器)</li>
<li>一级目录<ul>
<li><code>select * from es_category where parent_id = 0</code></li>
</ul>
</li>
<li>二级目录<ul>
<li><code>select * from es_category where parent_id =(select id from es_category where parent_id = 0) </code></li>
</ul>
</li>
</ul>
<h4 id="ApplicationListener"><a href="#ApplicationListener" class="headerlink" title="ApplicationListener"></a>ApplicationListener</h4><blockquote>
<p>注意: @WebListener</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.listener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Category;</span><br><span class="line"><span class="keyword">import</span> com.briup.mapper.CategoryMapper;</span><br><span class="line"><span class="keyword">import</span> com.briup.util.MyBatisSqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContextEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContextListener;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebListener;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/10-09-10-9:50</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：项目启动 准备目录和书籍数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebListener</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplicationListener</span> <span class="keyword">implements</span> <span class="title">ServletContextListener</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextInitialized</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 项目启动初始化操作</span></span><br><span class="line">        <span class="comment">// 查询所有目录</span></span><br><span class="line">        SqlSession session = MyBatisSqlSessionFactory.openSession();</span><br><span class="line">        CategoryMapper categoryMapper = session.getMapper(CategoryMapper.class);</span><br><span class="line">        List&lt;Category&gt; categoryList = categoryMapper.findAllCategory();</span><br><span class="line">        ServletContext servletContext = sce.getServletContext();</span><br><span class="line">        servletContext.setAttribute(<span class="string">&quot;categoryList&quot;</span>,categoryList);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextDestroyed</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>此时使用监听器有缺陷 因为服务器只会加载一次</p>
</blockquote>
<h4 id="CategoryMapper-xml"><a href="#CategoryMapper-xml" class="headerlink" title="CategoryMapper.xml"></a>CategoryMapper.xml</h4><blockquote>
<p>注意: 二级目录的parent_id为一级目录的id</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.briup.mapper.CategoryMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;firstMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;category&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;description&quot;</span> <span class="attr">property</span>=<span class="string">&quot;description&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;categories&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">select</span>=<span class="string">&quot;selectSecond&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--嵌套结果 自关联 第一张的结果和第二张一模一样--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--嵌套查询--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAllCategory&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;firstMap&quot;</span>&gt;</span></span><br><span class="line">        select id,name,description</span><br><span class="line">        from es_category</span><br><span class="line">        where parent_id = 0</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--接收一级目录的id--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectSecond&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;firstMap&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">         select id,name,description</span><br><span class="line">        from es_category</span><br><span class="line">        where parent_id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="mybatis-config-xml"><a href="#mybatis-config-xml" class="headerlink" title="mybatis-config.xml"></a>mybatis-config.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置映射文件的位置 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;mappers/CustomerMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;mappers/CategoryMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="index-jsp-1"><a href="#index-jsp-1" class="headerlink" title="index.jsp"></a>index.jsp</h4><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;dl&gt;</span><br><span class="line">               &lt;%--</span><br><span class="line">                   items 获取范围对象中的数据</span><br><span class="line">                   <span class="keyword">var</span>   数据集合的某一项   foeach(Category category : List&lt;Category&gt;)&#123;&#125;</span><br><span class="line">               --%&gt;</span><br><span class="line">               &lt;c:forEach items=<span class="string">&quot;$&#123;categoryList&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;firstCa&quot;</span>&gt;</span><br><span class="line">                   &lt;dd&gt;</span><br><span class="line">                       &lt;h1&gt;$&#123;firstCa.name&#125;&lt;/h1&gt;</span><br><span class="line">                       &lt;p&gt;</span><br><span class="line">                           &lt;c:forEach items=<span class="string">&quot;$&#123;firstCa.categories&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;secondCa&quot;</span>&gt;</span><br><span class="line">                               &lt;a href=<span class="string">&quot;list.html&quot;</span>&gt;$&#123;secondCa.name&#125;&lt;/a&gt;</span><br><span class="line">                           &lt;/c:forEach&gt;</span><br><span class="line">                       &lt;/p&gt;</span><br><span class="line">                   &lt;/dd&gt;</span><br><span class="line">               &lt;/c:forEach&gt;</span><br><span class="line"></span><br><span class="line">           &lt;/dl&gt;</span><br></pre></td></tr></table></figure>







<h3 id="查看所有书"><a href="#查看所有书" class="headerlink" title="查看所有书"></a>查看所有书</h3><h4 id="分析-5"><a href="#分析-5" class="headerlink" title="==分析=="></a>==分析==</h4><ul>
<li>访问首页 即可查看所有数据</li>
<li>需要查询目录信息</li>
<li>此时数据应该随应用启动便查找(监听器)</li>
</ul>
<h4 id="ApplicationListener-1"><a href="#ApplicationListener-1" class="headerlink" title="ApplicationListener"></a>ApplicationListener</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/10-09-10-9:50</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：项目启动 准备目录和书籍数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebListener</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplicationListener</span> <span class="keyword">implements</span> <span class="title">ServletContextListener</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextInitialized</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 项目启动初始化操作</span></span><br><span class="line">        <span class="comment">// 查询所有目录</span></span><br><span class="line">        SqlSession session = MyBatisSqlSessionFactory.openSession();</span><br><span class="line">        CategoryMapper categoryMapper = session.getMapper(CategoryMapper.class);</span><br><span class="line">        List&lt;Category&gt; categoryList = categoryMapper.findAllCategory();</span><br><span class="line">        ServletContext servletContext = sce.getServletContext();</span><br><span class="line">        servletContext.setAttribute(<span class="string">&quot;categoryList&quot;</span>,categoryList);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 查询所有书籍</span></span><br><span class="line">        BookMapper bookMapper = session.getMapper(BookMapper.class);</span><br><span class="line">        List&lt;Book&gt; bookList = bookMapper.findAllBook();</span><br><span class="line">        servletContext.setAttribute(<span class="string">&quot;bookList&quot;</span>,bookList);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextDestroyed</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="BookMapper-xml"><a href="#BookMapper-xml" class="headerlink" title="BookMapper.xml"></a>BookMapper.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.briup.mapper.BookMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;bMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;book&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;bid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;bname&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;price&quot;</span> <span class="attr">property</span>=<span class="string">&quot;price&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;author&quot;</span> <span class="attr">property</span>=<span class="string">&quot;author&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;publisher&quot;</span> <span class="attr">property</span>=<span class="string">&quot;publisher&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;pubDate&quot;</span> <span class="attr">property</span>=<span class="string">&quot;pubDate&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;bdescription&quot;</span> <span class="attr">property</span>=<span class="string">&quot;description&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;image&quot;</span> <span class="attr">property</span>=<span class="string">&quot;image&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;category&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;secondMap&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;secondMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;category&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;cid&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;cname&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;description&quot;</span> <span class="attr">column</span>=<span class="string">&quot;cdescription&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAllBook&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;bMap&quot;</span>&gt;</span></span><br><span class="line">        SELECT</span><br><span class="line">            b.id AS bid,</span><br><span class="line">            b.NAME AS bname,</span><br><span class="line">            b.price,</span><br><span class="line">            b.author,</span><br><span class="line">            b.publisher,</span><br><span class="line">            b.pubDate,</span><br><span class="line">            b.description AS bdescription,</span><br><span class="line">            b.image,</span><br><span class="line">            c.id AS cid,</span><br><span class="line">            c.NAME AS cname,</span><br><span class="line">            c.description AS cdescription</span><br><span class="line">        FROM</span><br><span class="line">            es_book b,</span><br><span class="line">            es_category c</span><br><span class="line">        WHERE</span><br><span class="line">            b.category_id = c.id</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="mybatis-config-xml-1"><a href="#mybatis-config-xml-1" class="headerlink" title="mybatis-config.xml"></a>mybatis-config.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;mappers/BookMapper.xml&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="index-jsp-2"><a href="#index-jsp-2" class="headerlink" title="index.jsp"></a>index.jsp</h4><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:forEach items=<span class="string">&quot;$&#123;bookList &#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;book&quot;</span>&gt;</span><br><span class="line">                    &lt;li&gt;</span><br><span class="line">                        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;c3_b2_txt&quot;</span>&gt;</span><br><span class="line">                            &lt;h1&gt;$&#123;book.name &#125;&lt;/h1&gt;</span><br><span class="line">                            &lt;p&gt;$&#123;book.price &#125;&lt;/p&gt;</span><br><span class="line">                            &lt;h2&gt;$&#123;book.author &#125;&lt;/h2&gt;</span><br><span class="line">                            &lt;h2&gt;$&#123;book.description &#125;&lt;/h2&gt;</span><br><span class="line">                            &lt;p&gt;&lt;a href=<span class="string">&quot;user/viewBookServlet?id=$&#123;book.id &#125;&quot;</span>&gt;更多精彩，点击进入&lt;/a&gt;&lt;/p&gt;</span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                        &lt;div id=<span class="string">&quot;show-image&quot;</span> style=<span class="string">&quot;width: 100px;height: 100px;float: right; position: relative; top: -160px;left: -40px;&quot;</span>&gt;</span><br><span class="line">                            &lt;img src=<span class="string">&quot;$&#123;book.image &#125;&quot;</span> style=<span class="string">&quot;width: 100px;height: 100px&quot;</span>&gt;</span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                    &lt;/li&gt;</span><br><span class="line">                &lt;/c:forEach&gt;</span><br></pre></td></tr></table></figure>



<h3 id="热门书籍"><a href="#热门书籍" class="headerlink" title="热门书籍"></a>热门书籍</h3><h4 id="IndexServlet"><a href="#IndexServlet" class="headerlink" title="IndexServlet"></a><strong>IndexServlet</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.estore.web.listener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.estore.entity.Book;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.entity.Category;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.service.IBookService;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.service.ICategoryService;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.service.impl.BookServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.service.impl.CategoryServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContextEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContextListener;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebListener;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse(lc))</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022/6/1-06-01-10:36</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：首页监听器: 准备目录和书籍数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebListener</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IndexListener</span> <span class="keyword">implements</span> <span class="title">ServletContextListener</span> </span>&#123;</span><br><span class="line">    ICategoryService categoryService = <span class="keyword">new</span> CategoryServiceImpl();</span><br><span class="line">    IBookService bookService = <span class="keyword">new</span> BookServiceImpl();</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextInitialized</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</span><br><span class="line">        ServletContext servletContext = sce.getServletContext();</span><br><span class="line">        List&lt;Category&gt; allCategory = categoryService.findAllCategory();</span><br><span class="line">        System.out.println(allCategory);</span><br><span class="line">        List&lt;Book&gt; allBook = bookService.findAllBook();</span><br><span class="line">        <span class="comment">// 存目录</span></span><br><span class="line">        servletContext.setAttribute(<span class="string">&quot;categoryList&quot;</span>,allCategory);</span><br><span class="line">        <span class="comment">// 存书籍</span></span><br><span class="line">        servletContext.setAttribute(<span class="string">&quot;bookList&quot;</span>,allBook);</span><br><span class="line">        <span class="comment">// 存热门书籍 (随机三本书)</span></span><br><span class="line">        Set&lt;Book&gt; hostBook = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">        Random random = <span class="keyword">new</span> Random();</span><br><span class="line">        <span class="keyword">while</span> (hostBook.size() &lt; <span class="number">3</span>)&#123;</span><br><span class="line">            <span class="comment">// 随机生成索引</span></span><br><span class="line">            <span class="keyword">int</span> index = random.nextInt(allBook.size());</span><br><span class="line">            hostBook.add(allBook.get(index));</span><br><span class="line">        &#125;</span><br><span class="line">        servletContext.setAttribute(<span class="string">&quot;hostBookList&quot;</span>,hostBook);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextDestroyed</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="index-jsp-3"><a href="#index-jsp-3" class="headerlink" title="index.jsp"></a><strong>index.jsp</strong></h4><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul&gt;</span><br><span class="line">    &lt;c:forEach items=<span class="string">&quot;$&#123;hostBookList&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;host&quot;</span>&gt;</span><br><span class="line">        &lt;li&gt;</span><br><span class="line">            &lt;a href=<span class="string">&quot;viewBook.html&quot;</span>&gt;&lt;img src=<span class="string">&quot;$&#123;host.image&#125;&quot;</span> width=<span class="string">&quot;100px&quot;</span> height=<span class="string">&quot;123px&quot;</span>/&gt;&lt;/a&gt;</span><br><span class="line">            &lt;a href=<span class="string">&quot;viewBook.html&quot;</span>&gt;$&#123;host.name&#125;&lt;/a&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">    &lt;/c:forEach&gt;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure>





<h3 id="查看书详情"><a href="#查看书详情" class="headerlink" title="查看书详情"></a>查看书详情</h3><h4 id="分析-6"><a href="#分析-6" class="headerlink" title="==分析=="></a>==分析==</h4><ul>
<li>页面传递书籍id</li>
<li>将id和application范围对象的数据比对即可</li>
</ul>
<hr>
<h4 id="ApplicationInit"><a href="#ApplicationInit" class="headerlink" title="ApplicationInit"></a><strong>ApplicationInit</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextInitialized</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</span><br><span class="line">		ServletContext application = sce.getServletContext();</span><br><span class="line"></span><br><span class="line">		List&lt;Category&gt; categorys = categoryService.findAllCategorys();</span><br><span class="line">		application.setAttribute(<span class="string">&quot;categoryList&quot;</span>, categorys);</span><br><span class="line"></span><br><span class="line">		List&lt;Book&gt; books = bookService.findAllBooks();</span><br><span class="line"></span><br><span class="line">		application.setAttribute(<span class="string">&quot;bookList&quot;</span>, books);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 封装 书籍键值对 ，将来通过id可找到该书籍</span></span><br><span class="line">		<span class="keyword">final</span> Map&lt;Integer,Book&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">		books.forEach(book-&gt;map.put(book.getId(), book));</span><br><span class="line">		application.setAttribute(<span class="string">&quot;bookMap&quot;</span>, map);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="index-jsp-4"><a href="#index-jsp-4" class="headerlink" title="index.jsp"></a>index.jsp</h4><p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221126761.png" alt="image-20210910121451748"></p>
<h4 id="ViewBookServlet"><a href="#ViewBookServlet" class="headerlink" title="ViewBookServlet"></a>ViewBookServlet</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/user/viewBookServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewBookServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		</span><br><span class="line">		String str = req.getParameter(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">		<span class="keyword">int</span> id = -<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">if</span>(str!=<span class="keyword">null</span>) &#123;</span><br><span class="line">			id = Integer.valueOf(str);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">		Map&lt;Integer,Book&gt; map = (Map&lt;Integer, Book&gt;) req.getServletContext().getAttribute(<span class="string">&quot;bookMap&quot;</span>);</span><br><span class="line">		Book book = map.get(id);</span><br><span class="line">		</span><br><span class="line">		req.setAttribute(<span class="string">&quot;book&quot;</span>, book);</span><br><span class="line">		</span><br><span class="line">		String path = <span class="string">&quot;/WEB-INF/viewBook.jsp&quot;</span>;</span><br><span class="line">		req.getRequestDispatcher(path).forward(req, resp);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="viewBook-jsp"><a href="#viewBook-jsp" class="headerlink" title="viewBook.jsp"></a>viewBook.jsp</h4><blockquote>
<p>fmt 解决时间格式</p>
</blockquote>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;cn5_top_y center01&quot;</span>&gt;</span><br><span class="line">      &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;cn5topy_1&quot;</span>&gt;</span><br><span class="line">          &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;cn5topy_imgview&quot;</span>&gt;</span><br><span class="line">              &lt;img src=<span class="string">&quot;$&#123;book.image &#125;&quot;</span>/&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;cn5topy_2&quot;</span>&gt;</span><br><span class="line">          &lt;h1 <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_title font15&quot;</span>&gt;$&#123;book.name &#125;&lt;/h1&gt;</span><br><span class="line">          &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_price&quot;</span>&gt;</span><br><span class="line">              &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_price_x&quot;</span>&gt;</span><br><span class="line">                  &lt;p&gt; briup价：&lt;b&gt;￥$&#123;book.price &#125;&lt;/b&gt; &lt;a href=<span class="string">&quot;#&quot;</span>&gt;(降价通知)&lt;/a&gt;&lt;/p&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_selects&quot;</span>&gt;</span><br><span class="line">              &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_select&quot;</span>&gt;</span><br><span class="line">                  &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_key pro_key_vertical fl&quot;</span>&gt;作者：&lt;/div&gt;</span><br><span class="line">                  &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_select_vals&quot;</span>&gt;</span><br><span class="line">                      &lt;li&gt;$&#123;book.author &#125;&lt;/li&gt;</span><br><span class="line">                  &lt;/ul&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">              &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_select&quot;</span>&gt;</span><br><span class="line">                  &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_key pro_key_vertical fl&quot;</span>&gt;出版社：&lt;/div&gt;</span><br><span class="line">                  &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_select_vals&quot;</span>&gt;</span><br><span class="line">                      &lt;li&gt;$&#123;book.publisher &#125;&lt;/li&gt;</span><br><span class="line"></span><br><span class="line">                  &lt;/ul&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">              &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_select&quot;</span>&gt;</span><br><span class="line">                  &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_key pro_key_vertical fl&quot;</span>&gt;书籍介绍：&lt;/div&gt;</span><br><span class="line">                  &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_select_vals&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">                      &lt;li&gt;出版时间：&lt;f:formatDate value=<span class="string">&quot;$&#123;book.pubDate &#125;&quot;</span> pattern=<span class="string">&quot;yyyy-MM-dd&quot;</span>/&gt; &lt;/li&gt;</span><br><span class="line">                      &lt;li&gt;描述：$&#123;book.description &#125;&lt;/li&gt;</span><br><span class="line">                  &lt;/ul&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;form action=<span class="string">&quot;user/addShopCarServlet&quot;</span> id=<span class="string">&quot;addCar&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">              &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_buy&quot;</span>&gt;</span><br><span class="line">                  &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_buy_nums&quot;</span>&gt;</span><br><span class="line">                      &lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;bookId&quot;</span> value=<span class="string">&quot;$&#123;book.id &#125;&quot;</span> &gt;</span><br><span class="line">                      &lt;input type=<span class="string">&quot;text&quot;</span> value=<span class="string">&quot;1&quot;</span> name=<span class="string">&quot;num&quot;</span>/&gt;</span><br><span class="line">                      &lt;dl&gt;</span><br><span class="line">                          &lt;dd onclick=<span class="string">&quot;addCount()&quot;</span>&gt;+&lt;/dd&gt;</span><br><span class="line">                          &lt;dd onclick=<span class="string">&quot;reduceCount()&quot;</span>&gt;-&lt;/dd&gt;</span><br><span class="line">                      &lt;/dl&gt;</span><br><span class="line">                  &lt;/div&gt;</span><br><span class="line">                  &lt;!--  &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_addshop&quot;</span> onclick=<span class="string">&quot;submitForm()&quot;</span>&gt;加入购物车&lt;/div&gt; --&gt;</span><br><span class="line">                  &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_addshop&quot;</span>&gt;&lt;a href=<span class="string">&quot;javascript:submitForm()&quot;</span>&gt;加入购物车&lt;/a&gt;&lt;/div&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">          &lt;/form&gt;</span><br><span class="line">          &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_ship&quot;</span>&gt;</span><br><span class="line">              &lt;div&gt;</span><br><span class="line">                  &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_key fl&quot;</span>&gt;服&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;务：&lt;/div&gt;</span><br><span class="line">                  &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_service f1&quot;</span>&gt;</span><br><span class="line">                      &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;service_fq&quot;</span>&gt;分期付款&lt;/li&gt;</span><br><span class="line">                      &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;service_myf&quot;</span>&gt;免运费&lt;/li&gt;</span><br><span class="line">                      &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;service_zt&quot;</span>&gt;自提&lt;/li&gt;</span><br><span class="line">                      &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;service_th&quot;</span>&gt;<span class="number">7</span>天无理由退换货&lt;/li&gt;</span><br><span class="line">                  &lt;/ul&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br></pre></td></tr></table></figure>



<h2 id="购物车模块"><a href="#购物车模块" class="headerlink" title="购物车模块"></a>购物车模块</h2><p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221126680.png" alt="image-20210910144249683"></p>
<h3 id="ShopCart"><a href="#ShopCart" class="headerlink" title="ShopCart"></a>ShopCart</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `es_shopcar`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `es_shopcar`  (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `num` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `book_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `customer_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB AUTO_INCREMENT <span class="operator">=</span> <span class="number">8</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8mb4 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8mb4_general_ci ROW_FORMAT <span class="operator">=</span> Compact;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.estore.entity;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse(lc))</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022/6/26-06-26-23:25</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：购物车对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShopCart</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> num;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> bookId;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> customerId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Customer customer;</span><br><span class="line">    <span class="keyword">private</span> Book book;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ShopCart</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ShopCart</span><span class="params">(<span class="keyword">int</span> num, <span class="keyword">int</span> bookId, <span class="keyword">int</span> customerId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.num = num;</span><br><span class="line">        <span class="keyword">this</span>.bookId = bookId;</span><br><span class="line">        <span class="keyword">this</span>.customerId = customerId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getBookId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> bookId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBookId</span><span class="params">(<span class="keyword">int</span> bookId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.bookId = bookId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCustomerId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> customerId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCustomerId</span><span class="params">(<span class="keyword">int</span> customerId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.customerId = customerId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getNum</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> num;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNum</span><span class="params">(<span class="keyword">int</span> num)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.num = num;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Book <span class="title">getBook</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> book;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBook</span><span class="params">(Book book)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.book = book;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Customer <span class="title">getCustomer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> customer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCustomer</span><span class="params">(Customer customer)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.customer = customer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ShopCart&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, num=&quot;</span> + num +</span><br><span class="line">                <span class="string">&quot;, bookId=&quot;</span> + bookId +</span><br><span class="line">                <span class="string">&quot;, customerId=&quot;</span> + customerId +</span><br><span class="line">                <span class="string">&quot;, customer=&quot;</span> + customer +</span><br><span class="line">                <span class="string">&quot;, book=&quot;</span> + book +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="加入购物车"><a href="#加入购物车" class="headerlink" title="加入购物车"></a>加入购物车</h3><p>==分析==</p>
<ul>
<li>判断该商品是否购物车存在<ul>
<li>如果存在: 原订单项数量+1</li>
<li>如果不存在: 新添一个订单项</li>
</ul>
</li>
</ul>
<h4 id="ShopCarAddServlet"><a href="#ShopCarAddServlet" class="headerlink" title="ShopCarAddServlet"></a>ShopCarAddServlet</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.estore.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.estore.entity.Book;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.entity.Customer;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.entity.ShopCar;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.entity.ShopCart;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.service.IShopCarService;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.service.impl.ShopCarServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.utils.BookUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse(lc))</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022/6/1-06-01-16:48</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：添加购物车api</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/shopCarAdd&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShopCarAddServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 1.获取入库信息</span></span><br><span class="line">        <span class="keyword">int</span> bookId = Integer.parseInt(req.getParameter(<span class="string">&quot;bookId&quot;</span>));</span><br><span class="line">        <span class="keyword">int</span> num = Integer.parseInt(req.getParameter(<span class="string">&quot;num&quot;</span>));</span><br><span class="line">        HttpSession session = req.getSession();</span><br><span class="line">        Customer customer = (Customer) session.getAttribute(<span class="string">&quot;customer&quot;</span>);</span><br><span class="line">        <span class="comment">// 2.入库</span></span><br><span class="line">        IShopCarService shopCarService = <span class="keyword">new</span> ShopCarServiceImpl();</span><br><span class="line">        ShopCart shopCart = <span class="keyword">new</span> ShopCart(num,bookId,customer.getId());</span><br><span class="line">        shopCarService.add(shopCart);</span><br><span class="line">        <span class="comment">// 4.跳转购物车页面</span></span><br><span class="line">        resp.sendRedirect(<span class="string">&quot;shopCartQuery&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ShopCarService"><a href="#ShopCarService" class="headerlink" title="ShopCarService"></a>ShopCarService</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IShopCarService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(ShopCart shopCart)</span></span>;</span><br><span class="line">    <span class="function">List&lt;ShopCart&gt; <span class="title">getCarBookByCid</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.estore.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.estore.dao.IShopCarDao;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.entity.Book;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.entity.ShopCar;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.entity.ShopCart;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.service.IShopCarService;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.utils.MyBatisSqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse(lc))</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022/6/26-06-26-23:24</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：添加购物车逻辑</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShopCarServiceImpl</span> <span class="keyword">implements</span> <span class="title">IShopCarService</span> </span>&#123;</span><br><span class="line">    SqlSession session = MyBatisSqlSessionFactory.openSession();</span><br><span class="line">    IShopCarDao shopCarDao =  session.getMapper(IShopCarDao.class);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(ShopCart shopCart)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 是否为同一本书</span></span><br><span class="line">            <span class="comment">// 是: 数量+1</span></span><br><span class="line">            <span class="comment">// 否: 添加新行</span></span><br><span class="line">        ShopCart cartFromDB = shopCarDao.queryByBId(shopCart.getBookId());</span><br><span class="line">        <span class="keyword">if</span> (cartFromDB != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 同一本书</span></span><br><span class="line">            cartFromDB.setNum(cartFromDB.getNum()+shopCart.getNum());</span><br><span class="line">            shopCarDao.update(cartFromDB);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">// 新书</span></span><br><span class="line">            shopCarDao.add(shopCart);</span><br><span class="line">        &#125;</span><br><span class="line">        session.commit();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;ShopCart&gt; <span class="title">getCarBookByCid</span><span class="params">(Integer customerId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> shopCarDao.queryByCid(customerId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="ShopCarDao"><a href="#ShopCarDao" class="headerlink" title="ShopCarDao"></a>ShopCarDao</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IShopCarDao</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(ShopCart shopCart)</span></span>;</span><br><span class="line">    <span class="function">ShopCart <span class="title">queryByBId</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(ShopCart cartFromDB)</span></span>;</span><br><span class="line">    <span class="function">List&lt;ShopCart&gt; <span class="title">queryByCid</span><span class="params">(Integer customerId)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.briup.estore.dao.IShopCarDao&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;add&quot;</span>&gt;</span></span><br><span class="line">        insert into es_shopcar(num,book_id,customer_id)</span><br><span class="line">        values (#&#123;num&#125;,#&#123;bookId&#125;,#&#123;customerId&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span>&gt;</span></span><br><span class="line">        update es_shopcar set num = #&#123;num&#125; where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;queryByBId&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.briup.estore.entity.ShopCart&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">        select id,num,book_id,customer_id from es_shopcar</span><br><span class="line">        where book_id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;carMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;shopCart&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;num&quot;</span> <span class="attr">column</span>=<span class="string">&quot;num&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;bookId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;book_id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;book&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;com.briup.estore.dao.IBookDao.bookMap&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;queryByCid&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;carMap&quot;</span>&gt;</span></span><br><span class="line">         select</span><br><span class="line">            car.id,car.num,car.book_id,</span><br><span class="line">            b.price,b.name,b.image</span><br><span class="line">        from es_book b,es_shopcar car</span><br><span class="line">        where b.id = car.book_id and customer_id = #&#123;customerId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="shopCart-jsp"><a href="#shopCart-jsp" class="headerlink" title="shopCart.jsp"></a>shopCart.jsp</h4><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;c&quot;</span> uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> isELIgnored=<span class="string">&quot;false&quot;</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html;charset=UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;购物车页面&lt;/title&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;css/fullCar.css&quot;</span>/&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;css/common.css&quot;</span>/&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;css/style.css&quot;</span>/&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;css/icons.css&quot;</span>/&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;css/table.css&quot;</span>/&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> type=<span class="string">&quot;text/css&quot;</span> href=<span class="string">&quot;css/shopCar.css&quot;</span>&gt;</span><br><span class="line">    &lt;script type=<span class="string">&quot;text/javascript&quot;</span> src=<span class="string">&quot;js/jquery-1.12.3.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">        <span class="function">function <span class="title">reduceCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> numObj = document.getElementsByName(<span class="string">&quot;num&quot;</span>)[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">if</span> (parseInt(numObj.value) &gt; <span class="number">1</span>) &#123;</span><br><span class="line">                numObj.value = parseInt(numObj.value) - <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function">function <span class="title">addCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> numObj = document.getElementsByName(<span class="string">&quot;num&quot;</span>)[<span class="number">0</span>];</span><br><span class="line">            numObj.value = parseInt(numObj.value) + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;!--顶部--&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;top&quot;</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;top_center&quot;</span>&gt;</span><br><span class="line">        &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;top_bars&quot;</span>&gt;</span><br><span class="line">            &lt;li&gt;&lt;a href=<span class="string">&quot;/userLogout&quot;</span>&gt;退出&lt;/a&gt;|&lt;/li&gt;</span><br><span class="line">            &lt;li&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;我的订单&lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;jt_down&quot;</span>&gt;&lt;/span&gt;&lt;/a&gt;|&lt;/li&gt;</span><br><span class="line">            &lt;li&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;关注杰普&lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;jt_down&quot;</span>&gt;&lt;/span&gt;&lt;/a&gt;|&lt;/li&gt;</span><br><span class="line">            &lt;li&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;网站导航&lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;jt_down&quot;</span>&gt;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;!--头部--&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;header3&quot;</span>&gt;</span><br><span class="line">    &lt;a href=<span class="string">&quot;#&quot;</span>&gt;&lt;img src=<span class="string">&quot;images/logo.png&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;oneImg&quot;</span>&gt;&lt;/a&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;h3_right&quot;</span>&gt;</span><br><span class="line">        &lt;img src=<span class="string">&quot;images/play_03.png&quot;</span> alt=<span class="string">&quot;&quot;</span>&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;!--中间部分div--&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;empty&quot;</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;peisong&quot;</span>&gt;</span><br><span class="line">        &lt;pre&gt;全部商品  $&#123;map.size&#125; &lt;/pre&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;mainCenter&quot;</span>&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;allCheck&quot;</span>&gt;</span><br><span class="line">            &lt;input type=<span class="string">&quot;checkbox&quot;</span>&gt;</span><br><span class="line">            &lt;p&gt;全选&lt;/p&gt;</span><br><span class="line">            &lt;p <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;leftM&quot;</span>&gt;商品&lt;/p&gt;</span><br><span class="line">            &lt;p <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;rightM&quot;</span>&gt;单价(元)&lt;/p&gt;</span><br><span class="line">            &lt;p <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;leftM&quot;</span>&gt;数量&lt;/p&gt;</span><br><span class="line">            &lt;p <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;leftM&quot;</span>&gt;小计(元)&lt;/p&gt;</span><br><span class="line">            &lt;p <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;leftM&quot;</span>&gt;操作&lt;/p&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;mainPro&quot;</span>&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;aa&quot;</span>&gt;</span><br><span class="line">                &lt;input type=<span class="string">&quot;checkbox&quot;</span>&gt;&lt;span id=<span class="string">&quot;but&quot;</span>&gt;自营&lt;/span&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;cartForm&quot;</span>&gt;</span><br><span class="line">                &lt;c:set <span class="keyword">var</span>=<span class="string">&quot;totalCost&quot;</span> value=<span class="string">&quot;0&quot;</span>/&gt;</span><br><span class="line">                &lt;c:forEach items=<span class="string">&quot;$&#123;map.shopCarList&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;shopCar&quot;</span> varStatus=<span class="string">&quot;s&quot;</span>&gt;</span><br><span class="line">                    &lt;form action=<span class="string">&quot;/shopCarUpdate&quot;</span> method=<span class="string">&quot;get&quot;</span>&gt;</span><br><span class="line">                        &lt;table&gt;</span><br><span class="line">                            &lt;tbody&gt;</span><br><span class="line">                            &lt;tr&gt;</span><br><span class="line">                                &lt;td <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;index&quot;</span> style=<span class="string">&quot;padding-left: 15px&quot;</span>&gt;$&#123;s.index+<span class="number">1</span>&#125;&lt;/td&gt;</span><br><span class="line">                                &lt;td&gt;</span><br><span class="line">                                    &lt;img src=<span class="string">&quot;$&#123;shopCar.book.image&#125;&quot;</span> width=<span class="string">&quot;100px&quot;</span> height=<span class="string">&quot;123px&quot;</span>&gt;</span><br><span class="line">                                    &lt;span&gt;</span><br><span class="line">                                   $&#123;shopCar.book.name&#125;</span><br><span class="line">                                    &lt;br&gt;</span><br><span class="line">                                &lt;/span&gt;</span><br><span class="line">                                &lt;/td&gt;</span><br><span class="line">                                &lt;td&gt;</span><br><span class="line">                                    &lt;span&gt;¥$&#123;shopCar.book.price&#125;&lt;/span&gt;</span><br><span class="line">                                &lt;/td&gt;</span><br><span class="line">                                &lt;td <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;index2&quot;</span>&gt;</span><br><span class="line">                                    &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;num&quot;</span> value=<span class="string">&quot;$&#123;shopCar.num&#125;&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">                                        &lt;%--隐藏bookId--%&gt;</span><br><span class="line">                                    &lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;bookId&quot;</span> value=<span class="string">&quot;$&#123;shopCar.book.id&#125;&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">                                        &lt;%--&lt;dl&gt;</span><br><span class="line">                                            &lt;dd onclick=<span class="string">&quot;addCount()&quot;</span>&gt;+&lt;/dd&gt;</span><br><span class="line">                                            &lt;dd onclick=<span class="string">&quot;reduceCount()&quot;</span>&gt;-&lt;/dd&gt;</span><br><span class="line">                                        &lt;/dl&gt;--%&gt;</span><br><span class="line">                                    &lt;span&gt;有货&lt;/span&gt;</span><br><span class="line">                                &lt;/td&gt;</span><br><span class="line">                                &lt;td&gt;</span><br><span class="line">                                    &lt;span&gt;¥$&#123;shopCar.book.price * shopCar.num&#125;&lt;/span&gt;</span><br><span class="line">                                &lt;/td&gt;</span><br><span class="line">                                &lt;c:set <span class="keyword">var</span>=<span class="string">&quot;totalCost&quot;</span> value=<span class="string">&quot;$&#123;totalCost + shopCar.book.price * shopCar.num&#125;&quot;</span>/&gt;</span><br><span class="line">                                &lt;td&gt;</span><br><span class="line">                                    &lt;button type=<span class="string">&quot;submit&quot;</span>&gt;更新&lt;/button&gt;</span><br><span class="line">                                    &lt;button type=<span class="string">&quot;button&quot;</span></span><br><span class="line">                                            onclick=<span class="string">&quot;window.location.href=&#x27;shopCarRemove?bookId=&#x27;+$&#123;orderLine.book.id&#125;&quot;</span>&gt;移除</span><br><span class="line">                                    &lt;/button&gt;</span><br><span class="line">                                &lt;/td&gt;</span><br><span class="line">                            &lt;/tr&gt;</span><br><span class="line">                            &lt;/tbody&gt;</span><br><span class="line">                        &lt;/table&gt;</span><br><span class="line">                    &lt;/form&gt;</span><br><span class="line">                &lt;/c:forEach&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;allButtom&quot;</span>&gt;</span><br><span class="line">            &lt;!-- &lt;p <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;caozuo&quot;</span>&gt;去结算&lt;/p&gt; --&gt;</span><br><span class="line">            &lt;!-- &lt;input value=<span class="string">&quot;去提交&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;caozuo&quot;</span> type=<span class="string">&quot;submit&quot;</span>&gt; --&gt;</span><br><span class="line">            &lt;a href=<span class="string">&quot;/orderConfirm&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;caozuo&quot;</span>&gt;去提交&lt;/a&gt;</span><br><span class="line">            &lt;span&gt;已选择&lt;font&gt;$&#123;map.size&#125;&lt;/font&gt;件商品&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;总价(不含运费)：&lt;font&gt;¥$&#123;totalCost&#125;元&lt;/font&gt;&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;!--脚部--&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;footer3&quot;</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_top&quot;</span>&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_center&quot;</span>&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;ts1&quot;</span>&gt;品目繁多 愉悦购物&lt;/div&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;ts2&quot;</span>&gt;正品保障 天天低价&lt;/div&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;ts3&quot;</span>&gt;极速物流 特色定制&lt;/div&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;ts4&quot;</span>&gt;优质服务 以客为尊&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_middle&quot;</span>&gt;</span><br><span class="line">        &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_center&quot;</span>&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_mi_li01&quot;</span>&gt;</span><br><span class="line">                &lt;h1&gt;购物指南&lt;/h1&gt;</span><br><span class="line">                &lt;p&gt;常见问题&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;找回密码&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;会员介绍&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;购物演示&lt;/p&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_mi_li01&quot;</span>&gt;</span><br><span class="line">                &lt;h1&gt;配送方式&lt;/h1&gt;</span><br><span class="line">                &lt;p&gt;常见问题&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;找回密码&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;会员介绍&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;购物演示&lt;/p&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_mi_li01&quot;</span>&gt;</span><br><span class="line">                &lt;h1&gt;支付方式&lt;/h1&gt;</span><br><span class="line">                &lt;p&gt;常见问题&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;找回密码&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;会员介绍&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;购物演示&lt;/p&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_mi_li01&quot;</span>&gt;</span><br><span class="line">                &lt;h1&gt;售后服务&lt;/h1&gt;</span><br><span class="line">                &lt;p&gt;常见问题&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;找回密码&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;会员介绍&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;购物演示&lt;/p&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_mi_li01&quot;</span>&gt;</span><br><span class="line">                &lt;h1&gt;服务保障&lt;/h1&gt;</span><br><span class="line">                &lt;p&gt;常见问题&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;找回密码&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;会员介绍&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;购物演示&lt;/p&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_mi_li06&quot;</span>&gt;</span><br><span class="line">                &lt;h1&gt;客服中心&lt;/h1&gt;</span><br><span class="line">                &lt;img src=<span class="string">&quot;images/qrcode_jprj.jpg&quot;</span> width=<span class="string">&quot;80px&quot;</span> height=<span class="string">&quot;80px&quot;</span>&gt;</span><br><span class="line">                &lt;p&gt;抢红包、疑问咨询、优惠活动&lt;/p&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_bottom&quot;</span>&gt;</span><br><span class="line">        &lt;p <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_links&quot;</span>&gt;</span><br><span class="line">            &lt;a href=<span class="string">&quot;#&quot;</span>&gt;关于我们&lt;/a&gt;|</span><br><span class="line">            &lt;a href=<span class="string">&quot;#&quot;</span>&gt;联系我们&lt;/a&gt;|</span><br><span class="line">            &lt;a href=<span class="string">&quot;#&quot;</span>&gt;友情链接&lt;/a&gt;|</span><br><span class="line">            &lt;a href=<span class="string">&quot;#&quot;</span>&gt;供货商入驻&lt;/a&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">        &lt;p&gt;沪ICP备<span class="number">14033591</span>号-<span class="number">8</span> 杰普软件briup.com版权所有 杰普软件科技有限公司 &lt;/p&gt;</span><br><span class="line">        &lt;img src=<span class="string">&quot;images/police.png&quot;</span>&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h3 id="更新购物车数量"><a href="#更新购物车数量" class="headerlink" title="更新购物车数量"></a>更新购物车数量</h3><h3 id="移除购物车"><a href="#移除购物车" class="headerlink" title="移除购物车"></a>移除购物车</h3><h2 id="订单模块"><a href="#订单模块" class="headerlink" title="订单模块"></a>订单模块</h2><h3 id="准备提交"><a href="#准备提交" class="headerlink" title="准备提交"></a>准备提交</h3><h4 id="分析-7"><a href="#分析-7" class="headerlink" title="==分析=="></a>==分析==</h4><ul>
<li>在真正提交之前,先跳转到确认页面</li>
<li>选择收货信息<ul>
<li>查找以前的收货信息</li>
<li>添加新的收货信息</li>
</ul>
</li>
</ul>
<h4 id="ConfirmServlet"><a href="#ConfirmServlet" class="headerlink" title="ConfirmServlet"></a>ConfirmServlet</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.estore.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.estore.entity.Customer;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.entity.ShopAddress;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.service.IAddressService;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.service.impl.AddressServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse(lc))</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022/6/2-06-02-11:27</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：com.briup.estore.web.servlet</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/orderConfirm&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderConfirmServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 1.准备用户的收获地址</span></span><br><span class="line">        HttpSession session = req.getSession();</span><br><span class="line">        <span class="comment">// 当前登录用户</span></span><br><span class="line">        Customer customer = (Customer) session.getAttribute(<span class="string">&quot;customer&quot;</span>);</span><br><span class="line">        IAddressService adressService = <span class="keyword">new</span> AddressServiceImpl();</span><br><span class="line">        List&lt;ShopAddress&gt; shopAddressList = adressService.findAddressByCId(customer.getId());</span><br><span class="line">        session.setAttribute(<span class="string">&quot;shopAddressList&quot;</span>,shopAddressList);</span><br><span class="line">        <span class="comment">// 2.跳转确认页面</span></span><br><span class="line">        resp.sendRedirect(<span class="string">&quot;orderConfirm.jsp&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        doGet(req,resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="ShopAddressServiceImpl"><a href="#ShopAddressServiceImpl" class="headerlink" title="ShopAddressServiceImpl"></a>ShopAddressServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.ShopAddress;</span><br><span class="line"><span class="keyword">import</span> com.briup.dao.ShopAddressMapper;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.ShopAddressService;</span><br><span class="line"><span class="keyword">import</span> com.briup.util.MyBatisSqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/10-09-10-13:45</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：com.briup.service.impl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShopAddressServiceImpl</span> <span class="keyword">implements</span> <span class="title">ShopAddressService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> SqlSession sqlSession = MyBatisSqlSessionFactory.openSession(<span class="keyword">true</span>);</span><br><span class="line">    <span class="keyword">private</span> ShopAddressMapper shopAddressMapper = sqlSession.getMapper(ShopAddressMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;ShopAddress&gt; <span class="title">findAddressByCustomer</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> shopAddressMapper.findShopAddressByCId(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>####ShopAddressMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.briup.dao.ShopAddressMapper&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findShopAddressByCId&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">resultType</span>=<span class="string">&quot;com.briup.bean.ShopAddress&quot;</span>&gt;</span></span><br><span class="line">        select *</span><br><span class="line">        from es_shopaddress</span><br><span class="line">        where customer_id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="confirm-jsp"><a href="#confirm-jsp" class="headerlink" title="confirm.jsp"></a>confirm.jsp</h4><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;c&quot;</span> uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> %&gt;</span><br><span class="line"></span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> isELIgnored=<span class="string">&quot;false&quot;</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html;charset=UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;结算页面&lt;/title&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;css/common.css&quot;</span>/&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;css/icons.css&quot;</span> /&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;css/table.css&quot;</span> /&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;css/orderSure.css&quot;</span> /&gt;</span><br><span class="line">    &lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">        <span class="function">function <span class="title">showAdres</span><span class="params">(sp)</span></span>&#123;</span><br><span class="line">            <span class="keyword">var</span> pa = document.getElementById(<span class="string">&quot;newAdres&quot;</span>);</span><br><span class="line">            console.log(pa.style[<span class="string">&#x27;display&#x27;</span>]);</span><br><span class="line">            <span class="keyword">if</span>(pa.style[<span class="string">&#x27;display&#x27;</span>]==<span class="string">&quot;none&quot;</span>)&#123;</span><br><span class="line">                pa.style[<span class="string">&#x27;display&#x27;</span>] = <span class="string">&#x27;block&#x27;</span>;</span><br><span class="line">                sp.innerHTML = <span class="string">&quot;取消新增地址&quot;</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                pa.style[<span class="string">&#x27;display&#x27;</span>] = <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">                sp.innerHTML = <span class="string">&quot;新增收货地址&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;!--顶部--&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;top&quot;</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;top_center&quot;</span>&gt;</span><br><span class="line">        &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;top_bars&quot;</span>&gt;</span><br><span class="line">            &lt;li&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;退出&lt;/a&gt;|&lt;/li&gt;</span><br><span class="line">            &lt;li&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;我的订单&lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;jt_down&quot;</span>&gt;&lt;/span&gt;&lt;/a&gt;|&lt;/li&gt;</span><br><span class="line">            &lt;li&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;关注杰普&lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;jt_down&quot;</span>&gt;&lt;/span&gt;&lt;/a&gt;|&lt;/li&gt;</span><br><span class="line">            &lt;li&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;网站导航&lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;jt_down&quot;</span>&gt;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;!--头部--&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;header3&quot;</span>&gt;</span><br><span class="line">    &lt;a href=<span class="string">&quot;#&quot;</span>&gt;&lt;img src=<span class="string">&quot;images/logo.png&quot;</span>  <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;oneImg&quot;</span>&gt;&lt;/a&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;h3_right&quot;</span>&gt;</span><br><span class="line">        &lt;img src=<span class="string">&quot;images/play_03.png&quot;</span> alt=<span class="string">&quot;&quot;</span>&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;p <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;orderButtom&quot;</span>&gt;填写并核对订单信息&lt;/p&gt;</span><br><span class="line">&lt;!--中间复杂部分--&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;content&quot;</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;contentCenter&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">        &lt;form action=<span class="string">&quot;/submit&quot;</span> name=<span class="string">&quot;orderForm&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;centerTop&quot;</span>&gt;</span><br><span class="line">                &lt;b style=<span class="string">&quot;font-size:20px;&quot;</span>&gt;收货人信息&lt;/b&gt;</span><br><span class="line"></span><br><span class="line">                &lt;b style=<span class="string">&quot;float: right;cursor: pointer;&quot;</span> onclick=<span class="string">&quot;showAdres(this);&quot;</span></span><br><span class="line">                   ondblclick=<span class="string">&quot;hideAdres(this);&quot;</span>&gt;新增收货地址&lt;/b&gt;</span><br><span class="line">                &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;adres&quot;</span>&gt;</span><br><span class="line">                    &lt;c:forEach items=<span class="string">&quot;$&#123;shopAddressList&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;shopAddrss&quot;</span>&gt;</span><br><span class="line">                        &lt;li&gt;</span><br><span class="line">                            &lt;input type=<span class="string">&quot;radio&quot;</span> name=<span class="string">&quot;shopAddId&quot;</span> value=<span class="string">&quot;$&#123;shopAddrss.id&#125;&quot;</span> style=<span class="string">&quot;width:50px&quot;</span>&gt;</span><br><span class="line">                            $&#123;shopAddrss.receiveName&#125;&amp;nbsp;&amp;nbsp;&amp;nbsp; $&#123;shopAddrss.address&#125;&amp;nbsp;&amp;nbsp;&amp;nbsp; $&#123;shopAddrss.phone&#125;</span><br><span class="line">                        &lt;/li&gt;</span><br><span class="line">                    &lt;/c:forEach&gt;</span><br><span class="line"></span><br><span class="line">                &lt;/ul&gt;</span><br><span class="line"></span><br><span class="line">                &lt;p id=<span class="string">&quot;newAdres&quot;</span> style=<span class="string">&quot;font-size:15px;display: none;&quot;</span>&gt;</span><br><span class="line">                    收件人姓名：&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;receiveName&quot;</span>&gt;&lt;br/&gt;&lt;br/&gt;</span><br><span class="line">                    收件人电话：&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;phone&quot;</span> &gt;</span><br><span class="line">                    收件人地址：&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;address&quot;</span>&gt;&lt;br/&gt;&lt;br/&gt;</span><br><span class="line">                &lt;/p&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            &lt;p <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;singleP&quot;</span>&gt;&lt;b&gt;送货清单&lt;/b&gt;&lt;span&gt;&lt;a href=<span class="string">&quot;shopCart.jsp&quot;</span>&gt;返回修改购物车&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;bigDiv&quot;</span>&gt;</span><br><span class="line">                &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;twoDiv&quot;</span>&gt;</span><br><span class="line">                    &lt;b&gt;商家：briup自营&lt;/b&gt;</span><br><span class="line">                    &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;oneUL&quot;</span>&gt;</span><br><span class="line">                        &lt;c:forEach items=<span class="string">&quot;$&#123;shopCart.orderLines&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;orderLine&quot;</span>&gt;</span><br><span class="line">                            &lt;li&gt;</span><br><span class="line">                                &lt;img src=<span class="string">&quot;$&#123;orderLine.book.image&#125;&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pic&quot;</span>&gt;</span><br><span class="line">                                &lt;p&gt;计算机&amp;nbsp;&amp;nbsp;$&#123;orderLine.book.category.name&#125;&amp;nbsp;&amp;nbsp;$&#123;orderLine.book.name&#125;&amp;nbsp;&amp;nbsp;&lt;/p&gt;</span><br><span class="line">                                &lt;p&gt;&lt;font&gt;¥$&#123;orderLine.book.price&#125;&lt;/font&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;×$&#123;orderLine.num&#125;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;有货&lt;/p&gt;</span><br><span class="line">                                &lt;p&gt;&lt;img src=<span class="string">&quot;images/sureLogo_14.png&quot;</span> alt=<span class="string">&quot;&quot;</span>&gt;&lt;span&gt;七天无理由退换货&lt;/span&gt;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">                            &lt;/li&gt;</span><br><span class="line">                        &lt;/c:forEach&gt;</span><br><span class="line"></span><br><span class="line">                        &lt;li&gt;&lt;pre&gt;【赠品】  高级定制干花书签  随机 ×<span class="number">1</span>&lt;/pre&gt;&lt;/li&gt;</span><br><span class="line">                    &lt;/ul&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;money&quot;</span>&gt;</span><br><span class="line">                &lt;span&gt;&lt;font&gt;$&#123;shopCart.size&#125;&lt;/font&gt;件商品，总商品金额：&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;¥$&#123;shopCart.totalCost&#125;&lt;/span&gt;</span><br><span class="line">                &lt;span&gt;&lt;img src=<span class="string">&quot;images/sureLogo_18.png&quot;</span> alt=<span class="string">&quot;&quot;</span>&gt;运费：&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;¥<span class="number">0.00</span>&lt;/span&gt;</span><br><span class="line"></span><br><span class="line">                &lt;span&gt;应付总额：&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;¥$&#123;shopCart.totalCost&#125;&lt;/span&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;submit&quot;</span>&gt;</span><br><span class="line">                &lt;span&gt;应付金额：&lt;font&gt;¥$&#123;shopCart.totalCost&#125;&lt;/font&gt;&lt;input type=<span class="string">&quot;image&quot;</span> src=<span class="string">&quot;images/21_03.png&quot;</span>&gt;&lt;/span&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;!--脚部--&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;footer3&quot;</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_top&quot;</span>&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_center&quot;</span>&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;ts1&quot;</span>&gt;品目繁多 愉悦购物&lt;/div&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;ts2&quot;</span>&gt;正品保障 天天低价&lt;/div&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;ts3&quot;</span>&gt;极速物流 特色定制&lt;/div&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;ts4&quot;</span>&gt;优质服务 以客为尊&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_middle&quot;</span>&gt;</span><br><span class="line">        &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_center&quot;</span>&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_mi_li01&quot;</span>&gt;</span><br><span class="line">                &lt;h1&gt;购物指南&lt;/h1&gt;</span><br><span class="line">                &lt;p&gt;常见问题&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;找回密码&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;会员介绍&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;购物演示&lt;/p&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_mi_li01&quot;</span>&gt;</span><br><span class="line">                &lt;h1&gt;配送方式&lt;/h1&gt;</span><br><span class="line">                &lt;p&gt;常见问题&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;找回密码&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;会员介绍&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;购物演示&lt;/p&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_mi_li01&quot;</span>&gt;</span><br><span class="line">                &lt;h1&gt;支付方式&lt;/h1&gt;</span><br><span class="line">                &lt;p&gt;常见问题&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;找回密码&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;会员介绍&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;购物演示&lt;/p&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_mi_li01&quot;</span>&gt;</span><br><span class="line">                &lt;h1&gt;售后服务&lt;/h1&gt;</span><br><span class="line">                &lt;p&gt;常见问题&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;找回密码&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;会员介绍&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;购物演示&lt;/p&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_mi_li01&quot;</span>&gt;</span><br><span class="line">                &lt;h1&gt;服务保障&lt;/h1&gt;</span><br><span class="line">                &lt;p&gt;常见问题&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;找回密码&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;会员介绍&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;购物演示&lt;/p&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_mi_li06&quot;</span>&gt;</span><br><span class="line">                &lt;h1&gt;客服中心&lt;/h1&gt;</span><br><span class="line">                &lt;img src=<span class="string">&quot;images/qrcode_jprj.jpg&quot;</span> width=<span class="string">&quot;80px&quot;</span> height=<span class="string">&quot;80px&quot;</span>&gt;</span><br><span class="line">                &lt;p&gt;抢红包、疑问咨询、优惠活动&lt;/p&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_bottom&quot;</span>&gt;</span><br><span class="line">        &lt;p <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_links&quot;</span>&gt;</span><br><span class="line">            &lt;a href=<span class="string">&quot;#&quot;</span>&gt;关于我们&lt;/a&gt;|</span><br><span class="line">            &lt;a href=<span class="string">&quot;#&quot;</span>&gt;联系我们&lt;/a&gt;|</span><br><span class="line">            &lt;a href=<span class="string">&quot;#&quot;</span>&gt;友情链接&lt;/a&gt;|</span><br><span class="line">            &lt;a href=<span class="string">&quot;#&quot;</span>&gt;供货商入驻&lt;/a&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">        &lt;p&gt;沪ICP备<span class="number">14033591</span>号-<span class="number">8</span> 杰普软件briup.com版权所有 杰普软件科技有限公司 &lt;/p&gt;</span><br><span class="line">        &lt;img src=<span class="string">&quot;images/police.png&quot;</span>&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h3 id="提交订单"><a href="#提交订单" class="headerlink" title="提交订单"></a>提交订单</h3><h4 id="分析-8"><a href="#分析-8" class="headerlink" title="分析"></a>分析</h4><ul>
<li>封装订单数据<ul>
<li>封装基本信息</li>
<li>封装地址信息<ul>
<li>如果选择的是旧地址</li>
<li>如果插入了新地址</li>
</ul>
</li>
<li>封装客户信息</li>
<li>封装订单项信息</li>
</ul>
</li>
<li>清空购物车</li>
<li>根据客户查找订单信息</li>
<li>跳转订单列表</li>
</ul>
<h4 id="SubmitServlet"><a href="#SubmitServlet" class="headerlink" title="SubmitServlet"></a>SubmitServlet</h4><blockquote>
<p>注意: 页面输入框一定有值 空字符串</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.*;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.OrderFormService;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.ShopAddressService;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.impl.OrderFormServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.impl.ShopAddressServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/10-09-10-16:26</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：提交订单</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/submit&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SubmitServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        String shopAddId =req.getParameter(<span class="string">&quot;shopAddId&quot;</span>);</span><br><span class="line">        String receiveName = req.getParameter(<span class="string">&quot;receiveName&quot;</span>);</span><br><span class="line">        String address = req.getParameter(<span class="string">&quot;address&quot;</span>);</span><br><span class="line">        String phone = req.getParameter(<span class="string">&quot;phone&quot;</span>);</span><br><span class="line">        HttpSession session = req.getSession();</span><br><span class="line">        Customer customer = (Customer) session.getAttribute(<span class="string">&quot;customer&quot;</span>);</span><br><span class="line">        ShopCart shopCart = (ShopCart) session.getAttribute(<span class="string">&quot;shopCart&quot;</span>);</span><br><span class="line">        ShopAddress shopAddress = <span class="keyword">null</span>;</span><br><span class="line">        ShopAddressService shopAddressService = <span class="keyword">new</span> ShopAddressServiceImpl();</span><br><span class="line">        <span class="comment">// 获取地址信息</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="string">&quot;&quot;</span>.equals(receiveName) &amp;&amp; !<span class="string">&quot;&quot;</span>.equals(address) &amp;&amp; !<span class="string">&quot;&quot;</span>.equals(phone)) &#123;</span><br><span class="line">            <span class="comment">// 新地址 需要保存到数据库中</span></span><br><span class="line">            shopAddress = <span class="keyword">new</span> ShopAddress();</span><br><span class="line">            shopAddress.setCustomer(customer);</span><br><span class="line">            shopAddressService.saveShopAddress(shopAddress);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(shopAddId != <span class="keyword">null</span>)&#123;</span><br><span class="line">                <span class="comment">// 旧地址</span></span><br><span class="line">                shopAddress = shopAddressService.findAddressById(Integer.parseInt(shopAddId));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        Collection&lt;OrderLine&gt; orderLines = shopCart.getOrderLines();</span><br><span class="line">        <span class="keyword">double</span> cost = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (OrderLine orderLine : orderLines) &#123;</span><br><span class="line">            cost += orderLine.getCost();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 封装订单类</span></span><br><span class="line">        OrderForm orderForm = <span class="keyword">new</span> OrderForm();</span><br><span class="line">        orderForm.setShopAddress(shopAddress);</span><br><span class="line">        orderForm.setOrderLines(orderLines);</span><br><span class="line">        orderForm.setCustomer(customer);</span><br><span class="line">        orderForm.setCost(cost);</span><br><span class="line">        orderForm.setOrderDate(<span class="keyword">new</span> Date());</span><br><span class="line">        <span class="comment">// 添加订单</span></span><br><span class="line">        OrderFormService orderFormServcie = <span class="keyword">new</span> OrderFormServiceImpl();</span><br><span class="line">        orderFormServcie.saveOrderForm(orderForm);</span><br><span class="line">        <span class="comment">// 清空购物车</span></span><br><span class="line">        shopCart.clear();</span><br><span class="line">        <span class="comment">// 查询订单</span></span><br><span class="line">        resp.sendRedirect(<span class="string">&quot;/findAllOrderForm&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="ShopAddressServiceImpl-1"><a href="#ShopAddressServiceImpl-1" class="headerlink" title="ShopAddressServiceImpl"></a>ShopAddressServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.ShopAddress;</span><br><span class="line"><span class="keyword">import</span> com.briup.dao.ShopAddressMapper;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.ShopAddressService;</span><br><span class="line"><span class="keyword">import</span> com.briup.util.MyBatisSqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/10-09-10-13:45</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：com.briup.service.impl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShopAddressServiceImpl</span> <span class="keyword">implements</span> <span class="title">ShopAddressService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> SqlSession sqlSession = MyBatisSqlSessionFactory.openSession(<span class="keyword">true</span>);</span><br><span class="line">    <span class="keyword">private</span> ShopAddressMapper shopAddressMapper = sqlSession.getMapper(ShopAddressMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;ShopAddress&gt; <span class="title">findAddressByCustomer</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> shopAddressMapper.findShopAddressByCId(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveShopAddress</span><span class="params">(ShopAddress shopAddress)</span> </span>&#123;</span><br><span class="line">        shopAddressMapper.saveShopAddress(shopAddress);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ShopAddress <span class="title">findAddressById</span><span class="params">(<span class="keyword">int</span> shopAddId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> shopAddressMapper.findAddressById(shopAddId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="ShopAddressMapper-xml"><a href="#ShopAddressMapper-xml" class="headerlink" title="ShopAddressMapper.xml"></a>ShopAddressMapper.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.briup.dao.ShopAddressMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findShopAddressByCId&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">resultType</span>=<span class="string">&quot;com.briup.bean.ShopAddress&quot;</span>&gt;</span></span><br><span class="line">        select *</span><br><span class="line">        from es_shopaddress</span><br><span class="line">        where customer_id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;saveShopAddress&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;shopAddress&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">        insert into es_shopaddress(receiveName,address,phone,customer_id)</span><br><span class="line">		values(#&#123;receiveName&#125;,#&#123;address&#125;,#&#123;phone&#125;,#&#123;customer.id&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAddressById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;shopAddress&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">        select id,receiveName,address,phone,customer_id</span><br><span class="line">		from es_shopaddress where id= #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="OrderFormServiceImpl"><a href="#OrderFormServiceImpl" class="headerlink" title="OrderFormServiceImpl"></a>OrderFormServiceImpl</h4><blockquote>
<p>注意: 订单项需要保存订单id</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.OrderForm;</span><br><span class="line"><span class="keyword">import</span> com.briup.bean.OrderLine;</span><br><span class="line"><span class="keyword">import</span> com.briup.dao.OrderFormMapper;</span><br><span class="line"><span class="keyword">import</span> com.briup.dao.OrderLineMapper;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.OrderFormService;</span><br><span class="line"><span class="keyword">import</span> com.briup.util.MyBatisSqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/10-09-10-16:51</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：com.briup.service.impl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderFormServiceImpl</span> <span class="keyword">implements</span> <span class="title">OrderFormService</span> </span>&#123;</span><br><span class="line">    SqlSession session = MyBatisSqlSessionFactory.openSession(<span class="keyword">false</span>);</span><br><span class="line">    OrderFormMapper orderFormMapper = session.getMapper(OrderFormMapper.class);</span><br><span class="line">    OrderLineMapper orderLineMapper = session.getMapper(OrderLineMapper.class);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveOrderForm</span><span class="params">(OrderForm orderForm)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">try</span>&#123;</span><br><span class="line">           <span class="comment">// 保存订单</span></span><br><span class="line">           orderFormMapper.saveOrderForm(orderForm);</span><br><span class="line">           <span class="comment">// 保存订单项</span></span><br><span class="line">           Collection&lt;OrderLine&gt; orderLines = orderForm.getOrderLines();</span><br><span class="line">           orderLines.forEach(orderLine -&gt; &#123;</span><br><span class="line">               orderLine.setOrderForm(orderForm);</span><br><span class="line">           &#125;);</span><br><span class="line">           orderLineMapper.saveOrderLine(orderForm.getOrderLines());</span><br><span class="line">           session.commit();</span><br><span class="line">       &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">           session.rollback();</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="OrderFormMapper-java"><a href="#OrderFormMapper-java" class="headerlink" title="OrderFormMapper.java"></a>OrderFormMapper.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OrderFormMapper</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">saveOrderForm</span><span class="params">(OrderForm orderForm)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="OrderFormMapper-xml"><a href="#OrderFormMapper-xml" class="headerlink" title="OrderFormMapper.xml"></a>OrderFormMapper.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.briup.dao.OrderFormMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;saveOrderForm&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;orderForm&quot;</span></span></span><br><span class="line"><span class="tag">		<span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">		insert into</span><br><span class="line">		es_orderform(cost,orderDate,shopAddress_id,customer_id)</span><br><span class="line">		values(#&#123;cost&#125;,#&#123;orderDate&#125;,#&#123;shopAddress.id&#125;,#&#123;customer.id&#125;)</span><br><span class="line">	<span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="OrderLineMapper-java"><a href="#OrderLineMapper-java" class="headerlink" title="OrderLineMapper.java"></a>OrderLineMapper.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OrderLineMapper</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">saveOrderLineList</span><span class="params">(Collection&lt;OrderLine&gt; orderLines)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="OrderLineMapper-xml"><a href="#OrderLineMapper-xml" class="headerlink" title="OrderLineMapper.xml"></a>OrderLineMapper.xml</h4><blockquote>
<p>此处使用了批量插入 也可单个循环插入</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.briup.dao.OrderLineMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;saveOrderLine&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;collection&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">		insert into</span><br><span class="line">		es_orderline(num,cost,book_id,orderForm_id)</span><br><span class="line">		values</span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;collection&quot;</span> <span class="attr">item</span>=<span class="string">&quot;orderLine&quot;</span> <span class="attr">index</span>=<span class="string">&quot;index&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            (</span><br><span class="line">                #&#123;orderLine.num&#125;,</span><br><span class="line">                #&#123;orderLine.cost&#125;,</span><br><span class="line">                #&#123;orderLine.book.id&#125;,</span><br><span class="line">                #&#123;orderLine.orderForm.id&#125;</span><br><span class="line">            )</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="ShopCart-1"><a href="#ShopCart-1" class="headerlink" title="ShopCart"></a>ShopCart</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       cart.clear();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="查看自己订单"><a href="#查看自己订单" class="headerlink" title="查看自己订单"></a>查看自己订单</h3><h4 id="分析-9"><a href="#分析-9" class="headerlink" title="==分析=="></a>==分析==</h4><ul>
<li>客户只能查到与自己相关的订单</li>
<li>级联地址信息</li>
</ul>
<h4 id="FindAllOrderForm"><a href="#FindAllOrderForm" class="headerlink" title="FindAllOrderForm"></a>FindAllOrderForm</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Customer;</span><br><span class="line"><span class="keyword">import</span> com.briup.bean.OrderForm;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.OrderFormService;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.impl.OrderFormServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/11-09-11-8:41</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：com.briup.web.servlet</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/findAllOrderForm&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FindAllOrderForm</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        HttpSession session = req.getSession();</span><br><span class="line">        Customer customer = (Customer) session.getAttribute(<span class="string">&quot;customer&quot;</span>);</span><br><span class="line">        OrderFormService orderFormService = <span class="keyword">new</span> OrderFormServiceImpl();</span><br><span class="line">        List&lt;OrderForm&gt; orderFormList = orderFormService.findAllOrderForm(customer.getId());</span><br><span class="line">        session.setAttribute(<span class="string">&quot;orderFormList&quot;</span>,orderFormList);</span><br><span class="line">        resp.sendRedirect(<span class="string">&quot;orderList.jsp&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="OrderFormServiceImpl-1"><a href="#OrderFormServiceImpl-1" class="headerlink" title="OrderFormServiceImpl"></a>OrderFormServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> List&lt;OrderForm&gt; <span class="title">findAllOrderForm</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> orderFormMapper.findAllOrderForm(id);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h4 id="OrderFormMapper-xml-1"><a href="#OrderFormMapper-xml-1" class="headerlink" title="OrderFormMapper.xml"></a>OrderFormMapper.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;orderFormMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;orderForm&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;cost&quot;</span> <span class="attr">property</span>=<span class="string">&quot;cost&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;orderDate&quot;</span> <span class="attr">property</span>=<span class="string">&quot;orderDate&quot;</span> /&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--收货人 注意: findAddressById的返回形式需要resultMap--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;shopAddress&quot;</span></span></span><br><span class="line"><span class="tag">		<span class="attr">column</span>=<span class="string">&quot;shopAddress_id&quot;</span> <span class="attr">select</span>=<span class="string">&quot;com.briup.dao.ShopAddressMapper.findAddressById&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAllOrderForm&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;orderFormMap&quot;</span>&gt;</span></span><br><span class="line">       select id,cost,orderDate,shopAddress_id,customer_id</span><br><span class="line">	from</span><br><span class="line">	es_orderform</span><br><span class="line">	where customer_id = #&#123;id&#125;</span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="ShopAddressMapper-xml-1"><a href="#ShopAddressMapper-xml-1" class="headerlink" title="ShopAddressMapper.xml"></a>ShopAddressMapper.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;ShopAddress&quot;</span> <span class="attr">id</span>=<span class="string">&quot;ShopAddressResult&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;receiveName&quot;</span> <span class="attr">property</span>=<span class="string">&quot;receiveName&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;address&quot;</span> <span class="attr">property</span>=<span class="string">&quot;address&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;phone&quot;</span> <span class="attr">property</span>=<span class="string">&quot;phone&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAddressById&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;ShopAddressResult&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">       select id,receiveName,address,phone,customer_id</span><br><span class="line">	from es_shopaddress where id= #&#123;id&#125;</span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="orderList-jsp"><a href="#orderList-jsp" class="headerlink" title="orderList.jsp"></a>orderList.jsp</h4><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:forEach items=<span class="string">&quot;$&#123;orderFormList&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;orderForm&quot;</span> varStatus=<span class="string">&quot;v&quot;</span>&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">                &lt;td align=<span class="string">&quot;center&quot;</span>&gt;$&#123;v.index+<span class="number">1</span>&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;$&#123;orderForm.id&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;$&#123;orderForm.cost&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;未付款&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;$&#123;orderForm.shopAddress.receiveName&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;&lt;input type=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;删除&quot;</span> onclick=<span class="string">&quot;javascript:window.location=&#x27;orderlist.html&#x27;;&quot;</span>&gt;&lt;input type=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;明细&quot;</span> onclick=<span class="string">&quot;javascript:window.location=&#x27;orderdetail.html&#x27;;&quot;</span>&gt;  &lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">        &lt;/c:forEach&gt;</span><br></pre></td></tr></table></figure>



<h3 id="查看订单详情"><a href="#查看订单详情" class="headerlink" title="查看订单详情"></a>查看订单详情</h3><h4 id="分析-10"><a href="#分析-10" class="headerlink" title="==分析=="></a>==分析==</h4><ul>
<li>级联书的信息</li>
</ul>
<p>####orderList.jsp</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;明细&quot;</span> onclick=<span class="string">&quot;javascript:window.location=&#x27;/orderDetail?id=$&#123;orderForm.id&#125;&#x27;;&quot;</span>&gt;</span><br></pre></td></tr></table></figure>



<h4 id="OrderDetailServlet"><a href="#OrderDetailServlet" class="headerlink" title="OrderDetailServlet"></a>OrderDetailServlet</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/orderDetail&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderDetailServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> id = Integer.parseInt(req.getParameter(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">        OrderLineService orderLineService = <span class="keyword">new</span> OrderLineServiceImpl();</span><br><span class="line">        List&lt;OrderLine&gt; orderLineList = orderLineService.findOrderLinesByOrderFormId(id);</span><br><span class="line">        HttpSession session = req.getSession();</span><br><span class="line">        session.setAttribute(<span class="string">&quot;orderLineList&quot;</span>,orderLineList);</span><br><span class="line">        req.getRequestDispatcher(<span class="string">&quot;/orderDetail.jsp&quot;</span>).forward(req,resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="OrderLineServiceImpl"><a href="#OrderLineServiceImpl" class="headerlink" title="OrderLineServiceImpl"></a>OrderLineServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.OrderLine;</span><br><span class="line"><span class="keyword">import</span> com.briup.dao.OrderLineMapper;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.OrderLineService;</span><br><span class="line"><span class="keyword">import</span> com.briup.util.MyBatisSqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/11-09-11-9:22</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：com.briup.service.impl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderLineServiceImpl</span> <span class="keyword">implements</span> <span class="title">OrderLineService</span> </span>&#123;</span><br><span class="line">    SqlSession session = MyBatisSqlSessionFactory.openSession(<span class="keyword">false</span>);</span><br><span class="line">    OrderLineMapper orderLineMapper = session.getMapper(OrderLineMapper.class);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;OrderLine&gt; <span class="title">findOrderLinesByOrderFormId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> orderLineMapper.findOrderLinesByOrderFormId(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveOrderLine</span><span class="params">(Collection&lt;OrderLine&gt; orderLines)</span> </span>&#123;</span><br><span class="line">        orderLineMapper.saveOrderLine(orderLines);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="OrderLineMapper-xml-1"><a href="#OrderLineMapper-xml-1" class="headerlink" title="OrderLineMapper.xml"></a>OrderLineMapper.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;OrderLine&quot;</span> <span class="attr">id</span>=<span class="string">&quot;OrderLineResult&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;num&quot;</span> <span class="attr">property</span>=<span class="string">&quot;num&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;cost&quot;</span> <span class="attr">property</span>=<span class="string">&quot;cost&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;book&quot;</span> <span class="attr">column</span>=<span class="string">&quot;book_id&quot;</span></span></span><br><span class="line"><span class="tag">			<span class="attr">select</span>=<span class="string">&quot;com.briup.dao.BookMapper.findBookById&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findOrderLinesByOrderFormId&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;OrderLineResult&quot;</span>&gt;</span></span><br><span class="line">        select * from es_orderline</span><br><span class="line">        where orderForm_id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="BookMapper-xml-1"><a href="#BookMapper-xml-1" class="headerlink" title="BookMapper.xml"></a>BookMapper.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;book&quot;</span> <span class="attr">id</span>=<span class="string">&quot;simpleBookMap&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;price&quot;</span> <span class="attr">property</span>=<span class="string">&quot;price&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;author&quot;</span> <span class="attr">property</span>=<span class="string">&quot;author&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;publisher&quot;</span> <span class="attr">property</span>=<span class="string">&quot;publisher&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;pubDate&quot;</span> <span class="attr">property</span>=<span class="string">&quot;pubDate&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;description&quot;</span> <span class="attr">property</span>=<span class="string">&quot;description&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;image&quot;</span> <span class="attr">property</span>=<span class="string">&quot;image&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findBookById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;simpleBookMap&quot;</span>&gt;</span></span><br><span class="line">        select * from es_book</span><br><span class="line">        where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="orderDetail-jsp"><a href="#orderDetail-jsp" class="headerlink" title="orderDetail.jsp"></a>orderDetail.jsp</h4><blockquote>
<p>此处使用&lt;c:set&gt; 循环计算</p>
</blockquote>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;tbody&gt;</span><br><span class="line">        &lt;c:set <span class="keyword">var</span>=<span class="string">&quot;totalCost&quot;</span> value=<span class="string">&quot;0&quot;</span>/&gt;</span><br><span class="line">        &lt;c:forEach items=<span class="string">&quot;$&#123;orderLineList&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;orderLine&quot;</span> varStatus=<span class="string">&quot;v&quot;</span>&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">                &lt;td&gt;$&#123;v.index&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;$&#123;orderLine.book.name&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;价格：&lt;span&gt;$&#123;orderLine.book.price&#125;&lt;/span&gt;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;数量：&lt;span&gt;$&#123;orderLine.num&#125;&lt;/span&gt;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;小计：&lt;span&gt; $&#123;orderLine.book.price&#125; * $&#123;orderLine.num&#125;&lt;/span&gt;&lt;/td&gt;</span><br><span class="line">                &lt;c:set <span class="keyword">var</span>=<span class="string">&quot;totalCost&quot;</span> value=<span class="string">&quot;$&#123;orderLine.book.price * orderLine.num + totalCost&#125;&quot;</span>/&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">        &lt;/c:forEach&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td colspan=<span class="string">&quot;5&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;count&quot;</span>&gt;合计：&lt;span&gt;$&#123;totalCost&#125;&lt;/span&gt;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;/tbody&gt;</span><br></pre></td></tr></table></figure>



<h3 id="删除订单"><a href="#删除订单" class="headerlink" title="删除订单"></a>删除订单</h3><h4 id="分析-11"><a href="#分析-11" class="headerlink" title="==分析=="></a>==分析==</h4><ul>
<li>订单被订单项引用 不能直接删除</li>
<li>先删除引用了订单的所有订单项信息,再删除订单</li>
</ul>
<h4 id="orderList-jsp-1"><a href="#orderList-jsp-1" class="headerlink" title="orderList.jsp"></a>orderList.jsp</h4><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;删除&quot;</span> onclick=<span class="string">&quot;javascript:window.location=&#x27;/orderDelete?id=$&#123;orderForm.id&#125;&#x27;;&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<h4 id="OrderDelete"><a href="#OrderDelete" class="headerlink" title="OrderDelete"></a>OrderDelete</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.service.OrderFormService;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.impl.OrderFormServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/11-09-11-11:11</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：com.briup.web.servlet</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/orderDelete&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderDelete</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> id = Integer.parseInt(req.getParameter(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">        OrderFormService orderFormService  = <span class="keyword">new</span> OrderFormServiceImpl();</span><br><span class="line">        orderFormService.deleteOrderById(id);</span><br><span class="line"></span><br><span class="line">        req.getRequestDispatcher(<span class="string">&quot;/findAllOrderForm&quot;</span>).forward(req,resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="OrderFormServiceImpl-2"><a href="#OrderFormServiceImpl-2" class="headerlink" title="OrderFormServiceImpl"></a>OrderFormServiceImpl</h4><blockquote>
<p>注意: 订单和订单项有外键关联</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteOrderById</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">       List&lt;OrderLine&gt; orderList = orderLineService.findOrderLinesByOrderFormId(id);</span><br><span class="line">       orderLineService.deleteBatch(orderList);</span><br><span class="line">       orderFormMapper.deleteById(id);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h4 id="OrderLineServiceImpl-1"><a href="#OrderLineServiceImpl-1" class="headerlink" title="OrderLineServiceImpl"></a>OrderLineServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteBatch</span><span class="params">(List&lt;OrderLine&gt; orderList)</span> </span>&#123;</span><br><span class="line">    orderLineMapper.deleteBatch(orderList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="OrderLineMapper-xml-2"><a href="#OrderLineMapper-xml-2" class="headerlink" title="OrderLineMapper.xml"></a>OrderLineMapper.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteBatch&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">        delete from es_orderLine</span><br><span class="line">        where id in</span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span> <span class="attr">item</span>=<span class="string">&quot;orderLine&quot;</span>&gt;</span></span><br><span class="line">           #&#123;orderLine.id&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="OrderFormMapper-xml-2"><a href="#OrderFormMapper-xml-2" class="headerlink" title="OrderFormMapper.xml"></a>OrderFormMapper.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">       delete from es_orderform</span><br><span class="line">       where id = #&#123;id&#125;</span><br><span class="line">   <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="集成沙箱"><a href="#集成沙箱" class="headerlink" title="集成沙箱"></a>集成沙箱</h2><h3 id="注册沙箱"><a href="#注册沙箱" class="headerlink" title="注册沙箱"></a>注册沙箱</h3><p><code>注意： 不要使用谷歌浏览器...否则沙箱页面无法刷新</code></p>
<p><strong>1.登陆蚂蚁金服官网</strong> <a target="_blank" rel="noopener" href="https://www.antgroup.com/">https://www.antgroup.com/</a></p>
<hr>
<p><strong>2.划到尾页，点击支付宝开放平台</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221126177.png" alt="image-20201029103938947"></p>
<hr>
<p><strong>3.点击立即入驻（注册过的直接扫码登陆）</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221126728.png" alt="image-20201029104756001"></p>
<hr>
<p><strong>4.填写身份信息注册沙箱账号</strong></p>
<hr>
<p><strong>5.注册完跳转页面，选择沙箱</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221126480.png" alt="image-20201029105235780"></p>
<hr>
<p><strong>6.跳转页面，点击开放平台控制台</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221127450.png" alt="image-20201029105359667"></p>
<hr>
<p><strong>7.跳转登陆页面，扫码登陆</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221127976.png" alt="image-20201029105433185"></p>
<hr>
<p><strong>8.跳转页面，点击研发服务</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221127604.png" alt="image-20201029105527432"></p>
<hr>
<p><strong>9.沙箱页面</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221127030.png" alt="image-20211025212114663"></p>
<ul>
<li>==沙箱应用  个人app以及公钥私钥信息==</li>
<li>沙箱账号 商家和买家信息</li>
<li>沙箱工具 手机沙箱支付宝app</li>
</ul>
<hr>
<p><strong>10.此时需要设置公钥和私钥，点击设置沙箱应用 查看密钥</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221127040.png" alt="image-20211025212357088"></p>
<p>系统生成</p>
<ul>
<li><p>应用公钥不用</p>
</li>
<li><p>应用私钥和支付宝公钥放程序</p>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221127036.png" alt="image-20211025212504112"></p>
<hr>
<p><strong>11.需要的话可下载沙箱支付宝手机版，可扫码支付（账号密码查看沙箱账号）</strong></p>
<h3 id="集成项目"><a href="#集成项目" class="headerlink" title="集成项目"></a>集成项目</h3><p><strong>1.导入支付宝依赖</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alipay.sdk<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>alipay-sdk-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.8.10.ALL<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<p><strong>2.封装配置类 AlipayConfig.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AlipayConfig</span> </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 服务网关   沙箱环境都是这个  </span></span><br><span class="line"><span class="comment">     (去沙箱应用中复制该信息 沙箱应用/支付宝网关 )</span></span><br><span class="line"><span class="comment">   */</span>								</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> String serverUrl = <span class="string">&quot;https://openapi.alipaydev.com/gateway.do&quot;</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 应用id  后期可以替换成自己的id</span></span><br><span class="line"><span class="comment">   	(去沙箱应用中复制该信息 沙箱应用/APPID)</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> String appId = <span class="string">&quot;2016102500758175&quot;</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   RSA2密钥（公钥模式)</span></span><br><span class="line"><span class="comment">   应用私钥   后期替换成自己的私钥 </span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> String privateKey =<span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   *  发送数据的格式 目前只能为json</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> String format = <span class="string">&quot;json&quot;</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   *  设置字符集编码 目前只能为utf-8</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> String charset = <span class="string">&quot;utf-8&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  	  RSA2密钥（公钥模式)</span></span><br><span class="line"><span class="comment">     支付宝公钥 后期替换成自己的支付宝公钥 </span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> String publicKey = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   *  支付宝签名 目前是 RSA2</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> String signType = <span class="string">&quot;RSA2&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   *  页面跳转同步通知页面路径 需http://格式的完整路径，不能加?id=123这类自定义参数，必须外网可以正常访问</span></span><br><span class="line"><span class="comment">   *  付款结束后跳转的页面</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> String return_url = <span class="string">&quot;http://localhost:8080/estore_alipay/index.jsp&quot;</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> AlipayClient <span class="title">getAlipayClient</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="comment">// 获得初始化的AlipayClient</span></span><br><span class="line">      AlipayClient alipayClient = <span class="keyword">new</span> DefaultAlipayClient</span><br><span class="line">    		  (AlipayConfig.serverUrl, AlipayConfig.appId, </span><br><span class="line">    		AlipayConfig.privateKey, AlipayConfig.format, </span><br><span class="line">    		AlipayConfig.charset, AlipayConfig.publicKey, AlipayConfig.signType);</span><br><span class="line">      <span class="keyword">return</span> alipayClient;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<hr>
<p><strong>3.引入支付接口(注意配置访问路径)</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PayServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		doGet(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//拿到订单id</span></span><br><span class="line">	     String orderid = request.getParameter(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">		<span class="comment">//调用service去数据库中查询当前订单</span></span><br><span class="line">	     OrderServiceImpl ordImpl = <span class="keyword">new</span> OrderServiceImpl();</span><br><span class="line">	     OrderForm orderForm = </span><br><span class="line">	    		 ordImpl.findOrderFormById(Integer.parseInt(orderid));</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//支付</span></span><br><span class="line">	    <span class="comment">//浏览器动态产生一个付钱的二维码</span></span><br><span class="line">	     <span class="comment">/**</span></span><br><span class="line"><span class="comment">	      * 需要将我们的项目接入支付宝</span></span><br><span class="line"><span class="comment">	      * 入驻蚂蚁金服平台</span></span><br><span class="line"><span class="comment">	      */</span></span><br><span class="line">	     </span><br><span class="line">	     <span class="keyword">try</span> &#123;</span><br><span class="line">	          AlipayClient alipayClient =</span><br><span class="line">	                  AlipayConfig.getAlipayClient();</span><br><span class="line">	          <span class="comment">//设置请求参数</span></span><br><span class="line">	          AlipayTradePagePayRequest alipayRequest = </span><br><span class="line">	                  <span class="keyword">new</span> AlipayTradePagePayRequest();</span><br><span class="line">	          </span><br><span class="line">	          AlipayTradePayModel model = </span><br><span class="line">	                  <span class="keyword">new</span> AlipayTradePayModel();</span><br><span class="line">	          <span class="comment">// 设定订单号 必须要写,且订单号不能重复，目前已经只是做测试，已经写死</span></span><br><span class="line">	          model.setOutTradeNo(System.currentTimeMillis()+<span class="string">&quot;&quot;</span>);</span><br><span class="line">	          <span class="comment">// 设置订单金额</span></span><br><span class="line">	          model.setTotalAmount(orderForm.getCost()+<span class="string">&quot;&quot;</span>);</span><br><span class="line">	          <span class="comment">// 订单名字</span></span><br><span class="line">	          model.setSubject(<span class="string">&quot;书籍订单&quot;</span>);</span><br><span class="line">	          <span class="comment">// 订单描述</span></span><br><span class="line">	          model.setBody(System.currentTimeMillis()+<span class="string">&quot;&quot;</span>);</span><br><span class="line">	          <span class="comment">// 产品码</span></span><br><span class="line">	          model.setProductCode(<span class="string">&quot;FAST_INSTANT_TRADE_PAY&quot;</span>);</span><br><span class="line">	          <span class="comment">// 设置参数</span></span><br><span class="line">	          alipayRequest.setBizModel(model);</span><br><span class="line">	          <span class="comment">// 设置回调地址</span></span><br><span class="line">	          alipayRequest.setReturnUrl(AlipayConfig.return_url);</span><br><span class="line">	          String result = alipayClient.pageExecute(alipayRequest).getBody();</span><br><span class="line">	          response.setContentType(<span class="string">&quot;text/html;charset=utf-8&quot;</span>);</span><br><span class="line">	          response.getWriter().println(result);</span><br><span class="line">	      &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">	              e.printStackTrace();</span><br><span class="line">	      &#125;  </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<hr>
<p><strong>4.此时需要添加业务 根据id查看订单信息</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> OrderForm <span class="title">findOrderFormById</span><span class="params">(<span class="keyword">int</span> parseInt)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> orderFormMapper.findOrderFormById(parseInt);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findOrderFormById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.briup.bean.OrderForm&quot;</span>&gt;</span></span><br><span class="line">         select *  from es_orderform</span><br><span class="line">        where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>



<hr>
<p><strong>5.修改提交订单接口</strong></p>
<p>==先跳转到支付页面 支付完成回调订单列表==</p>
<p>支付方案</p>
<ul>
<li>下单再减库存(此处采用这种方式)</li>
<li>支付再减库存</li>
</ul>
<p><strong>SubmitOrderServlet</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//resp.sendRedirect(&quot;/findAllOrder&quot;);</span></span><br><span class="line"> resp.sendRedirect(<span class="string">&quot;/pay?id=&quot;</span>+orderForm.getId());</span><br></pre></td></tr></table></figure>

<hr>
<p><strong>AlipayConfig</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   *  页面跳转同步通知页面路径 需http://格式的完整路径，不能加?id=123这类自定义参数，必须外网可以正常访问</span></span><br><span class="line"><span class="comment">   *  付款结束后跳转的页面</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> String return_url = <span class="string">&quot;http://localhost:8888/findAllOrder&quot;</span>;</span><br></pre></td></tr></table></figure>



<hr>
<p><strong>6.效果</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221127045.png" alt="image-20211025211711375"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221127802.png" alt="image-20211025211419465"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore-out/202206221127996.png" alt="image-20211025211611145"></p>
<h2 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h2><h3 id="自动登录"><a href="#自动登录" class="headerlink" title="自动登录"></a>自动登录</h3><p>LoginServlet</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.estore.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.estore.constant.EstoreConstant;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.entity.Customer;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.service.IUserService;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.service.impl.UserServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.*;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse(lc))</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022/5/31-05-31-15:42</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：登录接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/userLogin&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserLoginServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 1.获取用户名和密码</span></span><br><span class="line">        String name = req.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        String password = req.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">        String auto = req.getParameter(<span class="string">&quot;auto&quot;</span>);</span><br><span class="line">        <span class="comment">// 2.调用service校验用户名和密码</span></span><br><span class="line">        IUserService userService = <span class="keyword">new</span> UserServiceImpl();</span><br><span class="line">        <span class="comment">// 3.跳转页面</span></span><br><span class="line">        String path = <span class="string">&quot;index.jsp&quot;</span>;</span><br><span class="line">        HttpSession session = req.getSession();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 登录成功  跳转首页(重定向)</span></span><br><span class="line">            Customer customer = userService.login(name, password);</span><br><span class="line">            session.setAttribute(<span class="string">&quot;customer&quot;</span>, customer);</span><br><span class="line">            <span class="comment">// 如果勾选了自动登录 写入cookie</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="string">&quot;true&quot;</span>.equals(auto))&#123;</span><br><span class="line">                Cookie nameCookie = <span class="keyword">new</span> Cookie(<span class="string">&quot;auto_name&quot;</span>,name);</span><br><span class="line">                nameCookie.setMaxAge(EstoreConstant.auto_max_time);</span><br><span class="line">                Cookie passwordCookie = <span class="keyword">new</span> Cookie(<span class="string">&quot;auto_password&quot;</span>,password);</span><br><span class="line">                passwordCookie.setMaxAge(EstoreConstant.auto_max_time);</span><br><span class="line">                resp.addCookie(nameCookie);</span><br><span class="line">                resp.addCookie(passwordCookie);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="comment">// 登录失败  重新登录(请求转发 提示信息)</span></span><br><span class="line">            path = <span class="string">&quot;login.jsp&quot;</span>;</span><br><span class="line">            session.setAttribute(<span class="string">&quot;error&quot;</span>, <span class="string">&quot;登录失败 &quot;</span> +e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        resp.sendRedirect(path);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>AutoLogin</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.estore.web.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.estore.entity.Customer;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.service.IUserService;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.service.impl.UserServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebFilter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.Cookie;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse(lc))</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022/6/14-06-14-11:26</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：自动登录</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebFilter(&quot;/*&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AutoLogin</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        HttpServletRequest req = (HttpServletRequest) request;</span><br><span class="line">        <span class="comment">// 勾选了自动登录后 会将用户写入到cookie中</span></span><br><span class="line">        <span class="comment">// 拦截器判断cookie中是否有cookie (cookie中默认有jsessionId)</span></span><br><span class="line">        Cookie[] cookies = req.getCookies();</span><br><span class="line">        <span class="keyword">if</span> (cookies != <span class="keyword">null</span> &amp;&amp; cookies.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            String nameCookie = <span class="keyword">null</span>;</span><br><span class="line">            String passwordCookie = <span class="keyword">null</span>;</span><br><span class="line">            IUserService userService = <span class="keyword">new</span> UserServiceImpl();</span><br><span class="line">            <span class="keyword">for</span> (Cookie cookie : cookies) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="string">&quot;auto_name&quot;</span>.equals(cookie.getName())) &#123;</span><br><span class="line">                    nameCookie = cookie.getValue();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (<span class="string">&quot;auto_password&quot;</span>.equals(cookie.getName())) &#123;</span><br><span class="line">                    passwordCookie = cookie.getValue();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (nameCookie != <span class="keyword">null</span> &amp;&amp; passwordCookie != <span class="keyword">null</span>) &#123;</span><br><span class="line">                Customer customerFromDB = userService.login(nameCookie, passwordCookie);</span><br><span class="line">                req.getSession().setAttribute(<span class="string">&quot;customer&quot;</span>, customerFromDB);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 如果有cookie.获取cookie中的值 并存入session中</span></span><br><span class="line">        chain.doFilter(request, response);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h3 id="事务拦截"><a href="#事务拦截" class="headerlink" title="事务拦截"></a>事务拦截</h3><p><strong>MyBatisSqlSessionFactory</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.estore.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBatisSqlSessionFactory</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> ThreadLocal&lt;SqlSession&gt; threadLocal = <span class="keyword">new</span> ThreadLocal&lt;&gt;();</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> SqlSessionFactory sqlSessionFactory;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SqlSessionFactory <span class="title">getSqlSessionFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>(sqlSessionFactory==<span class="keyword">null</span>) &#123;</span><br><span class="line">			InputStream inputStream = <span class="keyword">null</span>;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				inputStream = Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line">				sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);</span><br><span class="line">			&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> sqlSessionFactory;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SqlSession <span class="title">openSession</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		SqlSession session = threadLocal.get();</span><br><span class="line">		<span class="keyword">if</span> (session == <span class="keyword">null</span>) &#123;</span><br><span class="line">			session = openSession(<span class="keyword">false</span>);</span><br><span class="line">			threadLocal.set(session);</span><br><span class="line">		&#125;</span><br><span class="line"> 		<span class="keyword">return</span> session;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 关闭连接</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">closeSession</span><span class="params">()</span></span>&#123;</span><br><span class="line">		SqlSession session = threadLocal.get();</span><br><span class="line">		<span class="keyword">if</span> (session != <span class="keyword">null</span>) &#123;</span><br><span class="line">			session.close();</span><br><span class="line">			threadLocal.remove();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SqlSession <span class="title">openSession</span><span class="params">(<span class="keyword">boolean</span> autoCommit)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> getSqlSessionFactory().openSession(autoCommit);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>TransactionFilter</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.estore.web.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.estore.utils.MyBatisSqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebFilter;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse(lc))</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022/6/14-06-14-16:41</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：事务过滤器(提交事务 回滚事务 关闭会话)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebFilter(&quot;/*&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TransactionFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        <span class="comment">// 手动提交</span></span><br><span class="line">        SqlSession session = MyBatisSqlSessionFactory.openSession();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 执行对应代码</span></span><br><span class="line">            chain.doFilter(request,response);</span><br><span class="line">            <span class="comment">// 提交事务</span></span><br><span class="line">            session.commit();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// 事务归滚</span></span><br><span class="line">            session.rollback();</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 关闭session</span></span><br><span class="line">            MyBatisSqlSessionFactory.closeSession();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>使用</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.estore.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.estore.entity.Customer;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.service.IUserService;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.service.impl.UserServiceImpl;</span><br><span class="line"><span class="keyword">import</span> org.apache.taglibs.standard.tag.common.sql.DataSourceUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse(lc))</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022/5/31-05-31-10:33</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>： 用户注册接口 (接收/响应数据)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/userRegister&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserRegisterServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 1.接收参数 并封装Customer对象</span></span><br><span class="line">        String name = req.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        String password = req.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">        String zipCode = req.getParameter(<span class="string">&quot;zipCode&quot;</span>);</span><br><span class="line">        String address = req.getParameter(<span class="string">&quot;address&quot;</span>);</span><br><span class="line">        String telephone = req.getParameter(<span class="string">&quot;telephone&quot;</span>);</span><br><span class="line">        String email = req.getParameter(<span class="string">&quot;email&quot;</span>);</span><br><span class="line">        Customer customer = <span class="keyword">new</span> Customer(name,password,zipCode,address,telephone,email);</span><br><span class="line">        <span class="comment">// 2.交给service判断 用户名不能为空</span></span><br><span class="line">        IUserService userService = <span class="keyword">new</span> UserServiceImpl();</span><br><span class="line">        <span class="comment">// 3.判断是否注册成功</span></span><br><span class="line">        String path=<span class="string">&quot;login.jsp&quot;</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            userService.register(customer);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace(); <span class="comment">// 打印异常信息</span></span><br><span class="line">            <span class="comment">// 失败 重新注册  请求转发</span></span><br><span class="line">            <span class="comment">// 将该错误信息存到request中,将来页面取出</span></span><br><span class="line">            req.getSession().setAttribute(<span class="string">&quot;error&quot;</span>,<span class="string">&quot;注册失败 &quot;</span> +e.getMessage());</span><br><span class="line">            path = <span class="string">&quot;register.jsp&quot;</span>;</span><br><span class="line">            <span class="comment">// 事务可以向上抛 并回滚,但是页面不正常跳转了</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 确保是否发生异常 都会正常执行</span></span><br><span class="line">            resp.sendRedirect(path);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意 try catch finally块,确保事务和页面跳转能够正常运转</p>
</blockquote>
<p><strong>service层模拟异常</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.estore.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.estore.dao.ICustomerDao;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.entity.Customer;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.service.IUserService;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.utils.MD5Util;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.utils.MyBatisSqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse(lc))</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022/5/31-05-31-11:01</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：顾客业务实现</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">IUserService</span> </span>&#123;</span><br><span class="line">    SqlSession session = MyBatisSqlSessionFactory.openSession();</span><br><span class="line">    ICustomerDao customerDao = session.getMapper(ICustomerDao.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(Customer customer)</span> </span>&#123;</span><br><span class="line">        String name = customer.getName();</span><br><span class="line">        <span class="comment">// 1.校验用户</span></span><br><span class="line">            <span class="comment">// 1.用户名不能为空</span></span><br><span class="line">        <span class="keyword">if</span> (name == <span class="keyword">null</span> || <span class="string">&quot;&quot;</span>.equals(name.trim())) &#123;</span><br><span class="line">            <span class="comment">// 参数是message new RuntimeException(message);</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;用户名不能为空&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">            <span class="comment">// 2.用户名不能已经在数据库存在 (携带用户名去数据库查)</span></span><br><span class="line">        Customer cusomerFromDB = findByName(name);</span><br><span class="line">        <span class="keyword">if</span> (cusomerFromDB != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;用户名已经存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 2.注册用户(调用dao)</span></span><br><span class="line">        <span class="comment">// 加密</span></span><br><span class="line">        customer.setPassword(MD5Util.encode(customer.getPassword()));</span><br><span class="line">        customerDao.register(customer);</span><br><span class="line"><span class="comment">//        int i = 1/0;</span></span><br><span class="line">        <span class="comment">// 注意事务的提交</span></span><br><span class="line">        <span class="comment">//session.commit();</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name 用户名称</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 该用户对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Customer <span class="title">findByName</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">        <span class="comment">// 去数据库查</span></span><br><span class="line">        <span class="keyword">return</span> customerDao.findByName(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 登录功能</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name 用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password 密码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 用户对象   select * from es_user where username=#&#123;&#125; and password=#&#123;&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Customer <span class="title">login</span><span class="params">(String name, String password)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 用户名不对(带着用户名去找 是否有, 没有则用户名不对)</span></span><br><span class="line">        Customer customerFromDB = findByName(name);</span><br><span class="line">        <span class="keyword">if</span> (customerFromDB == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;用户名有误&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 密码不对(比较页面传的密码和查出来的对象的密码)</span></span><br><span class="line">        <span class="keyword">if</span>(!MD5Util.encode(password).equals(customerFromDB.getPassword()))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;密码有误&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> customerFromDB;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="导出数据"><a href="#导出数据" class="headerlink" title="导出数据"></a>导出数据</h3><p><strong>orderList.jsp</strong></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--头部导航--&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;nav_top&quot;</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;nav_top_center&quot;</span>&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            订单列表</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;%--&lt;input type=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;导出&quot;</span> onclick=<span class="string">&quot;exportData()&quot;</span>&gt;--%&gt;</span><br><span class="line">            &lt;span style=<span class="string">&quot;font-size:14px;font-weight: bold;color: #FFF&quot;</span> onclick=<span class="string">&quot;exportData()&quot;</span>&gt;导出&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>





<p><strong>OrderListExport</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.estore.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.collection.CollUtil;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.poi.excel.ExcelUtil;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.poi.excel.ExcelWriter;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.dto.ExportData;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.entity.Customer;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.entity.OrderForm;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.service.IOrderService;</span><br><span class="line"><span class="keyword">import</span> com.briup.estore.service.impl.OrderServieImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse(lc))</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022/6/14-06-14-9:20</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：导出excel表格</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/exportData&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderListExport</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        Customer customer = (Customer) req.getSession().getAttribute(<span class="string">&quot;customer&quot;</span>);</span><br><span class="line">        IOrderService orderService = <span class="keyword">new</span> OrderServieImpl();</span><br><span class="line">        List&lt;OrderForm&gt; orderFormList = orderService.findOrderListByCid(customer.getId());</span><br><span class="line">        List&lt;ExportData&gt; exportDataList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        orderFormList.forEach(orderForm -&gt; &#123;</span><br><span class="line">            ExportData exportData = <span class="keyword">new</span> ExportData();</span><br><span class="line">            exportData.setOrderId(orderForm.getId());</span><br><span class="line">            exportData.setCost(orderForm.getCost());</span><br><span class="line">            exportData.setOrderDate(orderForm.getOrderdate());</span><br><span class="line">            exportData.setReceiveName(orderForm.getShopAddress().getReceiveName());</span><br><span class="line">            exportDataList.add(exportData);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ArrayList&lt;ExportData&gt; rows = CollUtil.newArrayList(exportDataList);</span><br><span class="line">            <span class="comment">// 通过工具类创建writer</span></span><br><span class="line">            <span class="keyword">long</span> time = System.currentTimeMillis();</span><br><span class="line">            ExcelWriter writer = ExcelUtil.getWriter(<span class="string">&quot;d:/order-&quot;</span>+time+<span class="string">&quot;.xlsx&quot;</span>);</span><br><span class="line"><span class="comment">//        ExcelWriter writer = ExcelUtil.getWriter();</span></span><br><span class="line">            <span class="comment">// 合并单元格后的标题行，使用默认标题样式</span></span><br><span class="line">            writer.merge(<span class="number">3</span>, <span class="string">&quot;账单&quot;</span>);</span><br><span class="line">            <span class="comment">// 一次性写出内容，使用默认样式，强制输出标题</span></span><br><span class="line">            writer.write(rows, <span class="keyword">true</span>);</span><br><span class="line">            <span class="comment">// 关闭writer，释放内存</span></span><br><span class="line">            writer.close();</span><br><span class="line"></span><br><span class="line">            resp.setContentType(<span class="string">&quot;text/plain;charset=utf-8&quot;</span>);</span><br><span class="line">            resp.getWriter().write(<span class="string">&quot;导出成功&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            resp.getWriter().write(<span class="string">&quot;导出失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        doGet(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h3 id="抽取servlet"><a href="#抽取servlet" class="headerlink" title="抽取servlet"></a>抽取servlet</h3><h3 id="…"><a href="#…" class="headerlink" title="…"></a>…</h3> 
      <!-- reward -->
      
      <div id="reword-out">
        <div id="reward-btn">
          打赏
        </div>
      </div>
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/project/" rel="tag">project</a></li></ul>

    </footer>
  </div>

   
  
   
<div class="gitalk" id="gitalk-container"></div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css">


<script src="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js"></script>


<script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script>

<script type="text/javascript">
  var gitalk = new Gitalk({
    clientID: 'abdf20cf8f71fc88e695',
    clientSecret: '050f9f7209fbd2e9f446fb0ade695e4e5dd12e84',
    repo: 'hexo_comment',
    owner: 'wangsidandan',
    admin: ['wangsidandan'],
    // id: location.pathname,      // Ensure uniqueness and length less than 50
    id: md5(location.pathname),
    distractionFreeMode: false,  // Facebook-like distraction free mode
    pagerDirection: 'last'
  })

  gitalk.render('gitalk-container')
</script>

     
</article>

</section>
      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2015-2022
        <i class="ri-heart-fill heart_icon"></i> vanse
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>访问人数:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>浏览次数:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.svg" alt="vanse"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/playlist">音乐</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/photos">相册</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/friends">友链</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="https://gitee.com/vanse/images/raw/master/bruip_course/aliapy.png">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="https://gitee.com/vanse/images/raw/master/bruip_course/wechat.png">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->
 
<script src="/js/tocbot.min.js"></script>

<script>
  tocbot.init({
    tocSelector: ".tocbot",
    contentSelector: ".article-entry",
    headingSelector: "h1, h2, h3, h4, h5, h6",
    hasInnerContainers: true,
    scrollSmooth: true,
    scrollContainer: "main",
    positionFixedSelector: ".tocbot",
    positionFixedClass: "is-position-fixed",
    fixedSidebarOffset: "auto",
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script>

<script src="/js/clickBoom1.js"></script>
 
<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->
 
<script src="/js/dz.js"></script>
 
<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    <div id="music">
    
    
    
    <iframe frameborder="no" border="1" marginwidth="0" marginheight="0" width="200" height="52"
        src="//music.163.com/outchain/player?type=2&id=506654324&auto=0&height=32"></iframe>
</div>

<style>
    #music {
        position: fixed;
        right: 15px;
        bottom: 0;
        z-index: 998;
    }
</style>
    
    
<script>
  const password = "vanse";
  const lock_password = window.sessionStorage.getItem("lock_password");
  console.log(password, lock_password);
  if (lock_password !== password) {
    Swal.fire({
      title: "请输入访问密码",
      input: "password",
      inputAttributes: {
        autocapitalize: "off",
      },
      showCancelButton: false,
      showLoaderOnConfirm: true,
      allowOutsideClick: false,
      confirmButtonText: "确定",
    }).then((result) => {
      console.log(result);
      if (result.isConfirmed) {
        console.log(password);
        if (result.value === password) {
          window.sessionStorage.setItem("lock_password", result.value);
        } else {
          Swal.fire({
            icon: "error",
            title: "密码错误，请重试",
            confirmButtonText: "确定",
            allowOutsideClick: false,
          }).then(() => {
            window.location.reload();
          });
        }
      }
    });
  }
</script>


  </div>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>

</html>