<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
        
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title>briup-estore |  vanse</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/favicon.ico" />
       
<link rel="stylesheet" href="/dist/main.css">

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/css/remixicon.min.css"
      />
      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
       
 

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    </head>
  </html>
</html>


<body>
  <div id="app">
    
      <canvas class="fireworks"></canvas>
      <style>
        .fireworks {
          position: fixed;
          left: 0;
          top: 0;
          z-index: 99999;
          pointer-events: none;
        }
      </style>
      
      
    <main class="content on">
      <section class="outer">
  <article
  id="post-project/briup-estore"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h1 class="article-title sea-center" style="border-left:0" itemprop="name">
  briup-estore
</h1>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/archives/project/briup-estore.html" class="article-date">
  <time datetime="2022-05-30T23:35:48.000Z" itemprop="datePublished">2022-05-31</time>
</a>   
<div class="word_count">
    <span class="post-time">
        <span class="post-meta-item-icon">
            <i class="ri-quill-pen-line"></i>
            <span class="post-meta-item-text"> 字数统计:</span>
            <span class="post-count">17.4k</span>
        </span>
    </span>

    <span class="post-time">
        &nbsp; | &nbsp;
        <span class="post-meta-item-icon">
            <i class="ri-book-open-line"></i>
            <span class="post-meta-item-text"> 阅读时长≈</span>
            <span class="post-count">95 分钟</span>
        </span>
    </span>
</div>
 
    </div>
     
	
	 
		 
			
				
    <div class="tocbot"></div>




   
			 
		
		
		 
	
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="0-前言"><a href="#0-前言" class="headerlink" title="0 前言"></a>0 前言</h1><ul>
<li>项目: 网上书城</li>
<li>开发工具: idea2019</li>
<li>环境: jdk8/mysql5.5</li>
<li>技术: servlet+mybatis</li>
<li>班级: 山西农大2018</li>
<li>整理人: vanse(刘聪)</li>
</ul>
<p><strong>项目完成度</strong></p>
<ul>
<li><input checked="" disabled="" type="checkbox"> 业务流程</li>
<li><input disabled="" type="checkbox"> 首页相关功能</li>
<li><input checked="" disabled="" type="checkbox"> 沙箱支付</li>
<li><input checked="" disabled="" type="checkbox"> linux部署</li>
</ul>
<h1 id="1-项目分析"><a href="#1-项目分析" class="headerlink" title="1 项目分析"></a>1 项目分析</h1><h2 id="表分析"><a href="#表分析" class="headerlink" title="表分析"></a>表分析</h2><blockquote>
<p>所有表都没有物理外键，而是逻辑外键</p>
</blockquote>
<h3 id="es-customer"><a href="#es-customer" class="headerlink" title="es_customer"></a>es_customer</h3><ul>
<li>顾客表 一个顾客有一个地址</li>
</ul>
<h3 id="es-shopaddress"><a href="#es-shopaddress" class="headerlink" title="es_shopaddress"></a>es_shopaddress</h3><ul>
<li>地址表 顾客外键</li>
</ul>
<h3 id="es-category"><a href="#es-category" class="headerlink" title="es_category"></a>es_category</h3><ul>
<li>商品分类表 一个分类有多个商品</li>
<li>一级分类/二级分类(自关联)<ul>
<li>二级分类的parentId是一级分类的id</li>
<li>一级分类: ==select * from category where parent_id = 0==</li>
<li>二级分类: ==select * from category where parent_id = 一级分类id*==</li>
</ul>
</li>
</ul>
<h3 id="es-book"><a href="#es-book" class="headerlink" title="es_book"></a>es_book</h3><ul>
<li>商品表  分类外键</li>
</ul>
<h3 id="es-orderline"><a href="#es-orderline" class="headerlink" title="es_orderline"></a>es_orderline</h3><ul>
<li>订单项 购买一次就是一个订单项</li>
</ul>
<h3 id="es-order"><a href="#es-order" class="headerlink" title="es_order"></a>es_order</h3><ul>
<li>订单 一个订单有多个订单项</li>
</ul>
<h3 id="导入表"><a href="#导入表" class="headerlink" title="导入表"></a>导入表</h3><p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310737123.png" alt="image-20210909101745687"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS<span class="operator">=</span><span class="number">0</span>;</span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for es_customer</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `es_customer`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `es_customer` (</span><br><span class="line">	`id` <span class="type">int</span>(<span class="number">7</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;客户id&#x27;</span>,</span><br><span class="line">	`name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;客户名字&#x27;</span>,</span><br><span class="line">	`password` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;客户密码&#x27;</span>,</span><br><span class="line">	`zipCode` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;客户邮编&#x27;</span>,</span><br><span class="line">	`address` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;客户地址&#x27;</span>,</span><br><span class="line">	`telephone` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;客户电话&#x27;</span>,</span><br><span class="line">	`email` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;客户邮箱&#x27;</span>,</span><br><span class="line">	<span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">	)ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">22</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for es_book</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `es_book`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `es_book` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;书籍编号&#x27;</span>,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;书籍名字&#x27;</span>,</span><br><span class="line">  `price` <span class="keyword">double</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;书籍价格&#x27;</span>,</span><br><span class="line">  `author` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;书籍作者&#x27;</span>,</span><br><span class="line">  `publisher` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;书籍出版社&#x27;</span>,</span><br><span class="line">  `pubDate` <span class="type">date</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;发布时间&#x27;</span>,</span><br><span class="line">  `description` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;书籍描述&#x27;</span>,</span><br><span class="line">  `category_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;分类id&#x27;</span>,</span><br><span class="line">  `image` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;书籍图片&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">22</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Records of es_book</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_book` <span class="keyword">VALUES</span> (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;别做傻瓜&#x27;</span>, <span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;作者张三&#x27;</span>, <span class="string">&#x27;清华大学出版社&#x27;</span>, <span class="string">&#x27;2010-10-07&#x27;</span>, <span class="string">&#x27;文学1类&#x27;</span>, <span class="string">&#x27;8&#x27;</span>,<span class="string">&#x27;bookcover/别做傻瓜.jpg&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_book` <span class="keyword">VALUES</span> (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;沉思录&#x27;</span>, <span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;作者张三&#x27;</span>, <span class="string">&#x27;长春工业出版社&#x27;</span>, <span class="string">&#x27;2010-10-07&#x27;</span>, <span class="string">&#x27;文学2类&#x27;</span>, <span class="string">&#x27;9&#x27;</span>,<span class="string">&#x27;bookcover/沉思录.jpg&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_book` <span class="keyword">VALUES</span> (<span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;感悟&#x27;</span>, <span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;作者张三&#x27;</span>, <span class="string">&#x27;清华大学出版社&#x27;</span>, <span class="string">&#x27;2010-10-07&#x27;</span>, <span class="string">&#x27;文学3类&#x27;</span>, <span class="string">&#x27;10&#x27;</span>,<span class="string">&#x27;bookcover/感悟.jpg&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_book` <span class="keyword">VALUES</span> (<span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;谁动了我的奶酪&#x27;</span>, <span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;作者张三&#x27;</span>, <span class="string">&#x27;长春工业出版社&#x27;</span>, <span class="string">&#x27;2010-10-07&#x27;</span>, <span class="string">&#x27;社会科学1类&#x27;</span>, <span class="string">&#x27;11&#x27;</span>,<span class="string">&#x27;bookcover/谁动了我的奶酪.jpg&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_book` <span class="keyword">VALUES</span> (<span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;大勇和小花&#x27;</span>, <span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;作者张三&#x27;</span>, <span class="string">&#x27;清华大学出版社&#x27;</span>, <span class="string">&#x27;2010-10-07&#x27;</span>, <span class="string">&#x27;社会科学2类&#x27;</span>, <span class="string">&#x27;12&#x27;</span>,<span class="string">&#x27;bookcover/大勇和小花.jpg&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_book` <span class="keyword">VALUES</span> (<span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;学会宽容&#x27;</span>, <span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;作者张三&#x27;</span>, <span class="string">&#x27;北京大学出版社&#x27;</span>, <span class="string">&#x27;2010-10-07&#x27;</span>, <span class="string">&#x27;社会科学3类&#x27;</span>, <span class="string">&#x27;13&#x27;</span>,<span class="string">&#x27;bookcover/学会宽容.jpg&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_book` <span class="keyword">VALUES</span> (<span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;大勇和小花的欧洲日记&#x27;</span>, <span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;作者张三&#x27;</span>, <span class="string">&#x27;四川大学出版社&#x27;</span>, <span class="string">&#x27;2010-10-07&#x27;</span>, <span class="string">&#x27;小说1类&#x27;</span>, <span class="string">&#x27;14&#x27;</span>,<span class="string">&#x27;bookcover/大勇和小花的欧洲日记.jpg&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_book` <span class="keyword">VALUES</span> (<span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;培育男孩&#x27;</span>, <span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;作者张三&#x27;</span>, <span class="string">&#x27;西安交大出版社&#x27;</span>, <span class="string">&#x27;2007-10-07&#x27;</span>, <span class="string">&#x27;小说2类&#x27;</span>, <span class="string">&#x27;15&#x27;</span>,<span class="string">&#x27;bookcover/培育男孩.jpg&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_book` <span class="keyword">VALUES</span> (<span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;鱼的意大利旅行&#x27;</span>, <span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;作者张三&#x27;</span>, <span class="string">&#x27;北京大学出版社&#x27;</span>, <span class="string">&#x27;2010-10-07&#x27;</span>, <span class="string">&#x27;小说3类&#x27;</span>, <span class="string">&#x27;16&#x27;</span>,<span class="string">&#x27;bookcover/鱼的意大利旅行.jpg&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_book` <span class="keyword">VALUES</span> (<span class="string">&#x27;10&#x27;</span>, <span class="string">&#x27;嵌入式Linux&#x27;</span>, <span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;作者张三&#x27;</span>, <span class="string">&#x27;北京工业大学出版社&#x27;</span>, <span class="string">&#x27;2010-10-07&#x27;</span>, <span class="string">&#x27;计算机1类&#x27;</span>, <span class="string">&#x27;17&#x27;</span>,<span class="string">&#x27;bookcover/嵌入式Linux.jpg&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_book` <span class="keyword">VALUES</span> (<span class="string">&#x27;11&#x27;</span>, <span class="string">&#x27;数据库原理&#x27;</span>, <span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;作者张三&#x27;</span>, <span class="string">&#x27;厦门大学出版社&#x27;</span>, <span class="string">&#x27;2009-10-07&#x27;</span>, <span class="string">&#x27;计算机2类&#x27;</span>, <span class="string">&#x27;18&#x27;</span>, <span class="string">&#x27;bookcover/数据库原理.jpg&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_book` <span class="keyword">VALUES</span> (<span class="string">&#x27;12&#x27;</span>, <span class="string">&#x27;深入浅出Oracle&#x27;</span>, <span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;作者张三&#x27;</span>, <span class="string">&#x27;北京大学出版社&#x27;</span>, <span class="string">&#x27;2010-10-07&#x27;</span>, <span class="string">&#x27;计算机3类&#x27;</span>, <span class="string">&#x27;19&#x27;</span>,<span class="string">&#x27;bookcover/深入浅出Oracle.jpg&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_book` <span class="keyword">VALUES</span> (<span class="string">&#x27;13&#x27;</span>, <span class="string">&#x27;杜拉拉&#x27;</span>, <span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;作者张三&#x27;</span>, <span class="string">&#x27;上海交大出版社&#x27;</span>, <span class="string">&#x27;2010-10-07&#x27;</span>, <span class="string">&#x27;传记1类&#x27;</span>, <span class="string">&#x27;20&#x27;</span>,<span class="string">&#x27;bookcover/杜拉拉.jpg&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_book` <span class="keyword">VALUES</span> (<span class="string">&#x27;14&#x27;</span>, <span class="string">&#x27;oneplant&#x27;</span>, <span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;作者张三&#x27;</span>, <span class="string">&#x27;北京工业大学出版社&#x27;</span>, <span class="string">&#x27;2015-10-07&#x27;</span>, <span class="string">&#x27;传记2类&#x27;</span>, <span class="string">&#x27;21&#x27;</span>,<span class="string">&#x27;bookcover/oneplant.jpg&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_book` <span class="keyword">VALUES</span> (<span class="string">&#x27;15&#x27;</span>, <span class="string">&#x27;大勇和小花&#x27;</span>, <span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;作者张三&#x27;</span>, <span class="string">&#x27;中南大学出版社&#x27;</span>, <span class="string">&#x27;2010-10-07&#x27;</span>, <span class="string">&#x27;传记3类&#x27;</span>, <span class="string">&#x27;22&#x27;</span>,<span class="string">&#x27;bookcover/大勇和小花.jpg&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_book` <span class="keyword">VALUES</span> (<span class="string">&#x27;16&#x27;</span>, <span class="string">&#x27;搭地铁玩上海&#x27;</span>, <span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;作者张三&#x27;</span>, <span class="string">&#x27;复旦大学出版社&#x27;</span>, <span class="string">&#x27;2017-10-07&#x27;</span>, <span class="string">&#x27;历史1类&#x27;</span>, <span class="string">&#x27;23&#x27;</span>,<span class="string">&#x27;bookcover/搭地铁玩上海.jpg&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_book` <span class="keyword">VALUES</span> (<span class="string">&#x27;17&#x27;</span>, <span class="string">&#x27;中国国家地理&#x27;</span>, <span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;作者张三&#x27;</span>, <span class="string">&#x27;中国海洋大学出版社&#x27;</span>, <span class="string">&#x27;2022-10-07&#x27;</span>, <span class="string">&#x27;历史2类&#x27;</span>, <span class="string">&#x27;24&#x27;</span>,<span class="string">&#x27;bookcover/中国国家地理.jpg&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_book` <span class="keyword">VALUES</span> (<span class="string">&#x27;18&#x27;</span>, <span class="string">&#x27;中国自主游&#x27;</span>, <span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;作者张三&#x27;</span>, <span class="string">&#x27;华中师范出版社&#x27;</span>, <span class="string">&#x27;2010-10-07&#x27;</span>, <span class="string">&#x27;历史3类&#x27;</span>, <span class="string">&#x27;25&#x27;</span>,<span class="string">&#x27;bookcover/中国自主游.jpg&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_book` <span class="keyword">VALUES</span> (<span class="string">&#x27;19&#x27;</span>, <span class="string">&#x27;Don\&#x27;</span>tMakeMeThink<span class="string">&#x27;, &#x27;</span><span class="number">20</span><span class="string">&#x27;, &#x27;</span>作者张三<span class="string">&#x27;, &#x27;</span>复旦大学出版社<span class="string">&#x27;, &#x27;</span><span class="number">2010</span><span class="number">-10</span><span class="number">-07</span><span class="string">&#x27;, &#x27;</span>文学<span class="number">1</span>类<span class="string">&#x27;, &#x27;</span><span class="number">26</span><span class="string">&#x27;,&#x27;</span>bookcover<span class="operator">/</span>Don\<span class="string">&#x27;tMakeMeThink.jpg&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_book` <span class="keyword">VALUES</span> (<span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;CodeGreen&#x27;</span>, <span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;作者张三&#x27;</span>, <span class="string">&#x27;华中师范出版社&#x27;</span>, <span class="string">&#x27;2010-10-07&#x27;</span>, <span class="string">&#x27;文学2类&#x27;</span>, <span class="string">&#x27;27&#x27;</span>,<span class="string">&#x27;bookcover/CodeGreen.jpg&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_book` <span class="keyword">VALUES</span> (<span class="string">&#x27;21&#x27;</span>, <span class="string">&#x27;travelbook&#x27;</span>, <span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;作者张三&#x27;</span>, <span class="string">&#x27;中国海洋大学出版社&#x27;</span>, <span class="string">&#x27;2010-10-07&#x27;</span>, <span class="string">&#x27;文学3类&#x27;</span>, <span class="string">&#x27;28&#x27;</span>,<span class="string">&#x27;bookcover/travelbook.jpg&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for es_category</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `es_category`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `es_category` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;书籍分类id&#x27;</span>,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;书籍分类名字&#x27;</span>,</span><br><span class="line">  `description` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;书籍分类描述&#x27;</span>,</span><br><span class="line">  `parent_id` <span class="type">int</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;父类id&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  KEY `parent_id` (`parent_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">29</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Records of es_category</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;文学&#x27;</span>, <span class="string">&#x27;文学的描述&#x27;</span>, <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;社会科学&#x27;</span>, <span class="string">&#x27;社会科学的描述&#x27;</span>, <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;计算机与互联网&#x27;</span>, <span class="string">&#x27;计算机与互联网的描述&#x27;</span>, <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;小说&#x27;</span>, <span class="string">&#x27;小说的描述&#x27;</span>, <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;传记&#x27;</span>, <span class="string">&#x27;传记的描述&#x27;</span>, <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;历史&#x27;</span>, <span class="string">&#x27;历史的描述&#x27;</span>, <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;医学&#x27;</span>, <span class="string">&#x27;医学的描述&#x27;</span>, <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;文学1类&#x27;</span>, <span class="string">&#x27;文学1类的描述&#x27;</span>, <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;文学2类&#x27;</span>, <span class="string">&#x27;文学2类的描述&#x27;</span>, <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;10&#x27;</span>, <span class="string">&#x27;文学3类&#x27;</span>, <span class="string">&#x27;文学3类的描述&#x27;</span>, <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;11&#x27;</span>, <span class="string">&#x27;社会科学1&#x27;</span>, <span class="string">&#x27;社会科学1类的描述&#x27;</span>, <span class="string">&#x27;2&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;12&#x27;</span>, <span class="string">&#x27;社会科学2&#x27;</span>, <span class="string">&#x27;社会科学2类的描述&#x27;</span>, <span class="string">&#x27;2&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;13&#x27;</span>, <span class="string">&#x27;社会科学3&#x27;</span>, <span class="string">&#x27;社会科学3类的描述&#x27;</span>, <span class="string">&#x27;2&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;14&#x27;</span>, <span class="string">&#x27;小说1&#x27;</span>, <span class="string">&#x27;小说1类的描述&#x27;</span>, <span class="string">&#x27;3&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;15&#x27;</span>, <span class="string">&#x27;小说2&#x27;</span>, <span class="string">&#x27;小说2类的描述&#x27;</span>, <span class="string">&#x27;3&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;16&#x27;</span>, <span class="string">&#x27;小说3&#x27;</span>, <span class="string">&#x27;小说3类的描述&#x27;</span>, <span class="string">&#x27;3&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;17&#x27;</span>, <span class="string">&#x27;计算机1&#x27;</span>, <span class="string">&#x27;计算机1类的描述&#x27;</span>, <span class="string">&#x27;4&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;18&#x27;</span>, <span class="string">&#x27;计算机2&#x27;</span>, <span class="string">&#x27;计算机2类的描述&#x27;</span>, <span class="string">&#x27;4&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;19&#x27;</span>, <span class="string">&#x27;计算机3&#x27;</span>, <span class="string">&#x27;计算机3类的描述&#x27;</span>, <span class="string">&#x27;4&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;传记1&#x27;</span>, <span class="string">&#x27;传记1类的描述&#x27;</span>, <span class="string">&#x27;5&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;21&#x27;</span>, <span class="string">&#x27;传记2&#x27;</span>, <span class="string">&#x27;传记2类的描述&#x27;</span>, <span class="string">&#x27;5&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;22&#x27;</span>, <span class="string">&#x27;传记3&#x27;</span>, <span class="string">&#x27;传记3类的描述&#x27;</span>, <span class="string">&#x27;5&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;23&#x27;</span>, <span class="string">&#x27;历史类1&#x27;</span>, <span class="string">&#x27;历史1类的描述&#x27;</span>, <span class="string">&#x27;6&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;24&#x27;</span>, <span class="string">&#x27;历史类2&#x27;</span>, <span class="string">&#x27;历史2类的描述&#x27;</span>, <span class="string">&#x27;6&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;25&#x27;</span>, <span class="string">&#x27;历史类3&#x27;</span>, <span class="string">&#x27;历史3类的描述&#x27;</span>, <span class="string">&#x27;6&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;26&#x27;</span>, <span class="string">&#x27;医学类1&#x27;</span>, <span class="string">&#x27;医学类1的描述&#x27;</span>, <span class="string">&#x27;7&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;27&#x27;</span>, <span class="string">&#x27;医学类2&#x27;</span>, <span class="string">&#x27;医学2类的描述&#x27;</span>, <span class="string">&#x27;7&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;28&#x27;</span>, <span class="string">&#x27;医学类3&#x27;</span>, <span class="string">&#x27;医学3类的描述&#x27;</span>, <span class="string">&#x27;7&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for es_orderform</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `es_orderform`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `es_orderform` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;订单id&#x27;</span>,</span><br><span class="line">  `cost` <span class="keyword">double</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;订单花费&#x27;</span>,</span><br><span class="line">  `orderDate` <span class="type">date</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;订单时间&#x27;</span>,</span><br><span class="line">  `shopAddress_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;收获地址id&#x27;</span>,</span><br><span class="line">  `customer_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;客户id&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Records of es_orderform</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for es_orderLine</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `es_orderline`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `es_orderline` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;订单项id&#x27;</span>,</span><br><span class="line">  `num` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;商品数量&#x27;</span>,</span><br><span class="line">  `cost` <span class="keyword">double</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;订单项花费&#x27;</span>,</span><br><span class="line">  `book_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;书籍id&#x27;</span>,</span><br><span class="line">  `orderForm_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;订单id&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Records of es_orderLine</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for es_shopAddress</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `es_shopaddress`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `es_shopaddress` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;收货地址id&#x27;</span>,</span><br><span class="line">  `receiveName` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;收货人姓名&#x27;</span>,</span><br><span class="line">  `address` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;收获地址&#x27;</span>,</span><br><span class="line">  `phone` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;收获电话&#x27;</span>,</span><br><span class="line">  `customer_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;客户id&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------a</span></span><br><span class="line"><span class="comment">-- Records of es_shopddress</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h2><p>1.选择骨架</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310738044.png" alt="image-20210909102255356"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310738895.png" alt="image-20210909102357621"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310738269.png" alt="image-20210909102441644"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310738705.png" alt="image-20210909102503907"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310738548.png" alt="image-20210909102607551"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310738030.png" alt="image-20210909102802026"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310738488.png" alt="image-20210909102933930"></p>
<ul>
<li>java -&gt; Sources Root</li>
<li>resources-&gt; Resources Root</li>
</ul>
<p><code>2.pom.xml</code></p>
<blockquote>
<p>注意: 如果是mysql8 最好使用mysql8的驱动</p>
<p>同时: 驱动为 com.mysql.cj.jdbc.Driver</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.briup<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>estore-nongda<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>estore-nongda Maven Webapp<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 引入servlet3.1的依赖 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 引入jstl的依赖，jsp页面中会使用到 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 引入Mybatis的依赖 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 数据库mysql的驱动包依赖 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.38<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        &lt;dependency&gt;</span></span><br><span class="line"><span class="comment">            &lt;groupId&gt;com.oracle&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">            &lt;artifactId&gt;ojdbc8&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">            &lt;version&gt;8&lt;/version&gt;</span></span><br><span class="line"><span class="comment">        &lt;/dependency&gt;</span></span><br><span class="line"><span class="comment">         --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 日志框架log4j的依赖 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>完善结构</code></p>
<img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310738994.png" alt="image-20211025195927702" style="zoom:50%;" />





<h2 id="配置tomcat"><a href="#配置tomcat" class="headerlink" title="配置tomcat"></a>配置tomcat</h2><p><code>添加tomcat</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310738593.png" alt="image-20210909111027889"></p>
<p><code>部署项目到tomcat</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310738028.png" alt="image-20210909111300375"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310738875.png" alt="image-20210909111319079"></p>
<p><code>配置项目部署路径</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310738303.png" alt="image-20210909111353934"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310738305.png" alt="image-20210909111518671"></p>
<p><code>启动tomcat</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310738543.png" alt="image-20210909111604743"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310739392.png" alt="image-20210909144741405"></p>
<h1 id="2-顾客模块"><a href="#2-顾客模块" class="headerlink" title="2 顾客模块"></a>2 顾客模块</h1><h2 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h2><h3 id="分析"><a href="#分析" class="headerlink" title="==分析=="></a>==分析==</h3><ul>
<li>获取界面数据<ul>
<li>判断name是否为空</li>
<li>判断name是否存在</li>
</ul>
</li>
<li>注册用户<ul>
<li>正常: 跳转登录页面</li>
<li>错误: 获取错误信息,重新注册页面</li>
</ul>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310739162.png" alt="image-20210910094134124"></p>
<h3 id="RegisterServlet"><a href="#RegisterServlet" class="headerlink" title="RegisterServlet"></a>RegisterServlet</h3><blockquote>
<p>注意: 不同的请求方式可以访问同一接口有不同功能</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Customer;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.CustomerService;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.impl.CustomerServiceImpl;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.beanutils.BeanUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/9-09-09-14:13</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：注册API</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/register&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RegisterServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="comment">// get 访问regiser 跳转register.jsp页面</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        req.getRequestDispatcher(<span class="string">&quot;/register.jsp&quot;</span>).forward(req,resp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// post访问regiser 提交数据</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 获取customer数据</span></span><br><span class="line">       <span class="comment">// String name = req.getParameter(&quot;name&quot;);</span></span><br><span class="line">        Map&lt;String, String[]&gt; map = req.getParameterMap();</span><br><span class="line">        Customer customer = <span class="keyword">new</span> Customer();</span><br><span class="line">        String path = <span class="string">&quot;/login.jsp&quot;</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 填充数据 将map中的数据填充到bean对象中</span></span><br><span class="line">            BeanUtils.populate(customer,map);</span><br><span class="line">            <span class="comment">// 交给CustomerService 校验</span></span><br><span class="line">            CustomerService customerService = <span class="keyword">new</span> CustomerServiceImpl();</span><br><span class="line">            customerService.register(customer); <span class="comment">// 异常</span></span><br><span class="line">            resp.sendRedirect(path);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            path = <span class="string">&quot;/register.jsp&quot;</span>;</span><br><span class="line">            <span class="comment">// 将来service throw new RuntimeException(&quot;用户已经占用&quot;)</span></span><br><span class="line">            req.setAttribute(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;注册失败 &quot;</span>+e.getMessage());</span><br><span class="line">            req.getRequestDispatcher(path).forward(req,resp);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="CustomerServiceImpl"><a href="#CustomerServiceImpl" class="headerlink" title="CustomerServiceImpl"></a>CustomerServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Customer;</span><br><span class="line"><span class="keyword">import</span> com.briup.dao.CustomerMapper;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.CustomerService;</span><br><span class="line"><span class="keyword">import</span> com.briup.util.MyBatisSqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/9-09-09-14:25</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：顾客 业务逻辑</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerServiceImpl</span> <span class="keyword">implements</span> <span class="title">CustomerService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> SqlSession session = MyBatisSqlSessionFactory.openSession(<span class="keyword">true</span>);</span><br><span class="line">    <span class="keyword">private</span> CustomerMapper customerMapper = session.getMapper(CustomerMapper.class);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(Customer customer)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 1.校验用户名是否为空</span></span><br><span class="line">        String name = customer.getName();</span><br><span class="line">        <span class="keyword">if</span>(name == <span class="keyword">null</span> || <span class="string">&quot;&quot;</span>.equals(name.trim()))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;用户名不能为空&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 2.校验用户名是否存在</span></span><br><span class="line">            <span class="comment">// 带着用户名去查数据库</span></span><br><span class="line">        Customer customerFromDB = customerMapper.findByName(name);</span><br><span class="line">        <span class="keyword">if</span>(customerFromDB != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;用户名已存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3.使用mybatis 注册</span></span><br><span class="line">        customerMapper.register(customer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>注意: 注册需要提交 commit</code></p>
<h3 id="CustomerMapper-xml"><a href="#CustomerMapper-xml" class="headerlink" title="CustomerMapper.xml"></a>CustomerMapper.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">   <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.briup.dao.CustomerMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;customerSql&quot;</span>&gt;</span></span><br><span class="line">        id,name,password,zipCode,address,telephone,</span><br><span class="line">        email</span><br><span class="line">    <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--查用户名是否存在--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findByName&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;customer&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">parameterType</span>=<span class="string">&quot;string&quot;</span>&gt;</span></span><br><span class="line">       select <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;customerSql&quot;</span>/&gt;</span></span><br><span class="line">       from es_customer</span><br><span class="line">       where name = #&#123;name&#125;</span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--注册--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;register&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">parameterType</span>=<span class="string">&quot;customer&quot;</span>&gt;</span></span><br><span class="line">        insert into</span><br><span class="line">        es_customer(name,password,zipCode,address,telephone,email)</span><br><span class="line">        values (#&#123;name&#125;,#&#123;password&#125;,</span><br><span class="line">        #&#123;zipCode&#125;,#&#123;address&#125;,#&#123;telephone&#125;,#&#123;email&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="register-jsp"><a href="#register-jsp" class="headerlink" title="register.jsp"></a>register.jsp</h3><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> isELIgnored=<span class="string">&quot;false&quot;</span> %&gt;</span><br><span class="line"></span><br><span class="line">  &lt;form action=<span class="string">&quot;/register&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">           &lt;%-- &lt;span style=<span class="string">&quot;color: red;margin-left: 169px;&quot;</span>&gt;&lt;/span&gt;--%&gt;</span><br><span class="line">            &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;reg_box&quot;</span>&gt;</span><br><span class="line">                &lt;li&gt;</span><br><span class="line">                    &lt;span&gt;&lt;b&gt;*&lt;/b&gt;用户名：&lt;/span&gt;</span><br><span class="line">                    &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;name&quot;</span>  id=<span class="string">&quot;name&quot;</span>/&gt;</span><br><span class="line">                    &lt;span id=<span class="string">&quot;tip&quot;</span> style=<span class="string">&quot;width: 152px;color: red;margin-left: -11px&quot;</span>&gt;$&#123;msg&#125;&lt;/span&gt;</span><br><span class="line">                &lt;/li&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310739190.png" alt="image-20211025201746728"></p>
<p><code>注意: idea骨架创建webapp 默认页面忽略了el表达式</code></p>
<h2 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h2><h3 id="分析-1"><a href="#分析-1" class="headerlink" title="==分析=="></a>==分析==</h3><ul>
<li>获取到账户密码</li>
<li>校验是否是账户错误还是密码错误</li>
<li>成功 跳转到商城首页</li>
<li>失败 回退到登录页面 并提示错误信息</li>
</ul>
<h3 id="LoginServlet"><a href="#LoginServlet" class="headerlink" title="LoginServlet"></a>LoginServlet</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Customer;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.CustomerService;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.impl.CustomerServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/9-09-09-16:04</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：登录api</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/login&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        req.getRequestDispatcher(<span class="string">&quot;/login.jsp&quot;</span>).forward(req,resp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 接收参数</span></span><br><span class="line">        String name = req.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        String password = req.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">        <span class="comment">// 校验参数 ICustomerService CustomerServiceImpl</span></span><br><span class="line">        CustomerService customerService = <span class="keyword">new</span> CustomerServiceImpl();</span><br><span class="line">        <span class="comment">// 登录成功</span></span><br><span class="line">        String path = <span class="string">&quot;/index.jsp&quot;</span>;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            Customer customer = customerService.login(name,password);</span><br><span class="line">            <span class="keyword">if</span>(customer != <span class="keyword">null</span>)&#123;</span><br><span class="line">                <span class="comment">// 会话期间 数据有效</span></span><br><span class="line">                req.getSession().setAttribute(<span class="string">&quot;customer&quot;</span>,customer);</span><br><span class="line">            &#125;</span><br><span class="line">            resp.sendRedirect(path);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            path = <span class="string">&quot;/login.jsp&quot;</span>;</span><br><span class="line">            req.setAttribute(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;登录失败 &quot;</span> + e.getMessage());</span><br><span class="line">            <span class="comment">// 跳转页面 首页展示用户姓名</span></span><br><span class="line">            req.getRequestDispatcher(path).forward(req,resp);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="CustomerServiceImpl-1"><a href="#CustomerServiceImpl-1" class="headerlink" title="CustomerServiceImpl"></a>CustomerServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Customer <span class="title">login</span><span class="params">(String name, String password)</span> </span>&#123;</span><br><span class="line">       <span class="comment">// 校验用户名是否错误 这里没有校验密码</span></span><br><span class="line">       Customer customer = customerMapper.findByName(name);</span><br><span class="line">       <span class="keyword">if</span>(customer == <span class="keyword">null</span>)&#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;账户名有误&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">// 校验错误是否错误</span></span><br><span class="line">       <span class="keyword">if</span>(!password.equals((customer.getPassword())))&#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;密码有误&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> customer;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="login-jsp"><a href="#login-jsp" class="headerlink" title="login.jsp"></a>login.jsp</h3><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=<span class="string">&quot;/login&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">                   &lt;h1&gt;账号登陆&lt;/h1&gt;</span><br><span class="line">                   &lt;c:choose&gt;</span><br><span class="line">                       &lt;c:when test=<span class="string">&quot;$&#123;empty msg&#125;&quot;</span>&gt;</span><br><span class="line">                           &lt;h2&gt;公共场所请不要泄露您的密码，以防止账号丢失&lt;/h2&gt;</span><br><span class="line">                       &lt;/c:when&gt;</span><br><span class="line">                       &lt;c:otherwise&gt;</span><br><span class="line">                           &lt;h2&gt;&lt;span style=<span class="string">&quot;color: red&quot;</span>&gt;$&#123;msg&#125;&lt;/span&gt;&lt;/h2&gt;</span><br><span class="line">                       &lt;/c:otherwise&gt;</span><br><span class="line">                   &lt;/c:choose&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310739490.png" alt="image-20210909163711524"></p>
<p><img src="image/image-20210909163739415.png" alt="image-20210909163739415"></p>
<h2 id="注销"><a href="#注销" class="headerlink" title="注销"></a>注销</h2><h3 id="分析-2"><a href="#分析-2" class="headerlink" title="==分析=="></a>==分析==</h3><ul>
<li>如果注销用户,所有存在session的数据例如购物车都应该清除</li>
<li>销毁session即可</li>
</ul>
<h3 id="LogoutServlet"><a href="#LogoutServlet" class="headerlink" title="LogoutServlet"></a>LogoutServlet</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/9-09-09-16:23</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：com.briup.web.servlet</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/logout&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogoutServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        HttpSession session = req.getSession();</span><br><span class="line">        <span class="comment">// session.removeAttriube(&quot;customer&quot;,&quot;customer&quot;)</span></span><br><span class="line">        session.invalidate(); <span class="comment">// session可能购物车</span></span><br><span class="line">        resp.sendRedirect(<span class="string">&quot;/login&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="index-jsp"><a href="#index-jsp" class="headerlink" title="index.jsp"></a>index.jsp</h3><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:choose&gt;</span><br><span class="line">                &lt;c:when test=<span class="string">&quot;$&#123;empty customer&#125;&quot;</span>&gt;</span><br><span class="line">                    &lt;li&gt;&lt;a href=<span class="string">&quot;/login.jsp&quot;</span>&gt;登录&lt;/a&gt;|&lt;/li&gt;</span><br><span class="line">                &lt;/c:when&gt;</span><br><span class="line">                &lt;c:otherwise&gt;</span><br><span class="line">                    &lt;li&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;&lt;span style=<span class="string">&quot;color: green&quot;</span>&gt;$&#123;customer.name&#125;&lt;/span&gt;&lt;/a&gt;|&lt;/li&gt;</span><br><span class="line">                    &lt;li&gt;&lt;a href=<span class="string">&quot;/logout&quot;</span>&gt;退出&lt;/a&gt;|&lt;/li&gt;</span><br><span class="line">                &lt;/c:otherwise&gt;</span><br><span class="line">            &lt;/c:choose&gt;</span><br></pre></td></tr></table></figure>



<h2 id="ajax校验"><a href="#ajax校验" class="headerlink" title="ajax校验"></a>ajax校验</h2><p>==为什么需要前后端都校验==</p>
<ul>
<li>前端显示友好</li>
<li>后端控制业务，防止页面操作问题</li>
</ul>
<h3 id="分析-3"><a href="#分析-3" class="headerlink" title="==分析=="></a>==分析==</h3><ul>
<li>输入框绑定离焦事件 发送ajax请求</li>
<li>后台根据用户名查找用户是否存在</li>
<li>响应提示信息</li>
</ul>
<h3 id="CheckServlet"><a href="#CheckServlet" class="headerlink" title="CheckServlet"></a>CheckServlet</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Customer;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.CustomerService;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.impl.CustomerServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/9-09-09-17:09</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：com.briup.web.servlet</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/check&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CheckServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        String name = req.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        <span class="comment">// 是不是存在  findByName</span></span><br><span class="line">        CustomerService customerService = <span class="keyword">new</span> CustomerServiceImpl();</span><br><span class="line">        Customer customer = customerService.findByName(name);</span><br><span class="line">        resp.setContentType(<span class="string">&quot;text/plain;charset=utf-8&quot;</span>);</span><br><span class="line">        PrintWriter writer = resp.getWriter();</span><br><span class="line">        <span class="keyword">if</span>(customer != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="comment">// 用户已存在</span></span><br><span class="line">            writer.write(<span class="string">&quot;&lt;span style=&#x27;color:red&#x27;&gt;用户已存在&lt;span&gt;&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">// 可注册</span></span><br><span class="line">            writer.write(<span class="string">&quot;&lt;span style=&#x27;color:green&#x27;&gt;可注册&lt;span&gt;&quot;</span>);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>==将来可适用json格式数据交互==</p>
<h3 id="register-jsp-1"><a href="#register-jsp-1" class="headerlink" title="register.jsp"></a>register.jsp</h3><blockquote>
<p>注意:　改造之前的service findByName方法</p>
</blockquote>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span> src=<span class="string">&quot;js/jquery-1.12.3.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">   &lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">        $(function()&#123;</span><br><span class="line">            $(<span class="string">&quot;#name&quot;</span>).on(<span class="string">&quot;blur&quot;</span>,function()&#123;</span><br><span class="line">                <span class="keyword">var</span> name = $(<span class="string">&quot;#name&quot;</span>).val();</span><br><span class="line">                <span class="keyword">if</span>(name &amp;&amp; name.trim())&#123;</span><br><span class="line">                    $.ajax(&#123;</span><br><span class="line">                        type: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">                        url: <span class="string">&quot;/check&quot;</span>,</span><br><span class="line">                        data: &#123;<span class="string">&quot;name&quot;</span>:name&#125;,</span><br><span class="line">                        dataType: <span class="string">&quot;text&quot;</span> ,</span><br><span class="line">                        success: function (data) &#123;</span><br><span class="line">                            $(<span class="string">&quot;#tip&quot;</span>).html(data).hide().slideDown(<span class="number">2000</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> &lt;li&gt;</span><br><span class="line">                    &lt;span&gt;&lt;b&gt;*&lt;/b&gt;用户名：&lt;/span&gt;</span><br><span class="line">                    &lt;input id = <span class="string">&quot;name&quot;</span> type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;name&quot;</span>/&gt;</span><br><span class="line">                    &lt;span id = <span class="string">&quot;tip&quot;</span>&gt;&lt;/span&gt;</span><br><span class="line">                &lt;/li&gt;</span><br></pre></td></tr></table></figure>

<h3 id="CustomerService"><a href="#CustomerService" class="headerlink" title="CustomerService"></a>CustomerService</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Customer;</span><br><span class="line"><span class="keyword">import</span> com.briup.dao.CustomerMapper;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.CustomerService;</span><br><span class="line"><span class="keyword">import</span> com.briup.util.MyBatisSqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/9-09-09-14:25</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：com.briup.service.impl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerServiceImpl</span> <span class="keyword">implements</span> <span class="title">CustomerService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> SqlSession session = MyBatisSqlSessionFactory.openSession(<span class="keyword">true</span>);</span><br><span class="line">    <span class="keyword">private</span> CustomerMapper customerMapper = session.getMapper(CustomerMapper.class);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(Customer customer)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 1.校验用户名是否为空</span></span><br><span class="line">        String name = customer.getName();</span><br><span class="line">        <span class="keyword">if</span>(name == <span class="keyword">null</span> || <span class="string">&quot;&quot;</span>.equals(name.trim()))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;用户名不能为空&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 2.校验用户名是否存在</span></span><br><span class="line">            <span class="comment">// 带着用户名去查数据库</span></span><br><span class="line">        Customer customerFromDB = findByName(name);</span><br><span class="line">        <span class="keyword">if</span>(customerFromDB != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;用户名已存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3.使用mybatis 注册</span></span><br><span class="line">        customerMapper.register(customer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Customer <span class="title">login</span><span class="params">(String name, String password)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 校验用户名是否错误 这里没有校验密码</span></span><br><span class="line">        Customer customer = findByName(name);</span><br><span class="line">        <span class="keyword">if</span>(customer == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;账户名有误&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 校验错误是否错误</span></span><br><span class="line">        <span class="keyword">if</span>(!password.equals((customer.getPassword())))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;密码有误&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> customer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Customer <span class="title">findByName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> customerMapper.findByName(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>







<h1 id="3-书籍模块"><a href="#3-书籍模块" class="headerlink" title="3 书籍模块"></a>3 书籍模块</h1><h2 id="查看所有目录"><a href="#查看所有目录" class="headerlink" title="查看所有目录"></a>查看所有目录</h2><h3 id="分析-4"><a href="#分析-4" class="headerlink" title="==分析=="></a>==分析==</h3><ul>
<li>访问首页 即可查看所有数据</li>
<li>此时数据应该随应用启动便查找(监听器)</li>
<li>一级目录<ul>
<li><code>select * from es_category where parent_id = 0</code></li>
</ul>
</li>
<li>二级目录<ul>
<li><code>select * from es_category where parent_id =(select id from es_category where parent_id = 0) </code></li>
</ul>
</li>
</ul>
<h3 id="ApplicationListener"><a href="#ApplicationListener" class="headerlink" title="ApplicationListener"></a>ApplicationListener</h3><blockquote>
<p>注意: @WebListener</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.listener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Category;</span><br><span class="line"><span class="keyword">import</span> com.briup.mapper.CategoryMapper;</span><br><span class="line"><span class="keyword">import</span> com.briup.util.MyBatisSqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContextEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContextListener;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebListener;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/10-09-10-9:50</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：项目启动 准备目录和书籍数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebListener</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplicationListener</span> <span class="keyword">implements</span> <span class="title">ServletContextListener</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextInitialized</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 项目启动初始化操作</span></span><br><span class="line">        <span class="comment">// 查询所有目录</span></span><br><span class="line">        SqlSession session = MyBatisSqlSessionFactory.openSession();</span><br><span class="line">        CategoryMapper categoryMapper = session.getMapper(CategoryMapper.class);</span><br><span class="line">        List&lt;Category&gt; categoryList = categoryMapper.findAllCategory();</span><br><span class="line">        ServletContext servletContext = sce.getServletContext();</span><br><span class="line">        servletContext.setAttribute(<span class="string">&quot;categoryList&quot;</span>,categoryList);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextDestroyed</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="CategoryMapper-xml"><a href="#CategoryMapper-xml" class="headerlink" title="CategoryMapper.xml"></a>CategoryMapper.xml</h3><blockquote>
<p>注意: 二级目录的parent_id为一级目录的id</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.briup.mapper.CategoryMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;firstMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;category&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;description&quot;</span> <span class="attr">property</span>=<span class="string">&quot;description&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;categories&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">select</span>=<span class="string">&quot;selectSecond&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--嵌套结果 自关联 第一张的结果和第二张一模一样--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--嵌套查询--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAllCategory&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;firstMap&quot;</span>&gt;</span></span><br><span class="line">        select id,name,description</span><br><span class="line">        from es_category</span><br><span class="line">        where parent_id = 0</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--接收一级目录的id--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectSecond&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;firstMap&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">         select id,name,description</span><br><span class="line">        from es_category</span><br><span class="line">        where parent_id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="mybatis-config-xml"><a href="#mybatis-config-xml" class="headerlink" title="mybatis-config.xml"></a>mybatis-config.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置映射文件的位置 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;mappers/CustomerMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;mappers/CategoryMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="index-jsp-1"><a href="#index-jsp-1" class="headerlink" title="index.jsp"></a>index.jsp</h3><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;dl&gt;</span><br><span class="line">               &lt;%--</span><br><span class="line">                   items 获取范围对象中的数据</span><br><span class="line">                   <span class="keyword">var</span>   数据集合的某一项   foeach(Category category : List&lt;Category&gt;)&#123;&#125;</span><br><span class="line">               --%&gt;</span><br><span class="line">               &lt;c:forEach items=<span class="string">&quot;$&#123;categoryList&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;firstCa&quot;</span>&gt;</span><br><span class="line">                   &lt;dd&gt;</span><br><span class="line">                       &lt;h1&gt;$&#123;firstCa.name&#125;&lt;/h1&gt;</span><br><span class="line">                       &lt;p&gt;</span><br><span class="line">                           &lt;c:forEach items=<span class="string">&quot;$&#123;firstCa.categories&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;secondCa&quot;</span>&gt;</span><br><span class="line">                               &lt;a href=<span class="string">&quot;list.html&quot;</span>&gt;$&#123;secondCa.name&#125;&lt;/a&gt;</span><br><span class="line">                           &lt;/c:forEach&gt;</span><br><span class="line">                       &lt;/p&gt;</span><br><span class="line">                   &lt;/dd&gt;</span><br><span class="line">               &lt;/c:forEach&gt;</span><br><span class="line"></span><br><span class="line">           &lt;/dl&gt;</span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310739967.png" alt="image-20210910102415193" style="zoom:50%;" />





<h2 id="查看所有书"><a href="#查看所有书" class="headerlink" title="查看所有书"></a>查看所有书</h2><h3 id="分析-5"><a href="#分析-5" class="headerlink" title="==分析=="></a>==分析==</h3><ul>
<li>访问首页 即可查看所有数据</li>
<li>需要查询目录信息</li>
<li>此时数据应该随应用启动便查找(监听器)</li>
</ul>
<h3 id="ApplicationListener-1"><a href="#ApplicationListener-1" class="headerlink" title="ApplicationListener"></a>ApplicationListener</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.listener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Book;</span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Category;</span><br><span class="line"><span class="keyword">import</span> com.briup.mapper.BookMapper;</span><br><span class="line"><span class="keyword">import</span> com.briup.mapper.CategoryMapper;</span><br><span class="line"><span class="keyword">import</span> com.briup.util.MyBatisSqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContextEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContextListener;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebListener;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/10-09-10-9:50</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：项目启动 准备目录和书籍数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebListener</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplicationListener</span> <span class="keyword">implements</span> <span class="title">ServletContextListener</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextInitialized</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 项目启动初始化操作</span></span><br><span class="line">        <span class="comment">// 查询所有目录</span></span><br><span class="line">        SqlSession session = MyBatisSqlSessionFactory.openSession();</span><br><span class="line">        CategoryMapper categoryMapper = session.getMapper(CategoryMapper.class);</span><br><span class="line">        List&lt;Category&gt; categoryList = categoryMapper.findAllCategory();</span><br><span class="line">        ServletContext servletContext = sce.getServletContext();</span><br><span class="line">        servletContext.setAttribute(<span class="string">&quot;categoryList&quot;</span>,categoryList);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 查询所有书籍</span></span><br><span class="line">        BookMapper bookMapper = session.getMapper(BookMapper.class);</span><br><span class="line">        List&lt;Book&gt; bookList = bookMapper.findAllBook();</span><br><span class="line">        servletContext.setAttribute(<span class="string">&quot;bookList&quot;</span>,bookList);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextDestroyed</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="BookMapper-xml"><a href="#BookMapper-xml" class="headerlink" title="BookMapper.xml"></a>BookMapper.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.briup.mapper.BookMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;bMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;book&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;bid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;bname&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;price&quot;</span> <span class="attr">property</span>=<span class="string">&quot;price&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;author&quot;</span> <span class="attr">property</span>=<span class="string">&quot;author&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;publisher&quot;</span> <span class="attr">property</span>=<span class="string">&quot;publisher&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;pubDate&quot;</span> <span class="attr">property</span>=<span class="string">&quot;pubDate&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;bdescription&quot;</span> <span class="attr">property</span>=<span class="string">&quot;description&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;image&quot;</span> <span class="attr">property</span>=<span class="string">&quot;image&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;category&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;secondMap&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;secondMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;category&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;cid&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;cname&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;description&quot;</span> <span class="attr">column</span>=<span class="string">&quot;cdescription&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAllBook&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;bMap&quot;</span>&gt;</span></span><br><span class="line">        SELECT</span><br><span class="line">            b.id AS bid,</span><br><span class="line">            b.NAME AS bname,</span><br><span class="line">            b.price,</span><br><span class="line">            b.author,</span><br><span class="line">            b.publisher,</span><br><span class="line">            b.pubDate,</span><br><span class="line">            b.description AS bdescription,</span><br><span class="line">            b.image,</span><br><span class="line">            c.id AS cid,</span><br><span class="line">            c.NAME AS cname,</span><br><span class="line">            c.description AS cdescription</span><br><span class="line">        FROM</span><br><span class="line">            es_book b,</span><br><span class="line">            es_category c</span><br><span class="line">        WHERE</span><br><span class="line">            b.category_id = c.id</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="mybatis-config-xml-1"><a href="#mybatis-config-xml-1" class="headerlink" title="mybatis-config.xml"></a>mybatis-config.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;mappers/BookMapper.xml&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="index-jsp-2"><a href="#index-jsp-2" class="headerlink" title="index.jsp"></a>index.jsp</h3><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul&gt;</span><br><span class="line">            &lt;c:forEach items=<span class="string">&quot;$&#123;bookList&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;b&quot;</span>&gt;</span><br><span class="line">                &lt;li&gt;</span><br><span class="line">                    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;c3_b2_txt&quot;</span>&gt;</span><br><span class="line">                        &lt;h1&gt;$&#123;b.name&#125;&lt;/h1&gt;</span><br><span class="line">                        &lt;p&gt;$&#123;b.category.name&#125;&lt;/p&gt;</span><br><span class="line">                        &lt;h2&gt;$&#123;b.category.description&#125;&lt;/h2&gt;</span><br><span class="line">                        &lt;h2&gt;$&#123;b.description&#125;&lt;/h2&gt;</span><br><span class="line">                        &lt;p&gt;&lt;a href=<span class="string">&quot;viewBook.html&quot;</span>&gt;更多精彩，点击进入&lt;/a&gt;&lt;/p&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">            &lt;/c:forEach&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br></pre></td></tr></table></figure>





<h2 id="查看书详情"><a href="#查看书详情" class="headerlink" title="查看书详情"></a>查看书详情</h2><h3 id="分析-6"><a href="#分析-6" class="headerlink" title="==分析=="></a>==分析==</h3><ul>
<li>页面传递书籍id</li>
<li>将id和application范围对象的数据比对即可</li>
</ul>
<h3 id="index-jsp-3"><a href="#index-jsp-3" class="headerlink" title="index.jsp"></a>index.jsp</h3><p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310739429.png" alt="image-20210910121451748"></p>
<h3 id="ViewBookServlet"><a href="#ViewBookServlet" class="headerlink" title="ViewBookServlet"></a>ViewBookServlet</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Book;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/10-09-10-11:20</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：com.briup.web.servlet</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/viewBook&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewBookServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> bookId = Integer.parseInt(req.getParameter(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">        <span class="comment">// 查该id的书 存储在范围对象</span></span><br><span class="line">            <span class="comment">// 此时ServletContext有书的数据</span></span><br><span class="line">        ServletContext servletContext = req.getServletContext();</span><br><span class="line">       List&lt;Book&gt; bookList = (List&lt;Book&gt;) servletContext.getAttribute(<span class="string">&quot;bookList&quot;</span>);</span><br><span class="line">       <span class="keyword">for</span> (Book b : bookList)&#123;</span><br><span class="line">           <span class="keyword">if</span>(b.getId() == bookId)&#123;</span><br><span class="line">               <span class="comment">// 书找到了</span></span><br><span class="line">               req.getSession().setAttribute(<span class="string">&quot;book&quot;</span>,b);</span><br><span class="line">               <span class="keyword">break</span>;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">        <span class="comment">// 跳转到详情页面 渲染</span></span><br><span class="line">        req.getRequestDispatcher(<span class="string">&quot;/viewBook.jsp&quot;</span>).forward(req,resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="viewBook-jsp"><a href="#viewBook-jsp" class="headerlink" title="viewBook.jsp"></a>viewBook.jsp</h3><blockquote>
<p>fmt 解决时间格式</p>
</blockquote>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;container5&quot;</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;cn5_top&quot;</span>&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;cn5_top_x center01&quot;</span>&gt;</span><br><span class="line">            &lt;a <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;font20&quot;</span> href=<span class="string">&quot;#&quot;</span>&gt;书籍&lt;/a&gt; &gt;</span><br><span class="line">            &lt;a href=<span class="string">&quot;#&quot;</span>&gt;$&#123;book.category.name&#125;&lt;/a&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;cn5_top_y center01&quot;</span>&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;cn5topy_1&quot;</span>&gt;</span><br><span class="line">                &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;cn5topy_imgview&quot;</span>&gt;</span><br><span class="line">                    &lt;img src=<span class="string">&quot;$&#123;book.image&#125;&quot;</span>/&gt;</span><br><span class="line">                    &lt;!-- &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;cn5topy_imglist&quot;</span>&gt;</span><br><span class="line">                        &lt;li&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;&lt;img src=<span class="string">&quot;images/viewBook.png&quot;</span>&gt;&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">                        &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;current&quot;</span>&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;&lt;img src=<span class="string">&quot;images/viewBook.png&quot;</span>&gt;&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">                        &lt;li&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;&lt;img src=<span class="string">&quot;images/viewBook.png&quot;</span>&gt;&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">                        &lt;li&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;&lt;img src=<span class="string">&quot;images/viewBook.png&quot;</span>&gt;&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">                        &lt;li&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;&lt;img src=<span class="string">&quot;images/viewBook.png&quot;</span>&gt;&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">                    &lt;/ul&gt; --&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;cn5topy_2&quot;</span>&gt;</span><br><span class="line">                &lt;h1 <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_title font15&quot;</span>&gt;$&#123;book.name&#125;&lt;/h1&gt;</span><br><span class="line">                &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_price&quot;</span>&gt;</span><br><span class="line">                    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_price_x&quot;</span>&gt;</span><br><span class="line">                        &lt;p&gt; briup价：&lt;b&gt;￥$&#123;book.price&#125;&lt;/b&gt; &lt;a href=<span class="string">&quot;#&quot;</span>&gt;(降价通知)&lt;/a&gt;&lt;/p&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;!-- &lt;div&gt;</span><br><span class="line">                    &lt;ul&gt;</span><br><span class="line">                        &lt;li&gt;&lt;span&gt;作者：&lt;/span&gt;托马斯&lt;/li&gt;</span><br><span class="line">                        &lt;li&gt;&lt;/li&gt;</span><br><span class="line">                        &lt;li&gt;&lt;/li&gt;</span><br><span class="line">                    &lt;/ul&gt;</span><br><span class="line">                &lt;/div&gt; --&gt;</span><br><span class="line">                &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_selects&quot;</span>&gt;</span><br><span class="line">                    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_select&quot;</span>&gt;</span><br><span class="line">                        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_key pro_key_vertical fl&quot;</span>&gt;作者：&lt;/div&gt;</span><br><span class="line">                        &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_select_vals&quot;</span>&gt;</span><br><span class="line">                            &lt;li&gt;$&#123;book.author&#125;&lt;/li&gt;</span><br><span class="line"></span><br><span class="line">                        &lt;/ul&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_select&quot;</span>&gt;</span><br><span class="line">                        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_key pro_key_vertical fl&quot;</span>&gt;出版社：&lt;/div&gt;</span><br><span class="line">                        &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_select_vals&quot;</span>&gt;</span><br><span class="line">                            &lt;li&gt;$&#123;book.publisher&#125;&lt;/li&gt;</span><br><span class="line"></span><br><span class="line">                        &lt;/ul&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_select&quot;</span>&gt;</span><br><span class="line">                        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_key pro_key_vertical fl&quot;</span>&gt;书籍介绍：&lt;/div&gt;</span><br><span class="line">                        &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_select_vals&quot;</span>&gt;</span><br><span class="line">                            &lt;li&gt; 出版时间：$&#123;book.pubDate&#125;&lt;/li&gt;</span><br><span class="line">                            &lt;li&gt;包装：平装&lt;/li&gt;</span><br><span class="line">                            &lt;li&gt;正文语种：中文&lt;/li&gt;</span><br><span class="line">                        &lt;/ul&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;form action=<span class="string">&quot;&quot;</span> id=<span class="string">&quot;addCar&quot;</span>&gt;</span><br><span class="line">                    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_buy&quot;</span>&gt;</span><br><span class="line">                        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_buy_nums&quot;</span>&gt;</span><br><span class="line">                            &lt;input type=<span class="string">&quot;text&quot;</span> value=<span class="string">&quot;1&quot;</span> name=<span class="string">&quot;num&quot;</span>/&gt;</span><br><span class="line">                            &lt;dl&gt;</span><br><span class="line">                                &lt;dd onclick=<span class="string">&quot;addCount()&quot;</span>&gt;+&lt;/dd&gt;</span><br><span class="line">                                &lt;dd onclick=<span class="string">&quot;reduceCount()&quot;</span>&gt;-&lt;/dd&gt;</span><br><span class="line">                            &lt;/dl&gt;</span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                        &lt;!--  &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_addshop&quot;</span> onclick=<span class="string">&quot;submitForm()&quot;</span>&gt;加入购物车&lt;/div&gt; --&gt;</span><br><span class="line">                        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_addshop&quot;</span>&gt;&lt;a href=<span class="string">&quot;shopCart.html&quot;</span>&gt;加入购物车&lt;/a&gt;&lt;/div&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/form&gt;</span><br><span class="line">                &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_ship&quot;</span>&gt;</span><br><span class="line">                    &lt;div&gt;</span><br><span class="line">                        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_key fl&quot;</span>&gt;服&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;务：&lt;/div&gt;</span><br><span class="line">                        &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_service f1&quot;</span>&gt;</span><br><span class="line">                            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;service_fq&quot;</span>&gt;分期付款&lt;/li&gt;</span><br><span class="line">                            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;service_myf&quot;</span>&gt;免运费&lt;/li&gt;</span><br><span class="line">                            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;service_zt&quot;</span>&gt;自提&lt;/li&gt;</span><br><span class="line">                            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;service_th&quot;</span>&gt;<span class="number">7</span>天无理由退换货&lt;/li&gt;</span><br><span class="line">                        &lt;/ul&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br></pre></td></tr></table></figure>



<h1 id="4-购物车模块"><a href="#4-购物车模块" class="headerlink" title="4 ==购物车模块=="></a>4 ==购物车模块==</h1><p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310739817.png" alt="image-20210910144249683"></p>
<h2 id="ShopCar"><a href="#ShopCar" class="headerlink" title="ShopCar"></a>ShopCar</h2><ul>
<li>ShopCart并没有对应的表 此时的购物车只存在session中(可自己改造)</li>
<li>ShopCart使用Map保存 商品id和订单项的关系(因为页面需要)<ul>
<li>购物车数量</li>
<li>商品价格</li>
<li>商品购买数量</li>
<li>商品小计</li>
<li>购物车商品小计</li>
</ul>
</li>
</ul>
<blockquote>
<p>注意：属性为get***() 将来提供jsp取值</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Book;</span><br><span class="line"><span class="keyword">import</span> com.briup.bean.OrderLine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/10-09-10-14:57</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：购物车对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShopCart</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 需要借助容器对象 才能存储数据</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;Integer, OrderLine&gt; cart = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 功能描述 将商品添加到购物车</span></span><br><span class="line"><span class="comment">     * @author vanse</span></span><br><span class="line"><span class="comment">     * @date 2021/9/10</span></span><br><span class="line"><span class="comment">     * @param book 书的信息</span></span><br><span class="line"><span class="comment">     * @param num 购买数量</span></span><br><span class="line"><span class="comment">     * @return void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCart</span><span class="params">(Book book, <span class="keyword">int</span> num)</span> </span>&#123;</span><br><span class="line">        Integer bookId = book.getId();</span><br><span class="line">        OrderLine orderLine = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (cart.containsKey(bookId)) &#123;</span><br><span class="line">            <span class="comment">// 如果购物车存在这本书 数量+1</span></span><br><span class="line">            orderLine = cart.get(bookId);</span><br><span class="line">            <span class="comment">// 原数量 + 新买的数量</span></span><br><span class="line">            orderLine.setNum(orderLine.getNum() + num);</span><br><span class="line">            orderLine.setCost(orderLine.getNum() * book.getPrice());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 如果不存在,购物车新添一个订单项</span></span><br><span class="line">            orderLine = <span class="keyword">new</span> OrderLine();</span><br><span class="line">            orderLine.setBook(book);</span><br><span class="line">            orderLine.setNum(Long.valueOf(num));</span><br><span class="line">            orderLine.setCost(book.getPrice() * orderLine.getNum());</span><br><span class="line">        &#125;</span><br><span class="line">        cart.put(bookId, orderLine);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// jsp  $&#123;&#125; size totalCost orderLines</span></span><br><span class="line">    <span class="comment">// 构建相关属性 让jsp能够获取到</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// size属性</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> cart.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// totalCost 所有订单项之和</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getTotalCost</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">double</span> totalCost = <span class="number">0</span>;</span><br><span class="line">        Collection&lt;OrderLine&gt; orderLines = cart.values();</span><br><span class="line">        <span class="keyword">for</span> (OrderLine orderLine : orderLines) &#123;</span><br><span class="line">            <span class="comment">// 每个订单项的小计</span></span><br><span class="line">            totalCost += orderLine.getCost();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> totalCost;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// orderLines 所有订单项</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Collection&lt;OrderLine&gt; <span class="title">getOrderLines</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> cart.values();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="加入购物车"><a href="#加入购物车" class="headerlink" title="加入购物车"></a>加入购物车</h2><p>==分析==</p>
<ul>
<li>判断该商品是否购物车存在<ul>
<li>如果存在: 原订单项数量+1</li>
<li>如果不存在: 新添一个订单项</li>
</ul>
</li>
</ul>
<h3 id="AddCartServlet"><a href="#AddCartServlet" class="headerlink" title="AddCartServlet"></a>AddCartServlet</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Book;</span><br><span class="line"><span class="keyword">import</span> com.briup.util.BookUtil;</span><br><span class="line"><span class="keyword">import</span> com.briup.vo.ShopCart;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/10-09-10-14:52</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：加入购物车</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/addCart&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AddCartServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 功能描述 获取到书 和 数量 封装成orderLine 加入到购物车</span></span><br><span class="line"><span class="comment">     * @author vanse</span></span><br><span class="line"><span class="comment">     * @date 2021/9/10</span></span><br><span class="line"><span class="comment">     * @param req</span></span><br><span class="line"><span class="comment">     * @param resp</span></span><br><span class="line"><span class="comment">     * @return void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> bookId = Integer.parseInt(req.getParameter(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">        <span class="keyword">int</span> num = Integer.parseInt(req.getParameter(<span class="string">&quot;num&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加到购物车 (登录session 就有一个购物车对象)</span></span><br><span class="line">            <span class="comment">// 监听器 创建购物车session</span></span><br><span class="line">        HttpSession session = req.getSession();</span><br><span class="line">        ShopCart shopCart = (ShopCart) req.getSession().getAttribute(<span class="string">&quot;shopCart&quot;</span>);</span><br><span class="line">       <span class="keyword">if</span>(shopCart == <span class="keyword">null</span>)&#123;</span><br><span class="line">            shopCart = <span class="keyword">new</span> ShopCart();</span><br><span class="line">       &#125;</span><br><span class="line">        Book book = BookUtil.getBookById(req, bookId);</span><br><span class="line">        <span class="comment">// 添加到购物车</span></span><br><span class="line">       shopCart.addCart(book,num);</span><br><span class="line">        session.setAttribute(<span class="string">&quot;shopCart&quot;</span>,shopCart);</span><br><span class="line">       <span class="comment">// 跳转到购物车页面 展示数据</span></span><br><span class="line">        resp.sendRedirect(<span class="string">&quot;/shopCart.jsp&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="BookUtil"><a href="#BookUtil" class="headerlink" title="BookUtil"></a>BookUtil</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Book;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/10-09-10-15:02</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：com.briup.util</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookUtil</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Book <span class="title">getBookById</span><span class="params">(HttpServletRequest req,Integer bookId)</span> </span>&#123;</span><br><span class="line">        ServletContext servletContext = req.getServletContext();</span><br><span class="line">        Book book = <span class="keyword">null</span>;</span><br><span class="line">        List&lt;Book&gt; bookList = (List&lt;Book&gt;) servletContext.getAttribute(<span class="string">&quot;bookList&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (Book b : bookList) &#123;</span><br><span class="line">            <span class="keyword">if</span> (b.getId() == bookId) &#123;</span><br><span class="line">                book = b;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> book;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="shopCart-jsp"><a href="#shopCart-jsp" class="headerlink" title="shopCart.jsp"></a>shopCart.jsp</h3><blockquote>
<p>注意el表达式取值 ${shopCart.属性}</p>
</blockquote>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;c&quot;</span> uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span></span><br><span class="line">         language=<span class="string">&quot;java&quot;</span>  isELIgnored=<span class="string">&quot;false&quot;</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html;charset=UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;购物车页面&lt;/title&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;css/fullCar.css&quot;</span> /&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;css/common.css&quot;</span>/&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;css/style.css&quot;</span> /&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;css/icons.css&quot;</span> /&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;css/table.css&quot;</span> /&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> type=<span class="string">&quot;text/css&quot;</span> href=<span class="string">&quot;css/shopCar.css&quot;</span>&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;!--顶部--&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;top&quot;</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;top_center&quot;</span>&gt;</span><br><span class="line">        &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;top_bars&quot;</span>&gt;</span><br><span class="line">            &lt;li&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;退出&lt;/a&gt;|&lt;/li&gt;</span><br><span class="line">            &lt;li&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;我的订单&lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;jt_down&quot;</span>&gt;&lt;/span&gt;&lt;/a&gt;|&lt;/li&gt;</span><br><span class="line">            &lt;li&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;关注杰普&lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;jt_down&quot;</span>&gt;&lt;/span&gt;&lt;/a&gt;|&lt;/li&gt;</span><br><span class="line">            &lt;li&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;网站导航&lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;jt_down&quot;</span>&gt;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;!--头部--&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;header3&quot;</span>&gt;</span><br><span class="line">    &lt;a href=<span class="string">&quot;#&quot;</span>&gt;&lt;img src=<span class="string">&quot;images/logo.png&quot;</span>  <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;oneImg&quot;</span>&gt;&lt;/a&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;h3_right&quot;</span>&gt;</span><br><span class="line">        &lt;img src=<span class="string">&quot;images/play_03.png&quot;</span> alt=<span class="string">&quot;&quot;</span>&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;!--中间部分div--&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;empty&quot;</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;peisong&quot;</span>&gt;&lt;pre&gt;全部商品 $&#123;shopCart.size&#125; &lt;/pre&gt;&lt;/div&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;mainCenter&quot;</span>&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;allCheck&quot;</span>&gt;</span><br><span class="line">            &lt;input type=<span class="string">&quot;checkbox&quot;</span>&gt;&lt;p&gt;全选&lt;/p&gt;</span><br><span class="line">            &lt;p <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;leftM&quot;</span>&gt;商品&lt;/p&gt;</span><br><span class="line">            &lt;p <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;rightM&quot;</span>&gt;单价(元)&lt;/p&gt;</span><br><span class="line">            &lt;p <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;leftM&quot;</span>&gt;数量&lt;/p&gt;</span><br><span class="line">            &lt;p <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;leftM&quot;</span>&gt;小计(元)&lt;/p&gt;</span><br><span class="line">            &lt;p <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;leftM&quot;</span>&gt;操作&lt;/p&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;mainPro&quot;</span>&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;aa&quot;</span>&gt;</span><br><span class="line">                &lt;input type=<span class="string">&quot;checkbox&quot;</span>&gt;&lt;span id=<span class="string">&quot;but&quot;</span>&gt;自营&lt;/span&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;c:forEach items=<span class="string">&quot;$&#123;shopCart.orderLines&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;orderLine&quot;</span>&gt;</span><br><span class="line">                &lt;form&gt;</span><br><span class="line">                    &lt;table&gt;</span><br><span class="line">                        &lt;tbody&gt;</span><br><span class="line">                        &lt;tr&gt;</span><br><span class="line">                            &lt;td <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;index&quot;</span>&gt;<span class="number">1</span>&lt;/td&gt;</span><br><span class="line">                            &lt;td&gt;</span><br><span class="line">                                &lt;img src=<span class="string">&quot;$&#123;orderLine.book.image&#125;&quot;</span> &gt;</span><br><span class="line">                                &lt;span&gt;</span><br><span class="line">                                   $&#123;orderLine.book.name&#125;</span><br><span class="line">                                    &lt;br&gt;</span><br><span class="line">                                &lt;/span&gt;</span><br><span class="line">                            &lt;/td&gt;</span><br><span class="line">                            &lt;td&gt;</span><br><span class="line">                                &lt;span&gt;¥$&#123;orderLine.book.price&#125;&lt;/span&gt;</span><br><span class="line">                            &lt;/td&gt;</span><br><span class="line">                            &lt;td <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;index2&quot;</span>&gt;</span><br><span class="line">                                &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;num&quot;</span> value=<span class="string">&quot;$&#123;orderLine.num&#125;&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">                                &lt;span&gt;有货&lt;/span&gt;</span><br><span class="line">                            &lt;/td&gt;</span><br><span class="line">                            &lt;td&gt;</span><br><span class="line">                                &lt;span&gt;¥$&#123;orderLine.cost&#125;&lt;/span&gt;</span><br><span class="line">                            &lt;/td&gt;</span><br><span class="line">                            &lt;td&gt;</span><br><span class="line">                                &lt;button&gt;保存&lt;/button&gt;</span><br><span class="line">                                &lt;button&gt;取消&lt;/button&gt;</span><br><span class="line">                            &lt;/td&gt;</span><br><span class="line">                        &lt;/tr&gt;</span><br><span class="line">                        &lt;/tbody&gt;</span><br><span class="line">                    &lt;/table&gt;</span><br><span class="line">                &lt;/form&gt;</span><br><span class="line">            &lt;/c:forEach&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            &lt;!-- &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;min_content&quot;</span>&gt;</span><br><span class="line">               &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;bb&quot;</span>&gt;</span><br><span class="line">                &lt;input type=<span class="string">&quot;text&quot;</span> &gt;</span><br><span class="line">                &lt;img src=<span class="string">&quot;images/1.png&quot;</span> &gt;</span><br><span class="line">                 &lt;span&gt;</span><br><span class="line">                    Effective JAVA</span><br><span class="line">                    &lt;br&gt;</span><br><span class="line">                &lt;/span&gt;</span><br><span class="line">                &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;mm&quot;</span>&gt;</span><br><span class="line">                    &lt;span&gt;¥<span class="number">66.00</span>&lt;/span&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;img src=<span class="string">&quot;images/have_03.png&quot;</span> style=<span class="string">&quot;margin-top:40px&quot;</span>&gt;</span><br><span class="line">                &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;ri&quot;</span>&gt;¥<span class="number">66.00</span>元&lt;/div&gt;</span><br><span class="line">                &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;righ&quot;</span>&gt;</span><br><span class="line">                     &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;rig&quot;</span>&gt;删除&lt;/div&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">--&gt;</span><br><span class="line">            &lt;!-- &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;bb&quot;</span>&gt;</span><br><span class="line">                   &lt;input type=<span class="string">&quot;checkbox&quot;</span> &gt;</span><br><span class="line">                   &lt;img src=<span class="string">&quot;images/1.png&quot;</span> &gt;</span><br><span class="line">                    &lt;span&gt;</span><br><span class="line">                       Effective JAVA</span><br><span class="line">                       &lt;br&gt;</span><br><span class="line">                   &lt;/span&gt;</span><br><span class="line">                   &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;mm&quot;</span>&gt;</span><br><span class="line">                       &lt;span&gt;¥<span class="number">66.00</span>&lt;/span&gt;</span><br><span class="line">                   &lt;/div&gt;</span><br><span class="line">                   &lt;img src=<span class="string">&quot;images/have_03.png&quot;</span> style=<span class="string">&quot;margin-top:40px&quot;</span>&gt;</span><br><span class="line">                   &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;ri&quot;</span>&gt;¥<span class="number">66.00</span>元&lt;/div&gt;</span><br><span class="line">                   &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;righ&quot;</span>&gt;</span><br><span class="line">                        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;rig&quot;</span>&gt;删除&lt;/div&gt;</span><br><span class="line">                   &lt;/div&gt;</span><br><span class="line">               &lt;/div&gt; --&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;allButtom&quot;</span>&gt;</span><br><span class="line">            &lt;!-- &lt;p <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;caozuo&quot;</span>&gt;去结算&lt;/p&gt; --&gt;</span><br><span class="line">            &lt;!-- &lt;input value=<span class="string">&quot;去提交&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;caozuo&quot;</span> type=<span class="string">&quot;submit&quot;</span>&gt; --&gt;</span><br><span class="line">            &lt;a href=<span class="string">&quot;confirm.html&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;caozuo&quot;</span>&gt;去提交&lt;/a&gt;</span><br><span class="line">            &lt;span&gt;已选择&lt;font&gt;<span class="number">2</span>&lt;/font&gt;件商品&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;总价(不含运费)：&lt;font&gt;¥$&#123;shopCart.totalCost&#125;元&lt;/font&gt;&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;!--脚部--&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;footer3&quot;</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_top&quot;</span>&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_center&quot;</span>&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;ts1&quot;</span>&gt;品目繁多 愉悦购物&lt;/div&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;ts2&quot;</span>&gt;正品保障 天天低价&lt;/div&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;ts3&quot;</span>&gt;极速物流 特色定制&lt;/div&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;ts4&quot;</span>&gt;优质服务 以客为尊&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_middle&quot;</span>&gt;</span><br><span class="line">        &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_center&quot;</span>&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_mi_li01&quot;</span>&gt;</span><br><span class="line">                &lt;h1&gt;购物指南&lt;/h1&gt;</span><br><span class="line">                &lt;p&gt;常见问题&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;找回密码&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;会员介绍&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;购物演示&lt;/p&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_mi_li01&quot;</span>&gt;</span><br><span class="line">                &lt;h1&gt;配送方式&lt;/h1&gt;</span><br><span class="line">                &lt;p&gt;常见问题&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;找回密码&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;会员介绍&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;购物演示&lt;/p&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_mi_li01&quot;</span>&gt;</span><br><span class="line">                &lt;h1&gt;支付方式&lt;/h1&gt;</span><br><span class="line">                &lt;p&gt;常见问题&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;找回密码&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;会员介绍&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;购物演示&lt;/p&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_mi_li01&quot;</span>&gt;</span><br><span class="line">                &lt;h1&gt;售后服务&lt;/h1&gt;</span><br><span class="line">                &lt;p&gt;常见问题&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;找回密码&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;会员介绍&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;购物演示&lt;/p&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_mi_li01&quot;</span>&gt;</span><br><span class="line">                &lt;h1&gt;服务保障&lt;/h1&gt;</span><br><span class="line">                &lt;p&gt;常见问题&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;找回密码&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;会员介绍&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;购物演示&lt;/p&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_mi_li06&quot;</span>&gt;</span><br><span class="line">                &lt;h1&gt;客服中心&lt;/h1&gt;</span><br><span class="line">                &lt;img src=<span class="string">&quot;images/qrcode_jprj.jpg&quot;</span> width=<span class="string">&quot;80px&quot;</span> height=<span class="string">&quot;80px&quot;</span>&gt;</span><br><span class="line">                &lt;p&gt;抢红包、疑问咨询、优惠活动&lt;/p&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_bottom&quot;</span>&gt;</span><br><span class="line">        &lt;p <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_links&quot;</span>&gt;</span><br><span class="line">            &lt;a href=<span class="string">&quot;#&quot;</span>&gt;关于我们&lt;/a&gt;|</span><br><span class="line">            &lt;a href=<span class="string">&quot;#&quot;</span>&gt;联系我们&lt;/a&gt;|</span><br><span class="line">            &lt;a href=<span class="string">&quot;#&quot;</span>&gt;友情链接&lt;/a&gt;|</span><br><span class="line">            &lt;a href=<span class="string">&quot;#&quot;</span>&gt;供货商入驻&lt;/a&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">        &lt;p&gt;沪ICP备<span class="number">14033591</span>号-<span class="number">8</span> 杰普软件briup.com版权所有 杰普软件科技有限公司 &lt;/p&gt;</span><br><span class="line">        &lt;img src=<span class="string">&quot;images/police.png&quot;</span>&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="更新购物车数量"><a href="#更新购物车数量" class="headerlink" title="更新购物车数量"></a>更新购物车数量</h2><h3 id="分析-7"><a href="#分析-7" class="headerlink" title="==分析=="></a>==分析==</h3><ul>
<li><p>接收指定数量和bookId</p>
</li>
<li><p>清除原订单项数据</p>
</li>
<li><p>添加新订单项数据</p>
</li>
</ul>
<h3 id="UpdateCartServlet"><a href="#UpdateCartServlet" class="headerlink" title="UpdateCartServlet"></a>UpdateCartServlet</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Book;</span><br><span class="line"><span class="keyword">import</span> com.briup.bean.ShopCart;</span><br><span class="line"><span class="keyword">import</span> com.briup.util.BookInfoUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/9-09-09-23:19</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：com.briup.web.servlet</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/updateCart&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UpdateCartServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> bookId = Integer.parseInt(req.getParameter(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">        <span class="keyword">int</span> num = Integer.parseInt(req.getParameter(<span class="string">&quot;num&quot;</span>));</span><br><span class="line">        <span class="comment">// 获取到指定书</span></span><br><span class="line">        Book book = BookInfoUtil.getBookById(req, bookId);</span><br><span class="line">        HttpSession session = req.getSession();</span><br><span class="line">        <span class="comment">// 加入购物车(书,数量)</span></span><br><span class="line">        ShopCart shopCart = (ShopCart) session.getAttribute(<span class="string">&quot;shopCart&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (shopCart == <span class="keyword">null</span>) &#123;</span><br><span class="line">            shopCart = <span class="keyword">new</span> ShopCart();</span><br><span class="line">        &#125;</span><br><span class="line">        shopCart.remove(book.getId());</span><br><span class="line">        shopCart.addBook(book, num);</span><br><span class="line">        session.setAttribute(<span class="string">&quot;shopCart&quot;</span>,shopCart);</span><br><span class="line">        <span class="comment">// 转发到购物车</span></span><br><span class="line">        req.getRequestDispatcher(<span class="string">&quot;/shopCart.jsp&quot;</span>).forward(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="ShopCart"><a href="#ShopCart" class="headerlink" title="ShopCart"></a>ShopCart</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从购物车移除指定商品</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        cart.remove(id);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>





<h2 id="移除购物车商品"><a href="#移除购物车商品" class="headerlink" title="移除购物车商品"></a>移除购物车商品</h2><h3 id="分析-8"><a href="#分析-8" class="headerlink" title="==分析=="></a>==分析==</h3><ul>
<li>map移除该商品即可</li>
</ul>
<h3 id="shopCart-jsp-1"><a href="#shopCart-jsp-1" class="headerlink" title="shopCart.jsp"></a>shopCart.jsp</h3><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:forEach items=<span class="string">&quot;$&#123;shopCart.orderLines&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;orderLine&quot;</span>&gt;</span><br><span class="line">                &lt;form action=<span class="string">&quot;/updateCart&quot;</span>&gt;</span><br><span class="line">                    &lt;table&gt;</span><br><span class="line">                        &lt;tbody&gt;</span><br><span class="line">                        &lt;tr&gt;</span><br><span class="line">                            &lt;td <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;index&quot;</span>&gt;<span class="number">1</span>&lt;/td&gt;</span><br><span class="line">                            &lt;td&gt;</span><br><span class="line">                                &lt;img src=<span class="string">&quot;$&#123;orderLine.book.image&#125;&quot;</span> &gt;</span><br><span class="line">                                &lt;span&gt;</span><br><span class="line">                                   $&#123;orderLine.book.name&#125;</span><br><span class="line">                                    &lt;br&gt;</span><br><span class="line">                                &lt;/span&gt;</span><br><span class="line">                            &lt;/td&gt;</span><br><span class="line">                            &lt;td&gt;</span><br><span class="line">                                &lt;span&gt;¥$&#123;orderLine.book.price&#125;&lt;/span&gt;</span><br><span class="line">                            &lt;/td&gt;</span><br><span class="line">                            &lt;td <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;index2&quot;</span>&gt;</span><br><span class="line">                                &lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;id&quot;</span> value=<span class="string">&quot;$&#123;orderLine.book.id&#125;&quot;</span>&gt;</span><br><span class="line">                                &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;num&quot;</span> value=<span class="string">&quot;$&#123;orderLine.num&#125;&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">                                &lt;span&gt;有货&lt;/span&gt;</span><br><span class="line">                            &lt;/td&gt;</span><br><span class="line">                            &lt;td&gt;</span><br><span class="line">                                &lt;span&gt;¥$&#123;orderLine.cost&#125;&lt;/span&gt;</span><br><span class="line">                            &lt;/td&gt;</span><br><span class="line">                            &lt;td&gt;</span><br><span class="line">                                &lt;%--button 放在form表单中默认走action请求--%&gt;</span><br><span class="line">                                &lt;button&gt;更新&lt;/button&gt;</span><br><span class="line">                                &lt;button&gt;</span><br><span class="line">                                    &lt;a href=<span class="string">&quot;/removeCart?id=$&#123;orderLine.book.id&#125;&quot;</span>&gt;</span><br><span class="line">                                        删除</span><br><span class="line">                                    &lt;/a&gt;</span><br><span class="line">                                &lt;/button&gt;</span><br><span class="line">                            &lt;/td&gt;</span><br><span class="line">                        &lt;/tr&gt;</span><br><span class="line">                        &lt;/tbody&gt;</span><br><span class="line">                    &lt;/table&gt;</span><br><span class="line">                &lt;/form&gt;</span><br><span class="line">            &lt;/c:forEach&gt;</span><br></pre></td></tr></table></figure>



<h3 id="RemoveFromCart"><a href="#RemoveFromCart" class="headerlink" title="RemoveFromCart"></a>RemoveFromCart</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Book;</span><br><span class="line"><span class="keyword">import</span> com.briup.bean.ShopCart;</span><br><span class="line"><span class="keyword">import</span> com.briup.util.BookInfoUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/10-09-10-0:07</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：com.briup.web.servlet</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/removeCart&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeleteFromCart</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> bookId = Integer.parseInt(req.getParameter(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">        <span class="comment">// 获取到指定书</span></span><br><span class="line">        Book book = BookInfoUtil.getBookById(req, bookId);</span><br><span class="line">        HttpSession session = req.getSession();</span><br><span class="line">        <span class="comment">// 加入购物车(书,数量)</span></span><br><span class="line">        ShopCart shopCart = (ShopCart) session.getAttribute(<span class="string">&quot;shopCart&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (shopCart == <span class="keyword">null</span>) &#123;</span><br><span class="line">            shopCart = <span class="keyword">new</span> ShopCart();</span><br><span class="line">        &#125;</span><br><span class="line">        shopCart.remove(book.getId());</span><br><span class="line">        session.setAttribute(<span class="string">&quot;shopCart&quot;</span>,shopCart);</span><br><span class="line">        <span class="comment">// 转发到购物车</span></span><br><span class="line">        req.getRequestDispatcher(<span class="string">&quot;/shopCart.jsp&quot;</span>).forward(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h1 id="5-订单模块"><a href="#5-订单模块" class="headerlink" title="5 订单模块"></a>5 订单模块</h1><h2 id="准备提交"><a href="#准备提交" class="headerlink" title="准备提交"></a>准备提交</h2><h3 id="分析-9"><a href="#分析-9" class="headerlink" title="==分析=="></a>==分析==</h3><ul>
<li>在真正提交之前,先跳转到确认页面</li>
<li>选择收货信息<ul>
<li>查找以前的收货信息</li>
<li>添加新的收货信息</li>
</ul>
</li>
</ul>
<h3 id="ConfirmServlet"><a href="#ConfirmServlet" class="headerlink" title="ConfirmServlet"></a>ConfirmServlet</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Customer;</span><br><span class="line"><span class="keyword">import</span> com.briup.bean.ShopAddress;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.ShopAddressService;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.impl.ShopAddressServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/10-09-10-13:27</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：下单之前选择地址</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/confirm&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfirmServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 根据用户获取地址</span></span><br><span class="line">        HttpSession session = req.getSession();</span><br><span class="line">        Customer customer = (Customer) session.getAttribute(<span class="string">&quot;customer&quot;</span>);</span><br><span class="line"></span><br><span class="line">        ShopAddressService shopaddressService  = <span class="keyword">new</span> ShopAddressServiceImpl();</span><br><span class="line">        List&lt;ShopAddress&gt; shopAddressList = shopaddressService.findAddressByCustomer(customer.getId());</span><br><span class="line">        session.setAttribute(<span class="string">&quot;shopAddressList&quot;</span>,shopAddressList);</span><br><span class="line">        <span class="comment">// 跳转到confirm页面</span></span><br><span class="line">        req.getRequestDispatcher(<span class="string">&quot;/confirm.jsp&quot;</span>).forward(req,resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="ShopAddressServiceImpl"><a href="#ShopAddressServiceImpl" class="headerlink" title="ShopAddressServiceImpl"></a>ShopAddressServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.ShopAddress;</span><br><span class="line"><span class="keyword">import</span> com.briup.dao.ShopAddressMapper;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.ShopAddressService;</span><br><span class="line"><span class="keyword">import</span> com.briup.util.MyBatisSqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/10-09-10-13:45</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：com.briup.service.impl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShopAddressServiceImpl</span> <span class="keyword">implements</span> <span class="title">ShopAddressService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> SqlSession sqlSession = MyBatisSqlSessionFactory.openSession(<span class="keyword">true</span>);</span><br><span class="line">    <span class="keyword">private</span> ShopAddressMapper shopAddressMapper = sqlSession.getMapper(ShopAddressMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;ShopAddress&gt; <span class="title">findAddressByCustomer</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> shopAddressMapper.findShopAddressByCId(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>###ShopAddressMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.briup.dao.ShopAddressMapper&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findShopAddressByCId&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">resultType</span>=<span class="string">&quot;com.briup.bean.ShopAddress&quot;</span>&gt;</span></span><br><span class="line">        select *</span><br><span class="line">        from es_shopaddress</span><br><span class="line">        where customer_id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="confirm-jsp"><a href="#confirm-jsp" class="headerlink" title="confirm.jsp"></a>confirm.jsp</h3><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;c&quot;</span> uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> %&gt;</span><br><span class="line"></span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> isELIgnored=<span class="string">&quot;false&quot;</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html;charset=UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;结算页面&lt;/title&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;css/common.css&quot;</span>/&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;css/icons.css&quot;</span> /&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;css/table.css&quot;</span> /&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;css/orderSure.css&quot;</span> /&gt;</span><br><span class="line">    &lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">        <span class="function">function <span class="title">showAdres</span><span class="params">(sp)</span></span>&#123;</span><br><span class="line">            <span class="keyword">var</span> pa = document.getElementById(<span class="string">&quot;newAdres&quot;</span>);</span><br><span class="line">            console.log(pa.style[<span class="string">&#x27;display&#x27;</span>]);</span><br><span class="line">            <span class="keyword">if</span>(pa.style[<span class="string">&#x27;display&#x27;</span>]==<span class="string">&quot;none&quot;</span>)&#123;</span><br><span class="line">                pa.style[<span class="string">&#x27;display&#x27;</span>] = <span class="string">&#x27;block&#x27;</span>;</span><br><span class="line">                sp.innerHTML = <span class="string">&quot;取消新增地址&quot;</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                pa.style[<span class="string">&#x27;display&#x27;</span>] = <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">                sp.innerHTML = <span class="string">&quot;新增收货地址&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;!--顶部--&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;top&quot;</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;top_center&quot;</span>&gt;</span><br><span class="line">        &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;top_bars&quot;</span>&gt;</span><br><span class="line">            &lt;li&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;退出&lt;/a&gt;|&lt;/li&gt;</span><br><span class="line">            &lt;li&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;我的订单&lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;jt_down&quot;</span>&gt;&lt;/span&gt;&lt;/a&gt;|&lt;/li&gt;</span><br><span class="line">            &lt;li&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;关注杰普&lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;jt_down&quot;</span>&gt;&lt;/span&gt;&lt;/a&gt;|&lt;/li&gt;</span><br><span class="line">            &lt;li&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;网站导航&lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;jt_down&quot;</span>&gt;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;!--头部--&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;header3&quot;</span>&gt;</span><br><span class="line">    &lt;a href=<span class="string">&quot;#&quot;</span>&gt;&lt;img src=<span class="string">&quot;images/logo.png&quot;</span>  <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;oneImg&quot;</span>&gt;&lt;/a&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;h3_right&quot;</span>&gt;</span><br><span class="line">        &lt;img src=<span class="string">&quot;images/play_03.png&quot;</span> alt=<span class="string">&quot;&quot;</span>&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;p <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;orderButtom&quot;</span>&gt;填写并核对订单信息&lt;/p&gt;</span><br><span class="line">&lt;!--中间复杂部分--&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;content&quot;</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;contentCenter&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">        &lt;form action=<span class="string">&quot;/submit&quot;</span> name=<span class="string">&quot;orderForm&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;centerTop&quot;</span>&gt;</span><br><span class="line">                &lt;b style=<span class="string">&quot;font-size:20px;&quot;</span>&gt;收货人信息&lt;/b&gt;</span><br><span class="line"></span><br><span class="line">                &lt;b style=<span class="string">&quot;float: right;cursor: pointer;&quot;</span> onclick=<span class="string">&quot;showAdres(this);&quot;</span></span><br><span class="line">                   ondblclick=<span class="string">&quot;hideAdres(this);&quot;</span>&gt;新增收货地址&lt;/b&gt;</span><br><span class="line">                &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;adres&quot;</span>&gt;</span><br><span class="line">                    &lt;c:forEach items=<span class="string">&quot;$&#123;shopAddressList&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;shopAddrss&quot;</span>&gt;</span><br><span class="line">                        &lt;li&gt;</span><br><span class="line">                            &lt;input type=<span class="string">&quot;radio&quot;</span> name=<span class="string">&quot;shopAddId&quot;</span> value=<span class="string">&quot;$&#123;shopAddrss.id&#125;&quot;</span> style=<span class="string">&quot;width:50px&quot;</span>&gt;</span><br><span class="line">                            $&#123;shopAddrss.receiveName&#125;&amp;nbsp;&amp;nbsp;&amp;nbsp; $&#123;shopAddrss.address&#125;&amp;nbsp;&amp;nbsp;&amp;nbsp; $&#123;shopAddrss.phone&#125;</span><br><span class="line">                        &lt;/li&gt;</span><br><span class="line">                    &lt;/c:forEach&gt;</span><br><span class="line"></span><br><span class="line">                &lt;/ul&gt;</span><br><span class="line"></span><br><span class="line">                &lt;p id=<span class="string">&quot;newAdres&quot;</span> style=<span class="string">&quot;font-size:15px;display: none;&quot;</span>&gt;</span><br><span class="line">                    收件人姓名：&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;receiveName&quot;</span>&gt;&lt;br/&gt;&lt;br/&gt;</span><br><span class="line">                    收件人电话：&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;phone&quot;</span> &gt;</span><br><span class="line">                    收件人地址：&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;address&quot;</span>&gt;&lt;br/&gt;&lt;br/&gt;</span><br><span class="line">                &lt;/p&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            &lt;p <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;singleP&quot;</span>&gt;&lt;b&gt;送货清单&lt;/b&gt;&lt;span&gt;&lt;a href=<span class="string">&quot;shopCart.jsp&quot;</span>&gt;返回修改购物车&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;bigDiv&quot;</span>&gt;</span><br><span class="line">                &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;twoDiv&quot;</span>&gt;</span><br><span class="line">                    &lt;b&gt;商家：briup自营&lt;/b&gt;</span><br><span class="line">                    &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;oneUL&quot;</span>&gt;</span><br><span class="line">                        &lt;c:forEach items=<span class="string">&quot;$&#123;shopCart.orderLines&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;orderLine&quot;</span>&gt;</span><br><span class="line">                            &lt;li&gt;</span><br><span class="line">                                &lt;img src=<span class="string">&quot;$&#123;orderLine.book.image&#125;&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pic&quot;</span>&gt;</span><br><span class="line">                                &lt;p&gt;计算机&amp;nbsp;&amp;nbsp;$&#123;orderLine.book.category.name&#125;&amp;nbsp;&amp;nbsp;$&#123;orderLine.book.name&#125;&amp;nbsp;&amp;nbsp;&lt;/p&gt;</span><br><span class="line">                                &lt;p&gt;&lt;font&gt;¥$&#123;orderLine.book.price&#125;&lt;/font&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;×$&#123;orderLine.num&#125;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;有货&lt;/p&gt;</span><br><span class="line">                                &lt;p&gt;&lt;img src=<span class="string">&quot;images/sureLogo_14.png&quot;</span> alt=<span class="string">&quot;&quot;</span>&gt;&lt;span&gt;七天无理由退换货&lt;/span&gt;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">                            &lt;/li&gt;</span><br><span class="line">                        &lt;/c:forEach&gt;</span><br><span class="line"></span><br><span class="line">                        &lt;li&gt;&lt;pre&gt;【赠品】  高级定制干花书签  随机 ×<span class="number">1</span>&lt;/pre&gt;&lt;/li&gt;</span><br><span class="line">                    &lt;/ul&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;money&quot;</span>&gt;</span><br><span class="line">                &lt;span&gt;&lt;font&gt;$&#123;shopCart.size&#125;&lt;/font&gt;件商品，总商品金额：&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;¥$&#123;shopCart.totalCost&#125;&lt;/span&gt;</span><br><span class="line">                &lt;span&gt;&lt;img src=<span class="string">&quot;images/sureLogo_18.png&quot;</span> alt=<span class="string">&quot;&quot;</span>&gt;运费：&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;¥<span class="number">0.00</span>&lt;/span&gt;</span><br><span class="line"></span><br><span class="line">                &lt;span&gt;应付总额：&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;¥$&#123;shopCart.totalCost&#125;&lt;/span&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;submit&quot;</span>&gt;</span><br><span class="line">                &lt;span&gt;应付金额：&lt;font&gt;¥$&#123;shopCart.totalCost&#125;&lt;/font&gt;&lt;input type=<span class="string">&quot;image&quot;</span> src=<span class="string">&quot;images/21_03.png&quot;</span>&gt;&lt;/span&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;!--脚部--&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;footer3&quot;</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_top&quot;</span>&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_center&quot;</span>&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;ts1&quot;</span>&gt;品目繁多 愉悦购物&lt;/div&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;ts2&quot;</span>&gt;正品保障 天天低价&lt;/div&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;ts3&quot;</span>&gt;极速物流 特色定制&lt;/div&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;ts4&quot;</span>&gt;优质服务 以客为尊&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_middle&quot;</span>&gt;</span><br><span class="line">        &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_center&quot;</span>&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_mi_li01&quot;</span>&gt;</span><br><span class="line">                &lt;h1&gt;购物指南&lt;/h1&gt;</span><br><span class="line">                &lt;p&gt;常见问题&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;找回密码&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;会员介绍&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;购物演示&lt;/p&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_mi_li01&quot;</span>&gt;</span><br><span class="line">                &lt;h1&gt;配送方式&lt;/h1&gt;</span><br><span class="line">                &lt;p&gt;常见问题&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;找回密码&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;会员介绍&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;购物演示&lt;/p&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_mi_li01&quot;</span>&gt;</span><br><span class="line">                &lt;h1&gt;支付方式&lt;/h1&gt;</span><br><span class="line">                &lt;p&gt;常见问题&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;找回密码&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;会员介绍&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;购物演示&lt;/p&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_mi_li01&quot;</span>&gt;</span><br><span class="line">                &lt;h1&gt;售后服务&lt;/h1&gt;</span><br><span class="line">                &lt;p&gt;常见问题&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;找回密码&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;会员介绍&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;购物演示&lt;/p&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_mi_li01&quot;</span>&gt;</span><br><span class="line">                &lt;h1&gt;服务保障&lt;/h1&gt;</span><br><span class="line">                &lt;p&gt;常见问题&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;找回密码&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;会员介绍&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;购物演示&lt;/p&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_mi_li06&quot;</span>&gt;</span><br><span class="line">                &lt;h1&gt;客服中心&lt;/h1&gt;</span><br><span class="line">                &lt;img src=<span class="string">&quot;images/qrcode_jprj.jpg&quot;</span> width=<span class="string">&quot;80px&quot;</span> height=<span class="string">&quot;80px&quot;</span>&gt;</span><br><span class="line">                &lt;p&gt;抢红包、疑问咨询、优惠活动&lt;/p&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_bottom&quot;</span>&gt;</span><br><span class="line">        &lt;p <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_links&quot;</span>&gt;</span><br><span class="line">            &lt;a href=<span class="string">&quot;#&quot;</span>&gt;关于我们&lt;/a&gt;|</span><br><span class="line">            &lt;a href=<span class="string">&quot;#&quot;</span>&gt;联系我们&lt;/a&gt;|</span><br><span class="line">            &lt;a href=<span class="string">&quot;#&quot;</span>&gt;友情链接&lt;/a&gt;|</span><br><span class="line">            &lt;a href=<span class="string">&quot;#&quot;</span>&gt;供货商入驻&lt;/a&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">        &lt;p&gt;沪ICP备<span class="number">14033591</span>号-<span class="number">8</span> 杰普软件briup.com版权所有 杰普软件科技有限公司 &lt;/p&gt;</span><br><span class="line">        &lt;img src=<span class="string">&quot;images/police.png&quot;</span>&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="提交订单"><a href="#提交订单" class="headerlink" title="==提交订单=="></a>==提交订单==</h2><h3 id="分析-10"><a href="#分析-10" class="headerlink" title="==分析=="></a>==分析==</h3><ul>
<li>封装订单数据<ul>
<li>封装基本信息</li>
<li>封装地址信息<ul>
<li>如果选择的是旧地址</li>
<li>如果插入了新地址</li>
</ul>
</li>
<li>封装客户信息</li>
<li>封装订单项信息</li>
</ul>
</li>
<li>清空购物车</li>
<li>根据客户查找订单信息</li>
<li>跳转订单列表</li>
</ul>
<h3 id="SubmitServlet"><a href="#SubmitServlet" class="headerlink" title="SubmitServlet"></a>SubmitServlet</h3><blockquote>
<p>注意: 页面输入框一定有值 空字符串</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.*;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.OrderFormService;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.ShopAddressService;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.impl.OrderFormServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.impl.ShopAddressServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/10-09-10-16:26</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：提交订单</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/submit&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SubmitServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        String shopAddId =req.getParameter(<span class="string">&quot;shopAddId&quot;</span>);</span><br><span class="line">        String receiveName = req.getParameter(<span class="string">&quot;receiveName&quot;</span>);</span><br><span class="line">        String address = req.getParameter(<span class="string">&quot;address&quot;</span>);</span><br><span class="line">        String phone = req.getParameter(<span class="string">&quot;phone&quot;</span>);</span><br><span class="line">        HttpSession session = req.getSession();</span><br><span class="line">        Customer customer = (Customer) session.getAttribute(<span class="string">&quot;customer&quot;</span>);</span><br><span class="line">        ShopCart shopCart = (ShopCart) session.getAttribute(<span class="string">&quot;shopCart&quot;</span>);</span><br><span class="line">        ShopAddress shopAddress = <span class="keyword">null</span>;</span><br><span class="line">        ShopAddressService shopAddressService = <span class="keyword">new</span> ShopAddressServiceImpl();</span><br><span class="line">        <span class="comment">// 获取地址信息</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="string">&quot;&quot;</span>.equals(receiveName) &amp;&amp; !<span class="string">&quot;&quot;</span>.equals(address) &amp;&amp; !<span class="string">&quot;&quot;</span>.equals(phone)) &#123;</span><br><span class="line">            <span class="comment">// 新地址 需要保存到数据库中</span></span><br><span class="line">            shopAddress = <span class="keyword">new</span> ShopAddress();</span><br><span class="line">            shopAddress.setCustomer(customer);</span><br><span class="line">            shopAddressService.saveShopAddress(shopAddress);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(shopAddId != <span class="keyword">null</span>)&#123;</span><br><span class="line">                <span class="comment">// 旧地址</span></span><br><span class="line">                shopAddress = shopAddressService.findAddressById(Integer.parseInt(shopAddId));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        Collection&lt;OrderLine&gt; orderLines = shopCart.getOrderLines();</span><br><span class="line">        <span class="keyword">double</span> cost = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (OrderLine orderLine : orderLines) &#123;</span><br><span class="line">            cost += orderLine.getCost();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 封装订单类</span></span><br><span class="line">        OrderForm orderForm = <span class="keyword">new</span> OrderForm();</span><br><span class="line">        orderForm.setShopAddress(shopAddress);</span><br><span class="line">        orderForm.setOrderLines(orderLines);</span><br><span class="line">        orderForm.setCustomer(customer);</span><br><span class="line">        orderForm.setCost(cost);</span><br><span class="line">        orderForm.setOrderDate(<span class="keyword">new</span> Date());</span><br><span class="line">        <span class="comment">// 添加订单</span></span><br><span class="line">        OrderFormService orderFormServcie = <span class="keyword">new</span> OrderFormServiceImpl();</span><br><span class="line">        orderFormServcie.saveOrderForm(orderForm);</span><br><span class="line">        <span class="comment">// 清空购物车</span></span><br><span class="line">        shopCart.clear();</span><br><span class="line">        <span class="comment">// 查询订单</span></span><br><span class="line">        resp.sendRedirect(<span class="string">&quot;/findAllOrderForm&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="ShopAddressServiceImpl-1"><a href="#ShopAddressServiceImpl-1" class="headerlink" title="ShopAddressServiceImpl"></a>ShopAddressServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.ShopAddress;</span><br><span class="line"><span class="keyword">import</span> com.briup.dao.ShopAddressMapper;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.ShopAddressService;</span><br><span class="line"><span class="keyword">import</span> com.briup.util.MyBatisSqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/10-09-10-13:45</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：com.briup.service.impl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShopAddressServiceImpl</span> <span class="keyword">implements</span> <span class="title">ShopAddressService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> SqlSession sqlSession = MyBatisSqlSessionFactory.openSession(<span class="keyword">true</span>);</span><br><span class="line">    <span class="keyword">private</span> ShopAddressMapper shopAddressMapper = sqlSession.getMapper(ShopAddressMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;ShopAddress&gt; <span class="title">findAddressByCustomer</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> shopAddressMapper.findShopAddressByCId(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveShopAddress</span><span class="params">(ShopAddress shopAddress)</span> </span>&#123;</span><br><span class="line">        shopAddressMapper.saveShopAddress(shopAddress);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ShopAddress <span class="title">findAddressById</span><span class="params">(<span class="keyword">int</span> shopAddId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> shopAddressMapper.findAddressById(shopAddId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="ShopAddressMapper-xml"><a href="#ShopAddressMapper-xml" class="headerlink" title="ShopAddressMapper.xml"></a>ShopAddressMapper.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.briup.dao.ShopAddressMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findShopAddressByCId&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">resultType</span>=<span class="string">&quot;com.briup.bean.ShopAddress&quot;</span>&gt;</span></span><br><span class="line">        select *</span><br><span class="line">        from es_shopaddress</span><br><span class="line">        where customer_id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;saveShopAddress&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;shopAddress&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">        insert into es_shopaddress(receiveName,address,phone,customer_id)</span><br><span class="line">		values(#&#123;receiveName&#125;,#&#123;address&#125;,#&#123;phone&#125;,#&#123;customer.id&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAddressById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;shopAddress&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">        select id,receiveName,address,phone,customer_id</span><br><span class="line">		from es_shopaddress where id= #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="OrderFormServiceImpl"><a href="#OrderFormServiceImpl" class="headerlink" title="OrderFormServiceImpl"></a>OrderFormServiceImpl</h3><blockquote>
<p>注意: 订单项需要保存订单id</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.OrderForm;</span><br><span class="line"><span class="keyword">import</span> com.briup.bean.OrderLine;</span><br><span class="line"><span class="keyword">import</span> com.briup.dao.OrderFormMapper;</span><br><span class="line"><span class="keyword">import</span> com.briup.dao.OrderLineMapper;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.OrderFormService;</span><br><span class="line"><span class="keyword">import</span> com.briup.util.MyBatisSqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/10-09-10-16:51</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：com.briup.service.impl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderFormServiceImpl</span> <span class="keyword">implements</span> <span class="title">OrderFormService</span> </span>&#123;</span><br><span class="line">    SqlSession session = MyBatisSqlSessionFactory.openSession(<span class="keyword">false</span>);</span><br><span class="line">    OrderFormMapper orderFormMapper = session.getMapper(OrderFormMapper.class);</span><br><span class="line">    OrderLineMapper orderLineMapper = session.getMapper(OrderLineMapper.class);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveOrderForm</span><span class="params">(OrderForm orderForm)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">try</span>&#123;</span><br><span class="line">           <span class="comment">// 保存订单</span></span><br><span class="line">           orderFormMapper.saveOrderForm(orderForm);</span><br><span class="line">           <span class="comment">// 保存订单项</span></span><br><span class="line">           Collection&lt;OrderLine&gt; orderLines = orderForm.getOrderLines();</span><br><span class="line">           orderLines.forEach(orderLine -&gt; &#123;</span><br><span class="line">               orderLine.setOrderForm(orderForm);</span><br><span class="line">           &#125;);</span><br><span class="line">           orderLineMapper.saveOrderLine(orderForm.getOrderLines());</span><br><span class="line">           session.commit();</span><br><span class="line">       &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">           session.rollback();</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="OrderFormMapper-java"><a href="#OrderFormMapper-java" class="headerlink" title="OrderFormMapper.java"></a>OrderFormMapper.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OrderFormMapper</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">saveOrderForm</span><span class="params">(OrderForm orderForm)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="OrderFormMapper-xml"><a href="#OrderFormMapper-xml" class="headerlink" title="OrderFormMapper.xml"></a>OrderFormMapper.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.briup.dao.OrderFormMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;saveOrderForm&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;orderForm&quot;</span></span></span><br><span class="line"><span class="tag">		<span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">		insert into</span><br><span class="line">		es_orderform(cost,orderDate,shopAddress_id,customer_id)</span><br><span class="line">		values(#&#123;cost&#125;,#&#123;orderDate&#125;,#&#123;shopAddress.id&#125;,#&#123;customer.id&#125;)</span><br><span class="line">	<span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="OrderLineMapper-java"><a href="#OrderLineMapper-java" class="headerlink" title="OrderLineMapper.java"></a>OrderLineMapper.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OrderLineMapper</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">saveOrderLineList</span><span class="params">(Collection&lt;OrderLine&gt; orderLines)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="OrderLineMapper-xml"><a href="#OrderLineMapper-xml" class="headerlink" title="OrderLineMapper.xml"></a>OrderLineMapper.xml</h3><blockquote>
<p>此处使用了批量插入 也可单个循环插入</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.briup.dao.OrderLineMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;saveOrderLine&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;collection&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">		insert into</span><br><span class="line">		es_orderline(num,cost,book_id,orderForm_id)</span><br><span class="line">		values</span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;collection&quot;</span> <span class="attr">item</span>=<span class="string">&quot;orderLine&quot;</span> <span class="attr">index</span>=<span class="string">&quot;index&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            (</span><br><span class="line">                #&#123;orderLine.num&#125;,</span><br><span class="line">                #&#123;orderLine.cost&#125;,</span><br><span class="line">                #&#123;orderLine.book.id&#125;,</span><br><span class="line">                #&#123;orderLine.orderForm.id&#125;</span><br><span class="line">            )</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="ShopCart-1"><a href="#ShopCart-1" class="headerlink" title="ShopCart"></a>ShopCart</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       cart.clear();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h2 id="查看自己订单"><a href="#查看自己订单" class="headerlink" title="查看自己订单"></a>查看自己订单</h2><h3 id="分析-11"><a href="#分析-11" class="headerlink" title="==分析=="></a>==分析==</h3><ul>
<li>客户只能查到与自己相关的订单</li>
<li>级联地址信息</li>
</ul>
<h3 id="FindAllOrderForm"><a href="#FindAllOrderForm" class="headerlink" title="FindAllOrderForm"></a>FindAllOrderForm</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Customer;</span><br><span class="line"><span class="keyword">import</span> com.briup.bean.OrderForm;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.OrderFormService;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.impl.OrderFormServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/11-09-11-8:41</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：com.briup.web.servlet</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/findAllOrderForm&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FindAllOrderForm</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        HttpSession session = req.getSession();</span><br><span class="line">        Customer customer = (Customer) session.getAttribute(<span class="string">&quot;customer&quot;</span>);</span><br><span class="line">        OrderFormService orderFormService = <span class="keyword">new</span> OrderFormServiceImpl();</span><br><span class="line">        List&lt;OrderForm&gt; orderFormList = orderFormService.findAllOrderForm(customer.getId());</span><br><span class="line">        session.setAttribute(<span class="string">&quot;orderFormList&quot;</span>,orderFormList);</span><br><span class="line">        resp.sendRedirect(<span class="string">&quot;orderList.jsp&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="OrderFormServiceImpl-1"><a href="#OrderFormServiceImpl-1" class="headerlink" title="OrderFormServiceImpl"></a>OrderFormServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> List&lt;OrderForm&gt; <span class="title">findAllOrderForm</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> orderFormMapper.findAllOrderForm(id);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="OrderFormMapper-xml-1"><a href="#OrderFormMapper-xml-1" class="headerlink" title="OrderFormMapper.xml"></a>OrderFormMapper.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;orderFormMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;orderForm&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;cost&quot;</span> <span class="attr">property</span>=<span class="string">&quot;cost&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;orderDate&quot;</span> <span class="attr">property</span>=<span class="string">&quot;orderDate&quot;</span> /&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--收货人 注意: findAddressById的返回形式需要resultMap--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;shopAddress&quot;</span></span></span><br><span class="line"><span class="tag">		<span class="attr">column</span>=<span class="string">&quot;shopAddress_id&quot;</span> <span class="attr">select</span>=<span class="string">&quot;com.briup.dao.ShopAddressMapper.findAddressById&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAllOrderForm&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;orderFormMap&quot;</span>&gt;</span></span><br><span class="line">       select id,cost,orderDate,shopAddress_id,customer_id</span><br><span class="line">	from</span><br><span class="line">	es_orderform</span><br><span class="line">	where customer_id = #&#123;id&#125;</span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="ShopAddressMapper-xml-1"><a href="#ShopAddressMapper-xml-1" class="headerlink" title="ShopAddressMapper.xml"></a>ShopAddressMapper.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;ShopAddress&quot;</span> <span class="attr">id</span>=<span class="string">&quot;ShopAddressResult&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;receiveName&quot;</span> <span class="attr">property</span>=<span class="string">&quot;receiveName&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;address&quot;</span> <span class="attr">property</span>=<span class="string">&quot;address&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;phone&quot;</span> <span class="attr">property</span>=<span class="string">&quot;phone&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAddressById&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;ShopAddressResult&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">       select id,receiveName,address,phone,customer_id</span><br><span class="line">	from es_shopaddress where id= #&#123;id&#125;</span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="orderList-jsp"><a href="#orderList-jsp" class="headerlink" title="orderList.jsp"></a>orderList.jsp</h3><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:forEach items=<span class="string">&quot;$&#123;orderFormList&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;orderForm&quot;</span> varStatus=<span class="string">&quot;v&quot;</span>&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">                &lt;td align=<span class="string">&quot;center&quot;</span>&gt;$&#123;v.index+<span class="number">1</span>&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;$&#123;orderForm.id&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;$&#123;orderForm.cost&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;未付款&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;$&#123;orderForm.shopAddress.receiveName&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;&lt;input type=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;删除&quot;</span> onclick=<span class="string">&quot;javascript:window.location=&#x27;orderlist.html&#x27;;&quot;</span>&gt;&lt;input type=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;明细&quot;</span> onclick=<span class="string">&quot;javascript:window.location=&#x27;orderdetail.html&#x27;;&quot;</span>&gt;  &lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">        &lt;/c:forEach&gt;</span><br></pre></td></tr></table></figure>



<h2 id="查看订单详情"><a href="#查看订单详情" class="headerlink" title="查看订单详情"></a>查看订单详情</h2><h3 id="分析-12"><a href="#分析-12" class="headerlink" title="==分析=="></a>==分析==</h3><ul>
<li>级联书的信息</li>
</ul>
<p>###orderList.jsp</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;明细&quot;</span> onclick=<span class="string">&quot;javascript:window.location=&#x27;/orderDetail?id=$&#123;orderForm.id&#125;&#x27;;&quot;</span>&gt;</span><br></pre></td></tr></table></figure>



<h3 id="OrderDetailServlet"><a href="#OrderDetailServlet" class="headerlink" title="OrderDetailServlet"></a>OrderDetailServlet</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/orderDetail&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderDetailServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> id = Integer.parseInt(req.getParameter(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">        OrderLineService orderLineService = <span class="keyword">new</span> OrderLineServiceImpl();</span><br><span class="line">        List&lt;OrderLine&gt; orderLineList = orderLineService.findOrderLinesByOrderFormId(id);</span><br><span class="line">        HttpSession session = req.getSession();</span><br><span class="line">        session.setAttribute(<span class="string">&quot;orderLineList&quot;</span>,orderLineList);</span><br><span class="line">        req.getRequestDispatcher(<span class="string">&quot;/orderDetail.jsp&quot;</span>).forward(req,resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="OrderLineServiceImpl"><a href="#OrderLineServiceImpl" class="headerlink" title="OrderLineServiceImpl"></a>OrderLineServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.OrderLine;</span><br><span class="line"><span class="keyword">import</span> com.briup.dao.OrderLineMapper;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.OrderLineService;</span><br><span class="line"><span class="keyword">import</span> com.briup.util.MyBatisSqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/11-09-11-9:22</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：com.briup.service.impl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderLineServiceImpl</span> <span class="keyword">implements</span> <span class="title">OrderLineService</span> </span>&#123;</span><br><span class="line">    SqlSession session = MyBatisSqlSessionFactory.openSession(<span class="keyword">false</span>);</span><br><span class="line">    OrderLineMapper orderLineMapper = session.getMapper(OrderLineMapper.class);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;OrderLine&gt; <span class="title">findOrderLinesByOrderFormId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> orderLineMapper.findOrderLinesByOrderFormId(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveOrderLine</span><span class="params">(Collection&lt;OrderLine&gt; orderLines)</span> </span>&#123;</span><br><span class="line">        orderLineMapper.saveOrderLine(orderLines);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="OrderLineMapper-xml-1"><a href="#OrderLineMapper-xml-1" class="headerlink" title="OrderLineMapper.xml"></a>OrderLineMapper.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;OrderLine&quot;</span> <span class="attr">id</span>=<span class="string">&quot;OrderLineResult&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;num&quot;</span> <span class="attr">property</span>=<span class="string">&quot;num&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;cost&quot;</span> <span class="attr">property</span>=<span class="string">&quot;cost&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;book&quot;</span> <span class="attr">column</span>=<span class="string">&quot;book_id&quot;</span></span></span><br><span class="line"><span class="tag">			<span class="attr">select</span>=<span class="string">&quot;com.briup.dao.BookMapper.findBookById&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findOrderLinesByOrderFormId&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;OrderLineResult&quot;</span>&gt;</span></span><br><span class="line">        select * from es_orderline</span><br><span class="line">        where orderForm_id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="BookMapper-xml-1"><a href="#BookMapper-xml-1" class="headerlink" title="BookMapper.xml"></a>BookMapper.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;book&quot;</span> <span class="attr">id</span>=<span class="string">&quot;simpleBookMap&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;price&quot;</span> <span class="attr">property</span>=<span class="string">&quot;price&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;author&quot;</span> <span class="attr">property</span>=<span class="string">&quot;author&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;publisher&quot;</span> <span class="attr">property</span>=<span class="string">&quot;publisher&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;pubDate&quot;</span> <span class="attr">property</span>=<span class="string">&quot;pubDate&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;description&quot;</span> <span class="attr">property</span>=<span class="string">&quot;description&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;image&quot;</span> <span class="attr">property</span>=<span class="string">&quot;image&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findBookById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;simpleBookMap&quot;</span>&gt;</span></span><br><span class="line">        select * from es_book</span><br><span class="line">        where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="orderDetail-jsp"><a href="#orderDetail-jsp" class="headerlink" title="orderDetail.jsp"></a>orderDetail.jsp</h3><blockquote>
<p>此处使用&lt;c:set&gt; 循环计算</p>
</blockquote>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;tbody&gt;</span><br><span class="line">        &lt;c:set <span class="keyword">var</span>=<span class="string">&quot;totalCost&quot;</span> value=<span class="string">&quot;0&quot;</span>/&gt;</span><br><span class="line">        &lt;c:forEach items=<span class="string">&quot;$&#123;orderLineList&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;orderLine&quot;</span> varStatus=<span class="string">&quot;v&quot;</span>&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">                &lt;td&gt;$&#123;v.index&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;$&#123;orderLine.book.name&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;价格：&lt;span&gt;$&#123;orderLine.book.price&#125;&lt;/span&gt;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;数量：&lt;span&gt;$&#123;orderLine.num&#125;&lt;/span&gt;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;小计：&lt;span&gt; $&#123;orderLine.book.price&#125; * $&#123;orderLine.num&#125;&lt;/span&gt;&lt;/td&gt;</span><br><span class="line">                &lt;c:set <span class="keyword">var</span>=<span class="string">&quot;totalCost&quot;</span> value=<span class="string">&quot;$&#123;orderLine.book.price * orderLine.num + totalCost&#125;&quot;</span>/&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">        &lt;/c:forEach&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td colspan=<span class="string">&quot;5&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;count&quot;</span>&gt;合计：&lt;span&gt;$&#123;totalCost&#125;&lt;/span&gt;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;/tbody&gt;</span><br></pre></td></tr></table></figure>



<h2 id="删除订单"><a href="#删除订单" class="headerlink" title="删除订单"></a>删除订单</h2><h3 id="分析-13"><a href="#分析-13" class="headerlink" title="==分析=="></a>==分析==</h3><ul>
<li>订单被订单项引用 不能直接删除</li>
<li>先删除引用了订单的所有订单项信息,再删除订单</li>
</ul>
<h3 id="orderList-jsp-1"><a href="#orderList-jsp-1" class="headerlink" title="orderList.jsp"></a>orderList.jsp</h3><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;删除&quot;</span> onclick=<span class="string">&quot;javascript:window.location=&#x27;/orderDelete?id=$&#123;orderForm.id&#125;&#x27;;&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<h3 id="OrderDelete"><a href="#OrderDelete" class="headerlink" title="OrderDelete"></a>OrderDelete</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.service.OrderFormService;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.impl.OrderFormServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/11-09-11-11:11</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：com.briup.web.servlet</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/orderDelete&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderDelete</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> id = Integer.parseInt(req.getParameter(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">        OrderFormService orderFormService  = <span class="keyword">new</span> OrderFormServiceImpl();</span><br><span class="line">        orderFormService.deleteOrderById(id);</span><br><span class="line"></span><br><span class="line">        req.getRequestDispatcher(<span class="string">&quot;/findAllOrderForm&quot;</span>).forward(req,resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="OrderFormServiceImpl-2"><a href="#OrderFormServiceImpl-2" class="headerlink" title="OrderFormServiceImpl"></a>OrderFormServiceImpl</h3><blockquote>
<p>注意: 订单和订单项有外键关联</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteOrderById</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">       List&lt;OrderLine&gt; orderList = orderLineService.findOrderLinesByOrderFormId(id);</span><br><span class="line">       orderLineService.deleteBatch(orderList);</span><br><span class="line">       orderFormMapper.deleteById(id);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="OrderLineServiceImpl-1"><a href="#OrderLineServiceImpl-1" class="headerlink" title="OrderLineServiceImpl"></a>OrderLineServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteBatch</span><span class="params">(List&lt;OrderLine&gt; orderList)</span> </span>&#123;</span><br><span class="line">    orderLineMapper.deleteBatch(orderList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="OrderLineMapper-xml-2"><a href="#OrderLineMapper-xml-2" class="headerlink" title="OrderLineMapper.xml"></a>OrderLineMapper.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteBatch&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">        delete from es_orderLine</span><br><span class="line">        where id in</span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span> <span class="attr">item</span>=<span class="string">&quot;orderLine&quot;</span>&gt;</span></span><br><span class="line">           #&#123;orderLine.id&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="OrderFormMapper-xml-2"><a href="#OrderFormMapper-xml-2" class="headerlink" title="OrderFormMapper.xml"></a>OrderFormMapper.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">       delete from es_orderform</span><br><span class="line">       where id = #&#123;id&#125;</span><br><span class="line">   <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h1 id="6-集成沙箱"><a href="#6-集成沙箱" class="headerlink" title="6 集成沙箱"></a>6 集成沙箱</h1><h2 id="1-沙箱及配置"><a href="#1-沙箱及配置" class="headerlink" title="1.沙箱及配置"></a>1.沙箱及配置</h2><p><code>注意： 不要使用谷歌浏览器...否则沙箱页面无法刷新</code></p>
<p><strong>1.登陆蚂蚁金服官网</strong> <a target="_blank" rel="noopener" href="https://www.antgroup.com/">https://www.antgroup.com/</a></p>
<hr>
<p><strong>2.划到尾页，点击支付宝开放平台</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310740736.png" alt="image-20201029103938947"></p>
<hr>
<p><strong>3.点击立即入驻（注册过的直接扫码登陆）</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310740246.png" alt="image-20201029104756001"></p>
<hr>
<p><strong>4.填写身份信息注册沙箱账号</strong></p>
<hr>
<p><strong>5.注册完跳转页面，选择沙箱</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310740505.png" alt="image-20201029105235780"></p>
<hr>
<p><strong>6.跳转页面，点击开放平台控制台</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310740589.png" alt="image-20201029105359667"></p>
<hr>
<p><strong>7.跳转登陆页面，扫码登陆</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310740571.png" alt="image-20201029105433185"></p>
<hr>
<p><strong>8.跳转页面，点击研发服务</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310740781.png" alt="image-20201029105527432"></p>
<hr>
<p><strong>9.沙箱页面</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310740078.png" alt="image-20211025212114663"></p>
<ul>
<li>==沙箱应用  个人app以及公钥私钥信息==</li>
<li>沙箱账号 商家和买家信息</li>
<li>沙箱工具 手机沙箱支付宝app</li>
</ul>
<hr>
<p><strong>10.此时需要设置公钥和私钥，点击设置沙箱应用 查看密钥</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310740085.png" alt="image-20211025212357088"></p>
<p>系统生成</p>
<ul>
<li><p>应用公钥不用</p>
</li>
<li><p>应用私钥和支付宝公钥放程序</p>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310740614.png" alt="image-20211025212504112"></p>
<hr>
<h2 id="2-集成项目"><a href="#2-集成项目" class="headerlink" title="2.集成项目"></a>2.集成项目</h2><p><strong>1.导入支付宝依赖</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alipay.sdk<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>alipay-sdk-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.8.10.ALL<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<p><strong>2.封装配置类 AlipayConfig.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AlipayConfig</span> </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 服务网关   沙箱环境都是这个  </span></span><br><span class="line"><span class="comment">     (去沙箱应用中复制该信息 沙箱应用/支付宝网关 )</span></span><br><span class="line"><span class="comment">   */</span>								</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> String serverUrl = <span class="string">&quot;https://openapi.alipaydev.com/gateway.do&quot;</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 应用id  后期可以替换成自己的id</span></span><br><span class="line"><span class="comment">   	(去沙箱应用中复制该信息 沙箱应用/APPID)</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> String appId = <span class="string">&quot;2016102500758175&quot;</span>;<span class="comment">//2016102500758175</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   RSA2密钥（公钥模式)</span></span><br><span class="line"><span class="comment">   应用私钥   后期替换成自己的私钥 </span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> String privateKey =<span class="string">&quot;MIIEvAIBADANBgkqhkiG9w0BAQEFAASCBKYwggSAgEAAoIBAQC0+d4lR1AOvmduCyg3cBFxyRDUK//TOA7ct9kilfGcHjjk65HFz9UAQSsImdAd+YsAtOL0Fy1RtUdOjGZTG1nKG5eQnJo4gHXavvfnr5iDsdWOz8RUjV0YBK8uBtiEcJ98WuXUU5T3YEvdN8zOkq861Kq39VKElbFRgkfW3ZO97yDgVL3o2aic6IM/rB99a/AuDQggi4Ok84K0GPK64U/7eynR2Yr2kelPt03P6Gm5K3tw5miPKo/60ajKquM1yCyUQQ+6T9ebwN2hhkEfH6NdqJMVs05MfgKWzWm3jL/JJ54bFbWhz1GuB5lnzM2v3cz6mAnc7a6xbyOG1VMeqfVLAgMBAAECggEAJIaFokp5SvB82YXg8QdqTefBwMC8mjmnLj7g0Q0oPVUQMIum2SCwIaQFdm/sxA/4UQUxBQikeeg3YxANGtrbTWIyPdqNebfbkXGXgSg8hN/gdTlTq6j4T/+qB4UUL+63EZca6baQyzihNx2q9Uo/mYUQi540sFOx/PxpWWFRDzUbpH1Mip0fpSpdlq/rYNwnCtoOHx7AQYQWpFEWUr6WvaLhKEgICnzfsrmmPiyLX4rZ1H9gpf/zOeSP6l7HtGUc7vsbgKGBERx0Kx7FvYG41MEItev3zEklpwFwX4fHqc2wkCgBWuMnE5VuXQtToY6Z2236uyOn97fVneIFXi/b2QKBgQDwwH1XTav8qUL11A58y/K2w7KDXM7vMOgve4rXUpxakkaYYst4b9jzH1xODM2D3PGIE6v1omyLrj7khNlRBd7ffnIymzT32HE7V1Q3/SoJlLV8tcv+hETKF/Ycu5osrvc5da1JTVMc72lODNlHbYqOAW8DU9mGqX9TJToOU3iVjQKBgQDAcC61KstO0CGZZlJ7NvNBXrhAk2lKdNm3gd/nz9YRc3hyo07dT6RErbT1bim2dbO4lAkrf/qDnXWQjyh9b5c2hCV8BposaeJGxXbmsiPtsjrr+Fg6+KYv11PMyBMu1eF1gboRvAB0e8wbbLl8rlFmOSsS8HZRz09NR8aFViIkNwKBgFY6i2omjrArK6mCr0GxhphBVYHJTvDK0o6XMC5ZD1k9RP21fO0BGnJRzCzEVyOgkf3MFe4fo8MPwMT2dCOZ966SynIntvwCUOQRLj/zdAgEdFBbiNn7I+xCUssNwnW4oSG6bTtw75DQiyYCYhw8NsEP8GP/t0yNDuaH0dhpuynNAoGAHdDDy9oHifyBWC0cVm7bHaO5VHgCdkDIgsAimt3+wtFrNgfLbkqqnuFzChu5ZsWxxMVa7lxzyfSZhH5JvbWObinnTOIQ/RSitGhf1bqACpH0wx7FPM3Nodfw6eeN4VHODtC8rYa9Y07S/uTHkGPJxNbSr6qGCoLePJEEVyBTRd0CgYBbvf9/d8lybwvIVGi4YS72on4w86n64bS8EbBCZtmqwAKmGKLIsvSnlubEyP88dYtP6Hp6N8DExDd9I45OxdsX7CIRmfaPH+LT6oytWCiObtNK6ME4y/yaIpLuDKaFLg2fetJd6RyHd2nngbNgmVKVRu6tjIIKqbDkW8Q4XP+etg==&quot;</span>;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   *  发送数据的格式 目前只能为json</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> String format = <span class="string">&quot;json&quot;</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   *  设置字符集编码 目前只能为utf-8</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> String charset = <span class="string">&quot;utf-8&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  	  RSA2密钥（公钥模式)</span></span><br><span class="line"><span class="comment">     支付宝公钥 后期替换成自己的支付宝公钥 </span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> String publicKey = <span class="string">&quot;MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAlb5JITbNNGuhnCwn2QXxYjh/iyLML/GT5omOMT+GD+vNY4ID6fn5oQDA8jByatzwMjoC251mj4TIRY1hb51FbAcfwkQEFuSULyVFgDiC4ae+JZSHEwIzseznrQT0rqcIDj8Y70wRFcfL92bFzh/ETBrbE31nfc34hLATUpz3FOOAFuE4wx4KTW/OsugyKyVns+JAIIdlzNzZSEnh4DaL8/2OrWL+Em21pr50gaQQu1lGly9ArrKCnuICIa7lcGKEct0yeSaDA25UZg+YSodZCVUpWe3bOhrGDy4gn2AZiLfkejr2e3aPoETIIz1tBV011ZU+/zIzYrdnEt+O4gFQwIDAQAB&quot;</span>;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   *  支付宝签名 目前是 RSA2</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> String signType = <span class="string">&quot;RSA2&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   *  页面跳转同步通知页面路径 需http://格式的完整路径，不能加?id=123这类自定义参数，必须外网可以正常访问</span></span><br><span class="line"><span class="comment">   *  付款结束后跳转的页面</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> String return_url = <span class="string">&quot;http://localhost:8080/estore_alipay/index.jsp&quot;</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> AlipayClient <span class="title">getAlipayClient</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="comment">// 获得初始化的AlipayClient</span></span><br><span class="line">      AlipayClient alipayClient = <span class="keyword">new</span> DefaultAlipayClient</span><br><span class="line">    		  (AlipayConfig.serverUrl, AlipayConfig.appId, </span><br><span class="line">    		AlipayConfig.privateKey, AlipayConfig.format, </span><br><span class="line">    		AlipayConfig.charset, AlipayConfig.publicKey, AlipayConfig.signType);</span><br><span class="line">      <span class="keyword">return</span> alipayClient;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<hr>
<p><strong>3.引入支付接口(注意配置访问路径)</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PayServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		doGet(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//拿到订单id</span></span><br><span class="line">	     String orderid = request.getParameter(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">		<span class="comment">//调用service去数据库中查询当前订单</span></span><br><span class="line">	     OrderServiceImpl ordImpl = <span class="keyword">new</span> OrderServiceImpl();</span><br><span class="line">	     OrderForm orderForm = </span><br><span class="line">	    		 ordImpl.findOrderFormById(Integer.parseInt(orderid));</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//支付</span></span><br><span class="line">	    <span class="comment">//浏览器动态产生一个付钱的二维码</span></span><br><span class="line">	     <span class="comment">/**</span></span><br><span class="line"><span class="comment">	      * 需要将我们的项目接入支付宝</span></span><br><span class="line"><span class="comment">	      * 入驻蚂蚁金服平台</span></span><br><span class="line"><span class="comment">	      */</span></span><br><span class="line">	     </span><br><span class="line">	     <span class="keyword">try</span> &#123;</span><br><span class="line">	          AlipayClient alipayClient =</span><br><span class="line">	                  AlipayConfig.getAlipayClient();</span><br><span class="line">	          <span class="comment">//设置请求参数</span></span><br><span class="line">	          AlipayTradePagePayRequest alipayRequest = </span><br><span class="line">	                  <span class="keyword">new</span> AlipayTradePagePayRequest();</span><br><span class="line">	          </span><br><span class="line">	          AlipayTradePayModel model = </span><br><span class="line">	                  <span class="keyword">new</span> AlipayTradePayModel();</span><br><span class="line">	          <span class="comment">// 设定订单号 必须要写,且订单号不能重复，目前已经只是做测试，已经写死</span></span><br><span class="line">	          model.setOutTradeNo(System.currentTimeMillis()+<span class="string">&quot;&quot;</span>);</span><br><span class="line">	          <span class="comment">// 设置订单金额</span></span><br><span class="line">	          model.setTotalAmount(orderForm.getCost()+<span class="string">&quot;&quot;</span>);</span><br><span class="line">	          <span class="comment">// 订单名字</span></span><br><span class="line">	          model.setSubject(<span class="string">&quot;书籍订单&quot;</span>);</span><br><span class="line">	          <span class="comment">// 订单描述</span></span><br><span class="line">	          model.setBody(System.currentTimeMillis()+<span class="string">&quot;&quot;</span>);</span><br><span class="line">	          <span class="comment">// 产品码</span></span><br><span class="line">	          model.setProductCode(<span class="string">&quot;FAST_INSTANT_TRADE_PAY&quot;</span>);</span><br><span class="line">	          <span class="comment">// 设置参数</span></span><br><span class="line">	          alipayRequest.setBizModel(model);</span><br><span class="line">	          <span class="comment">// 设置回调地址</span></span><br><span class="line">	          alipayRequest.setReturnUrl(AlipayConfig.return_url);</span><br><span class="line">	          String result = alipayClient.pageExecute(alipayRequest).getBody();</span><br><span class="line">	          response.setContentType(<span class="string">&quot;text/html;charset=utf-8&quot;</span>);</span><br><span class="line">	          response.getWriter().println(result);</span><br><span class="line">	      &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">	              e.printStackTrace();</span><br><span class="line">	      &#125;  </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<hr>
<p><strong>4.此时需要添加业务 根据id查看订单信息</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> OrderForm <span class="title">findOrderFormById</span><span class="params">(<span class="keyword">int</span> parseInt)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> orderFormMapper.findOrderFormById(parseInt);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findOrderFormById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.briup.bean.OrderForm&quot;</span>&gt;</span></span><br><span class="line">         select *  from es_orderform</span><br><span class="line">        where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>



<hr>
<p><strong>5.修改提交订单接口</strong></p>
<p>==先跳转到支付页面 支付完成回调订单列表==</p>
<p><strong>SubmitOrderServlet</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//resp.sendRedirect(&quot;/findAllOrder&quot;);</span></span><br><span class="line"> resp.sendRedirect(<span class="string">&quot;/pay?id=&quot;</span>+orderForm.getId());</span><br></pre></td></tr></table></figure>

<hr>
<p><strong>AlipayConfig</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   *  页面跳转同步通知页面路径 需http://格式的完整路径，不能加?id=123这类自定义参数，必须外网可以正常访问</span></span><br><span class="line"><span class="comment">   *  付款结束后跳转的页面</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> String return_url = <span class="string">&quot;http://localhost:8888/findAllOrder&quot;</span>;</span><br></pre></td></tr></table></figure>



<hr>
<p><strong>6.效果</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310741407.png" alt="image-20211025211711375"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310741773.png" alt="image-20211025211419465"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310741984.png" alt="image-20211025211611145"></p>
<h2 id="3-事务问题"><a href="#3-事务问题" class="headerlink" title="3.事务问题"></a>3.事务问题</h2><p>此处无法获取到对方接口业务</p>
<h1 id="7-内网穿透"><a href="#7-内网穿透" class="headerlink" title="7 内网穿透"></a>7 内网穿透</h1><p>1.<a target="_blank" rel="noopener" href="https://www.ngrok.cc/user.html">注册账号</a></p>
<p>2.购买服务</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310741511.png" alt="image-20210421205740360"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310741431.png" alt="image-20210421210034680"></p>
<p>3.<a target="_blank" rel="noopener" href="https://www.ngrok.cc/download.html">下载工具</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310741731.png" alt="image-20210421210648426"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310741654.png" alt="image-20210421211051357"></p>
<p>4.<a target="_blank" rel="noopener" href="http://vanse.free.idcfengye.com/">测试</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310742264.png" alt="image-20211025221147680"></p>
<p><code>此时后台tomcat要启动着</code></p>
<h1 id="8-部署linux"><a href="#8-部署linux" class="headerlink" title="8 部署linux"></a>8 部署linux</h1><h2 id="1-购买阿里云"><a href="#1-购买阿里云" class="headerlink" title="1.购买阿里云"></a>1.购买阿里云</h2><ul>
<li><p>登陆<a target="_blank" rel="noopener" href="https://developer.aliyun.com/plan/grow-up">阿里云</a></p>
</li>
<li><p>搜索云翼计划 购买学生机==9.9/月==</p>
<p><img src="https://wangsidandan.github.io/images/image-20201029143054774.png" alt="image-20201029143054774"></p>
</li>
<li><p>购买后记住ip 配置root密码</p>
</li>
<li><p>在服务器中选择操作系统 可选ubuntu16</p>
</li>
<li><p>在本地远程登陆阿里云 可使用自带xshell工具或者putty第三方工具</p>
<ul>
<li>输入阿里云账号 端口号默认22</li>
</ul>
<p><img src="https://wangsidandan.github.io/images/image-20201029145231540.png" alt="image-20201029145231540"></p>
<ul>
<li><p>登陆成功</p>
<p><img src="https://wangsidandan.github.io/images/image-20201029145437515.png" alt="image-20201029145437515"></p>
</li>
</ul>
</li>
</ul>
<h2 id="2-配置用户环境"><a href="#2-配置用户环境" class="headerlink" title="2.配置用户环境"></a>2.配置用户环境</h2><p>1.修改主机名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl set-hostname ‘ubuntu’</span><br></pre></td></tr></table></figure>



<p>然后去阿里云控制台重启服务器。</p>
<p> 2.创建非root用户</p>
<blockquote>
<p>创建普通用户：briup/briup</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adduser briup</span><br><span class="line">passwd briup</span><br></pre></td></tr></table></figure>

<p>3.给新用户授予权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sudoers</span><br></pre></td></tr></table></figure>



<p><img src="https://wangsidandan.github.io/images/image-20201029150720491.png" alt="image-20201029150720491"></p>
<p> 4.切换briup用户登陆</p>
<p><img src="https://wangsidandan.github.io/images/image-20201029150946144.png" alt="image-20201029150946144"></p>
<h2 id="3-搭建JavaWeb运行环境"><a href="#3-搭建JavaWeb运行环境" class="headerlink" title="3.搭建JavaWeb运行环境"></a>3.搭建JavaWeb运行环境</h2><blockquote>
<p>与在本地启动项目一样，需要安装JDK环境，tomcat（服务器）以及mysql</p>
</blockquote>
<p> 1.安装JDK</p>
<ul>
<li><p>apt在线安装</p>
<h2 id="openjdk"><a href="#openjdk" class="headerlink" title="openjdk"></a>openjdk</h2><p>(1)查找合适的openjdk版本:</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-cache search openjdk</span><br></pre></td></tr></table></figure>



<p>(2)安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install openjdk-8-jdk</span><br></pre></td></tr></table></figure>



<p>(3) 配置环境变量, 编辑如下文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bashrc</span><br></pre></td></tr></table></figure>



<p>在最后加上一行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64</span><br><span class="line">export PATH=$JAVA_HOME/bin:$PATH</span><br><span class="line">export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br></pre></td></tr></table></figure>

<p>(4) 测试jdk是否安装成功:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -version</span><br></pre></td></tr></table></figure>

<p>显示如下结果, 则说明安装成功:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openjdk version “1.8.0_91” </span><br><span class="line">OpenJDK Runtime Environment (build 1.8.0_91-8u91-b14-0ubuntu4~15.10.1-b14) </span><br><span class="line">OpenJDK Server VM (build 25.91-b14, mixed mode)</span><br></pre></td></tr></table></figure>

<p>oraclejdk</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.oracle.com/java/technologies/javase/javase-jdk8-downloads.html">官网下载</a></p>
<p>==注：apt下载oracle需要仓库==</p>
<p>（1）将文件放置在briup用户下</p>
<p>==<strong>ubuntu中需要安装SSHServer</strong>==</p>
<p><code>sudo apt install openssh-server</code></p>
<p>方法一：shell工具</p>
<p><img src="https://wangsidandan.github.io/images/image-20201029155706089.png" alt="image-20201029155706089"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">说明： 把本地当前目录下的Hello.java文件复制到远程目录下的Desktop/Hello.java</span><br></pre></td></tr></table></figure>

<p>方法二：filezillla</p>
<p><img src="https://wangsidandan.github.io/images/image-20201029160615567.png" alt="image-20201029160615567"></p>
<p>（2）解压jdk的包</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xvf jdk...</span><br></pre></td></tr></table></figure>



<p>（3）配置环境变量 （家目录）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bashrc</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/home/briup/jdk1.8.0_74</span><br><span class="line">			export PATH=JAVA_HOME/bin:PATH</span><br><span class="line">			export CLASSPATH=.:./bin</span><br></pre></td></tr></table></figure>

<p>(4) 使配置资源生效</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source .bashrc</span><br></pre></td></tr></table></figure></li>
</ul>
<p> 2.安装tomcat</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://tomcat.apache.org/download-80.cgi">官网下载</a></li>
</ul>
<p>同上，将安装包移到服务器即可</p>
<p> 3.安装mysql</p>
<ul>
<li><p>在线安装</p>
<p>安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install mysql-server-5.7</span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 如果无法安装，尝试更新源</span></span><br><span class="line">apt-get update</span><br><span class="line">apt-get upgrade</span><br></pre></td></tr></table></figure>

<p>开启mysql远程访问</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">user</span>,host <span class="keyword">from</span> <span class="keyword">user</span></span><br></pre></td></tr></table></figure>



<p>可看到host全是localhost，</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310742834.png" alt="image-20201029162843368"></p>
<p><strong>localhost表示只能本地登录，可以将root账号对应的host改为%即可实现远程连接（暂不考虑安全性）</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update <span class="keyword">user</span> <span class="keyword">set</span> host <span class="operator">=</span> <span class="string">&#x27;%&#x27;</span> <span class="keyword">where</span> <span class="keyword">user</span> <span class="operator">=</span> <span class="string">&#x27;root&#x27;</span></span><br></pre></td></tr></table></figure>

<p>3 设置mysql编码</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/mysql/my.cnf</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[client]</span><br><span class="line">default-character-set=utf8</span><br><span class="line">[mysqld]</span><br><span class="line">character-set-server=utf8</span><br><span class="line">max_connections=1000</span><br><span class="line">!includedir /etc/mysql/conf.d/</span><br><span class="line">!includedir /etc/mysql/mysql.conf.d/</span><br><span class="line">bind-address=0.0.0.0</span><br></pre></td></tr></table></figure>

<p>4 重启mysql服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service mysql restart</span><br></pre></td></tr></table></figure>



<p>//service mysql status 查看mysql状态</p>
<p>5 卸载mysql</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.sudo apt-get autoremove --purge mysql-server</span><br><span class="line">2.sudo apt-get remove mysql-server</span><br><span class="line">3.sudo apt-get autoremove mysql-server</span><br><span class="line">4.sudo apt-get remove mysql-common</span><br><span class="line">5.清理残留数据 dpkg -l |grep mysql|awk &#x27;&#123;print $2&#125;&#x27; |sudo xargs dpkg -P </span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="4-部署war包"><a href="#4-部署war包" class="headerlink" title="4.部署war包"></a>4.部署war包</h2><p>1.将web项目打成war包</p>
<p>2.将war包放入服务器上tomcat/webapps下面</p>
<p>3.开启服务器,会自动解压war包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">COPYcd /tomcat/bin</span><br><span class="line">./startup.sh</span><br></pre></td></tr></table></figure>

<p>4.需要的话，修改默认端口号</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">COPYvim /tomcat/conf/server.xml</span><br><span class="line">找到&lt;connect &quot;8080&quot;&gt;</span><br><span class="line">    修改成你想要的端口</span><br></pre></td></tr></table></figure>

<p>5.在阿里云控制台上开放相关端口号</p>
<p>比如8080端口，3306或者你的项目端口，否则无法访问。</p>
<h1 id="9-首页相关"><a href="#9-首页相关" class="headerlink" title="9 首页相关"></a>9 首页相关</h1><h2 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h2><p>未登录不可下单</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.Filter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterConfig;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebFilter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebFilter(&#123;&quot;/confirm&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CheckLoginFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">		</span><br><span class="line">		HttpServletRequest req = (HttpServletRequest) request;</span><br><span class="line">		</span><br><span class="line">		HttpSession session = req.getSession(<span class="keyword">false</span>);</span><br><span class="line">		<span class="keyword">if</span>(session==<span class="keyword">null</span> || session.getAttribute(<span class="string">&quot;customer&quot;</span>)==<span class="keyword">null</span>) &#123;</span><br><span class="line">			req.setAttribute(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;请先进行登录&quot;</span>);</span><br><span class="line">			req.getRequestDispatcher(<span class="string">&quot;/login.jsp&quot;</span>).forward(req, response);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			chain.doFilter(request, response);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310742279.png" alt="image-20211025224240429" style="zoom:50%;" />



<h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><p>servlet模板  preferences/java/editor/templates</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> $&#123;enclosing_package&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="meta">@WebServlet(&quot;/&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> $</span>&#123;primary_type_name&#125; extends HttpServlet &#123;</span><br><span class="line"> 	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		$&#123;cursor&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		doGet(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

 
      <!-- reward -->
      
      <div id="reword-out">
        <div id="reward-btn">
          打赏
        </div>
      </div>
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/briup/" rel="tag">briup</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/project/" rel="tag">project</a></li></ul>

    </footer>
  </div>

   
  <nav class="article-nav">
    
      <a href="/archives/other/hyperledger-fabric.html" class="article-nav-link">
        <strong class="article-nav-caption">上一篇</strong>
        <div class="article-nav-title">
          
            hyperledger fabric
          
        </div>
      </a>
    
    
      <a href="/archives/briup/briup-spring.html" class="article-nav-link">
        <strong class="article-nav-caption">下一篇</strong>
        <div class="article-nav-title">briup-spring</div>
      </a>
    
  </nav>

  
   
<div class="gitalk" id="gitalk-container"></div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css">


<script src="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js"></script>


<script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script>

<script type="text/javascript">
  var gitalk = new Gitalk({
    clientID: 'abdf20cf8f71fc88e695',
    clientSecret: '050f9f7209fbd2e9f446fb0ade695e4e5dd12e84',
    repo: 'hexo_comment',
    owner: 'wangsidandan',
    admin: ['wangsidandan'],
    // id: location.pathname,      // Ensure uniqueness and length less than 50
    id: md5(location.pathname),
    distractionFreeMode: false,  // Facebook-like distraction free mode
    pagerDirection: 'last'
  })

  gitalk.render('gitalk-container')
</script>

     
</article>

</section>
      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2015-2022
        <i class="ri-heart-fill heart_icon"></i> vanse
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>访问人数:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>浏览次数:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.svg" alt="vanse"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/playlist">音乐</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/photos">相册</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/friends">友链</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="https://gitee.com/vanse/images/raw/master/bruip_course/aliapy.png">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="https://gitee.com/vanse/images/raw/master/bruip_course/wechat.png">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->
 
<script src="/js/tocbot.min.js"></script>

<script>
  tocbot.init({
    tocSelector: ".tocbot",
    contentSelector: ".article-entry",
    headingSelector: "h1, h2, h3, h4, h5, h6",
    hasInnerContainers: true,
    scrollSmooth: true,
    scrollContainer: "main",
    positionFixedSelector: ".tocbot",
    positionFixedClass: "is-position-fixed",
    fixedSidebarOffset: "auto",
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script>

<script src="/js/clickBoom1.js"></script>
 
<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->
 
<script src="/js/dz.js"></script>
 
<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    <div id="music">
    
    
    
    <iframe frameborder="no" border="1" marginwidth="0" marginheight="0" width="200" height="52"
        src="//music.163.com/outchain/player?type=2&id=506654324&auto=0&height=32"></iframe>
</div>

<style>
    #music {
        position: fixed;
        right: 15px;
        bottom: 0;
        z-index: 998;
    }
</style>
    
    
<script>
  const password = "vanse";
  const lock_password = window.sessionStorage.getItem("lock_password");
  console.log(password, lock_password);
  if (lock_password !== password) {
    Swal.fire({
      title: "请输入访问密码",
      input: "password",
      inputAttributes: {
        autocapitalize: "off",
      },
      showCancelButton: false,
      showLoaderOnConfirm: true,
      allowOutsideClick: false,
      confirmButtonText: "确定",
    }).then((result) => {
      console.log(result);
      if (result.isConfirmed) {
        console.log(password);
        if (result.value === password) {
          window.sessionStorage.setItem("lock_password", result.value);
        } else {
          Swal.fire({
            icon: "error",
            title: "密码错误，请重试",
            confirmButtonText: "确定",
            allowOutsideClick: false,
          }).then(() => {
            window.location.reload();
          });
        }
      }
    });
  }
</script>


  </div>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>

</html>