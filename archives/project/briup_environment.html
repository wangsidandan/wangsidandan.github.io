<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
        
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title>environment |  vanse</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/favicon.ico" />
       
<link rel="stylesheet" href="/dist/main.css">

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/css/remixicon.min.css"
      />
      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
       
 

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    </head>
  </html>
</html>


<body>
  <div id="app">
    
      <canvas class="fireworks"></canvas>
      <style>
        .fireworks {
          position: fixed;
          left: 0;
          top: 0;
          z-index: 99999;
          pointer-events: none;
        }
      </style>
      
      
    <main class="content on">
      <section class="outer">
  <article
  id="post-project/briup_environment"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h1 class="article-title sea-center" style="border-left:0" itemprop="name">
  environment
</h1>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/archives/project/briup_environment.html" class="article-date">
  <time datetime="2021-11-02T16:52:46.000Z" itemprop="datePublished">2021-11-03</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/project/">project</a>
  </div>
  
<div class="word_count">
    <span class="post-time">
        <span class="post-meta-item-icon">
            <i class="ri-quill-pen-line"></i>
            <span class="post-meta-item-text"> å­—æ•°ç»Ÿè®¡:</span>
            <span class="post-count">9k</span>
        </span>
    </span>

    <span class="post-time">
        &nbsp; | &nbsp;
        <span class="post-meta-item-icon">
            <i class="ri-book-open-line"></i>
            <span class="post-meta-item-text"> é˜…è¯»æ—¶é•¿â‰ˆ</span>
            <span class="post-count">46 åˆ†é’Ÿ</span>
        </span>
    </span>
</div>
 
    </div>
     
	
	 
		 
			
				
    <div class="tocbot"></div>




   
			 
		
		
		 
	
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="0-å‰è¨€"><a href="#0-å‰è¨€" class="headerlink" title="0 å‰è¨€"></a>0 å‰è¨€</h1><ul>
<li>:file_folder: ç‰©è”ç½‘ç¯å¢ƒç›‘æµ‹ç³»ç»Ÿ </li>
<li>:timer_clock: 2021/9/24</li>
<li>:school:  jd2017(èè‹±ç­)</li>
<li>:man_teacher:  å´”ç•¥(ä¸»è®²)</li>
<li>ğŸ‘¨â€ğŸ’»  vanse-åˆ˜èª(è¾…å¯¼) </li>
</ul>
<h1 id="1-é¡¹ç›®å‡†å¤‡"><a href="#1-é¡¹ç›®å‡†å¤‡" class="headerlink" title="1 é¡¹ç›®å‡†å¤‡"></a>1 é¡¹ç›®å‡†å¤‡</h1><p><img src="https://gitee.com/vanse/images/raw/master/environment/image-20210924140713895.png"></p>
<h2 id="æ•°æ®åº“"><a href="#æ•°æ®åº“" class="headerlink" title="æ•°æ®åº“"></a>æ•°æ®åº“</h2><blockquote>
<p>:tipping_hand_man:  æ­¤å¤„ä»¥Oracleä¸ºä¾‹ pl/sqlè¯­æ³•å¾ªç¯å»º31å¼ è¡¨</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--ä½¿ç”¨PL/SQLå»ºè¡¨</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">FOR</span> i <span class="keyword">IN</span> <span class="number">1.</span><span class="number">.31</span> LOOP</span><br><span class="line"><span class="keyword">EXECUTE</span> IMMEDIATE</span><br><span class="line"><span class="string">&#x27;CREATE TABLE e_detail_&#x27;</span><span class="operator">||</span>TO_CHAR(i)<span class="operator">||</span></span><br><span class="line"><span class="string">&#x27;(</span></span><br><span class="line"><span class="string">    name varchar2(20),</span></span><br><span class="line"><span class="string">    srcId varchar2(5),</span></span><br><span class="line"><span class="string">    desId varchar2(5),</span></span><br><span class="line"><span class="string">    devId varchar2(5),</span></span><br><span class="line"><span class="string">    sersorAddress varchar2(7),</span></span><br><span class="line"><span class="string">    count number(2),</span></span><br><span class="line"><span class="string">    cmd  varchar2(5),</span></span><br><span class="line"><span class="string">    status number(2),</span></span><br><span class="line"><span class="string">    data number(9,4),</span></span><br><span class="line"><span class="string">    gather_date date</span></span><br><span class="line"><span class="string">)&#x27;</span>;</span><br><span class="line"><span class="keyword">END</span> LOOP;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--åˆ é™¤31å¼ è¡¨</span></span><br><span class="line"><span class="comment">--ä½¿ç”¨PL/SQLåˆ é™¤è¡¨</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">FOR</span> i <span class="keyword">IN</span> <span class="number">1.</span><span class="number">.31</span> LOOP</span><br><span class="line"><span class="keyword">EXECUTE</span> IMMEDIATE</span><br><span class="line">	<span class="string">&#x27;DROP TABLE e_detail_&#x27;</span><span class="operator">||</span>TO_CHAR(i);</span><br><span class="line"><span class="keyword">END</span> LOOP;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="2-å®¢æˆ·ç«¯"><a href="#2-å®¢æˆ·ç«¯" class="headerlink" title="2 å®¢æˆ·ç«¯"></a>2 å®¢æˆ·ç«¯</h1><h2 id="é‡‡é›†æ•°æ®"><a href="#é‡‡é›†æ•°æ®" class="headerlink" title="é‡‡é›†æ•°æ®"></a>é‡‡é›†æ•°æ®</h2><p><code>å·²çŸ¥æ•°æ®</code></p>
<h3 id="Environment"><a href="#Environment" class="headerlink" title="Environment"></a><strong>Environment</strong></h3><blockquote>
<p>å½“16çš„æ—¶å€™  å¯¹åº”è¦è§£æä¸¤ä¸ªEnvironment æ¹¿åº¦å¯¹è±¡ æ¸©åº¦å¯¹è±¡ å³nameå±æ€§</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.smart.env.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.sql.Timestamp;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç¯å¢ƒå­˜å‚¨å®ä½“ç±»,åŒ…æ‹¬ç¯å¢ƒç§ç±»(æ¸©åº¦,æ¹¿åº¦,äºŒæ°§åŒ–ç¢³,å…‰ç…§å¼ºåº¦)</span></span><br><span class="line"><span class="comment"> 16 æ¸©/æ¹¿åº¦</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Environment</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//ç¯å¢ƒç§ç±»åç§°</span></span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="comment">//å‘é€ç«¯id</span></span><br><span class="line">	<span class="keyword">private</span> String srcId;</span><br><span class="line">	<span class="comment">//æ ‘è“æ´¾ç³»ç»Ÿid</span></span><br><span class="line">	<span class="keyword">private</span> String desId;</span><br><span class="line">	<span class="comment">//å®éªŒç®±åŒºåŸŸæ¨¡å—id(1-8)</span></span><br><span class="line">	<span class="keyword">private</span> String devId;</span><br><span class="line">	<span class="comment">//æ¨¡å—ä¸Šä¼ æ„Ÿå™¨åœ°å€ 16 256 1280</span></span><br><span class="line">	<span class="keyword">private</span> String sersorAddress;</span><br><span class="line">	<span class="comment">//ä¼ æ„Ÿå™¨ä¸ªæ•°</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> count;</span><br><span class="line">	<span class="comment">//å‘é€æŒ‡ä»¤æ ‡å· 3è¡¨ç¤ºæ¥æ”¶æ•°æ® 16è¡¨ç¤ºå‘é€å‘½ä»¤</span></span><br><span class="line">	<span class="keyword">private</span> String cmd;</span><br><span class="line">	<span class="comment">//ç¯å¢ƒå€¼</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">float</span> data;</span><br><span class="line">    </span><br><span class="line">   <span class="comment">//çŠ¶æ€ é»˜è®¤1è¡¨ç¤ºæˆåŠŸ</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> status;</span><br><span class="line">	<span class="comment">//é‡‡é›†æ—¶é—´</span></span><br><span class="line">	<span class="keyword">private</span> Timestamp gather_date;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//GET/SET</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="data-file-simple"><a href="#data-file-simple" class="headerlink" title="data-file-simple"></a>data-file-simple</h3><blockquote>
<p>:tipping_hand_man: æ•°æ®åªæœ‰9åˆ— è€ŒEnvironmentå¯¹è±¡æœ‰10ä¸ªå±æ€§</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">100|101|2|16|1|3|57a491fc02|1|1516413763738</span><br><span class="line">100|101|2|16|1|3|57a891fc02|1|1516413764761</span><br><span class="line">100|101|2|16|1|3|57a491fc02|1|1516413765686</span><br><span class="line">100|101|2|256|1|3|001c03|1|1516413766708</span><br><span class="line">100|101|2|256|1|3|001c03|1|1516413767731</span><br><span class="line">100|101|2|16|1|3|57a492d002|1|1516413768756</span><br><span class="line">100|101|2|1280|1|3|02f801|1|1516413769787</span><br><span class="line">100|101|2|1280|1|3|02f801|1|1516413770702</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>ä¸€è¡Œæ•°æ®è¡¨ç¤ºä¸€ç»„æ•°æ®ï¼Œæ¯ä¸ªæ•°æ®ä¹‹é—´ä½¿ç”¨â€œ|â€åˆ†å‰²ï¼Œæ¯è¡Œæ•°æ®éƒ½è¡¨ç¤ºä¸€ç§ç¯å¢ƒæ•°æ®ï¼ŒåŒæ—¶ï¼Œæ¯è¡Œæ•°æ®åˆ†ä¸ºä»¥ä¸‹ä¹ä¸ªå°éƒ¨åˆ†ï¼š</p>
<ol>
<li><p>å‘é€ç«¯id</p>
</li>
<li><p>æ ‘è“æ´¾ç³»ç»Ÿid</p>
</li>
<li><p>å®éªŒç®±åŒºåŸŸæ¨¡å—id(1-8)</p>
</li>
<li><p>æ¨¡å—ä¸Šä¼ æ„Ÿå™¨åœ°å€</p>
<ul>
<li>16ï¼Œè¡¨ç¤ºæ¸©åº¦å’Œæ¹¿åº¦æ•°æ®</li>
<li>256ï¼Œè¡¨ç¤ºå…‰ç…§å¼ºåº¦æ•°æ®</li>
<li>1280ï¼Œè¡¨ç¤ºäºŒæ°§åŒ–ç¢³æ•°æ®</li>
</ul>
</li>
<li><p>ä¼ æ„Ÿå™¨ä¸ªæ•°</p>
</li>
<li><p>æŒ‡ä»¤æ ‡å·</p>
<p>å¦‚æœæ˜¯3è¡¨ç¤ºéœ€è¦æ¥å—æ•°æ®ï¼Œå¦‚æœæ˜¯16è¡¨ç¤ºéœ€è¦å‘é€æ•°æ®</p>
</li>
<li><p><strong>ç¯å¢ƒæ•°æ®</strong></p>
</li>
<li><p>çŠ¶æ€æ ‡è¯†</p>
<p>é»˜è®¤ä¸º1ï¼Œè¡¨ç¤ºæˆåŠŸ</p>
</li>
<li><p>é‡‡é›†æ—¶é—´</p>
</li>
</ol>
<p><strong>ç‰¹åˆ«æ³¨æ„ï¼Œå…³äºä¸€è¡Œä¸­çš„ç¬¬7ä¸ªæ•°æ®éƒ¨åˆ†ï¼š</strong></p>
<p>è¿™éƒ¨åˆ†æ˜¯çœŸæ­£çš„ç¯å¢ƒæ•°æ®ï¼Œä½†æ˜¯ä½¿ç”¨çš„åå…­è¿›åˆ¶è¡¨ç¤ºï¼Œéœ€è¦è½¬æ¢ä¸ºåè¿›åˆ¶ï¼Œåˆ†ä¸‰ç§æƒ…å†µï¼š</p>
<ul>
<li><p>å¦‚æœå½“å‰æ˜¯æ¸©åº¦å’Œæ¹¿åº¦çš„æ•°æ®ï¼Œåˆ™å‰ä¸¤ä¸ªå­—èŠ‚æ˜¯æ¸©åº¦ï¼Œä¸­é—´ä¸¤ä¸ªå­—èŠ‚æ˜¯æ¹¿åº¦ï¼Œå‰©ä½™å­—èŠ‚ä¸ç”¨ç®¡</p>
</li>
<li><p>å¦‚æœå½“å‰æ˜¯å…‰ç…§å¼ºåº¦çš„æ•°æ®ï¼Œåˆ™å‰ä¸¤ä¸ªå­—èŠ‚å°±æ˜¯æ•°æ®å€¼ï¼Œå‰©ä½™å­—èŠ‚ä¸ç”¨ç®¡</p>
</li>
<li><p>å¦‚æœå½“å‰æ˜¯äºŒæ°§åŒ–ç¢³çš„æ•°æ®ï¼Œåˆ™å‰ä¸¤ä¸ªå­—èŠ‚å°±æ˜¯æ•°æ®å€¼ï¼Œå‰©ä½™å­—èŠ‚ä¸ç”¨ç®¡</p>
</li>
</ul>
<blockquote>
<p>æ³¨æ„ï¼Œä¸€ä¸ªå­—èŠ‚å¯ä»¥ç”±2ä¸ªåå…­è¿›åˆ¶è¡¨ç¤º</p>
</blockquote>
<p>æŠŠåå…­è¿›åˆ¶çš„ç¯å¢ƒæ•°æ®ï¼Œè½¬ä¸ºåè¿›åˆ¶çš„æ•°æ®ä¹‹åï¼Œè¿˜éœ€è¦è¿›ä¸€æ­¥å¤„ç†ï¼š</p>
<ul>
<li>å¦‚æœæ˜¯æ¸©åº¦æ•°æ®ï¼š(data*(0.00268127F))-46.85F</li>
<li>å¦‚æœæ˜¯æ¹¿åº¦æ•°æ®ï¼š(data*0.00190735F)-6</li>
<li>å¦‚æœæ˜¯äºŒæ°§åŒ–ç¢³å’Œå…‰ç…§å¼ºåº¦ï¼Œç›´æ¥è½¬æ¢å¾—åˆ°çš„åè¿›åˆ¶æ•°æ®å°±å¯ä»¥è¡¨ç¤º</li>
</ul>
<p><code>åˆ†æ</code></p>
<ul>
<li>è¯»å–simple-fileæ–‡ä»¶</li>
<li>è§£ææ¯ä¸€è¡Œ åˆ†åˆ«å°è£…åˆ° ä¸€ä¸ªEnvironmentå¯¹è±¡</li>
<li>ç¬¬4åˆ— å’Œ ç¬¬7åˆ—<ul>
<li>ç¬¬å››åˆ—<ul>
<li>16  </li>
<li>256</li>
<li>1280</li>
</ul>
</li>
<li>ç¬¬7åˆ— 16è¿›åˆ¶  57a491fc02  ==ä¸¤ä¸ªå­—èŠ‚  57a4==<ul>
<li>16 æ¸©/æ¹¿åº¦  æ¸©: å‰ä¸¤ä¸ªå­—èŠ‚ æ¹¿åº¦ : ä¸­é—´ä¸¤ä¸ªå­—èŠ‚</li>
<li>256 å…‰ç…§</li>
<li>1280 äºŒæ°§åŒ–ç¢³</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1ä¸ª  2ä¸ª16è¿›åˆ¶</span><br><span class="line">1ä¸ª  8ä¸ªäºŒè¿›åˆ¶ä½</span><br><span class="line">1ä¸ª16è¿›åˆ¶ 4ä¸ªäºŒè¿›åˆ¶è¡¨ç¤º  1/2ä¸ªå­—èŠ‚</span><br><span class="line">å› æ­¤  ä¸€ä¸ªå­—èŠ‚ä»£è¡¨2ä¸ª16è¿›åˆ¶</span><br></pre></td></tr></table></figure>





<p><code>è¿‡ç¨‹</code></p>
<p>###pom.xm</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- æ­¤å¤„ç‰ˆæœ¬å¯çœç•¥ --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.briup.smart<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>env-gather-interface<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="GatherImpl"><a href="#GatherImpl" class="headerlink" title="GatherImpl"></a>GatherImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.smart.env.client;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.sql.Timestamp;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.smart.env.entity.Environment;</span><br><span class="line"><span class="keyword">import</span> com.briup.smart.env.util.CopyUtil;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * é‡‡é›†æ•°æ®</span></span><br><span class="line"><span class="comment"> * 	å°†100|101|2|16|1|3|5f6c6ba002|1|1516323990934 å°è£…æˆ Environmentå¯¹è±¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GatherImpl</span> <span class="keyword">implements</span> <span class="title">Gather</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Collection&lt;Environment&gt; <span class="title">gather</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		InputStream in = GatherImpl.class.getClassLoader().getResourceAsStream(<span class="string">&quot;data-file-simple&quot;</span>);</span><br><span class="line">		BufferedReader br = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(in));</span><br><span class="line">		Collection&lt;Environment&gt; enColl = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">		<span class="comment">// 1.è¯»å–æ•°æ®</span></span><br><span class="line">		String line = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">while</span> ((line = br.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">			String[] lineData = line.split(<span class="string">&quot;[|]&quot;</span>);</span><br><span class="line">			Environment environment = <span class="keyword">new</span> Environment();</span><br><span class="line">			<span class="comment">// è®¾ç½®å‘é€ç«¯id</span></span><br><span class="line">			environment.setSrcId(lineData[<span class="number">0</span>]);</span><br><span class="line">			<span class="comment">// è®¾ç½®æ ‘è“æ´¾ç³»ç»Ÿid</span></span><br><span class="line">			environment.setDesId(lineData[<span class="number">1</span>]);</span><br><span class="line">			<span class="comment">// è®¾ç½®å®éªŒç®±åŒºåŸŸid</span></span><br><span class="line">			environment.setDevId(lineData[<span class="number">2</span>]);</span><br><span class="line">			<span class="comment">// è®¾ç½®æ¨¡å—ä¸Šä¼ åœ°å€</span></span><br><span class="line">			environment.setSersorAddress(lineData[<span class="number">3</span>]);</span><br><span class="line">			<span class="comment">// è®¾ç½®ä¼ æ„Ÿå™¨ä¸ªæ•°</span></span><br><span class="line">			environment.setCount(Integer.parseInt(lineData[<span class="number">4</span>]));</span><br><span class="line">			<span class="comment">// è®¾ç½®å‘é€æŒ‡ä»¤</span></span><br><span class="line">			environment.setCmd(lineData[<span class="number">5</span>]);</span><br><span class="line">			<span class="comment">// è®¾ç½®çŠ¶æ€</span></span><br><span class="line">			environment.setStatus(Integer.parseInt(lineData[<span class="number">7</span>]));</span><br><span class="line">			<span class="comment">// è®¾ç½®é‡‡é›†æ—¶é—´</span></span><br><span class="line">			environment.setGather_date(<span class="keyword">new</span> Timestamp(Long.parseLong(lineData[<span class="number">8</span>])));</span><br><span class="line">			<span class="comment">// è®¾ç½®ç¯å¢ƒç§ç±»</span></span><br><span class="line">			<span class="keyword">switch</span> (environment.getSersorAddress()) &#123;</span><br><span class="line">			<span class="comment">// 5d606f7802</span></span><br><span class="line">			<span class="keyword">case</span> <span class="string">&quot;16&quot;</span>:</span><br><span class="line">				environment.setName(<span class="string">&quot;æ¸©åº¦&quot;</span>);<span class="comment">// ä¹Ÿæœ‰å¯èƒ½æ˜¯æ¹¿åº¦</span></span><br><span class="line">				<span class="keyword">int</span> wendu = Integer.parseInt(lineData[<span class="number">6</span>].substring(<span class="number">0</span>, <span class="number">4</span>), <span class="number">16</span>);<span class="comment">// æ¸©åº¦æ•°æ®</span></span><br><span class="line">				environment.setData((wendu * (<span class="number">0.00268127F</span>)) - <span class="number">46.85F</span>);</span><br><span class="line">				Environment copy = CopyUtil.copy(environment);</span><br><span class="line">				copy.setName(<span class="string">&quot;æ¹¿åº¦&quot;</span>);</span><br><span class="line">				<span class="keyword">int</span> shidu = Integer.parseInt(lineData[<span class="number">6</span>].substring(<span class="number">4</span>, <span class="number">8</span>), <span class="number">16</span>);<span class="comment">// æ¹¿åº¦æ•°æ®</span></span><br><span class="line">				enColl.add(copy);</span><br><span class="line">				<span class="comment">// å¤åˆ¶å¯¹è±¡</span></span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="string">&quot;256&quot;</span>:</span><br><span class="line">				environment.setName(<span class="string">&quot;å…‰ç…§å¼ºåº¦&quot;</span>);</span><br><span class="line">				environment.setData(Integer.parseInt(lineData[<span class="number">6</span>].substring(<span class="number">0</span>, <span class="number">4</span>), <span class="number">16</span>));</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="string">&quot;1280&quot;</span>:</span><br><span class="line">				environment.setName(<span class="string">&quot;äºŒæ°§åŒ–ç¢³&quot;</span>);</span><br><span class="line">				environment.setData(Integer.parseInt(lineData[<span class="number">6</span>].substring(<span class="number">0</span>, <span class="number">4</span>), <span class="number">16</span>));</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			enColl.add(environment);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> enColl;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		Collection&lt;Environment&gt; enColl = <span class="keyword">new</span> GatherImpl().gather();</span><br><span class="line">        <span class="comment">// 106866æ¡æ•°æ®</span></span><br><span class="line">		System.out.println(enColl.size());</span><br><span class="line"><span class="comment">//		enColl.forEach(en-&gt;&#123;</span></span><br><span class="line"><span class="comment">//			System.out.println(en);</span></span><br><span class="line"><span class="comment">//		&#125;);</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="CopyUtil"><a href="#CopyUtil" class="headerlink" title="CopyUtil"></a>CopyUtil</h3><p><code>è¯¥æ–¹æ³•ç”¨ä»¥å¤åˆ¶å¯¹è±¡å’Œå±æ€§</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.smart.env.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Modifier;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CopyUtil</span> </span>&#123;</span><br><span class="line">	<span class="comment">// å¤åˆ¶å¯¹è±¡</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">copy</span><span class="params">(T t)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="comment">// åˆ›å»ºæ–°å¯¹è±¡ä»¥åŠå±æ€§</span></span><br><span class="line">		<span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">		Class&lt;T&gt; c = (Class&lt;T&gt;) t.getClass();</span><br><span class="line">		T copy = c.newInstance();</span><br><span class="line">		<span class="comment">// å°†åŸå¯¹è±¡çš„å±æ€§å¤åˆ¶ç»™æ–°å±æ€§</span></span><br><span class="line">		<span class="comment">// æ‰€æœ‰çš„å±æ€§å</span></span><br><span class="line">		Field[] fields = c.getDeclaredFields();</span><br><span class="line">		<span class="keyword">for</span> (Field field : fields) &#123;</span><br><span class="line">			<span class="comment">// finalä¿®é¥°çš„å€¼è¿‡æ»¤</span></span><br><span class="line">			<span class="keyword">if</span> (Modifier.isFinal(field.getModifiers())) &#123;</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			field.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">			<span class="comment">// è·å–å€¼</span></span><br><span class="line">			field.set(copy, field.get(t));</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> copy;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="å‘é€æ•°æ®"><a href="#å‘é€æ•°æ®" class="headerlink" title="å‘é€æ•°æ®"></a>å‘é€æ•°æ®</h2><p><code>åˆ†æ</code></p>
<ul>
<li>ç½‘ç»œå¥—æ¥å­—</li>
<li>å¯¹è±¡æµ</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.smart.env.client;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.smart.env.entity.Environment;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * ç½‘ç»œå¥—æ¥å­— - å®¢æˆ·ç«¯</span></span><br><span class="line"><span class="comment"> * 	 å°†é‡‡é›†åˆ°çš„æ•°æ®å‘é€ç»™æœåŠ¡ç«¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClientImpl</span> <span class="keyword">implements</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String address = <span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> port = <span class="number">8888</span>;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">(Collection&lt;Environment&gt; c)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		Socket socket = <span class="keyword">new</span> Socket(address, port);</span><br><span class="line">		OutputStream out = socket.getOutputStream();</span><br><span class="line">		ObjectOutputStream oos = <span class="keyword">new</span> ObjectOutputStream(out);</span><br><span class="line">		oos.writeObject(c);</span><br><span class="line">		oos.flush();</span><br><span class="line">		System.out.println(<span class="string">&quot;å®¢æˆ·ç«¯å‘é€æ•°æ®å®Œæˆ&quot;</span>);</span><br><span class="line">		oos.close();</span><br><span class="line">		socket.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h1 id="3-æœåŠ¡ç«¯"><a href="#3-æœåŠ¡ç«¯" class="headerlink" title="3 æœåŠ¡ç«¯"></a>3 æœåŠ¡ç«¯</h1><h2 id="æ¥æ”¶æ•°æ®"><a href="#æ¥æ”¶æ•°æ®" class="headerlink" title="æ¥æ”¶æ•°æ®"></a>æ¥æ”¶æ•°æ®</h2><p><code>åˆ†æ</code></p>
<ul>
<li>ç½‘ç»œå¥—æ¥å­—</li>
<li>å¯¹è±¡æµ</li>
</ul>
<h3 id="ServerImpl"><a href="#ServerImpl" class="headerlink" title="ServerImpl"></a>ServerImpl</h3><blockquote>
<p>:tipping_hand_man: volatileå…³é”®å­—çš„å«ä¹‰</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.smart.env.server;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.smart.env.entity.Environment;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServerImpl</span> <span class="keyword">implements</span> <span class="title">Server</span> </span>&#123;</span><br><span class="line">	<span class="comment">// æ¥æ”¶æœåŠ¡å™¨ç«¯å£</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> receivePort = <span class="number">8888</span>;</span><br><span class="line">	<span class="comment">// å…³é—­æœåŠ¡å™¨æ¥å£</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> shutdownPort = <span class="number">9999</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> flag;</span><br><span class="line"></span><br><span class="line">	ServerSocket serverSocket = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æ¥æ”¶æœåŠ¡å™¨çš„æ¥æ”¶æ–¹æ³•</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reciver</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		serverSocket = <span class="keyword">new</span> ServerSocket(receivePort);</span><br><span class="line">		Socket socket = <span class="keyword">null</span>;</span><br><span class="line">		ObjectInputStream ois = <span class="keyword">null</span>;</span><br><span class="line">		startShutdown();</span><br><span class="line">		<span class="keyword">while</span> (!flag) &#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				socket = serverSocket.accept();</span><br><span class="line">				InputStream in = socket.getInputStream();</span><br><span class="line">				ois = <span class="keyword">new</span> ObjectInputStream(in);</span><br><span class="line">				Collection&lt;Environment&gt; enColl = (Collection&lt;Environment&gt;) ois.readObject();</span><br><span class="line">				System.out.println(<span class="string">&quot;æ¥æ”¶åˆ°äº†æ•°æ®: &quot;</span> + enColl.size());</span><br><span class="line">			&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">				<span class="keyword">if</span> (ois != <span class="keyword">null</span>) &#123;</span><br><span class="line">					ois.close();</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span> (socket != <span class="keyword">null</span>) &#123;</span><br><span class="line">					socket.close();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">startShutdown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">			Socket socket = <span class="keyword">null</span>;</span><br><span class="line">			ServerSocket serverSocket = <span class="keyword">null</span>;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				serverSocket = <span class="keyword">new</span> ServerSocket(shutdownPort);</span><br><span class="line">				Socket socker = serverSocket.accept();</span><br><span class="line">				<span class="comment">// å…³é—­æœåŠ¡å™¨</span></span><br><span class="line">				ServerImpl.<span class="keyword">this</span>.shutdown();</span><br><span class="line">			&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">				<span class="keyword">if</span> (serverSocket != <span class="keyword">null</span>) &#123;</span><br><span class="line">					<span class="keyword">try</span> &#123;</span><br><span class="line">						serverSocket.close();</span><br><span class="line">					&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">						e.printStackTrace();</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		&#125;).start();</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ç”¨äºå…³é—­æ¥æ”¶æœåŠ¡å™¨çš„ æ–¹æ³•</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shutdown</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.flag = <span class="keyword">true</span>;</span><br><span class="line">		<span class="comment">// æ³¨æ„éœ€è¦æ‰‹åŠ¨å…³é—­æ¥æ”¶æœåŠ¡å™¨</span></span><br><span class="line">		serverSocket.close();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>æµ‹è¯•</code></p>
<p><strong>å‘é€æœåŠ¡ç«¯å’Œå…³é—­æœåŠ¡ç«¯</strong></p>
<p><img src="https://gitee.com/vanse/images/raw/master/environment/image-20210926210623479.png" alt="image-20210926210623479"></p>
<p><strong>å‘é€å®¢æˆ·ç«¯</strong></p>
<p><img src="https://gitee.com/vanse/images/raw/master/environment/image-20210926210459984.png" alt="image-20210926210459984"></p>
<p><strong>å…³é—­å®¢æˆ·ç«¯</strong></p>
<p><img src="image/image-20210926210650194.png" alt="image-20210926210650194"></p>
<p><strong>ç»“æœ</strong></p>
<p><img src="https://gitee.com/vanse/images/raw/master/environment/image-20210926205351670.png" alt="image-20210926205351670"></p>
<p><code>ä»£ç è§£æ</code></p>
<p><img src="https://gitee.com/vanse/images/raw/master/environment/image-20210926210400284.png" alt="image-20210926210400284"></p>
<p><code>volatileå…³é”®å­—å¯ä»¥ä¿è¯çº¿ç¨‹çš„å¯è§æ€§</code></p>
<p><img src="https://gitee.com/vanse/images/raw/master/environment/2897315-c8bfc26b7dab8341.jpg"></p>
<h2 id="æ•°æ®å…¥åº“"><a href="#æ•°æ®å…¥åº“" class="headerlink" title="æ•°æ®å…¥åº“"></a>æ•°æ®å…¥åº“</h2><blockquote>
<p>æ¯ä¸ªEnvironmentå¯¹è±¡æœ‰æ—¥æœŸå±æ€§,ä»£è¡¨è¯¥æ•°æ®æ˜¯æŸä¸ªæ—¶é—´ç‚¹é‡‡é›†çš„,å°†æ¯ä¸ªå¯¹è±¡æŒ‰ç…§æ—¥æœŸ(ä¸»è¦æ˜¯å¤©)æ’å…¥åˆ°å¯¹åº”çš„è¡¨ä¸­(31å¼ è¡¨å¯¹åº”31å¤©)</p>
</blockquote>
<ul>
<li>éå†<code>List&lt;Environment&gt;</code>é›†åˆ</li>
<li>è·å–æ¯ä¸ªå¯¹è±¡çš„é‡‡é›†æ—¥æœŸ(æ—¶é—´æˆ³),æˆªå–å¤©æ•°</li>
<li>å°†æ¯ä¸ªå¯¹è±¡(æ¯æ¡æ•°æ®)æŒ‰ç…§æ—¥æœŸ æ’å…¥åˆ°å¯¹åº”çš„è¡¨ä¸­(table_(1-31))<ul>
<li>String sql = â€œinsert into table() values(?,?,?â€¦)â€;</li>
<li>conn.preparedStatement(sql);</li>
<li>psè®¾ç½®å‚æ•°</li>
<li>ps.executeUpdate();</li>
</ul>
</li>
<li>:tipping_hand_man: ä½¿ç”¨æ‰‹åŠ¨æäº¤+ps+æ‰¹å¤„ç†æå‡æ’å…¥æ•ˆç‡<ul>
<li>==æ³¨æ„: å¦‚æœæ’å…¥çš„ç¬¬äºŒæ¡æ•°æ®å’Œç¬¬ä¸€æ¡æ•°æ®æ˜¯åŒä¸€å¤©,æ­£å¸¸æ“ä½œ,å¦åˆ™,æ–°çš„å¤©æ•°,sqlå˜åŠ¨,åŒæ„è¯­å¥å¤±æ•ˆ.éœ€è¦é‡æ–°æ„å»º==</li>
</ul>
</li>
</ul>
<blockquote>
<p>:tipping_hand_man: å¦‚æœæœ¬åœ°ä»“åº“æ²¡æœ‰ojdbc8é©±åŠ¨,ä½¿ç”¨è¿œç¨‹ä»“åº“</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.oracle.ojdbc/ojdbc8 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.oracle.ojdbc<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ojdbc8<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>19.3.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>å®‰è£…jaråŒ…åˆ°æœ¬åœ°ä»“åº“å‘½ä»¤</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn install:install-file -DgroupId=com.oracle -DartifactId=ojdbc8 -Dversion=8 -Dpackaging=jar -Dfile=ojdbc8.jar -DgeneratePom=true</span><br></pre></td></tr></table></figure>

<blockquote>
<p>:tipping_hand_man: å¦‚æœä¸æ˜¯åŒä¸€ä¸ªpså¯¹è±¡,æ‰¹å¤„ç†ä¼šå¤±æ•ˆ</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.smart.env.server;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.smart.env.entity.Environment;</span><br><span class="line"><span class="keyword">import</span> com.briup.smart.env.util.JdbcUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DBStoreImpl</span> <span class="keyword">implements</span> <span class="title">DBStore</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> lastDate = -<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> batchSize = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">private</span> Set&lt;Integer&gt; days = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">	<span class="keyword">private</span> Connection conn = <span class="keyword">null</span>;</span><br><span class="line">	<span class="keyword">private</span> PreparedStatement ps;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@SuppressWarnings(&quot;deprecation&quot;)</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveDB</span><span class="params">(Collection&lt;Environment&gt; c)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;å¼€å§‹å…¥åº“&quot;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			conn = JdbcUtil.getConnection();</span><br><span class="line">			conn.setAutoCommit(<span class="keyword">false</span>);</span><br><span class="line">			<span class="keyword">for</span> (Environment env : c) &#123;</span><br><span class="line">				<span class="keyword">int</span> date = env.getGather_date().getDate();</span><br><span class="line">				days.add(date);</span><br><span class="line">				String sql = <span class="keyword">null</span>;</span><br><span class="line">				<span class="keyword">if</span>(lastDate == -<span class="number">1</span>) &#123;</span><br><span class="line">					sql = <span class="string">&quot;insert into e_detail_&quot;</span> + date</span><br><span class="line">							+ <span class="string">&quot;(name,srcId,desId,devId,sersorAddress,count,cmd,status,data,gather_date) values(?,?,?,?,?,?,?,?,?,?)&quot;</span>;</span><br><span class="line">					ps = conn.prepareStatement(sql);</span><br><span class="line">				&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">					<span class="comment">// ä¸æ˜¯åŒä¸€å¤©</span></span><br><span class="line">					<span class="keyword">if</span>(lastDate != date) &#123;</span><br><span class="line">						<span class="comment">// æ‰§è¡Œä¸Šä¸ªæ‰¹å¤„ç†çš„æ•°æ®</span></span><br><span class="line">						ps.executeBatch();</span><br><span class="line">						batchSize = <span class="number">0</span>;</span><br><span class="line">						ps.close(); <span class="comment">// å…³é—­ä¸Šä¸€æ¬¡çš„ps</span></span><br><span class="line">						sql = <span class="string">&quot;insert into e_detail_&quot;</span> + date</span><br><span class="line">								+ <span class="string">&quot;(name,srcId,desId,devId,sersorAddress,count,cmd,status,data,gather_date) values(?,?,?,?,?,?,?,?,?,?)&quot;</span>;</span><br><span class="line">						ps = conn.prepareStatement(sql);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				</span><br><span class="line"></span><br><span class="line">				<span class="comment">// å¡«å……å‚æ•°</span></span><br><span class="line">				ps.setString(<span class="number">1</span>, env.getName());</span><br><span class="line">				ps.setString(<span class="number">2</span>, env.getSrcId());</span><br><span class="line">				ps.setString(<span class="number">3</span>, env.getDesId());</span><br><span class="line">				ps.setString(<span class="number">4</span>, env.getDevId());</span><br><span class="line">				ps.setString(<span class="number">5</span>, env.getSersorAddress());</span><br><span class="line">				ps.setInt(<span class="number">6</span>, env.getCount());</span><br><span class="line">				ps.setString(<span class="number">7</span>, env.getCmd());</span><br><span class="line">				ps.setInt(<span class="number">8</span>, env.getStatus());</span><br><span class="line">				ps.setFloat(<span class="number">9</span>, env.getData());</span><br><span class="line">				ps.setTimestamp(<span class="number">10</span>, env.getGather_date());</span><br><span class="line">				<span class="comment">// æ·»åŠ æ‰¹å¤„ç†</span></span><br><span class="line">				ps.addBatch();</span><br><span class="line">				batchSize++;</span><br><span class="line">				<span class="keyword">if</span> (batchSize == <span class="number">200</span>) &#123;</span><br><span class="line">					ps.executeBatch();</span><br><span class="line">					<span class="comment">// æ‰¹å¤„ç†å®Œå é‡æ–°è®¡æ•°</span></span><br><span class="line">					batchSize = <span class="number">0</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				lastDate = date;</span><br><span class="line">			&#125;</span><br><span class="line">			ps.executeBatch();</span><br><span class="line">			conn.commit();</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			conn.rollback();</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			JdbcUtil.close(ps, conn);</span><br><span class="line">		&#125;</span><br><span class="line">		System.out.println(<span class="string">&quot;åˆ†å¸ƒ: &quot;</span> + days);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>









<h1 id="4-å¤‡ä»½"><a href="#4-å¤‡ä»½" class="headerlink" title="4 å¤‡ä»½"></a>4 å¤‡ä»½</h1><p><code>åœºæ™¯</code></p>
<ul>
<li>ç¬¬ä¸€æ¬¡é‡‡é›†å®Œæ•°æ®(simple.file)</li>
<li>æ­¤æ—¶å‡è®¾è¯¥æ–‡ä»¶æ–°æ·»äº†10è¡Œæ•°æ®(æ‰‹åŠ¨æ·»åŠ ,æ¨¡æ‹Ÿç¡¬ä»¶æ—¶åˆ»é‡‡é›†)</li>
<li>æ­¤æ—¶å†æ¬¡é‡‡é›†æ–°æ•°æ®,åº”è¯¥åªé‡‡é›†æ–°æ·»åŠ çš„æ•°æ®,ä¸ä¼šé‡æ–°ä»è¯¥æ–‡ä»¶çš„ç¬¬ä¸€è¡Œå¼€å§‹é‡æ–°è§£æ</li>
</ul>
<p><code>åˆ†æ</code></p>
<ul>
<li>å®ç°<code>backup/load</code>æ–¹æ³•<ul>
<li>é‡‡é›†æ–‡ä»¶æ—¶,å…ˆçœ‹æ˜¯å¦æœ‰å¤‡ä»½,æœ‰çš„è¯,è·³è¿‡å·²é‡‡é›†çš„å­—èŠ‚é•¿åº¦</li>
</ul>
</li>
<li>å®ç°<code>backup/store</code>æ–¹æ³•<ul>
<li>æ¯æ¬¡é‡‡é›†å®Œæ•°æ®,è®°å½•å½“æ—¶é‡‡é›†çš„å­—èŠ‚é•¿åº¦,ä¿å­˜åœ¨backup.fileä¸­</li>
</ul>
</li>
</ul>
<p><code>å¤‡ä»½å®ç°</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.smart.env.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BackupImpl</span> <span class="keyword">implements</span> <span class="title">Backup</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> String basePath = <span class="string">&quot;src/main/resources/bak&quot;</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">load</span><span class="params">(String fileName, <span class="keyword">boolean</span> del)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		</span><br><span class="line">		ObjectInputStream in = <span class="keyword">null</span>;</span><br><span class="line">		Object obj = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			String filePath = basePath + <span class="string">&quot;/&quot;</span> +fileName;</span><br><span class="line">			File file = <span class="keyword">new</span> File(filePath);</span><br><span class="line">			<span class="comment">// å¦‚æœå¤‡ä»½æ–‡ä»¶ä¸å­˜åœ¨ï¼Œç›´æ¥è¿”å›null</span></span><br><span class="line">			<span class="keyword">if</span>(!file.exists()) &#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			in = <span class="keyword">new</span> ObjectInputStream(<span class="keyword">new</span> FileInputStream(file));</span><br><span class="line">			</span><br><span class="line">			obj = in.readObject();</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">if</span>(del) &#123;</span><br><span class="line">				file.deleteOnExit();</span><br><span class="line"><span class="comment">//				System.out.println(&quot;å¤‡ä»½æ–‡ä»¶å·²åˆ é™¤ï¼š&quot;+file.delete());</span></span><br><span class="line">			&#125;</span><br><span class="line">					</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">			<span class="keyword">if</span>(in!=<span class="keyword">null</span>) &#123;</span><br><span class="line">				in.close();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> obj;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">store</span><span class="params">(String fileName, Object obj, <span class="keyword">boolean</span> append)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		ObjectOutputStream out = <span class="keyword">null</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			String filePath = basePath+<span class="string">&quot;/&quot;</span>+fileName;</span><br><span class="line">			File file = <span class="keyword">new</span> File(filePath);</span><br><span class="line">			<span class="comment">// åˆ¤æ–­æ–‡ä»¶æ‰€åœ¨ç›®å½•æ˜¯å¦å­˜åœ¨,å¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»º</span></span><br><span class="line">			<span class="keyword">if</span>(!file.getParentFile().exists()) &#123;</span><br><span class="line">				file.getParentFile().mkdirs();</span><br><span class="line">			&#125;</span><br><span class="line">			out = <span class="keyword">new</span> ObjectOutputStream(<span class="keyword">new</span> FileOutputStream(file,append));</span><br><span class="line">			out.writeObject(obj);</span><br><span class="line">			out.flush();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			<span class="keyword">if</span>(out!=<span class="keyword">null</span>) &#123;</span><br><span class="line">				out.close();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>æ”¹é€ é‡‡é›†æ¨¡å—</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.smart.env.client;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileReader;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.sql.Timestamp;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.smart.env.entity.Environment;</span><br><span class="line"><span class="keyword">import</span> com.briup.smart.env.util.Backup;</span><br><span class="line"><span class="keyword">import</span> com.briup.smart.env.util.BackupImpl;</span><br><span class="line"><span class="keyword">import</span> com.briup.smart.env.util.CopyUtil;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * é‡‡é›†æ•°æ®</span></span><br><span class="line"><span class="comment"> * 	å°†100|101|2|16|1|3|5f6c6ba002|1|1516323990934 å°è£…æˆ Environmentå¯¹è±¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GatherImpl</span> <span class="keyword">implements</span> <span class="title">Gather</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Backup backup = <span class="keyword">new</span> BackupImpl();</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Collection&lt;Environment&gt; <span class="title">gather</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		File file = <span class="keyword">new</span> File(<span class="string">&quot;data-file&quot;</span>);</span><br><span class="line">		<span class="comment">//InputStream in = GatherImpl.class.getClassLoader().getResourceAsStream(&quot;data-file&quot;);</span></span><br><span class="line">		BufferedReader br = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> FileReader(file));</span><br><span class="line">		</span><br><span class="line">		Long len = (Long)backup.load(<span class="string">&quot;gather-file-length&quot;</span>, Backup.LOAD_UNREMOVE);</span><br><span class="line">		<span class="keyword">if</span>(len!=<span class="keyword">null</span>) &#123;</span><br><span class="line">			br.skip(len);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">long</span> fileLength = file.length();</span><br><span class="line">		backup.store(<span class="string">&quot;gather-file-length&quot;</span>, fileLength, Backup.STORE_OVERRIDE);</span><br><span class="line">			</span><br><span class="line">		Collection&lt;Environment&gt; enColl = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">		<span class="comment">// 1.è¯»å–æ•°æ®</span></span><br><span class="line">		String line = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">while</span> ((line = br.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">			String[] lineData = line.split(<span class="string">&quot;[|]&quot;</span>);</span><br><span class="line">			<span class="keyword">if</span>(lineData.length != <span class="number">9</span>) &#123;</span><br><span class="line">				<span class="comment">// TODO è®°å½•å½“å‰æ ¼å¼æœ‰é—®é¢˜çš„æ•°æ®</span></span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			Environment environment = <span class="keyword">new</span> Environment();</span><br><span class="line">			<span class="comment">// è®¾ç½®å‘é€ç«¯id</span></span><br><span class="line">			environment.setSrcId(lineData[<span class="number">0</span>]);</span><br><span class="line">			<span class="comment">// è®¾ç½®æ ‘è“æ´¾ç³»ç»Ÿid</span></span><br><span class="line">			environment.setDesId(lineData[<span class="number">1</span>]);</span><br><span class="line">			<span class="comment">// è®¾ç½®å®éªŒç®±åŒºåŸŸid</span></span><br><span class="line">			environment.setDevId(lineData[<span class="number">2</span>]);</span><br><span class="line">			<span class="comment">// è®¾ç½®æ¨¡å—ä¸Šä¼ åœ°å€</span></span><br><span class="line">			environment.setSersorAddress(lineData[<span class="number">3</span>]);</span><br><span class="line">			<span class="comment">// è®¾ç½®ä¼ æ„Ÿå™¨ä¸ªæ•°</span></span><br><span class="line">			environment.setCount(Integer.parseInt(lineData[<span class="number">4</span>]));</span><br><span class="line">			<span class="comment">// è®¾ç½®å‘é€æŒ‡ä»¤</span></span><br><span class="line">			environment.setCmd(lineData[<span class="number">5</span>]);</span><br><span class="line">			<span class="comment">// è®¾ç½®çŠ¶æ€</span></span><br><span class="line">			environment.setStatus(Integer.parseInt(lineData[<span class="number">7</span>]));</span><br><span class="line">			<span class="comment">// è®¾ç½®é‡‡é›†æ—¶é—´</span></span><br><span class="line">			environment.setGather_date(<span class="keyword">new</span> Timestamp(Long.parseLong(lineData[<span class="number">8</span>])));</span><br><span class="line">			<span class="comment">// è®¾ç½®ç¯å¢ƒç§ç±»</span></span><br><span class="line">			<span class="keyword">switch</span> (environment.getSersorAddress()) &#123;</span><br><span class="line">			<span class="comment">// 5d606f7802</span></span><br><span class="line">			<span class="keyword">case</span> <span class="string">&quot;16&quot;</span>:</span><br><span class="line">				environment.setName(<span class="string">&quot;æ¸©åº¦&quot;</span>);<span class="comment">// ä¹Ÿæœ‰å¯èƒ½æ˜¯æ¹¿åº¦</span></span><br><span class="line">				<span class="keyword">int</span> wendu = Integer.parseInt(lineData[<span class="number">6</span>].substring(<span class="number">0</span>, <span class="number">4</span>), <span class="number">16</span>);<span class="comment">// æ¸©åº¦æ•°æ®</span></span><br><span class="line">				environment.setData((wendu * (<span class="number">0.00268127F</span>)) - <span class="number">46.85F</span>);</span><br><span class="line">				Environment copy = CopyUtil.copy(environment);</span><br><span class="line">				copy.setName(<span class="string">&quot;æ¹¿åº¦&quot;</span>);</span><br><span class="line">				<span class="keyword">int</span> shidu = Integer.parseInt(lineData[<span class="number">6</span>].substring(<span class="number">4</span>, <span class="number">8</span>), <span class="number">16</span>);<span class="comment">// æ¹¿åº¦æ•°æ®</span></span><br><span class="line">				enColl.add(copy);</span><br><span class="line">				<span class="comment">// å¤åˆ¶å¯¹è±¡</span></span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="string">&quot;256&quot;</span>:</span><br><span class="line">				environment.setName(<span class="string">&quot;å…‰ç…§å¼ºåº¦&quot;</span>);</span><br><span class="line">				environment.setData(Integer.parseInt(lineData[<span class="number">6</span>].substring(<span class="number">0</span>, <span class="number">4</span>), <span class="number">16</span>));</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="string">&quot;1280&quot;</span>:</span><br><span class="line">				environment.setName(<span class="string">&quot;äºŒæ°§åŒ–ç¢³&quot;</span>);</span><br><span class="line">				environment.setData(Integer.parseInt(lineData[<span class="number">6</span>].substring(<span class="number">0</span>, <span class="number">4</span>), <span class="number">16</span>));</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			enColl.add(environment);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> enColl;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		Collection&lt;Environment&gt; enColl = <span class="keyword">new</span> GatherImpl().gather();</span><br><span class="line">		System.out.println(enColl.size());</span><br><span class="line"><span class="comment">//		enColl.forEach(en-&gt;&#123;</span></span><br><span class="line"><span class="comment">//			System.out.println(en);</span></span><br><span class="line"><span class="comment">//		&#125;);</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h1 id="5-æ—¥å¿—"><a href="#5-æ—¥å¿—" class="headerlink" title="5 æ—¥å¿—"></a>5 æ—¥å¿—</h1><p><code>åœºæ™¯</code></p>
<blockquote>
<p>æµ‹è¯•çš„æ—¶å€™ç»å¸¸ä½¿ç”¨System.out.println() æŸ¥çœ‹æƒ…å†µ</p>
</blockquote>
<p><strong>å¼Šç«¯</strong></p>
<ul>
<li>å°†æ¥é¡¹ç›®ä¸Šçº¿<code>System.out.println</code>ç­‰å†—ä½™ä»£ç éœ€è¦åˆ é™¤</li>
<li>æ­¤æ—¶è¯¥ä»£ç åˆ†å¸ƒåœ¨å„åœ°,ä¸æ˜“ç»Ÿä¸€åˆ é™¤ç®¡ç†</li>
<li>æ¯è¾“å‡ºä¸€æ¡è¯­å¥,éƒ½ä¼šå ç”¨æ€§èƒ½</li>
</ul>
<p><code>è§£å†³</code></p>
<p>ä½¿ç”¨æ—¥å¿—,æœ¬å¤„å¼•å…¥<code>Log4j</code>,è¯¦æƒ…æŸ¥çœ‹å·²å‘å¸ƒèµ„æ–™</p>
<ul>
<li>å¯¼å…¥Log4j.jar</li>
<li>ä½¿ç”¨é…ç½®æ–‡ä»¶ç»Ÿä¸€ç®¡ç†æ—¥å¿—  Log4j.properties</li>
<li>ä½¿ç”¨log.info()/log.debug()/log.warning()ç­‰æ–¹æ³•æ›¿æ¢<code>System.out.println</code></li>
</ul>
<p><code>log4j.properties</code></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># OFF FATAL ERROR WARN INFO DEBUG TRACE ALL</span></span><br><span class="line"><span class="meta">log4j.rootLogger</span>=<span class="string">DEBUG,contrl,file</span></span><br><span class="line"></span><br><span class="line"><span class="meta">log4j.appender.contrl</span>=<span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="meta">log4j.appender.contrl.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="meta">log4j.appender.contrl.layout.ConversionPattern</span>=<span class="string">%d %5p [%t] (%F:%L) - %m%n</span></span><br><span class="line"></span><br><span class="line"><span class="meta">log4j.appender.file</span>=<span class="string">org.apache.log4j.FileAppender</span></span><br><span class="line"><span class="meta">log4j.appender.file.File</span>=<span class="string">D:/env/log/log.txt</span></span><br><span class="line"><span class="meta">log4j.appender.file.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="meta">log4j.appender.file.layout.ConversionPattern</span>=<span class="string">%d %5p [%t] (%F:%L) - %m%n</span></span><br></pre></td></tr></table></figure>



<p><code>æ—¥å¿—åŒ…è£…</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.smart.env.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogImpl</span> <span class="keyword">implements</span> <span class="title">Log</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> Logger LOGGER = Logger.getRootLogger();</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">debug</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">		LOGGER.debug(message);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">info</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">		LOGGER.info(message);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">warn</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">		LOGGER.warn(message);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">error</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">		LOGGER.error(message);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fatal</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">		LOGGER.fatal(message);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><code>æ—¥å¿—ä½¿ç”¨ GatherImpl</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Log log = <span class="keyword">new</span> LogImpl();</span><br><span class="line"></span><br><span class="line">socket = <span class="keyword">new</span> Socket(serverIp, serverPort);</span><br><span class="line">log.info(<span class="string">&quot;å®¢æˆ·ç«¯æ¨¡å— è¿æ¥æœåŠ¡å™¨æˆåŠŸï¼Œip=&quot;</span>+serverIp+<span class="string">&quot;ï¼Œport=&quot;</span>+serverPort);</span><br><span class="line"></span><br><span class="line">out = <span class="keyword">new</span> ObjectOutputStream(socket.getOutputStream());</span><br><span class="line"></span><br><span class="line">out.writeObject(c);</span><br><span class="line"></span><br><span class="line">out.flush();</span><br><span class="line"></span><br><span class="line">log.info(<span class="string">&quot;å®¢æˆ·ç«¯æ¨¡å— å‘é€æ•°æ®æˆåŠŸï¼Œå…±å‘é€&quot;</span>+c.size()+<span class="string">&quot;æ¡æ•°æ®&quot;</span>);</span><br></pre></td></tr></table></figure>





<h1 id="6-é…ç½®"><a href="#6-é…ç½®" class="headerlink" title="6 é…ç½®"></a>6 é…ç½®</h1><p>==éœ€è¦å®ç°çš„æ¥å£==</p>
<ul>
<li>Configuration.java é…ç½®æ¨¡å—</li>
<li>ConfigurationAware.java é…ç½®æ³¨å…¥</li>
<li>PropertiesAware.java å±æ€§æ³¨å…¥</li>
</ul>
<p><code>åœºæ™¯</code></p>
<p>ä¾‹å¦‚é‡‡é›†æ¨¡å—</p>
<p><img src="https://gitee.com/vanse/images/raw/master/environment/image-20210927140800703.png" alt="image-20210927140800703"></p>
<p>è¯¥æ¨¡å—å¼•å…¥äº†å¤‡ä»½æ¨¡å— backupå’Œå±æ€§filePath</p>
<p><code>å¼Šç«¯</code></p>
<p>å¦‚æœæŸç±»éœ€è¦ä¾èµ–å…¶ä»–å¯¹è±¡æˆ–è€…å±æ€§,ä¸å»ºè®®ç¡¬ç¼–ç newå¯¹è±¡æˆ–è€…å†™æ­»å±æ€§,å¸Œæœ›æœ‰ä¸ªé…ç½®ç±»å¯ä»¥ç»Ÿä¸€ç®¡ç†</p>
<p><code>è§£å†³</code></p>
<ol>
<li><p>å°†æ¥å°†å…¶ä»–å¯¹è±¡å’Œå±æ€§ä»ç¡¬ç¼–ç ä¸­è§£è€¦,å°†å…¶é…ç½®åˆ°xmlæ–‡ä»¶ä¸­,ä¾‹å¦‚conf.xml</p>
</li>
<li><p>å°†<code>conf.xml</code>åŠ è½½åˆ°Configurationé…ç½®ç±»ä¸­(ä½œä¸ºå®¹å™¨)</p>
<ul>
<li>è¯¥å®¹å™¨åŒ…å«äº†å…¶ä»–ç±»çš„å¯¹è±¡å’Œç›¸å…³å±æ€§</li>
</ul>
</li>
<li><p>å‡å¦‚GatherImpléœ€è¦ä¾èµ–å…¶ä»–å¯¹è±¡å®ç°ConfigurationAwareæ¥å£</p>
</li>
<li><p>å‡å¦‚GatherImpléœ€è¦è·¯å¾„å±æ€§,å®ç°PropertiesAware.javaæ¥å£</p>
</li>
</ol>
<p><img src="https://gitee.com/vanse/images/raw/master/environment/image-20210928142527653.png" alt="image-20210928142527653"></p>
<p><code>conf.xml</code> è¯¥æ–‡ä»¶é…ç½®äº†ç±»çš„è·¯å¾„å’Œç›¸å…³å±æ€§</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">environment</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">gather</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.smart.env.client.GatherImpl&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">data-file-path</span>&gt;</span><span class="tag">&lt;/<span class="name">data-file-path</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">gather</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">logger</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.smart.env.util.LogImpl&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">backup</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.smart.env.util.BackupImpl&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">file-path</span>&gt;</span><span class="tag">&lt;/<span class="name">file-path</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">backup</span>&gt;</span></span><br><span class="line">	 </span><br><span class="line">	<span class="tag">&lt;<span class="name">client</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.smart.env.client.ClientImpl&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">host</span>&gt;</span><span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">port</span>&gt;</span><span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">client</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">server</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.smart.env.server.ServerThreadImpl&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">server-port</span>&gt;</span><span class="tag">&lt;/<span class="name">server-port</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">dbStore</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.smart.env.server.DBStoreImpl&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">driver</span>&gt;</span><span class="tag">&lt;/<span class="name">driver</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">url</span>&gt;</span><span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">username</span>&gt;</span><span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">password</span>&gt;</span><span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dbStore</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<p><code>ConfigurationImpl å®¹å™¨å®ç°</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.smart.env;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.dom4j.Document;</span><br><span class="line"><span class="keyword">import</span> org.dom4j.Element;</span><br><span class="line"><span class="keyword">import</span> org.dom4j.io.SAXReader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.smart.env.client.Client;</span><br><span class="line"><span class="keyword">import</span> com.briup.smart.env.client.Gather;</span><br><span class="line"><span class="keyword">import</span> com.briup.smart.env.server.DBStore;</span><br><span class="line"><span class="keyword">import</span> com.briup.smart.env.server.Server;</span><br><span class="line"><span class="keyword">import</span> com.briup.smart.env.support.ConfigurationAware;</span><br><span class="line"><span class="keyword">import</span> com.briup.smart.env.support.PropertiesAware;</span><br><span class="line"><span class="keyword">import</span> com.briup.smart.env.util.Backup;</span><br><span class="line"><span class="keyword">import</span> com.briup.smart.env.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigurationImpl</span> <span class="keyword">implements</span> <span class="title">Configuration</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Configuration CONFIG = <span class="keyword">new</span> ConfigurationImpl();</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String XML_CONFIG_PATH = <span class="string">&quot;src/main/resources/conf.xml&quot;</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// è´Ÿè´£ç®¡ç†æ¨¡å—å¯¹è±¡</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">	<span class="comment">// è´Ÿè´£ç®¡ç†æ¨¡å—ä¸­çš„å‚æ•°</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> Properties p = <span class="keyword">new</span> Properties();</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">static</span> &#123;</span><br><span class="line">		<span class="comment">// è§£æxmlé…ç½®æ–‡ä»¶ï¼Œå°†å€¼å­˜æ”¾åˆ°mapå’Œpä¹‹ä¸­</span></span><br><span class="line">		parseXML(XML_CONFIG_PATH);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// åˆå§‹åŒ–æ¨¡å—å¯¹è±¡é‡Œé¢çš„å±æ€§å€¼</span></span><br><span class="line">		initModule();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="title">ConfigurationImpl</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(CONFIG!=<span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;è¯·ä½¿ç”¨getInstanceæ–¹æ³•è·å–å¯¹è±¡&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">initModule</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="keyword">for</span> (Object <span class="keyword">module</span> : map.values()) &#123;</span><br><span class="line">				<span class="keyword">if</span>(<span class="keyword">module</span> <span class="keyword">instanceof</span> PropertiesAware) &#123;</span><br><span class="line">					((PropertiesAware)<span class="keyword">module</span>).init(p);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">for</span> (Object <span class="keyword">module</span> : map.values()) &#123;</span><br><span class="line">				<span class="keyword">if</span>(<span class="keyword">module</span> <span class="keyword">instanceof</span> ConfigurationAware) &#123;</span><br><span class="line">					((ConfigurationAware)<span class="keyword">module</span>).setConfiguration(CONFIG);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">parseXML</span><span class="params">(String xmlConfigPath)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			SAXReader reader = <span class="keyword">new</span> SAXReader();</span><br><span class="line">			Document document = reader.read(<span class="keyword">new</span> File(xmlConfigPath));</span><br><span class="line">			</span><br><span class="line">			Element rootElement = document.getRootElement();</span><br><span class="line">			</span><br><span class="line">			Iterator&lt;Element&gt; it = rootElement.elementIterator();</span><br><span class="line">			<span class="keyword">while</span>(it.hasNext()) &#123;</span><br><span class="line">				Element element = it.next();</span><br><span class="line">				String elementName = element.getName();</span><br><span class="line">				String classAttrValue = element.attribute(<span class="string">&quot;class&quot;</span>).getValue();</span><br><span class="line">				<span class="comment">// æ³¨æ„éœ€è¦ä¿è¯æ¯ä¸ªæ¨¡å—ä¸­éƒ½å¿…é¡»æœ‰ä¸€ä¸ªæ— å‚æ„é€ å™¨</span></span><br><span class="line">				Object obj = Class.forName(classAttrValue).newInstance();</span><br><span class="line">				</span><br><span class="line">				map.put(elementName.toUpperCase(), obj);</span><br><span class="line">				</span><br><span class="line">				Iterator&lt;Element&gt; childElementIt = element.elementIterator();</span><br><span class="line">				<span class="keyword">while</span>(childElementIt.hasNext()) &#123;</span><br><span class="line">					Element childElement = childElementIt.next();</span><br><span class="line">					String attrName = childElement.getName();</span><br><span class="line">					String attrValue = childElement.getText();</span><br><span class="line">					p.setProperty(attrName, attrValue);</span><br><span class="line">				&#125;</span><br><span class="line">				</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Configuration <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> CONFIG;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Log <span class="title">getLogger</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (Log)map.get(ModuleName.LOGGER.name());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Server <span class="title">getServer</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> (Server)map.get(ModuleName.SERVER.name());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Client <span class="title">getClient</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> (Client)map.get(ModuleName.CLIENT.name());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> DBStore <span class="title">getDbStore</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> (DBStore)map.get(ModuleName.DBSTORE.name());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Gather <span class="title">getGather</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> (Gather)map.get(ModuleName.GATHER.name());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Backup <span class="title">getBackup</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (Backup)map.get(ModuleName.BACKUP.name());</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="class"><span class="keyword">enum</span> <span class="title">ModuleName</span></span>&#123;</span><br><span class="line">		GATHER,LOGGER,BACKUP,CLIENT,SERVER,DBSTORE;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><code>ä½¿ç”¨å®¹å™¨ç±» GatherImpl</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GatherImpl</span> <span class="keyword">implements</span> <span class="title">Gather</span>,<span class="title">PropertiesAware</span>,<span class="title">ConfigurationAware</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(Properties p)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.dataFilePath = p.getProperty(<span class="string">&quot;gather-data-file-path&quot;</span>);</span><br><span class="line">		<span class="keyword">this</span>.fileLengthBak = p.getProperty(<span class="string">&quot;gather-file-length-bak&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setConfiguration</span><span class="params">(Configuration config)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.backup = config.getBackup();</span><br><span class="line">		<span class="keyword">this</span>.log = config.getLogger();</span><br><span class="line">	&#125;     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h1 id="7-ä¼˜åŒ–"><a href="#7-ä¼˜åŒ–" class="headerlink" title="7 ä¼˜åŒ–"></a>7 ä¼˜åŒ–</h1><h2 id="å…³é—­æœåŠ¡æ¨¡å—"><a href="#å…³é—­æœåŠ¡æ¨¡å—" class="headerlink" title="å…³é—­æœåŠ¡æ¨¡å—"></a>å…³é—­æœåŠ¡æ¨¡å—</h2><p><code>ReceiverServerShutdown</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.smart.env.shutdown;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReceiverServerShutdown</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String host = <span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> port = <span class="number">9091</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shutdown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Socket socket = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			socket = <span class="keyword">new</span> Socket(host, port);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">			<span class="keyword">if</span>(socket != <span class="keyword">null</span>) &#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					socket.close();</span><br><span class="line">				&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">new</span> ReceiverServerShutdown().shutdown();  </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>ServerImpl</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.smart.env.server;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.smart.env.entity.Environment;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServerImpl</span> <span class="keyword">implements</span> <span class="title">Server</span> </span>&#123;</span><br><span class="line">	<span class="comment">// æ¥æ”¶æœåŠ¡å™¨ç«¯å£</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> receivePort = <span class="number">9090</span>;</span><br><span class="line">	<span class="comment">// å…³é—­æœåŠ¡å™¨æ¥å£</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> shutdownPort = <span class="number">9091</span>;</span><br><span class="line">	<span class="comment">// æ˜¯å¦å…³é—­æœåŠ¡å™¨å¼€å…³ (ä¿è¯å¯è§æ€§)</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> flag = <span class="keyword">true</span>;</span><br><span class="line">	<span class="keyword">private</span> DBStore dbStrore = <span class="keyword">new</span> DBStoreImpl();</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> ServerSocket receiverServerSocket = <span class="keyword">null</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> ServerSocket shutdownServer = <span class="keyword">null</span>;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * å¯åŠ¨reiveræœåŠ¡å™¨(æ¥æ”¶æœåŠ¡å™¨) ä½œç”¨:è¯¥æœåŠ¡å™¨çš„ç«¯å£9090,è´Ÿè´£æ¥æ”¶å®¢æˆ·ç«¯å‘é€çš„æ•°æ®</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reciver</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		startShutdownServer();</span><br><span class="line">		startReceiverServer();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">startReceiverServer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;æ¥æ”¶æœåŠ¡å™¨å¼€å¯&quot;</span>);	</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			receiverServerSocket = <span class="keyword">new</span> ServerSocket(receivePort);</span><br><span class="line">			ObjectInputStream object = <span class="keyword">null</span>;</span><br><span class="line">			Socket socket = <span class="keyword">null</span>;</span><br><span class="line">			<span class="comment">// è™šæ‹Ÿæœºä¼šä¼˜åŒ–,å°†å †åŒºçš„å€¼æ”¾åˆ°æ ˆä¸­</span></span><br><span class="line">			<span class="comment">// å¦‚æœæ­¤æ—¶flagä¸ºfalse,é‡Œé¢ä¼šé˜»å¡</span></span><br><span class="line">			<span class="keyword">while</span> (flag) &#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					socket = receiverServerSocket.accept();</span><br><span class="line">					object = <span class="keyword">new</span> ObjectInputStream(socket.getInputStream());</span><br><span class="line">					<span class="comment">// æ¥æ”¶æ•°æ®</span></span><br><span class="line">					List&lt;Environment&gt; enList = (List&lt;Environment&gt;) object.readObject();</span><br><span class="line">					System.out.println(<span class="string">&quot;æœåŠ¡å™¨æ”¶é›†åˆ°äº†æ•°æ®&quot;</span> + enList.size() + <span class="string">&quot;æ¡,éœ€è¦å…¥åº“&quot;</span>);</span><br><span class="line">					dbStrore.saveDB(enList);</span><br><span class="line">					socket.close();</span><br><span class="line">				&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">					<span class="keyword">if</span>(socket != <span class="keyword">null</span>) &#123;</span><br><span class="line">						socket.close();</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (IOException e1) &#123;</span><br><span class="line">			e1.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> (receiverServerSocket != <span class="keyword">null</span>) &#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					receiverServerSocket.close();</span><br><span class="line">				&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * å¯åŠ¨shutdownæœåŠ¡å™¨(å…³é—­æœåŠ¡å™¨) ä½œç”¨: è´Ÿè´£æ¥æ”¶ç”¨æˆ·å‘é€çš„æ¶ˆæ¯,å¯ä»¥å…³é—­æ‰€æœ‰æœåŠ¡å™¨(reciverå’Œhsutdown)</span></span><br><span class="line"><span class="comment">	 * æ­¤å¤„,å¦‚æœå…³é—­çº¿ç¨‹é˜»å¡,æ¥æ”¶æœåŠ¡å™¨ä¸ä¼šæ‰§è¡Œ,éœ€è¦å¤šçº¿ç¨‹</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">startShutdownServer</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;å…³é—­æœåŠ¡å™¨å¼€å¯&quot;</span>);</span><br><span class="line">		<span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				shutdownServer = <span class="keyword">new</span> ServerSocket(shutdownPort);</span><br><span class="line">				shutdownServer.accept();</span><br><span class="line">				<span class="comment">// å…³é—­æœåŠ¡å™¨ æ­¤æ—¶thisæŒ‡å‘åŒ¿åå†…éƒ¨ç±»,éœ€è¦åŠ å¤–éƒ¨ç±»</span></span><br><span class="line">				ServerImpl.<span class="keyword">this</span>.shutdown();</span><br><span class="line">			&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">				<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">				<span class="keyword">if</span>(shutdownServer != <span class="keyword">null</span>) &#123;</span><br><span class="line">					<span class="keyword">try</span> &#123;</span><br><span class="line">						shutdownServer.close();</span><br><span class="line">					&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">						<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">						e.printStackTrace();</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;).start();</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shutdown</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="comment">// å°†æ¥æ”¶æœåŠ¡å™¨çš„whileæ¡ä»¶æ”¹ä¸ºfalse</span></span><br><span class="line">			<span class="comment">// æ­¤å¤„ä¸¤ä¸ªçº¿ç¨‹æ“ä½œä¸€ä¸ªå˜é‡ </span></span><br><span class="line">		<span class="keyword">this</span>.flag = <span class="keyword">false</span>;</span><br><span class="line">		<span class="comment">// æ‰‹åŠ¨å…³é—­æ¥æ”¶çº¿ç¨‹æœåŠ¡å™¨</span></span><br><span class="line">		<span class="keyword">if</span>(receiverServerSocket != <span class="keyword">null</span>) &#123;</span><br><span class="line">			receiverServerSocket.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="çº¿ç¨‹æ± "><a href="#çº¿ç¨‹æ± " class="headerlink" title="çº¿ç¨‹æ± "></a>çº¿ç¨‹æ± </h2><h3 id="overview"><a href="#overview" class="headerlink" title="overview"></a>overview</h3><p>å¦‚æœå¹¶å‘çš„çº¿ç¨‹æ•°é‡å¾ˆå¤šï¼Œå¹¶ä¸”æ¯ä¸ªçº¿ç¨‹éƒ½æ˜¯æ‰§è¡Œä¸€ä¸ªæ—¶é—´å¾ˆçŸ­çš„ä»»åŠ¡å°±ç»“æŸäº†ï¼Œè¿™æ ·é¢‘ç¹åˆ›å»ºçº¿ç¨‹å°±ä¼šå¤§å¤§é™ä½ç³»ç»Ÿçš„æ•ˆç‡ï¼Œå› ä¸ºé¢‘ç¹åˆ›å»ºçº¿ç¨‹å’Œé”€æ¯çº¿ç¨‹éœ€è¦æ—¶é—´ã€‚</p>
<p>é‚£ä¹ˆå¦‚æœæœ‰ä¸€ç§åŠæ³•ä½¿å¾—çº¿ç¨‹å¯ä»¥å¤ç”¨ï¼Œå°±æ˜¯æ‰§è¡Œå®Œä¸€ä¸ªä»»åŠ¡åï¼Œå¹¶ä¸è¢«é”€æ¯ï¼Œè€Œæ˜¯å¯ä»¥ç»§ç»­æ‰§è¡Œå…¶ä»–çš„ä»»åŠ¡çš„è¯ï¼Œé‚£ä¹ˆå°±å¯ä»¥å¤§å¤§æé«˜å…¶è¿è¡Œçš„æ•ˆç‡ã€‚</p>
<p>åœ¨Javaä¸­å¯ä»¥é€šè¿‡çº¿ç¨‹æ± æ¥è¾¾åˆ°è¿™æ ·çš„æ•ˆæœã€‚</p>
<h3 id="concurrent-å¹¶å‘"><a href="#concurrent-å¹¶å‘" class="headerlink" title="concurrent(å¹¶å‘)"></a>concurrent(å¹¶å‘)</h3><ul>
<li>ArrayList  synchoroinzed</li>
<li>LinkedList   Collections</li>
<li>concurrentä¸‹çš„ç±»</li>
</ul>
<blockquote>
<p>concurrentï¼Œå•è¯æœ¬èº«æ˜¯â€œå¹¶å‘â€çš„æ„æ€</p>
</blockquote>
<p><code>java.util.concurrent</code> ï¼Œæ˜¯JDKä¸­æä¾›çš„ä¸€ä¸ªä¸“é—¨å¤„ç†å¹¶å‘çš„åŒ…ï¼Œé‡Œé¢æœ‰ä¸€äº›ç›¸å…³çš„æ¥å£å’Œç±»ï¼Œå¯ä»¥åœ¨å¤„ç†çº¿ç¨‹å¹¶å‘è®¿é—®çš„æ—¶å€™ä½¿ç”¨ã€‚</p>
<p><code>java.util.concurrent.Executor</code> </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> java.util.concurrent;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * An object that executes submitted &#123;<span class="doctag">@link</span> Runnable&#125; tasks. This</span></span><br><span class="line"><span class="comment"> * interface provides a way of decoupling task submission from the</span></span><br><span class="line"><span class="comment"> * mechanics of how each task will be run, including details of thread</span></span><br><span class="line"><span class="comment"> * use, scheduling, etc.  An &#123;<span class="doctag">@code</span> Executor&#125; is normally used</span></span><br><span class="line"><span class="comment"> * instead of explicitly creating threads. For example, rather than</span></span><br><span class="line"><span class="comment"> * invoking &#123;<span class="doctag">@code</span> new Thread(new(RunnableTask())).start()&#125; for each</span></span><br><span class="line"><span class="comment"> * of a set of tasks, you might use:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;pre&gt;</span></span><br><span class="line"><span class="comment"> * Executor executor = &lt;em&gt;anExecutor&lt;/em&gt;;</span></span><br><span class="line"><span class="comment"> * executor.execute(new RunnableTask1());</span></span><br><span class="line"><span class="comment"> * executor.execute(new RunnableTask2());</span></span><br><span class="line"><span class="comment"> * ...</span></span><br><span class="line"><span class="comment"> * &lt;/pre&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * However, the &#123;<span class="doctag">@code</span> Executor&#125; interface does not strictly</span></span><br><span class="line"><span class="comment"> * require that execution be asynchronous. In the simplest case, an</span></span><br><span class="line"><span class="comment"> * executor can run the submitted task immediately in the caller&#x27;s</span></span><br><span class="line"><span class="comment"> * thread:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  &lt;pre&gt; &#123;<span class="doctag">@code</span></span></span><br><span class="line"><span class="comment"> * class DirectExecutor implements Executor &#123;</span></span><br><span class="line"><span class="comment"> *   public void execute(Runnable r) &#123;</span></span><br><span class="line"><span class="comment"> *     r.run();</span></span><br><span class="line"><span class="comment"> *   &#125;</span></span><br><span class="line"><span class="comment"> * &#125;&#125;&lt;/pre&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * More typically, tasks are executed in some thread other</span></span><br><span class="line"><span class="comment"> * than the caller&#x27;s thread.  The executor below spawns a new thread</span></span><br><span class="line"><span class="comment"> * for each task.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  &lt;pre&gt; &#123;<span class="doctag">@code</span></span></span><br><span class="line"><span class="comment"> * class ThreadPerTaskExecutor implements Executor &#123;</span></span><br><span class="line"><span class="comment"> *   public void execute(Runnable r) &#123;</span></span><br><span class="line"><span class="comment"> *     new Thread(r).start();</span></span><br><span class="line"><span class="comment"> *   &#125;</span></span><br><span class="line"><span class="comment"> * &#125;&#125;&lt;/pre&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Many &#123;<span class="doctag">@code</span> Executor&#125; implementations impose some sort of</span></span><br><span class="line"><span class="comment"> * limitation on how and when tasks are scheduled.  The executor below</span></span><br><span class="line"><span class="comment"> * serializes the submission of tasks to a second executor,</span></span><br><span class="line"><span class="comment"> * illustrating a composite executor.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  &lt;pre&gt; &#123;<span class="doctag">@code</span></span></span><br><span class="line"><span class="comment"> * class SerialExecutor implements Executor &#123;</span></span><br><span class="line"><span class="comment"> *   final Queue&lt;Runnable&gt; tasks = new ArrayDeque&lt;Runnable&gt;();</span></span><br><span class="line"><span class="comment"> *   final Executor executor;</span></span><br><span class="line"><span class="comment"> *   Runnable active;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   SerialExecutor(Executor executor) &#123;</span></span><br><span class="line"><span class="comment"> *     this.executor = executor;</span></span><br><span class="line"><span class="comment"> *   &#125;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   public synchronized void execute(final Runnable r) &#123;</span></span><br><span class="line"><span class="comment"> *     tasks.offer(new Runnable() &#123;</span></span><br><span class="line"><span class="comment"> *       public void run() &#123;</span></span><br><span class="line"><span class="comment"> *         try &#123;</span></span><br><span class="line"><span class="comment"> *           r.run();</span></span><br><span class="line"><span class="comment"> *         &#125; finally &#123;</span></span><br><span class="line"><span class="comment"> *           scheduleNext();</span></span><br><span class="line"><span class="comment"> *         &#125;</span></span><br><span class="line"><span class="comment"> *       &#125;</span></span><br><span class="line"><span class="comment"> *     &#125;);</span></span><br><span class="line"><span class="comment"> *     if (active == null) &#123;</span></span><br><span class="line"><span class="comment"> *       scheduleNext();</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> *   &#125;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   protected synchronized void scheduleNext() &#123;</span></span><br><span class="line"><span class="comment"> *     if ((active = tasks.poll()) != null) &#123;</span></span><br><span class="line"><span class="comment"> *       executor.execute(active);</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> *   &#125;</span></span><br><span class="line"><span class="comment"> * &#125;&#125;&lt;/pre&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * The &#123;<span class="doctag">@code</span> Executor&#125; implementations provided in this package</span></span><br><span class="line"><span class="comment"> * implement &#123;<span class="doctag">@link</span> ExecutorService&#125;, which is a more extensive</span></span><br><span class="line"><span class="comment"> * interface.  The &#123;<span class="doctag">@link</span> ThreadPoolExecutor&#125; class provides an</span></span><br><span class="line"><span class="comment"> * extensible thread pool implementation. The &#123;<span class="doctag">@link</span> Executors&#125; class</span></span><br><span class="line"><span class="comment"> * provides convenient factory methods for these Executors.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Memory consistency effects: Actions in a thread prior to</span></span><br><span class="line"><span class="comment"> * submitting a &#123;<span class="doctag">@code</span> Runnable&#125; object to an &#123;<span class="doctag">@code</span> Executor&#125;</span></span><br><span class="line"><span class="comment"> * &lt;a href=&quot;package-summary.html#MemoryVisibility&quot;&gt;&lt;i&gt;happen-before&lt;/i&gt;&lt;/a&gt;</span></span><br><span class="line"><span class="comment"> * its execution begins, perhaps in another thread.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.5</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Doug Lea</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Executor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Executes the given command at some time in the future.  The command</span></span><br><span class="line"><span class="comment">     * may execute in a new thread, in a pooled thread, or in the calling</span></span><br><span class="line"><span class="comment">     * thread, at the discretion of the &#123;<span class="doctag">@code</span> Executor&#125; implementation.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> command the runnable task</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> RejectedExecutionException if this task cannot be</span></span><br><span class="line"><span class="comment">     * accepted for execution</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> NullPointerException if command is null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">execute</span><span class="params">(Runnable command)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¿™æ˜¯ä¸€ä¸ªé¡¶å±‚æ¥å£ï¼Œåœ¨å®ƒé‡Œé¢åªå£°æ˜äº†ä¸€ä¸ª<code>execute</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°±æ˜¯ç”¨æ¥æ‰§è¡Œä¼ è¿›å»çš„ä»»åŠ¡çš„</p>
</blockquote>
<p><code>java.util.concurrent.ExecutorService</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> java.util.concurrent;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * An &#123;<span class="doctag">@link</span> Executor&#125; that provides methods to manage termination and</span></span><br><span class="line"><span class="comment"> * methods that can produce a &#123;<span class="doctag">@link</span> Future&#125; for tracking progress of</span></span><br><span class="line"><span class="comment"> * one or more asynchronous tasks.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;An &#123;<span class="doctag">@code</span> ExecutorService&#125; can be shut down, which will cause</span></span><br><span class="line"><span class="comment"> * it to reject new tasks.  Two different methods are provided for</span></span><br><span class="line"><span class="comment"> * shutting down an &#123;<span class="doctag">@code</span> ExecutorService&#125;. The &#123;<span class="doctag">@link</span> #shutdown&#125;</span></span><br><span class="line"><span class="comment"> * method will allow previously submitted tasks to execute before</span></span><br><span class="line"><span class="comment"> * terminating, while the &#123;<span class="doctag">@link</span> #shutdownNow&#125; method prevents waiting</span></span><br><span class="line"><span class="comment"> * tasks from starting and attempts to stop currently executing tasks.</span></span><br><span class="line"><span class="comment"> * Upon termination, an executor has no tasks actively executing, no</span></span><br><span class="line"><span class="comment"> * tasks awaiting execution, and no new tasks can be submitted.  An</span></span><br><span class="line"><span class="comment"> * unused &#123;<span class="doctag">@code</span> ExecutorService&#125; should be shut down to allow</span></span><br><span class="line"><span class="comment"> * reclamation of its resources.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Method &#123;<span class="doctag">@code</span> submit&#125; extends base method &#123;<span class="doctag">@link</span></span></span><br><span class="line"><span class="comment"> * Executor#execute(Runnable)&#125; by creating and returning a &#123;<span class="doctag">@link</span> Future&#125;</span></span><br><span class="line"><span class="comment"> * that can be used to cancel execution and/or wait for completion.</span></span><br><span class="line"><span class="comment"> * Methods &#123;<span class="doctag">@code</span> invokeAny&#125; and &#123;<span class="doctag">@code</span> invokeAll&#125; perform the most</span></span><br><span class="line"><span class="comment"> * commonly useful forms of bulk execution, executing a collection of</span></span><br><span class="line"><span class="comment"> * tasks and then waiting for at least one, or all, to</span></span><br><span class="line"><span class="comment"> * complete. (Class &#123;<span class="doctag">@link</span> ExecutorCompletionService&#125; can be used to</span></span><br><span class="line"><span class="comment"> * write customized variants of these methods.)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;The &#123;<span class="doctag">@link</span> Executors&#125; class provides factory methods for the</span></span><br><span class="line"><span class="comment"> * executor services provided in this package.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;h3&gt;Usage Examples&lt;/h3&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Here is a sketch of a network service in which threads in a thread</span></span><br><span class="line"><span class="comment"> * pool service incoming requests. It uses the preconfigured &#123;<span class="doctag">@link</span></span></span><br><span class="line"><span class="comment"> * Executors#newFixedThreadPool&#125; factory method:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  &lt;pre&gt; &#123;<span class="doctag">@code</span></span></span><br><span class="line"><span class="comment"> * class NetworkService implements Runnable &#123;</span></span><br><span class="line"><span class="comment"> *   private final ServerSocket serverSocket;</span></span><br><span class="line"><span class="comment"> *   private final ExecutorService pool;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   public NetworkService(int port, int poolSize)</span></span><br><span class="line"><span class="comment"> *       throws IOException &#123;</span></span><br><span class="line"><span class="comment"> *     serverSocket = new ServerSocket(port);</span></span><br><span class="line"><span class="comment"> *     pool = Executors.newFixedThreadPool(poolSize);</span></span><br><span class="line"><span class="comment"> *   &#125;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   public void run() &#123; // run the service</span></span><br><span class="line"><span class="comment"> *     try &#123;</span></span><br><span class="line"><span class="comment"> *       for (;;) &#123;</span></span><br><span class="line"><span class="comment"> *         pool.execute(new Handler(serverSocket.accept()));</span></span><br><span class="line"><span class="comment"> *       &#125;</span></span><br><span class="line"><span class="comment"> *     &#125; catch (IOException ex) &#123;</span></span><br><span class="line"><span class="comment"> *       pool.shutdown();</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> *   &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * class Handler implements Runnable &#123;</span></span><br><span class="line"><span class="comment"> *   private final Socket socket;</span></span><br><span class="line"><span class="comment"> *   Handler(Socket socket) &#123; this.socket = socket; &#125;</span></span><br><span class="line"><span class="comment"> *   public void run() &#123;</span></span><br><span class="line"><span class="comment"> *     // read and service request on socket</span></span><br><span class="line"><span class="comment"> *   &#125;</span></span><br><span class="line"><span class="comment"> * &#125;&#125;&lt;/pre&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * The following method shuts down an &#123;<span class="doctag">@code</span> ExecutorService&#125; in two phases,</span></span><br><span class="line"><span class="comment"> * first by calling &#123;<span class="doctag">@code</span> shutdown&#125; to reject incoming tasks, and then</span></span><br><span class="line"><span class="comment"> * calling &#123;<span class="doctag">@code</span> shutdownNow&#125;, if necessary, to cancel any lingering tasks:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  &lt;pre&gt; &#123;<span class="doctag">@code</span></span></span><br><span class="line"><span class="comment"> * void shutdownAndAwaitTermination(ExecutorService pool) &#123;</span></span><br><span class="line"><span class="comment"> *   pool.shutdown(); // Disable new tasks from being submitted</span></span><br><span class="line"><span class="comment"> *   try &#123;</span></span><br><span class="line"><span class="comment"> *     // Wait a while for existing tasks to terminate</span></span><br><span class="line"><span class="comment"> *     if (!pool.awaitTermination(60, TimeUnit.SECONDS)) &#123;</span></span><br><span class="line"><span class="comment"> *       pool.shutdownNow(); // Cancel currently executing tasks</span></span><br><span class="line"><span class="comment"> *       // Wait a while for tasks to respond to being cancelled</span></span><br><span class="line"><span class="comment"> *       if (!pool.awaitTermination(60, TimeUnit.SECONDS))</span></span><br><span class="line"><span class="comment"> *           System.err.println(&quot;Pool did not terminate&quot;);</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> *   &#125; catch (InterruptedException ie) &#123;</span></span><br><span class="line"><span class="comment"> *     // (Re-)Cancel if current thread also interrupted</span></span><br><span class="line"><span class="comment"> *     pool.shutdownNow();</span></span><br><span class="line"><span class="comment"> *     // Preserve interrupt status</span></span><br><span class="line"><span class="comment"> *     Thread.currentThread().interrupt();</span></span><br><span class="line"><span class="comment"> *   &#125;</span></span><br><span class="line"><span class="comment"> * &#125;&#125;&lt;/pre&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Memory consistency effects: Actions in a thread prior to the</span></span><br><span class="line"><span class="comment"> * submission of a &#123;<span class="doctag">@code</span> Runnable&#125; or &#123;<span class="doctag">@code</span> Callable&#125; task to an</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> ExecutorService&#125;</span></span><br><span class="line"><span class="comment"> * &lt;a href=&quot;package-summary.html#MemoryVisibility&quot;&gt;&lt;i&gt;happen-before&lt;/i&gt;&lt;/a&gt;</span></span><br><span class="line"><span class="comment"> * any actions taken by that task, which in turn &lt;i&gt;happen-before&lt;/i&gt; the</span></span><br><span class="line"><span class="comment"> * result is retrieved via &#123;<span class="doctag">@code</span> Future.get()&#125;.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.5</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Doug Lea</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ExecutorService</span> <span class="keyword">extends</span> <span class="title">Executor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">shutdown</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="function">List&lt;Runnable&gt; <span class="title">shutdownNow</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isShutdown</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isTerminated</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">awaitTermination</span><span class="params">(<span class="keyword">long</span> timeout, TimeUnit unit)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> InterruptedException</span>;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    &lt;T&gt; <span class="function">Future&lt;T&gt; <span class="title">submit</span><span class="params">(Callable&lt;T&gt; task)</span></span>;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    &lt;T&gt; <span class="function">Future&lt;T&gt; <span class="title">submit</span><span class="params">(Runnable task, T result)</span></span>;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    Future&lt;?&gt; submit(Runnable task);</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    &lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks)</span><br><span class="line">        <span class="keyword">throws</span> InterruptedException;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    &lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks,</span><br><span class="line">                                  <span class="keyword">long</span> timeout, TimeUnit unit)</span><br><span class="line">        <span class="keyword">throws</span> InterruptedException;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    &lt;T&gt; <span class="function">T <span class="title">invokeAny</span><span class="params">(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> InterruptedException, ExecutionException</span>;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    &lt;T&gt; <span class="function">T <span class="title">invokeAny</span><span class="params">(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks,</span></span></span><br><span class="line"><span class="params"><span class="function">                    <span class="keyword">long</span> timeout, TimeUnit unit)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> InterruptedException, ExecutionException, TimeoutException</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>ExecutorServiceæ¥å£ç»§æ‰¿äº†Executoræ¥å£ï¼Œå¹¶å£°æ˜äº†ä¸€äº›æ–¹æ³•ï¼šsubmitã€invokeAllã€invokeAnyä»¥åŠshutDownç­‰</p>
</blockquote>
<p><code>java.util.concurrent.AbstractExecutorService</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractExecutorService</span> <span class="keyword">implements</span> <span class="title">ExecutorService</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æŠ½è±¡ç±»AbstractExecutorServiceå®ç°äº†ExecutorServiceæ¥å£</p>
</blockquote>
<p><code>java.util.concurrent.ThreadPoolExecutor</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadPoolExecutor</span> <span class="keyword">extends</span> <span class="title">AbstractExecutorService</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ThreadPoolExecutorç»§æ‰¿äº†ç±»AbstractExecutorServiceï¼Œå¹¶è¿›è¡Œäº†æ‰©å±•</p>
</blockquote>
<blockquote>
<p>æ³¨æ„ï¼ŒThreadPoolExecutorå°±æ˜¯JKDä¸­æä¾›çš„ä¸€ä¸ªçº¿ç¨‹æ± ç±»</p>
</blockquote>
<h3 id="ThreadPoolExecutor"><a href="#ThreadPoolExecutor" class="headerlink" title="ThreadPoolExecutor"></a>ThreadPoolExecutor</h3><p><code>ThreadPoolExecutor</code>ç±»ä¸­æœ‰ä¸€ä¸ªäº”å‚æ„é€ å™¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadPoolExecutor</span> <span class="keyword">extends</span> <span class="title">AbstractExecutorService</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize,</span></span></span><br><span class="line"><span class="params"><span class="function">                              <span class="keyword">int</span> maximumPoolSize,</span></span></span><br><span class="line"><span class="params"><span class="function">                              <span class="keyword">long</span> keepAliveTime,</span></span></span><br><span class="line"><span class="params"><span class="function">                              TimeUnit unit,</span></span></span><br><span class="line"><span class="params"><span class="function">                              BlockingQueue&lt;Runnable&gt; workQueue)</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//..</span></span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å‚æ•°çš„å«ä¹‰:</p>
<ul>
<li><code>corePoolSize</code>ï¼Œçº¿ç¨‹æ± ç»´æŠ¤çº¿ç¨‹çš„æœ€å°‘æ•°é‡(æ ¸å¿ƒçº¿ç¨‹æ•°) </li>
<li><code>maximumPoolSize</code>ï¼Œçº¿ç¨‹æ± ç»´æŠ¤çº¿ç¨‹çš„æœ€å¤§æ•°é‡ </li>
<li><code>keepAliveTime</code>ï¼Œçº¿ç¨‹æ± ç»´æŠ¤çº¿ç¨‹æ‰€å…è®¸çš„ç©ºé—²æ—¶é—´</li>
<li><code>unit</code>ï¼Œçº¿ç¨‹æ± ç»´æŠ¤çº¿ç¨‹æ‰€å…è®¸çš„ç©ºé—²æ—¶é—´çš„å•ä½  </li>
<li><code>workQueue</code>ï¼Œçº¿ç¨‹æ± æ‰€ä½¿ç”¨çš„ç¼“å†²é˜Ÿåˆ— </li>
</ul>
<p><img src="https://gitee.com/vanse/images/raw/master/environment/20180419002550514" alt="img"></p>
<p><img src="https://gitee.com/vanse/images/raw/master/environment/6024478-88ee7b20f8f45825.png" alt="img"></p>
<p>ä¾‹å¦‚ï¼Œ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ArrayBlockingQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ThreadPoolExecutor;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadPoolExecutorTest</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		ThreadPoolExecutor executor = <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">5</span>, <span class="number">10</span>, <span class="number">2000</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">				<span class="keyword">new</span> ArrayBlockingQueue&lt;Runnable&gt;(<span class="number">5</span>));</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">15</span>;i++)&#123;</span><br><span class="line">			MyRun myTask = <span class="keyword">new</span> MyRun();</span><br><span class="line">			<span class="comment">//æŠŠè¦æ‰§è¡Œçš„ä»»åŠ¡äº¤ç»™çº¿ç¨‹æ± å³å¯</span></span><br><span class="line">			executor.execute(myTask);</span><br><span class="line">			System.out.println(<span class="string">&quot;çº¿ç¨‹æ± ä¸­çº¿ç¨‹æ•°ç›®: &quot;</span>+executor.getPoolSize()+</span><br><span class="line">								<span class="string">&quot;,é˜Ÿåˆ—ä¸­ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡æ•°ç›®: &quot;</span>+executor.getQueue().size()+</span><br><span class="line">								<span class="string">&quot;,å·²æ‰§è¡Œå®Œçš„ä»»åŠ¡æ•°ç›®: &quot;</span>+executor.getCompletedTaskCount());</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//å…³é—­çº¿ç¨‹æ± </span></span><br><span class="line">		executor.shutdown();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRun</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">100</span>;i++)&#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					Thread.sleep(<span class="number">1</span>);</span><br><span class="line">				&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">	</span><br><span class="line">			System.out.println(<span class="string">&quot;ä»»åŠ¡ç»“æŸ&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">Executors</span><br></pre></td></tr></table></figure>

<ul>
<li>CachedThreadPool:å¯ç¼“å­˜çš„çº¿ç¨‹æ± ï¼Œè¯¥çº¿ç¨‹æ± ä¸­æ²¡æœ‰æ ¸å¿ƒçº¿ç¨‹ï¼Œéæ ¸å¿ƒçº¿ç¨‹çš„æ•°é‡ä¸ºInteger.max_valueï¼Œå°±æ˜¯æ— é™å¤§ï¼Œå½“æœ‰éœ€è¦æ—¶åˆ›å»ºçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œæ²¡æœ‰éœ€è¦æ—¶å›æ”¶çº¿ç¨‹ï¼Œé€‚ç”¨äºè€—æ—¶å°‘ï¼Œä»»åŠ¡é‡å¤§çš„æƒ…å†µã€‚</li>
<li>SecudleThreadPool:å‘¨æœŸæ€§æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹æ± ï¼ŒæŒ‰ç…§æŸç§ç‰¹å®šçš„è®¡åˆ’æ‰§è¡Œçº¿ç¨‹ä¸­çš„ä»»åŠ¡ï¼Œæœ‰æ ¸å¿ƒçº¿ç¨‹ï¼Œä½†ä¹Ÿæœ‰éæ ¸å¿ƒçº¿ç¨‹ï¼Œéæ ¸å¿ƒçº¿ç¨‹çš„å¤§å°ä¹Ÿä¸ºæ— é™å¤§ã€‚é€‚ç”¨äºæ‰§è¡Œå‘¨æœŸæ€§çš„ä»»åŠ¡ã€‚</li>
<li>SingleThreadPool:åªæœ‰ä¸€æ¡çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œé€‚ç”¨äºæœ‰é¡ºåºçš„ä»»åŠ¡çš„åº”ç”¨åœºæ™¯ã€‚</li>
<li>FixedThreadPool:å®šé•¿çš„çº¿ç¨‹æ± ï¼Œæœ‰æ ¸å¿ƒçº¿ç¨‹ï¼Œæ ¸å¿ƒçº¿ç¨‹çš„å³ä¸ºæœ€å¤§çš„çº¿ç¨‹æ•°é‡ï¼Œæ²¡æœ‰éæ ¸å¿ƒçº¿ç¨‹</li>
</ul>
<p><code>java.util.concurrent.Executors</code> ï¼Œè¿™ä¸ªæ˜¯ä¸€ä¸ªå·¥å‚ç±»ï¼Œå¯ä»¥ä¾¿æ·çš„å¸®æˆ‘ä»¬ç”Ÿäº§å‡ºçº¿ç¨‹æ± å¯¹è±¡ï¼ŒåŒæ—¶è¯¥ç±»ä¸­ä¹Ÿæä¾›äº†ä¸€äº›å®ç”¨çš„å·¥å‚æ–¹æ³•ï¼š</p>
<p>å·¥å‚æ–¹æ³•1ï¼Œåˆ›å»ºä¸€ä¸ªå®šé•¿çš„çº¿ç¨‹æ± ï¼Œå¯æ§åˆ¶çº¿ç¨‹æœ€å¤§å¹¶å‘æ•°ï¼Œè¶…å‡ºçš„çº¿ç¨‹ä¼šåœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…</p>
<p>ä¾‹å¦‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newFixedThreadPool</span><span class="params">(<span class="keyword">int</span> nThreads)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolExecutor(nThreads, nThreads,</span><br><span class="line">                                  <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                                  <span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    ExecutorService fixedThreadPool = Executors.newFixedThreadPool(<span class="number">3</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> index = i;</span><br><span class="line">        fixedThreadPool.execute(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(index);</span><br><span class="line">                    Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fixedThreadPool.shutdown();</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ³¨æ„ï¼Œæœ€åè®°å¾—ç”¨å®Œå°±å…³é—­çº¿ç¨‹æ± </p>
</blockquote>
<p>==æ€è€ƒï¼Œå¦‚æœç”¨å®Œä¹‹åï¼Œæ²¡æœ‰å…³é—­çº¿ç¨‹æ± ï¼Œé‚£ä¹ˆä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µï¼Ÿ==</p>
<p>å·¥å‚æ–¹æ³•2ï¼Œåˆ›å»ºä¸€ä¸ªå¯ç¼“å­˜çš„çº¿ç¨‹æ± ï¼Œå¦‚æœçº¿ç¨‹æ± é•¿åº¦è¶…è¿‡å¤„ç†éœ€è¦ï¼Œå¯çµæ´»å›æ”¶ç©ºé—²çº¿ç¨‹ï¼Œå¦åˆ™æ–°å»ºçº¿ç¨‹</p>
<p>ä¾‹å¦‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newCachedThreadPool</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">0</span>, Integer.MAX_VALUE,</span><br><span class="line">                                  <span class="number">60L</span>, TimeUnit.SECONDS,</span><br><span class="line">                                  <span class="keyword">new</span> SynchronousQueue&lt;Runnable&gt;());</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    ExecutorService cachedThreadPool = Executors.newCachedThreadPool();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> index = i;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(index * <span class="number">1000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        cachedThreadPool.execute(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                System.out.println(index);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> poolSize = ((ThreadPoolExecutor)cachedThreadPool).getPoolSize();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;çº¿ç¨‹æ± ä¸­å½“å‰çº¿ç¨‹çš„æ•°é‡: &quot;</span>+poolSize);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    cachedThreadPool.shutdown();</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>å·¥å‚æ–¹æ³•3ï¼Œåˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹åŒ–çš„çº¿ç¨‹æ± ï¼Œå®ƒåªä¼šç”¨å”¯ä¸€çš„å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œä¿è¯æ‰€æœ‰ä»»åŠ¡æŒ‰ç…§æŒ‡å®šé¡ºåºæ‰§è¡Œ</p>
<p>ä¾‹å¦‚ï¼Œ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newSingleThreadExecutor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> FinalizableDelegatedExecutorService(<span class="keyword">new</span> ThreadPoolExecutor(<span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line">                                    <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                                    <span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    ExecutorService singleThreadExecutor = Executors.newSingleThreadExecutor();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> index = i;</span><br><span class="line">        singleThreadExecutor.execute(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(index);</span><br><span class="line">                    Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    singleThreadExecutor.shutdown();</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>å·¥å‚æ–¹æ³•4ï¼Œåˆ›å»ºä¸€ä¸ªå®šé•¿çº¿ç¨‹æ± ,æ”¯æŒå®šæ—¶åŠå‘¨æœŸæ€§ä»»åŠ¡æ‰§è¡Œ</p>
<p>ä¾‹å¦‚ï¼Œ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ScheduledExecutorService <span class="title">newScheduledThreadPool</span><span class="params">(<span class="keyword">int</span> corePoolSize)</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ScheduledThreadPoolExecutor(corePoolSize);  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    ScheduledExecutorService scheduledThreadPool = Executors.newScheduledThreadPool(<span class="number">5</span>);</span><br><span class="line">    scheduledThreadPool.scheduleAtFixedRate(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;å»¶è¿Ÿ10ç§’åæ‰§è¡Œ,ä¹‹åå†æŒ‰ç…§æ¯3ç§’æ‰§è¡Œä¸€æ¬¡&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="number">1</span>, <span class="number">3</span>, TimeUnit.SECONDS);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ”¹é€ æœåŠ¡ç«¯"><a href="#æ”¹é€ æœåŠ¡ç«¯" class="headerlink" title="æ”¹é€ æœåŠ¡ç«¯"></a>æ”¹é€ æœåŠ¡ç«¯</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.smart.env.server;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.smart.env.Configuration;</span><br><span class="line"><span class="keyword">import</span> com.briup.smart.env.constant.EnvGatherConstants;</span><br><span class="line"><span class="keyword">import</span> com.briup.smart.env.entity.Environment;</span><br><span class="line"><span class="keyword">import</span> com.briup.smart.env.support.ConfigurationAware;</span><br><span class="line"><span class="keyword">import</span> com.briup.smart.env.support.PropertiesAware;</span><br><span class="line"><span class="keyword">import</span> com.briup.smart.env.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServerImpl</span> <span class="keyword">implements</span> <span class="title">Server</span>,<span class="title">PropertiesAware</span>,<span class="title">ConfigurationAware</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> reciverServerPort;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> shutdownServerPort;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> flag = <span class="keyword">true</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> ServerSocket reciverServer;</span><br><span class="line">	<span class="keyword">private</span> ServerSocket shutdownServer;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> ExecutorService threadPool = Executors.newFixedThreadPool(<span class="number">5</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> Socket socket;</span><br><span class="line">	<span class="keyword">private</span> ObjectInputStream in;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> DBStore dbStore;</span><br><span class="line">	<span class="keyword">private</span> Log logger;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reciver</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		</span><br><span class="line">		logger.info(<span class="string">&quot;shutdownæœåŠ¡å™¨å·²ç»å¯åŠ¨ï¼š&quot;</span>+shutdownServerPort);</span><br><span class="line">		startShutdownServer();</span><br><span class="line">		</span><br><span class="line">		logger.info(<span class="string">&quot;reciveræœåŠ¡å™¨å·²ç»å¯åŠ¨ï¼š&quot;</span>+reciverServerPort);</span><br><span class="line">		startReciverServer();</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * å¯åŠ¨reciveræœåŠ¡å™¨ï¼ˆæ¥æ”¶æœåŠ¡å™¨ï¼‰</span></span><br><span class="line"><span class="comment">	 * ä½œç”¨ï¼šè¯¥æœåŠ¡å™¨çš„ç«¯å£9999ï¼Œè´Ÿè´£æ¥æ”¶å®¢æˆ·ç«¯å‘é€çš„æ•°æ®</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">startReciverServer</span><span class="params">()</span><span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			</span><br><span class="line">			reciverServer = <span class="keyword">new</span> ServerSocket(reciverServerPort);</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">while</span>(flag) &#123;</span><br><span class="line">				logger.debug(<span class="string">&quot;reciverServeræœåŠ¡å™¨æ­£åœ¨ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥&quot;</span>);</span><br><span class="line">				socket = reciverServer.accept();</span><br><span class="line">				</span><br><span class="line">				</span><br><span class="line">				logger.debug(<span class="string">&quot;reciverServeræœåŠ¡å™¨æ¥æ”¶åˆ°å®¢æˆ·ç«¯è¿æ¥&quot;</span>);</span><br><span class="line">				logger.debug(<span class="string">&quot;reciverServeræœåŠ¡å™¨ä½¿ç”¨çº¿ç¨‹æ± å¤„ç†è¿™ä¸ªå®¢æˆ·ç«¯&quot;</span>);</span><br><span class="line">				threadPool.execute(()-&gt;&#123;</span><br><span class="line">					<span class="keyword">try</span> &#123;</span><br><span class="line">						</span><br><span class="line">						in = <span class="keyword">new</span> ObjectInputStream(socket.getInputStream());</span><br><span class="line">						</span><br><span class="line">						<span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">						List&lt;Environment&gt; list = (List&lt;Environment&gt;)in.readObject();</span><br><span class="line">						</span><br><span class="line">						dbStore.saveDB(list);</span><br><span class="line">						</span><br><span class="line">						socket.close();</span><br><span class="line">						</span><br><span class="line">					&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">						e.printStackTrace();</span><br><span class="line">					&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">						<span class="keyword">if</span>(socket!=<span class="keyword">null</span>) &#123;</span><br><span class="line">							<span class="keyword">try</span> &#123;</span><br><span class="line">								socket.close();</span><br><span class="line">							&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">								e.printStackTrace();</span><br><span class="line">							&#125;</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">					</span><br><span class="line">					</span><br><span class="line">				&#125;);</span><br><span class="line">				</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			<span class="keyword">if</span>(socket!=<span class="keyword">null</span>) &#123;</span><br><span class="line">				socket.close();</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(reciverServer!=<span class="keyword">null</span>) &#123;</span><br><span class="line">				reciverServer.close();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * å¯åŠ¨shutdownæœåŠ¡å™¨ï¼ˆå…³é—­æœåŠ¡å™¨ï¼‰</span></span><br><span class="line"><span class="comment">	 * ä½œç”¨ï¼šè¯¥æœåŠ¡å™¨çš„ç«¯å£8888ï¼Œè´Ÿè´£æ¥æ”¶ç”¨æˆ·å‘é€çš„æ¶ˆæ¯ï¼Œå¯ä»¥å…³é—­æ‰€æœ‰æœåŠ¡å™¨ï¼ˆreciverå’Œshutdownï¼‰</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">startShutdownServer</span><span class="params">()</span><span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line"><span class="comment">//		Runnable run = ()-&gt;&#123;&#125;;</span></span><br><span class="line">		Runnable run = ()-&gt;&#123;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				shutdownServer = <span class="keyword">new</span> ServerSocket(shutdownServerPort);</span><br><span class="line">				</span><br><span class="line">				shutdownServer.accept();</span><br><span class="line">				</span><br><span class="line">				ServerImpl.<span class="keyword">this</span>.shutdown();</span><br><span class="line">				</span><br><span class="line">			&#125;<span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">				<span class="keyword">if</span>(shutdownServer!=<span class="keyword">null</span>) &#123;</span><br><span class="line">					<span class="keyword">try</span> &#123;</span><br><span class="line">						shutdownServer.close();</span><br><span class="line">					&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">						e.printStackTrace();</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">new</span> Thread(run).start();</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shutdown</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.flag = <span class="keyword">false</span>;</span><br><span class="line">		reciverServer.close();</span><br><span class="line">		threadPool.shutdown();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(Properties properties)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		reciverServerPort = Integer.parseInt(properties.getProperty(EnvGatherConstants.MODULE_SERVER_RECIVER_SERVER_PORT));</span><br><span class="line">		shutdownServerPort = Integer.parseInt(properties.getProperty(EnvGatherConstants.MODULE_SERVER_SHUTDOWN_SERVER_PORT));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setConfiguration</span><span class="params">(Configuration configuration)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		dbStore = configuration.getDbStore();</span><br><span class="line">		logger = configuration.getLogger();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h1 id="8-æ‰“åŒ…"><a href="#8-æ‰“åŒ…" class="headerlink" title="8 æ‰“åŒ…"></a>8 æ‰“åŒ…</h1><h2 id="é…ç½®æ’ä»¶"><a href="#é…ç½®æ’ä»¶" class="headerlink" title="é…ç½®æ’ä»¶"></a>é…ç½®æ’ä»¶</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">finalName</span>&gt;</span>env-gather-client<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line"></span><br><span class="line">			<span class="comment">&lt;!-- å¯æ‰§è¡Œjaræ’ä»¶ --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-shade-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">					<span class="comment">&lt;!-- è®¾ç½®æ‰“åŒ…æ—¶å€™ç”Ÿæˆdependency-reduced-pom.xmlæ–‡ä»¶ä¸ºfalse --&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">createDependencyReducedPom</span>&gt;</span>false<span class="tag">&lt;/<span class="name">createDependencyReducedPom</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">						<span class="comment">&lt;!-- ç»‘å®šshadeæ’ä»¶åˆ°Mavençš„ç”Ÿå‘½å‘¨æœŸ (package) --&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">						<span class="comment">&lt;!--åœ¨ç”Ÿå‘½å‘¨æœŸåæ‰§è¡Œç»‘å®šçš„shadeæ’ä»¶çš„goals --&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">							<span class="tag">&lt;<span class="name">goal</span>&gt;</span>shade<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">							<span class="tag">&lt;<span class="name">transformers</span>&gt;</span></span><br><span class="line">								<span class="tag">&lt;<span class="name">transformer</span></span></span><br><span class="line"><span class="tag">									<span class="attr">implementation</span>=<span class="string">&quot;org.apache.maven.plugins.shade.resource.ManifestResourceTransformer&quot;</span>&gt;</span></span><br><span class="line">									<span class="comment">&lt;!--æŒ‡å®šç¨‹åºå…¥å£ç±» --&gt;</span></span><br><span class="line">									<span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.briup.smart.env.main.ClientMain<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">								<span class="tag">&lt;/<span class="name">transformer</span>&gt;</span></span><br><span class="line">							<span class="tag">&lt;/<span class="name">transformers</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="ä¿®æ”¹srcç›¸å…³è·¯å¾„"><a href="#ä¿®æ”¹srcç›¸å…³è·¯å¾„" class="headerlink" title="ä¿®æ”¹srcç›¸å…³è·¯å¾„"></a>ä¿®æ”¹srcç›¸å…³è·¯å¾„</h2><p><code>conf-deploy.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">environment</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">gather</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.smart.env.client.GatherImpl&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">gather-data-file-path</span>&gt;</span>data-file-simple<span class="tag">&lt;/<span class="name">gather-data-file-path</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">gather-file-length-bak</span>&gt;</span>gather-file-length<span class="tag">&lt;/<span class="name">gather-file-length-bak</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">gather</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">logger</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.smart.env.util.LogImpl&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">backup</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.smart.env.util.BackupImpl&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">backup-base-path</span>&gt;</span>D:/env/bak<span class="tag">&lt;/<span class="name">backup-base-path</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">backup</span>&gt;</span></span><br><span class="line">	 </span><br><span class="line">	<span class="tag">&lt;<span class="name">client</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.smart.env.client.ClientImpl&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">client-server-ip</span>&gt;</span>127.0.0.1<span class="tag">&lt;/<span class="name">client-server-ip</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">client-port</span>&gt;</span>8888<span class="tag">&lt;/<span class="name">client-port</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">client</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">server</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.smart.env.server.ServerImpl&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">server-port</span>&gt;</span>8888<span class="tag">&lt;/<span class="name">server-port</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">server-stop-port</span>&gt;</span>9999<span class="tag">&lt;/<span class="name">server-stop-port</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">dbStore</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.smart.env.server.DBStoreImpl&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dbStore-batch-size</span>&gt;</span>100<span class="tag">&lt;/<span class="name">dbStore-batch-size</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dbStore</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="ä½¿ç”¨ç±»åŠ è½½å™¨åŠ è½½èµ„æº"><a href="#ä½¿ç”¨ç±»åŠ è½½å™¨åŠ è½½èµ„æº" class="headerlink" title="ä½¿ç”¨ç±»åŠ è½½å™¨åŠ è½½èµ„æº"></a>ä½¿ç”¨ç±»åŠ è½½å™¨åŠ è½½èµ„æº</h2><p><code>ConfigurationImpl</code></p>
<p><img src="https://gitee.com/vanse/images/raw/master/environment/image-20210929202202813.png" alt="image-20210929202202813"></p>
<p><img src="https://gitee.com/vanse/images/raw/master/environment/image-20210929202226219.png" alt="image-20210929202226219"></p>
<p><code>BackupImpl</code></p>
<p><img src="https://gitee.com/vanse/images/raw/master/environment/image-20210929202321655.png" alt="image-20210929202321655"></p>
<p><img src="https://gitee.com/vanse/images/raw/master/environment/image-20210929202330401.png" alt="image-20210929202330401"></p>
<p><code>GatherImpl</code></p>
<p><img src="https://gitee.com/vanse/images/raw/master/environment/image-20210929202301756.png" alt="image-20210929202301756"></p>
<p>==æ­¤å¤„è¦æ³¨æ„æ‰“åŒ…å,new File(path)æ˜¯æ–‡ä»¶ä¸å­˜åœ¨çš„,æ­¤æ—¶fileLength=0==</p>
 
      <!-- reward -->
      
      <div id="reword-out">
        <div id="reward-btn">
          æ‰“èµ
        </div>
      </div>
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/briup/" rel="tag">briup</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/corejava/" rel="tag">corejava</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vanse-public/" rel="tag">vanse_public</a></li></ul>

    </footer>
  </div>

   
  <nav class="article-nav">
    
      <a href="/archives/briup/vanse_spring.html" class="article-nav-link">
        <strong class="article-nav-caption">ä¸Šä¸€ç¯‡</strong>
        <div class="article-nav-title">
          
            springç†è§£
          
        </div>
      </a>
    
    
  </nav>

  
   
<div class="gitalk" id="gitalk-container"></div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css">


<script src="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js"></script>


<script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script>

<script type="text/javascript">
  var gitalk = new Gitalk({
    clientID: 'abdf20cf8f71fc88e695',
    clientSecret: '050f9f7209fbd2e9f446fb0ade695e4e5dd12e84',
    repo: 'hexo_comment',
    owner: 'wangsidandan',
    admin: ['wangsidandan'],
    // id: location.pathname,      // Ensure uniqueness and length less than 50
    id: md5(location.pathname),
    distractionFreeMode: false,  // Facebook-like distraction free mode
    pagerDirection: 'last'
  })

  gitalk.render('gitalk-container')
</script>

     
</article>

</section>
      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2015-2022
        <i class="ri-heart-fill heart_icon"></i> vanse
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>è®¿é—®äººæ•°:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>æµè§ˆæ¬¡æ•°:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzzç»Ÿè®¡ -->
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.svg" alt="vanse"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">ä¸»é¡µ</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">å½’æ¡£</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">åˆ†ç±»</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">æ ‡ç­¾</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/playlist">éŸ³ä¹</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/photos">ç›¸å†Œ</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/friends">å‹é“¾</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="æœç´¢">
        <i class="ri-search-line"></i>
      </a>
      
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>è¯·æˆ‘å–æ¯å’–å•¡å§~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="https://gitee.com/vanse/images/raw/master/bruip_course/aliapy.png">
      <span class="reward-type">æ”¯ä»˜å®</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="https://gitee.com/vanse/images/raw/master/bruip_course/wechat.png">
      <span class="reward-type">å¾®ä¿¡</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->
 
<script src="/js/tocbot.min.js"></script>

<script>
  tocbot.init({
    tocSelector: ".tocbot",
    contentSelector: ".article-entry",
    headingSelector: "h1, h2, h3, h4, h5, h6",
    hasInnerContainers: true,
    scrollSmooth: true,
    scrollContainer: "main",
    positionFixedSelector: ".tocbot",
    positionFixedClass: "is-position-fixed",
    fixedSidebarOffset: "auto",
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // sliderå±•å¼€çŠ¶æ€
                // todo: è¿™æ ·ä¸å¥½ï¼Œåé¢æ”¹æˆçŠ¶æ€
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // è·å¾—åŸå›¾å°ºå¯¸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script>

<script src="/js/clickBoom1.js"></script>
 
<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // ç­‰å¾…ä¸¤ç§’é’Ÿåæ¢å¤
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // ç­‰å¾…ä¸¤ç§’é’Ÿåæ¢å¤
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->
 
<script src="/js/dz.js"></script>
 
<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    <div id="music">
    
    
    
    <iframe frameborder="no" border="1" marginwidth="0" marginheight="0" width="200" height="52"
        src="//music.163.com/outchain/player?type=2&id=506654324&auto=0&height=32"></iframe>
</div>

<style>
    #music {
        position: fixed;
        right: 15px;
        bottom: 0;
        z-index: 998;
    }
</style>
    
    
<script>
  const password = "briup!";
  const lock_password = window.sessionStorage.getItem("lock_password");
  console.log(password, lock_password);
  if (lock_password !== password) {
    Swal.fire({
      title: "è¯·è¾“å…¥è®¿é—®å¯†ç ",
      input: "password",
      inputAttributes: {
        autocapitalize: "off",
      },
      showCancelButton: false,
      showLoaderOnConfirm: true,
      allowOutsideClick: false,
      confirmButtonText: "ç¡®å®š",
    }).then((result) => {
      console.log(result);
      if (result.isConfirmed) {
        console.log(password);
        if (result.value === password) {
          window.sessionStorage.setItem("lock_password", result.value);
        } else {
          Swal.fire({
            icon: "error",
            title: "å¯†ç é”™è¯¯ï¼Œè¯·é‡è¯•",
            confirmButtonText: "ç¡®å®š",
            allowOutsideClick: false,
          }).then(() => {
            window.location.reload();
          });
        }
      }
    });
  }
</script>


  </div>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>

</html>