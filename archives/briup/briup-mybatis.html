<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
        
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title>briup-mybatis |  vanse</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/favicon.ico" />
       
<link rel="stylesheet" href="/dist/main.css">

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/css/remixicon.min.css"
      />
      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
       
 

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    </head>
  </html>
</html>


<body>
  <div id="app">
    
      <canvas class="fireworks"></canvas>
      <style>
        .fireworks {
          position: fixed;
          left: 0;
          top: 0;
          z-index: 99999;
          pointer-events: none;
        }
      </style>
      
      
    <main class="content on">
      <section class="outer">
  <article
  id="post-briup/briup-mybatis"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h1 class="article-title sea-center" style="border-left:0" itemprop="name">
  briup-mybatis
</h1>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/archives/briup/briup-mybatis.html" class="article-date">
  <time datetime="2022-05-22T08:09:35.000Z" itemprop="datePublished">2022-05-22</time>
</a>   
<div class="word_count">
    <span class="post-time">
        <span class="post-meta-item-icon">
            <i class="ri-quill-pen-line"></i>
            <span class="post-meta-item-text"> 字数统计:</span>
            <span class="post-count">27.3k</span>
        </span>
    </span>

    <span class="post-time">
        &nbsp; | &nbsp;
        <span class="post-meta-item-icon">
            <i class="ri-book-open-line"></i>
            <span class="post-meta-item-text"> 阅读时长≈</span>
            <span class="post-count">131 分钟</span>
        </span>
    </span>
</div>
 
    </div>
     
	
	 
		 
			
				
    <div class="tocbot"></div>




   
			 
		
		
		 
	
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="第一章-基础"><a href="#第一章-基础" class="headerlink" title="第一章-基础"></a>第一章-基础</h1><h2 id="0-jdbc"><a href="#0-jdbc" class="headerlink" title="0.jdbc"></a>0.jdbc</h2><p><code>jdbc 问题分析</code></p>
<p>1、数据库链接创建、释放频繁造成系统资源浪费从而影响系统性能，如果使用数据库链接池可解决此问题。 </p>
<p>2、Sql 语句在代码中硬编码，造成代码不易维护，实际应用 sql 变化的可能较大，sql 变动需要改变 java 代码。 </p>
<p>3、使用 preparedStatement 向占有位符号传参数存在硬编码，因为 sql 语句的 where 条件不一定，可能 多也可能少，修改 sql 还要修改代码，系统不易维护。 </p>
<p>4、对结果集解析存在硬编码（查询列名），sql 变化导致解析代码变化，系统不易维护，如果能将数据库记 录封装成 pojo 对象解析比较方便。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/mybatis/202205221733517.png" alt="image-20210914092945449"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">结构一样,sql不一样	</span><br><span class="line"><span class="meta">Jdbc-&gt;</span><span class="bash">JdbcUtil-&gt;QueryRunner-&gt;  Mybatis</span></span><br><span class="line">				JdbcTemplate   Hibernate</span><br><span class="line">				...</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">配置文件-&gt; mybatis加载配置文件 -&gt; SqlSesson -&gt; 调用sql</span><br><span class="line"></span><br><span class="line">加载配置文件</span><br><span class="line">	InputStream in = Resources.getRresourceAsStream(&quot;&quot;);</span><br><span class="line"></span><br><span class="line">获取session</span><br><span class="line">	SqlSessionFactory factory = new SqlSessionFactoryBuilder().build(in);</span><br><span class="line">	SqlSession session = factory.openSqlSession();</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">// 调用sql	</span><br><span class="line">	// session.insert(&quot;com.briup.dao.student.InsertStudent&quot;,student);</span><br><span class="line">调用Mapper接口</span><br><span class="line">	StudentMapper studentMapper= session.getMapper(StudentMapper.class);</span><br><span class="line">	studentMapper.insertStudent(student);</span><br><span class="line">	</span><br><span class="line">该方式可能不会出错</span><br><span class="line">	映射器:</span><br><span class="line">		映射接口和映射文件相关联</span><br><span class="line">		StudentMapper&#123;					 </span><br><span class="line">			insertStudent(Student);			</span><br><span class="line">		&#125;</span><br><span class="line">		StudentMapper.xml</span><br><span class="line">			 &lt;insert id=&quot;insert&quot; param=&quot;Student&quot;&gt;</span><br><span class="line">			 &lt;/insert&gt;</span><br><span class="line"></span><br><span class="line">主配置文件</span><br><span class="line">日志</span><br><span class="line">封装</span><br><span class="line">映射文件</span><br></pre></td></tr></table></figure>



<h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1.概述"></a>1.概述</h2><h3 id="1-1起源"><a href="#1-1起源" class="headerlink" title="1.1起源"></a>1.1起源</h3><p><code>MyBatis</code> 是一款优秀的持久层开源框架，它支持自定义 SQL、存储过程以及高级映射。<code>MyBatis</code>免除了几乎所有的 JDBC 代码以及设置参数和获取结果集的工作。<code>MyBatis</code>可以通过简单的 XML 或注解来配置和映射原始类型、接口和 Java POJO（Plain Old java Objects，普通老式 Java 对象）为数据库中的记录。</p>
<p>MyBatis的前身是iBATIS，iBATIS于2002年由ClintonBegin创建。MyBatis3是iBATIS的全新设计，支持注解和Mapper。</p>
<p>MyBatis流行的主要原因在于它的简单性和易使用性。在Java应用程序中，数据持久化层涉及到的工作有：</p>
<ul>
<li>将从数据库查询到的数据生成所需要的Java对象</li>
<li>将Java对象中的数据通SQL持久化到数据库中</li>
</ul>
<p>MyBatis通过抽象底层的JDBC代码，自动化封装SQL结果集产生Java对象、Java对象的数据持久化数据库中的过程使得对SQL的使用变得容易。</p>
<h3 id="1-2-获取"><a href="#1-2-获取" class="headerlink" title="1.2 获取"></a>1.2 获取</h3><p>iBATIS一词来源于internet和abatis的组合，是一个在2002年发起的开放源代码项目。于2010年6月16号被谷歌托管，改名为MyBatis。</p>
<p>ibatis的官网 <a target="_blank" rel="noopener" href="http://ibatis.apache.org/">http://ibatis.apache.org/</a> 进去官网会看到下面提示:</p>
<p>apache ibatis is retired at the apache software foundation (2010/06/16) the original project team has moved to mybatis hosted at google code. see <a target="_blank" rel="noopener" href="http://www.mybatis.org/">http://www.mybatis.org/</a> for more.然而<a target="_blank" rel="noopener" href="http://www.mybatis.org/%E8%BF%99%E4%B8%AA%E5%9C%B0%E5%9D%80%E4%B8%80%E7%9B%B4%E5%A4%84%E4%BA%8E%E6%89%93%E4%B8%8D%E5%BC%80%E7%8A%B6%E6%80%81">http://www.mybatis.org/这个地址一直处于打不开状态</a>…</p>
<p>但是我们最终是可以在github中找到mybatis的相关下载的:</p>
<p>mybatis在github中的地址</p>
<p><a target="_blank" rel="noopener" href="https://github.com/mybatis/mybatis-3">https://github.com/mybatis/mybatis-3</a></p>
<p>最新版本的mybatis的下载地址</p>
<p><a target="_blank" rel="noopener" href="https://github.com/mybatis/mybatis-3/releases">https://github.com/mybatis/mybatis-3/releases</a></p>
<p>doc文档</p>
<p><a target="_blank" rel="noopener" href="http://www.mybatis.org/mybatis-3/">http://www.mybatis.org/mybatis-3/</a></p>
<h3 id="1-3-特点"><a href="#1-3-特点" class="headerlink" title="1.3 特点"></a>1.3 特点</h3><p>通过上面我们了解到Mybatis的主要功能是<strong>数据持久化</strong>，这个时候你可能会回想起之前的<strong>JDBC</strong>课程，既然我们已经掌握了JDBC为什么还要再去学习Mybatis呢？</p>
<p>主要原因有以下几个方面：</p>
<ol>
<li>Mybatis消除了大量的JDBC冗余代码</li>
<li>Mybatis有低的学习曲线</li>
<li>Mybatis能很好地与传统数据库协同工作</li>
<li>Mybatis可以接受SQL语句</li>
<li>Mybatis提供了与Spring框架的集成支持</li>
<li>Mybatis提供了与第三方缓存类库的集成支持</li>
<li>Mybatis引入了更好的性能</li>
</ol>
<p>1）它消除了大量的JDBC冗余代码</p>
<p>Java通过JDBC的API来操作关系型数据库，但是JDBC是一个非常底层的API，我们需要书写大量的代码来完成对数据库的操作。例如一个插入操作(参考之前学习JDBC时候的代码实例)，但是使用mybatis来完成相同的插入操作要简单方便灵活的多。</p>
<p>特别之处的是，MyBatis还提供了其他的一些特性来简化持久化逻辑的实现，它支持复杂的SQL结果集数据映射到嵌套的对象结构，它支持一对一和一对多的结果集和Java对象的映射，它支持根据输入的数据构建动态的SQL语句</p>
<p>2）它有低的学习曲线</p>
<p>MyBatis能够流行的首要原因之一在于它学习和使用起来非常简单，它取决于你Java和 SQL方面的知识。如果开发人员很熟悉Java和SQL，他们会发现MyBatis入门非常简单。</p>
<p>3）它能很好地与传统数据库协同工作</p>
<p>有时我们可能需要用不正规形式与传统数据库协同工作，使用成熟的ORM框架(例如大家熟知的Hibernate)有可能、但是很难跟传统数据库很好地协同工作，因为他们尝试将Java对象静态地映射到数据库的表上.而MyBatis是将查询的结果与Java对象映射起来，这使得MyBatis可以很好地与传统数据库协同工作。你可以根据面相对象的模型创建Java域对象，执行传统数据库的查询，然后将结果映射到对应的Java对象上。</p>
<p>4）它可以接受SQL语句</p>
<p>成熟的ORM框架鼓励使用实体对象和在其底层自动产生SQL语句。由于这种的SQL生成方式，我们有可能不能够利用到数据库的一些特有的特性。Hibernate允许执行本地SQL，但是这样会打破持久层和数据库独立的原则。MyBatis框架接受SQL语句，而不是将其对开发人员隐藏起来。由于MyBatis不会产生任何的SQL语句，所以开发人员就要准备SQL语句，这样就可以充分利用数据库特有的特性并且可以准备自定义的查询。另外，MyBatis 对存储过程也提供了支持。</p>
<p>5）它提供了与Spring框架的集成支持</p>
<p>MyBatis提供了与流行的依赖注入框架Spring的开包即用的集成支持，这将进一步简化MyBatis的使用。</p>
<p>6）它提供了与第三方缓存类库的集成支持</p>
<p>MyBatis有内建的SqlSession级别的缓存机制，用于缓存Select语句查询出来的结果。除此之外，MyBatis提供了与多种第三方缓存类库的集成支持，如EHCache，OSCache，Hazelcast等。</p>
<p>7）它引入了更好的性能</p>
<p>性能问题是关乎软件应用成功与否的关键因素之一。为了达到更好的性能，需要考虑很多事情，而对很多应用而言，数据持久化层是整个系统性能的关键。MyBatis支持数据库连接池，消除了为每一个请求创建一个数据库连接的开销,MyBatis提供了内建的缓存机制，在SqlSession级别提供了对SQL查询结果的缓存。即:如果你调用了相同的select查询，MyBatis 会将放在缓存的结果返回，而不会去再查询数据库。MyBatis框架并没有大量地使用代理机制，因此对于其他的过度地使用代理的ORM框架而言，MyBatis可以获得更好的性能</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.demo;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.datasource.pooled.PooledDataSource;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.mapping.Environment;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.transaction.TransactionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.transaction.jdbc.JdbcTransactionFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.entity.User;</span><br><span class="line"><span class="keyword">import</span> com.briup.mappers.UserMapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestConn</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		PooledDataSource dataSource = <span class="keyword">new</span> PooledDataSource();</span><br><span class="line">		dataSource.setDriver(<span class="string">&quot;oracle.jdbc.driver.OracleDriver&quot;</span>);</span><br><span class="line">		dataSource.setUrl(<span class="string">&quot;jdbc:oracle:thin:@127.0.0.1:1521:XE&quot;</span>);</span><br><span class="line">		dataSource.setUsername(<span class="string">&quot;briup&quot;</span>);</span><br><span class="line">		dataSource.setPassword(<span class="string">&quot;briup&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		TransactionFactory transactionFactory = <span class="keyword">new</span> JdbcTransactionFactory();</span><br><span class="line">		</span><br><span class="line">		Environment environment = <span class="keyword">new</span> Environment(<span class="string">&quot;development&quot;</span>, transactionFactory, dataSource);</span><br><span class="line">		</span><br><span class="line">		Configuration configuration = <span class="keyword">new</span> Configuration(environment);</span><br><span class="line">		</span><br><span class="line">		configuration.addMapper(UserMapper.class);</span><br><span class="line">		</span><br><span class="line">		SqlSessionFactory sqlSessionFactory = </span><br><span class="line">				<span class="keyword">new</span> SqlSessionFactoryBuilder().build(configuration);</span><br><span class="line">		SqlSession session = sqlSessionFactory.openSession();</span><br><span class="line">		UserMapper mapper = session.getMapper(UserMapper.class);</span><br><span class="line">		</span><br><span class="line">		List&lt;User&gt; userList = mapper.findAll();</span><br><span class="line">		System.out.println(userList);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>







<h3 id="1-4-案例"><a href="#1-4-案例" class="headerlink" title="1.4 案例"></a>1.4 案例</h3><p>在实例开始之前我们先做一些准备工作。先来建表和建一个实体类。(==创建java项目即可==)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> students;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> students ( </span><br><span class="line">	id number <span class="keyword">PRIMARY</span> KEY, </span><br><span class="line">	name varchar2(<span class="number">50</span>) , </span><br><span class="line">	email varchar2(<span class="number">50</span>) , </span><br><span class="line">	dob <span class="type">date</span> </span><br><span class="line">); </span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Integer id; </span><br><span class="line">	<span class="keyword">private</span> String name; </span><br><span class="line">	<span class="keyword">private</span> String email; </span><br><span class="line">	<span class="keyword">private</span> Date dob;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getEmail</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> email;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmail</span><span class="params">(String email)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.email = email;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Date <span class="title">getDob</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> dob;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDob</span><span class="params">(Date dob)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.dob = dob;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">(Integer id, String name, String email, Date dob)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">		<span class="keyword">this</span>.email = email;</span><br><span class="line">		<span class="keyword">this</span>.dob = dob;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="1-4-1-jar包导入"><a href="#1-4-1-jar包导入" class="headerlink" title="1.4.1 jar包导入"></a>1.4.1 jar包导入</h4><blockquote>
<p>导入mybatis-jar/ojdbc.jar/junit.jar</p>
</blockquote>
<p>mybatis的核心包只有一个mybatis-3.x.x.jar,另外还有一些【可选】的依赖包(日志、代理等所需要的),在下载的压缩包中可以找到.也可以自行去下载。</p>
<p>如果是maven项目，只有引入依赖坐标即可：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.x.x<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="1-4-2-配置文件"><a href="#1-4-2-配置文件" class="headerlink" title="1.4.2 配置文件"></a>1.4.2 配置文件</h4><p>mybatis的配置文件一般来说名字是固定的，就叫<code>mybatis-config.xml</code>,其中包括数据库连接信息，类型别名,映射文件路径等等；直接创建在src目录下。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span> </span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span> </span></span><br><span class="line"><span class="meta">   <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">&quot;Student&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.briup.pojo.Student&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span> /&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">     &lt;property name=&quot;driver&quot; value=&quot;com.mysql.jdbc.Driver&quot; /&gt; </span></span><br><span class="line"><span class="comment">     &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/test&quot; /&gt; </span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;oracle.jdbc.driver.OracleDriver&quot;</span> /&gt;</span> </span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:oracle:thin:@127.0.0.1:1521:XE&quot;</span> /&gt;</span> </span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;briup&quot;</span> /&gt;</span> </span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;briup&quot;</span> /&gt;</span> </span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;com/briup/mappers/StudentMapper.xml&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span> </span><br></pre></td></tr></table></figure>

<h4 id="1-4-3-映射文件"><a href="#1-4-3-映射文件" class="headerlink" title="1.4.3 映射文件"></a>1.4.3 映射文件</h4><p>映射文件命名一般都是<code>XxxxMapper.xml</code>，<code>Xxxx</code>是对应的类的名字，这个xml文件中包括<code>Xxxx</code>类所对应的数据库表的各种增删改查sql语句。</p>
<p>例如:<code>StudentMapper.xml</code>文件中是<code>Student</code>类对应的表的各种<code>select</code> <code>insert</code> <code>update</code> <code>delete</code>。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span> </span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> </span></span><br><span class="line"><span class="meta">   <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.briup.dao.StudentMapper&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Student&quot;</span> <span class="attr">id</span>=<span class="string">&quot;StudentResult&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAllStudents&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;StudentResult&quot;</span>&gt;</span></span><br><span class="line">		SELECT * FROM STUDENTS</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findStudentById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span></span></span><br><span class="line"><span class="tag">		<span class="attr">resultType</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">		SELECT ID,NAME, EMAIL</span><br><span class="line">		FROM STUDENTS WHERE ID=#&#123;Id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertStudent&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">		INSERT INTO STUDENTS(ID,NAME,EMAIL)</span><br><span class="line">		VALUES(#&#123;id &#125;,#&#123;name&#125;,#&#123;email&#125;)</span><br><span class="line">	<span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span> </span><br></pre></td></tr></table></figure>

<h4 id="1-4-4-映射接口"><a href="#1-4-4-映射接口" class="headerlink" title="1.4.4 映射接口"></a>1.4.4 映射接口</h4><p>mybatis中的映射接口<code>XxxxMapper.java</code>(对<code>XxxxMapper.xml</code>中的sql语句进行映射)<br>mybatis中除了必须的jar包、各种xml配置文件之外,一般还需要有调用sql语句执行的接口XxxxMapper.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentMapper</span></span>&#123;</span><br><span class="line">	<span class="function">List&lt;Student&gt; <span class="title">findAllStudents</span><span class="params">()</span></span>; </span><br><span class="line">	<span class="function">Student <span class="title">findStudentById</span><span class="params">(Integer id)</span></span>; </span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">insertStudent</span><span class="params">(Student student)</span></span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这个名字依然可以叫StudentDao</p>
</blockquote>
<p>注意事项：</p>
<ol>
<li><p>接口中的方法的名字和XML文件定义的SQL映射语句的<code>id</code>值要相同</p>
</li>
<li><p>我们不需要去实现该接口,因为mybatis中提供了相应的方式在运行期间动态生成该接口的实现类对象.</p>
</li>
</ol>
<h4 id="1-4-5-测试"><a href="#1-4-5-测试" class="headerlink" title="1.4.5 测试"></a>1.4.5 测试</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.dao.StudentMapper;</span><br><span class="line"><span class="keyword">import</span> com.briup.pojo.Student;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentMapperTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			InputStream inputStream = Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line">			SqlSessionFactory sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);</span><br><span class="line">			SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">			StudentMapper studentMapper = sqlSession.getMapper(StudentMapper.class);</span><br><span class="line">			Student s = <span class="keyword">new</span> Student(<span class="number">1</span>, <span class="string">&quot;tom&quot;</span>, <span class="string">&quot;123@briup.com&quot;</span>, <span class="keyword">new</span> Date());</span><br><span class="line">			studentMapper.insertStudent(s);</span><br><span class="line">			sqlSession.commit();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="1-4-6-图解"><a href="#1-4-6-图解" class="headerlink" title="1.4.6 图解"></a>1.4.6 图解</h4><p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/mybatis/202205221734684.png" alt="image-20201019112222960"></p>
<blockquote>
<p>注意，该图描述了上述例子中的俩个过程，mybatis左边是配置的过程，mybatis右边是写代码的过程</p>
</blockquote>
<h2 id="2-配置"><a href="#2-配置" class="headerlink" title="2.配置"></a>2.配置</h2><h3 id="2-1-核心配置"><a href="#2-1-核心配置" class="headerlink" title="2.1 核心配置"></a>2.1 核心配置</h3><p>MyBatis最关键的组成部分是<code>SqlSessionFactory</code>，我们可以从中获取<code>SqlSession</code>， 并执行映射的SQL语句。要获取<code>SqlSessionFactory</code>对象，就必须要先读取 mybaits的核心配置文件<code>mybaits-config.xml</code></p>
<p>下面的 mybatis-config.xml展示了一个典型的MyBatis配置文件的内容：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;application.properties&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;db_user&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;verysecurepwd&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;cacheEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">&quot;Student&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.briup.pojo.Student&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.briup.pojo&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeHandlers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">&quot;com.mybatis3.typehandlers.PhoneTypeHandler&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.briup.typehandlers&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">typeHandlers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driverClassName&#125;&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;production&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;MANAGED&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;JNDI&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;data_source&quot;</span> <span class="attr">value</span>=<span class="string">&quot;java:comp/jdbc/MyBatisDemoDS&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;com/briup/mappers/StudentMapper.xml&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">url</span>=<span class="string">&quot;file:///D:/mybatis/mappers/StudentMapper.xml&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.dao.StudentMapper&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>mybaits-config.xml中的常见标签元素有：</p>
<ul>
<li><code>&lt;environments&gt;</code></li>
<li><code>&lt;dataSource&gt;</code></li>
<li><code>&lt;transactionManager&gt;</code></li>
<li><code>&lt;properties&gt;</code></li>
<li><code>&lt;typeAliases&gt;</code></li>
<li><code>&lt;typeHandlers&gt;</code></li>
<li><code>&lt;settings&gt;</code></li>
<li><code>&lt;mappers&gt;</code></li>
</ul>
<h4 id="2-1-1-environments"><a href="#2-1-1-environments" class="headerlink" title="2.1.1 environments"></a>2.1.1 environments</h4><p><code>environments</code>是配置mybatis当前工作的数据库环境的地方</p>
<p>MyBatis可以支持配置多个dataSource环境，可以将应用部署到不同的环境上，如DEV(开发环境)，TEST（测试环境），QA（质量评估环境）,UAT(用户验收环境),PRODUCTION（生产环境），可以通过将默认environments值设置成想要的environment的id值.</p>
<p>如果你的应用需要连接多个数据库，你需要将每个数据库配置成独立的环境，并且为每一个数据库创建一个SqlSessionFactory</p>
<p>例如:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;shoppingcart&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;shoppingcart&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;MANAGED&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;JNDI&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;data_source&quot;</span> <span class="attr">value</span>=<span class="string">&quot;java:comp/jdbc/ShoppingcartDS&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;reports&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">transaction</span> <span class="attr">Managertype</span>=<span class="string">&quot;MANAGED&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;JNDI&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;data_source&quot;</span> <span class="attr">value</span>=<span class="string">&quot;java:comp/jdbc/ReportsDS&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>我们可以为以上每个环境创建一个SqlSessionFactory</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">inputStream = Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line"><span class="comment">//默认的环境 default</span></span><br><span class="line">SqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);</span><br><span class="line"><span class="comment">//统计明细的环境 cart</span></span><br><span class="line">SqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(inputStream, <span class="string">&quot;shoppingcart&quot;</span>);</span><br><span class="line"><span class="comment">//统计报表的环境 report</span></span><br><span class="line">SqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(inputStream, <span class="string">&quot;reports&quot;</span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意:一个数据库环境对应一个SqlSessionFactory对象;对于environments,我们可以在其中配置多个environment子元素,同时还需要在environment中配置dataSource和transactionManager元素。</p>
</blockquote>
<h4 id="2-1-2-dataSource"><a href="#2-1-2-dataSource" class="headerlink" title="2.1.2 dataSource"></a>2.1.2 dataSource</h4><p><code>dataSource</code>表示的是数据源;至少会包括该连接数据库的四种信息.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driverClassName&#125;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>dataSource的类型type属性可以配置成其内置类型之一，如UNPOOLED，POOLED，JNDI。</p>
<p>如果将类型设置成UNPOOLED，MyBatis会为每一个数据库操作创建一个新的连接，使用完了并关闭它，该方式适用于只有小规模数量并发用户的简单应用程序上。</p>
<p>如果将属性设置成POOLED，MyBatis会创建一个数据库连接池，连接池中的一个连接将会被用作数据库操作(分配，管理，释放)。一旦数据库操作完成，MyBatis会将此连接返回给连接池。</p>
<p>如果将类型设置成JNDI(Java Naming and Directory Interface , Java命名和目录接口, 是SUN公司提供的一种标准的Java命名系统接口)，MyBatis从在应用服务器向配置好的JNDI数据源dataSource获取数据库连接。在生产环境中，优先考虑这种方式。</p>
<h4 id="2-1-3-transactionManager"><a href="#2-1-3-transactionManager" class="headerlink" title="2.1.3 transactionManager"></a>2.1.3 transactionManager</h4><p>MyBatis支持两种类型的<strong>事务管理器</strong>：JDBC 和 MANAGED.</p>
<p>JDBC事务管理器的使用，是在<code>JDBC程序</code>负责管理数据库连接的生命周期（提交、回退等等）的时候。如果将TransactionManager 属性设置成JDBC，MyBatis内部将使用JdbcTransactionFactory类创建TransactionManager。例如，部署到ApacheTomcat的应用程序，需要应用程序自己管理事务。</p>
<p>MANAGED 事务管理器的使用，是在<code>应用服务器</code>负责管理数据库连接生命周期的时候。如果TransactionManager属性设置成MANAGED时，MyBatis内部使用ManagedTransactionFactory 类创建事务管理器TransactionManager。例如，当一个Java EE的应用程序部署在类似JBoss，WebLogic，GlassFish等应用服务器上时，它们会使用EJB进行应用服务器的事务管理能力。在这些管理环境中，你可以使用MANAGED事务管理器。</p>
<blockquote>
<p>注：Managed 是托管的意思，即我们编写的应用程序本身不去管理事务，而是把事务管理交给应用所在的服务器进行管理。</p>
</blockquote>
<h4 id="2-1-4-properties"><a href="#2-1-4-properties" class="headerlink" title="2.1.4 properties"></a>2.1.4 properties</h4><p>属性配置元素properties可以将配置值写死到mybatis-config.xml中,也可以具体到一个属性文件中,并且使用属性文件的key名作为占位符。</p>
<p>在上述的配置中，我们将数据库连接属性配置到了application.properties文件中，并且为driver，URL等属性使用了占位符.</p>
<p>在applications.properties文件中配置数据库连接参数，如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">jdbc.driverClassName=oracle.jdbc.driver.OracleDriver</span><br><span class="line">jdbc.url=jdbc:oracle:thin:@<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">1521</span>:XE</span><br><span class="line">jdbc.username=briup</span><br><span class="line">jdbc.password=briup </span><br></pre></td></tr></table></figure>

<p>在mybatis-config.xml文件中，为属性使用application.properties文件中定义的占位符：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 读取application.properties文件中的数据key-value的形式 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;application.properties&quot;</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 注意:是applications.properties文件中的值优先级高 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbc.username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;briup&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbc.password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;briup&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driverClassName&#125;&quot;</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-1-5-typeAliases"><a href="#2-1-5-typeAliases" class="headerlink" title="2.1.5 typeAliases"></a>2.1.5 typeAliases</h4><p>在SQLMapper配置文件中，对于resultType和parameterType属性值，我们需要使用JavaBean 的完全限定名。</p>
<p>例如:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findStudentById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> </span></span><br><span class="line"><span class="tag">	<span class="attr">resultType</span>=<span class="string">&quot;com.briup.pojo.Student&quot;</span>&gt;</span></span><br><span class="line">	 SELECT  ID, NAME, EMAIL, DOB</span><br><span class="line">	 FROM STUDENTS WHERE id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateStudent&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.briup.pojo.Student&quot;</span>&gt;</span></span><br><span class="line">	 UPDATE STUDENTS</span><br><span class="line">	 SET NAME=#&#123;name&#125;, EMAIL=#&#123;email&#125;, DOB=#&#123;dob&#125;</span><br><span class="line">	 WHERE id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注:parameterType表示将来调用这个sql语句的时候所传的参数的类型(参数值或者参数对象里面的属性值 用来替换sql语句中的占位符)</p>
</blockquote>
<p><code>resultType</code>表示将来调用这个sql语句的时候所返回的结果的类型(方便mybatis给我们自动封装结果集)</p>
<p>这里我们为<code>resultType</code>和<code>parameterType</code>属性值设置为Student类型的完全限定名：com.briup.com.Student</p>
<p>我们可以为完全限定名取一个别名（alias），然后就可以在需要使用完全限定名的地方使用别名，而不是到处使用完全限定名。如下所示，为完全限定名起一个别名：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">&quot;Student&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.briup.pojo.Student&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">&quot;Teacher&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.briup.pojo.Teacher&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后在SQLMapper映射文件中, 如下使用Student的别名：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findStudentById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">resultType</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">	 SELECT  ID, NAME, EMAIL, DOB</span><br><span class="line">	 FROM STUDENTS</span><br><span class="line">	WHERE id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateStudent&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">	 UPDATE STUDENTS</span><br><span class="line">	 SET NAME=#&#123;name&#125;, EMAIL=#&#123;email&#125;, DOB=#&#123;dob&#125;</span><br><span class="line">	 WHERE id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>当然也可以不用为每一个JavaBean单独定义别名,你可以为配置出需要取别名的类的所在的包(package)，MyBatis会自动扫描包内定义的类，然后分别为每个类注册一个小写字母开头的简单类名形式的别名。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.briup.pojo&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果Student.java和 Teacher.java 定义在com.briup.pojo包中，则 com.briup.pojo.Student的别名会被注册为student。而com.briup.pojo.Teacher别名将会被注册为teacher</p>
<p>还有另外一种方式为JavaBeans起别名，使用注解 <code>@Alias</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Alias(&quot;stu&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span></span>&#123;</span><br><span class="line">          </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意: </p>
<p>@Alias注解将会覆盖配置文件中的&lt;typeAliases&gt;定义。</p>
<p>@Alias 要和<code>&lt;package name=&quot;&quot;/&gt;</code>标签配合使用,Mybatis会自动查看指定包内的类别名注解,如果没有这个注解,那么默认的别名就是类的名字。</p>
</blockquote>
<h4 id="2-1-6-typeHandlers"><a href="#2-1-6-typeHandlers" class="headerlink" title="2.1.6 typeHandlers"></a>2.1.6 typeHandlers</h4><p>当MyBatis将一个Java对象作为输入参数执行INSERT语句操作时，它会创建一个PreparedStatement对象，并且使用setXXX()方法对?号占位符设置相应的参数值 。这里，XXX可以是int，String，Date 等 Java对象属性类型的任意一个。示例如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertStudent&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">	 INSERT INTO STUDENTS(id,NAME,EMAIL,DOB)</span><br><span class="line">	 VALUES(#&#123;id&#125;,#&#123;name&#125;,#&#123;email&#125;,#&#123;dob&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>为执行这个语句，MyBatis将采取以下一系列动作，创建一个有占位符的PreparedStatement接口，如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PreparedStatement ps = connection.prepareStatement(<span class="string">&quot;INSERT INTO STUDENTS(id,NAME,EMAIL,DOB) VALUES(?,?,?,?)&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>检查Student对象的属性studId的类型，然后使用合适setXXX方法去设置参数值。这里studId是Integer类型，所以会使用setInt()方法：ps.setInt(1,student.getStudId());类似地，对于name和email属性都是String类型MyBatis使用setString()方法设置参数。</p>
<blockquote>
<p>   注意： MyBaits会将java.util.Date类型转换为java.sql.Timestamp并设值：</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps.setTimestamp(<span class="number">4</span>, <span class="keyword">new</span> Timestamp((student.getDob()).getTime()));</span><br></pre></td></tr></table></figure>

<p>MyBatis是怎么知道对于Integer类型属性使用setInt()和String类型属性使用setString()方法呢？其实MyBatis是通过使用类型处理器typeHandlers来决定这么做的。</p>
<p>MyBatis对于以下的类型使用内置的类型处理器：所有的基本数据类型、基本类型的包装类型、 byte[]、java.util.Date、java.sql.Date、java.sql.Time、java.sql.Timestamp、java枚举类型等。所以当MyBatis发现属性的类型属于上述类型，他会使用对应的类型处理器将值设置到PreparedStatement中，同样地，当SQL结果集封装成java类对象的时候，也有类似的过程。 </p>
<p>那如果有一个自定义的类型，怎么存储到数据库呢？示例如下：假设表STUDENTS 有一个 PHONE 字段，类型为 VARCHAR2(15)，而 Student类有一个自定义类型属性phone(PhoneNumber类) </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> students <span class="keyword">add</span> phone varchar2(<span class="number">15</span>);</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> students <span class="keyword">drop</span> <span class="keyword">column</span> phone;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PhoneNumber</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String countryCode;</span><br><span class="line">	<span class="keyword">private</span> String stateCode;</span><br><span class="line">	<span class="keyword">private</span> String number;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">PhoneNumber</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">PhoneNumber</span><span class="params">(String countryCode, String stateCode, String number)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.countryCode = countryCode;</span><br><span class="line">		<span class="keyword">this</span>.stateCode = stateCode;</span><br><span class="line">		<span class="keyword">this</span>.number = number;</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PhoneNumber</span><span class="params">(String str)</span></span>&#123; </span><br><span class="line">        <span class="comment">// 如果 == null</span></span><br><span class="line">        <span class="keyword">if</span>(str!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            String[] args = str.split(<span class="string">&quot;-&quot;</span>);</span><br><span class="line">            <span class="keyword">this</span>.countryCode = 	args[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">this</span>.stateCode = 	args[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">this</span>.number = 		args[<span class="number">2</span>];</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.countryCode = 	args[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">this</span>.stateCode = 	args[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">this</span>.number = 		args[<span class="number">2</span>] </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getAsString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> countryCode + <span class="string">&quot;-&quot;</span> + stateCode + <span class="string">&quot;-&quot;</span> + number;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// Setters and getters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id; </span><br><span class="line">    <span class="keyword">private</span> String name; </span><br><span class="line">    <span class="keyword">private</span> String email; </span><br><span class="line">    <span class="keyword">private</span> Date dob;</span><br><span class="line">    <span class="keyword">private</span> PhoneNumber phoneNumber;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>xml配置:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">   <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.briup.dao.StudentMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Student&quot;</span> <span class="attr">id</span>=<span class="string">&quot;StudentResult&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> /&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;phoneNumber&quot;</span> <span class="attr">column</span>=<span class="string">&quot;phone&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAllStudents&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;StudentResult&quot;</span>&gt;</span></span><br><span class="line">        SELECT * FROM STUDENTS</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findStudentById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">resultType</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">        SELECT ID, NAME, EMAIL,PHONE as phoneNumber</span><br><span class="line">        FROM STUDENTS WHERE ID=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertStudent&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">        INSERT INTO STUDENTS(ID,NAME,EMAIL,PHONE)</span><br><span class="line">        VALUES(#&#123;id &#125;,#&#123;name&#125;,#&#123;email&#125;,#&#123;phoneNumber&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意自动映射 PHONE as phoneNumber</p>
</blockquote>
<p>这里，参数对象中的属性phone的值需要传递给#{phone}；而参数对象的属性phone是 PhoneNumber类型。但是，MyBatis 并不知道该怎样来处理这个类型的对象。</p>
<p>为了让MyBatis明白怎样处理这个自定义的Java对象类型，如PhoneNumber，我们可以创建一个自定义的类型处理器,MyBatis提供了抽象类<code>BaseTypeHandler&lt;T&gt;</code> ，我们可以继承此类创建自定义类型处理器。</p>
<p>代码如下所示:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.typehandler;</span><br><span class="line"><span class="keyword">import</span> java.sql.CallableStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.type.BaseTypeHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.type.JdbcType;</span><br><span class="line"><span class="keyword">import</span> com.briup.pojo.PhoneNumber;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PhoneTypeHandler</span> <span class="keyword">extends</span> <span class="title">BaseTypeHandler</span>&lt;<span class="title">PhoneNumber</span>&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//遇到PhoneNumber参数的时候应该如何在ps中设置值</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNonNullParameter</span><span class="params">(PreparedStatement ps, <span class="keyword">int</span> i, PhoneNumber parameter, JdbcType jdbcType)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        ps.setString(i, parameter.getAsString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//查询中遇到PhoneNumber类型的应该如何封装(使用列名封装)</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PhoneNumber <span class="title">getNullableResult</span><span class="params">(ResultSet rs, String columnName)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PhoneNumber(rs.getString(columnName));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//查询中遇到PhoneNumber类型的应该如何封装(使用列的下标)</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PhoneNumber <span class="title">getNullableResult</span><span class="params">(ResultSet rs, <span class="keyword">int</span> columnIndex)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PhoneNumber(rs.getString(columnIndex));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//CallableStatement使用中遇到了PhoneNumber类型的应该如何封装</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PhoneNumber <span class="title">getNullableResult</span><span class="params">(CallableStatement cs, <span class="keyword">int</span> columnIndex)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PhoneNumber(cs.getString(columnIndex));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意:使用ps.setString()和rs.getString()方法是 :因为在数据库的表中phone列是VARCHAR类型。</p>
</blockquote>
<p>最后一旦我们实现了自定义的类型处理器，我们需要在mybatis-config.xml中注册它：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;application.properties&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeHandlers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">&quot;com.briup.typehandlers.PhoneTypeHandler&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">typeHandlers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注册PhoneTypeHandler后, MyBatis就能够将Phone类型的对象值存储到VARCHAR类型的列上。</p>
</blockquote>
<h4 id="2-1-7-settings"><a href="#2-1-7-settings" class="headerlink" title="2.1.7 settings"></a>2.1.7 settings</h4><blockquote>
<p>注意:大多数情况下，【这些参数使用它们的默认值即可】</p>
</blockquote>
<p> 为满足应用特定的需求，MyBatis默认的全局参数设置可以被覆盖掉，如下所示： </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 这个配置使全局的映射器启用或禁用缓存 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;cacheEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 全局启用或禁用延迟加载。当禁用时，所有关联对象都会即时加载 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;lazyLoadingEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 允许或不允许多种结果集从一个单独的语句中返回（需要适合的驱动） --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;multipleResultSetsEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 使用列标签代替列名。不同的驱动在这方便表现不同。参考驱动文档或充分测试两种方法来决定所使用的驱动 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;useColumnLabel&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 允许JDBC支持生成的键。需要适合的驱动。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;useGeneratedKeys&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定MyBatis如何自动映射列到字段/属性。PARTIAL只会自动映射简单、没有嵌套的结果。FULL会自动映射任意复杂的结果（嵌套的或其他情况） --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;autoMappingBehavior&quot;</span> <span class="attr">value</span>=<span class="string">&quot;PARTIAL&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置默认的执行器。SIMPLE执行器没有什么特别之处。REUSE执行器重用预处理语句。BATCH执行器重用语句和批量更新 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;defaultExecutorType&quot;</span> <span class="attr">value</span>=<span class="string">&quot;SIMPLE&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 设置超时时间，它决定驱动等待一个数据库响应的时间 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;defaultStatementTimeout&quot;</span> <span class="attr">value</span>=<span class="string">&quot;25000&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 允许在嵌套语句中使用分页（RowBounds）默认false --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;safeRowBoundsEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 是否开启自动驼峰命名规则（camel case）映射，即从经典数据库列名 A_COLUMN 到经典 Java 属性名 aColumn 的类似映射。默认false --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;mapUnderscoreToCamelCase&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- MyBatis 利用本地缓存机制（Local Cache）防止循环引用（circular references）和加速重复嵌套查询。 默认值为 SESSION，这种情况下会缓存一个会话中执行的所有查询。 若设置值为 STATEMENT，本地会话仅用在语句执行上，对相同 SqlSession 的不同调用将不会共享数据。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;localCacheScope&quot;</span> <span class="attr">value</span>=<span class="string">&quot;SESSION&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 当没有为参数提供特定的 JDBC 类型时，为空值指定 JDBC 类型。 某些驱动需要指定列的 JDBC 类型，多数情况直接用一般类型即可，比如 NULL、VARCHAR 或 OTHER。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;jdbcTypeForNull&quot;</span> <span class="attr">value</span>=<span class="string">&quot;OTHER&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定对象的哪个方法触发一次延迟加载。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;lazyLoadTriggerMethods&quot;</span> <span class="attr">value</span>=<span class="string">&quot;equals,clone,hashCode ,toString&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- CGLIB | JAVASSIST 默认JAVASSIST(MyBatis 3.3 or above) --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定 Mybatis 创建具有延迟加载能力的对象所用到的代理工具。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;proxyFactory&quot;</span> <span class="attr">value</span>=<span class="string">&quot;JAVASSIST&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 当启用时，对任意延迟属性的调用会使带有延迟加载属性的对象完整加载；反之，每种属性将会按需加载。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;aggressiveLazyLoading&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定 MyBatis 所用日志的具体实现，未指定时将自动查找。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;logImpl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;LOG4J &quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定 MyBatis 增加到日志名称的前缀。值可以是任意字符串 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;logPrefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;LOG4J &quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定当结果集中值为 null 的时候是否调用映射对象的 setter（map 对象时为 put）方法，这对于有 Map.keySet() 依赖或 null 值初始化的时候是有用的。注意基本类型（int、boolean等）是不能设置成 null 的。 默认false--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;callSettersOnNulls&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false &quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-1-8-mappers"><a href="#2-1-8-mappers" class="headerlink" title="2.1.8 mappers"></a>2.1.8 mappers</h4><p> Mapper文件中包含了要执行的SQL语句，我们需要在mybatis-config.xml文件中配置Mapper文件的位置。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;com/briup/mappers/StudentMapper.xml&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">url</span>=<span class="string">&quot;file:///D:/mybatisdemo/app/mappers/StudentMapper.xml&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.dao.StudentMapper&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.briup.mappers&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>以上每一个&lt;mapper&gt; 标签都可以从不同类型的资源中加载映射mapper：</p>
<ul>
<li>resource属性用来指定在classpath中的mapper文件。</li>
<li>url属性用来通过完全文件系统路径或者web URL地址来指向mapper文件 </li>
<li>class属性用来指向一个mapper接口<ul>
<li>需要注解sql</li>
<li>或者法要求 mapper 接口名称和 mapper 映射文件名称相同，且放在同一个目录中。</li>
</ul>
</li>
<li>package属性用来指向可以找到Mapper接口的包名 (需要注解sql)<ul>
<li>需要注解sql</li>
<li>或者法要求 mapper 接口名称和 mapper 映射文件名称相同，且放在同一个目录中。</li>
</ul>
</li>
</ul>
<h3 id="2-2-日志配置"><a href="#2-2-日志配置" class="headerlink" title="2.2 日志配置"></a>2.2 日志配置</h3><p>Mybatis 通过使用内置的日志工厂提供日志功能。内置日志工厂将会把日志工作委托给下面的实现之一：</p>
<ul>
<li><strong>SLF4J</strong></li>
<li><strong>Apache Commons Logging</strong></li>
<li><strong>Log4j 2</strong></li>
<li><strong>Log4j</strong></li>
<li><strong>JDK logging</strong></li>
</ul>
<p>MyBatis 内置日志工厂会基于运行时检测信息选择日志委托实现。它会（按上面罗列的顺序）使用第一个查找到的实现。当没有找到这些实现时，将会禁用日志功能。</p>
<p>如果想使用指定的日志实现，可以通过在 MyBatis 配置文件 mybatis-config.xml 里面添加一项 setting 来选择其它日志实现。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;logImpl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;LOG4J&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>可选的值有：SLF4J、LOG4J、LOG4J2、JDK_LOGGING、COMMONS_LOGGING、STDOUT_LOGGING、NO_LOGGING，或者是实现了 <code>org.apache.ibatis.logging.Log</code> 接口，且构造方法以字符串为参数的类的完全限定名。</p>
<p>你也可以调用以下任一方法来选择日志实现：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">org.apache.ibatis.logging.LogFactory.useSlf4jLogging();</span><br><span class="line">org.apache.ibatis.logging.LogFactory.useLog4JLogging();</span><br><span class="line">org.apache.ibatis.logging.LogFactory.useJdkLogging();</span><br><span class="line">org.apache.ibatis.logging.LogFactory.useCommonsLogging();</span><br><span class="line">org.apache.ibatis.logging.LogFactory.useStdOutLogging();</span><br></pre></td></tr></table></figure>

<p>你应该在调用其它 MyBatis 方法之前调用以上的某个方法。另外，仅当运行时类路径中存在该日志实现时，日志实现的切换才会生效。</p>
<p>关于 SLF4J、Apache Commons Logging、Apache Log4J 和 JDK Logging 的更多信息，可以参考以下链接：</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://www.slf4j.org/">SLF4J</a></li>
<li><a target="_blank" rel="noopener" href="http://commons.apache.org/logging">Apache Commons Logging</a></li>
<li><a target="_blank" rel="noopener" href="http://logging.apache.org/log4j/">Apache Log4j 1.x and 2.x</a></li>
<li><a target="_blank" rel="noopener" href="http://java.sun.com/j2se/1.4.1/docs/guide/util/logging/">JDK Logging API</a></li>
</ul>
<h4 id="2-2-1-添加-jar-包"><a href="#2-2-1-添加-jar-包" class="headerlink" title="2.2.1 添加  jar 包"></a>2.2.1 添加  jar 包</h4><p>由于我们使用的是 Log4J，我们要确保它的 jar 包可以被应用使用。为此，需要将 jar 包添加到应用的类路径中。Log4J 的 jar 包可以在上面的链接中下载。</p>
<p>对于 web 应用可以将 <code>log4j.jar</code> 添加到 <code>WEB-INF/lib</code> 目录下</p>
<h4 id="2-2-2-配置-Log4J"><a href="#2-2-2-配置-Log4J" class="headerlink" title="2.2.2 配置 Log4J"></a>2.2.2 配置 Log4J</h4><p>在应用的类路径中（例如src）创建一个名为 <code>log4j.properties</code> 的文件，文件的具体内容如下：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">log4j.rootLogger</span>=<span class="string">DEBUG, stdout </span></span><br><span class="line"><span class="meta">log4j.appender.stdout</span>=<span class="string">org.apache.log4j.ConsoleAppender </span></span><br><span class="line"><span class="meta">log4j.appender.stdout.layout</span>=<span class="string">org.apache.log4j.PatternLayout </span></span><br><span class="line"><span class="meta">log4j.appender.stdout.layout.ConversionPattern</span>=<span class="string">%d [%-5p] %c - %m%n</span></span><br><span class="line"><span class="comment">#show sql</span></span><br><span class="line"><span class="meta">log4j.logger.java.sql.ResultSet</span>=<span class="string">INFO  </span></span><br><span class="line"><span class="meta">log4j.logger.org.apache</span>=<span class="string">INFO  </span></span><br><span class="line"><span class="meta">log4j.logger.java.sql.Connection</span>=<span class="string">DEBUG  </span></span><br><span class="line"><span class="meta">log4j.logger.java.sql.Statement</span>=<span class="string">DEBUG  </span></span><br><span class="line"><span class="meta">log4j.logger.java.sql.PreparedStatement</span>=<span class="string">DEBUG </span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>此时运行mybatis程序后，就会有对应的日志输出了</p>
</blockquote>
<h3 id="2-3-基本封装"><a href="#2-3-基本封装" class="headerlink" title="2.3 基本封装"></a>2.3 基本封装</h3><p>每次读取配置文件,产生一个工厂对象SqlSessionFactory,然后再生成出SqlSession对象,这个过程虽然并不复杂,但是也都是一些重复的代码流程,所以我们可以对其进行一个简单的封装。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/5-09-05-6:04</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：com.briup.utils</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SqlSessionUtil</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SqlSessionUtil</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SqlSessionFactory sqlSessionFactory;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> SqlSessionFactory <span class="title">getSqlSessionFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (SqlSessionUtil.class)&#123;</span><br><span class="line">                <span class="keyword">if</span> (sqlSessionFactory == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    InputStream in = Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line">                    sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(in);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sqlSessionFactory;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SqlSession <span class="title">openSqlSession</span><span class="params">(<span class="keyword">boolean</span> autoCommint)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getSqlSessionFactory().openSession(autoCommint);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SqlSession <span class="title">openSqlSession</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> openSqlSession(<span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="第二章-映射"><a href="#第二章-映射" class="headerlink" title="第二章-映射"></a>第二章-映射</h1><h2 id="1-映射"><a href="#1-映射" class="headerlink" title="1.映射"></a>1.映射</h2><p>关系型数据库和SQL是经受时间考验和验证的数据存储机制。和其他的<code>ORM</code> 框架如Hibernate不同，MyBatis鼓励开发者可以直接使用数据库，而不是将其对开发者隐藏，因为这样可以充分发挥数据库服务器所提供的SQL语句的巨大威力。</p>
<p>与此同时，MyBaits消除了书写大量冗余代码的痛苦，它让使用SQL更容易。在代码里直接嵌套SQL语句是很差的编码实践，并且维护起来困难。MyBaits使用了映射文件或注解来配置SQL语句。</p>
<h3 id="1-1-调用"><a href="#1-1-调用" class="headerlink" title="1.1 调用"></a>1.1 调用</h3><p>我们已经看见了一些在映射器配置文件中配置基本的映射语句，以及怎样使用SqlSession对象调用它们的例子。现在让我们看一下在com.briup.mappers包中的StudentMapper.xml 配置文件内，是如何配置id为<code>findStudentById</code>的SQL语句的，代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--namespace+id 代表唯一sql--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;www.baidu.com&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findStudentById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">       select id,name,email,phone as phoneNumber</span><br><span class="line">       from students where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，Student类中的属性名字和数据库中表中字段的名字是可以不一样的，例如类中可以是studId，而表中的字段名字为id</p>
</blockquote>
<p>我们可以通过下列代码调用findStudentById映射的SQL语句:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Student <span class="title">findStudentById</span><span class="params">(Integer studId)</span> </span>&#123;</span><br><span class="line">		SqlSession sqlSession=<span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			sqlSession = MyBatisSqlSessionFactory.openSession();</span><br><span class="line">			Student student = sqlSession.selectOne(<span class="string">&quot;www.baidu.com.findStudentById&quot;</span>, studId);</span><br><span class="line">			<span class="keyword">return</span> student;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">finally</span> &#123;</span><br><span class="line">			sqlSession.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>我们可以通过字符串形式来调用映射的SQL语句，形式为 namespace + sql语句id值，但是这种方式容易出错。你需要检查映射器配置文件中的定义，以保证你的输入参数类型和结果返回类型是有效的。</p>
<blockquote>
<p>注意，使用这种字符串的形式来调用sql语句，即使接口中没有对应的方法，也不会影响sql语句的执行。</p>
</blockquote>
<p>MyBatis通过使用映射器Mapper接口，提供了更好的调用映射sql语句的方式。</p>
<p>要求xml映射文件中的namespace属性值和映射接口的全限定名保持一致，同时：</p>
<ul>
<li>方法名和配置文件中sql语句的id值一致</li>
<li>方法参数类型和parameterType属性值一致</li>
<li>方法返回值类型和returnType属性值一致</li>
</ul>
<p>上述的StudentMapper.xml文件,我们可以创建一个映射器接口StudentMapper.java如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentMapper</span></span>&#123;</span><br><span class="line">	<span class="function">Student <span class="title">findStudentById</span><span class="params">(Integer id)</span></span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>在Student Mapper.xml映射器配置文件中，其名空间namespace应该跟StudentMapper接口的全限定名保持一致。另外，StudentMapper.xml中语句id, parameterType，returnType 应该分别和StudentMapper接口中的方法名，参数类型，返回值相对应。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.briup.dao.StudentMapper&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findStudentById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">        select id as studId, name, email, dob</span><br><span class="line">        from students</span><br><span class="line">        where id=#&#123;studId&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="1-2-映射sql"><a href="#1-2-映射sql" class="headerlink" title="1.2 映射sql"></a>1.2 映射sql</h3><p>MyBatis提供了多种元素来配置不同类型的语句，如SELECT，INSERT，UPDATE，DELETE。让我们看看如何具体配置映射语句</p>
<h4 id="1-2-1-INSERT"><a href="#1-2-1-INSERT" class="headerlink" title="1.2.1 INSERT"></a>1.2.1 INSERT</h4><p>一个INSERT语句可以在<code>&lt;insert&gt;</code>标签元素在映射器XML配置文件中配置，如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertStudent&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">    INSERT INTO</span><br><span class="line">    STUDENTS(ID,NAME,EMAIL,PHONE)</span><br><span class="line">    VALUES(#&#123;id&#125;,#&#123;name&#125;,#&#123;email&#125;,#&#123;phone&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>理解</strong></p>
<ul>
<li>parameterType<ul>
<li>代表参数的类型，因为我们要传入的是一个类的对象，所以类型就写类的全名称(或者别名)。</li>
</ul>
</li>
<li><code>#&#123;&#125;</code><ul>
<li>它代表占位符，相当于原来 jdbc 部分所学的?，都是用于执行语句时替换实际的数据。 具体的数据是由#{}里面的内容决定的。</li>
</ul>
</li>
<li>ognl表达式<ul>
<li>Object Graphic Navigation Language 对象图导航语言 </li>
<li>它是按照一定的语法格式来获取数据的。</li>
<li>语法格式就是使用 #{对象.对象}的方式</li>
</ul>
</li>
</ul>
<p>我们可以如下调用这个语句：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> count = sqlSession.insert(<span class="string">&quot;com.briup.dao.StudentMapper.insertStudent&quot;</span>, student);</span><br><span class="line"><span class="comment">//sqlSession.insert() 返回执行 INSERT 语句后所影响的行数。</span></span><br></pre></td></tr></table></figure>



<p>或者使用映射接口Mapper来调用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentMapper</span></span>&#123;</span><br><span class="line">	<span class="function">Student <span class="title">findStudentById</span><span class="params">(Integer id)</span></span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">StudentMapper mapper = sqlSession.getMapper(StudentMapper.class);</span><br><span class="line"><span class="keyword">int</span> count = mapper.insertStudent(student); </span><br></pre></td></tr></table></figure>



<p><strong>特别注意</strong>，有些版本的mybatis中，如果插入的对象中某一个属性为<strong>null</strong>，那么这时候运行会报错：（无效的列类型），原因是null在mybaits的JdbcType中没有对应的类型</p>
<ul>
<li><p>解决方式1，可以在insert语句中指定参数的类型，例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#&#123;phone&#125; </span><br><span class="line">修改为 </span><br><span class="line">#&#123;phone,jdbcType=VARCHAR&#125; </span><br></pre></td></tr></table></figure></li>
<li><p>解决方式2，可以在setting文件中进行统一的全局设置，例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;setting name=&quot;jdbcTypeForNull&quot; value=&quot;NULL&quot; /&gt;</span><br><span class="line">或者</span><br><span class="line">&lt;setting name=&quot;jdbcTypeForNull&quot; value=&quot;VARCHAR&quot; /&gt;</span><br></pre></td></tr></table></figure>

<p>​            </p>
</li>
</ul>
<p>自动生成主键:</p>
<p>在上述的INSERT语句中，我们为可以自动生成（auto-generated）主键的列 ID 插入值。我们可以使用useGeneratedKeys和keyProperty属性让数据库生成auto_increment列的值，并将生成的值设置到其中一个输入对象属性内，如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertStudent&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Student&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;studId&quot;</span>&gt;</span></span><br><span class="line">    INSERT INTO STUDENTS(NAME, EMAIL, PHONE)</span><br><span class="line">    VALUES(#&#123;name&#125;,#&#123;email&#125;,#&#123;phone&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>或者使用mysql的内置方法</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置保存时获取插入的 id --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyColumn</span>=<span class="string">&quot;id&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">	select last_insert_id();</span><br><span class="line"><span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>这里ID列值将会被数据库自动生成(如mysql)，并且生成的值会被设置到student对象的studId属性上。</p>
<p>但是有些数据库如Oracle并不支持AUTO_INCREMENT列，其使用序列（SEQUENCE）来生成主键值。    </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> sequence my_seq;</span><br><span class="line"><span class="keyword">create</span> sequence my_seq;</span><br></pre></td></tr></table></figure>



<p>这里我们使用了<code>&lt;selectKey&gt;</code>子元素来生成主键值，并将值保存到Student对象的studId 属性上。属性order=”before”表示MyBatis将取得序列的下一个值作为主键值，并且在执行INSERT语句之前将值设置到studId属性上。(程序中的student对象的studId属性)</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertStudent&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">&quot;studId&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;int&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">order</span>=<span class="string">&quot;BEFORE&quot;</span>&gt;</span></span><br><span class="line">        SELECT my_seq.nextval FROM DUAL</span><br><span class="line">    <span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br><span class="line">    INSERT INTO STUDENTS(ID,NAME,EMAIL, PHONE)</span><br><span class="line">    VALUES(#&#123;studId&#125;,#&#123;name&#125;,#&#123;email&#125;,#&#123;phone&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，SelectKey需要注意order属性，像MySQL、SQLServer等一类支持自动增长类型的数据库中，order需要设置为after才会取到正确的值，而Oracle这样取序列的情况，需要设置为before</p>
</blockquote>
<h4 id="1-2-2-UPDATE"><a href="#1-2-2-UPDATE" class="headerlink" title="1.2.2 UPDATE"></a>1.2.2 UPDATE</h4><p>一个UPDATE SQL语句可以在<code>&lt;update&gt;</code>元素在映射器XML配置文件中配置，如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateStudent&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">    UPDATE STUDENTS SET</span><br><span class="line">    NAME=#&#123;name&#125;, EMAIL=#&#123;email&#125;, PHONE=#&#123;phone&#125;</span><br><span class="line">    WHERE ID=#&#123;studId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以如下调用这个sql语句：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> updateCount = sqlSession.update(<span class="string">&quot;com.briup.dao.StudentMapper.updateStudent&quot;</span>, student);</span><br><span class="line"><span class="comment">//sqlSession.update();返回执行UPDATE语句之后影响的行数。</span></span><br></pre></td></tr></table></figure>



<p>或者使用映射接口Mapper来调用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentMapper</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">updateStudent</span><span class="params">(Student student)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">StudentMapper mapper = sqlSession.getMapper(StudentMapper.class);</span><br><span class="line"><span class="keyword">int</span> updateCount = mapper.updateStudent(student);</span><br></pre></td></tr></table></figure>



<h4 id="1-2-3-DELETE"><a href="#1-2-3-DELETE" class="headerlink" title="1.2.3 DELETE"></a>1.2.3 DELETE</h4><p>一个DELETE语句可以在<code>&lt;delete&gt;</code>标签元素中进行配置，如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteStudent&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">    DELETE FROM STUDENTS</span><br><span class="line">    WHERE ID=#&#123;studId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以如下调用这个sql语句：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SqlSession sqlSession = MyBatisSqlSessionFactory.openSession();</span><br><span class="line"><span class="keyword">int</span> studId = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> deleteCount = sqlSession.delete(<span class="string">&quot;com.briup.dao.StudentMapper.deleteStudent&quot;</span>, studId);</span><br><span class="line"><span class="comment">//sqlSession.delete()返回 delete 语句执行后影响的行数。</span></span><br></pre></td></tr></table></figure>



<p>或者使用映射接口Mapper来调用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentMapper</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">deleteStudent</span><span class="params">(<span class="keyword">int</span> studId)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">StudentMapper mapper = sqlSession.getMapper(StudentMapper.class);</span><br><span class="line"><span class="keyword">int</span> deleteCount = mapper.deleteStudent(studId);</span><br></pre></td></tr></table></figure>



<h4 id="1-2-4-SELECT"><a href="#1-2-4-SELECT" class="headerlink" title="1.2.4 SELECT"></a>1.2.4 SELECT</h4><blockquote>
<p>MyBatis真正强大的功能，在于映射SELECT查询结果到java的各种类型</p>
</blockquote>
<p>一个简单的select查询配置，如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findStudentById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">    SELECT ID, NAME, EMAIL, PHONE</span><br><span class="line">    FROM STUDENTS</span><br><span class="line">    WHERE ID=#&#123;studId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以如下调用这个sql语句：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Student student = sqlSession.selectOne(<span class="string">&quot;com.briup.dao.StudentMapper.findStudentById&quot;</span>, <span class="number">1</span>);</span><br></pre></td></tr></table></figure>



<p>或者使用映射接口Mapper来调用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentMapper</span></span>&#123;</span><br><span class="line">	<span class="function">Student <span class="title">findStudentById</span><span class="params">(Integer studId)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">StudentMapper mapper = sqlSession.getMapper(StudentMapper.class); </span><br><span class="line">Student student = mapper.findStudentById(studId); </span><br></pre></td></tr></table></figure>

<p>这时候Student对象的studId属性值为空，但是其他属性的值都有，因为数据库表中的字段为id,类中属性名为studId，所以没有自动把值封装进来。</p>
<p>这时给stud_id列起一个别名为studId，和类中属性名保持一致即可。如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findStudentById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">		SELECT ID AS studId, NAME,EMAIL, PHONE FROM STUDENTS</span><br><span class="line">		WHERE ID=#&#123;studId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>MyBatis执行返回多条结果的SELECT语句查询，如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAllStudents&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">		SELECT ID AS studId, NAME,EMAIL, PHONE</span><br><span class="line">		FROM STUDENTS</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以如下调用这个sql语句：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Student&gt; students =  </span><br><span class="line">		sqlSession.selectList(<span class="string">&quot;com.briup.dao.StudentMapper.findAllStudents&quot;</span>); </span><br></pre></td></tr></table></figure>



<p>或者使用映射接口Mapper来调用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentMapper</span></span>&#123;</span><br><span class="line">	<span class="function">List&lt;Student&gt; <span class="title">findAllStudents</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">StudentMapper mapper = sqlSession.getMapper(StudentMapper.class);</span><br><span class="line">List&lt;Student&gt; students = mapper.findAllStudents();</span><br></pre></td></tr></table></figure>



<p>除了List集合类型，也可以使用其他类型的 集合，如Set,Map等。</p>
<p>MyBatis会根据集合的类型，采用适当的集合实现，如下所示：</p>
<ul>
<li><p>对于List，Collection，Iterable类型，MyBatis将返回java.util.ArrayList</p>
</li>
<li><p>对于Map类型，MyBatis 将返回java.util.HashMap</p>
</li>
<li><p>对于Set类型，MyBatis 将返回java.util.HashSet</p>
</li>
<li><p>对于SortedSet类型，MyBatis将返回java.util.TreeSet</p>
</li>
</ul>
<p>例如1，查询【一条】数据填充到Map中</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findStudentById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">	SELECT * FROM STUDENTS WHERE ID=#&#123;studId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在这种情况下，结果集的列名将会作为Map中的key值，而列值将作为Map的value值。 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">HashMap&lt;String,Object&gt; studentMap = sqlSession.selectOne(<span class="string">&quot;com.briup.dao.StudentMapper.findStudentById&quot;</span>, studId);</span><br><span class="line">System.out.println(<span class="string">&quot;studId :&quot;</span> + studentMap.get(<span class="string">&quot;ID&quot;</span>));</span><br><span class="line">System.out.println(<span class="string">&quot;name :&quot;</span> + studentMap.get(<span class="string">&quot;NAME&quot;</span>));</span><br><span class="line">System.out.println(<span class="string">&quot;email :&quot;</span> + studentMap.get(<span class="string">&quot;EMAIL&quot;</span>));</span><br><span class="line">System.out.println(<span class="string">&quot;phone :&quot;</span> + studentMap.get(<span class="string">&quot;PHONE&quot;</span>));</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这里使用的selectOne方法，并且表中的字段名默认是大写</p>
</blockquote>
<blockquote>
<p>注意，这里也可以像之前一样，使用映射接口的方式来调用</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Map&lt;String,Object&gt; <span class="title">findStudentById</span><span class="params">(Integer studId)</span></span>; </span><br></pre></td></tr></table></figure>





<p>例如2， 查询【多条】数据填充到Map中</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAllStudents&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">	SELECT ID, NAME, EMAIL, PHONE FROM STUDENTS</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在这种情况下，最终返回的数据类型是List&lt;Map&lt;String,Object&gt;&gt;，如下所所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Map&lt;String, Object&gt;&gt; studentMapList = sqlSession.selectList(<span class="string">&quot;com.briup.dao.StudentMapper.findAllStudents&quot;</span>);</span><br><span class="line"><span class="keyword">for</span>(Map&lt;String, Object&gt; studentMap : studentMapList) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;studId :&quot;</span> + studentMap.get(<span class="string">&quot;ID&quot;</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;name :&quot;</span> + studentMap.get(<span class="string">&quot;NAME&quot;</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;email :&quot;</span> + studentMap.get(<span class="string">&quot;EMAIL&quot;</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;phone :&quot;</span> + studentMap.get(<span class="string">&quot;PHONE&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这里使用的selectList方法，并且表中的字段名默认是大写</p>
</blockquote>
<blockquote>
<p>注意，这里也可以像之前一样，使用映射接口的方式来调用</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Map&lt;String,Object&gt;&gt; findAllStudents(); </span><br></pre></td></tr></table></figure>





<p>例如3，查询到所有名字都放到List集合中并返回</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;findAllName_list&quot; resultType=&quot;String&quot;&gt;</span><br><span class="line">	SELECT NAME FROM STUDENTS</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<p>对应的映射接口中的方法为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">findAllName_list</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>



<p>例如4，查询表中的数据的条数</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findCount_int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">    SELECT count(*) FROM STUDENTS</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>对应的映射接口中的方法为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">findCount_int</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>



<h3 id="1-3-ResultMap"><a href="#1-3-ResultMap" class="headerlink" title="1.3 ResultMap"></a>1.3 ResultMap</h3><p>ResultMap被用来将SELECT语句的结果集映射到java对象属性中。</p>
<p>在映射文件中，可以先定义出结果集映射resultMap，然后在一些SELECT语句上引用这个resultMap。</p>
<p>所以，ResultMap就是提前定义好的一个映射规则，select语句可以使用ResultMap的映射规则来处理查询结果。</p>
<p>MyBatis的结果集映射resultMap非常强大，可以使用它指定sql查询出的结果集，会被怎么处理并封装成对象，也可以使用它完成复杂查询的映射，例如一对一、一对多关系的SELECT语句。</p>
<h4 id="1-3-1-简单ResultMap"><a href="#1-3-1-简单ResultMap" class="headerlink" title="1.3.1 简单ResultMap"></a>1.3.1 简单ResultMap</h4><p>定义一个resultMap，它的id值是唯一的，并且type属性是全限定类名或者是类型的别名。代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;StudentResult&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.briup.pojo.Student&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;dob&quot;</span> <span class="attr">column</span>=<span class="string">&quot;dob&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;phoneNumber&quot;</span> <span class="attr">column</span>=<span class="string">&quot;phone&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>&lt;resultMap&gt;</code>有俩个子元素：</p>
<ul>
<li><code>&lt;result&gt;</code>，用来将查询的数据中一个指定类列的值映射到对象指定的属性中</li>
<li><code>&lt;id&gt;</code>，和<code>&lt;result&gt;</code>标签功能相同，但是<code>&lt;id&gt;</code>用来映射的是表中的主键</li>
</ul>
<p>在select语句中，引用这个resultMap：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findStudentById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;StudentResult&quot;</span>&gt;</span></span><br><span class="line">		SELECT * FROM STUDENTS WHERE STUD_ID=#&#123;studId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAllStudents&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;StudentResult&quot;</span>&gt;</span></span><br><span class="line">		SELECT * FROM STUDENTS</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意事项：</p>
<ol>
<li><p>在<code>&lt;select&gt;</code>语句中，这里使用的是resultMap属性，而不是resultType属性</p>
</li>
<li><p>resultType属性中一般是写一个类型的全限定名或者别名，表示字段和属性名完全一致，进行自动封装即可</p>
</li>
<li><p>当<code>&lt;select&gt;</code>语句中配置了resutlMap属性，MyBatis会使用表中的列名与对象属性 【映射关系】 来填充对象中的属性值。</p>
</li>
<li><p>resultType和resultMap二者只能用其一，不能同时使用</p>
</li>
</ol>
<h4 id="1-3-2-继承ResultMap"><a href="#1-3-2-继承ResultMap" class="headerlink" title="1.3.2 继承ResultMap"></a>1.3.2 继承ResultMap</h4><blockquote>
<p>一个ResultMap可以继承另一个ResultMap，但是此功能是可选的，这里进行了解即可</p>
</blockquote>
<p>(注:这个可以在下面的一对一映射中进行测试,因为这里需要建立一对一关系的表结构)</p>
<p>第一个resultMap：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Student&quot;</span> <span class="attr">id</span>=<span class="string">&quot;StudentResult&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;studId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;stud_id&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;phone&quot;</span> <span class="attr">column</span>=<span class="string">&quot;phone&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>第二个resultMap：继承第一个ResultMap</p>
<p>假设新增了一个实体类Address，该类中有多个属性，分别和数据库中ADDRESSES表对应。<br>在Student类中又新增加了一个属性Address</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Student&quot;</span> <span class="attr">id</span>=<span class="string">&quot;StudentWithAddressResult&quot;</span> <span class="attr">extends</span>=<span class="string">&quot;StudentResult&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;address.addrId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;addr_id&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;address.street&quot;</span> <span class="attr">column</span>=<span class="string">&quot;street&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;address.city&quot;</span> <span class="attr">column</span>=<span class="string">&quot;city&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;address.state&quot;</span> <span class="attr">column</span>=<span class="string">&quot;state&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;address.zip&quot;</span> <span class="attr">column</span>=<span class="string">&quot;zip&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;address.country&quot;</span> <span class="attr">column</span>=<span class="string">&quot;country&quot;</span> /&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span> </span><br></pre></td></tr></table></figure>

<p><code>如果不继承</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Student&quot;</span> <span class="attr">id</span>=<span class="string">&quot;StudentResult&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;studId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;stud_id&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;phone&quot;</span> <span class="attr">column</span>=<span class="string">&quot;phone&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;address.addrId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;addr_id&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;address.street&quot;</span> <span class="attr">column</span>=<span class="string">&quot;street&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;address.city&quot;</span> <span class="attr">column</span>=<span class="string">&quot;city&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;address.state&quot;</span> <span class="attr">column</span>=<span class="string">&quot;state&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;address.zip&quot;</span> <span class="attr">column</span>=<span class="string">&quot;zip&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;address.country&quot;</span> <span class="attr">column</span>=<span class="string">&quot;country&quot;</span> /&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>如果只想映射Student数据，你可以使用id为StudentResult的resultMap,如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findStudentById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">resultMap</span>=<span class="string">&quot;StudentResult&quot;</span>&gt;</span></span><br><span class="line">    SELECT * FROM STUDENTS WHERE STUD_ID=#&#123;stud Id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span> </span><br></pre></td></tr></table></figure>



<p>如果你想将映射Student数据和Address数据，你可以使用id为StudentWithAddressResult的 resultMap：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectStudentWithAddress&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> </span></span><br><span class="line"><span class="tag">		<span class="attr">resultMap</span>=<span class="string">&quot;StudentWithAddressResult&quot;</span>&gt;</span></span><br><span class="line">    SELECT ID, NAME, EMAIL, PHONE, A.ADDR_ID, STREET, CITY, STATE, ZIP,</span><br><span class="line">    COUNTRY</span><br><span class="line">    FROM STUDENTS S LEFT OUTER JOIN ADDRESSES A ON S.ADDR_ID=A.ADDR_ID</span><br><span class="line">    WHERE STUD_ID=#&#123;studId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，该sql语句使用了连接查询中的外连接,也可以使用等值连接</p>
</blockquote>
<h4 id="1-3-3-sql标签"><a href="#1-3-3-sql标签" class="headerlink" title="1.3.3 sql标签"></a>1.3.3 sql标签</h4><p>mybatis中sql标签，主要是为了避免在项目开发的过程中，重复编写大量相同的sql语句。</p>
<p>例如，通过使用sql标签，可以将所有需要查询的字段封装在一个sql语句中 </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 将需要多次反复查的东西提取出来 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;querycolumns&quot;</span>&gt;</span></span><br><span class="line">	id,name,email,phone</span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findStudentById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;Student&quot;</span>&gt;</span>         </span><br><span class="line">	select <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;querycolumns&quot;</span>/&gt;</span> from students where id = #&#123;studId&#125; </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="1-4-一对一映射"><a href="#1-4-一对一映射" class="headerlink" title="1==.4 一对一映射=="></a>1==.4 一对一映射==</h3><blockquote>
<p>Student和Address是【一对一】关系</p>
</blockquote>
<p>建表以及数据插入:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> students;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> addresses;</span><br><span class="line"><span class="comment">--如果需要可以使用 cascade constraints;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> addresses(</span><br><span class="line">    addr_id number <span class="keyword">primary</span> key,</span><br><span class="line">    street varchar2(<span class="number">50</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    city varchar2(<span class="number">50</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    state varchar2(<span class="number">50</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    zip varchar2(<span class="number">10</span>),</span><br><span class="line">    country varchar2(<span class="number">50</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> students(</span><br><span class="line">    id number <span class="keyword">primary</span> key,</span><br><span class="line">    name varchar2(<span class="number">50</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    email varchar2(<span class="number">50</span>),</span><br><span class="line">    dob <span class="type">date</span> ,</span><br><span class="line">    phone varchar2(<span class="number">15</span>),  </span><br><span class="line">    addr_id number <span class="keyword">references</span> addresses(addr_id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> addresses(addr_id,street,city,state,zip,country) <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;redSt&#x27;</span>,<span class="string">&#x27;kunshan&#x27;</span>,<span class="string">&#x27;W&#x27;</span>,<span class="string">&#x27;12345&#x27;</span>,<span class="string">&#x27;china&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> addresses(addr_id,street,city,state,zip,country) <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;blueST&#x27;</span>,<span class="string">&#x27;kunshan&#x27;</span>,<span class="string">&#x27;W&#x27;</span>,<span class="string">&#x27;12345&#x27;</span>,<span class="string">&#x27;china&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> students(id,name,email,phone,addr_id) <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;John&#x27;</span>,<span class="string">&#x27;john@gmail.com&#x27;</span>,<span class="string">&#x27;123-456-7890&#x27;</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> students(id,name,email,phone,addr_id) <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;Paul&#x27;</span>,<span class="string">&#x27;paul@gmail.com&#x27;</span>,<span class="string">&#x27;111-222-3333&#x27;</span>,<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">commit</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，此时Students表中的主键列是id，addresses表中的主键列是addr_id</p>
</blockquote>
<blockquote>
<p>注意，一定要记得把事务提交commit，否则程序查询不到</p>
</blockquote>
<p>实体类：</p>
<blockquote>
<p>注意: 此处的PhoneNumber 需要使用类型转换器</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PhoneNumber</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String countryCode;</span><br><span class="line">	<span class="keyword">private</span> String stateCode;</span><br><span class="line">	<span class="keyword">private</span> String number;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;PhoneNumber&#123;&quot;</span> +</span><br><span class="line">				<span class="string">&quot;countryCode=&#x27;&quot;</span> + countryCode + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">				<span class="string">&quot;, stateCode=&#x27;&quot;</span> + stateCode + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">				<span class="string">&quot;, number=&#x27;&quot;</span> + number + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">				<span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">PhoneNumber</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// alt+insert</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">PhoneNumber</span><span class="params">(String countryCode, String stateCode, String number)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//  111</span></span><br><span class="line">		<span class="keyword">this</span>.countryCode = countryCode;</span><br><span class="line">		<span class="keyword">this</span>.stateCode = stateCode;</span><br><span class="line">		<span class="keyword">this</span>.number = number;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建方法将对象转成字符串 new Phone(&quot;000&quot;,&quot;111&quot;,&quot;222&quot;)</span></span><br><span class="line">	<span class="comment">// &quot;000-111-222&quot;</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">asStr</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.countryCode + <span class="string">&quot;-&quot;</span> + <span class="keyword">this</span>.stateCode + <span class="string">&quot;-&quot;</span> + <span class="keyword">this</span>.number;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建方法将字符串换成成对象</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">PhoneNumber</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// &quot;000-111-222&quot;</span></span><br><span class="line">		PhoneNumber phoneNumber = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">if</span> (str != <span class="keyword">null</span>) &#123;</span><br><span class="line">			String[] arr = str.split(<span class="string">&quot;-&quot;</span>);</span><br><span class="line">			<span class="comment">// phoneNumber = new PhoneNumber(arr[0], arr[1], arr[2]);</span></span><br><span class="line">			<span class="keyword">this</span>.countryCode = arr[<span class="number">0</span>];</span><br><span class="line">			<span class="keyword">this</span>.stateCode = arr[<span class="number">1</span>];</span><br><span class="line">			<span class="keyword">this</span>.number = arr[<span class="number">2</span>];</span><br><span class="line">			<span class="comment">// this.countryCode=...</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//return phoneNumber;</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getCountryCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> countryCode;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCountryCode</span><span class="params">(String countryCode)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.countryCode = countryCode;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getStateCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> stateCode;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStateCode</span><span class="params">(String stateCode)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.stateCode = stateCode;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getNumber</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> number;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNumber</span><span class="params">(String number)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.number = number;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.pojo.onetoone;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Address</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Integer addrId;</span><br><span class="line">	<span class="keyword">private</span> String street;</span><br><span class="line">	<span class="keyword">private</span> String city;</span><br><span class="line">	<span class="keyword">private</span> String state;</span><br><span class="line">	<span class="keyword">private</span> String zip;</span><br><span class="line">	<span class="keyword">private</span> String country;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getAddrId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> addrId;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAddrId</span><span class="params">(Integer addrId)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.addrId = addrId;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getStreet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> street;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStreet</span><span class="params">(String street)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.street = street;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getCity</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> city;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCity</span><span class="params">(String city)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.city = city;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> state;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setState</span><span class="params">(String state)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.state = state;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getZip</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> zip;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setZip</span><span class="params">(String zip)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.zip = zip;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getCountry</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> country;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCountry</span><span class="params">(String country)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.country = country;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">  	<span class="function"><span class="keyword">public</span> <span class="title">Address</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Address</span><span class="params">(Integer addrId, String street, String city, String state, String zip, String country)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.addrId = addrId;</span><br><span class="line">		<span class="keyword">this</span>.street = street;</span><br><span class="line">		<span class="keyword">this</span>.city = city;</span><br><span class="line">		<span class="keyword">this</span>.state = state;</span><br><span class="line">		<span class="keyword">this</span>.zip = zip;</span><br><span class="line">		<span class="keyword">this</span>.country = country;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;Address&#123;&quot;</span> +</span><br><span class="line">				<span class="string">&quot;addrId=&quot;</span> + addrId +</span><br><span class="line">				<span class="string">&quot;, street=&#x27;&quot;</span> + street + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">				<span class="string">&quot;, city=&#x27;&quot;</span> + city + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">				<span class="string">&quot;, state=&#x27;&quot;</span> + state + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">				<span class="string">&quot;, zip=&#x27;&quot;</span> + zip + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">				<span class="string">&quot;, country=&#x27;&quot;</span> + country + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">				<span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.pojo.onetoone;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Integer studId;</span><br><span class="line">	<span class="keyword">private</span> String name; </span><br><span class="line">	<span class="keyword">private</span> String email; </span><br><span class="line">	<span class="keyword">private</span> Date dob;</span><br><span class="line">	<span class="keyword">private</span> PhoneNumber phone;</span><br><span class="line">	<span class="keyword">private</span> Address address;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getStudId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> studId;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStudId</span><span class="params">(Integer studId)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.studId = studId;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getEmail</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> email;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmail</span><span class="params">(String email)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.email = email;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Date <span class="title">getDob</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> dob;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDob</span><span class="params">(Date dob)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.dob = dob;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> PhoneNumber <span class="title">getPhone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> phone;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPhone</span><span class="params">(PhoneNumber phone)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.phone = phone;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Address <span class="title">getAddress</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> address;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAddress</span><span class="params">(Address address)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.address = address;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">(Integer studId, String name, String email, Date dob)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.studId = studId;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">		<span class="keyword">this</span>.email = email;</span><br><span class="line">		<span class="keyword">this</span>.dob = dob;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;Student&#123;&quot;</span> +</span><br><span class="line">				<span class="string">&quot;studId=&quot;</span> + studId +</span><br><span class="line">				<span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">				<span class="string">&quot;, email=&#x27;&quot;</span> + email + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">				<span class="string">&quot;, dob=&quot;</span> + dob +</span><br><span class="line">				<span class="string">&quot;, phone=&quot;</span> + phone +</span><br><span class="line">				<span class="string">&quot;, address=&quot;</span> + address +</span><br><span class="line">				<span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>此时两张表的表结构以及样例数据如下所示</p>
<p>1.<code>addresses</code>表</p>
<table>
<thead>
<tr>
<th>addr_id</th>
<th>street</th>
<th>city</th>
<th>state</th>
<th>zip</th>
<th>country</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>redSt</td>
<td>kunshan</td>
<td>W</td>
<td>12345</td>
<td>china</td>
</tr>
<tr>
<td>2</td>
<td>blueST</td>
<td>kunshan</td>
<td>W</td>
<td>12345</td>
<td>china</td>
</tr>
</tbody></table>
<p>2.<code>students</code>表</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>email</th>
<th>phone</th>
<th>addr_id</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>John</td>
<td><a href="mailto:&#106;&#111;&#104;&#x6e;&#64;&#x67;&#x6d;&#x61;&#105;&#x6c;&#46;&#99;&#x6f;&#109;">&#106;&#111;&#104;&#x6e;&#64;&#x67;&#x6d;&#x61;&#105;&#x6c;&#46;&#99;&#x6f;&#109;</a></td>
<td>123-456-7890</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>Paul</td>
<td><a href="mailto:&#112;&#x61;&#117;&#108;&#64;&#x67;&#x6d;&#x61;&#x69;&#108;&#x2e;&#99;&#111;&#x6d;">&#112;&#x61;&#117;&#108;&#64;&#x67;&#x6d;&#x61;&#x69;&#108;&#x2e;&#99;&#111;&#x6d;</a></td>
<td>111-222-3333</td>
<td>2</td>
</tr>
</tbody></table>
<p>StudentMapper.xml文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Student&quot;</span> <span class="attr">id</span>=<span class="string">&quot;StudentWithAddressResult&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;studId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;phone&quot;</span> <span class="attr">column</span>=<span class="string">&quot;phone&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;address.addrId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;addr_id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;address.street&quot;</span> <span class="attr">column</span>=<span class="string">&quot;street&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;address.city&quot;</span> <span class="attr">column</span>=<span class="string">&quot;city&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;address.state&quot;</span> <span class="attr">column</span>=<span class="string">&quot;state&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;address.zip&quot;</span> <span class="attr">column</span>=<span class="string">&quot;zip&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;address.country&quot;</span> <span class="attr">column</span>=<span class="string">&quot;country&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectStudentWithAddress&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;StudentWithAddressResult&quot;</span>&gt;</span></span><br><span class="line">    select</span><br><span class="line">        s.id , s.name, s.email,s.dob,s.phone,</span><br><span class="line">        a.addr_id, a.street, a.city, a.state, a.zip, a.country</span><br><span class="line">    from</span><br><span class="line">    	students s</span><br><span class="line">    	left outer join addresses a on s.addr_id = a.addr_id</span><br><span class="line">    where</span><br><span class="line">    	id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：可以使用 对象.属性名 的方式为内嵌的对象内的属性赋值。例如 <code>address.city</code></p>
</blockquote>
<p>StudentMapper.java文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Student</span> <span class="title">Mapper</span></span>&#123; </span><br><span class="line">    <span class="function">Student <span class="title">selectStudentWithAddress</span><span class="params">(<span class="keyword">int</span> studId)</span></span>; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>



<p>测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> studId = <span class="number">1</span>; </span><br><span class="line">StudentMapper studentMapper = sqlSession.getMapper(StudentMapper.class); </span><br><span class="line">Student student = studentMapper.selectStudentWithAddress(studId); </span><br><span class="line">System.out.println(<span class="string">&quot;Student :&quot;</span> + student); </span><br><span class="line">System.out.println(<span class="string">&quot;Address :&quot;</span> + student.getAddress()); </span><br></pre></td></tr></table></figure>



<p>在使用这种方式映射的时候，如果address结果需要在其他的SELECT映射语句中单独封装成Address对象，那么就需要把同样的配置在重新写一遍，因为当前是在封装Student对象的时候嵌入了Address对象的封装，这段对Address映射的配置不能在其他地方重复的单独使用</p>
<p>针对于这种情况，MyBatis提供了更好地实现一对一关联映射的俩种方法：</p>
<ul>
<li>【嵌套结果】ResultMap</li>
<li>【嵌套查询】Select</li>
</ul>
<h4 id="1-4-1-嵌套结果"><a href="#1-4-1-嵌套结果" class="headerlink" title="1.4.1 嵌套结果"></a>1.4.1 嵌套结果</h4><p>使用【嵌套结果】ResultMap，实现一对一关系映射。</p>
<p>代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 独立的Address封装映射 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Address&quot;</span> <span class="attr">id</span>=<span class="string">&quot;AddressResult&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;addrId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;addr_id&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;street&quot;</span> <span class="attr">column</span>=<span class="string">&quot;street&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;city&quot;</span> <span class="attr">column</span>=<span class="string">&quot;city&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;state&quot;</span> <span class="attr">column</span>=<span class="string">&quot;state&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;zip&quot;</span> <span class="attr">column</span>=<span class="string">&quot;zip&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;country&quot;</span> <span class="attr">column</span>=<span class="string">&quot;country&quot;</span> /&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span> </span><br><span class="line">		</span><br><span class="line"><span class="comment">&lt;!-- Student封装映射，里面关联上Address的封装映射 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Student&quot;</span> <span class="attr">id</span>=<span class="string">&quot;StudentWithAddressResult&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;studId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;stud_id&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;dob&quot;</span> <span class="attr">column</span>=<span class="string">&quot;dob&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;phone&quot;</span> <span class="attr">column</span>=<span class="string">&quot;phone&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;address&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;AddressResult&quot;</span> /&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">		</span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectStudentWithAddress&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;StudentWithAddressResult&quot;</span>&gt;</span> </span><br><span class="line">    select </span><br><span class="line">        s.stud_id, s.name, s.email,s.dob,s.phone, </span><br><span class="line">        a.addr_id, a.street, a.city, a.state, a.zip, a.country</span><br><span class="line">    from </span><br><span class="line">    	students s </span><br><span class="line">    	left outer join addresses a on s.addr_id = a.addr_id</span><br><span class="line">    where </span><br><span class="line">    	stud_id = #&#123;id&#125;  </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span> </span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，<code>&lt;association&gt;</code>是关联的意思,常被用来表示(has-one)类型的关联。就是对象1里面关联另一个对象2</p>
</blockquote>
<p>同时我们也可以使用<code>&lt;association&gt; </code>定义【内联】的resultMap，代码如下所示：（了解即可，不常用）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 相当于把Student映射和Address映射又合并在一起写了，还是使用&lt;association&gt;标签 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Student&quot;</span> <span class="attr">id</span>=<span class="string">&quot;StudentWithAddressResult&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;studId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;stud_id&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;address&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;Address&quot;</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;addrId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;addr_id&quot;</span> /&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;street&quot;</span> <span class="attr">column</span>=<span class="string">&quot;street&quot;</span> /&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;city&quot;</span> <span class="attr">column</span>=<span class="string">&quot;city&quot;</span> /&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;state&quot;</span> <span class="attr">column</span>=<span class="string">&quot;state&quot;</span> /&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;zip&quot;</span> <span class="attr">column</span>=<span class="string">&quot;zip&quot;</span> /&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;country&quot;</span> <span class="attr">column</span>=<span class="string">&quot;country&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="1-4-2-嵌套查询"><a href="#1-4-2-嵌套查询" class="headerlink" title="1.4.2 嵌套查询"></a>1.4.2 嵌套查询</h4><p>使用【嵌套查询】select，实现一对一关系映射。</p>
<p>代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 独立的Address封装映射 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Address&quot;</span> <span class="attr">id</span>=<span class="string">&quot;AddressResult&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;addrId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;addr_id&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;street&quot;</span> <span class="attr">column</span>=<span class="string">&quot;street&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;city&quot;</span> <span class="attr">column</span>=<span class="string">&quot;city&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;state&quot;</span> <span class="attr">column</span>=<span class="string">&quot;state&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;zip&quot;</span> <span class="attr">column</span>=<span class="string">&quot;zip&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;country&quot;</span> <span class="attr">column</span>=<span class="string">&quot;country&quot;</span> /&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">		</span><br><span class="line"><span class="comment">&lt;!-- 独立的select查询，专门查询Address --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAddressById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;AddressResult&quot;</span>&gt;</span> </span><br><span class="line">    select * from addresses </span><br><span class="line">    where addr_id=#&#123;id&#125; </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span> </span><br><span class="line">		</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Student封装映射，里面关联了查询address使用的select语句，并指定数据库表中的这个关联的外键列的名字，这里是addr_id --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Student&quot;</span> <span class="attr">id</span>=<span class="string">&quot;StudentWithAddressResult&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;studId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;dob&quot;</span> <span class="attr">column</span>=<span class="string">&quot;dob&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;phone&quot;</span> <span class="attr">column</span>=<span class="string">&quot;phone&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;address&quot;</span> <span class="attr">column</span>=<span class="string">&quot;addr_id&quot;</span> <span class="attr">select</span>=<span class="string">&quot;findAddressById&quot;</span> /&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 查询Student的select语句，这里不用写多表查询，因为对于address的关联查询，已经在上边定义好了，并且在结果映射中关联进来了 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectStudentWithAddress&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;StudentWithAddressResult&quot;</span>&gt;</span> </span><br><span class="line">    	select </span><br><span class="line">	    	id,name,email,dob,phone,addr_id</span><br><span class="line">	    from </span><br><span class="line">	    	students </span><br><span class="line">	    where </span><br><span class="line">	    	id = #&#123;id&#125; </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span> </span><br></pre></td></tr></table></figure>

<p>在此方式中，<code>&lt;association</code>&gt;元素的select属性被设置成了id为findAddressById的语句。</p>
<p>两个分开的SQL语句将会在数据库中分别执行，第一个通过id查询student信息，而第二个调用findAddressById来加载address信息。</p>
<p>addr_id列的值将会被作为输入参数传递给selectAddressById语句作为参数进行条件查询。</p>
<p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">StudentMapper mapper = sqlSession.getMapper(StudentMapper.class); </span><br><span class="line">Student student = mapper.selectStudentWithAddress(<span class="number">1</span>); </span><br><span class="line">System.out.println(student); </span><br><span class="line">System.out.println(student.getAddress());</span><br></pre></td></tr></table></figure>



<p>嵌套查询，操作过程分析：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>通过用户传的id值，查询出指定的学生</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>注意，这个时候只是查询学生，没有查询地址</span><br><span class="line"><span class="keyword">select</span> id,name,email,dob,phone,addr_id <span class="keyword">from</span> students </span><br><span class="line"><span class="keyword">where</span> id <span class="operator">=</span> #&#123;studId&#125;</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>加上id为<span class="number">1</span></span><br><span class="line"><span class="keyword">select</span> id,name,email,dob,phone,addr_id <span class="keyword">from</span> students </span><br><span class="line"><span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>查询结果为</span><br><span class="line">        ID NAME    EMAIL           DOB    PHONE      ADDR_ID</span><br><span class="line"><span class="comment">---------- ------- --------------- ------ -------- ----------</span></span><br><span class="line">         <span class="number">1</span> John    john<span class="variable">@gmail</span>.com        <span class="number">123</span><span class="number">-456</span><span class="number">-7890</span>   <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>这时候，只能飞封装学生对象的普通属性，address属性是封装不了</span><br><span class="line">public class Student &#123;</span><br><span class="line">	<span class="operator">/</span><span class="operator">/</span>...其他普通属性</span><br><span class="line">	private Address address;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>需要专门的去查询和这个学生对应的address，然后进行封装</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>使用这个<span class="keyword">sql</span>语句</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> addresses </span><br><span class="line"><span class="keyword">where</span> addr_id <span class="operator">=</span> #&#123;id&#125; </span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>需要传入一个参数，表示和这个学生对应的地址id</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>其实这个参数,就是上面第一条<span class="keyword">sql</span>语句查询结果中的addr_id字段的值,也就是<span class="number">1</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> addresses </span><br><span class="line"><span class="keyword">where</span> addr_id <span class="operator">=</span> <span class="number">1</span> </span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>这一步操作对应的配置为：</span><br><span class="line"><span class="operator">&lt;</span>association property<span class="operator">=</span>&quot;address&quot; <span class="keyword">column</span><span class="operator">=</span>&quot;addr_id&quot; <span class="keyword">select</span><span class="operator">=</span>&quot;findAddressById&quot; <span class="operator">/</span><span class="operator">&gt;</span> </span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>查询结果为</span><br><span class="line">   ADDR_ID STREET     CITY       STATE ZIP        COUNTRY</span><br><span class="line"><span class="comment">---------- ---------- ---------- ----- ---------- ----------</span></span><br><span class="line">         <span class="number">1</span> redSt      kunshan    W     <span class="number">12345</span>      china</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>然后对这个数据进行封装，得到address对象</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>最后把address对存到student对象中即可</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>总结对比：</p>
<ul>
<li><p>嵌套结果</p>
<p>一条sql语句，查询出所有表中的数据，然后交给一个ResultMap去映射，这个ResultMap只负责映射封装一部分数据，另一部分数据交给第二个ResultMap来映射，这个俩个ResultMap之间，使用标签<code>&lt;association&gt;</code>进行关联</p>
<p>例如，<code>&lt;association property=&quot;address&quot; resultMap=&quot;AddressResult&quot; /&gt; </code></p>
</li>
<li><p>嵌套查询</p>
<p>把之前一条sql语句，拆分成多条sql语句，每条sql语句只查询一张表并封装一部分数据，然后使用标签<code>&lt;association&gt;</code>将多条sql语句关联起来，最后把结果合并起来就是完整的查询结果</p>
<p>例如，<code>&lt;association property=&quot;address&quot; column=&quot;addr_id&quot; select=&quot;findAddressById&quot; /&gt; </code></p>
</li>
</ul>
<h3 id="1-5-一对多映射"><a href="#1-5-一对多映射" class="headerlink" title="1.5 ==一对多映射=="></a>1.5 ==一对多映射==</h3><blockquote>
<p>在一对多关系中，数据库建表的时候外键，一定是在多的那一方建立</p>
</blockquote>
<p>例如，一个讲师tutors可以教授一个或者多个课程course。这意味着讲师和课程之间存在一对多的映射关系。</p>
<p>建表以及数据插入语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> courses;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> tutors;</span><br><span class="line"><span class="comment">--如果需要可以使用 cascade constraints;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tutors(</span><br><span class="line">    tutor_id number <span class="keyword">primary</span> key,</span><br><span class="line">    name varchar2(<span class="number">50</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    email varchar2(<span class="number">50</span>) ,</span><br><span class="line">    phone varchar2(<span class="number">15</span>) ,  </span><br><span class="line">    addr_id number(<span class="number">11</span>) <span class="keyword">references</span> addresses (addr_id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> courses(</span><br><span class="line">    course_id number <span class="keyword">primary</span> key,</span><br><span class="line">    name varchar2(<span class="number">100</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    description varchar2(<span class="number">512</span>),</span><br><span class="line">    start_date <span class="type">date</span> ,</span><br><span class="line">    end_date <span class="type">date</span> ,</span><br><span class="line">    tutor_id number <span class="keyword">references</span> tutors (tutor_id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tutors(tutor_id,name,email,phone,addr_id) <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;zs&#x27;</span>,<span class="string">&#x27;zs@briup.com&#x27;</span>,<span class="string">&#x27;123-456-7890&#x27;</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tutors(tutor_id,name,email,phone,addr_id) <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;ls&#x27;</span>,<span class="string">&#x27;ls@briup.com&#x27;</span>,<span class="string">&#x27;111-222-3333&#x27;</span>,<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> courses(course_id,name,description,start_date,end_date,tutor_id) <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;JavaSE&#x27;</span>,<span class="string">&#x27;JavaSE&#x27;</span>,to_date(<span class="string">&#x27;2022-01-10&#x27;</span>,<span class="string">&#x27;yyyy-mm-dd&#x27;</span>),to_date(<span class="string">&#x27;2022-02-10&#x27;</span>,<span class="string">&#x27;yyyy-mm-dd&#x27;</span>),<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> courses(course_id,name,description,start_date,end_date,tutor_id)	<span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;JavaEE&#x27;</span>,<span class="string">&#x27;JavaEE&#x27;</span>,to_date(<span class="string">&#x27;2022-01-10&#x27;</span>,<span class="string">&#x27;yyyy-mm-dd&#x27;</span>),to_date(<span class="string">&#x27;2022-03-10&#x27;</span>,<span class="string">&#x27;yyyy-mm-dd&#x27;</span>),<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> courses(course_id,name,description,start_date,end_date,tutor_id)	<span class="keyword">values</span>(<span class="number">3</span>,<span class="string">&#x27;MyBatis&#x27;</span>,<span class="string">&#x27;MyBatis&#x27;</span>,to_date(<span class="string">&#x27;2022-01-10&#x27;</span>,<span class="string">&#x27;yyyy-mm-dd&#x27;</span>),to_date(<span class="string">&#x27;2022-02-20&#x27;</span>,<span class="string">&#x27;yyyy-mm-dd&#x27;</span>),<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">commit</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，记得提交数据</p>
</blockquote>
<p>此时两张表中的示例数据如下</p>
<p>1.<code>tutors</code>表</p>
<table>
<thead>
<tr>
<th>tutor_id</th>
<th>name</th>
<th>email</th>
<th>phone</th>
<th>addr_id</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>zs</td>
<td><a href="mailto:&#x7a;&#115;&#64;&#98;&#114;&#x69;&#x75;&#x70;&#x2e;&#x63;&#x6f;&#x6d;">&#x7a;&#115;&#64;&#98;&#114;&#x69;&#x75;&#x70;&#x2e;&#x63;&#x6f;&#x6d;</a></td>
<td>123-456-7890</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>ls</td>
<td><a href="mailto:&#x6c;&#x73;&#x40;&#98;&#114;&#105;&#117;&#x70;&#46;&#x63;&#111;&#x6d;">&#x6c;&#x73;&#x40;&#98;&#114;&#105;&#117;&#x70;&#46;&#x63;&#111;&#x6d;</a></td>
<td>111-222-3333</td>
<td>2</td>
</tr>
</tbody></table>
<p>2.<code>courses</code>表</p>
<table>
<thead>
<tr>
<th>course_id</th>
<th>name</th>
<th>description</th>
<th>start_date</th>
<th>end_date</th>
<th>tutor_id</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>JavaSE</td>
<td>JavaSE</td>
<td>2022-01-10</td>
<td>2022-02-10</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>JavaEE</td>
<td>JavaEE</td>
<td>2022-01-10</td>
<td>2022-03-10</td>
<td>2</td>
</tr>
<tr>
<td>3</td>
<td>MyBatis</td>
<td>MyBatis</td>
<td>2022-01-10</td>
<td>2022-02-20</td>
<td>1</td>
</tr>
</tbody></table>
<p>在上述的表数据中，zs 讲师教授一个课程，而 ls 讲师教授两个课程。</p>
<p>实体类设计如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Course</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Integer courseId; </span><br><span class="line">	<span class="keyword">private</span> String name; </span><br><span class="line">	<span class="keyword">private</span> String description; </span><br><span class="line">	<span class="keyword">private</span> Date startDate; </span><br><span class="line">	<span class="keyword">private</span> Date endDate;</span><br><span class="line">    </span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getCourseId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> courseId;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCourseId</span><span class="params">(Integer courseId)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.courseId = courseId;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getDescription</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> description;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDescription</span><span class="params">(String description)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.description = description;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Date <span class="title">getStartDate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> startDate;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStartDate</span><span class="params">(Date startDate)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.startDate = startDate;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Date <span class="title">getEndDate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> endDate;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEndDate</span><span class="params">(Date endDate)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.endDate = endDate;</span><br><span class="line">	&#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">	</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Tutor</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer tutorId; </span><br><span class="line">    <span class="keyword">private</span> String name; </span><br><span class="line">    <span class="keyword">private</span> String email; </span><br><span class="line">    <span class="keyword">private</span> PhoneNumber phone;</span><br><span class="line">    <span class="keyword">private</span> Address address; </span><br><span class="line">    <span class="keyword">private</span> List&lt;Course&gt; courses;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getTutorId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> tutorId;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTutorId</span><span class="params">(Integer tutorId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.tutorId = tutorId;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getEmail</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> email;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmail</span><span class="params">(String email)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.email = email;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> PhoneNumber <span class="title">getPhone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> phone;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPhone</span><span class="params">(PhoneNumber phone)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.phone = phone;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Address <span class="title">getAddress</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAddress</span><span class="params">(Address address)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Course&gt; <span class="title">getCourses</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> courses;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCourses</span><span class="params">(List&lt;Course&gt; courses)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.courses = courses;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><code>&lt;collection&gt;</code>标签可以用来将多行课程结果映射成一个课程Course对象的集合。</p>
<p>和之前的一对一映射一样，可以使用【嵌套结果】ResultMap和【嵌套查询】Select语句两种方式，映射一对多关系。</p>
<h4 id="1-5-1-嵌套结果"><a href="#1-5-1-嵌套结果" class="headerlink" title="1.5.1 嵌套结果"></a>1.5.1 嵌套结果</h4><p>使用【嵌套结果】ResultMap 实现一对多映射，获得讲师及其课程信息，代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 独立的Address封装映射 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Address&quot;</span> <span class="attr">id</span>=<span class="string">&quot;AddressResult&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;addrId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;addr_id&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;street&quot;</span> <span class="attr">column</span>=<span class="string">&quot;street&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;city&quot;</span> <span class="attr">column</span>=<span class="string">&quot;city&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;state&quot;</span> <span class="attr">column</span>=<span class="string">&quot;state&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;zip&quot;</span> <span class="attr">column</span>=<span class="string">&quot;zip&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;country&quot;</span> <span class="attr">column</span>=<span class="string">&quot;country&quot;</span> /&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="comment">&lt;!-- 独立的Course封装映射 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Course&quot;</span> <span class="attr">id</span>=<span class="string">&quot;CourseResult&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;course_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;courseId&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;description&quot;</span> <span class="attr">property</span>=<span class="string">&quot;description&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;start_date&quot;</span> <span class="attr">property</span>=<span class="string">&quot;startDate&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;end_date&quot;</span> <span class="attr">property</span>=<span class="string">&quot;endDate&quot;</span> /&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span> </span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- Tutor封装映射，里面是有嵌套结果的方式关联一个Addres和多个Course，分别使用association标签和collection标签 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Tutor&quot;</span> <span class="attr">id</span>=<span class="string">&quot;TutorResult&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;tutor_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;tutorId&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;phone&quot;</span> <span class="attr">property</span>=<span class="string">&quot;phone&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;address&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;AddressResult&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;courses&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;CourseResult&quot;</span> /&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span> </span><br><span class="line">	</span><br><span class="line"><span class="comment">&lt;!-- 查询Tutor的select语句，多表连接查询，把查询的结果给个上面的映射结果统一进行封装 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findTutorById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;TutorResult&quot;</span>&gt;</span> </span><br><span class="line">		select </span><br><span class="line">			t.tutor_id, t.name, t.email,t.phone, </span><br><span class="line">			c.course_id, c.name, c.description, c.start_date, c.end_date,</span><br><span class="line">			a.addr_id,a.street,a.city,a.state,a.zip,a.country </span><br><span class="line">		from </span><br><span class="line">			tutors t </span><br><span class="line">			left outer join addresses a on t.addr_id  = a.addr_id </span><br><span class="line">			left outer join courses   c on t.tutor_id = c.tutor_id </span><br><span class="line">		where </span><br><span class="line">			t.tutor_id=#&#123;id&#125; </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span> </span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这里查询了三张表，如果表中有字段和其他表中的字段名字一样，那么一定要起别名进行区别，否则封装映射结果的时候会出问题。</p>
</blockquote>
<h4 id="1-5-2-嵌套查询"><a href="#1-5-2-嵌套查询" class="headerlink" title="1.5.2 嵌套查询"></a>1.5.2 嵌套查询</h4><p>使用【嵌套查询】Select，实现一对多映射，式获得讲师及其课程信息，代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 独立的Address封装映射 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Address&quot;</span> <span class="attr">id</span>=<span class="string">&quot;AddressResult&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;addrId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;addr_id&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;street&quot;</span> <span class="attr">column</span>=<span class="string">&quot;street&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;city&quot;</span> <span class="attr">column</span>=<span class="string">&quot;city&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;state&quot;</span> <span class="attr">column</span>=<span class="string">&quot;state&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;zip&quot;</span> <span class="attr">column</span>=<span class="string">&quot;zip&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;country&quot;</span> <span class="attr">column</span>=<span class="string">&quot;country&quot;</span> /&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 独立的Course封装映射 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Course&quot;</span> <span class="attr">id</span>=<span class="string">&quot;CourseResult&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;course_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;courseId&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;description&quot;</span> <span class="attr">property</span>=<span class="string">&quot;description&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;start_date&quot;</span> <span class="attr">property</span>=<span class="string">&quot;startDate&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;end_date&quot;</span> <span class="attr">property</span>=<span class="string">&quot;endDate&quot;</span> /&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="comment">&lt;!-- Tutor封装映射，里分别使用association和collection标签来进行关联查询，直接把对应的select查询语句管理进行 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Tutor&quot;</span> <span class="attr">id</span>=<span class="string">&quot;TutorResult&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;tutor_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;tutorId&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;phone&quot;</span> <span class="attr">property</span>=<span class="string">&quot;phone&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 把addr_id列的值当做参数传给findAddressById进行查询 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;address&quot;</span> <span class="attr">column</span>=<span class="string">&quot;addr_id&quot;</span> <span class="attr">select</span>=<span class="string">&quot;findAddressById&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 把tutor_id列的值当做参数传给findCoursesByTutor进行查询 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;courses&quot;</span> <span class="attr">column</span>=<span class="string">&quot;tutor_id&quot;</span> <span class="attr">select</span>=<span class="string">&quot;findCoursesByTutor&quot;</span> /&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span> </span><br><span class="line">	</span><br><span class="line"><span class="comment">&lt;!-- 单独的Tutor查询语句 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findTutorById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;TutorResult&quot;</span>&gt;</span> </span><br><span class="line">    select tutor_id,name,email,phone,addr_id</span><br><span class="line">    from tutors</span><br><span class="line">    where tutor_id = #&#123;tutor_id&#125; </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 单独的Address查询语句 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAddressById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;AddressResult&quot;</span>&gt;</span></span><br><span class="line">    select addr_id,street,city,state,zip,country</span><br><span class="line">    from addresses</span><br><span class="line">    where addr_id = #&#123;addr_id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 单独的Course查询语句 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findCoursesByTutor&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;CourseResult&quot;</span>&gt;</span></span><br><span class="line">    select course_id,name,description,start_date,end_date </span><br><span class="line">    from courses </span><br><span class="line">    where tutor_id = #&#123;tutor_id&#125; </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span> </span><br></pre></td></tr></table></figure>

<p>mapper接口代码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TutorMapper</span></span>&#123; </span><br><span class="line">    <span class="function">Tutor <span class="title">findTutorById</span><span class="params">(<span class="keyword">int</span> tutorId)</span></span>; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>


<p>测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">TutorMapper mapper = sqlSession.getMapper(TutorMapper.class); </span><br><span class="line">Tutor tutor = mapper.findTutorById(tutor Id); </span><br><span class="line">System.out.println(tutor); </span><br><span class="line">List&lt;Course&gt; courses = tutor.getCourses();</span><br><span class="line">courses.foreach(System.out::println);</span><br></pre></td></tr></table></figure>



<blockquote>
<p>注意，嵌套查询Select语句查询会导致性能问题。首先，主查询将会执行，对于主查询返回的每一行数据，另外一个查询将会被执行。对于大量数据而言，这会导致整体效率降低。</p>
</blockquote>
<p>==思考，这时候如果需要编写一个Course的插入功能，该如何操作？注意外键列在Course对应的表中==</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tutor(id,name,cName,tutor_id)</span><br><span class="line">	<span class="keyword">values</span>(#&#123;id&#125;,#&#123;name&#125;,#&#123;tutor.id&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="1-6-多对多映射"><a href="#1-6-多对多映射" class="headerlink" title="1.6 ==多对多映射=="></a>1.6 ==多对多映射==</h3><p>对于在mybatis中的多对多的处理，可以参照一对多来解决，以课程和学生为例</p>
<p>建表语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> student_course;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> course;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> student;</span><br><span class="line"><span class="comment">--如果需要可以使用 cascade constraints;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> course (</span><br><span class="line">    id number <span class="keyword">primary</span> key,</span><br><span class="line">    course_code varchar2(<span class="number">30</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    course_name varchar2(<span class="number">30</span>) <span class="keyword">not</span> <span class="keyword">null</span> </span><br><span class="line">);</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> student (</span><br><span class="line">    id number <span class="keyword">primary</span> key,</span><br><span class="line">    name varchar2(<span class="number">10</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    gender varchar2(<span class="number">10</span>) ,</span><br><span class="line">    major varchar2(<span class="number">10</span>) ,</span><br><span class="line">    grade varchar2(<span class="number">10</span>) </span><br><span class="line">);</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> student_course (</span><br><span class="line">    id number <span class="keyword">primary</span> key,</span><br><span class="line">    student_id number <span class="keyword">references</span> student(id),</span><br><span class="line">    course_id number <span class="keyword">references</span> course(id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>



<p>java实体类： 新建包 <code>com.briup.many2many</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.many2many;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Course</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Integer id;</span><br><span class="line">	<span class="keyword">private</span> String courseCode; <span class="comment">// 课程编号</span></span><br><span class="line">	<span class="keyword">private</span> String courseName;<span class="comment">// 课程名称</span></span><br><span class="line">	<span class="keyword">private</span> List&lt;Student&gt; students;<span class="comment">// 选课学生</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getCourseCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> courseCode;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCourseCode</span><span class="params">(String courseCode)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.courseCode = courseCode;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getCourseName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> courseName;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCourseName</span><span class="params">(String courseName)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.courseName = courseName;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Student&gt; <span class="title">getStudents</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> students;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStudents</span><span class="params">(List&lt;Student&gt; students)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.students = students;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.many2many;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Integer id;</span><br><span class="line">	<span class="keyword">private</span> String name; <span class="comment">// 姓名</span></span><br><span class="line">	<span class="keyword">private</span> String gender; <span class="comment">// 性别</span></span><br><span class="line">	<span class="keyword">private</span> String major; <span class="comment">// 专业</span></span><br><span class="line">	<span class="keyword">private</span> String grade; <span class="comment">// 年级</span></span><br><span class="line">	<span class="keyword">private</span> List&lt;Course&gt; courses;<span class="comment">// 所选的课程</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getGender</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> gender;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setGender</span><span class="params">(String gender)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.gender = gender;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getMajor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> major;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMajor</span><span class="params">(String major)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.major = major;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getGrade</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> grade;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setGrade</span><span class="params">(String grade)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.grade = grade;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Course&gt; <span class="title">getCourses</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> courses;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCourses</span><span class="params">(List&lt;Course&gt; courses)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.courses = courses;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>映射接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Many2ManyMapper</span> </span>&#123;</span><br><span class="line">	<span class="comment">//插入student数据</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertStudent</span><span class="params">(Student student)</span></span>;</span><br><span class="line">	<span class="comment">//插入course数据</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertCourse</span><span class="params">(Course course)</span></span>;</span><br><span class="line">	<span class="comment">//通过id查询学生</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Student <span class="title">getStudentById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">	<span class="comment">//通过id查询课程</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Course <span class="title">getCourseById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">  	<span class="comment">//学生x选课y</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">studentSelectCourse</span><span class="params">(Student student, Course course)</span></span>;</span><br><span class="line">    <span class="comment">//查询比指定id值小的学生信息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Student&gt; <span class="title">getStudentByIdOnCondition</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">    <span class="comment">//查询student级联查询出所选的course并且组装成完整的对象</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Student <span class="title">getStudentByIdWithCourses</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>映射文件：为了避免和之前类型的别名冲突，这里全都使用的是类型的全限定名</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> </span></span><br><span class="line"><span class="meta"> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.briup.mappers.Many2ManyMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertStudent&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.briup.many2many.Student&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;int&quot;</span> </span></span><br><span class="line"><span class="tag">                   <span class="attr">order</span>=<span class="string">&quot;BEFORE&quot;</span>&gt;</span></span><br><span class="line">            select my_seq.nextval from dual</span><br><span class="line">        <span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br><span class="line">        insert into</span><br><span class="line">        student(id,name,gender,major,grade)</span><br><span class="line">        values</span><br><span class="line">        (#&#123;id&#125;,#&#123;name&#125;,#&#123;gender&#125;,#&#123;major&#125;,#&#123;grade&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertCourse&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.briup.many2many.Course&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">order</span>=<span class="string">&quot;BEFORE&quot;</span>&gt;</span></span><br><span class="line">            select my_seq.nextval from dual</span><br><span class="line">        <span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br><span class="line">        insert into</span><br><span class="line">        course(id,course_code,course_name)</span><br><span class="line">        values</span><br><span class="line">        (#&#123;id&#125;,#&#123;courseCode&#125;,#&#123;courseName&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getStudentById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">resultType</span>=<span class="string">&quot;com.briup.many2many.Student&quot;</span>&gt;</span></span><br><span class="line">        select id,name,gender,major,grade</span><br><span class="line">        from student</span><br><span class="line">        where id=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getCourseById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">resultType</span>=<span class="string">&quot;com.briup.many2many.Course&quot;</span>&gt;</span></span><br><span class="line">        select id,course_code as courseCode,course_name as courseName</span><br><span class="line">        from course</span><br><span class="line">        where id=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- param1代表方法中第一个参数 以此类推 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;studentSelectCourse&quot;</span>&gt;</span></span><br><span class="line">        insert into</span><br><span class="line">        student_course(id,student_id,course_id)</span><br><span class="line">        values</span><br><span class="line">        (my_seq.nextval,#&#123;param1.id&#125;,#&#123;param2.id&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 如果有特殊符号的话 需要用 &lt;![CDATA[ 特殊符号 ]]&gt; 例如 &lt; &amp; 等等 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getStudentByIdOnCondition&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">resultType</span>=<span class="string">&quot;com.briup.many2many.Student&quot;</span>&gt;</span></span><br><span class="line">        select *</span><br><span class="line">        from student</span><br><span class="line">        where id &lt;![CDATA[ &lt; ]]&gt;</span><br><span class="line">        #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 这里使用了嵌套结果ResultMap的方式进行级联查询 当然也可以使用嵌套查询select --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 映射一个基本的Student查询结果 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;StudentResult&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.briup.many2many.Student&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sid&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">column</span>=<span class="string">&quot;gender&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;major&quot;</span> <span class="attr">column</span>=<span class="string">&quot;major&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;grade&quot;</span> <span class="attr">column</span>=<span class="string">&quot;grade&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 继承上面那个基本的映射,再扩展出级联查询 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;StudentResultWithCourses&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.briup.many2many.Student&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">extends</span>=<span class="string">&quot;StudentResult&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;courses&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;CourseResult&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 这里特别注意的是column=&quot;cid&quot; 这是和select语句中的 c.id as cid对应的 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;CourseResult&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.briup.many2many.Course&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;cid&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;courseCode&quot;</span> <span class="attr">column</span>=<span class="string">&quot;course_code&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;courseName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;course_name&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 注意:查询语句的中的c.id as cid这个地方,避免名字相同出现查询结果不正确的情况 同时在id=&quot;CourseResult&quot;的resultMap中也有与这里对应的设置要特别特别注意 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 注意，学生的id起的别名为sid --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getStudentByIdWithCourses&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">resultMap</span>=<span class="string">&quot;StudentResultWithCourses&quot;</span>&gt;</span></span><br><span class="line">        select </span><br><span class="line">			s.id  as sid,s.name,s.gender,s.major,s.grade,</span><br><span class="line">			c.id  as cid,c.course_code,c.course_name,</span><br><span class="line">			sc.id as scid,sc.student_id,sc.course_id</span><br><span class="line">		from </span><br><span class="line">			student s,</span><br><span class="line">			course c,</span><br><span class="line">			student_course sc</span><br><span class="line">		where</span><br><span class="line">			s.id= #&#123;id&#125;</span><br><span class="line">			and</span><br><span class="line">			s.id = sc.student_id</span><br><span class="line">			and</span><br><span class="line">			c.id = sc.course_id</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line">			</span><br></pre></td></tr></table></figure>


<p>测试：Many2ManyMapperTest.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_insertStudent</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    SqlSession session = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        session = MyBatisSqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">        Many2ManyMapper mapper = session.getMapper(Many2ManyMapper.class);</span><br><span class="line"></span><br><span class="line">        mapper.insertStudent(<span class="keyword">new</span> Student(<span class="string">&quot;张三&quot;</span>,<span class="string">&quot;男&quot;</span>,<span class="string">&quot;计算机&quot;</span>,<span class="string">&quot;大四&quot;</span>));</span><br><span class="line"></span><br><span class="line">        session.commit();</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        session.rollback();</span><br><span class="line">    &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(session!=<span class="keyword">null</span>)session.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_insertCourse</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    SqlSession session = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        session = MyBatisSqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">        Many2ManyMapper mapper = session.getMapper(Many2ManyMapper.class);</span><br><span class="line"></span><br><span class="line">        mapper.insertCourse(<span class="keyword">new</span> Course(<span class="string">&quot;001&quot;</span>,<span class="string">&quot;corejava&quot;</span>));</span><br><span class="line">        mapper.insertCourse(<span class="keyword">new</span> Course(<span class="string">&quot;002&quot;</span>,<span class="string">&quot;oracle&quot;</span>));</span><br><span class="line"></span><br><span class="line">        session.commit();</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        session.rollback();</span><br><span class="line">    &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(session!=<span class="keyword">null</span>)session.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_studentSelectCourse</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    SqlSession session = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        session = MyBatisSqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">        Many2ManyMapper mapper = session.getMapper(Many2ManyMapper.class);</span><br><span class="line"></span><br><span class="line">        Student student = mapper.getStudentById(<span class="number">58</span>);</span><br><span class="line">        Course course = mapper.getCourseById(<span class="number">59</span>);</span><br><span class="line"></span><br><span class="line">        mapper.studentSelectCourse(student, course);</span><br><span class="line"></span><br><span class="line">        session.commit();</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        session.rollback();</span><br><span class="line">    &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(session!=<span class="keyword">null</span>)session.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_getStudentByIdOnCondition</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    SqlSession session = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        session = MyBatisSqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">        Many2ManyMapper mapper = session.getMapper(Many2ManyMapper.class);</span><br><span class="line"></span><br><span class="line">        List&lt;Student&gt; list = mapper.getStudentByIdOnCondition(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(Student s:list)&#123;</span><br><span class="line">            System.out.println(s);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(session!=<span class="keyword">null</span>)session.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_getStudentByIdWithCourses</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    SqlSession session = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        session = MyBatisSqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">        Many2ManyMapper mapper = session.getMapper(Many2ManyMapper.class);</span><br><span class="line"></span><br><span class="line">        Student student = mapper.getStudentByIdWithCourses(<span class="number">58</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(student);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(session!=<span class="keyword">null</span>)session.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这是从student这边出发所做的一些操作 ,从course一边开始操作是一样的，因为俩者的关系是多对多(对称的)。</p>
</blockquote>
<h1 id="第三章-其他"><a href="#第三章-其他" class="headerlink" title="第三章-其他"></a>第三章-其他</h1><h2 id="1-动态"><a href="#1-动态" class="headerlink" title="1.==动态=="></a>1.==动态==</h2><blockquote>
<p>动态SQL 是 MyBatis 的强大特性之一</p>
</blockquote>
<p>很多时候，静态sql并不能完全满足程序的要求，我们需要根据用户输入的条件来动态的改变和构造一个sql语句。</p>
<p>mybaits通过以下标签对动态sql提供支持：</p>
<ol>
<li><p><code>&lt;if&gt;</code></p>
</li>
<li><p><code>&lt;choose&gt;</code> </p>
</li>
<li><p><code>&lt;where&gt;</code></p>
</li>
<li><p><code>&lt;foreach&gt;</code></p>
</li>
<li><p><code>&lt;trim&gt;</code> </p>
</li>
<li><p><code>&lt;set&gt;</code></p>
</li>
</ol>
<h3 id="1-1-if"><a href="#1-1-if" class="headerlink" title="1.1 if"></a>1.1 if</h3><p><code>&lt;if&gt;</code>标签被用来通过条件嵌入SQL片段，如果条件为true，则相应地SQL片段将会被添加到SQL语句中。</p>
<p>假定有一个课程搜索界面，设置了讲师（Tutor）下拉列表框，课程名称（CourseName）文本输入框，开始时间（StartDate）输入框，结束时间（EndDate）输入框，作为搜索条件，其中讲师下拉列表是必须选的，其他的都是可选的。</p>
<p>当用户点击搜索按钮时，需要显示符合条件的列表数据。</p>
<p>对应的sql映射文件，如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 独立的Course封装映射 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Course&quot;</span> <span class="attr">id</span>=<span class="string">&quot;CourseResult&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;course_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;courseId&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;description&quot;</span> <span class="attr">property</span>=<span class="string">&quot;description&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;start_date&quot;</span> <span class="attr">property</span>=<span class="string">&quot;startDate&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;end_date&quot;</span> <span class="attr">property</span>=<span class="string">&quot;endDate&quot;</span> /&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 查询Course的select语句，里面加入了if条件判断 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;searchCourses&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;map&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;CourseResult&quot;</span>&gt;</span></span><br><span class="line">    SELECT * FROM COURSES </span><br><span class="line">    WHERE TUTOR_ID= #&#123;tutorId&#125; </span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;courseName != null&quot;</span>&gt;</span> </span><br><span class="line">        AND NAME LIKE #&#123;courseName&#125; </span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;startDate != null&quot;</span>&gt;</span> </span><br><span class="line">        AND START_DATE &gt;= #&#123;startDate&#125; </span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;endDate != null&quot;</span>&gt;</span> </span><br><span class="line">        AND END_DATE &lt;![CDATA[ &lt;= ]]&gt; #&#123;endDate&#125; </span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span> </span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这里可以把多个参数存放到Map集合中，这样方法mybaits在sql语句中动态取值</p>
</blockquote>
<p>映射接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DynamicSqlMapper</span></span>&#123; </span><br><span class="line">    <span class="function">List&lt;Course&gt; <span class="title">searchCourses</span><span class="params">(Map&lt;String, Object&gt; map)</span></span>; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>



<p>测试方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_searchCourses1</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sqlSession = MyBatisSqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">        DynamicSqlMapper mapper = sqlSession.getMapper(DynamicSqlMapper.class);</span><br><span class="line"></span><br><span class="line">        Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;String,Object&gt;(); </span><br><span class="line">        map.put(<span class="string">&quot;tutorId&quot;</span>, <span class="number">1</span>); </span><br><span class="line">        map.put(<span class="string">&quot;courseName&quot;</span>, <span class="string">&quot;%Java%&quot;</span>); </span><br><span class="line"></span><br><span class="line">        LocalDate date = LocalDate.of(<span class="number">2022</span>, <span class="number">1</span>, <span class="number">10</span>);</span><br><span class="line">        map.put(<span class="string">&quot;startDate&quot;</span>, date);</span><br><span class="line"></span><br><span class="line">        List&lt;Course&gt; courses = mapper.searchCourses(map);</span><br><span class="line"></span><br><span class="line">        courses.forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>



<p>此处将生成查询语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> COURSES <span class="keyword">WHERE</span> TUTOR_ID<span class="operator">=</span> ? <span class="keyword">AND</span> NAME <span class="keyword">like</span> ? <span class="keyword">AND</span> START_DATE <span class="operator">&gt;=</span> ?</span><br></pre></td></tr></table></figure>



<h3 id="1-2-choose"><a href="#1-2-choose" class="headerlink" title="1.2 choose"></a>1.2 choose</h3><p>有时候，查询功能是以查询 类别 为基础的。</p>
<p>例如，页面中有一个下拉列表，可以选择查询的类别，可以选择根据讲师查询、或者根据课程名查询、或者根据时间查询等等，选择了列表之后，再输入关键字进行查询。</p>
<p>MyBatis提供了<code>&lt;choose&gt;</code>标签可以支持此类型的查询处理。</p>
<p>对应的sql映射文件，如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Course&quot;</span> <span class="attr">id</span>=<span class="string">&quot;CourseResult&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;course_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;courseId&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;description&quot;</span> <span class="attr">property</span>=<span class="string">&quot;description&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;start_date&quot;</span> <span class="attr">property</span>=<span class="string">&quot;startDate&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;end_date&quot;</span> <span class="attr">property</span>=<span class="string">&quot;endDate&quot;</span> /&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span> </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;searchCourses&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;map&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;CourseResult&quot;</span>&gt;</span> </span><br><span class="line">    SELECT * FROM COURSES </span><br><span class="line">    <span class="tag">&lt;<span class="name">choose</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;searchBy == &#x27;Tutor&#x27;&quot;</span>&gt;</span> </span><br><span class="line">            WHERE TUTOR_ID = #&#123;tutorId&#125; </span><br><span class="line">        <span class="tag">&lt;/<span class="name">when</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;searchBy == &#x27;CourseName&#x27;&quot;</span>&gt;</span> </span><br><span class="line">            WHERE name like #&#123;courseName&#125; </span><br><span class="line">        <span class="tag">&lt;/<span class="name">when</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span> </span><br><span class="line">            WHERE start_date &gt;= sysdate </span><br><span class="line">        <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">choose</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>测试方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_searchCourses2</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sqlSession = MyBatisSqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">        DynamicSqlMapper mapper = sqlSession.getMapper(DynamicSqlMapper.class);</span><br><span class="line"></span><br><span class="line">        Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;String,Object&gt;(); </span><br><span class="line">        <span class="comment">//			map.put(&quot;searchBy&quot;, &quot;Tutor&quot;); </span></span><br><span class="line">        <span class="comment">//			map.put(&quot;tutorId&quot;, 1); </span></span><br><span class="line">        map.put(<span class="string">&quot;searchBy&quot;</span>, <span class="string">&quot;CourseName&quot;</span>); </span><br><span class="line">        map.put(<span class="string">&quot;courseName&quot;</span>, <span class="string">&quot;%MyBatis%&quot;</span>); </span><br><span class="line"></span><br><span class="line">        List&lt;Course&gt; courses = mapper.searchCourses(map);</span><br><span class="line"></span><br><span class="line">        courses.forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="1-3-where"><a href="#1-3-where" class="headerlink" title="1.3 where"></a>1.3 where</h3><p>有时候，所有的查询条件应该是可选的。</p>
<p>在需要使用至少一种查询条件的情况下，可以直接使用WHERE子句，如果有多个条件，需要在条件中添加AND或OR。</p>
<p>MyBatis提供了<code>&lt;where&gt;</code>元素支持这种类型的动态SQL语句。 </p>
<p>例如，在查询课程界面，假设所有的查询条件是可选的</p>
<p>对应的sql映射文件，如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Course&quot;</span> <span class="attr">id</span>=<span class="string">&quot;CourseResult&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;course_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;courseId&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;description&quot;</span> <span class="attr">property</span>=<span class="string">&quot;description&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;start_date&quot;</span> <span class="attr">property</span>=<span class="string">&quot;startDate&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;end_date&quot;</span> <span class="attr">property</span>=<span class="string">&quot;endDate&quot;</span> /&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span> </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;searchCourses&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;map&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;CourseResult&quot;</span>&gt;</span> </span><br><span class="line">    SELECT * FROM COURSES </span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;tutorId != null &quot;</span>&gt;</span> </span><br><span class="line">            TUTOR_ID= #&#123;tutorId&#125; </span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;courseName != null&quot;</span>&gt;</span> </span><br><span class="line">            AND name like #&#123;courseName&#125; </span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;startDate != null&quot;</span>&gt;</span> </span><br><span class="line">            AND start_date &gt;= #&#123;startDate&#125; </span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span> </span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，<code>&lt;where&gt;</code>元素只有在其内部标签有返回内容时才会在动态语句上插入WHERE条件语句。<br>并且，如果WHERE子句以AND或者OR打头，则打头的AND或OR将会被移除。</p>
</blockquote>
<p>测试方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_searchCourses3</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sqlSession = MyBatisSqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">        DynamicSqlMapper mapper = sqlSession.getMapper(DynamicSqlMapper.class);</span><br><span class="line"></span><br><span class="line">        Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;String,Object&gt;(); </span><br><span class="line">        <span class="comment">//map.put(&quot;tutorId&quot;, 1); </span></span><br><span class="line">        <span class="comment">//map.put(&quot;courseName&quot;, &quot;JavaSE&quot;); </span></span><br><span class="line">        <span class="comment">//map.put(&quot;startDate&quot;, LocalDate.of(2022, 1, 10)); </span></span><br><span class="line"></span><br><span class="line">        List&lt;Course&gt; courses = mapper.searchCourses(map);</span><br><span class="line"></span><br><span class="line">        courses.forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="1-4-trim"><a href="#1-4-trim" class="headerlink" title="1.4 trim"></a>1.4 trim</h3><p><code>&lt;trim&gt;</code>元素和<code>&lt;where&gt;</code>元素类似，同时<code>&lt;trim&gt;</code>提供了添加 前缀/后缀 或者 移除 前缀/后缀 的功能。</p>
<p>例如，</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;searchCourses&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;map&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;CourseResult&quot;</span>&gt;</span> </span><br><span class="line">    SELECT * FROM COURSES </span><br><span class="line">    <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;WHERE&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;and&quot;</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot; tutorId != null &quot;</span>&gt;</span></span><br><span class="line">            TUTOR_ID = #&#123;tutorId&#125; and</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;courseName != null&quot;</span>&gt;</span> </span><br><span class="line">            name like #&#123;courseName&#125; and</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">trim</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>其中：</p>
<ul>
<li>prefix表示有一个if成立则插入where语句</li>
<li>suffix表示后缀,和prefix相反</li>
<li>suffixOverrides=”and”表示如果最后生成的sql语句多一个and,则自动去掉.</li>
<li>prefixOverrides的意思是处理前缀,和suffixOverrides相反</li>
</ul>
<p>测试方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_searchCourses4</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sqlSession = MyBatisSqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">        DynamicSqlMapper mapper = sqlSession.getMapper(DynamicSqlMapper.class);</span><br><span class="line"></span><br><span class="line">        Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;String,Object&gt;(); </span><br><span class="line">        <span class="comment">//			map.put(&quot;tutorId&quot;, 1); </span></span><br><span class="line">        <span class="comment">//			map.put(&quot;courseName&quot;, &quot;JavaSE&quot;); </span></span><br><span class="line"></span><br><span class="line">        List&lt;Course&gt; courses = mapper.searchCourses(map);</span><br><span class="line"></span><br><span class="line">        courses.forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="1-5-foreach"><a href="#1-5-foreach" class="headerlink" title="1.5 foreach"></a>1.5 foreach</h3><p>另外一个强大的动态SQL语句构造标签是<code>&lt;foreach&gt;</code></p>
<p>它可以迭代遍历一个数组或者集合，构造AND/OR条件或一个IN子句。</p>
<p>假设查询tutor_id为 1，3，6的讲师所教授的课程，我们可以传递一个tutor_id组成的列表给映射语句，然后通过<code>&lt;foreach&gt;</code>遍历此列表构造动态SQL。</p>
<p>例如，</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;searchCourses&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;map&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;CourseResult&quot;</span>&gt;</span> </span><br><span class="line">    SELECT * FROM COURSES </span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;tutorIds != null&quot;</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">item</span>=<span class="string">&quot;tutorId&quot;</span> <span class="attr">collection</span>=<span class="string">&quot;tutorIds&quot;</span>&gt;</span> </span><br><span class="line">                OR tutor_id = #&#123;tutorId&#125; </span><br><span class="line">            <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span> </span><br></pre></td></tr></table></figure>



<p>映射接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DynamicSqlMapper</span></span>&#123; </span><br><span class="line">	<span class="function">List&lt;Course&gt; <span class="title">searchCourses</span><span class="params">(Map&lt;String,Object&gt; map)</span></span>; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>



<p>测试方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_searchCourses5</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sqlSession = MyBatisSqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">        DynamicSqlMapper mapper = sqlSession.getMapper(DynamicSqlMapper.class);</span><br><span class="line"></span><br><span class="line">        Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;String,Object&gt;(); </span><br><span class="line"></span><br><span class="line">        List&lt;Integer&gt; tutorIds = <span class="keyword">new</span> ArrayList&lt;Integer&gt;(); </span><br><span class="line">        tutorIds.add(<span class="number">1</span>); </span><br><span class="line">        tutorIds.add(<span class="number">3</span>); </span><br><span class="line">        tutorIds.add(<span class="number">6</span>); </span><br><span class="line"></span><br><span class="line">        map.put(<span class="string">&quot;tutorIds&quot;</span>, tutorIds); </span><br><span class="line"></span><br><span class="line">        List&lt;Course&gt; courses = mapper.searchCourses(map);</span><br><span class="line"></span><br><span class="line">        courses.forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>和上面同样的功能，使用<code>&lt;foreach&gt;</code>生成IN子句：（常用）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;searchCourses&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;map&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;CourseResult&quot;</span>&gt;</span> </span><br><span class="line">    SELECT * FROM COURSES </span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;tutorIds != null&quot;</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span> </span><br><span class="line">            tutor_id IN </span><br><span class="line">            <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">item</span>=<span class="string">&quot;tempValue&quot;</span> <span class="attr">collection</span>=<span class="string">&quot;tutorIds&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span>&gt;</span> </span><br><span class="line">                #&#123;tempValue&#125; </span><br><span class="line">            <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span> </span><br></pre></td></tr></table></figure>

<blockquote>
<p>动态插入</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;saveOrderLine&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;collection&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	insert into</span><br><span class="line">	es_orderline(num,cost,book_id,orderForm_id)</span><br><span class="line">	values</span><br><span class="line"></span><br><span class="line">       <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;collection&quot;</span> <span class="attr">item</span>=<span class="string">&quot;orderLine&quot;</span> <span class="attr">index</span>=<span class="string">&quot;index&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">           (</span><br><span class="line">               #&#123;orderLine.num&#125;,</span><br><span class="line">               #&#123;orderLine.cost&#125;,</span><br><span class="line">               #&#123;orderLine.book.id&#125;,</span><br><span class="line">               #&#123;orderLine.orderForm.id&#125;</span><br><span class="line">           )</span><br><span class="line">       <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="1-6-set"><a href="#1-6-set" class="headerlink" title="1.6 set"></a>1.6 set</h3><p><code>&lt;set&gt;</code>元素和<code>&lt;where&gt;</code>元素类似，但是set元素只是针对update更新语句使用的。</p>
<p>例如，</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateStudent&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Student&quot;</span>&gt;</span> </span><br><span class="line">    update students  </span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null&quot;</span>&gt;</span>name=#&#123;name&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;email != null&quot;</span>&gt;</span>email=#&#123;email&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;phone != null&quot;</span>&gt;</span>phone=#&#123;phone&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span> </span><br><span class="line">    where id=#&#123;studId&#125; </span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span> </span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，如果<code>&lt;if&gt;</code>条件返回了任何文本内容，<code>&lt;set&gt;</code>将会插入set关键字和其文本内容，并且会剔除将末尾的逗号。</p>
</blockquote>
<p>测试方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_updateStudent</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sqlSession = MyBatisSqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">        DynamicSqlMapper mapper = sqlSession.getMapper(DynamicSqlMapper.class);</span><br><span class="line"></span><br><span class="line">        Student student = <span class="keyword">new</span> Student();</span><br><span class="line">        student.setStudId(<span class="number">45</span>);</span><br><span class="line">        student.setEmail(<span class="string">&quot;xx@briup.com&quot;</span>);</span><br><span class="line"></span><br><span class="line">        mapper.updateStudent(student);</span><br><span class="line"></span><br><span class="line">        sqlSession.commit();</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="2-特殊"><a href="#2-特殊" class="headerlink" title="2.特殊"></a>2.特殊</h2><p>除了简化数据库编程外，MyBatis还提供了各种<strong>特殊功能</strong>，这些对实现一些常用任务非常有用，比如分页查询，存取CLOB/BLOB类型的数据，处理枚举类型值等等。</p>
<p>可以新建包<strong>special</strong>，相关实体类存放到这里面。<br>另外，在mybaits-config文件中配置别名和新增映射文件。</p>
<h3 id="2-1-枚举类型"><a href="#2-1-枚举类型" class="headerlink" title="2.1 枚举类型"></a>2.1 枚举类型</h3><p>MyBatis支持持久化enum类型属性。</p>
<p>假设t_user表中有一列gender（性别）类型为 varchar2(10)，存储 MALE 或者 FEMALE 两种值。</p>
<p>并且，User对象有一个enum类型的gender 属性，如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">Gender</span> </span>&#123; </span><br><span class="line">    MALE,FEMALE; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>



<p>默认情况下MyBatis使用<code>EnumTypeHandler</code>来处理enum类型的Java属性，并且将其存储为enum值的名称。</p>
<p>我们不需要为此做任何额外的配置。可以像使用基本数据类型属性一样使用enum类型属性。</p>
<p>建表语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> t_user;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_user(</span><br><span class="line">  id number <span class="keyword">primary</span> key,</span><br><span class="line">  name varchar2(<span class="number">50</span>),</span><br><span class="line">  gender varchar2(<span class="number">10</span>)</span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>实体类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.special;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123; </span><br><span class="line">	<span class="keyword">private</span> Integer id; </span><br><span class="line">	<span class="keyword">private</span> String name; </span><br><span class="line">	<span class="keyword">private</span> Gender gender;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Gender <span class="title">getGender</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> gender;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setGender</span><span class="params">(Gender gender)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.gender = gender;</span><br><span class="line">	&#125; </span><br><span class="line"></span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>



<p>映射文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;User&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">order</span>=<span class="string">&quot;BEFORE&quot;</span>&gt;</span></span><br><span class="line">        select my_seq.nextval from dual</span><br><span class="line">    <span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br><span class="line">    insert into t_user(id,name,gender) </span><br><span class="line">    values(#&#123;id&#125;,#&#123;name&#125;,#&#123;gender&#125;) </span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>测试方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_insertUser</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sqlSession = MyBatisSqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">        SpecialMapper mapper = sqlSession.getMapper(SpecialMapper.class);</span><br><span class="line">        User user = <span class="keyword">new</span> User(<span class="string">&quot;tom&quot;</span>,Gender.MALE);</span><br><span class="line"></span><br><span class="line">        mapper.insertUser(user);</span><br><span class="line"></span><br><span class="line">        sqlSession.commit();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，当执行insertStudent语句的时候，MyBatis会取Gender枚举对象（FEMALE/MALE）的名称，存储到GENDER列中。</p>
</blockquote>
<p>如果我们想存储FEMALE为0，MALE为1到gender列中，需要在mybatis-config.xml文件中配置专门的<strong>类型处理器</strong>，并指定它处理的枚举类型是哪个。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">&quot;org.apache.ibatis.type.EnumOrdinalTypeHandler&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.briup.special.Gender&quot;</span>/&gt;</span> </span><br></pre></td></tr></table></figure>

<p>需要注意的是，枚举类型的【顺序值】是根据enum中的声明顺序赋值的。如果改变了Gender里面对象的声明顺序，则数据库存储的数据和此顺序值就不匹配了。</p>
<h3 id="2-2-CLOB-BLOB"><a href="#2-2-CLOB-BLOB" class="headerlink" title="2.2 CLOB/BLOB"></a>2.2 CLOB/BLOB</h3><p>BLOB和CLOB都是大字段类型。</p>
<p>BLOB是按二进制来存储的，而CLOB是可以直接存储文字的。</p>
<p>通常像图片、文件、音乐等信息就用BLOB字段来存储，先将文件转为二进制再存储进去。</p>
<p>文章或者是较长的文字，就用CLOB存储.</p>
<p>BLOB和CLOB在不同的数据库中对应的类型也不一样：</p>
<ul>
<li>在MySQL中，clob对应text/longtext，blob对应blob </li>
<li>在Oracle中，clob对应clob，blob对应blob  </li>
</ul>
<p>对此，MyBatis提供了内建的对CLOB/BLOB类型列的映射处理支持，无需我们额外配置和操作。</p>
<p>例如，</p>
<p>建表语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> user_pics;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> user_pics( </span><br><span class="line">    id number <span class="keyword">primary</span> key, </span><br><span class="line">    name varchar2(<span class="number">50</span>) , </span><br><span class="line">    pic <span class="type">blob</span>, </span><br><span class="line">    bio <span class="type">clob</span></span><br><span class="line">); </span><br></pre></td></tr></table></figure>

<p>照片（pic）可以是PNG,JPG或其他格式的。简介信息（bio）可以是比较长的文字描述。</p>
<p>默认情况下，MyBatis将CLOB类型的列映射到<code>java.lang.String</code>类型上、而把BLOB列映射到<code>byte[]</code>类型上。</p>
<p>实体类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.special;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserPic</span></span>&#123; </span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> id; </span><br><span class="line">	<span class="keyword">private</span> String name; </span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">byte</span>[] pic; <span class="comment">//blob</span></span><br><span class="line">	<span class="keyword">private</span> String bio; <span class="comment">//clob</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">byte</span>[] getPic() &#123;</span><br><span class="line">		<span class="keyword">return</span> pic;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPic</span><span class="params">(<span class="keyword">byte</span>[] pic)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.pic = pic;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getBio</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> bio;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBio</span><span class="params">(String bio)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.bio = bio;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>



<p>映射文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertUserPic&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;UserPic&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">order</span>=<span class="string">&quot;BEFORE&quot;</span>&gt;</span></span><br><span class="line">        select my_seq.nextval from dual</span><br><span class="line">    <span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br><span class="line">    insert into user_pics(id,name, pic,bio) </span><br><span class="line">    values(#&#123;id&#125;,#&#123;name&#125;,#&#123;pic&#125;,#&#123;bio&#125;) </span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span> </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserPicById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;UserPic&quot;</span>&gt;</span> </span><br><span class="line">    select * from user_pics where id=#&#123;id&#125; </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span> </span><br></pre></td></tr></table></figure>



<p>测试方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_insertUserPic</span><span class="params">()</span></span>&#123; </span><br><span class="line">    String name = <span class="string">&quot;tom&quot;</span>; </span><br><span class="line">    String bio = <span class="string">&quot;可以是很长的字符串&quot;</span>;</span><br><span class="line">    <span class="keyword">byte</span>[] pic = <span class="keyword">null</span>; </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//读取用户头像图片</span></span><br><span class="line">        File file = <span class="keyword">new</span> File(<span class="string">&quot;src/com/briup/special/1.gif&quot;</span>); </span><br><span class="line">        InputStream is = <span class="keyword">new</span> FileInputStream(file); </span><br><span class="line">        pic = <span class="keyword">new</span> <span class="keyword">byte</span>[is.available()]; </span><br><span class="line">        is.read(pic); </span><br><span class="line">        is.close(); </span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e)&#123; </span><br><span class="line">        e.printStackTrace(); </span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    <span class="comment">//准备好要插入到数据库中的数据并封装成对象</span></span><br><span class="line">    UserPic userPic = <span class="keyword">new</span> UserPic(name, pic , bio); </span><br><span class="line"></span><br><span class="line">    SqlSession sqlSession = <span class="keyword">null</span>; </span><br><span class="line">    <span class="keyword">try</span>&#123; </span><br><span class="line">        sqlSession = MyBatisSqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">        SpecialMapper mapper = sqlSession.getMapper(SpecialMapper.class);</span><br><span class="line"></span><br><span class="line">        mapper.insertUserPic(userPic);</span><br><span class="line"></span><br><span class="line">        sqlSession.commit(); </span><br><span class="line">    &#125;<span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_getUserPicById</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sqlSession = MyBatisSqlSessionFactory.openSession();</span><br><span class="line">        SpecialMapper mapper = sqlSession.getMapper(SpecialMapper.class);</span><br><span class="line">        UserPic userPic = mapper.getUserPicById(<span class="number">59</span>);</span><br><span class="line">        System.out.println(userPic.getId());</span><br><span class="line">        System.out.println(userPic.getName());</span><br><span class="line">        System.out.println(userPic.getBio());</span><br><span class="line">        System.out.println(userPic.getPic().length);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-多个参数"><a href="#2-3-多个参数" class="headerlink" title="2.3 多个参数"></a>2.3 多个参数</h3><p>MyBatis中的映射语句有一个parameterType属性来制定输入参数的类型。</p>
<p>如果我们想给映射语句传入多个参数的话，我们可以将所有的输入参数放到HashMap中，将HashMap传递给映射语句。</p>
<p>其实就是把多个参数存到Map中，把Map当做一个参数再传给sql语句，mybaits收到后再解析Map集合拿到每一个参数。</p>
<p>同时MyBatis还提供了另外一种传递多个输入参数给映射语句的方法。</p>
<p>例如，我们想通过给定的name和email信息查找学生信息，定义查询接口如下</p>
<p>映射文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateUserPicNameById1&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">    update user_pics set name = #&#123;name&#125; where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateUserPicNameById2&quot;</span>&gt;</span></span><br><span class="line">    update user_pics set name = #&#123;param2&#125; where id = #&#123;param1&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>对于映射器中的方法，MyBatis默认从左到右给方法的参数命名为param1、param2…，依次类推。</p>
</blockquote>
<p>映射接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">updateUserPicNameById1</span><span class="params">(Map&lt;String,String&gt; map)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">updateUserPicNameById2</span><span class="params">(Integer id,String name)</span></span>;</span><br></pre></td></tr></table></figure>



<p>测试方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_updateUserPicNameById1</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sqlSession = MyBatisSqlSessionFactory.openSession();</span><br><span class="line">        SpecialMapper mapper = sqlSession.getMapper(SpecialMapper.class);</span><br><span class="line">        Map&lt;String,String&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;64&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;zs&quot;</span>);</span><br><span class="line">        mapper.updateUserPicNameById1(map);</span><br><span class="line">        sqlSession.commit();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_updateUserPicNameById2</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sqlSession = MyBatisSqlSessionFactory.openSession();</span><br><span class="line">        SpecialMapper mapper = sqlSession.getMapper(SpecialMapper.class);</span><br><span class="line">        mapper.updateUserPicNameById2(<span class="number">64</span>,<span class="string">&quot;ww&quot;</span>);</span><br><span class="line">        sqlSession.commit();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-4-映射Map"><a href="#2-4-映射Map" class="headerlink" title="2.4 映射Map"></a>2.4 映射Map</h3><p>可以使用之前用过的方式，接口中方法返回值定义为Map类型，sql语句的resultType属性设置为map即可。这种情况默认把列名作为key,列中的值作为value。</p>
<p>如果有一些特殊的情况，比如需要使用id值作为key，把一行数据封装成的对象作为value放到map中的话，需要使用下面的方式。</p>
<p>例如，</p>
<p>映射文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAllUsers&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span> </span><br><span class="line">	select id,name,gender from t_user </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span> </span><br></pre></td></tr></table></figure>



<p>测试代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_findAllUsers_map</span><span class="params">()</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		sqlSession = MyBatisSqlSessionFactory.openSession();</span><br><span class="line">		Map&lt;Integer, User&gt; map = sqlSession.selectMap(<span class="string">&quot;com.briup.mappers.SpecialMapper.findAllUsers&quot;</span>,<span class="string">&quot;id&quot;</span>);</span><br><span class="line">		map.forEach((k,v)-&gt;System.out.println(k+<span class="string">&quot; : &quot;</span>+v));</span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意事项：</p>
<ul>
<li>这时候只能使用字符串来调用sql语句，不能使用映射接口的方式（不支持）</li>
<li>t_user表中gender列的值都是数字还是都是字符串，需要保持一致，否则查询报错</li>
<li>这里map将id作为key值，而每行数据封装成的User对象作为value值</li>
<li>map中的key我们可以指定，但是value只能是当前这条数据封装成的对象</li>
</ul>
<h3 id="2-5-分页查询"><a href="#2-5-分页查询" class="headerlink" title="2.5 分页查询"></a>2.5 分页查询</h3><p>MyBatis可以使用RowBounds逐页加载表数据。RowBounds对象可以使用offset和limit参数来构建。参数offset表示开始位置，而limit表示要取的记录的数目。</p>
<p>例如，</p>
<p>映射文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAllUsers&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span> </span><br><span class="line">    select id,name,gender from t_user </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span> </span><br></pre></td></tr></table></figure>



<p>映射接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">findAllUsers</span><span class="params">(RowBounds rowBounds)</span></span>;</span><br></pre></td></tr></table></figure>



<p>测试方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_findAllUsers_page</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sqlSession = MyBatisSqlSessionFactory.openSession();</span><br><span class="line">        SpecialMapper mapper = sqlSession.getMapper(SpecialMapper.class);</span><br><span class="line">        <span class="comment">//表示从第几条数据开始</span></span><br><span class="line">        <span class="keyword">int</span> offset = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">//连续取出几条数据</span></span><br><span class="line">        <span class="keyword">int</span> limit = <span class="number">5</span>; </span><br><span class="line">        RowBounds rowBounds = <span class="keyword">new</span> RowBounds(offset, limit); </span><br><span class="line">        List&lt;User&gt; list = mapper.findAllUsers(rowBounds);</span><br><span class="line">        list.forEach(System.out::println);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line">	</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，若规定每页5条数据，要展示第二页，使用offset=5,limit=5</p>
</blockquote>
<p>其实Mybatis的这种分页是基于内存的分页（查出所有记录再按偏移量offset和limit取结果），在大数据量的情况下这样的分页效率会很低，后面我们会使用mybaits的分页辅助/插件工具来完成分页。</p>
<p>之前，在学习oracle的时候，也学习了使用rownum进行分页：</p>
<p>例如，查询出行号在5~10之间的数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line">    <span class="keyword">select</span> rownum <span class="keyword">as</span> rowno, t.<span class="operator">*</span></span><br><span class="line">    <span class="keyword">from</span> t_user t</span><br><span class="line">    <span class="keyword">where</span> rownum <span class="operator">&lt;=</span> <span class="number">10</span></span><br><span class="line">) temp</span><br><span class="line"><span class="keyword">where</span> temp.rowno <span class="operator">&gt;=</span> <span class="number">5</span>;</span><br></pre></td></tr></table></figure>

<p>其中：</p>
<ul>
<li>rownum 可以等于1</li>
<li>rownum 可以大于0</li>
<li>rownum 可以小于任何数  </li>
</ul>
<p>但是可以给rownum起一个别名，并把sql语句查询结果当做一张表再查询，这样就可以对这个行号进行任意操作了。</p>
<h3 id="2-6-处理结果集"><a href="#2-6-处理结果集" class="headerlink" title="2.6 处理结果集"></a>2.6 处理结果集</h3><p>MyBatis提供了<code>ResultHandler</code>接口,可以让我们以任何自己喜欢的方式处理结果集ResultSet。</p>
<p><code>sqlSession.select()</code>方法，可以传递给它一个<code>ResultHandler</code>接口的实现，它会处理<code>ResultSet</code>中查询到的的每一条数据，这时候我们可以按照自己的需要进行封装。</p>
<p>例如，把t_user表中所有数据的id和name查询出来,并且把id值作为key,把name值作为value封装到Map集合中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_ResultHandler</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Map&lt;Integer,String&gt; map = <span class="keyword">new</span> HashMap&lt;Integer, String&gt;(); </span><br><span class="line">    SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sqlSession = MyBatisSqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">        sqlSession.select(<span class="string">&quot;com.briup.mappers.SpecialMapper.findAllUsers&quot;</span>, <span class="keyword">new</span> ResultHandler&lt;User&gt;() &#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleResult</span><span class="params">(ResultContext&lt;? extends User&gt; resultContext)</span> </span>&#123;</span><br><span class="line">                <span class="comment">//获取当这条数据封装好的User对象</span></span><br><span class="line">                User user = resultContext.getResultObject(); </span><br><span class="line">                <span class="comment">//按照自己的要求的方式进行封装</span></span><br><span class="line">                map.put(user.getId(), user.getName()); </span><br><span class="line">            &#125;</span><br><span class="line">                       </span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//也可以使用之前labmda表达式来完成</span></span><br><span class="line">        sqlSession.select(<span class="string">&quot;com.briup.dao.SpecialMapper.findAllUsers&quot;</span>,</span><br><span class="line">			(resultContext) -&gt; &#123;</span><br><span class="line">				User user = (User) resultContext.getResultObject();</span><br><span class="line">				map.put(user.getId(), user.getName());</span><br><span class="line">			&#125;</span><br><span class="line">		);</span><br><span class="line"></span><br><span class="line">        map.forEach((k,v)-&gt;System.out.println(k+<span class="string">&quot; : &quot;</span>+v));</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意: 方法名字叫select</p>
</blockquote>
<h3 id="2-7-缓存-redis"><a href="#2-7-缓存-redis" class="headerlink" title="2.7 缓存(redis)"></a>2.7 缓存(redis)</h3><p>默认情况下，mybatis会启用一级缓存。</p>
<p>如果使用同一个session对象调用了相同的SELECT语句，则直接会从缓存中返回结果，而不是再查询一次数据库。</p>
<blockquote>
<p>注意，session调用commit或close方法后,这个session中的一级缓存就会被清空 </p>
</blockquote>
<p>例如，根据日志输出可以看出,下面代码只会发出一条sql查询语句</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_cache1</span><span class="params">()</span></span>&#123;</span><br><span class="line">    SqlSession session = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        session = MyBatisSqlSessionFactory.openSession();</span><br><span class="line">        SpecialMapper mapper = session.getMapper(SpecialMapper.class);</span><br><span class="line">        User user1 = mapper.findUserById(<span class="number">56</span>);</span><br><span class="line">        System.out.println(user1);</span><br><span class="line">        User user2 = mapper.findUserById(<span class="number">56</span>);</span><br><span class="line">        System.out.println(user2);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，根据日志输出可以看出,下面代码只会发出一条sql查询语句</p>
</blockquote>
<blockquote>
<p>注意，session调用commit或close方法后,这个session中的一级缓存就会被清空 </p>
</blockquote>
<p>二级缓存，在不同的session对象之间可以共享缓存的数据</p>
<ol>
<li><code>mybatis-config.xml</code>文件中保证<code>&lt;setting name=&quot;cacheEnabled&quot; value=&quot;true&quot;/&gt;</code>设置中是缓存功能是开启的，默认就是开启的true</li>
<li>在需要二级缓存的xml映射文件中,手动开启缓存功能,在根元素中加入一个标签即可:<code>&lt;cache/&gt;</code></li>
<li>一个session查询完数据之后,需要调用commit或者close方法后,这个数据才会进入到二级缓存中,然后其他session就可以共享到这个缓存数据了</li>
<li>默认情况下,被二级缓存保存的对象需要实现序列化接口</li>
</ol>
<p>例如，</p>
<p>配置文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;cacheEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>映射文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.briup.mappers.SpecialMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">cache</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span>&gt;</span> ..<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span>&gt;</span> ..<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span>&gt;</span> ..<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>测试代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    SqlSession session = SqlSessionUtil.openSqlSession();</span><br><span class="line">    SpecialMapper mapper = session.getMapper(SpecialMapper.class);</span><br><span class="line">    List&lt;User&gt; userList1 = mapper.findAllUsers();</span><br><span class="line">    session.close();</span><br><span class="line"></span><br><span class="line">    SqlSession session2 = SqlSessionUtil.openSqlSession();</span><br><span class="line">    SpecialMapper mapper2 = session2.getMapper(SpecialMapper.class);</span><br><span class="line">    List&lt;User&gt; userList2 = mapper2.findAllUsers();</span><br><span class="line">    session2.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>二级缓存补充说明：</p>
<p>  　　1. 映射语句文件中的所有select语句将会被缓存<br>  　　2. 映射语句文件中的所有insert，update和delete语句会刷新缓存<br>  　　3. 缓存会使用Least Recently Used（LRU，最近最少使用的）算法来收回。<br>  　　4. 缓存会根据指定的时间间隔来刷新。<br>  　　5. 缓存会存储1024个对象</p>
<p>cache标签常用属性：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cache</span>  <span class="attr">eviction</span>=<span class="string">&quot;FIFO&quot;</span> <span class="attr">flushInterval</span>=<span class="string">&quot;60000&quot;</span> <span class="attr">size</span>=<span class="string">&quot;512&quot;</span> <span class="attr">readOnly</span>=<span class="string">&quot;true&quot;</span>/&gt;</span> </span><br></pre></td></tr></table></figure>

<p>其中：</p>
<ul>
<li>eviction=”FIFO” ，回收策略为先进先出</li>
<li>flushInterval=”60000” ，自动刷新时间60s</li>
<li>size=”512” ，最多缓存512个引用对象</li>
<li>readOnly=”true”，true表示对象不可以被序列化,false表示可以被序列化,默认值是false</li>
</ul>
<blockquote>
<p>注意，将来更多的时候我们会使用redis来进行对数据的缓存，而不是使用mybaits提供的缓存功能</p>
</blockquote>
<h2 id="3-注解"><a href="#3-注解" class="headerlink" title="3.注解"></a>3.注解</h2><blockquote>
<p>注解相关的内容作为了解即可，大多数情况下会还是会使用xml方式进行配置</p>
</blockquote>
<p>之前我们都是在映射器MapperXML配置文件中配置映射语句的。除此之外MyBatis也支持使用注解来配置映射语句。</p>
<p>当我们使用基于注解的映射器接口时，我们不再需要在XML配置文件中配置了。也可以同时使用基于XML和基于注解的映射语句。</p>
<p>例如，准备测试环境</p>
<p>建表语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> person;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> person(</span><br><span class="line">    id number <span class="keyword">primary</span> key,</span><br><span class="line">    name varchar2(<span class="number">15</span>),</span><br><span class="line">    age number</span><br><span class="line">);	</span><br></pre></td></tr></table></figure>



<p>实体类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.special;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Integer id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> Integer age;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> age;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.age = age;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-1-接口"><a href="#3-1-接口" class="headerlink" title="3.1 接口"></a>3.1 接口</h3><p>Mybatis中的注解，是直接写在映射接口中的。</p>
<p>MyBatis对于大部分的基于XML的映射配置（包括<code>&lt;select&gt;</code>,<code>&lt;update&gt;</code>等）提供了对应的基于注解的配置。然而在某些情况下，有些xml的配置功能，使用注解的方式是实现不了的。</p>
<h3 id="3-2-使用"><a href="#3-2-使用" class="headerlink" title="3.2 使用"></a>3.2 使用</h3><p>MyBatis提供了多种注解来支持不同类型的语句如:SELECT,INSERT,UPDATE,DELETE。</p>
<h4 id="3-2-1-Insert"><a href="#3-2-1-Insert" class="headerlink" title="3.2.1 @Insert"></a>3.2.1 @Insert</h4><p>我们可以使用 <code>@Insert</code>注解来定义一个INSERT映射语句：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.mappers; </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentMapper</span></span>&#123; </span><br><span class="line"></span><br><span class="line">	<span class="meta">@Insert(&quot;insert into students(stud_id,name,email,addr_id, phone) values(#&#123;studId&#125;,#&#123;name&#125;,#&#123;email&#125;,#&#123;address.addrId&#125;,#&#123;phone&#125;)&quot;)</span> </span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">insertStudent</span><span class="params">(Student student)</span></span>; </span><br><span class="line"></span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>注意，在mybatis-config.xml中，需要配置，通知mybaits，哪一个接口有注解的配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.dao.SpecialMapper&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>自动生成主键</p>
<p>可以使用 <code>@Options</code>注解的userGeneratedKeys和keyProperty属性让数据库产生 auto_increment（自增长）列的值，然后将生成的值设置到输入参数对象的属性中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Insert(&quot;insert into students(name,email,addr_id, phone) </span></span><br><span class="line"><span class="meta">		values(#&#123;name&#125;,#&#123;email&#125;,#&#123;address.addr Id&#125;,#&#123;phone&#125;)&quot;)</span> </span><br><span class="line"><span class="meta">@Options(useGeneratedKeys = true, keyProperty = &quot;studId&quot;)</span> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">insertStudent</span><span class="params">(Student student)</span></span>; </span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里ID列值将会通过MySQL数据库自动生成。并且生成的值将会被设置到student对象的studId属性中。</p>
</blockquote>
<p>有一些数据库如Oracle，并不支持AUTO_INCREMENT列属性，它使用序列（SEQUENCE）来产生主键的值。</p>
<p>我们可以使用 <code>@SelectKey</code>注解来为任意SQL语句来指定主键值，作为主键列的值。假设我们有一个名为STUD_ID_SEQ的序列来生成STUD_ID主键值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Insert(&quot;insert into students(stud_id,name,email,addr_id,phone) values(#&#123;studId&#125;,#&#123;name&#125;,#&#123;email&#125;,#&#123;address.addrId&#125;,#&#123;phone&#125;)&quot;)</span> </span><br><span class="line"><span class="meta">@SelectKey(statement=&quot;select my_seq.nextval from dual&quot;,  </span></span><br><span class="line"><span class="meta">           keyProperty=&quot;studId&quot;, resultType=int.class, before=true)</span> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">insertStudent</span><span class="params">(Student student)</span></span>; </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这里使用了<code>@SelectKey</code>来生成主键值，并且存储到了student对象的studId属性上。由于我们设置了<code>before=true</code>,该语句将会在执行INSERT语句之前执行</p>
<h4 id="3-2-2-Update"><a href="#3-2-2-Update" class="headerlink" title="3.2.2 @Update"></a>3.2.2 @Update</h4><p>我们可以使用 <code>@Update</code>注解来定义一个UPDATE映射语句，如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Update(&quot;update students set name=#&#123;name&#125;, email=#&#123;email&#125;,phone=#&#123;phone&#125; where stud_id=#&#123;studId&#125;&quot;)</span> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">updateStudent</span><span class="params">(Student student)</span></span>; </span><br></pre></td></tr></table></figure>

<h4 id="3-2-3-Delete"><a href="#3-2-3-Delete" class="headerlink" title="3.2.3 @Delete"></a>3.2.3 @Delete</h4><p>我们可以使用 <code>@Delete</code>注解来定义一个DELETE映射语句，如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Delete(&quot;delete from students where stud_id=#&#123;studId&#125;&quot;)</span> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">deleteStudent</span><span class="params">(<span class="keyword">int</span> studId)</span></span>;</span><br></pre></td></tr></table></figure>



<h4 id="3-2-4-Select"><a href="#3-2-4-Select" class="headerlink" title="3.2.4 @Select"></a>3.2.4 @Select</h4><p>我们可以使用 <code>@Select</code>注解来定义一个SELECT映射语句。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;select id as studid, name, email, phone from students where stud_id=#&#123;studId&#125;&quot;)</span> </span><br><span class="line"><span class="function">Student <span class="title">findStudentById</span><span class="params">(Integer studId)</span></span>; </span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这里为了将列名和对象中属性名匹配，为ID起了一个studId的别名。如果此查询返回了多行结果，将抛出TooManyResultsException异常</p>
</blockquote>
<h3 id="3-3-结果映射"><a href="#3-3-结果映射" class="headerlink" title="3.3 结果映射"></a>3.3 结果映射</h3><p>可以将查询结果通过别名或者是<code>@Results</code>注解与实体类的属性映射起来。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;select * from students&quot;)</span> </span><br><span class="line"><span class="meta">@Results(&#123; </span></span><br><span class="line"><span class="meta">        @Result(id = true, column = &quot;id&quot;, property = &quot;studId&quot;), </span></span><br><span class="line"><span class="meta">        @Result(column = &quot;name&quot;, property = &quot;name&quot;), </span></span><br><span class="line"><span class="meta">        @Result(column = &quot;email&quot;, property = &quot;email&quot;), </span></span><br><span class="line"><span class="meta">        @Result(column = &quot;addr_id&quot;, property = &quot;address.addrId&quot;) </span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="function">List&lt;Student&gt; <span class="title">findAllStudents</span><span class="params">()</span></span>; </span><br><span class="line">	</span><br></pre></td></tr></table></figure>



<p>也可以在xml中定义结果集，然后在注解中引用。例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;select * from students where stud_id=#&#123;studId&#125;&quot;)</span> </span><br><span class="line"><span class="meta">@Results(&#123; </span></span><br><span class="line"><span class="meta">		@Result(id = true, column = &quot;id&quot;, property = &quot;studId&quot;), </span></span><br><span class="line"><span class="meta">		@Result(column = &quot;name&quot;, property = &quot;name&quot;), </span></span><br><span class="line"><span class="meta">		@Result(column = &quot;email&quot;, property = &quot;email&quot;), </span></span><br><span class="line"><span class="meta">		@Result(column = &quot;addr_id&quot;, property = &quot;address.addrId&quot;) </span></span><br><span class="line"><span class="meta">&#125;)</span> </span><br><span class="line"><span class="function">Student <span class="title">findStudentById</span><span class="params">(<span class="keyword">int</span> studId)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Select(&quot;select * from students&quot;)</span> </span><br><span class="line"><span class="meta">@Results(&#123; </span></span><br><span class="line"><span class="meta">		@Result(id = true, column = &quot;id&quot;, property = &quot;studId&quot;), </span></span><br><span class="line"><span class="meta">		@Result(column = &quot;name&quot;, property = &quot;name&quot;), </span></span><br><span class="line"><span class="meta">		@Result(column = &quot;email&quot;, property = &quot;email&quot;), </span></span><br><span class="line"><span class="meta">		@Result(column = &quot;addr_id&quot;, property = &quot;address.addrId&quot;) </span></span><br><span class="line"><span class="meta">&#125;)</span> </span><br><span class="line"><span class="function">List&lt;Student&gt; <span class="title">findAllStudents</span><span class="params">()</span></span>; </span><br></pre></td></tr></table></figure>

<p>这里两个语句的 <code>@Results</code>配置完全相同，可以创建一个映射文件，文件中配置<code>&lt;resultMap&gt;</code>元素，然后使用 <code>@ResultMap</code>注解引用此<code>&lt;resultMap&gt;</code></p>
<p>在StudentMapper.xml中定义一个ID为StudentResult的<code>&lt;resultMap&gt;</code>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.briup.mappers.StudentMapper&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Student&quot;</span> <span class="attr">id</span>=<span class="string">&quot;StudentResult&quot;</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;studId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> /&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> /&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> /&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;phone&quot;</span> <span class="attr">column</span>=<span class="string">&quot;phone&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>在StudentMapper.java中,使用 <code>@ResultMap</code>引用名为StudentResult的resultMap:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentMapper</span></span>&#123; </span><br><span class="line">    <span class="meta">@Select(&quot;select * from students where stud_id=#&#123;studId&#125;&quot;)</span> </span><br><span class="line">    <span class="meta">@ResultMap(&quot;com.briup.mappers.StudentMapper.StudentResult&quot;)</span> </span><br><span class="line">    <span class="function">Student <span class="title">findStudentById</span><span class="params">(<span class="keyword">int</span> studId)</span></span>; </span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select(&quot;select * from students&quot;)</span> </span><br><span class="line">    <span class="meta">@ResultMap(&quot;com.briup.mappers.StudentMapper.StudentResult&quot;)</span> </span><br><span class="line">    <span class="function">List&lt;Student&gt; <span class="title">findAllStudents</span><span class="params">()</span></span>; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h3 id="3-4-一对一"><a href="#3-4-一对一" class="headerlink" title="3.4 一对一"></a>3.4 一对一</h3><p>MyBatis提供了 <code>@One</code>注解来使用嵌套select语句加载一对一关联查询数据。</p>
<p>例如，使用<code>@One</code>注解获取学生及其地址信息 <code>@Result</code>注解中，有one这个属性，也有many这个属性。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentMapper</span></span>&#123; </span><br><span class="line">    <span class="meta">@Select(&quot;select addr_id as addrId, street, city, state, zip, country from addresses where addr_id=#&#123;id&#125;&quot;)</span> </span><br><span class="line">    <span class="function">Address <span class="title">findAddressById</span><span class="params">(<span class="keyword">int</span> id)</span></span>; </span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select(&quot;select * from students where stud_id=#&#123;studId&#125; &quot;)</span> </span><br><span class="line">    <span class="meta">@Results(&#123; </span></span><br><span class="line"><span class="meta">            @Result(id = true, column = &quot;id&quot;, property = &quot;studId&quot;), </span></span><br><span class="line"><span class="meta">            @Result(column = &quot;name&quot;, property = &quot;name&quot;), </span></span><br><span class="line"><span class="meta">            @Result(column = &quot;email&quot;, property = &quot;email&quot;), </span></span><br><span class="line"><span class="meta">            @Result(property = &quot;address&quot;, column = &quot;addr_id&quot;, </span></span><br><span class="line"><span class="meta">                    one = @One(select = &quot;com.briup.mappers.Student Mapper.findAddressById&quot;)) </span></span><br><span class="line"><span class="meta">    &#125;)</span> </span><br><span class="line">    <span class="function">Student <span class="title">selectStudentWithAddress</span><span class="params">(<span class="keyword">int</span> studId)</span></span>; </span><br><span class="line">&#125; </span><br><span class="line">	</span><br></pre></td></tr></table></figure>

<p>这里使用了<code>@One</code>注解的select属性来指定一个方法，该方法会返回一个Address对象。</p>
<p>使用column=”addr_id”,则STUEDNTS表中列addr_id的值将会作为输入参数传递给findAddressById()方法。</p>
<p>如果 <code>@One</code> SELECT查询返回了多行结果，则会抛出TooManyResultsException异常。</p>
<p>测试代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> studId = <span class="number">1</span>; </span><br><span class="line">StudentMapper studentMapper = sqlSession.getMapper(StudentMapper.class); </span><br><span class="line">Student student = studentMapper.selectStudentWithAddress(studId); </span><br><span class="line">System.out.println(<span class="string">&quot;Student :&quot;</span>+student); </span><br><span class="line">System.out.println(<span class="string">&quot;Address :&quot;</span>+student.getAddress()); </span><br></pre></td></tr></table></figure>





<p>之前可以通过基于XML的映射配置，使用嵌套结果ResultMap来加载一对一关联的查询。而MyBatis当前版本中，并没有对应的注解支持。</p>
<p>但是可以在映射文件中把1对1的嵌套结果形式的映射信息配置好，然后在@ResultMap注解中去引用它。</p>
<p>在StudentMapper.xml中配置<code>&lt;resultMap&gt;</code>，如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.briup.mappers.StudentMapper&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Address&quot;</span> <span class="attr">id</span>=<span class="string">&quot;AddressResult&quot;</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;addrId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;addr_id&quot;</span> /&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;street&quot;</span> <span class="attr">column</span>=<span class="string">&quot;street&quot;</span> /&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;city&quot;</span> <span class="attr">column</span>=<span class="string">&quot;city&quot;</span> /&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;state&quot;</span> <span class="attr">column</span>=<span class="string">&quot;state&quot;</span> /&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;zip&quot;</span> <span class="attr">column</span>=<span class="string">&quot;zip&quot;</span> /&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;country&quot;</span> <span class="attr">column</span>=<span class="string">&quot;country&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Student&quot;</span> <span class="attr">id</span>=<span class="string">&quot;StudentWithAddressResult&quot;</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;studId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> /&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> /&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> /&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;address&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;AddressResult&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span> </span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentMapper</span></span>&#123; </span><br><span class="line">		<span class="meta">@Select(&quot;select stud_id, name, email, a.addr_id, street, city, state, zip, country&quot; + &quot; FROM students s left outer join addresses a on s.addr_id=a.addr_id&quot; + &quot; where stud_id=#&#123;studId&#125; &quot;)</span> </span><br><span class="line">		<span class="meta">@ResultMap(&quot;com.briup.mappers.StudentMapper.StudentWithAddressResult&quot;)</span> </span><br><span class="line">		<span class="function">Student <span class="title">selectStudentWithAddress</span><span class="params">(<span class="keyword">int</span> id)</span></span>; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>



<h3 id="3-5-一对多"><a href="#3-5-一对多" class="headerlink" title="3.5 一对多"></a>3.5 一对多</h3><p>MyBatis提供了<code>@Many</code>注解，用来使用嵌套Select语句加载一对多关联查询。</p>
<p>例如，使用<code>@Many</code>注解获取一个讲师及其教授课程列表信息：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TutorMapper</span></span>&#123; </span><br><span class="line">	<span class="meta">@Select(&quot;select addr_id as addrId, street, city, state, zip, </span></span><br><span class="line"><span class="meta">			country from addresses where addr_id=#&#123;id&#125;&quot;)</span> </span><br><span class="line">	<span class="function">Address <span class="title">findAddressById</span><span class="params">(<span class="keyword">int</span> id)</span></span>; </span><br><span class="line"></span><br><span class="line">	<span class="meta">@Select(&quot;select * from courses where tutor_id=#&#123;tutorId&#125;&quot;)</span> </span><br><span class="line">	<span class="meta">@Results( </span></span><br><span class="line"><span class="meta">	&#123; </span></span><br><span class="line"><span class="meta">		@Result(id = true, column = &quot;course_id&quot;, property = &quot;courseId&quot;), </span></span><br><span class="line"><span class="meta">		@Result(column = &quot;name&quot;, property = &quot;name&quot;), </span></span><br><span class="line"><span class="meta">		@Result(column = &quot;description&quot;, property = &quot;description&quot;), </span></span><br><span class="line"><span class="meta">		@Result(column = &quot;start_date&quot; property = &quot;startDate&quot;), </span></span><br><span class="line"><span class="meta">		@Result(column = &quot;end_date&quot; property = &quot;endDate&quot;) </span></span><br><span class="line"><span class="meta">	&#125;)</span> </span><br><span class="line">	<span class="function">List&lt;Course&gt; <span class="title">findCoursesByTutorId</span><span class="params">(<span class="keyword">int</span> tutorId)</span></span>; </span><br><span class="line"></span><br><span class="line">	<span class="meta">@Select(&quot;SELECT tutor_id, name as tutor_name, email, addr_id </span></span><br><span class="line"><span class="meta">			FROM tutors where tutor_id=#&#123;tutorId&#125;&quot;)</span> </span><br><span class="line">	<span class="meta">@Results( </span></span><br><span class="line"><span class="meta">	&#123; </span></span><br><span class="line"><span class="meta">		@Result(id = true, column = &quot;tutor_id&quot;, property = &quot;tutorId&quot;), </span></span><br><span class="line"><span class="meta">		@Result(column = &quot;tutor_name&quot;, property = &quot;name&quot;), </span></span><br><span class="line"><span class="meta">		@Result(column = &quot;email&quot;, property = &quot;email&quot;), </span></span><br><span class="line"><span class="meta">		@Result(property = &quot;address&quot;, column = &quot;addr_id&quot;, </span></span><br><span class="line"><span class="meta">		one = @One(select = &quot;com.briup.mappers.TutorMapper.findAddressById&quot;)), </span></span><br><span class="line"><span class="meta">		@Result(property = &quot;courses&quot;, column = &quot;tutor_id&quot;, </span></span><br><span class="line"><span class="meta">		many = @Many(select = &quot;com.briup.mappers.TutorMapper.findCoursesByTutorId&quot;)) </span></span><br><span class="line"><span class="meta">	&#125;)</span> </span><br><span class="line">	<span class="function">Tutor <span class="title">findTutorById</span><span class="params">(<span class="keyword">int</span> tutorId)</span></span>; </span><br><span class="line">&#125; </span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<p> 这里使用了<code>@Many</code>注解的select属性来指向一个方法，该方法将返回一个<code>List&lt;Course&gt;</code>对象。</p>
<p>使用column=”tutor_id”，TUTORS表中的tutor_id列值将会作为输入参数传递给findCoursesByTutorId()方法。 </p>
<p>之前可以通过基于XML的映射配置，使用嵌套结果ResultMap来加载一对N关联的查询。而MyBatis当前版本，并没有对应的注解支持。</p>
<p>但是可以在映射文件中把1对N的嵌套结果形式的映射信息配置好，然后在<code>@ResultMap</code>注解中去引用它。</p>
<p>例如，在TutorMapper.xml中配置<code>&lt;resultMap&gt;</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.briup.mappers.Tutor Mapper&quot;</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Address&quot;</span> <span class="attr">id</span>=<span class="string">&quot;AddressResult&quot;</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;addrId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;addr_id&quot;</span> /&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;street&quot;</span> <span class="attr">column</span>=<span class="string">&quot;street&quot;</span> /&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;city&quot;</span> <span class="attr">column</span>=<span class="string">&quot;city&quot;</span> /&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;state&quot;</span> <span class="attr">column</span>=<span class="string">&quot;state&quot;</span> /&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;zip&quot;</span> <span class="attr">column</span>=<span class="string">&quot;zip&quot;</span> /&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;country&quot;</span> <span class="attr">column</span>=<span class="string">&quot;country&quot;</span> /&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Course&quot;</span> <span class="attr">id</span>=<span class="string">&quot;CourseResult&quot;</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;course_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;course Id&quot;</span> /&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> /&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;description&quot;</span> <span class="attr">property</span>=<span class="string">&quot;description&quot;</span> /&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;start_date&quot;</span> <span class="attr">property</span>=<span class="string">&quot;startDate&quot;</span> /&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;end_date&quot;</span> <span class="attr">property</span>=<span class="string">&quot;endDate&quot;</span> /&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Tutor&quot;</span> <span class="attr">id</span>=<span class="string">&quot;TutorResult&quot;</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;tutor_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;tutorId&quot;</span> /&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;tutor_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> /&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> /&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;address&quot;</span> <span class="attr">result</span> <span class="attr">Map</span>=<span class="string">&quot;AddressResult&quot;</span> /&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;courses&quot;</span> <span class="attr">result</span> <span class="attr">Map</span>=<span class="string">&quot;CourseResult&quot;</span> /&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TutorMapper</span></span>&#123; </span><br><span class="line">	<span class="meta">@Select(&quot;select t.tutor_id, t.name as tutor_name,email,a.addr_id, street, city, state, zip, country, course_id, c.name,description, start_date, end_date  from tutors t left outer join addresses a on t.addr_id=a.addr_id left outer join courses c on t.tutor_id=c.tutor_id where t.tutor_id=#&#123;tutorId&#125;&quot;)</span> </span><br><span class="line">	<span class="meta">@ResultMap(&quot;com.briup.mappers.TutorMapper.TutorResult&quot;)</span> </span><br><span class="line">	<span class="function">Tutor <span class="title">selectTutorById</span><span class="params">(<span class="keyword">int</span> tutorId)</span></span>; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

















 
      <!-- reward -->
      
      <div id="reword-out">
        <div id="reward-btn">
          打赏
        </div>
      </div>
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/briup/" rel="tag">briup</a></li></ul>

    </footer>
  </div>

   
  <nav class="article-nav">
    
      <a href="/archives/briup/briup-spring.html" class="article-nav-link">
        <strong class="article-nav-caption">上一篇</strong>
        <div class="article-nav-title">
          
            briup-spring
          
        </div>
      </a>
    
    
      <a href="/archives/briup/briup-ajax.html" class="article-nav-link">
        <strong class="article-nav-caption">下一篇</strong>
        <div class="article-nav-title">briup-ajax</div>
      </a>
    
  </nav>

  
   
<div class="gitalk" id="gitalk-container"></div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css">


<script src="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js"></script>


<script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script>

<script type="text/javascript">
  var gitalk = new Gitalk({
    clientID: 'abdf20cf8f71fc88e695',
    clientSecret: '050f9f7209fbd2e9f446fb0ade695e4e5dd12e84',
    repo: 'hexo_comment',
    owner: 'wangsidandan',
    admin: ['wangsidandan'],
    // id: location.pathname,      // Ensure uniqueness and length less than 50
    id: md5(location.pathname),
    distractionFreeMode: false,  // Facebook-like distraction free mode
    pagerDirection: 'last'
  })

  gitalk.render('gitalk-container')
</script>

     
</article>

</section>
      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2015-2022
        <i class="ri-heart-fill heart_icon"></i> vanse
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>访问人数:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>浏览次数:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.svg" alt="vanse"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/playlist">音乐</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/photos">相册</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/friends">友链</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="https://gitee.com/vanse/images/raw/master/bruip_course/aliapy.png">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="https://gitee.com/vanse/images/raw/master/bruip_course/wechat.png">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->
 
<script src="/js/tocbot.min.js"></script>

<script>
  tocbot.init({
    tocSelector: ".tocbot",
    contentSelector: ".article-entry",
    headingSelector: "h1, h2, h3, h4, h5, h6",
    hasInnerContainers: true,
    scrollSmooth: true,
    scrollContainer: "main",
    positionFixedSelector: ".tocbot",
    positionFixedClass: "is-position-fixed",
    fixedSidebarOffset: "auto",
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script>

<script src="/js/clickBoom1.js"></script>
 
<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->
 
<script src="/js/dz.js"></script>
 
<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    <div id="music">
    
    
    
    <iframe frameborder="no" border="1" marginwidth="0" marginheight="0" width="200" height="52"
        src="//music.163.com/outchain/player?type=2&id=506654324&auto=0&height=32"></iframe>
</div>

<style>
    #music {
        position: fixed;
        right: 15px;
        bottom: 0;
        z-index: 998;
    }
</style>
    
    
<script>
  const password = "vanse";
  const lock_password = window.sessionStorage.getItem("lock_password");
  console.log(password, lock_password);
  if (lock_password !== password) {
    Swal.fire({
      title: "请输入访问密码",
      input: "password",
      inputAttributes: {
        autocapitalize: "off",
      },
      showCancelButton: false,
      showLoaderOnConfirm: true,
      allowOutsideClick: false,
      confirmButtonText: "确定",
    }).then((result) => {
      console.log(result);
      if (result.isConfirmed) {
        console.log(password);
        if (result.value === password) {
          window.sessionStorage.setItem("lock_password", result.value);
        } else {
          Swal.fire({
            icon: "error",
            title: "密码错误，请重试",
            confirmButtonText: "确定",
            allowOutsideClick: false,
          }).then(() => {
            window.location.reload();
          });
        }
      }
    });
  }
</script>


  </div>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>

</html>