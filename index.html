<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
        
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title> vanse</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/favicon.ico" />
       
<link rel="stylesheet" href="/dist/main.css">

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/css/remixicon.min.css"
      />
      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
       
 

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    </head>
  </html>
</html>


<body>
  <div id="app">
    
      <canvas class="fireworks"></canvas>
      <style>
        .fireworks {
          position: fixed;
          left: 0;
          top: 0;
          z-index: 99999;
          pointer-events: none;
        }
      </style>
      
      
    <main class="content on">
      
<section class="cover">
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="https://raw.githubusercontent.com/wangsidandan/blog_images/main/system/202205132245403.jpg" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">vanse</a></h1>
      <div id="subtitle-box">
        
        <span id="subtitle"></span>
        
      </div>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js"></script>


<!-- Subtitle -->

  <script>
    try {
      var typed = new Typed("#subtitle", {
        strings: ['你好啊！', '愿你一生努力，一生被爱', '想要的都拥有，得不到的都释怀'],
        startDelay: 0,
        typeSpeed: 200,
        loop: true,
        backSpeed: 100,
        showCursor: true
      });
    } catch (err) {
      console.log(err)
    }
  </script>
  
<div id="main">
  <section class="outer">
  
  
  

<div class="notice" style="margin-top:50px">
    <i class="ri-heart-fill"></i>
    <div class="notice-content" id="broad"></div>
</div>
<script type="text/javascript">
    fetch('https://v1.hitokoto.cn')
        .then(response => response.json())
        .then(data => {
            document.getElementById("broad").innerHTML = data.hitokoto;
        })
        .catch(console.error)
</script>

<style>
    .notice {
        padding: 20px;
        border: 1px dashed #e6e6e6;
        color: #969696;
        position: relative;
        display: inline-block;
        width: 100%;
        background: #fbfbfb50;
        border-radius: 10px;
    }

    .notice i {
        float: left;
        color: #999;
        font-size: 16px;
        padding-right: 10px;
        vertical-align: middle;
        margin-top: -2px;
    }

    .notice-content {
        display: initial;
        vertical-align: middle;
    }
</style>
  
  <article class="articles">
    
    
    
    
    <article
  id="post-project/briup-estore"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/archives/project/briup-estore.html"
    >briup-estore</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/archives/project/briup-estore.html" class="article-date">
  <time datetime="2022-05-30T23:35:48.000Z" itemprop="datePublished">2022-05-31</time>
</a>    
    </div>
     
	
	 
	
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="0-前言"><a href="#0-前言" class="headerlink" title="0 前言"></a>0 前言</h1><ul>
<li>项目: 网上书城</li>
<li>开发工具: idea2019</li>
<li>环境: jdk8/mysql5.5</li>
<li>技术: servlet+mybatis</li>
<li>班级: 山西农大2018</li>
<li>整理人: vanse(刘聪)</li>
</ul>
<p><strong>项目完成度</strong></p>
<ul>
<li><input checked="" disabled="" type="checkbox"> 业务流程</li>
<li><input disabled="" type="checkbox"> 首页相关功能</li>
<li><input checked="" disabled="" type="checkbox"> 沙箱支付</li>
<li><input checked="" disabled="" type="checkbox"> linux部署</li>
</ul>
<h1 id="1-项目分析"><a href="#1-项目分析" class="headerlink" title="1 项目分析"></a>1 项目分析</h1><h2 id="表分析"><a href="#表分析" class="headerlink" title="表分析"></a>表分析</h2><blockquote>
<p>所有表都没有物理外键，而是逻辑外键</p>
</blockquote>
<h3 id="es-customer"><a href="#es-customer" class="headerlink" title="es_customer"></a>es_customer</h3><ul>
<li>顾客表 一个顾客有一个地址</li>
</ul>
<h3 id="es-shopaddress"><a href="#es-shopaddress" class="headerlink" title="es_shopaddress"></a>es_shopaddress</h3><ul>
<li>地址表 顾客外键</li>
</ul>
<h3 id="es-category"><a href="#es-category" class="headerlink" title="es_category"></a>es_category</h3><ul>
<li>商品分类表 一个分类有多个商品</li>
<li>一级分类/二级分类(自关联)<ul>
<li>二级分类的parentId是一级分类的id</li>
<li>一级分类: ==select * from category where parent_id = 0==</li>
<li>二级分类: ==select * from category where parent_id = 一级分类id*==</li>
</ul>
</li>
</ul>
<h3 id="es-book"><a href="#es-book" class="headerlink" title="es_book"></a>es_book</h3><ul>
<li>商品表  分类外键</li>
</ul>
<h3 id="es-orderline"><a href="#es-orderline" class="headerlink" title="es_orderline"></a>es_orderline</h3><ul>
<li>订单项 购买一次就是一个订单项</li>
</ul>
<h3 id="es-order"><a href="#es-order" class="headerlink" title="es_order"></a>es_order</h3><ul>
<li>订单 一个订单有多个订单项</li>
</ul>
<h3 id="导入表"><a href="#导入表" class="headerlink" title="导入表"></a>导入表</h3><p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310737123.png" alt="image-20210909101745687"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS<span class="operator">=</span><span class="number">0</span>;</span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for es_customer</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `es_customer`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `es_customer` (</span><br><span class="line">	`id` <span class="type">int</span>(<span class="number">7</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;客户id&#x27;</span>,</span><br><span class="line">	`name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;客户名字&#x27;</span>,</span><br><span class="line">	`password` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;客户密码&#x27;</span>,</span><br><span class="line">	`zipCode` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;客户邮编&#x27;</span>,</span><br><span class="line">	`address` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;客户地址&#x27;</span>,</span><br><span class="line">	`telephone` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;客户电话&#x27;</span>,</span><br><span class="line">	`email` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;客户邮箱&#x27;</span>,</span><br><span class="line">	<span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">	)ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">22</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for es_book</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `es_book`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `es_book` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;书籍编号&#x27;</span>,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;书籍名字&#x27;</span>,</span><br><span class="line">  `price` <span class="keyword">double</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;书籍价格&#x27;</span>,</span><br><span class="line">  `author` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;书籍作者&#x27;</span>,</span><br><span class="line">  `publisher` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;书籍出版社&#x27;</span>,</span><br><span class="line">  `pubDate` <span class="type">date</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;发布时间&#x27;</span>,</span><br><span class="line">  `description` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;书籍描述&#x27;</span>,</span><br><span class="line">  `category_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;分类id&#x27;</span>,</span><br><span class="line">  `image` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;书籍图片&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">22</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Records of es_book</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_book` <span class="keyword">VALUES</span> (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;别做傻瓜&#x27;</span>, <span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;作者张三&#x27;</span>, <span class="string">&#x27;清华大学出版社&#x27;</span>, <span class="string">&#x27;2010-10-07&#x27;</span>, <span class="string">&#x27;文学1类&#x27;</span>, <span class="string">&#x27;8&#x27;</span>,<span class="string">&#x27;bookcover/别做傻瓜.jpg&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_book` <span class="keyword">VALUES</span> (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;沉思录&#x27;</span>, <span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;作者张三&#x27;</span>, <span class="string">&#x27;长春工业出版社&#x27;</span>, <span class="string">&#x27;2010-10-07&#x27;</span>, <span class="string">&#x27;文学2类&#x27;</span>, <span class="string">&#x27;9&#x27;</span>,<span class="string">&#x27;bookcover/沉思录.jpg&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_book` <span class="keyword">VALUES</span> (<span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;感悟&#x27;</span>, <span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;作者张三&#x27;</span>, <span class="string">&#x27;清华大学出版社&#x27;</span>, <span class="string">&#x27;2010-10-07&#x27;</span>, <span class="string">&#x27;文学3类&#x27;</span>, <span class="string">&#x27;10&#x27;</span>,<span class="string">&#x27;bookcover/感悟.jpg&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_book` <span class="keyword">VALUES</span> (<span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;谁动了我的奶酪&#x27;</span>, <span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;作者张三&#x27;</span>, <span class="string">&#x27;长春工业出版社&#x27;</span>, <span class="string">&#x27;2010-10-07&#x27;</span>, <span class="string">&#x27;社会科学1类&#x27;</span>, <span class="string">&#x27;11&#x27;</span>,<span class="string">&#x27;bookcover/谁动了我的奶酪.jpg&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_book` <span class="keyword">VALUES</span> (<span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;大勇和小花&#x27;</span>, <span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;作者张三&#x27;</span>, <span class="string">&#x27;清华大学出版社&#x27;</span>, <span class="string">&#x27;2010-10-07&#x27;</span>, <span class="string">&#x27;社会科学2类&#x27;</span>, <span class="string">&#x27;12&#x27;</span>,<span class="string">&#x27;bookcover/大勇和小花.jpg&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_book` <span class="keyword">VALUES</span> (<span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;学会宽容&#x27;</span>, <span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;作者张三&#x27;</span>, <span class="string">&#x27;北京大学出版社&#x27;</span>, <span class="string">&#x27;2010-10-07&#x27;</span>, <span class="string">&#x27;社会科学3类&#x27;</span>, <span class="string">&#x27;13&#x27;</span>,<span class="string">&#x27;bookcover/学会宽容.jpg&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_book` <span class="keyword">VALUES</span> (<span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;大勇和小花的欧洲日记&#x27;</span>, <span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;作者张三&#x27;</span>, <span class="string">&#x27;四川大学出版社&#x27;</span>, <span class="string">&#x27;2010-10-07&#x27;</span>, <span class="string">&#x27;小说1类&#x27;</span>, <span class="string">&#x27;14&#x27;</span>,<span class="string">&#x27;bookcover/大勇和小花的欧洲日记.jpg&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_book` <span class="keyword">VALUES</span> (<span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;培育男孩&#x27;</span>, <span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;作者张三&#x27;</span>, <span class="string">&#x27;西安交大出版社&#x27;</span>, <span class="string">&#x27;2007-10-07&#x27;</span>, <span class="string">&#x27;小说2类&#x27;</span>, <span class="string">&#x27;15&#x27;</span>,<span class="string">&#x27;bookcover/培育男孩.jpg&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_book` <span class="keyword">VALUES</span> (<span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;鱼的意大利旅行&#x27;</span>, <span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;作者张三&#x27;</span>, <span class="string">&#x27;北京大学出版社&#x27;</span>, <span class="string">&#x27;2010-10-07&#x27;</span>, <span class="string">&#x27;小说3类&#x27;</span>, <span class="string">&#x27;16&#x27;</span>,<span class="string">&#x27;bookcover/鱼的意大利旅行.jpg&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_book` <span class="keyword">VALUES</span> (<span class="string">&#x27;10&#x27;</span>, <span class="string">&#x27;嵌入式Linux&#x27;</span>, <span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;作者张三&#x27;</span>, <span class="string">&#x27;北京工业大学出版社&#x27;</span>, <span class="string">&#x27;2010-10-07&#x27;</span>, <span class="string">&#x27;计算机1类&#x27;</span>, <span class="string">&#x27;17&#x27;</span>,<span class="string">&#x27;bookcover/嵌入式Linux.jpg&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_book` <span class="keyword">VALUES</span> (<span class="string">&#x27;11&#x27;</span>, <span class="string">&#x27;数据库原理&#x27;</span>, <span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;作者张三&#x27;</span>, <span class="string">&#x27;厦门大学出版社&#x27;</span>, <span class="string">&#x27;2009-10-07&#x27;</span>, <span class="string">&#x27;计算机2类&#x27;</span>, <span class="string">&#x27;18&#x27;</span>, <span class="string">&#x27;bookcover/数据库原理.jpg&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_book` <span class="keyword">VALUES</span> (<span class="string">&#x27;12&#x27;</span>, <span class="string">&#x27;深入浅出Oracle&#x27;</span>, <span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;作者张三&#x27;</span>, <span class="string">&#x27;北京大学出版社&#x27;</span>, <span class="string">&#x27;2010-10-07&#x27;</span>, <span class="string">&#x27;计算机3类&#x27;</span>, <span class="string">&#x27;19&#x27;</span>,<span class="string">&#x27;bookcover/深入浅出Oracle.jpg&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_book` <span class="keyword">VALUES</span> (<span class="string">&#x27;13&#x27;</span>, <span class="string">&#x27;杜拉拉&#x27;</span>, <span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;作者张三&#x27;</span>, <span class="string">&#x27;上海交大出版社&#x27;</span>, <span class="string">&#x27;2010-10-07&#x27;</span>, <span class="string">&#x27;传记1类&#x27;</span>, <span class="string">&#x27;20&#x27;</span>,<span class="string">&#x27;bookcover/杜拉拉.jpg&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_book` <span class="keyword">VALUES</span> (<span class="string">&#x27;14&#x27;</span>, <span class="string">&#x27;oneplant&#x27;</span>, <span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;作者张三&#x27;</span>, <span class="string">&#x27;北京工业大学出版社&#x27;</span>, <span class="string">&#x27;2015-10-07&#x27;</span>, <span class="string">&#x27;传记2类&#x27;</span>, <span class="string">&#x27;21&#x27;</span>,<span class="string">&#x27;bookcover/oneplant.jpg&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_book` <span class="keyword">VALUES</span> (<span class="string">&#x27;15&#x27;</span>, <span class="string">&#x27;大勇和小花&#x27;</span>, <span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;作者张三&#x27;</span>, <span class="string">&#x27;中南大学出版社&#x27;</span>, <span class="string">&#x27;2010-10-07&#x27;</span>, <span class="string">&#x27;传记3类&#x27;</span>, <span class="string">&#x27;22&#x27;</span>,<span class="string">&#x27;bookcover/大勇和小花.jpg&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_book` <span class="keyword">VALUES</span> (<span class="string">&#x27;16&#x27;</span>, <span class="string">&#x27;搭地铁玩上海&#x27;</span>, <span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;作者张三&#x27;</span>, <span class="string">&#x27;复旦大学出版社&#x27;</span>, <span class="string">&#x27;2017-10-07&#x27;</span>, <span class="string">&#x27;历史1类&#x27;</span>, <span class="string">&#x27;23&#x27;</span>,<span class="string">&#x27;bookcover/搭地铁玩上海.jpg&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_book` <span class="keyword">VALUES</span> (<span class="string">&#x27;17&#x27;</span>, <span class="string">&#x27;中国国家地理&#x27;</span>, <span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;作者张三&#x27;</span>, <span class="string">&#x27;中国海洋大学出版社&#x27;</span>, <span class="string">&#x27;2022-10-07&#x27;</span>, <span class="string">&#x27;历史2类&#x27;</span>, <span class="string">&#x27;24&#x27;</span>,<span class="string">&#x27;bookcover/中国国家地理.jpg&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_book` <span class="keyword">VALUES</span> (<span class="string">&#x27;18&#x27;</span>, <span class="string">&#x27;中国自主游&#x27;</span>, <span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;作者张三&#x27;</span>, <span class="string">&#x27;华中师范出版社&#x27;</span>, <span class="string">&#x27;2010-10-07&#x27;</span>, <span class="string">&#x27;历史3类&#x27;</span>, <span class="string">&#x27;25&#x27;</span>,<span class="string">&#x27;bookcover/中国自主游.jpg&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_book` <span class="keyword">VALUES</span> (<span class="string">&#x27;19&#x27;</span>, <span class="string">&#x27;Don\&#x27;</span>tMakeMeThink<span class="string">&#x27;, &#x27;</span><span class="number">20</span><span class="string">&#x27;, &#x27;</span>作者张三<span class="string">&#x27;, &#x27;</span>复旦大学出版社<span class="string">&#x27;, &#x27;</span><span class="number">2010</span><span class="number">-10</span><span class="number">-07</span><span class="string">&#x27;, &#x27;</span>文学<span class="number">1</span>类<span class="string">&#x27;, &#x27;</span><span class="number">26</span><span class="string">&#x27;,&#x27;</span>bookcover<span class="operator">/</span>Don\<span class="string">&#x27;tMakeMeThink.jpg&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_book` <span class="keyword">VALUES</span> (<span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;CodeGreen&#x27;</span>, <span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;作者张三&#x27;</span>, <span class="string">&#x27;华中师范出版社&#x27;</span>, <span class="string">&#x27;2010-10-07&#x27;</span>, <span class="string">&#x27;文学2类&#x27;</span>, <span class="string">&#x27;27&#x27;</span>,<span class="string">&#x27;bookcover/CodeGreen.jpg&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_book` <span class="keyword">VALUES</span> (<span class="string">&#x27;21&#x27;</span>, <span class="string">&#x27;travelbook&#x27;</span>, <span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;作者张三&#x27;</span>, <span class="string">&#x27;中国海洋大学出版社&#x27;</span>, <span class="string">&#x27;2010-10-07&#x27;</span>, <span class="string">&#x27;文学3类&#x27;</span>, <span class="string">&#x27;28&#x27;</span>,<span class="string">&#x27;bookcover/travelbook.jpg&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for es_category</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `es_category`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `es_category` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;书籍分类id&#x27;</span>,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;书籍分类名字&#x27;</span>,</span><br><span class="line">  `description` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;书籍分类描述&#x27;</span>,</span><br><span class="line">  `parent_id` <span class="type">int</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;父类id&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  KEY `parent_id` (`parent_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">29</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Records of es_category</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;文学&#x27;</span>, <span class="string">&#x27;文学的描述&#x27;</span>, <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;社会科学&#x27;</span>, <span class="string">&#x27;社会科学的描述&#x27;</span>, <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;计算机与互联网&#x27;</span>, <span class="string">&#x27;计算机与互联网的描述&#x27;</span>, <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;小说&#x27;</span>, <span class="string">&#x27;小说的描述&#x27;</span>, <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;传记&#x27;</span>, <span class="string">&#x27;传记的描述&#x27;</span>, <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;历史&#x27;</span>, <span class="string">&#x27;历史的描述&#x27;</span>, <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;医学&#x27;</span>, <span class="string">&#x27;医学的描述&#x27;</span>, <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;文学1类&#x27;</span>, <span class="string">&#x27;文学1类的描述&#x27;</span>, <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;文学2类&#x27;</span>, <span class="string">&#x27;文学2类的描述&#x27;</span>, <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;10&#x27;</span>, <span class="string">&#x27;文学3类&#x27;</span>, <span class="string">&#x27;文学3类的描述&#x27;</span>, <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;11&#x27;</span>, <span class="string">&#x27;社会科学1&#x27;</span>, <span class="string">&#x27;社会科学1类的描述&#x27;</span>, <span class="string">&#x27;2&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;12&#x27;</span>, <span class="string">&#x27;社会科学2&#x27;</span>, <span class="string">&#x27;社会科学2类的描述&#x27;</span>, <span class="string">&#x27;2&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;13&#x27;</span>, <span class="string">&#x27;社会科学3&#x27;</span>, <span class="string">&#x27;社会科学3类的描述&#x27;</span>, <span class="string">&#x27;2&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;14&#x27;</span>, <span class="string">&#x27;小说1&#x27;</span>, <span class="string">&#x27;小说1类的描述&#x27;</span>, <span class="string">&#x27;3&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;15&#x27;</span>, <span class="string">&#x27;小说2&#x27;</span>, <span class="string">&#x27;小说2类的描述&#x27;</span>, <span class="string">&#x27;3&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;16&#x27;</span>, <span class="string">&#x27;小说3&#x27;</span>, <span class="string">&#x27;小说3类的描述&#x27;</span>, <span class="string">&#x27;3&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;17&#x27;</span>, <span class="string">&#x27;计算机1&#x27;</span>, <span class="string">&#x27;计算机1类的描述&#x27;</span>, <span class="string">&#x27;4&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;18&#x27;</span>, <span class="string">&#x27;计算机2&#x27;</span>, <span class="string">&#x27;计算机2类的描述&#x27;</span>, <span class="string">&#x27;4&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;19&#x27;</span>, <span class="string">&#x27;计算机3&#x27;</span>, <span class="string">&#x27;计算机3类的描述&#x27;</span>, <span class="string">&#x27;4&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;传记1&#x27;</span>, <span class="string">&#x27;传记1类的描述&#x27;</span>, <span class="string">&#x27;5&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;21&#x27;</span>, <span class="string">&#x27;传记2&#x27;</span>, <span class="string">&#x27;传记2类的描述&#x27;</span>, <span class="string">&#x27;5&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;22&#x27;</span>, <span class="string">&#x27;传记3&#x27;</span>, <span class="string">&#x27;传记3类的描述&#x27;</span>, <span class="string">&#x27;5&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;23&#x27;</span>, <span class="string">&#x27;历史类1&#x27;</span>, <span class="string">&#x27;历史1类的描述&#x27;</span>, <span class="string">&#x27;6&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;24&#x27;</span>, <span class="string">&#x27;历史类2&#x27;</span>, <span class="string">&#x27;历史2类的描述&#x27;</span>, <span class="string">&#x27;6&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;25&#x27;</span>, <span class="string">&#x27;历史类3&#x27;</span>, <span class="string">&#x27;历史3类的描述&#x27;</span>, <span class="string">&#x27;6&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;26&#x27;</span>, <span class="string">&#x27;医学类1&#x27;</span>, <span class="string">&#x27;医学类1的描述&#x27;</span>, <span class="string">&#x27;7&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;27&#x27;</span>, <span class="string">&#x27;医学类2&#x27;</span>, <span class="string">&#x27;医学2类的描述&#x27;</span>, <span class="string">&#x27;7&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `es_category` <span class="keyword">VALUES</span> (<span class="string">&#x27;28&#x27;</span>, <span class="string">&#x27;医学类3&#x27;</span>, <span class="string">&#x27;医学3类的描述&#x27;</span>, <span class="string">&#x27;7&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for es_orderform</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `es_orderform`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `es_orderform` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;订单id&#x27;</span>,</span><br><span class="line">  `cost` <span class="keyword">double</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;订单花费&#x27;</span>,</span><br><span class="line">  `orderDate` <span class="type">date</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;订单时间&#x27;</span>,</span><br><span class="line">  `shopAddress_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;收获地址id&#x27;</span>,</span><br><span class="line">  `customer_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;客户id&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Records of es_orderform</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for es_orderLine</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `es_orderline`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `es_orderline` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;订单项id&#x27;</span>,</span><br><span class="line">  `num` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;商品数量&#x27;</span>,</span><br><span class="line">  `cost` <span class="keyword">double</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;订单项花费&#x27;</span>,</span><br><span class="line">  `book_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;书籍id&#x27;</span>,</span><br><span class="line">  `orderForm_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;订单id&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Records of es_orderLine</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for es_shopAddress</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `es_shopaddress`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `es_shopaddress` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;收货地址id&#x27;</span>,</span><br><span class="line">  `receiveName` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;收货人姓名&#x27;</span>,</span><br><span class="line">  `address` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;收获地址&#x27;</span>,</span><br><span class="line">  `phone` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;收获电话&#x27;</span>,</span><br><span class="line">  `customer_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;客户id&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------a</span></span><br><span class="line"><span class="comment">-- Records of es_shopddress</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h2><p>1.选择骨架</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310738044.png" alt="image-20210909102255356"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310738895.png" alt="image-20210909102357621"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310738269.png" alt="image-20210909102441644"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310738705.png" alt="image-20210909102503907"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310738548.png" alt="image-20210909102607551"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310738030.png" alt="image-20210909102802026"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310738488.png" alt="image-20210909102933930"></p>
<ul>
<li>java -&gt; Sources Root</li>
<li>resources-&gt; Resources Root</li>
</ul>
<p><code>2.pom.xml</code></p>
<blockquote>
<p>注意: 如果是mysql8 最好使用mysql8的驱动</p>
<p>同时: 驱动为 com.mysql.cj.jdbc.Driver</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.briup<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>estore-nongda<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>estore-nongda Maven Webapp<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 引入servlet3.1的依赖 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 引入jstl的依赖，jsp页面中会使用到 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 引入Mybatis的依赖 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 数据库mysql的驱动包依赖 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.38<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        &lt;dependency&gt;</span></span><br><span class="line"><span class="comment">            &lt;groupId&gt;com.oracle&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">            &lt;artifactId&gt;ojdbc8&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">            &lt;version&gt;8&lt;/version&gt;</span></span><br><span class="line"><span class="comment">        &lt;/dependency&gt;</span></span><br><span class="line"><span class="comment">         --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 日志框架log4j的依赖 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>完善结构</code></p>
<img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310738994.png" alt="image-20211025195927702" style="zoom:50%;" />





<h2 id="配置tomcat"><a href="#配置tomcat" class="headerlink" title="配置tomcat"></a>配置tomcat</h2><p><code>添加tomcat</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310738593.png" alt="image-20210909111027889"></p>
<p><code>部署项目到tomcat</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310738028.png" alt="image-20210909111300375"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310738875.png" alt="image-20210909111319079"></p>
<p><code>配置项目部署路径</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310738303.png" alt="image-20210909111353934"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310738305.png" alt="image-20210909111518671"></p>
<p><code>启动tomcat</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310738543.png" alt="image-20210909111604743"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310739392.png" alt="image-20210909144741405"></p>
<h1 id="2-顾客模块"><a href="#2-顾客模块" class="headerlink" title="2 顾客模块"></a>2 顾客模块</h1><h2 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h2><h3 id="分析"><a href="#分析" class="headerlink" title="==分析=="></a>==分析==</h3><ul>
<li>获取界面数据<ul>
<li>判断name是否为空</li>
<li>判断name是否存在</li>
</ul>
</li>
<li>注册用户<ul>
<li>正常: 跳转登录页面</li>
<li>错误: 获取错误信息,重新注册页面</li>
</ul>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310739162.png" alt="image-20210910094134124"></p>
<h3 id="RegisterServlet"><a href="#RegisterServlet" class="headerlink" title="RegisterServlet"></a>RegisterServlet</h3><blockquote>
<p>注意: 不同的请求方式可以访问同一接口有不同功能</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Customer;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.CustomerService;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.impl.CustomerServiceImpl;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.beanutils.BeanUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/9-09-09-14:13</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：注册API</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/register&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RegisterServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="comment">// get 访问regiser 跳转register.jsp页面</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        req.getRequestDispatcher(<span class="string">&quot;/register.jsp&quot;</span>).forward(req,resp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// post访问regiser 提交数据</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 获取customer数据</span></span><br><span class="line">       <span class="comment">// String name = req.getParameter(&quot;name&quot;);</span></span><br><span class="line">        Map&lt;String, String[]&gt; map = req.getParameterMap();</span><br><span class="line">        Customer customer = <span class="keyword">new</span> Customer();</span><br><span class="line">        String path = <span class="string">&quot;/login.jsp&quot;</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 填充数据 将map中的数据填充到bean对象中</span></span><br><span class="line">            BeanUtils.populate(customer,map);</span><br><span class="line">            <span class="comment">// 交给CustomerService 校验</span></span><br><span class="line">            CustomerService customerService = <span class="keyword">new</span> CustomerServiceImpl();</span><br><span class="line">            customerService.register(customer); <span class="comment">// 异常</span></span><br><span class="line">            resp.sendRedirect(path);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            path = <span class="string">&quot;/register.jsp&quot;</span>;</span><br><span class="line">            <span class="comment">// 将来service throw new RuntimeException(&quot;用户已经占用&quot;)</span></span><br><span class="line">            req.setAttribute(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;注册失败 &quot;</span>+e.getMessage());</span><br><span class="line">            req.getRequestDispatcher(path).forward(req,resp);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="CustomerServiceImpl"><a href="#CustomerServiceImpl" class="headerlink" title="CustomerServiceImpl"></a>CustomerServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Customer;</span><br><span class="line"><span class="keyword">import</span> com.briup.dao.CustomerMapper;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.CustomerService;</span><br><span class="line"><span class="keyword">import</span> com.briup.util.MyBatisSqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/9-09-09-14:25</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：顾客 业务逻辑</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerServiceImpl</span> <span class="keyword">implements</span> <span class="title">CustomerService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> SqlSession session = MyBatisSqlSessionFactory.openSession(<span class="keyword">true</span>);</span><br><span class="line">    <span class="keyword">private</span> CustomerMapper customerMapper = session.getMapper(CustomerMapper.class);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(Customer customer)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 1.校验用户名是否为空</span></span><br><span class="line">        String name = customer.getName();</span><br><span class="line">        <span class="keyword">if</span>(name == <span class="keyword">null</span> || <span class="string">&quot;&quot;</span>.equals(name.trim()))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;用户名不能为空&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 2.校验用户名是否存在</span></span><br><span class="line">            <span class="comment">// 带着用户名去查数据库</span></span><br><span class="line">        Customer customerFromDB = customerMapper.findByName(name);</span><br><span class="line">        <span class="keyword">if</span>(customerFromDB != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;用户名已存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3.使用mybatis 注册</span></span><br><span class="line">        customerMapper.register(customer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>注意: 注册需要提交 commit</code></p>
<h3 id="CustomerMapper-xml"><a href="#CustomerMapper-xml" class="headerlink" title="CustomerMapper.xml"></a>CustomerMapper.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">   <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.briup.dao.CustomerMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;customerSql&quot;</span>&gt;</span></span><br><span class="line">        id,name,password,zipCode,address,telephone,</span><br><span class="line">        email</span><br><span class="line">    <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--查用户名是否存在--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findByName&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;customer&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">parameterType</span>=<span class="string">&quot;string&quot;</span>&gt;</span></span><br><span class="line">       select <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;customerSql&quot;</span>/&gt;</span></span><br><span class="line">       from es_customer</span><br><span class="line">       where name = #&#123;name&#125;</span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--注册--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;register&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">parameterType</span>=<span class="string">&quot;customer&quot;</span>&gt;</span></span><br><span class="line">        insert into</span><br><span class="line">        es_customer(name,password,zipCode,address,telephone,email)</span><br><span class="line">        values (#&#123;name&#125;,#&#123;password&#125;,</span><br><span class="line">        #&#123;zipCode&#125;,#&#123;address&#125;,#&#123;telephone&#125;,#&#123;email&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="register-jsp"><a href="#register-jsp" class="headerlink" title="register.jsp"></a>register.jsp</h3><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> isELIgnored=<span class="string">&quot;false&quot;</span> %&gt;</span><br><span class="line"></span><br><span class="line">  &lt;form action=<span class="string">&quot;/register&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">           &lt;%-- &lt;span style=<span class="string">&quot;color: red;margin-left: 169px;&quot;</span>&gt;&lt;/span&gt;--%&gt;</span><br><span class="line">            &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;reg_box&quot;</span>&gt;</span><br><span class="line">                &lt;li&gt;</span><br><span class="line">                    &lt;span&gt;&lt;b&gt;*&lt;/b&gt;用户名：&lt;/span&gt;</span><br><span class="line">                    &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;name&quot;</span>  id=<span class="string">&quot;name&quot;</span>/&gt;</span><br><span class="line">                    &lt;span id=<span class="string">&quot;tip&quot;</span> style=<span class="string">&quot;width: 152px;color: red;margin-left: -11px&quot;</span>&gt;$&#123;msg&#125;&lt;/span&gt;</span><br><span class="line">                &lt;/li&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310739190.png" alt="image-20211025201746728"></p>
<p><code>注意: idea骨架创建webapp 默认页面忽略了el表达式</code></p>
<h2 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h2><h3 id="分析-1"><a href="#分析-1" class="headerlink" title="==分析=="></a>==分析==</h3><ul>
<li>获取到账户密码</li>
<li>校验是否是账户错误还是密码错误</li>
<li>成功 跳转到商城首页</li>
<li>失败 回退到登录页面 并提示错误信息</li>
</ul>
<h3 id="LoginServlet"><a href="#LoginServlet" class="headerlink" title="LoginServlet"></a>LoginServlet</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Customer;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.CustomerService;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.impl.CustomerServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/9-09-09-16:04</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：登录api</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/login&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        req.getRequestDispatcher(<span class="string">&quot;/login.jsp&quot;</span>).forward(req,resp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 接收参数</span></span><br><span class="line">        String name = req.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        String password = req.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">        <span class="comment">// 校验参数 ICustomerService CustomerServiceImpl</span></span><br><span class="line">        CustomerService customerService = <span class="keyword">new</span> CustomerServiceImpl();</span><br><span class="line">        <span class="comment">// 登录成功</span></span><br><span class="line">        String path = <span class="string">&quot;/index.jsp&quot;</span>;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            Customer customer = customerService.login(name,password);</span><br><span class="line">            <span class="keyword">if</span>(customer != <span class="keyword">null</span>)&#123;</span><br><span class="line">                <span class="comment">// 会话期间 数据有效</span></span><br><span class="line">                req.getSession().setAttribute(<span class="string">&quot;customer&quot;</span>,customer);</span><br><span class="line">            &#125;</span><br><span class="line">            resp.sendRedirect(path);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            path = <span class="string">&quot;/login.jsp&quot;</span>;</span><br><span class="line">            req.setAttribute(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;登录失败 &quot;</span> + e.getMessage());</span><br><span class="line">            <span class="comment">// 跳转页面 首页展示用户姓名</span></span><br><span class="line">            req.getRequestDispatcher(path).forward(req,resp);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="CustomerServiceImpl-1"><a href="#CustomerServiceImpl-1" class="headerlink" title="CustomerServiceImpl"></a>CustomerServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Customer <span class="title">login</span><span class="params">(String name, String password)</span> </span>&#123;</span><br><span class="line">       <span class="comment">// 校验用户名是否错误 这里没有校验密码</span></span><br><span class="line">       Customer customer = customerMapper.findByName(name);</span><br><span class="line">       <span class="keyword">if</span>(customer == <span class="keyword">null</span>)&#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;账户名有误&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">// 校验错误是否错误</span></span><br><span class="line">       <span class="keyword">if</span>(!password.equals((customer.getPassword())))&#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;密码有误&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> customer;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="login-jsp"><a href="#login-jsp" class="headerlink" title="login.jsp"></a>login.jsp</h3><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=<span class="string">&quot;/login&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">                   &lt;h1&gt;账号登陆&lt;/h1&gt;</span><br><span class="line">                   &lt;c:choose&gt;</span><br><span class="line">                       &lt;c:when test=<span class="string">&quot;$&#123;empty msg&#125;&quot;</span>&gt;</span><br><span class="line">                           &lt;h2&gt;公共场所请不要泄露您的密码，以防止账号丢失&lt;/h2&gt;</span><br><span class="line">                       &lt;/c:when&gt;</span><br><span class="line">                       &lt;c:otherwise&gt;</span><br><span class="line">                           &lt;h2&gt;&lt;span style=<span class="string">&quot;color: red&quot;</span>&gt;$&#123;msg&#125;&lt;/span&gt;&lt;/h2&gt;</span><br><span class="line">                       &lt;/c:otherwise&gt;</span><br><span class="line">                   &lt;/c:choose&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310739490.png" alt="image-20210909163711524"></p>
<p><img src="image/image-20210909163739415.png" alt="image-20210909163739415"></p>
<h2 id="注销"><a href="#注销" class="headerlink" title="注销"></a>注销</h2><h3 id="分析-2"><a href="#分析-2" class="headerlink" title="==分析=="></a>==分析==</h3><ul>
<li>如果注销用户,所有存在session的数据例如购物车都应该清除</li>
<li>销毁session即可</li>
</ul>
<h3 id="LogoutServlet"><a href="#LogoutServlet" class="headerlink" title="LogoutServlet"></a>LogoutServlet</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/9-09-09-16:23</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：com.briup.web.servlet</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/logout&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogoutServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        HttpSession session = req.getSession();</span><br><span class="line">        <span class="comment">// session.removeAttriube(&quot;customer&quot;,&quot;customer&quot;)</span></span><br><span class="line">        session.invalidate(); <span class="comment">// session可能购物车</span></span><br><span class="line">        resp.sendRedirect(<span class="string">&quot;/login&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="index-jsp"><a href="#index-jsp" class="headerlink" title="index.jsp"></a>index.jsp</h3><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:choose&gt;</span><br><span class="line">                &lt;c:when test=<span class="string">&quot;$&#123;empty customer&#125;&quot;</span>&gt;</span><br><span class="line">                    &lt;li&gt;&lt;a href=<span class="string">&quot;/login.jsp&quot;</span>&gt;登录&lt;/a&gt;|&lt;/li&gt;</span><br><span class="line">                &lt;/c:when&gt;</span><br><span class="line">                &lt;c:otherwise&gt;</span><br><span class="line">                    &lt;li&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;&lt;span style=<span class="string">&quot;color: green&quot;</span>&gt;$&#123;customer.name&#125;&lt;/span&gt;&lt;/a&gt;|&lt;/li&gt;</span><br><span class="line">                    &lt;li&gt;&lt;a href=<span class="string">&quot;/logout&quot;</span>&gt;退出&lt;/a&gt;|&lt;/li&gt;</span><br><span class="line">                &lt;/c:otherwise&gt;</span><br><span class="line">            &lt;/c:choose&gt;</span><br></pre></td></tr></table></figure>



<h2 id="ajax校验"><a href="#ajax校验" class="headerlink" title="ajax校验"></a>ajax校验</h2><p>==为什么需要前后端都校验==</p>
<ul>
<li>前端显示友好</li>
<li>后端控制业务，防止页面操作问题</li>
</ul>
<h3 id="分析-3"><a href="#分析-3" class="headerlink" title="==分析=="></a>==分析==</h3><ul>
<li>输入框绑定离焦事件 发送ajax请求</li>
<li>后台根据用户名查找用户是否存在</li>
<li>响应提示信息</li>
</ul>
<h3 id="CheckServlet"><a href="#CheckServlet" class="headerlink" title="CheckServlet"></a>CheckServlet</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Customer;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.CustomerService;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.impl.CustomerServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/9-09-09-17:09</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：com.briup.web.servlet</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/check&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CheckServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        String name = req.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        <span class="comment">// 是不是存在  findByName</span></span><br><span class="line">        CustomerService customerService = <span class="keyword">new</span> CustomerServiceImpl();</span><br><span class="line">        Customer customer = customerService.findByName(name);</span><br><span class="line">        resp.setContentType(<span class="string">&quot;text/plain;charset=utf-8&quot;</span>);</span><br><span class="line">        PrintWriter writer = resp.getWriter();</span><br><span class="line">        <span class="keyword">if</span>(customer != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="comment">// 用户已存在</span></span><br><span class="line">            writer.write(<span class="string">&quot;&lt;span style=&#x27;color:red&#x27;&gt;用户已存在&lt;span&gt;&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">// 可注册</span></span><br><span class="line">            writer.write(<span class="string">&quot;&lt;span style=&#x27;color:green&#x27;&gt;可注册&lt;span&gt;&quot;</span>);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>==将来可适用json格式数据交互==</p>
<h3 id="register-jsp-1"><a href="#register-jsp-1" class="headerlink" title="register.jsp"></a>register.jsp</h3><blockquote>
<p>注意:　改造之前的service findByName方法</p>
</blockquote>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span> src=<span class="string">&quot;js/jquery-1.12.3.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">   &lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">        $(function()&#123;</span><br><span class="line">            $(<span class="string">&quot;#name&quot;</span>).on(<span class="string">&quot;blur&quot;</span>,function()&#123;</span><br><span class="line">                <span class="keyword">var</span> name = $(<span class="string">&quot;#name&quot;</span>).val();</span><br><span class="line">                <span class="keyword">if</span>(name &amp;&amp; name.trim())&#123;</span><br><span class="line">                    $.ajax(&#123;</span><br><span class="line">                        type: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">                        url: <span class="string">&quot;/check&quot;</span>,</span><br><span class="line">                        data: &#123;<span class="string">&quot;name&quot;</span>:name&#125;,</span><br><span class="line">                        dataType: <span class="string">&quot;text&quot;</span> ,</span><br><span class="line">                        success: function (data) &#123;</span><br><span class="line">                            $(<span class="string">&quot;#tip&quot;</span>).html(data).hide().slideDown(<span class="number">2000</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> &lt;li&gt;</span><br><span class="line">                    &lt;span&gt;&lt;b&gt;*&lt;/b&gt;用户名：&lt;/span&gt;</span><br><span class="line">                    &lt;input id = <span class="string">&quot;name&quot;</span> type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;name&quot;</span>/&gt;</span><br><span class="line">                    &lt;span id = <span class="string">&quot;tip&quot;</span>&gt;&lt;/span&gt;</span><br><span class="line">                &lt;/li&gt;</span><br></pre></td></tr></table></figure>

<h3 id="CustomerService"><a href="#CustomerService" class="headerlink" title="CustomerService"></a>CustomerService</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Customer;</span><br><span class="line"><span class="keyword">import</span> com.briup.dao.CustomerMapper;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.CustomerService;</span><br><span class="line"><span class="keyword">import</span> com.briup.util.MyBatisSqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/9-09-09-14:25</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：com.briup.service.impl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerServiceImpl</span> <span class="keyword">implements</span> <span class="title">CustomerService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> SqlSession session = MyBatisSqlSessionFactory.openSession(<span class="keyword">true</span>);</span><br><span class="line">    <span class="keyword">private</span> CustomerMapper customerMapper = session.getMapper(CustomerMapper.class);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(Customer customer)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 1.校验用户名是否为空</span></span><br><span class="line">        String name = customer.getName();</span><br><span class="line">        <span class="keyword">if</span>(name == <span class="keyword">null</span> || <span class="string">&quot;&quot;</span>.equals(name.trim()))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;用户名不能为空&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 2.校验用户名是否存在</span></span><br><span class="line">            <span class="comment">// 带着用户名去查数据库</span></span><br><span class="line">        Customer customerFromDB = findByName(name);</span><br><span class="line">        <span class="keyword">if</span>(customerFromDB != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;用户名已存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3.使用mybatis 注册</span></span><br><span class="line">        customerMapper.register(customer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Customer <span class="title">login</span><span class="params">(String name, String password)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 校验用户名是否错误 这里没有校验密码</span></span><br><span class="line">        Customer customer = findByName(name);</span><br><span class="line">        <span class="keyword">if</span>(customer == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;账户名有误&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 校验错误是否错误</span></span><br><span class="line">        <span class="keyword">if</span>(!password.equals((customer.getPassword())))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;密码有误&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> customer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Customer <span class="title">findByName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> customerMapper.findByName(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>







<h1 id="3-书籍模块"><a href="#3-书籍模块" class="headerlink" title="3 书籍模块"></a>3 书籍模块</h1><h2 id="查看所有目录"><a href="#查看所有目录" class="headerlink" title="查看所有目录"></a>查看所有目录</h2><h3 id="分析-4"><a href="#分析-4" class="headerlink" title="==分析=="></a>==分析==</h3><ul>
<li>访问首页 即可查看所有数据</li>
<li>此时数据应该随应用启动便查找(监听器)</li>
<li>一级目录<ul>
<li><code>select * from es_category where parent_id = 0</code></li>
</ul>
</li>
<li>二级目录<ul>
<li><code>select * from es_category where parent_id =(select id from es_category where parent_id = 0) </code></li>
</ul>
</li>
</ul>
<h3 id="ApplicationListener"><a href="#ApplicationListener" class="headerlink" title="ApplicationListener"></a>ApplicationListener</h3><blockquote>
<p>注意: @WebListener</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.listener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Category;</span><br><span class="line"><span class="keyword">import</span> com.briup.mapper.CategoryMapper;</span><br><span class="line"><span class="keyword">import</span> com.briup.util.MyBatisSqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContextEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContextListener;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebListener;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/10-09-10-9:50</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：项目启动 准备目录和书籍数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebListener</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplicationListener</span> <span class="keyword">implements</span> <span class="title">ServletContextListener</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextInitialized</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 项目启动初始化操作</span></span><br><span class="line">        <span class="comment">// 查询所有目录</span></span><br><span class="line">        SqlSession session = MyBatisSqlSessionFactory.openSession();</span><br><span class="line">        CategoryMapper categoryMapper = session.getMapper(CategoryMapper.class);</span><br><span class="line">        List&lt;Category&gt; categoryList = categoryMapper.findAllCategory();</span><br><span class="line">        ServletContext servletContext = sce.getServletContext();</span><br><span class="line">        servletContext.setAttribute(<span class="string">&quot;categoryList&quot;</span>,categoryList);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextDestroyed</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="CategoryMapper-xml"><a href="#CategoryMapper-xml" class="headerlink" title="CategoryMapper.xml"></a>CategoryMapper.xml</h3><blockquote>
<p>注意: 二级目录的parent_id为一级目录的id</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.briup.mapper.CategoryMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;firstMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;category&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;description&quot;</span> <span class="attr">property</span>=<span class="string">&quot;description&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;categories&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">select</span>=<span class="string">&quot;selectSecond&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--嵌套结果 自关联 第一张的结果和第二张一模一样--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--嵌套查询--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAllCategory&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;firstMap&quot;</span>&gt;</span></span><br><span class="line">        select id,name,description</span><br><span class="line">        from es_category</span><br><span class="line">        where parent_id = 0</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--接收一级目录的id--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectSecond&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;firstMap&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">         select id,name,description</span><br><span class="line">        from es_category</span><br><span class="line">        where parent_id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="mybatis-config-xml"><a href="#mybatis-config-xml" class="headerlink" title="mybatis-config.xml"></a>mybatis-config.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置映射文件的位置 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;mappers/CustomerMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;mappers/CategoryMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="index-jsp-1"><a href="#index-jsp-1" class="headerlink" title="index.jsp"></a>index.jsp</h3><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;dl&gt;</span><br><span class="line">               &lt;%--</span><br><span class="line">                   items 获取范围对象中的数据</span><br><span class="line">                   <span class="keyword">var</span>   数据集合的某一项   foeach(Category category : List&lt;Category&gt;)&#123;&#125;</span><br><span class="line">               --%&gt;</span><br><span class="line">               &lt;c:forEach items=<span class="string">&quot;$&#123;categoryList&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;firstCa&quot;</span>&gt;</span><br><span class="line">                   &lt;dd&gt;</span><br><span class="line">                       &lt;h1&gt;$&#123;firstCa.name&#125;&lt;/h1&gt;</span><br><span class="line">                       &lt;p&gt;</span><br><span class="line">                           &lt;c:forEach items=<span class="string">&quot;$&#123;firstCa.categories&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;secondCa&quot;</span>&gt;</span><br><span class="line">                               &lt;a href=<span class="string">&quot;list.html&quot;</span>&gt;$&#123;secondCa.name&#125;&lt;/a&gt;</span><br><span class="line">                           &lt;/c:forEach&gt;</span><br><span class="line">                       &lt;/p&gt;</span><br><span class="line">                   &lt;/dd&gt;</span><br><span class="line">               &lt;/c:forEach&gt;</span><br><span class="line"></span><br><span class="line">           &lt;/dl&gt;</span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310739967.png" alt="image-20210910102415193" style="zoom:50%;" />





<h2 id="查看所有书"><a href="#查看所有书" class="headerlink" title="查看所有书"></a>查看所有书</h2><h3 id="分析-5"><a href="#分析-5" class="headerlink" title="==分析=="></a>==分析==</h3><ul>
<li>访问首页 即可查看所有数据</li>
<li>需要查询目录信息</li>
<li>此时数据应该随应用启动便查找(监听器)</li>
</ul>
<h3 id="ApplicationListener-1"><a href="#ApplicationListener-1" class="headerlink" title="ApplicationListener"></a>ApplicationListener</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.listener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Book;</span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Category;</span><br><span class="line"><span class="keyword">import</span> com.briup.mapper.BookMapper;</span><br><span class="line"><span class="keyword">import</span> com.briup.mapper.CategoryMapper;</span><br><span class="line"><span class="keyword">import</span> com.briup.util.MyBatisSqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContextEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContextListener;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebListener;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/10-09-10-9:50</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：项目启动 准备目录和书籍数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebListener</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplicationListener</span> <span class="keyword">implements</span> <span class="title">ServletContextListener</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextInitialized</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 项目启动初始化操作</span></span><br><span class="line">        <span class="comment">// 查询所有目录</span></span><br><span class="line">        SqlSession session = MyBatisSqlSessionFactory.openSession();</span><br><span class="line">        CategoryMapper categoryMapper = session.getMapper(CategoryMapper.class);</span><br><span class="line">        List&lt;Category&gt; categoryList = categoryMapper.findAllCategory();</span><br><span class="line">        ServletContext servletContext = sce.getServletContext();</span><br><span class="line">        servletContext.setAttribute(<span class="string">&quot;categoryList&quot;</span>,categoryList);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 查询所有书籍</span></span><br><span class="line">        BookMapper bookMapper = session.getMapper(BookMapper.class);</span><br><span class="line">        List&lt;Book&gt; bookList = bookMapper.findAllBook();</span><br><span class="line">        servletContext.setAttribute(<span class="string">&quot;bookList&quot;</span>,bookList);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextDestroyed</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="BookMapper-xml"><a href="#BookMapper-xml" class="headerlink" title="BookMapper.xml"></a>BookMapper.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.briup.mapper.BookMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;bMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;book&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;bid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;bname&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;price&quot;</span> <span class="attr">property</span>=<span class="string">&quot;price&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;author&quot;</span> <span class="attr">property</span>=<span class="string">&quot;author&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;publisher&quot;</span> <span class="attr">property</span>=<span class="string">&quot;publisher&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;pubDate&quot;</span> <span class="attr">property</span>=<span class="string">&quot;pubDate&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;bdescription&quot;</span> <span class="attr">property</span>=<span class="string">&quot;description&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;image&quot;</span> <span class="attr">property</span>=<span class="string">&quot;image&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;category&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;secondMap&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;secondMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;category&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;cid&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;cname&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;description&quot;</span> <span class="attr">column</span>=<span class="string">&quot;cdescription&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAllBook&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;bMap&quot;</span>&gt;</span></span><br><span class="line">        SELECT</span><br><span class="line">            b.id AS bid,</span><br><span class="line">            b.NAME AS bname,</span><br><span class="line">            b.price,</span><br><span class="line">            b.author,</span><br><span class="line">            b.publisher,</span><br><span class="line">            b.pubDate,</span><br><span class="line">            b.description AS bdescription,</span><br><span class="line">            b.image,</span><br><span class="line">            c.id AS cid,</span><br><span class="line">            c.NAME AS cname,</span><br><span class="line">            c.description AS cdescription</span><br><span class="line">        FROM</span><br><span class="line">            es_book b,</span><br><span class="line">            es_category c</span><br><span class="line">        WHERE</span><br><span class="line">            b.category_id = c.id</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="mybatis-config-xml-1"><a href="#mybatis-config-xml-1" class="headerlink" title="mybatis-config.xml"></a>mybatis-config.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;mappers/BookMapper.xml&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="index-jsp-2"><a href="#index-jsp-2" class="headerlink" title="index.jsp"></a>index.jsp</h3><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul&gt;</span><br><span class="line">            &lt;c:forEach items=<span class="string">&quot;$&#123;bookList&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;b&quot;</span>&gt;</span><br><span class="line">                &lt;li&gt;</span><br><span class="line">                    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;c3_b2_txt&quot;</span>&gt;</span><br><span class="line">                        &lt;h1&gt;$&#123;b.name&#125;&lt;/h1&gt;</span><br><span class="line">                        &lt;p&gt;$&#123;b.category.name&#125;&lt;/p&gt;</span><br><span class="line">                        &lt;h2&gt;$&#123;b.category.description&#125;&lt;/h2&gt;</span><br><span class="line">                        &lt;h2&gt;$&#123;b.description&#125;&lt;/h2&gt;</span><br><span class="line">                        &lt;p&gt;&lt;a href=<span class="string">&quot;viewBook.html&quot;</span>&gt;更多精彩，点击进入&lt;/a&gt;&lt;/p&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">            &lt;/c:forEach&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br></pre></td></tr></table></figure>





<h2 id="查看书详情"><a href="#查看书详情" class="headerlink" title="查看书详情"></a>查看书详情</h2><h3 id="分析-6"><a href="#分析-6" class="headerlink" title="==分析=="></a>==分析==</h3><ul>
<li>页面传递书籍id</li>
<li>将id和application范围对象的数据比对即可</li>
</ul>
<h3 id="index-jsp-3"><a href="#index-jsp-3" class="headerlink" title="index.jsp"></a>index.jsp</h3><p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310739429.png" alt="image-20210910121451748"></p>
<h3 id="ViewBookServlet"><a href="#ViewBookServlet" class="headerlink" title="ViewBookServlet"></a>ViewBookServlet</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Book;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/10-09-10-11:20</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：com.briup.web.servlet</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/viewBook&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewBookServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> bookId = Integer.parseInt(req.getParameter(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">        <span class="comment">// 查该id的书 存储在范围对象</span></span><br><span class="line">            <span class="comment">// 此时ServletContext有书的数据</span></span><br><span class="line">        ServletContext servletContext = req.getServletContext();</span><br><span class="line">       List&lt;Book&gt; bookList = (List&lt;Book&gt;) servletContext.getAttribute(<span class="string">&quot;bookList&quot;</span>);</span><br><span class="line">       <span class="keyword">for</span> (Book b : bookList)&#123;</span><br><span class="line">           <span class="keyword">if</span>(b.getId() == bookId)&#123;</span><br><span class="line">               <span class="comment">// 书找到了</span></span><br><span class="line">               req.getSession().setAttribute(<span class="string">&quot;book&quot;</span>,b);</span><br><span class="line">               <span class="keyword">break</span>;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">        <span class="comment">// 跳转到详情页面 渲染</span></span><br><span class="line">        req.getRequestDispatcher(<span class="string">&quot;/viewBook.jsp&quot;</span>).forward(req,resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="viewBook-jsp"><a href="#viewBook-jsp" class="headerlink" title="viewBook.jsp"></a>viewBook.jsp</h3><blockquote>
<p>fmt 解决时间格式</p>
</blockquote>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;container5&quot;</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;cn5_top&quot;</span>&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;cn5_top_x center01&quot;</span>&gt;</span><br><span class="line">            &lt;a <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;font20&quot;</span> href=<span class="string">&quot;#&quot;</span>&gt;书籍&lt;/a&gt; &gt;</span><br><span class="line">            &lt;a href=<span class="string">&quot;#&quot;</span>&gt;$&#123;book.category.name&#125;&lt;/a&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;cn5_top_y center01&quot;</span>&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;cn5topy_1&quot;</span>&gt;</span><br><span class="line">                &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;cn5topy_imgview&quot;</span>&gt;</span><br><span class="line">                    &lt;img src=<span class="string">&quot;$&#123;book.image&#125;&quot;</span>/&gt;</span><br><span class="line">                    &lt;!-- &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;cn5topy_imglist&quot;</span>&gt;</span><br><span class="line">                        &lt;li&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;&lt;img src=<span class="string">&quot;images/viewBook.png&quot;</span>&gt;&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">                        &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;current&quot;</span>&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;&lt;img src=<span class="string">&quot;images/viewBook.png&quot;</span>&gt;&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">                        &lt;li&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;&lt;img src=<span class="string">&quot;images/viewBook.png&quot;</span>&gt;&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">                        &lt;li&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;&lt;img src=<span class="string">&quot;images/viewBook.png&quot;</span>&gt;&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">                        &lt;li&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;&lt;img src=<span class="string">&quot;images/viewBook.png&quot;</span>&gt;&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">                    &lt;/ul&gt; --&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;cn5topy_2&quot;</span>&gt;</span><br><span class="line">                &lt;h1 <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_title font15&quot;</span>&gt;$&#123;book.name&#125;&lt;/h1&gt;</span><br><span class="line">                &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_price&quot;</span>&gt;</span><br><span class="line">                    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_price_x&quot;</span>&gt;</span><br><span class="line">                        &lt;p&gt; briup价：&lt;b&gt;￥$&#123;book.price&#125;&lt;/b&gt; &lt;a href=<span class="string">&quot;#&quot;</span>&gt;(降价通知)&lt;/a&gt;&lt;/p&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;!-- &lt;div&gt;</span><br><span class="line">                    &lt;ul&gt;</span><br><span class="line">                        &lt;li&gt;&lt;span&gt;作者：&lt;/span&gt;托马斯&lt;/li&gt;</span><br><span class="line">                        &lt;li&gt;&lt;/li&gt;</span><br><span class="line">                        &lt;li&gt;&lt;/li&gt;</span><br><span class="line">                    &lt;/ul&gt;</span><br><span class="line">                &lt;/div&gt; --&gt;</span><br><span class="line">                &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_selects&quot;</span>&gt;</span><br><span class="line">                    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_select&quot;</span>&gt;</span><br><span class="line">                        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_key pro_key_vertical fl&quot;</span>&gt;作者：&lt;/div&gt;</span><br><span class="line">                        &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_select_vals&quot;</span>&gt;</span><br><span class="line">                            &lt;li&gt;$&#123;book.author&#125;&lt;/li&gt;</span><br><span class="line"></span><br><span class="line">                        &lt;/ul&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_select&quot;</span>&gt;</span><br><span class="line">                        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_key pro_key_vertical fl&quot;</span>&gt;出版社：&lt;/div&gt;</span><br><span class="line">                        &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_select_vals&quot;</span>&gt;</span><br><span class="line">                            &lt;li&gt;$&#123;book.publisher&#125;&lt;/li&gt;</span><br><span class="line"></span><br><span class="line">                        &lt;/ul&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_select&quot;</span>&gt;</span><br><span class="line">                        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_key pro_key_vertical fl&quot;</span>&gt;书籍介绍：&lt;/div&gt;</span><br><span class="line">                        &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_select_vals&quot;</span>&gt;</span><br><span class="line">                            &lt;li&gt; 出版时间：$&#123;book.pubDate&#125;&lt;/li&gt;</span><br><span class="line">                            &lt;li&gt;包装：平装&lt;/li&gt;</span><br><span class="line">                            &lt;li&gt;正文语种：中文&lt;/li&gt;</span><br><span class="line">                        &lt;/ul&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;form action=<span class="string">&quot;&quot;</span> id=<span class="string">&quot;addCar&quot;</span>&gt;</span><br><span class="line">                    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_buy&quot;</span>&gt;</span><br><span class="line">                        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_buy_nums&quot;</span>&gt;</span><br><span class="line">                            &lt;input type=<span class="string">&quot;text&quot;</span> value=<span class="string">&quot;1&quot;</span> name=<span class="string">&quot;num&quot;</span>/&gt;</span><br><span class="line">                            &lt;dl&gt;</span><br><span class="line">                                &lt;dd onclick=<span class="string">&quot;addCount()&quot;</span>&gt;+&lt;/dd&gt;</span><br><span class="line">                                &lt;dd onclick=<span class="string">&quot;reduceCount()&quot;</span>&gt;-&lt;/dd&gt;</span><br><span class="line">                            &lt;/dl&gt;</span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                        &lt;!--  &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_addshop&quot;</span> onclick=<span class="string">&quot;submitForm()&quot;</span>&gt;加入购物车&lt;/div&gt; --&gt;</span><br><span class="line">                        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_addshop&quot;</span>&gt;&lt;a href=<span class="string">&quot;shopCart.html&quot;</span>&gt;加入购物车&lt;/a&gt;&lt;/div&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/form&gt;</span><br><span class="line">                &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_ship&quot;</span>&gt;</span><br><span class="line">                    &lt;div&gt;</span><br><span class="line">                        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_key fl&quot;</span>&gt;服&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;务：&lt;/div&gt;</span><br><span class="line">                        &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pro_service f1&quot;</span>&gt;</span><br><span class="line">                            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;service_fq&quot;</span>&gt;分期付款&lt;/li&gt;</span><br><span class="line">                            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;service_myf&quot;</span>&gt;免运费&lt;/li&gt;</span><br><span class="line">                            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;service_zt&quot;</span>&gt;自提&lt;/li&gt;</span><br><span class="line">                            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;service_th&quot;</span>&gt;<span class="number">7</span>天无理由退换货&lt;/li&gt;</span><br><span class="line">                        &lt;/ul&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br></pre></td></tr></table></figure>



<h1 id="4-购物车模块"><a href="#4-购物车模块" class="headerlink" title="4 ==购物车模块=="></a>4 ==购物车模块==</h1><p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310739817.png" alt="image-20210910144249683"></p>
<h2 id="ShopCar"><a href="#ShopCar" class="headerlink" title="ShopCar"></a>ShopCar</h2><ul>
<li>ShopCart并没有对应的表 此时的购物车只存在session中(可自己改造)</li>
<li>ShopCart使用Map保存 商品id和订单项的关系(因为页面需要)<ul>
<li>购物车数量</li>
<li>商品价格</li>
<li>商品购买数量</li>
<li>商品小计</li>
<li>购物车商品小计</li>
</ul>
</li>
</ul>
<blockquote>
<p>注意：属性为get***() 将来提供jsp取值</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Book;</span><br><span class="line"><span class="keyword">import</span> com.briup.bean.OrderLine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/10-09-10-14:57</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：购物车对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShopCart</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 需要借助容器对象 才能存储数据</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;Integer, OrderLine&gt; cart = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 功能描述 将商品添加到购物车</span></span><br><span class="line"><span class="comment">     * @author vanse</span></span><br><span class="line"><span class="comment">     * @date 2021/9/10</span></span><br><span class="line"><span class="comment">     * @param book 书的信息</span></span><br><span class="line"><span class="comment">     * @param num 购买数量</span></span><br><span class="line"><span class="comment">     * @return void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCart</span><span class="params">(Book book, <span class="keyword">int</span> num)</span> </span>&#123;</span><br><span class="line">        Integer bookId = book.getId();</span><br><span class="line">        OrderLine orderLine = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (cart.containsKey(bookId)) &#123;</span><br><span class="line">            <span class="comment">// 如果购物车存在这本书 数量+1</span></span><br><span class="line">            orderLine = cart.get(bookId);</span><br><span class="line">            <span class="comment">// 原数量 + 新买的数量</span></span><br><span class="line">            orderLine.setNum(orderLine.getNum() + num);</span><br><span class="line">            orderLine.setCost(orderLine.getNum() * book.getPrice());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 如果不存在,购物车新添一个订单项</span></span><br><span class="line">            orderLine = <span class="keyword">new</span> OrderLine();</span><br><span class="line">            orderLine.setBook(book);</span><br><span class="line">            orderLine.setNum(Long.valueOf(num));</span><br><span class="line">            orderLine.setCost(book.getPrice() * orderLine.getNum());</span><br><span class="line">        &#125;</span><br><span class="line">        cart.put(bookId, orderLine);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// jsp  $&#123;&#125; size totalCost orderLines</span></span><br><span class="line">    <span class="comment">// 构建相关属性 让jsp能够获取到</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// size属性</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> cart.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// totalCost 所有订单项之和</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getTotalCost</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">double</span> totalCost = <span class="number">0</span>;</span><br><span class="line">        Collection&lt;OrderLine&gt; orderLines = cart.values();</span><br><span class="line">        <span class="keyword">for</span> (OrderLine orderLine : orderLines) &#123;</span><br><span class="line">            <span class="comment">// 每个订单项的小计</span></span><br><span class="line">            totalCost += orderLine.getCost();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> totalCost;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// orderLines 所有订单项</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Collection&lt;OrderLine&gt; <span class="title">getOrderLines</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> cart.values();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="加入购物车"><a href="#加入购物车" class="headerlink" title="加入购物车"></a>加入购物车</h2><p>==分析==</p>
<ul>
<li>判断该商品是否购物车存在<ul>
<li>如果存在: 原订单项数量+1</li>
<li>如果不存在: 新添一个订单项</li>
</ul>
</li>
</ul>
<h3 id="AddCartServlet"><a href="#AddCartServlet" class="headerlink" title="AddCartServlet"></a>AddCartServlet</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Book;</span><br><span class="line"><span class="keyword">import</span> com.briup.util.BookUtil;</span><br><span class="line"><span class="keyword">import</span> com.briup.vo.ShopCart;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/10-09-10-14:52</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：加入购物车</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/addCart&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AddCartServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 功能描述 获取到书 和 数量 封装成orderLine 加入到购物车</span></span><br><span class="line"><span class="comment">     * @author vanse</span></span><br><span class="line"><span class="comment">     * @date 2021/9/10</span></span><br><span class="line"><span class="comment">     * @param req</span></span><br><span class="line"><span class="comment">     * @param resp</span></span><br><span class="line"><span class="comment">     * @return void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> bookId = Integer.parseInt(req.getParameter(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">        <span class="keyword">int</span> num = Integer.parseInt(req.getParameter(<span class="string">&quot;num&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加到购物车 (登录session 就有一个购物车对象)</span></span><br><span class="line">            <span class="comment">// 监听器 创建购物车session</span></span><br><span class="line">        HttpSession session = req.getSession();</span><br><span class="line">        ShopCart shopCart = (ShopCart) req.getSession().getAttribute(<span class="string">&quot;shopCart&quot;</span>);</span><br><span class="line">       <span class="keyword">if</span>(shopCart == <span class="keyword">null</span>)&#123;</span><br><span class="line">            shopCart = <span class="keyword">new</span> ShopCart();</span><br><span class="line">       &#125;</span><br><span class="line">        Book book = BookUtil.getBookById(req, bookId);</span><br><span class="line">        <span class="comment">// 添加到购物车</span></span><br><span class="line">       shopCart.addCart(book,num);</span><br><span class="line">        session.setAttribute(<span class="string">&quot;shopCart&quot;</span>,shopCart);</span><br><span class="line">       <span class="comment">// 跳转到购物车页面 展示数据</span></span><br><span class="line">        resp.sendRedirect(<span class="string">&quot;/shopCart.jsp&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="BookUtil"><a href="#BookUtil" class="headerlink" title="BookUtil"></a>BookUtil</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Book;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/10-09-10-15:02</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：com.briup.util</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookUtil</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Book <span class="title">getBookById</span><span class="params">(HttpServletRequest req,Integer bookId)</span> </span>&#123;</span><br><span class="line">        ServletContext servletContext = req.getServletContext();</span><br><span class="line">        Book book = <span class="keyword">null</span>;</span><br><span class="line">        List&lt;Book&gt; bookList = (List&lt;Book&gt;) servletContext.getAttribute(<span class="string">&quot;bookList&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (Book b : bookList) &#123;</span><br><span class="line">            <span class="keyword">if</span> (b.getId() == bookId) &#123;</span><br><span class="line">                book = b;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> book;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="shopCart-jsp"><a href="#shopCart-jsp" class="headerlink" title="shopCart.jsp"></a>shopCart.jsp</h3><blockquote>
<p>注意el表达式取值 ${shopCart.属性}</p>
</blockquote>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;c&quot;</span> uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span></span><br><span class="line">         language=<span class="string">&quot;java&quot;</span>  isELIgnored=<span class="string">&quot;false&quot;</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html;charset=UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;购物车页面&lt;/title&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;css/fullCar.css&quot;</span> /&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;css/common.css&quot;</span>/&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;css/style.css&quot;</span> /&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;css/icons.css&quot;</span> /&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;css/table.css&quot;</span> /&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> type=<span class="string">&quot;text/css&quot;</span> href=<span class="string">&quot;css/shopCar.css&quot;</span>&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;!--顶部--&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;top&quot;</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;top_center&quot;</span>&gt;</span><br><span class="line">        &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;top_bars&quot;</span>&gt;</span><br><span class="line">            &lt;li&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;退出&lt;/a&gt;|&lt;/li&gt;</span><br><span class="line">            &lt;li&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;我的订单&lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;jt_down&quot;</span>&gt;&lt;/span&gt;&lt;/a&gt;|&lt;/li&gt;</span><br><span class="line">            &lt;li&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;关注杰普&lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;jt_down&quot;</span>&gt;&lt;/span&gt;&lt;/a&gt;|&lt;/li&gt;</span><br><span class="line">            &lt;li&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;网站导航&lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;jt_down&quot;</span>&gt;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;!--头部--&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;header3&quot;</span>&gt;</span><br><span class="line">    &lt;a href=<span class="string">&quot;#&quot;</span>&gt;&lt;img src=<span class="string">&quot;images/logo.png&quot;</span>  <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;oneImg&quot;</span>&gt;&lt;/a&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;h3_right&quot;</span>&gt;</span><br><span class="line">        &lt;img src=<span class="string">&quot;images/play_03.png&quot;</span> alt=<span class="string">&quot;&quot;</span>&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;!--中间部分div--&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;empty&quot;</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;peisong&quot;</span>&gt;&lt;pre&gt;全部商品 $&#123;shopCart.size&#125; &lt;/pre&gt;&lt;/div&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;mainCenter&quot;</span>&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;allCheck&quot;</span>&gt;</span><br><span class="line">            &lt;input type=<span class="string">&quot;checkbox&quot;</span>&gt;&lt;p&gt;全选&lt;/p&gt;</span><br><span class="line">            &lt;p <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;leftM&quot;</span>&gt;商品&lt;/p&gt;</span><br><span class="line">            &lt;p <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;rightM&quot;</span>&gt;单价(元)&lt;/p&gt;</span><br><span class="line">            &lt;p <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;leftM&quot;</span>&gt;数量&lt;/p&gt;</span><br><span class="line">            &lt;p <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;leftM&quot;</span>&gt;小计(元)&lt;/p&gt;</span><br><span class="line">            &lt;p <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;leftM&quot;</span>&gt;操作&lt;/p&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;mainPro&quot;</span>&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;aa&quot;</span>&gt;</span><br><span class="line">                &lt;input type=<span class="string">&quot;checkbox&quot;</span>&gt;&lt;span id=<span class="string">&quot;but&quot;</span>&gt;自营&lt;/span&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;c:forEach items=<span class="string">&quot;$&#123;shopCart.orderLines&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;orderLine&quot;</span>&gt;</span><br><span class="line">                &lt;form&gt;</span><br><span class="line">                    &lt;table&gt;</span><br><span class="line">                        &lt;tbody&gt;</span><br><span class="line">                        &lt;tr&gt;</span><br><span class="line">                            &lt;td <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;index&quot;</span>&gt;<span class="number">1</span>&lt;/td&gt;</span><br><span class="line">                            &lt;td&gt;</span><br><span class="line">                                &lt;img src=<span class="string">&quot;$&#123;orderLine.book.image&#125;&quot;</span> &gt;</span><br><span class="line">                                &lt;span&gt;</span><br><span class="line">                                   $&#123;orderLine.book.name&#125;</span><br><span class="line">                                    &lt;br&gt;</span><br><span class="line">                                &lt;/span&gt;</span><br><span class="line">                            &lt;/td&gt;</span><br><span class="line">                            &lt;td&gt;</span><br><span class="line">                                &lt;span&gt;¥$&#123;orderLine.book.price&#125;&lt;/span&gt;</span><br><span class="line">                            &lt;/td&gt;</span><br><span class="line">                            &lt;td <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;index2&quot;</span>&gt;</span><br><span class="line">                                &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;num&quot;</span> value=<span class="string">&quot;$&#123;orderLine.num&#125;&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">                                &lt;span&gt;有货&lt;/span&gt;</span><br><span class="line">                            &lt;/td&gt;</span><br><span class="line">                            &lt;td&gt;</span><br><span class="line">                                &lt;span&gt;¥$&#123;orderLine.cost&#125;&lt;/span&gt;</span><br><span class="line">                            &lt;/td&gt;</span><br><span class="line">                            &lt;td&gt;</span><br><span class="line">                                &lt;button&gt;保存&lt;/button&gt;</span><br><span class="line">                                &lt;button&gt;取消&lt;/button&gt;</span><br><span class="line">                            &lt;/td&gt;</span><br><span class="line">                        &lt;/tr&gt;</span><br><span class="line">                        &lt;/tbody&gt;</span><br><span class="line">                    &lt;/table&gt;</span><br><span class="line">                &lt;/form&gt;</span><br><span class="line">            &lt;/c:forEach&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            &lt;!-- &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;min_content&quot;</span>&gt;</span><br><span class="line">               &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;bb&quot;</span>&gt;</span><br><span class="line">                &lt;input type=<span class="string">&quot;text&quot;</span> &gt;</span><br><span class="line">                &lt;img src=<span class="string">&quot;images/1.png&quot;</span> &gt;</span><br><span class="line">                 &lt;span&gt;</span><br><span class="line">                    Effective JAVA</span><br><span class="line">                    &lt;br&gt;</span><br><span class="line">                &lt;/span&gt;</span><br><span class="line">                &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;mm&quot;</span>&gt;</span><br><span class="line">                    &lt;span&gt;¥<span class="number">66.00</span>&lt;/span&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;img src=<span class="string">&quot;images/have_03.png&quot;</span> style=<span class="string">&quot;margin-top:40px&quot;</span>&gt;</span><br><span class="line">                &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;ri&quot;</span>&gt;¥<span class="number">66.00</span>元&lt;/div&gt;</span><br><span class="line">                &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;righ&quot;</span>&gt;</span><br><span class="line">                     &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;rig&quot;</span>&gt;删除&lt;/div&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">--&gt;</span><br><span class="line">            &lt;!-- &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;bb&quot;</span>&gt;</span><br><span class="line">                   &lt;input type=<span class="string">&quot;checkbox&quot;</span> &gt;</span><br><span class="line">                   &lt;img src=<span class="string">&quot;images/1.png&quot;</span> &gt;</span><br><span class="line">                    &lt;span&gt;</span><br><span class="line">                       Effective JAVA</span><br><span class="line">                       &lt;br&gt;</span><br><span class="line">                   &lt;/span&gt;</span><br><span class="line">                   &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;mm&quot;</span>&gt;</span><br><span class="line">                       &lt;span&gt;¥<span class="number">66.00</span>&lt;/span&gt;</span><br><span class="line">                   &lt;/div&gt;</span><br><span class="line">                   &lt;img src=<span class="string">&quot;images/have_03.png&quot;</span> style=<span class="string">&quot;margin-top:40px&quot;</span>&gt;</span><br><span class="line">                   &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;ri&quot;</span>&gt;¥<span class="number">66.00</span>元&lt;/div&gt;</span><br><span class="line">                   &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;righ&quot;</span>&gt;</span><br><span class="line">                        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;rig&quot;</span>&gt;删除&lt;/div&gt;</span><br><span class="line">                   &lt;/div&gt;</span><br><span class="line">               &lt;/div&gt; --&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;allButtom&quot;</span>&gt;</span><br><span class="line">            &lt;!-- &lt;p <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;caozuo&quot;</span>&gt;去结算&lt;/p&gt; --&gt;</span><br><span class="line">            &lt;!-- &lt;input value=<span class="string">&quot;去提交&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;caozuo&quot;</span> type=<span class="string">&quot;submit&quot;</span>&gt; --&gt;</span><br><span class="line">            &lt;a href=<span class="string">&quot;confirm.html&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;caozuo&quot;</span>&gt;去提交&lt;/a&gt;</span><br><span class="line">            &lt;span&gt;已选择&lt;font&gt;<span class="number">2</span>&lt;/font&gt;件商品&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;总价(不含运费)：&lt;font&gt;¥$&#123;shopCart.totalCost&#125;元&lt;/font&gt;&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;!--脚部--&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;footer3&quot;</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_top&quot;</span>&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_center&quot;</span>&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;ts1&quot;</span>&gt;品目繁多 愉悦购物&lt;/div&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;ts2&quot;</span>&gt;正品保障 天天低价&lt;/div&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;ts3&quot;</span>&gt;极速物流 特色定制&lt;/div&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;ts4&quot;</span>&gt;优质服务 以客为尊&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_middle&quot;</span>&gt;</span><br><span class="line">        &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_center&quot;</span>&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_mi_li01&quot;</span>&gt;</span><br><span class="line">                &lt;h1&gt;购物指南&lt;/h1&gt;</span><br><span class="line">                &lt;p&gt;常见问题&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;找回密码&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;会员介绍&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;购物演示&lt;/p&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_mi_li01&quot;</span>&gt;</span><br><span class="line">                &lt;h1&gt;配送方式&lt;/h1&gt;</span><br><span class="line">                &lt;p&gt;常见问题&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;找回密码&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;会员介绍&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;购物演示&lt;/p&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_mi_li01&quot;</span>&gt;</span><br><span class="line">                &lt;h1&gt;支付方式&lt;/h1&gt;</span><br><span class="line">                &lt;p&gt;常见问题&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;找回密码&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;会员介绍&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;购物演示&lt;/p&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_mi_li01&quot;</span>&gt;</span><br><span class="line">                &lt;h1&gt;售后服务&lt;/h1&gt;</span><br><span class="line">                &lt;p&gt;常见问题&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;找回密码&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;会员介绍&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;购物演示&lt;/p&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_mi_li01&quot;</span>&gt;</span><br><span class="line">                &lt;h1&gt;服务保障&lt;/h1&gt;</span><br><span class="line">                &lt;p&gt;常见问题&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;找回密码&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;会员介绍&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;购物演示&lt;/p&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_mi_li06&quot;</span>&gt;</span><br><span class="line">                &lt;h1&gt;客服中心&lt;/h1&gt;</span><br><span class="line">                &lt;img src=<span class="string">&quot;images/qrcode_jprj.jpg&quot;</span> width=<span class="string">&quot;80px&quot;</span> height=<span class="string">&quot;80px&quot;</span>&gt;</span><br><span class="line">                &lt;p&gt;抢红包、疑问咨询、优惠活动&lt;/p&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_bottom&quot;</span>&gt;</span><br><span class="line">        &lt;p <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_links&quot;</span>&gt;</span><br><span class="line">            &lt;a href=<span class="string">&quot;#&quot;</span>&gt;关于我们&lt;/a&gt;|</span><br><span class="line">            &lt;a href=<span class="string">&quot;#&quot;</span>&gt;联系我们&lt;/a&gt;|</span><br><span class="line">            &lt;a href=<span class="string">&quot;#&quot;</span>&gt;友情链接&lt;/a&gt;|</span><br><span class="line">            &lt;a href=<span class="string">&quot;#&quot;</span>&gt;供货商入驻&lt;/a&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">        &lt;p&gt;沪ICP备<span class="number">14033591</span>号-<span class="number">8</span> 杰普软件briup.com版权所有 杰普软件科技有限公司 &lt;/p&gt;</span><br><span class="line">        &lt;img src=<span class="string">&quot;images/police.png&quot;</span>&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="更新购物车数量"><a href="#更新购物车数量" class="headerlink" title="更新购物车数量"></a>更新购物车数量</h2><h3 id="分析-7"><a href="#分析-7" class="headerlink" title="==分析=="></a>==分析==</h3><ul>
<li><p>接收指定数量和bookId</p>
</li>
<li><p>清除原订单项数据</p>
</li>
<li><p>添加新订单项数据</p>
</li>
</ul>
<h3 id="UpdateCartServlet"><a href="#UpdateCartServlet" class="headerlink" title="UpdateCartServlet"></a>UpdateCartServlet</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Book;</span><br><span class="line"><span class="keyword">import</span> com.briup.bean.ShopCart;</span><br><span class="line"><span class="keyword">import</span> com.briup.util.BookInfoUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/9-09-09-23:19</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：com.briup.web.servlet</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/updateCart&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UpdateCartServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> bookId = Integer.parseInt(req.getParameter(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">        <span class="keyword">int</span> num = Integer.parseInt(req.getParameter(<span class="string">&quot;num&quot;</span>));</span><br><span class="line">        <span class="comment">// 获取到指定书</span></span><br><span class="line">        Book book = BookInfoUtil.getBookById(req, bookId);</span><br><span class="line">        HttpSession session = req.getSession();</span><br><span class="line">        <span class="comment">// 加入购物车(书,数量)</span></span><br><span class="line">        ShopCart shopCart = (ShopCart) session.getAttribute(<span class="string">&quot;shopCart&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (shopCart == <span class="keyword">null</span>) &#123;</span><br><span class="line">            shopCart = <span class="keyword">new</span> ShopCart();</span><br><span class="line">        &#125;</span><br><span class="line">        shopCart.remove(book.getId());</span><br><span class="line">        shopCart.addBook(book, num);</span><br><span class="line">        session.setAttribute(<span class="string">&quot;shopCart&quot;</span>,shopCart);</span><br><span class="line">        <span class="comment">// 转发到购物车</span></span><br><span class="line">        req.getRequestDispatcher(<span class="string">&quot;/shopCart.jsp&quot;</span>).forward(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="ShopCart"><a href="#ShopCart" class="headerlink" title="ShopCart"></a>ShopCart</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从购物车移除指定商品</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        cart.remove(id);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>





<h2 id="移除购物车商品"><a href="#移除购物车商品" class="headerlink" title="移除购物车商品"></a>移除购物车商品</h2><h3 id="分析-8"><a href="#分析-8" class="headerlink" title="==分析=="></a>==分析==</h3><ul>
<li>map移除该商品即可</li>
</ul>
<h3 id="shopCart-jsp-1"><a href="#shopCart-jsp-1" class="headerlink" title="shopCart.jsp"></a>shopCart.jsp</h3><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:forEach items=<span class="string">&quot;$&#123;shopCart.orderLines&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;orderLine&quot;</span>&gt;</span><br><span class="line">                &lt;form action=<span class="string">&quot;/updateCart&quot;</span>&gt;</span><br><span class="line">                    &lt;table&gt;</span><br><span class="line">                        &lt;tbody&gt;</span><br><span class="line">                        &lt;tr&gt;</span><br><span class="line">                            &lt;td <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;index&quot;</span>&gt;<span class="number">1</span>&lt;/td&gt;</span><br><span class="line">                            &lt;td&gt;</span><br><span class="line">                                &lt;img src=<span class="string">&quot;$&#123;orderLine.book.image&#125;&quot;</span> &gt;</span><br><span class="line">                                &lt;span&gt;</span><br><span class="line">                                   $&#123;orderLine.book.name&#125;</span><br><span class="line">                                    &lt;br&gt;</span><br><span class="line">                                &lt;/span&gt;</span><br><span class="line">                            &lt;/td&gt;</span><br><span class="line">                            &lt;td&gt;</span><br><span class="line">                                &lt;span&gt;¥$&#123;orderLine.book.price&#125;&lt;/span&gt;</span><br><span class="line">                            &lt;/td&gt;</span><br><span class="line">                            &lt;td <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;index2&quot;</span>&gt;</span><br><span class="line">                                &lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;id&quot;</span> value=<span class="string">&quot;$&#123;orderLine.book.id&#125;&quot;</span>&gt;</span><br><span class="line">                                &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;num&quot;</span> value=<span class="string">&quot;$&#123;orderLine.num&#125;&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">                                &lt;span&gt;有货&lt;/span&gt;</span><br><span class="line">                            &lt;/td&gt;</span><br><span class="line">                            &lt;td&gt;</span><br><span class="line">                                &lt;span&gt;¥$&#123;orderLine.cost&#125;&lt;/span&gt;</span><br><span class="line">                            &lt;/td&gt;</span><br><span class="line">                            &lt;td&gt;</span><br><span class="line">                                &lt;%--button 放在form表单中默认走action请求--%&gt;</span><br><span class="line">                                &lt;button&gt;更新&lt;/button&gt;</span><br><span class="line">                                &lt;button&gt;</span><br><span class="line">                                    &lt;a href=<span class="string">&quot;/removeCart?id=$&#123;orderLine.book.id&#125;&quot;</span>&gt;</span><br><span class="line">                                        删除</span><br><span class="line">                                    &lt;/a&gt;</span><br><span class="line">                                &lt;/button&gt;</span><br><span class="line">                            &lt;/td&gt;</span><br><span class="line">                        &lt;/tr&gt;</span><br><span class="line">                        &lt;/tbody&gt;</span><br><span class="line">                    &lt;/table&gt;</span><br><span class="line">                &lt;/form&gt;</span><br><span class="line">            &lt;/c:forEach&gt;</span><br></pre></td></tr></table></figure>



<h3 id="RemoveFromCart"><a href="#RemoveFromCart" class="headerlink" title="RemoveFromCart"></a>RemoveFromCart</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Book;</span><br><span class="line"><span class="keyword">import</span> com.briup.bean.ShopCart;</span><br><span class="line"><span class="keyword">import</span> com.briup.util.BookInfoUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/10-09-10-0:07</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：com.briup.web.servlet</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/removeCart&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeleteFromCart</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> bookId = Integer.parseInt(req.getParameter(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">        <span class="comment">// 获取到指定书</span></span><br><span class="line">        Book book = BookInfoUtil.getBookById(req, bookId);</span><br><span class="line">        HttpSession session = req.getSession();</span><br><span class="line">        <span class="comment">// 加入购物车(书,数量)</span></span><br><span class="line">        ShopCart shopCart = (ShopCart) session.getAttribute(<span class="string">&quot;shopCart&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (shopCart == <span class="keyword">null</span>) &#123;</span><br><span class="line">            shopCart = <span class="keyword">new</span> ShopCart();</span><br><span class="line">        &#125;</span><br><span class="line">        shopCart.remove(book.getId());</span><br><span class="line">        session.setAttribute(<span class="string">&quot;shopCart&quot;</span>,shopCart);</span><br><span class="line">        <span class="comment">// 转发到购物车</span></span><br><span class="line">        req.getRequestDispatcher(<span class="string">&quot;/shopCart.jsp&quot;</span>).forward(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h1 id="5-订单模块"><a href="#5-订单模块" class="headerlink" title="5 订单模块"></a>5 订单模块</h1><h2 id="准备提交"><a href="#准备提交" class="headerlink" title="准备提交"></a>准备提交</h2><h3 id="分析-9"><a href="#分析-9" class="headerlink" title="==分析=="></a>==分析==</h3><ul>
<li>在真正提交之前,先跳转到确认页面</li>
<li>选择收货信息<ul>
<li>查找以前的收货信息</li>
<li>添加新的收货信息</li>
</ul>
</li>
</ul>
<h3 id="ConfirmServlet"><a href="#ConfirmServlet" class="headerlink" title="ConfirmServlet"></a>ConfirmServlet</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Customer;</span><br><span class="line"><span class="keyword">import</span> com.briup.bean.ShopAddress;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.ShopAddressService;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.impl.ShopAddressServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/10-09-10-13:27</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：下单之前选择地址</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/confirm&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfirmServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 根据用户获取地址</span></span><br><span class="line">        HttpSession session = req.getSession();</span><br><span class="line">        Customer customer = (Customer) session.getAttribute(<span class="string">&quot;customer&quot;</span>);</span><br><span class="line"></span><br><span class="line">        ShopAddressService shopaddressService  = <span class="keyword">new</span> ShopAddressServiceImpl();</span><br><span class="line">        List&lt;ShopAddress&gt; shopAddressList = shopaddressService.findAddressByCustomer(customer.getId());</span><br><span class="line">        session.setAttribute(<span class="string">&quot;shopAddressList&quot;</span>,shopAddressList);</span><br><span class="line">        <span class="comment">// 跳转到confirm页面</span></span><br><span class="line">        req.getRequestDispatcher(<span class="string">&quot;/confirm.jsp&quot;</span>).forward(req,resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="ShopAddressServiceImpl"><a href="#ShopAddressServiceImpl" class="headerlink" title="ShopAddressServiceImpl"></a>ShopAddressServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.ShopAddress;</span><br><span class="line"><span class="keyword">import</span> com.briup.dao.ShopAddressMapper;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.ShopAddressService;</span><br><span class="line"><span class="keyword">import</span> com.briup.util.MyBatisSqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/10-09-10-13:45</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：com.briup.service.impl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShopAddressServiceImpl</span> <span class="keyword">implements</span> <span class="title">ShopAddressService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> SqlSession sqlSession = MyBatisSqlSessionFactory.openSession(<span class="keyword">true</span>);</span><br><span class="line">    <span class="keyword">private</span> ShopAddressMapper shopAddressMapper = sqlSession.getMapper(ShopAddressMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;ShopAddress&gt; <span class="title">findAddressByCustomer</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> shopAddressMapper.findShopAddressByCId(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>###ShopAddressMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.briup.dao.ShopAddressMapper&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findShopAddressByCId&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">resultType</span>=<span class="string">&quot;com.briup.bean.ShopAddress&quot;</span>&gt;</span></span><br><span class="line">        select *</span><br><span class="line">        from es_shopaddress</span><br><span class="line">        where customer_id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="confirm-jsp"><a href="#confirm-jsp" class="headerlink" title="confirm.jsp"></a>confirm.jsp</h3><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;c&quot;</span> uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> %&gt;</span><br><span class="line"></span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> isELIgnored=<span class="string">&quot;false&quot;</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html;charset=UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;结算页面&lt;/title&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;css/common.css&quot;</span>/&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;css/icons.css&quot;</span> /&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;css/table.css&quot;</span> /&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;css/orderSure.css&quot;</span> /&gt;</span><br><span class="line">    &lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">        <span class="function">function <span class="title">showAdres</span><span class="params">(sp)</span></span>&#123;</span><br><span class="line">            <span class="keyword">var</span> pa = document.getElementById(<span class="string">&quot;newAdres&quot;</span>);</span><br><span class="line">            console.log(pa.style[<span class="string">&#x27;display&#x27;</span>]);</span><br><span class="line">            <span class="keyword">if</span>(pa.style[<span class="string">&#x27;display&#x27;</span>]==<span class="string">&quot;none&quot;</span>)&#123;</span><br><span class="line">                pa.style[<span class="string">&#x27;display&#x27;</span>] = <span class="string">&#x27;block&#x27;</span>;</span><br><span class="line">                sp.innerHTML = <span class="string">&quot;取消新增地址&quot;</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                pa.style[<span class="string">&#x27;display&#x27;</span>] = <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">                sp.innerHTML = <span class="string">&quot;新增收货地址&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;!--顶部--&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;top&quot;</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;top_center&quot;</span>&gt;</span><br><span class="line">        &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;top_bars&quot;</span>&gt;</span><br><span class="line">            &lt;li&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;退出&lt;/a&gt;|&lt;/li&gt;</span><br><span class="line">            &lt;li&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;我的订单&lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;jt_down&quot;</span>&gt;&lt;/span&gt;&lt;/a&gt;|&lt;/li&gt;</span><br><span class="line">            &lt;li&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;关注杰普&lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;jt_down&quot;</span>&gt;&lt;/span&gt;&lt;/a&gt;|&lt;/li&gt;</span><br><span class="line">            &lt;li&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;网站导航&lt;span <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;jt_down&quot;</span>&gt;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;!--头部--&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;header3&quot;</span>&gt;</span><br><span class="line">    &lt;a href=<span class="string">&quot;#&quot;</span>&gt;&lt;img src=<span class="string">&quot;images/logo.png&quot;</span>  <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;oneImg&quot;</span>&gt;&lt;/a&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;h3_right&quot;</span>&gt;</span><br><span class="line">        &lt;img src=<span class="string">&quot;images/play_03.png&quot;</span> alt=<span class="string">&quot;&quot;</span>&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;p <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;orderButtom&quot;</span>&gt;填写并核对订单信息&lt;/p&gt;</span><br><span class="line">&lt;!--中间复杂部分--&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;content&quot;</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;contentCenter&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">        &lt;form action=<span class="string">&quot;/submit&quot;</span> name=<span class="string">&quot;orderForm&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;centerTop&quot;</span>&gt;</span><br><span class="line">                &lt;b style=<span class="string">&quot;font-size:20px;&quot;</span>&gt;收货人信息&lt;/b&gt;</span><br><span class="line"></span><br><span class="line">                &lt;b style=<span class="string">&quot;float: right;cursor: pointer;&quot;</span> onclick=<span class="string">&quot;showAdres(this);&quot;</span></span><br><span class="line">                   ondblclick=<span class="string">&quot;hideAdres(this);&quot;</span>&gt;新增收货地址&lt;/b&gt;</span><br><span class="line">                &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;adres&quot;</span>&gt;</span><br><span class="line">                    &lt;c:forEach items=<span class="string">&quot;$&#123;shopAddressList&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;shopAddrss&quot;</span>&gt;</span><br><span class="line">                        &lt;li&gt;</span><br><span class="line">                            &lt;input type=<span class="string">&quot;radio&quot;</span> name=<span class="string">&quot;shopAddId&quot;</span> value=<span class="string">&quot;$&#123;shopAddrss.id&#125;&quot;</span> style=<span class="string">&quot;width:50px&quot;</span>&gt;</span><br><span class="line">                            $&#123;shopAddrss.receiveName&#125;&amp;nbsp;&amp;nbsp;&amp;nbsp; $&#123;shopAddrss.address&#125;&amp;nbsp;&amp;nbsp;&amp;nbsp; $&#123;shopAddrss.phone&#125;</span><br><span class="line">                        &lt;/li&gt;</span><br><span class="line">                    &lt;/c:forEach&gt;</span><br><span class="line"></span><br><span class="line">                &lt;/ul&gt;</span><br><span class="line"></span><br><span class="line">                &lt;p id=<span class="string">&quot;newAdres&quot;</span> style=<span class="string">&quot;font-size:15px;display: none;&quot;</span>&gt;</span><br><span class="line">                    收件人姓名：&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;receiveName&quot;</span>&gt;&lt;br/&gt;&lt;br/&gt;</span><br><span class="line">                    收件人电话：&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;phone&quot;</span> &gt;</span><br><span class="line">                    收件人地址：&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;address&quot;</span>&gt;&lt;br/&gt;&lt;br/&gt;</span><br><span class="line">                &lt;/p&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            &lt;p <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;singleP&quot;</span>&gt;&lt;b&gt;送货清单&lt;/b&gt;&lt;span&gt;&lt;a href=<span class="string">&quot;shopCart.jsp&quot;</span>&gt;返回修改购物车&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;bigDiv&quot;</span>&gt;</span><br><span class="line">                &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;twoDiv&quot;</span>&gt;</span><br><span class="line">                    &lt;b&gt;商家：briup自营&lt;/b&gt;</span><br><span class="line">                    &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;oneUL&quot;</span>&gt;</span><br><span class="line">                        &lt;c:forEach items=<span class="string">&quot;$&#123;shopCart.orderLines&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;orderLine&quot;</span>&gt;</span><br><span class="line">                            &lt;li&gt;</span><br><span class="line">                                &lt;img src=<span class="string">&quot;$&#123;orderLine.book.image&#125;&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pic&quot;</span>&gt;</span><br><span class="line">                                &lt;p&gt;计算机&amp;nbsp;&amp;nbsp;$&#123;orderLine.book.category.name&#125;&amp;nbsp;&amp;nbsp;$&#123;orderLine.book.name&#125;&amp;nbsp;&amp;nbsp;&lt;/p&gt;</span><br><span class="line">                                &lt;p&gt;&lt;font&gt;¥$&#123;orderLine.book.price&#125;&lt;/font&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;×$&#123;orderLine.num&#125;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;有货&lt;/p&gt;</span><br><span class="line">                                &lt;p&gt;&lt;img src=<span class="string">&quot;images/sureLogo_14.png&quot;</span> alt=<span class="string">&quot;&quot;</span>&gt;&lt;span&gt;七天无理由退换货&lt;/span&gt;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">                            &lt;/li&gt;</span><br><span class="line">                        &lt;/c:forEach&gt;</span><br><span class="line"></span><br><span class="line">                        &lt;li&gt;&lt;pre&gt;【赠品】  高级定制干花书签  随机 ×<span class="number">1</span>&lt;/pre&gt;&lt;/li&gt;</span><br><span class="line">                    &lt;/ul&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;money&quot;</span>&gt;</span><br><span class="line">                &lt;span&gt;&lt;font&gt;$&#123;shopCart.size&#125;&lt;/font&gt;件商品，总商品金额：&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;¥$&#123;shopCart.totalCost&#125;&lt;/span&gt;</span><br><span class="line">                &lt;span&gt;&lt;img src=<span class="string">&quot;images/sureLogo_18.png&quot;</span> alt=<span class="string">&quot;&quot;</span>&gt;运费：&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;¥<span class="number">0.00</span>&lt;/span&gt;</span><br><span class="line"></span><br><span class="line">                &lt;span&gt;应付总额：&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;¥$&#123;shopCart.totalCost&#125;&lt;/span&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;submit&quot;</span>&gt;</span><br><span class="line">                &lt;span&gt;应付金额：&lt;font&gt;¥$&#123;shopCart.totalCost&#125;&lt;/font&gt;&lt;input type=<span class="string">&quot;image&quot;</span> src=<span class="string">&quot;images/21_03.png&quot;</span>&gt;&lt;/span&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;!--脚部--&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;footer3&quot;</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_top&quot;</span>&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_center&quot;</span>&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;ts1&quot;</span>&gt;品目繁多 愉悦购物&lt;/div&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;ts2&quot;</span>&gt;正品保障 天天低价&lt;/div&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;ts3&quot;</span>&gt;极速物流 特色定制&lt;/div&gt;</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;ts4&quot;</span>&gt;优质服务 以客为尊&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_middle&quot;</span>&gt;</span><br><span class="line">        &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_center&quot;</span>&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_mi_li01&quot;</span>&gt;</span><br><span class="line">                &lt;h1&gt;购物指南&lt;/h1&gt;</span><br><span class="line">                &lt;p&gt;常见问题&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;找回密码&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;会员介绍&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;购物演示&lt;/p&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_mi_li01&quot;</span>&gt;</span><br><span class="line">                &lt;h1&gt;配送方式&lt;/h1&gt;</span><br><span class="line">                &lt;p&gt;常见问题&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;找回密码&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;会员介绍&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;购物演示&lt;/p&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_mi_li01&quot;</span>&gt;</span><br><span class="line">                &lt;h1&gt;支付方式&lt;/h1&gt;</span><br><span class="line">                &lt;p&gt;常见问题&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;找回密码&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;会员介绍&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;购物演示&lt;/p&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_mi_li01&quot;</span>&gt;</span><br><span class="line">                &lt;h1&gt;售后服务&lt;/h1&gt;</span><br><span class="line">                &lt;p&gt;常见问题&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;找回密码&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;会员介绍&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;购物演示&lt;/p&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_mi_li01&quot;</span>&gt;</span><br><span class="line">                &lt;h1&gt;服务保障&lt;/h1&gt;</span><br><span class="line">                &lt;p&gt;常见问题&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;找回密码&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;会员介绍&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;购物演示&lt;/p&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">            &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_mi_li06&quot;</span>&gt;</span><br><span class="line">                &lt;h1&gt;客服中心&lt;/h1&gt;</span><br><span class="line">                &lt;img src=<span class="string">&quot;images/qrcode_jprj.jpg&quot;</span> width=<span class="string">&quot;80px&quot;</span> height=<span class="string">&quot;80px&quot;</span>&gt;</span><br><span class="line">                &lt;p&gt;抢红包、疑问咨询、优惠活动&lt;/p&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_bottom&quot;</span>&gt;</span><br><span class="line">        &lt;p <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;f3_links&quot;</span>&gt;</span><br><span class="line">            &lt;a href=<span class="string">&quot;#&quot;</span>&gt;关于我们&lt;/a&gt;|</span><br><span class="line">            &lt;a href=<span class="string">&quot;#&quot;</span>&gt;联系我们&lt;/a&gt;|</span><br><span class="line">            &lt;a href=<span class="string">&quot;#&quot;</span>&gt;友情链接&lt;/a&gt;|</span><br><span class="line">            &lt;a href=<span class="string">&quot;#&quot;</span>&gt;供货商入驻&lt;/a&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">        &lt;p&gt;沪ICP备<span class="number">14033591</span>号-<span class="number">8</span> 杰普软件briup.com版权所有 杰普软件科技有限公司 &lt;/p&gt;</span><br><span class="line">        &lt;img src=<span class="string">&quot;images/police.png&quot;</span>&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="提交订单"><a href="#提交订单" class="headerlink" title="==提交订单=="></a>==提交订单==</h2><h3 id="分析-10"><a href="#分析-10" class="headerlink" title="==分析=="></a>==分析==</h3><ul>
<li>封装订单数据<ul>
<li>封装基本信息</li>
<li>封装地址信息<ul>
<li>如果选择的是旧地址</li>
<li>如果插入了新地址</li>
</ul>
</li>
<li>封装客户信息</li>
<li>封装订单项信息</li>
</ul>
</li>
<li>清空购物车</li>
<li>根据客户查找订单信息</li>
<li>跳转订单列表</li>
</ul>
<h3 id="SubmitServlet"><a href="#SubmitServlet" class="headerlink" title="SubmitServlet"></a>SubmitServlet</h3><blockquote>
<p>注意: 页面输入框一定有值 空字符串</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.*;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.OrderFormService;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.ShopAddressService;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.impl.OrderFormServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.impl.ShopAddressServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/10-09-10-16:26</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：提交订单</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/submit&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SubmitServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        String shopAddId =req.getParameter(<span class="string">&quot;shopAddId&quot;</span>);</span><br><span class="line">        String receiveName = req.getParameter(<span class="string">&quot;receiveName&quot;</span>);</span><br><span class="line">        String address = req.getParameter(<span class="string">&quot;address&quot;</span>);</span><br><span class="line">        String phone = req.getParameter(<span class="string">&quot;phone&quot;</span>);</span><br><span class="line">        HttpSession session = req.getSession();</span><br><span class="line">        Customer customer = (Customer) session.getAttribute(<span class="string">&quot;customer&quot;</span>);</span><br><span class="line">        ShopCart shopCart = (ShopCart) session.getAttribute(<span class="string">&quot;shopCart&quot;</span>);</span><br><span class="line">        ShopAddress shopAddress = <span class="keyword">null</span>;</span><br><span class="line">        ShopAddressService shopAddressService = <span class="keyword">new</span> ShopAddressServiceImpl();</span><br><span class="line">        <span class="comment">// 获取地址信息</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="string">&quot;&quot;</span>.equals(receiveName) &amp;&amp; !<span class="string">&quot;&quot;</span>.equals(address) &amp;&amp; !<span class="string">&quot;&quot;</span>.equals(phone)) &#123;</span><br><span class="line">            <span class="comment">// 新地址 需要保存到数据库中</span></span><br><span class="line">            shopAddress = <span class="keyword">new</span> ShopAddress();</span><br><span class="line">            shopAddress.setCustomer(customer);</span><br><span class="line">            shopAddressService.saveShopAddress(shopAddress);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(shopAddId != <span class="keyword">null</span>)&#123;</span><br><span class="line">                <span class="comment">// 旧地址</span></span><br><span class="line">                shopAddress = shopAddressService.findAddressById(Integer.parseInt(shopAddId));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        Collection&lt;OrderLine&gt; orderLines = shopCart.getOrderLines();</span><br><span class="line">        <span class="keyword">double</span> cost = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (OrderLine orderLine : orderLines) &#123;</span><br><span class="line">            cost += orderLine.getCost();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 封装订单类</span></span><br><span class="line">        OrderForm orderForm = <span class="keyword">new</span> OrderForm();</span><br><span class="line">        orderForm.setShopAddress(shopAddress);</span><br><span class="line">        orderForm.setOrderLines(orderLines);</span><br><span class="line">        orderForm.setCustomer(customer);</span><br><span class="line">        orderForm.setCost(cost);</span><br><span class="line">        orderForm.setOrderDate(<span class="keyword">new</span> Date());</span><br><span class="line">        <span class="comment">// 添加订单</span></span><br><span class="line">        OrderFormService orderFormServcie = <span class="keyword">new</span> OrderFormServiceImpl();</span><br><span class="line">        orderFormServcie.saveOrderForm(orderForm);</span><br><span class="line">        <span class="comment">// 清空购物车</span></span><br><span class="line">        shopCart.clear();</span><br><span class="line">        <span class="comment">// 查询订单</span></span><br><span class="line">        resp.sendRedirect(<span class="string">&quot;/findAllOrderForm&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="ShopAddressServiceImpl-1"><a href="#ShopAddressServiceImpl-1" class="headerlink" title="ShopAddressServiceImpl"></a>ShopAddressServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.ShopAddress;</span><br><span class="line"><span class="keyword">import</span> com.briup.dao.ShopAddressMapper;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.ShopAddressService;</span><br><span class="line"><span class="keyword">import</span> com.briup.util.MyBatisSqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/10-09-10-13:45</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：com.briup.service.impl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShopAddressServiceImpl</span> <span class="keyword">implements</span> <span class="title">ShopAddressService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> SqlSession sqlSession = MyBatisSqlSessionFactory.openSession(<span class="keyword">true</span>);</span><br><span class="line">    <span class="keyword">private</span> ShopAddressMapper shopAddressMapper = sqlSession.getMapper(ShopAddressMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;ShopAddress&gt; <span class="title">findAddressByCustomer</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> shopAddressMapper.findShopAddressByCId(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveShopAddress</span><span class="params">(ShopAddress shopAddress)</span> </span>&#123;</span><br><span class="line">        shopAddressMapper.saveShopAddress(shopAddress);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ShopAddress <span class="title">findAddressById</span><span class="params">(<span class="keyword">int</span> shopAddId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> shopAddressMapper.findAddressById(shopAddId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="ShopAddressMapper-xml"><a href="#ShopAddressMapper-xml" class="headerlink" title="ShopAddressMapper.xml"></a>ShopAddressMapper.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.briup.dao.ShopAddressMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findShopAddressByCId&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">resultType</span>=<span class="string">&quot;com.briup.bean.ShopAddress&quot;</span>&gt;</span></span><br><span class="line">        select *</span><br><span class="line">        from es_shopaddress</span><br><span class="line">        where customer_id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;saveShopAddress&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;shopAddress&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">        insert into es_shopaddress(receiveName,address,phone,customer_id)</span><br><span class="line">		values(#&#123;receiveName&#125;,#&#123;address&#125;,#&#123;phone&#125;,#&#123;customer.id&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAddressById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;shopAddress&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">        select id,receiveName,address,phone,customer_id</span><br><span class="line">		from es_shopaddress where id= #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="OrderFormServiceImpl"><a href="#OrderFormServiceImpl" class="headerlink" title="OrderFormServiceImpl"></a>OrderFormServiceImpl</h3><blockquote>
<p>注意: 订单项需要保存订单id</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.OrderForm;</span><br><span class="line"><span class="keyword">import</span> com.briup.bean.OrderLine;</span><br><span class="line"><span class="keyword">import</span> com.briup.dao.OrderFormMapper;</span><br><span class="line"><span class="keyword">import</span> com.briup.dao.OrderLineMapper;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.OrderFormService;</span><br><span class="line"><span class="keyword">import</span> com.briup.util.MyBatisSqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/10-09-10-16:51</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：com.briup.service.impl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderFormServiceImpl</span> <span class="keyword">implements</span> <span class="title">OrderFormService</span> </span>&#123;</span><br><span class="line">    SqlSession session = MyBatisSqlSessionFactory.openSession(<span class="keyword">false</span>);</span><br><span class="line">    OrderFormMapper orderFormMapper = session.getMapper(OrderFormMapper.class);</span><br><span class="line">    OrderLineMapper orderLineMapper = session.getMapper(OrderLineMapper.class);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveOrderForm</span><span class="params">(OrderForm orderForm)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">try</span>&#123;</span><br><span class="line">           <span class="comment">// 保存订单</span></span><br><span class="line">           orderFormMapper.saveOrderForm(orderForm);</span><br><span class="line">           <span class="comment">// 保存订单项</span></span><br><span class="line">           Collection&lt;OrderLine&gt; orderLines = orderForm.getOrderLines();</span><br><span class="line">           orderLines.forEach(orderLine -&gt; &#123;</span><br><span class="line">               orderLine.setOrderForm(orderForm);</span><br><span class="line">           &#125;);</span><br><span class="line">           orderLineMapper.saveOrderLine(orderForm.getOrderLines());</span><br><span class="line">           session.commit();</span><br><span class="line">       &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">           session.rollback();</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="OrderFormMapper-java"><a href="#OrderFormMapper-java" class="headerlink" title="OrderFormMapper.java"></a>OrderFormMapper.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OrderFormMapper</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">saveOrderForm</span><span class="params">(OrderForm orderForm)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="OrderFormMapper-xml"><a href="#OrderFormMapper-xml" class="headerlink" title="OrderFormMapper.xml"></a>OrderFormMapper.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.briup.dao.OrderFormMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;saveOrderForm&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;orderForm&quot;</span></span></span><br><span class="line"><span class="tag">		<span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">		insert into</span><br><span class="line">		es_orderform(cost,orderDate,shopAddress_id,customer_id)</span><br><span class="line">		values(#&#123;cost&#125;,#&#123;orderDate&#125;,#&#123;shopAddress.id&#125;,#&#123;customer.id&#125;)</span><br><span class="line">	<span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="OrderLineMapper-java"><a href="#OrderLineMapper-java" class="headerlink" title="OrderLineMapper.java"></a>OrderLineMapper.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OrderLineMapper</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">saveOrderLineList</span><span class="params">(Collection&lt;OrderLine&gt; orderLines)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="OrderLineMapper-xml"><a href="#OrderLineMapper-xml" class="headerlink" title="OrderLineMapper.xml"></a>OrderLineMapper.xml</h3><blockquote>
<p>此处使用了批量插入 也可单个循环插入</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.briup.dao.OrderLineMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;saveOrderLine&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;collection&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">		insert into</span><br><span class="line">		es_orderline(num,cost,book_id,orderForm_id)</span><br><span class="line">		values</span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;collection&quot;</span> <span class="attr">item</span>=<span class="string">&quot;orderLine&quot;</span> <span class="attr">index</span>=<span class="string">&quot;index&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            (</span><br><span class="line">                #&#123;orderLine.num&#125;,</span><br><span class="line">                #&#123;orderLine.cost&#125;,</span><br><span class="line">                #&#123;orderLine.book.id&#125;,</span><br><span class="line">                #&#123;orderLine.orderForm.id&#125;</span><br><span class="line">            )</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="ShopCart-1"><a href="#ShopCart-1" class="headerlink" title="ShopCart"></a>ShopCart</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       cart.clear();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h2 id="查看自己订单"><a href="#查看自己订单" class="headerlink" title="查看自己订单"></a>查看自己订单</h2><h3 id="分析-11"><a href="#分析-11" class="headerlink" title="==分析=="></a>==分析==</h3><ul>
<li>客户只能查到与自己相关的订单</li>
<li>级联地址信息</li>
</ul>
<h3 id="FindAllOrderForm"><a href="#FindAllOrderForm" class="headerlink" title="FindAllOrderForm"></a>FindAllOrderForm</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Customer;</span><br><span class="line"><span class="keyword">import</span> com.briup.bean.OrderForm;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.OrderFormService;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.impl.OrderFormServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/11-09-11-8:41</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：com.briup.web.servlet</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/findAllOrderForm&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FindAllOrderForm</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        HttpSession session = req.getSession();</span><br><span class="line">        Customer customer = (Customer) session.getAttribute(<span class="string">&quot;customer&quot;</span>);</span><br><span class="line">        OrderFormService orderFormService = <span class="keyword">new</span> OrderFormServiceImpl();</span><br><span class="line">        List&lt;OrderForm&gt; orderFormList = orderFormService.findAllOrderForm(customer.getId());</span><br><span class="line">        session.setAttribute(<span class="string">&quot;orderFormList&quot;</span>,orderFormList);</span><br><span class="line">        resp.sendRedirect(<span class="string">&quot;orderList.jsp&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="OrderFormServiceImpl-1"><a href="#OrderFormServiceImpl-1" class="headerlink" title="OrderFormServiceImpl"></a>OrderFormServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> List&lt;OrderForm&gt; <span class="title">findAllOrderForm</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> orderFormMapper.findAllOrderForm(id);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="OrderFormMapper-xml-1"><a href="#OrderFormMapper-xml-1" class="headerlink" title="OrderFormMapper.xml"></a>OrderFormMapper.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;orderFormMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;orderForm&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;cost&quot;</span> <span class="attr">property</span>=<span class="string">&quot;cost&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;orderDate&quot;</span> <span class="attr">property</span>=<span class="string">&quot;orderDate&quot;</span> /&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--收货人 注意: findAddressById的返回形式需要resultMap--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;shopAddress&quot;</span></span></span><br><span class="line"><span class="tag">		<span class="attr">column</span>=<span class="string">&quot;shopAddress_id&quot;</span> <span class="attr">select</span>=<span class="string">&quot;com.briup.dao.ShopAddressMapper.findAddressById&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAllOrderForm&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;orderFormMap&quot;</span>&gt;</span></span><br><span class="line">       select id,cost,orderDate,shopAddress_id,customer_id</span><br><span class="line">	from</span><br><span class="line">	es_orderform</span><br><span class="line">	where customer_id = #&#123;id&#125;</span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="ShopAddressMapper-xml-1"><a href="#ShopAddressMapper-xml-1" class="headerlink" title="ShopAddressMapper.xml"></a>ShopAddressMapper.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;ShopAddress&quot;</span> <span class="attr">id</span>=<span class="string">&quot;ShopAddressResult&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;receiveName&quot;</span> <span class="attr">property</span>=<span class="string">&quot;receiveName&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;address&quot;</span> <span class="attr">property</span>=<span class="string">&quot;address&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;phone&quot;</span> <span class="attr">property</span>=<span class="string">&quot;phone&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAddressById&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;ShopAddressResult&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">       select id,receiveName,address,phone,customer_id</span><br><span class="line">	from es_shopaddress where id= #&#123;id&#125;</span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="orderList-jsp"><a href="#orderList-jsp" class="headerlink" title="orderList.jsp"></a>orderList.jsp</h3><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:forEach items=<span class="string">&quot;$&#123;orderFormList&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;orderForm&quot;</span> varStatus=<span class="string">&quot;v&quot;</span>&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">                &lt;td align=<span class="string">&quot;center&quot;</span>&gt;$&#123;v.index+<span class="number">1</span>&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;$&#123;orderForm.id&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;$&#123;orderForm.cost&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;未付款&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;$&#123;orderForm.shopAddress.receiveName&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;&lt;input type=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;删除&quot;</span> onclick=<span class="string">&quot;javascript:window.location=&#x27;orderlist.html&#x27;;&quot;</span>&gt;&lt;input type=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;明细&quot;</span> onclick=<span class="string">&quot;javascript:window.location=&#x27;orderdetail.html&#x27;;&quot;</span>&gt;  &lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">        &lt;/c:forEach&gt;</span><br></pre></td></tr></table></figure>



<h2 id="查看订单详情"><a href="#查看订单详情" class="headerlink" title="查看订单详情"></a>查看订单详情</h2><h3 id="分析-12"><a href="#分析-12" class="headerlink" title="==分析=="></a>==分析==</h3><ul>
<li>级联书的信息</li>
</ul>
<p>###orderList.jsp</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;明细&quot;</span> onclick=<span class="string">&quot;javascript:window.location=&#x27;/orderDetail?id=$&#123;orderForm.id&#125;&#x27;;&quot;</span>&gt;</span><br></pre></td></tr></table></figure>



<h3 id="OrderDetailServlet"><a href="#OrderDetailServlet" class="headerlink" title="OrderDetailServlet"></a>OrderDetailServlet</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/orderDetail&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderDetailServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> id = Integer.parseInt(req.getParameter(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">        OrderLineService orderLineService = <span class="keyword">new</span> OrderLineServiceImpl();</span><br><span class="line">        List&lt;OrderLine&gt; orderLineList = orderLineService.findOrderLinesByOrderFormId(id);</span><br><span class="line">        HttpSession session = req.getSession();</span><br><span class="line">        session.setAttribute(<span class="string">&quot;orderLineList&quot;</span>,orderLineList);</span><br><span class="line">        req.getRequestDispatcher(<span class="string">&quot;/orderDetail.jsp&quot;</span>).forward(req,resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="OrderLineServiceImpl"><a href="#OrderLineServiceImpl" class="headerlink" title="OrderLineServiceImpl"></a>OrderLineServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.OrderLine;</span><br><span class="line"><span class="keyword">import</span> com.briup.dao.OrderLineMapper;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.OrderLineService;</span><br><span class="line"><span class="keyword">import</span> com.briup.util.MyBatisSqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/11-09-11-9:22</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：com.briup.service.impl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderLineServiceImpl</span> <span class="keyword">implements</span> <span class="title">OrderLineService</span> </span>&#123;</span><br><span class="line">    SqlSession session = MyBatisSqlSessionFactory.openSession(<span class="keyword">false</span>);</span><br><span class="line">    OrderLineMapper orderLineMapper = session.getMapper(OrderLineMapper.class);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;OrderLine&gt; <span class="title">findOrderLinesByOrderFormId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> orderLineMapper.findOrderLinesByOrderFormId(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveOrderLine</span><span class="params">(Collection&lt;OrderLine&gt; orderLines)</span> </span>&#123;</span><br><span class="line">        orderLineMapper.saveOrderLine(orderLines);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="OrderLineMapper-xml-1"><a href="#OrderLineMapper-xml-1" class="headerlink" title="OrderLineMapper.xml"></a>OrderLineMapper.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;OrderLine&quot;</span> <span class="attr">id</span>=<span class="string">&quot;OrderLineResult&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;num&quot;</span> <span class="attr">property</span>=<span class="string">&quot;num&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;cost&quot;</span> <span class="attr">property</span>=<span class="string">&quot;cost&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;book&quot;</span> <span class="attr">column</span>=<span class="string">&quot;book_id&quot;</span></span></span><br><span class="line"><span class="tag">			<span class="attr">select</span>=<span class="string">&quot;com.briup.dao.BookMapper.findBookById&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findOrderLinesByOrderFormId&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;OrderLineResult&quot;</span>&gt;</span></span><br><span class="line">        select * from es_orderline</span><br><span class="line">        where orderForm_id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="BookMapper-xml-1"><a href="#BookMapper-xml-1" class="headerlink" title="BookMapper.xml"></a>BookMapper.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;book&quot;</span> <span class="attr">id</span>=<span class="string">&quot;simpleBookMap&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;price&quot;</span> <span class="attr">property</span>=<span class="string">&quot;price&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;author&quot;</span> <span class="attr">property</span>=<span class="string">&quot;author&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;publisher&quot;</span> <span class="attr">property</span>=<span class="string">&quot;publisher&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;pubDate&quot;</span> <span class="attr">property</span>=<span class="string">&quot;pubDate&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;description&quot;</span> <span class="attr">property</span>=<span class="string">&quot;description&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;image&quot;</span> <span class="attr">property</span>=<span class="string">&quot;image&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findBookById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;simpleBookMap&quot;</span>&gt;</span></span><br><span class="line">        select * from es_book</span><br><span class="line">        where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="orderDetail-jsp"><a href="#orderDetail-jsp" class="headerlink" title="orderDetail.jsp"></a>orderDetail.jsp</h3><blockquote>
<p>此处使用&lt;c:set&gt; 循环计算</p>
</blockquote>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;tbody&gt;</span><br><span class="line">        &lt;c:set <span class="keyword">var</span>=<span class="string">&quot;totalCost&quot;</span> value=<span class="string">&quot;0&quot;</span>/&gt;</span><br><span class="line">        &lt;c:forEach items=<span class="string">&quot;$&#123;orderLineList&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;orderLine&quot;</span> varStatus=<span class="string">&quot;v&quot;</span>&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">                &lt;td&gt;$&#123;v.index&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;$&#123;orderLine.book.name&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;价格：&lt;span&gt;$&#123;orderLine.book.price&#125;&lt;/span&gt;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;数量：&lt;span&gt;$&#123;orderLine.num&#125;&lt;/span&gt;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;小计：&lt;span&gt; $&#123;orderLine.book.price&#125; * $&#123;orderLine.num&#125;&lt;/span&gt;&lt;/td&gt;</span><br><span class="line">                &lt;c:set <span class="keyword">var</span>=<span class="string">&quot;totalCost&quot;</span> value=<span class="string">&quot;$&#123;orderLine.book.price * orderLine.num + totalCost&#125;&quot;</span>/&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">        &lt;/c:forEach&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td colspan=<span class="string">&quot;5&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;count&quot;</span>&gt;合计：&lt;span&gt;$&#123;totalCost&#125;&lt;/span&gt;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;/tbody&gt;</span><br></pre></td></tr></table></figure>



<h2 id="删除订单"><a href="#删除订单" class="headerlink" title="删除订单"></a>删除订单</h2><h3 id="分析-13"><a href="#分析-13" class="headerlink" title="==分析=="></a>==分析==</h3><ul>
<li>订单被订单项引用 不能直接删除</li>
<li>先删除引用了订单的所有订单项信息,再删除订单</li>
</ul>
<h3 id="orderList-jsp-1"><a href="#orderList-jsp-1" class="headerlink" title="orderList.jsp"></a>orderList.jsp</h3><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;删除&quot;</span> onclick=<span class="string">&quot;javascript:window.location=&#x27;/orderDelete?id=$&#123;orderForm.id&#125;&#x27;;&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<h3 id="OrderDelete"><a href="#OrderDelete" class="headerlink" title="OrderDelete"></a>OrderDelete</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.service.OrderFormService;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.impl.OrderFormServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/11-09-11-11:11</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：com.briup.web.servlet</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/orderDelete&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderDelete</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> id = Integer.parseInt(req.getParameter(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">        OrderFormService orderFormService  = <span class="keyword">new</span> OrderFormServiceImpl();</span><br><span class="line">        orderFormService.deleteOrderById(id);</span><br><span class="line"></span><br><span class="line">        req.getRequestDispatcher(<span class="string">&quot;/findAllOrderForm&quot;</span>).forward(req,resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="OrderFormServiceImpl-2"><a href="#OrderFormServiceImpl-2" class="headerlink" title="OrderFormServiceImpl"></a>OrderFormServiceImpl</h3><blockquote>
<p>注意: 订单和订单项有外键关联</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteOrderById</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">       List&lt;OrderLine&gt; orderList = orderLineService.findOrderLinesByOrderFormId(id);</span><br><span class="line">       orderLineService.deleteBatch(orderList);</span><br><span class="line">       orderFormMapper.deleteById(id);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="OrderLineServiceImpl-1"><a href="#OrderLineServiceImpl-1" class="headerlink" title="OrderLineServiceImpl"></a>OrderLineServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteBatch</span><span class="params">(List&lt;OrderLine&gt; orderList)</span> </span>&#123;</span><br><span class="line">    orderLineMapper.deleteBatch(orderList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="OrderLineMapper-xml-2"><a href="#OrderLineMapper-xml-2" class="headerlink" title="OrderLineMapper.xml"></a>OrderLineMapper.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteBatch&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">        delete from es_orderLine</span><br><span class="line">        where id in</span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span> <span class="attr">item</span>=<span class="string">&quot;orderLine&quot;</span>&gt;</span></span><br><span class="line">           #&#123;orderLine.id&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="OrderFormMapper-xml-2"><a href="#OrderFormMapper-xml-2" class="headerlink" title="OrderFormMapper.xml"></a>OrderFormMapper.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">       delete from es_orderform</span><br><span class="line">       where id = #&#123;id&#125;</span><br><span class="line">   <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h1 id="6-集成沙箱"><a href="#6-集成沙箱" class="headerlink" title="6 集成沙箱"></a>6 集成沙箱</h1><h2 id="1-沙箱及配置"><a href="#1-沙箱及配置" class="headerlink" title="1.沙箱及配置"></a>1.沙箱及配置</h2><p><code>注意： 不要使用谷歌浏览器...否则沙箱页面无法刷新</code></p>
<p><strong>1.登陆蚂蚁金服官网</strong> <a target="_blank" rel="noopener" href="https://www.antgroup.com/">https://www.antgroup.com/</a></p>
<hr>
<p><strong>2.划到尾页，点击支付宝开放平台</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310740736.png" alt="image-20201029103938947"></p>
<hr>
<p><strong>3.点击立即入驻（注册过的直接扫码登陆）</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310740246.png" alt="image-20201029104756001"></p>
<hr>
<p><strong>4.填写身份信息注册沙箱账号</strong></p>
<hr>
<p><strong>5.注册完跳转页面，选择沙箱</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310740505.png" alt="image-20201029105235780"></p>
<hr>
<p><strong>6.跳转页面，点击开放平台控制台</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310740589.png" alt="image-20201029105359667"></p>
<hr>
<p><strong>7.跳转登陆页面，扫码登陆</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310740571.png" alt="image-20201029105433185"></p>
<hr>
<p><strong>8.跳转页面，点击研发服务</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310740781.png" alt="image-20201029105527432"></p>
<hr>
<p><strong>9.沙箱页面</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310740078.png" alt="image-20211025212114663"></p>
<ul>
<li>==沙箱应用  个人app以及公钥私钥信息==</li>
<li>沙箱账号 商家和买家信息</li>
<li>沙箱工具 手机沙箱支付宝app</li>
</ul>
<hr>
<p><strong>10.此时需要设置公钥和私钥，点击设置沙箱应用 查看密钥</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310740085.png" alt="image-20211025212357088"></p>
<p>系统生成</p>
<ul>
<li><p>应用公钥不用</p>
</li>
<li><p>应用私钥和支付宝公钥放程序</p>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310740614.png" alt="image-20211025212504112"></p>
<hr>
<h2 id="2-集成项目"><a href="#2-集成项目" class="headerlink" title="2.集成项目"></a>2.集成项目</h2><p><strong>1.导入支付宝依赖</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alipay.sdk<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>alipay-sdk-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.8.10.ALL<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<p><strong>2.封装配置类 AlipayConfig.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AlipayConfig</span> </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 服务网关   沙箱环境都是这个  </span></span><br><span class="line"><span class="comment">     (去沙箱应用中复制该信息 沙箱应用/支付宝网关 )</span></span><br><span class="line"><span class="comment">   */</span>								</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> String serverUrl = <span class="string">&quot;https://openapi.alipaydev.com/gateway.do&quot;</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 应用id  后期可以替换成自己的id</span></span><br><span class="line"><span class="comment">   	(去沙箱应用中复制该信息 沙箱应用/APPID)</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> String appId = <span class="string">&quot;2016102500758175&quot;</span>;<span class="comment">//2016102500758175</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   RSA2密钥（公钥模式)</span></span><br><span class="line"><span class="comment">   应用私钥   后期替换成自己的私钥 </span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> String privateKey =<span class="string">&quot;MIIEvAIBADANBgkqhkiG9w0BAQEFAASCBKYwggSAgEAAoIBAQC0+d4lR1AOvmduCyg3cBFxyRDUK//TOA7ct9kilfGcHjjk65HFz9UAQSsImdAd+YsAtOL0Fy1RtUdOjGZTG1nKG5eQnJo4gHXavvfnr5iDsdWOz8RUjV0YBK8uBtiEcJ98WuXUU5T3YEvdN8zOkq861Kq39VKElbFRgkfW3ZO97yDgVL3o2aic6IM/rB99a/AuDQggi4Ok84K0GPK64U/7eynR2Yr2kelPt03P6Gm5K3tw5miPKo/60ajKquM1yCyUQQ+6T9ebwN2hhkEfH6NdqJMVs05MfgKWzWm3jL/JJ54bFbWhz1GuB5lnzM2v3cz6mAnc7a6xbyOG1VMeqfVLAgMBAAECggEAJIaFokp5SvB82YXg8QdqTefBwMC8mjmnLj7g0Q0oPVUQMIum2SCwIaQFdm/sxA/4UQUxBQikeeg3YxANGtrbTWIyPdqNebfbkXGXgSg8hN/gdTlTq6j4T/+qB4UUL+63EZca6baQyzihNx2q9Uo/mYUQi540sFOx/PxpWWFRDzUbpH1Mip0fpSpdlq/rYNwnCtoOHx7AQYQWpFEWUr6WvaLhKEgICnzfsrmmPiyLX4rZ1H9gpf/zOeSP6l7HtGUc7vsbgKGBERx0Kx7FvYG41MEItev3zEklpwFwX4fHqc2wkCgBWuMnE5VuXQtToY6Z2236uyOn97fVneIFXi/b2QKBgQDwwH1XTav8qUL11A58y/K2w7KDXM7vMOgve4rXUpxakkaYYst4b9jzH1xODM2D3PGIE6v1omyLrj7khNlRBd7ffnIymzT32HE7V1Q3/SoJlLV8tcv+hETKF/Ycu5osrvc5da1JTVMc72lODNlHbYqOAW8DU9mGqX9TJToOU3iVjQKBgQDAcC61KstO0CGZZlJ7NvNBXrhAk2lKdNm3gd/nz9YRc3hyo07dT6RErbT1bim2dbO4lAkrf/qDnXWQjyh9b5c2hCV8BposaeJGxXbmsiPtsjrr+Fg6+KYv11PMyBMu1eF1gboRvAB0e8wbbLl8rlFmOSsS8HZRz09NR8aFViIkNwKBgFY6i2omjrArK6mCr0GxhphBVYHJTvDK0o6XMC5ZD1k9RP21fO0BGnJRzCzEVyOgkf3MFe4fo8MPwMT2dCOZ966SynIntvwCUOQRLj/zdAgEdFBbiNn7I+xCUssNwnW4oSG6bTtw75DQiyYCYhw8NsEP8GP/t0yNDuaH0dhpuynNAoGAHdDDy9oHifyBWC0cVm7bHaO5VHgCdkDIgsAimt3+wtFrNgfLbkqqnuFzChu5ZsWxxMVa7lxzyfSZhH5JvbWObinnTOIQ/RSitGhf1bqACpH0wx7FPM3Nodfw6eeN4VHODtC8rYa9Y07S/uTHkGPJxNbSr6qGCoLePJEEVyBTRd0CgYBbvf9/d8lybwvIVGi4YS72on4w86n64bS8EbBCZtmqwAKmGKLIsvSnlubEyP88dYtP6Hp6N8DExDd9I45OxdsX7CIRmfaPH+LT6oytWCiObtNK6ME4y/yaIpLuDKaFLg2fetJd6RyHd2nngbNgmVKVRu6tjIIKqbDkW8Q4XP+etg==&quot;</span>;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   *  发送数据的格式 目前只能为json</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> String format = <span class="string">&quot;json&quot;</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   *  设置字符集编码 目前只能为utf-8</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> String charset = <span class="string">&quot;utf-8&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  	  RSA2密钥（公钥模式)</span></span><br><span class="line"><span class="comment">     支付宝公钥 后期替换成自己的支付宝公钥 </span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> String publicKey = <span class="string">&quot;MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAlb5JITbNNGuhnCwn2QXxYjh/iyLML/GT5omOMT+GD+vNY4ID6fn5oQDA8jByatzwMjoC251mj4TIRY1hb51FbAcfwkQEFuSULyVFgDiC4ae+JZSHEwIzseznrQT0rqcIDj8Y70wRFcfL92bFzh/ETBrbE31nfc34hLATUpz3FOOAFuE4wx4KTW/OsugyKyVns+JAIIdlzNzZSEnh4DaL8/2OrWL+Em21pr50gaQQu1lGly9ArrKCnuICIa7lcGKEct0yeSaDA25UZg+YSodZCVUpWe3bOhrGDy4gn2AZiLfkejr2e3aPoETIIz1tBV011ZU+/zIzYrdnEt+O4gFQwIDAQAB&quot;</span>;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   *  支付宝签名 目前是 RSA2</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> String signType = <span class="string">&quot;RSA2&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   *  页面跳转同步通知页面路径 需http://格式的完整路径，不能加?id=123这类自定义参数，必须外网可以正常访问</span></span><br><span class="line"><span class="comment">   *  付款结束后跳转的页面</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> String return_url = <span class="string">&quot;http://localhost:8080/estore_alipay/index.jsp&quot;</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> AlipayClient <span class="title">getAlipayClient</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="comment">// 获得初始化的AlipayClient</span></span><br><span class="line">      AlipayClient alipayClient = <span class="keyword">new</span> DefaultAlipayClient</span><br><span class="line">    		  (AlipayConfig.serverUrl, AlipayConfig.appId, </span><br><span class="line">    		AlipayConfig.privateKey, AlipayConfig.format, </span><br><span class="line">    		AlipayConfig.charset, AlipayConfig.publicKey, AlipayConfig.signType);</span><br><span class="line">      <span class="keyword">return</span> alipayClient;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<hr>
<p><strong>3.引入支付接口(注意配置访问路径)</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PayServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		doGet(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//拿到订单id</span></span><br><span class="line">	     String orderid = request.getParameter(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">		<span class="comment">//调用service去数据库中查询当前订单</span></span><br><span class="line">	     OrderServiceImpl ordImpl = <span class="keyword">new</span> OrderServiceImpl();</span><br><span class="line">	     OrderForm orderForm = </span><br><span class="line">	    		 ordImpl.findOrderFormById(Integer.parseInt(orderid));</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//支付</span></span><br><span class="line">	    <span class="comment">//浏览器动态产生一个付钱的二维码</span></span><br><span class="line">	     <span class="comment">/**</span></span><br><span class="line"><span class="comment">	      * 需要将我们的项目接入支付宝</span></span><br><span class="line"><span class="comment">	      * 入驻蚂蚁金服平台</span></span><br><span class="line"><span class="comment">	      */</span></span><br><span class="line">	     </span><br><span class="line">	     <span class="keyword">try</span> &#123;</span><br><span class="line">	          AlipayClient alipayClient =</span><br><span class="line">	                  AlipayConfig.getAlipayClient();</span><br><span class="line">	          <span class="comment">//设置请求参数</span></span><br><span class="line">	          AlipayTradePagePayRequest alipayRequest = </span><br><span class="line">	                  <span class="keyword">new</span> AlipayTradePagePayRequest();</span><br><span class="line">	          </span><br><span class="line">	          AlipayTradePayModel model = </span><br><span class="line">	                  <span class="keyword">new</span> AlipayTradePayModel();</span><br><span class="line">	          <span class="comment">// 设定订单号 必须要写,且订单号不能重复，目前已经只是做测试，已经写死</span></span><br><span class="line">	          model.setOutTradeNo(System.currentTimeMillis()+<span class="string">&quot;&quot;</span>);</span><br><span class="line">	          <span class="comment">// 设置订单金额</span></span><br><span class="line">	          model.setTotalAmount(orderForm.getCost()+<span class="string">&quot;&quot;</span>);</span><br><span class="line">	          <span class="comment">// 订单名字</span></span><br><span class="line">	          model.setSubject(<span class="string">&quot;书籍订单&quot;</span>);</span><br><span class="line">	          <span class="comment">// 订单描述</span></span><br><span class="line">	          model.setBody(System.currentTimeMillis()+<span class="string">&quot;&quot;</span>);</span><br><span class="line">	          <span class="comment">// 产品码</span></span><br><span class="line">	          model.setProductCode(<span class="string">&quot;FAST_INSTANT_TRADE_PAY&quot;</span>);</span><br><span class="line">	          <span class="comment">// 设置参数</span></span><br><span class="line">	          alipayRequest.setBizModel(model);</span><br><span class="line">	          <span class="comment">// 设置回调地址</span></span><br><span class="line">	          alipayRequest.setReturnUrl(AlipayConfig.return_url);</span><br><span class="line">	          String result = alipayClient.pageExecute(alipayRequest).getBody();</span><br><span class="line">	          response.setContentType(<span class="string">&quot;text/html;charset=utf-8&quot;</span>);</span><br><span class="line">	          response.getWriter().println(result);</span><br><span class="line">	      &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">	              e.printStackTrace();</span><br><span class="line">	      &#125;  </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<hr>
<p><strong>4.此时需要添加业务 根据id查看订单信息</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> OrderForm <span class="title">findOrderFormById</span><span class="params">(<span class="keyword">int</span> parseInt)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> orderFormMapper.findOrderFormById(parseInt);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findOrderFormById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.briup.bean.OrderForm&quot;</span>&gt;</span></span><br><span class="line">         select *  from es_orderform</span><br><span class="line">        where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>



<hr>
<p><strong>5.修改提交订单接口</strong></p>
<p>==先跳转到支付页面 支付完成回调订单列表==</p>
<p><strong>SubmitOrderServlet</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//resp.sendRedirect(&quot;/findAllOrder&quot;);</span></span><br><span class="line"> resp.sendRedirect(<span class="string">&quot;/pay?id=&quot;</span>+orderForm.getId());</span><br></pre></td></tr></table></figure>

<hr>
<p><strong>AlipayConfig</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   *  页面跳转同步通知页面路径 需http://格式的完整路径，不能加?id=123这类自定义参数，必须外网可以正常访问</span></span><br><span class="line"><span class="comment">   *  付款结束后跳转的页面</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> String return_url = <span class="string">&quot;http://localhost:8888/findAllOrder&quot;</span>;</span><br></pre></td></tr></table></figure>



<hr>
<p><strong>6.效果</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310741407.png" alt="image-20211025211711375"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310741773.png" alt="image-20211025211419465"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310741984.png" alt="image-20211025211611145"></p>
<h2 id="3-事务问题"><a href="#3-事务问题" class="headerlink" title="3.事务问题"></a>3.事务问题</h2><p>此处无法获取到对方接口业务</p>
<h1 id="7-内网穿透"><a href="#7-内网穿透" class="headerlink" title="7 内网穿透"></a>7 内网穿透</h1><p>1.<a target="_blank" rel="noopener" href="https://www.ngrok.cc/user.html">注册账号</a></p>
<p>2.购买服务</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310741511.png" alt="image-20210421205740360"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310741431.png" alt="image-20210421210034680"></p>
<p>3.<a target="_blank" rel="noopener" href="https://www.ngrok.cc/download.html">下载工具</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310741731.png" alt="image-20210421210648426"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310741654.png" alt="image-20210421211051357"></p>
<p>4.<a target="_blank" rel="noopener" href="http://vanse.free.idcfengye.com/">测试</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310742264.png" alt="image-20211025221147680"></p>
<p><code>此时后台tomcat要启动着</code></p>
<h1 id="8-部署linux"><a href="#8-部署linux" class="headerlink" title="8 部署linux"></a>8 部署linux</h1><h2 id="1-购买阿里云"><a href="#1-购买阿里云" class="headerlink" title="1.购买阿里云"></a>1.购买阿里云</h2><ul>
<li><p>登陆<a target="_blank" rel="noopener" href="https://developer.aliyun.com/plan/grow-up">阿里云</a></p>
</li>
<li><p>搜索云翼计划 购买学生机==9.9/月==</p>
<p><img src="https://wangsidandan.github.io/images/image-20201029143054774.png" alt="image-20201029143054774"></p>
</li>
<li><p>购买后记住ip 配置root密码</p>
</li>
<li><p>在服务器中选择操作系统 可选ubuntu16</p>
</li>
<li><p>在本地远程登陆阿里云 可使用自带xshell工具或者putty第三方工具</p>
<ul>
<li>输入阿里云账号 端口号默认22</li>
</ul>
<p><img src="https://wangsidandan.github.io/images/image-20201029145231540.png" alt="image-20201029145231540"></p>
<ul>
<li><p>登陆成功</p>
<p><img src="https://wangsidandan.github.io/images/image-20201029145437515.png" alt="image-20201029145437515"></p>
</li>
</ul>
</li>
</ul>
<h2 id="2-配置用户环境"><a href="#2-配置用户环境" class="headerlink" title="2.配置用户环境"></a>2.配置用户环境</h2><p>1.修改主机名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl set-hostname ‘ubuntu’</span><br></pre></td></tr></table></figure>



<p>然后去阿里云控制台重启服务器。</p>
<p> 2.创建非root用户</p>
<blockquote>
<p>创建普通用户：briup/briup</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adduser briup</span><br><span class="line">passwd briup</span><br></pre></td></tr></table></figure>

<p>3.给新用户授予权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sudoers</span><br></pre></td></tr></table></figure>



<p><img src="https://wangsidandan.github.io/images/image-20201029150720491.png" alt="image-20201029150720491"></p>
<p> 4.切换briup用户登陆</p>
<p><img src="https://wangsidandan.github.io/images/image-20201029150946144.png" alt="image-20201029150946144"></p>
<h2 id="3-搭建JavaWeb运行环境"><a href="#3-搭建JavaWeb运行环境" class="headerlink" title="3.搭建JavaWeb运行环境"></a>3.搭建JavaWeb运行环境</h2><blockquote>
<p>与在本地启动项目一样，需要安装JDK环境，tomcat（服务器）以及mysql</p>
</blockquote>
<p> 1.安装JDK</p>
<ul>
<li><p>apt在线安装</p>
<h2 id="openjdk"><a href="#openjdk" class="headerlink" title="openjdk"></a>openjdk</h2><p>(1)查找合适的openjdk版本:</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-cache search openjdk</span><br></pre></td></tr></table></figure>



<p>(2)安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install openjdk-8-jdk</span><br></pre></td></tr></table></figure>



<p>(3) 配置环境变量, 编辑如下文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bashrc</span><br></pre></td></tr></table></figure>



<p>在最后加上一行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64</span><br><span class="line">export PATH=$JAVA_HOME/bin:$PATH</span><br><span class="line">export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br></pre></td></tr></table></figure>

<p>(4) 测试jdk是否安装成功:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -version</span><br></pre></td></tr></table></figure>

<p>显示如下结果, 则说明安装成功:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openjdk version “1.8.0_91” </span><br><span class="line">OpenJDK Runtime Environment (build 1.8.0_91-8u91-b14-0ubuntu4~15.10.1-b14) </span><br><span class="line">OpenJDK Server VM (build 25.91-b14, mixed mode)</span><br></pre></td></tr></table></figure>

<p>oraclejdk</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.oracle.com/java/technologies/javase/javase-jdk8-downloads.html">官网下载</a></p>
<p>==注：apt下载oracle需要仓库==</p>
<p>（1）将文件放置在briup用户下</p>
<p>==<strong>ubuntu中需要安装SSHServer</strong>==</p>
<p><code>sudo apt install openssh-server</code></p>
<p>方法一：shell工具</p>
<p><img src="https://wangsidandan.github.io/images/image-20201029155706089.png" alt="image-20201029155706089"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">说明： 把本地当前目录下的Hello.java文件复制到远程目录下的Desktop/Hello.java</span><br></pre></td></tr></table></figure>

<p>方法二：filezillla</p>
<p><img src="https://wangsidandan.github.io/images/image-20201029160615567.png" alt="image-20201029160615567"></p>
<p>（2）解压jdk的包</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xvf jdk...</span><br></pre></td></tr></table></figure>



<p>（3）配置环境变量 （家目录）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bashrc</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/home/briup/jdk1.8.0_74</span><br><span class="line">			export PATH=JAVA_HOME/bin:PATH</span><br><span class="line">			export CLASSPATH=.:./bin</span><br></pre></td></tr></table></figure>

<p>(4) 使配置资源生效</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source .bashrc</span><br></pre></td></tr></table></figure></li>
</ul>
<p> 2.安装tomcat</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://tomcat.apache.org/download-80.cgi">官网下载</a></li>
</ul>
<p>同上，将安装包移到服务器即可</p>
<p> 3.安装mysql</p>
<ul>
<li><p>在线安装</p>
<p>安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install mysql-server-5.7</span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 如果无法安装，尝试更新源</span></span><br><span class="line">apt-get update</span><br><span class="line">apt-get upgrade</span><br></pre></td></tr></table></figure>

<p>开启mysql远程访问</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">user</span>,host <span class="keyword">from</span> <span class="keyword">user</span></span><br></pre></td></tr></table></figure>



<p>可看到host全是localhost，</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310742834.png" alt="image-20201029162843368"></p>
<p><strong>localhost表示只能本地登录，可以将root账号对应的host改为%即可实现远程连接（暂不考虑安全性）</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update <span class="keyword">user</span> <span class="keyword">set</span> host <span class="operator">=</span> <span class="string">&#x27;%&#x27;</span> <span class="keyword">where</span> <span class="keyword">user</span> <span class="operator">=</span> <span class="string">&#x27;root&#x27;</span></span><br></pre></td></tr></table></figure>

<p>3 设置mysql编码</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/mysql/my.cnf</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[client]</span><br><span class="line">default-character-set=utf8</span><br><span class="line">[mysqld]</span><br><span class="line">character-set-server=utf8</span><br><span class="line">max_connections=1000</span><br><span class="line">!includedir /etc/mysql/conf.d/</span><br><span class="line">!includedir /etc/mysql/mysql.conf.d/</span><br><span class="line">bind-address=0.0.0.0</span><br></pre></td></tr></table></figure>

<p>4 重启mysql服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service mysql restart</span><br></pre></td></tr></table></figure>



<p>//service mysql status 查看mysql状态</p>
<p>5 卸载mysql</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.sudo apt-get autoremove --purge mysql-server</span><br><span class="line">2.sudo apt-get remove mysql-server</span><br><span class="line">3.sudo apt-get autoremove mysql-server</span><br><span class="line">4.sudo apt-get remove mysql-common</span><br><span class="line">5.清理残留数据 dpkg -l |grep mysql|awk &#x27;&#123;print $2&#125;&#x27; |sudo xargs dpkg -P </span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="4-部署war包"><a href="#4-部署war包" class="headerlink" title="4.部署war包"></a>4.部署war包</h2><p>1.将web项目打成war包</p>
<p>2.将war包放入服务器上tomcat/webapps下面</p>
<p>3.开启服务器,会自动解压war包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">COPYcd /tomcat/bin</span><br><span class="line">./startup.sh</span><br></pre></td></tr></table></figure>

<p>4.需要的话，修改默认端口号</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">COPYvim /tomcat/conf/server.xml</span><br><span class="line">找到&lt;connect &quot;8080&quot;&gt;</span><br><span class="line">    修改成你想要的端口</span><br></pre></td></tr></table></figure>

<p>5.在阿里云控制台上开放相关端口号</p>
<p>比如8080端口，3306或者你的项目端口，否则无法访问。</p>
<h1 id="9-首页相关"><a href="#9-首页相关" class="headerlink" title="9 首页相关"></a>9 首页相关</h1><h2 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h2><p>未登录不可下单</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.Filter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterConfig;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebFilter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebFilter(&#123;&quot;/confirm&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CheckLoginFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">		</span><br><span class="line">		HttpServletRequest req = (HttpServletRequest) request;</span><br><span class="line">		</span><br><span class="line">		HttpSession session = req.getSession(<span class="keyword">false</span>);</span><br><span class="line">		<span class="keyword">if</span>(session==<span class="keyword">null</span> || session.getAttribute(<span class="string">&quot;customer&quot;</span>)==<span class="keyword">null</span>) &#123;</span><br><span class="line">			req.setAttribute(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;请先进行登录&quot;</span>);</span><br><span class="line">			req.getRequestDispatcher(<span class="string">&quot;/login.jsp&quot;</span>).forward(req, response);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			chain.doFilter(request, response);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/estore/202205310742279.png" alt="image-20211025224240429" style="zoom:50%;" />



<h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><p>servlet模板  preferences/java/editor/templates</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> $&#123;enclosing_package&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="meta">@WebServlet(&quot;/&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> $</span>&#123;primary_type_name&#125; extends HttpServlet &#123;</span><br><span class="line"> 	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		$&#123;cursor&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		doGet(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/briup/" rel="tag">briup</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/project/" rel="tag">project</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-briup/briup-springmvc"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/archives/briup/briup-springmvc.html"
    >briup-springmvc</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/archives/briup/briup-springmvc.html" class="article-date">
  <time datetime="2022-05-22T08:10:02.000Z" itemprop="datePublished">2022-05-22</time>
</a>    
    </div>
     
	
	 
	
    <div class="article-entry" itemprop="articleBody">
       
   
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-briup/briup-spring"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/archives/briup/briup-spring.html"
    >briup-spring</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/archives/briup/briup-spring.html" class="article-date">
  <time datetime="2022-05-22T08:09:51.000Z" itemprop="datePublished">2022-05-22</time>
</a>    
    </div>
     
	
	 
	
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="spring-一"><a href="#spring-一" class="headerlink" title="spring(一)"></a>spring(一)</h1><h2 id="1-Spring简介"><a href="#1-Spring简介" class="headerlink" title="1.Spring简介"></a>1.Spring简介</h2><blockquote>
<p>Spring是一个使用java语言编写的轻量级开源框架，解决了项目中的一些通用问题，例如依赖注入、切面织入等，同时还提供了项目中各种技术的一站式的解决、整合方案。</p>
</blockquote>
<p>Spring是于2003 年兴起的一个轻量级的Java 开源框架，由Rod Johnson在其著作<code>Expert One-On-One J2EE Development and Design</code>中阐述的部分理念和原型衍生而来,为了解决企业应用开发的复杂性而创建的。</p>
<p>Spring框架的主要优势之一就是其分层架构，分层架构允许使用者选择使用哪一个组件，同时为J2EE应用程序开发提供集成的框架。</p>
<p>Spring框架中的组件模块众多，不用的组件模块用来解决不同的问题，我们可以单独使用某一个模块，也可以将众多模块根据项目需要，进行自由组合。</p>
<p>Spring框架中的所有组件模块都依赖于Spring提供的俩个基础功能：是控制反转（<code>IOC</code>）和面向切面（<code>AOP</code>）。 </p>
<p>从简单性、可测试性和松耦合的角度而言，任何Java应用都可以从Spring中受益。</p>
<p><a target="_blank" rel="noopener" href="https://spring.io/">Spring 官网</a> </p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206052300462.png" alt="image-20200909195909915"></p>
<p>Spring有很多项目，不同的项目用来解决不同领域的问题，我们一般所说的Spring框架，指的是Spring的基础核心项目：<code>Spring Framework</code></p>
<p>例如，Spring官网提供的项目的列表，项目很多，这里只列出了一部分</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206052300765.png" alt="image-20201101232955221"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206052300900.png" alt="image-20201101233023912"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206052301692.png" alt="image-20201101233128076"></p>
<blockquote>
<p>注意，Spring其他项目都会依赖于核心项目<code>Spring Framework</code>的中的组件模块。</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://spring.io/projects/spring-framework">Spring Framework官网</a> </p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206052301226.png" alt="image-20200909200005767"></p>
<p><a target="_blank" rel="noopener" href="http://repo.spring.io/libs-release/org/springframework/spring/">Spring Framework下载列表</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206052301740.png" alt="image-20201101233850120"></p>
<blockquote>
<p>注意，该列表中有<code>Spring Framework</code>的每一个版本的下载</p>
</blockquote>
<h2 id="2-Spring优势"><a href="#2-Spring优势" class="headerlink" title="2.Spring优势"></a>2.Spring优势</h2><ul>
<li><p>容器性质，方便解耦，简化开发<strong>（核心）</strong></p>
<p>Spring提供的<code>IOC</code>容器，可以将对象间的依赖关系交由Spring容器进行控制，避免硬编码所造成的过度程序耦合。</p>
</li>
<li><p>AOP编程的支持<strong>（核心）</strong></p>
<p>通过Spring的<code>AOP</code>功能，方便进行面向切面的编程，许多不容易用传统OOP实现的功能可以通过AOP轻松应付。</p>
</li>
<li><p>声明式事务的支持</p>
<p>通过声明式方式灵活的进行事务的管理，提高开发效率和质量</p>
</li>
<li><p>集成各种优秀框架</p>
<p>Spring不仅不排除其他各种优秀的框架，同时对这些框架(Mybatis、Quartz等)提供了很好的支持</p>
</li>
<li><p>降低JavaEE API的使用难度</p>
<p>Spring对JavaEE API 进行了封装，使得这些API降低了使用难度</p>
</li>
</ul>
<h2 id="3-Spring模块"><a href="#3-Spring模块" class="headerlink" title="3.Spring模块"></a>3.Spring模块</h2><p>Spring-framework 框架是一个分层架构，它由大约20个模块组成，如下图所示：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206052301027.png" alt="image-20201009162424400"></p>
<p>这些模块分为Core Container、Data Access/Integration、Web、AOP（Aspect Oriented Programming）、Instrumentation和Test</p>
<p><strong>1、Core Container，核心容器</strong></p>
<p>Core Container包含有Core、Beans、Context和Expression Language模块</p>
<p>Core和Beans模块：框架的基础部分，提供反转控制（IOC）和依赖注入（DI）特性。</p>
<p>Context模块：构建于Core和Beans模块基础之上，提供了对国际化、事件传播、资源加载和对Context的透明创建的支持。ApplicationContext接口是Context模块的关键。</p>
<p>Expression Language模块：Expression Language模块提供了一个强大的表达式语言用于在运行时查询和操纵对象。</p>
<p><strong>2、Data Access/Integration，数据访问/集成部分</strong></p>
<p>Data Access/Integration层包含有JDBC、ORM、OXM、JMS和Transaction模块</p>
<p>JDBC模块：该模块提供了一个JDBC抽象层，它可以消除冗长的JDBC编码和解析数据库厂商特有的错误代码。</p>
<p>ORM模块：该模块为流行的对象-关系映射API——JPA、JDO、Hibernate、Mybatis等提供了一个交互层。利用ORM封装包，可以混合使用所有Spring提供的特性进行O/R映射。如前边提到的简单声明性事物管理。</p>
<p>OXM模块：该模块提供了一个对Object/XML映射实现的抽象层，Object/XML映射实现包括JAXB、Castor、XMLBeans、JiBX和XStream。</p>
<p>JMS模块：JMS(Java Messaging Service)模块主要包含了一些制造和消费消息的特性。</p>
<p>Transaction模块：该模块支持编程和声明性的事物管理，这些事物类必须实现特定的接口，并且对所有的POJO都适用。</p>
<p>3、<strong>Web</strong></p>
<p>Web层包含了Web、Servlet、WebSocket、Portlet模块</p>
<p>Web模块：该模块提供了基础的面向web的集成特性。例如多文件上传、使用servlet listeners初始化IoC容器以及一个面向web的应用上下文。它还包含Spring远程支持中web相关部分。</p>
<p>Servlet模块：该模块包含Spring的model-view-controller（MVC）实现。Spring的MVC框架使得模型范围内的代码和web forms之间能够清楚的分离开来，并与Spring框架的其他特性集成在一起。</p>
<p>WebSocket模块：该模块提供了对WebSocket的支持。</p>
<p>Portlet模块：提供了用于portlet环境的MVC的实现，Portlet是和Servlet类似的一种web技术。</p>
<p><strong>4、AOP和Instrumentation</strong></p>
<p>AOP模块：提供了一个符合AOP联盟标准的面向切面编程的实现，它让你可以定义方法拦截器和切点，从而将逻辑代码分开，降低它们之间的耦合性。</p>
<p>Aspects模块：提供了对AspectJ的集成支持，Spring框架的AOP功能是使用AspectJ框架来实现的。</p>
<p>Instrumentation模块提供了class instrumentation支持和classloader实现，使得可以在特定的应用服务器上使用。</p>
<p><strong>5、Test</strong></p>
<p>Test模块：支持使用JUnit和TestNG对Spring组件进行测试。</p>
<blockquote>
<p>注意，我们可以根据自己的需求，来选择引入并使用Spring Framework中不同模块的功能，并不需要一次引入所以模块对应的jar包。</p>
</blockquote>
<h2 id="4-Spring-IOC"><a href="#4-Spring-IOC" class="headerlink" title="4.Spring IOC"></a>4.Spring IOC</h2><h3 id="4-1-问题"><a href="#4-1-问题" class="headerlink" title="4.1.问题"></a>4.1.问题</h3><p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206052301633.png" alt="image-20200909165520086"></p>
<p>我们之前使用的三层架构，虽然能够在一定程度上进行解耦，但是这里也会带来一个新的问题：</p>
<ul>
<li><code>web</code>层调用<code>service</code>层，要在<code>web</code>层创建<code>service</code>层对象，然后调用其方法</li>
<li><code>service</code>层调用<code>dao</code>层，要在<code>service</code>层创建<code>dao</code>层对象，然后调用其方法</li>
</ul>
<p>也就是，Web层依赖Service的实现，Service需要依赖Dao层实现，并需要我们自己手动创建并维护该这些实现，随着项目逐渐扩展，这些创建和维护工作将会变得越来越复杂。</p>
<p>为了更好的解耦，在启动项目的过程中，提前做好以下工作：</p>
<ul>
<li>创建一个容器（例如一个Map集合即可）</li>
<li>把项目中需要的对象提前创建好，并且存入该容器中</li>
<li>每一个模块需要用到对象，提前就给该模块提供好</li>
</ul>
<p>在这种情况下，原来的代码是这样写的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginServlet</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> IUserService userService = <span class="keyword">new</span> UserServiceImpl();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//下面使用userService进行操作</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>而现在，就不用我们直接创建对象了，因为容器会自动将需要的对象其他注入到Servlet中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginServlet</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> IUserService userService;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//下面使用userService进行操作</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>可以看出，俩个模块的耦合度又降低了，并且将来可以很轻轻的更换接口的实现</p>
</blockquote>
<p>其项目图如下所示：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206052301526.png" alt="image-20200909171150553"></p>
<blockquote>
<p>注意，Spring IOC就是一个类似这样的容器</p>
</blockquote>
<h3 id="4-2-IOC"><a href="#4-2-IOC" class="headerlink" title="4.2 IOC"></a>4.2 IOC</h3><p><code>IOC (Inverse of Control)</code>  控制反转，将对象的创建以及对象依赖关系反转给Spring 容器，程序本身不进行维护。</p>
<p>Spring官方文档中给结钩图如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206052302315.png" alt="image-20201011183545095"></p>
<blockquote>
<p>注意，原来由我们自己手动创建并维护的对象，现在都可以交给Spring的IOC容器去进行管理维护</p>
</blockquote>
<h3 id="4-3-准备"><a href="#4-3-准备" class="headerlink" title="4.3 准备"></a>4.3 准备</h3><p>1、准备Spring 开发所需jar包</p>
<p>可以从官网下载，也可以从提供的资料里面找到。</p>
<p><img src="image/image-20201011184405345.png" alt="image-20201011184405345"></p>
<ul>
<li>docs : Spring API 和 规范文档说明</li>
<li>libs:  jar包以及对应的源码</li>
<li>schema: 约束</li>
</ul>
<blockquote>
<p>注意： 这里使用的Spring版本为 5.0.2.Release，对应核心功能而言，不同的版本之间差异不大</p>
</blockquote>
<p>2、将核心容器jar包以及辅助包导入项目lib目录下</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206052302589.png" alt="image-20201011193514773"></p>
<p>其中：</p>
<ul>
<li><p>lombok 不属于 Spring的核心容器，只是一个用来简化POJO类写法的工具</p>
</li>
<li><p>commons-logging / log4j 属于日志工具</p>
</li>
</ul>
<p>lombok需要Eclipse现在插件对其进行支持：</p>
<blockquote>
<p>不要放在中文目录下</p>
</blockquote>
<p>双击lombok-1.18.12.jar</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206052302035.png" alt="image-20201102004906657"></p>
<p>选择需要安装插件的STS或Eclipse</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206052302274.png" alt="image-20201102005003831"></p>
<p>点击安装：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206052302955.png" alt="image-20201102005042446"></p>
<blockquote>
<p>注意，安装成功后，需要重新启动STS或者Eclipse</p>
</blockquote>
<p>3、创建pojo类</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206052302107.png" alt="image-20201102005440635"></p>
<p>内容如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.ioc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Husband</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">double</span> salary;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由于使用了Lombok中的Data注解，该类编译后，会自动生成对应的GET/SET方法以及toString等方法：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206052302770.png" alt="image-20201102005556484"></p>
<h3 id="4-4-配置"><a href="#4-4-配置" class="headerlink" title="4.4 配置"></a>4.4 配置</h3><p>1、在src下面，创建配置文件，名字为：<code>applicationContext.xml</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206052302081.png" alt="image-20201011191654695"></p>
<p>2、xml添加头部声明</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>在Spring的官方说明文档中，可以找到模板样例：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206052302325.png" alt="image-20201011192052332"></p>
<p>3、在配置文件中添加需要被Spring容器管理的资源</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"> 	 </span><br><span class="line">  <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">  		bean标签的作用：用于配置让Spring容器创建对象</span></span><br><span class="line"><span class="comment">  			class : 要创建对象的全限定类名</span></span><br><span class="line"><span class="comment">  			name: 该对象在容器中的名字  </span></span><br><span class="line"><span class="comment">   --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;husband&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.ioc.Husband&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，SpringIOC容器管理的对象，称为bean，所以需要使用bean标签来进行配置</p>
</blockquote>
<p>这里使用了name属性，也可以使用id</p>
<ul>
<li>id: 一个bean的唯一标识 ， 命名格式必须符合XML ID属性的命名规范</li>
<li>name: 可以用特殊字符，并且一个bean可以用多个名称，例如<code>name=&quot;bean1,bean2,bean3&quot;</code></li>
<li>如果没有id，则name的第一个名称默认是id</li>
<li>如果 一个 bean 标签未指定 id、name 属性，则 spring容器会给其一个默认的id，值为其类全名</li>
<li>如果有多个bean标签未指定 id、name 属性，但是class相同，则spring容器会按照其出现的次序，分别给其指定 id 值为 “类全名#1”, “类全名#2”</li>
</ul>
<p>4、测试</p>
<p>创建测试类</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206052303546.png" alt="image-20201011192646045"></p>
<p>内容如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.ioc.Husband;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;resource&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringIoCTest</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 1.解析配置文件,创建容器</span></span><br><span class="line">		ApplicationContext ac = </span><br><span class="line">				<span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">	</span><br><span class="line">		<span class="comment">// 2.根据配置的Id值,从容器中获取对象</span></span><br><span class="line">		Husband hunsband = (Husband) ac.getBean(<span class="string">&quot;husband&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		System.out.println(hunsband);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206052303227.png" alt="image-20201102011303778"></p>
<blockquote>
<p>可以看出，此时我们已经可以从容器中（ApplicationContext对象）拿其他配置好的Husband对象了</p>
</blockquote>
<p>这里有红色警告，是因为log4j没有找到对应的配置文件，如果有需要可以src下面添加配置文件：log4j.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">log4j.rootLogger</span>=<span class="string">DEBUG, stdout </span></span><br><span class="line"><span class="meta">log4j.appender.stdout</span>=<span class="string">org.apache.log4j.ConsoleAppender </span></span><br><span class="line"><span class="meta">log4j.appender.stdout.layout</span>=<span class="string">org.apache.log4j.PatternLayout </span></span><br><span class="line"><span class="meta">log4j.appender.stdout.layout.ConversionPattern</span>=<span class="string">%d [%-5p] %c - %m%n</span></span><br></pre></td></tr></table></figure>



<h3 id="4-5-容器"><a href="#4-5-容器" class="headerlink" title="4.5 容器"></a>4.5 容器</h3><p>SpringIOC容器（ApplicationContext）继承关系图如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206052303612.png" alt="image-20201011194054333"></p>
<p>容器的顶层接口是 <code>BeanFactory</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206052303672.png" alt="image-20201011200215290"></p>
<p><code>BeanFactory</code>和<code>ApplicationContext</code>的区别</p>
<ul>
<li><p>BeanFactory是Spring容器的顶层接口，ApplicationContext是其子接口</p>
</li>
<li><p>ApplicationContext接口,它由BeanFactory接口派生而来，包含BeanFactory的所有功能</p>
</li>
<li><p>BeanFactory 创建容器时不会创建对象，当从容器里面获取对象时才会创建</p>
</li>
<li><p>ApplicationContext 创建容器时就会创建对象</p>
</li>
</ul>
<p><code>ApplicationContext</code>接口的实现类</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206052303346.png" alt="image-20201011201743451"></p>
<p>1、<code>ClassPathXmlApplication</code></p>
<p>从类的根路径下加载配置文件</p>
<p>2、<code>FileSystemXmlApplication</code></p>
<p>从磁盘路径加载配置文件，配置文件可以在磁盘任何位置</p>
<p>一般不适用  d:// </p>
<p>3、<code>AnnotationConfigApplicationContext</code></p>
<p>用注解配置容器对象时，需要使用此类来创建spring容器</p>
<p>在配置文件中配置对象，如果没有id或者name的时候，可以通过Class类型的对象来获取</p>
<p>例如：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span> </span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.ioc.Husband&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.ioc.Husband;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;resource&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringIoCTest</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		ApplicationContext ac = </span><br><span class="line">				<span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">	</span><br><span class="line">		Husband hunsband = ac.getBean(Husband.class);</span><br><span class="line">		</span><br><span class="line">		System.out.println(hunsband);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>结果如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206052304380.png" alt="image-20201102012119735"></p>
<p>除此之外，也可以工厂的方式来创建并获取对象：</p>
<p><strong>1、静态工厂方式</strong></p>
<p>创建工厂类</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206052304771.png" alt="image-20201011210933773"></p>
<p>内容如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.ioc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HusbandStaticFactory</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//静态方法</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Husband <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Husband();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>修改配置文件，内容如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span> </span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">		class 工厂类的全限定类名</span></span><br><span class="line"><span class="comment">		factory-method 工厂类里面的静态方法</span></span><br><span class="line"><span class="comment">	 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;husband&quot;</span>  <span class="attr">class</span>=<span class="string">&quot;com.briup.ioc.HusbandStaticFactory&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;getInstance&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>测试代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.ioc.Husband;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;resource&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringIoCTest</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 1.解析配置文件,创建容器</span></span><br><span class="line">		ApplicationContext ac = </span><br><span class="line">				<span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">		<span class="comment">// 2.根据配置的Id值,从容器中获取对象</span></span><br><span class="line">		Husband husband = (Husband) ac.getBean(<span class="string">&quot;husband&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		System.out.println(husband);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206052304267.png" alt="image-20201102012603969"></p>
<p><strong>2、普通工厂创建方式</strong></p>
<p>创建工厂类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.ioc;</span><br><span class="line"></span><br><span class="line"><span class="comment">//普通工厂类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HusbandFactory</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Husband <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Husband h = <span class="keyword">new</span> Husband();</span><br><span class="line">		h.setId(<span class="number">1</span>);</span><br><span class="line">		h.setName(<span class="string">&quot;tom&quot;</span>);</span><br><span class="line">		h.setSalary(<span class="number">2000</span>);</span><br><span class="line">		<span class="keyword">return</span> h;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>配置文件内容如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span> </span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">		配置工厂，让Spring容器产生工厂实例</span></span><br><span class="line"><span class="comment">	 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;factory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.ioc.HusbandFactory&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">		factory-bean   工厂实例在Spring容器中的唯一标识</span></span><br><span class="line"><span class="comment">		factory-method 工厂实例中的方法</span></span><br><span class="line"><span class="comment">	 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;husband&quot;</span> <span class="attr">factory-bean</span>=<span class="string">&quot;factory&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;getInstance&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>测试代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.ioc.Husband;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;resource&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringIoCTest</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 1.解析配置文件,创建容器</span></span><br><span class="line">		ApplicationContext ac = </span><br><span class="line">				<span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">		<span class="comment">// 2.根据配置的名字,从容器中获取对象</span></span><br><span class="line">		Husband husband = (Husband) ac.getBean(<span class="string">&quot;husband&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//也可以如下获取</span></span><br><span class="line">        <span class="comment">//Husband husband = ac.getBean(Husband.class);</span></span><br><span class="line"></span><br><span class="line">		</span><br><span class="line">		System.out.println(husband);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>测试结果如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206052304712.png" alt="image-20201102013128338"></p>
<h3 id="4-7-bean"><a href="#4-7-bean" class="headerlink" title="4.7  bean"></a>4.7  bean</h3><p>1、<code>&lt;bean&gt;</code>标签的作用</p>
<ul>
<li><p>用于配置让spring容器来创建对象</p>
</li>
<li><p>默认情况下它调用的是类中的无参构造函数（反射）</p>
</li>
</ul>
<p>2、<code>&lt;bean&gt;</code>标签的属性</p>
<ul>
<li><p><code>id</code> 给在容器中的对象提供一个唯一标识，用来获取对象</p>
</li>
<li><p><code>name</code>功能类似id，命名要求没有id严格</p>
</li>
<li><p><code>class</code> 指定类的全限定类名。用于反射创建对象。默认情况下调用无参构造函数</p>
</li>
<li><p><code>scope</code> 指定对象范围</p>
<ul>
<li><p><code>sigleton</code> 默认值，单例</p>
</li>
<li><p><code>prototype</code> 多例</p>
</li>
<li><p><code>request</code> WEB项目中,Spring容器创建一个Bean对象，会将该对象存入request</p>
</li>
<li><p><code>session</code> WEB项目中，Spring容器创建一个Bean对象，会将该对象存入session</p>
</li>
<li><p><code>golbal session</code> 只有应用在基于portlet的Web应用程序中才有意义，它映射到portlet的global范围的session</p>
</li>
</ul>
</li>
<li><p><code>init-method</code>: 指定类的初始化方法的名称</p>
</li>
<li><p><code>destory-method</code>: 指定类中销毁方法的名称</p>
</li>
<li><p><code>lazy-init</code>：指定使用进行延迟加载</p>
</li>
</ul>
<blockquote>
<p>注意: destory-method 需要销毁容器才能生效,并且必须是单例模式</p>
</blockquote>
<p>单例和多例的区别：</p>
<p><code>scope=&quot;singleton&quot;</code>一个应用只有一个对象的实例（默认值）</p>
<ul>
<li>创建容器时，对象就被创建了</li>
<li>只要容器不销毁，对象一直存在    </li>
<li>当容器销毁时，对象就被销毁了</li>
</ul>
<p><code>scope=&quot;prototype&quot;</code>每次访问获取对象，都会重新创建对象实例。</p>
<ul>
<li>当从容器中获取对象时，创建新的对象实例</li>
<li>只要对象在使用中，就一直存在</li>
<li>当对象长时间不用时，被java的垃圾回收器回收</li>
</ul>
<blockquote>
<p>最后，理解Spring IOC的特点，本来是我们自己手动创建、管理、维护的对象，现在都交给了Spring容器来进行操作了，我们只要在需要用的时候去容器中拿就可以了。</p>
</blockquote>
<h2 id="5-Spring-DI"><a href="#5-Spring-DI" class="headerlink" title="5.Spring DI"></a>5.Spring DI</h2><h3 id="5-1-概述"><a href="#5-1-概述" class="headerlink" title="5.1 概述"></a>5.1 概述</h3><blockquote>
<p>DI(Denpendency Injection)，依赖注入，SpringIOC容器中的核心操作，可以将对象需要的属性值自动注入</p>
</blockquote>
<p>使用<code>&lt;bean&gt;</code>标签，可以将一个类配置到Spring的IOC容器中，将其进行对象的管理工作，包括对象的创建、出初始化、销毁等。</p>
<p>如果一个对象的初始化需要依赖一些属性值或者其他对象，那么就Spring中的DI就可以帮我们来完成对象初始化时候属性的依赖注入工作。</p>
<p>特别是在，项目中有很多对象，并且对象之间还存在着各种依赖关系，那么springIOC容器就可以帮我们来进行管理和建立这些对象之间的关系。</p>
<h3 id="5-2-set方法注入"><a href="#5-2-set方法注入" class="headerlink" title="5.2 set方法注入"></a>5.2 set方法注入</h3><p>1、POJO类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.ioc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Husband</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">double</span> salary;</span><br><span class="line">	<span class="keyword">private</span> Date date;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>2、配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">		property 给属性采用set方法赋值</span></span><br><span class="line"><span class="comment">			name : 属性名，调用该属性的set方法</span></span><br><span class="line"><span class="comment">			value: 属性值，通过set方法赋值</span></span><br><span class="line"><span class="comment">			ref: 属性是其他bean类型采用ref(字符串除外)</span></span><br><span class="line"><span class="comment">	</span></span><br><span class="line"><span class="comment">	 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;hunsband&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.ioc.Hunsband&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;tom&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;salary&quot;</span> <span class="attr">value</span>=<span class="string">&quot;2000&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;date&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;now&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;now&quot;</span> <span class="attr">class</span>=<span class="string">&quot;java.util.Date&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>3、测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.ioc.Husband;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;resource&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringIoCTest</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		ApplicationContext ac = </span><br><span class="line">				<span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">		Husband husband = (Husband) ac.getBean(<span class="string">&quot;husband&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		System.out.println(husband);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206052304603.png" alt="image-20201102015305848"></p>
<h3 id="5-3-构造器注入"><a href="#5-3-构造器注入" class="headerlink" title="5.3 构造器注入"></a>5.3 构造器注入</h3><p>1、POJO</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.ioc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Husband</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">double</span> salary;</span><br><span class="line">	<span class="keyword">private</span> Date date;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>其中：</p>
<p><code>@AllArgsConstructor</code>注解，可以给类中自动添加全参构造器</p>
<p><code>@NoArgsConstructor</code>注解，可以给类中自动添加无参构造器</p>
<p>2、配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span> </span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">		constructor-arg 让属性赋值采用构造函数赋值</span></span><br><span class="line"><span class="comment">			index: 指定参数在构造函数中的索引位置</span></span><br><span class="line"><span class="comment">			type: 指定参数在构造函数中的数据类型</span></span><br><span class="line"><span class="comment">			name: 指定参数在构造函数中的名字</span></span><br><span class="line"><span class="comment">			value: 具体的参数值</span></span><br><span class="line"><span class="comment">			ref: 如果需要的数据为其他bean类型，使用ref</span></span><br><span class="line"><span class="comment">	</span></span><br><span class="line"><span class="comment">	 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;husband&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.ioc.Husband&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span>	</span><br><span class="line">		<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;mary&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span>	</span><br><span class="line">		<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;salary&quot;</span> <span class="attr">value</span>=<span class="string">&quot;3000&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span>	</span><br><span class="line">		<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;date&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;now&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span>	</span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;now&quot;</span> <span class="attr">class</span>=<span class="string">&quot;java.util.Date&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>或者也可以使用构造器参数的下标进行注入：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;husband&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.ioc.Husband&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">&quot;0&quot;</span> <span class="attr">value</span>=<span class="string">&quot;3&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">&quot;1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;lucy&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">&quot;2&quot;</span> <span class="attr">value</span>=<span class="string">&quot;5000&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">&quot;3&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;now&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span>  </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;now&quot;</span> <span class="attr">class</span>=<span class="string">&quot;java.util.Date&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>





<p>3、测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.ioc.Husband;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;resource&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringIoCTest</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		ApplicationContext ac = </span><br><span class="line">				<span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">		Husband husband = (Husband) ac.getBean(<span class="string">&quot;husband&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		System.out.println(husband);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206052304341.png" alt="image-20201102015746518"></p>
<h3 id="5-4-名称空间注入"><a href="#5-4-名称空间注入" class="headerlink" title="5.4 名称空间注入"></a>5.4 名称空间注入</h3><p>1、POJO类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.ioc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Husband</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">double</span> salary;</span><br><span class="line">	<span class="keyword">private</span> Date date;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>2、配置</p>
<p>xml文件的添加p名称空间的声明，这里p指的的是property</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206052304137.png" alt="image-20201011222524796"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span> </span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;husband&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.ioc.Husband&quot;</span> <span class="attr">p:id</span>=<span class="string">&quot;3&quot;</span> <span class="attr">p:name</span>=<span class="string">&quot;lucy&quot;</span> <span class="attr">p:salary</span>=<span class="string">&quot;4000&quot;</span> <span class="attr">p:date-ref</span>=<span class="string">&quot;now&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;now&quot;</span> <span class="attr">class</span>=<span class="string">&quot;java.util.Date&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>3、测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.ioc.Husband;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;resource&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringIoCTest</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		ApplicationContext ac = </span><br><span class="line">				<span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">		Husband husband = (Husband) ac.getBean(<span class="string">&quot;husband&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		System.out.println(husband);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206052304433.png" alt="image-20201102020150931"></p>
<blockquote>
<p>注意，该方式只是简化了依赖注入的配置，其实本质仍然是调用类中的set方法实现注入功能</p>
</blockquote>
<h3 id="5-5-集合属性注入"><a href="#5-5-集合属性注入" class="headerlink" title="5.5 集合属性注入"></a>5.5 集合属性注入</h3><p>1、POJO类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.ioc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Entity</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String[] myStrs;</span><br><span class="line">	<span class="keyword">private</span> List&lt;String&gt; myList;</span><br><span class="line">	<span class="keyword">private</span> Set&lt;String&gt; mySet;</span><br><span class="line">	<span class="keyword">private</span> Map&lt;String, String&gt; myMap;</span><br><span class="line">	<span class="keyword">private</span> Properties myProps;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>2、配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span> </span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;entity&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.ioc.Entity&quot;</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 注入数组 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;myStrs&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">value</span>&gt;</span>AAA<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">value</span>&gt;</span>BBB<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">value</span>&gt;</span>CCC<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">&lt;!-- 注入List --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;myList&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">value</span>&gt;</span>DDD<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">value</span>&gt;</span>EEE<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">value</span>&gt;</span>FFF<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">			</span><br><span class="line">		<span class="comment">&lt;!-- 注入Set --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;mySet&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">value</span>&gt;</span>GGG<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">value</span>&gt;</span>KKK<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">value</span>&gt;</span>LLL<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">				</span><br><span class="line">		<span class="comment">&lt;!-- 注入myMap --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;myMap&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">				<span class="comment">&lt;!-- 俩种形式都可以注入 --&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;tom&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;age&quot;</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">value</span>&gt;</span>20<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		<span class="comment">&lt;!-- 注入Properties --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;myProps&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;name&quot;</span>&gt;</span>mary<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;age&quot;</span>&gt;</span>30<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>3、测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.ioc.Entity;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;resource&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringIoCTest</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		ApplicationContext ac = </span><br><span class="line">				<span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		Entity entity = (Entity) ac.getBean(<span class="string">&quot;entity&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		System.out.println(entity);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206052304568.png" alt="image-20201102020821042"></p>
<h2 id="6-Spring注解"><a href="#6-Spring注解" class="headerlink" title="6.Spring注解"></a>6.Spring注解</h2><blockquote>
<p>spring中除了使用xml方式进行注入外，还可以使用注解的方式进行注入</p>
</blockquote>
<h3 id="6-1-使用"><a href="#6-1-使用" class="headerlink" title="6.1 使用"></a>6.1 使用</h3><p>1、POJO类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.ioc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Component</span> 该注解加在类上代表该类需要让Spring容器去创建对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Teacher</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@Value</span>  用来给属性注入数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Value(&quot;1&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Value(&quot;tom&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Value(&quot;20&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>2、配置</p>
<p>xml文件的添加context名称空间的声明，已经其对对应schema文件的声明</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206052305292.png" alt="image-20201012161118498"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置要扫描的注解包 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.briup.ioc&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意约束有三处地方要修改</p>
</blockquote>
<p>3、引入jar包</p>
<p>使用该功能，需要额外引入jar包：spring-aop-5.x.x.RELEASE.jar</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206052305827.png" alt="image-20201102022052966"></p>
<p>否则在运行的时候会报错：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Caused by: java.lang.ClassNotFoundException: org.springframework.aop.TargetSource</span><br><span class="line">	at java.net.URLClassLoader.findClass(URLClassLoader.java:<span class="number">381</span>)</span><br><span class="line">	at java.lang.ClassLoader.loadClass(ClassLoader.java:<span class="number">424</span>)</span><br><span class="line">	at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:<span class="number">331</span>)</span><br><span class="line">	at java.lang.ClassLoader.loadClass(ClassLoader.java:<span class="number">357</span>)</span><br><span class="line">	... <span class="number">25</span> more</span><br></pre></td></tr></table></figure>



<p>4、测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.ioc.Teacher;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;resource&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringIoCTest</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		ApplicationContext ac = </span><br><span class="line">				<span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		Teacher teacher = (Teacher) ac.getBean(<span class="string">&quot;teacher&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		System.out.println(teacher);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206052305415.png" alt="image-20201102022229321"></p>
<h3 id="6-2-常用"><a href="#6-2-常用" class="headerlink" title="6.2 常用"></a>6.2 常用</h3><p>Spring中常用的注解有以下几个：</p>
<ul>
<li><p><code>@Component</code></p>
<p>作用：</p>
<p>​    让spring容器来管理对象，相当于在xml中配置一个bean。</p>
<p>属性：</p>
<p>​    value: 指定bean的名字，如果不指定，默认为当前类名且首字母小写</p>
</li>
<li><p><code>@Controller</code>,<code>@Service</code>,<code>@Repository</code></p>
<p>作用：</p>
<p>​     功能与<code>@Component</code>作用一样，只不过其语义更加明确</p>
<p>​    <code>@Controller</code> 一般作用于 表现层</p>
<p>​    <code>@Service</code> 一般作用于 业务层</p>
<p>​    <code>@Repository</code> 一般作用于 持久层</p>
<p>属性：</p>
<p>​    value : 指定bean的名字,如果不指定，默认为当前类名，且首字母小写</p>
</li>
<li><p><code>@Value</code></p>
<p>作用：</p>
<p>​    用于给属性注入基本数据，此注解中还支持SpEL</p>
<p>属性：</p>
<p>​    value :具体的属性值</p>
</li>
<li><p><code>@Autowaired</code></p>
<p>作用：</p>
<p>​    自动按照类型注入，使用注解注入属性时，set方法可以省略，该注解只能注入bean类型，当有多个相同类型时，将bean的名字作为要注入对象的属性名，也可以注入成功</p>
</li>
<li><p><code>@Qualifier</code></p>
<p>作用：</p>
<p>​        在<code>@Autowaired</code>注入的基础之上，再按照Bean的名字注入。在给属性注入数据时不能独立使用，必须和<code>@Autowaired</code>一起使用</p>
</li>
</ul>
<p>  属性：</p>
<p>  ​    value：指定bean的名字</p>
<ul>
<li><p><code>@Resource</code></p>
<p>作用：</p>
<p>​        直接按照bean的id注入,只能注入bean类型</p>
<p>属性：</p>
<p>​        name: bean的名字</p>
</li>
<li><p><code>@Scope</code></p>
<p>作用：</p>
<p>​    指定bean的作用范围</p>
<p>属性：</p>
<p>​    value: 指定范围值</p>
<p>​    取值为： <code>singleton</code>,<code>prototype</code>,<code>request</code>,<code>session</code>,<code>golbalsession</code></p>
</li>
<li><p><code>@PostConstruct</code></p>
<p>作用：</p>
<p>​    指定初始化方法</p>
</li>
<li><p><code>@PreDestroy </code></p>
<p>作用：</p>
<p>​    指定销毁方法</p>
</li>
</ul>
<h3 id="6-3-特殊"><a href="#6-3-特殊" class="headerlink" title="6.3  特殊"></a>6.3  特殊</h3><blockquote>
<p>其实也可以去掉xml文件，全部使用注解的方式完成ICO和DI配置和操作，但是需要使用专门的容器类型：AnnotationConfigApplicationContext</p>
</blockquote>
<p>1、POJO类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.ioc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Teacher</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Value(&quot;1&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Value(&quot;tom&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Value(&quot;20&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这里没有指定Teacher在容器中名字，默认是类名首字母小写，也可以手动去指定 <code>@Component(&quot;teacher&quot;)</code></p>
</blockquote>
<p>2、测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.annataion;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.AnnotationConfigApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AnnoTationTest</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		</span><br><span class="line">		ApplicationContext ac = </span><br><span class="line">				<span class="keyword">new</span> AnnotationConfigApplicationContext(<span class="string">&quot;com.briup.ioc&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		Teacher teacher = (Teacher) ac.getBean(<span class="string">&quot;teacher&quot;</span>);</span><br><span class="line">        </span><br><span class="line">		System.out.println(teacher);		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206052305457.png" alt="image-20201102025813812"></p>
<blockquote>
<p>注意，这里使用AnnotationConfigApplicationContext类型作为容器对象，其参数是要扫描的包</p>
</blockquote>
<blockquote>
<p>注意，记得引入jar包spring-aop-5.x.x.RELEASE.jar</p>
</blockquote>
<p>==思考，如果新增一个类Address，然后Teacher中依赖这个类的对象，那么使用xml和注解分别该怎么配置？==</p>
<h3 id="6-4-新增"><a href="#6-4-新增" class="headerlink" title="6.4 新增"></a>6.4 新增</h3><blockquote>
<p>除了以上的常用注解之外，spring中还新增的一些注解类，可以使用这些注解来代替之前xml的配置</p>
</blockquote>
<h3 id="6-1-Configuration"><a href="#6-1-Configuration" class="headerlink" title="6.1 @Configuration"></a>6.1 <code>@Configuration</code></h3><p>作用：</p>
<ul>
<li><p>用于指定当前类是一个spring配置类，当创建容器时会从该类上加载注解</p>
</li>
<li><p>可以使用AnnotationConfigApplicationContext(配置类.class) 加载配置</p>
</li>
</ul>
<p>例如，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Configuration</span></span></span><br><span class="line"><span class="comment"> * 表示当前类是spring的一个配置类</span></span><br><span class="line"><span class="comment"> * 相当于之前的xml，可以完成其对应的配置功能</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="6-2-ComponentScan"><a href="#6-2-ComponentScan" class="headerlink" title="6.2 @ComponentScan"></a>6.2 <code>@ComponentScan</code></h3><p>作用：</p>
<ul>
<li>用于指定spring在初始化容器时要扫描的包</li>
</ul>
<p>例如，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Configuration</span></span></span><br><span class="line"><span class="comment"> * 表示当前类是spring的一个配置类</span></span><br><span class="line"><span class="comment"> * 相当于之前的xml，可以完成其对应的配置功能</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ComponentScan</span>(&quot;com.briup.ioc&quot;)</span></span><br><span class="line"><span class="comment"> * 扫描当前包和指定包下面的java类，发现其中spring注解</span></span><br><span class="line"><span class="comment"> * 包含指定包下面的子包</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.briup.ioc&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="6-3-Bean"><a href="#6-3-Bean" class="headerlink" title="6.3 @Bean"></a>6.3 <code>@Bean</code></h3><p>作用：</p>
<ul>
<li>该注解只能写在方法上，表明使用此方法创建一个对象，并且放入spring容器</li>
</ul>
<p>例如，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.ioc.Teacher;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConfig</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 一个<span class="doctag">@Bean</span>注解就相当于bean标签</span></span><br><span class="line"><span class="comment">	 * 方法的返回值对象会存储在Spring容器中</span></span><br><span class="line"><span class="comment">	 * 方法名就是该对象在容器中的唯一标识 </span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Teacher <span class="title">teacher</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Teacher();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，也可以手动指定名字，例如<code>@Bean(&quot;teacher&quot;)</code></p>
</blockquote>
<h3 id="6-4-PropertySource"><a href="#6-4-PropertySource" class="headerlink" title="6.4 @PropertySource"></a>6.4 <code>@PropertySource</code></h3><p>作用：</p>
<ul>
<li>用于加载<code>.properties</code>文件中的值，加载后可以使用 <code>@Value(&quot;$&#123;key&#125;&quot;)</code>的形式来获取</li>
</ul>
<p>例如，</p>
<p>POJO类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.ioc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Teacher</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>配置类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.PropertySource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.ioc.Teacher;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;my-value.properties&quot;)</span><span class="comment">//指定要读取的资源文件位置</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConfig</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Value(&quot;$&#123;teacher.id&#125;&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">	<span class="meta">@Value(&quot;$&#123;teacher.name&#125;&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="meta">@Value(&quot;$&#123;teacher.age&#125;&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Bean(&quot;t&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Teacher <span class="title">teacher</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Teacher t = <span class="keyword">new</span> Teacher();</span><br><span class="line">		t.setId(id);</span><br><span class="line">		t.setName(name);</span><br><span class="line">		t.setAge(age);</span><br><span class="line">		<span class="keyword">return</span> t;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>properties文件：my-value.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">teacher.id</span>=<span class="string">2</span></span><br><span class="line"><span class="meta">teacher.name</span>=<span class="string">mary</span></span><br><span class="line"><span class="meta">teacher.age</span>=<span class="string">30</span></span><br></pre></td></tr></table></figure>



<p>测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.AnnotationConfigApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.config.SpringConfig;</span><br><span class="line"><span class="keyword">import</span> com.briup.ioc.Teacher;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;resource&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringIoCTest</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">        <span class="comment">//指定要加载的配置类</span></span><br><span class="line">		ApplicationContext ac = </span><br><span class="line">				<span class="keyword">new</span> AnnotationConfigApplicationContext(SpringConfig.class);</span><br><span class="line">		</span><br><span class="line">		Teacher teacher = (Teacher) ac.getBean(<span class="string">&quot;t&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		System.out.println(teacher);	</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206052305502.png" alt="image-20201102030345032"></p>
<h3 id="6-5-Import"><a href="#6-5-Import" class="headerlink" title="6.5 @Import"></a>6.5 <code>@Import</code></h3><p>作用：</p>
<ul>
<li>用于导入其他配置类</li>
<li>被引入配置类中，可以不用再写<code>@Configuration</code>注解。当然，写上也没问题</li>
<li>一般项目中写了很多配置类的时候，可以再写一个总的配置类，这个配置类上使用<code>@Import</code>去引入其他的配置，将来容器只要读取这个一个总的配置类即可</li>
</ul>
<p>例如，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.PropertySource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.ioc.Teacher;</span><br><span class="line"></span><br><span class="line"><span class="meta">@PropertySource(&quot;my-value.properties&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConfig</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Value(&quot;$&#123;teacher.id&#125;&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">	<span class="meta">@Value(&quot;$&#123;teacher.name&#125;&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="meta">@Value(&quot;$&#123;teacher.age&#125;&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Bean(&quot;t&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Teacher <span class="title">teacher</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Teacher t = <span class="keyword">new</span> Teacher();</span><br><span class="line">		t.setId(id);</span><br><span class="line">		t.setName(name);</span><br><span class="line">		t.setAge(age);</span><br><span class="line">		<span class="keyword">return</span> t;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，该配置类将会在其他配置中使用@Import引入，所以可以不添加@Configuration注解</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Import;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Import(value = &#123;SpringConfig.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，该配置类做一个总的配置，引入其他的配置</p>
</blockquote>
<p>测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.AnnotationConfigApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.config.AppConfig;</span><br><span class="line"><span class="keyword">import</span> com.briup.ioc.Teacher;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;resource&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringIoCTest</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		ApplicationContext ac = </span><br><span class="line">				<span class="keyword">new</span> AnnotationConfigApplicationContext(AppConfig.class);</span><br><span class="line">		</span><br><span class="line">		Teacher teacher = (Teacher) ac.getBean(<span class="string">&quot;t&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		System.out.println(teacher);	</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206052305807.png" alt="image-20201102031229401"></p>
<blockquote>
<p>可以看出，此时也可以正常的完成功能</p>
</blockquote>
<h3 id="6-6-总结"><a href="#6-6-总结" class="headerlink" title="6.6 总结"></a>6.6 总结</h3><p>到此位置，我们已经认识了spring中的三种配置方式：</p>
<ul>
<li>xml配置</li>
<li>annotation配置</li>
<li>javaconfig配置</li>
</ul>
<p>1、xml配置，可以把配置信息都写在xml中，方便阅读、维护和修改。</p>
<p>2、annotation配置，可以使用注解来代替xml中的标签，在java代码中配置，但是这种方式，会让配置信息分散在各个java类中，虽然简化了xml的繁琐配置，但是不方便阅读、维护和修改。</p>
<p>3、javaconfig配置，主要是使用了<code>@Configuration</code>注解，来代替原来的xml配置，可以将配置信息较为<strong>集中</strong>的写在一个java类中，并且还提供了相关的配套的其他注解类，解决了使用普通注解配置的一些问题。同时将来配合<strong>条件注解</strong>可以完成一些高级的配置功能。例如springboot中使用的自动配置等</p>
<blockquote>
<p>注意，根据当前项目的情况，灵活的选择合适的配置方式，如果有需要也可以将多种配置方式混合使用</p>
</blockquote>
<h2 id="7-Spring-Test"><a href="#7-Spring-Test" class="headerlink" title="7.Spring Test"></a>7.Spring Test</h2><blockquote>
<p>Spring框架中，也整合了Junit测试框架，可以更加方便的对使用了Spring框架的项目进行单元测试</p>
</blockquote>
<h3 id="7-1准备"><a href="#7-1准备" class="headerlink" title="7.1准备"></a>7.1准备</h3><p>1、导入spring-test测试模块jar包和Junit单元测试框架</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206052305839.png" alt="image-20201102033141460"></p>
<blockquote>
<p>注意，Junit5中可以兼容Junit4的功能</p>
</blockquote>
<p>2、POJO类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.ioc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Value(&quot;1&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Value(&quot;tom&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>3、配置类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.briup.ioc&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这里可以使用配置文件中添加扫描注解的方式</p>
</blockquote>
<h3 id="7-2-JUnit4"><a href="#7-2-JUnit4" class="headerlink" title="7.2 JUnit4"></a>7.2 JUnit4</h3><p>1、测试类<code>SpringJUnit4Test</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.config.TestConfig;</span><br><span class="line"><span class="keyword">import</span> com.briup.ioc.Student;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(classes=TestConfig.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringJUnit4Test</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> Student student;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@org</span>.junit.<span class="function">Test</span></span><br><span class="line"><span class="function">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(student);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206052305169.png" alt="image-20201102033936521"></p>
<blockquote>
<p>可以看出，测试Spring代码更加方便了，不需要注解手动创建容器和获取对象了</p>
<p><code>@Autowired</code>注解，指的让容器把需要的对象进行自动注入</p>
</blockquote>
<p>其中：</p>
<p><code>@RunWith(SpringJUnit4ClassRunner.class)</code> :</p>
<ul>
<li><p>指明使用什么类来创建容器</p>
</li>
<li><p>也可以写成 <code>@RunWith(SpringRunner.class)</code></p>
</li>
</ul>
<p><code>@ContextConfiguration(classes=TestConfig.class)</code>:</p>
<ul>
<li><p><code>location</code> 导入具体的配置文件，如果有的话</p>
<p>例如，@ContextConfiguration(locations = “classpath:applicationContext.xml”)</p>
</li>
<li><p><code>classes</code> 导入具体的配置类，如果有的话</p>
</li>
</ul>
<h3 id="7-5-JUnit5"><a href="#7-5-JUnit5" class="headerlink" title="7.5 JUnit5"></a>7.5 JUnit5</h3><p>1、新增配置类<code>SpringJUnit5Test</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.extension.ExtendWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit.jupiter.SpringExtension;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ExtendWith(SpringExtension.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(classes=TestConfig.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringJUnit5Test</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> Student student;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@org</span>.junit.jupiter.api.<span class="function">Test</span></span><br><span class="line"><span class="function">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(student);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，<code>@ExtendWith(SpringExtension.class)</code> 是配置JUnit Jupiter使用Spring支持扩展测试</p>
</blockquote>
<p><img src="image/image-20201102033929894.png" alt="image-20201102033929894"></p>
<p>如果是Junit5，可以使用下面方式简化配置：</p>
<p><code>@SpringJUnitConfig(classes = TestConfig.class)</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit.jupiter.SpringJUnitConfig;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringJUnitConfig(classes = TestConfig.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringJUnit5Test</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> Student student;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@org</span>.junit.jupiter.api.<span class="function">Test</span></span><br><span class="line"><span class="function">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(student);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206052305572.png" alt="image-20201102034028533"></p>
<blockquote>
<p>可以看出，其效果是一样的</p>
</blockquote>
<h1 id="spring-二"><a href="#spring-二" class="headerlink" title="spring(二)"></a>spring(二)</h1><h2 id="1-代理模式"><a href="#1-代理模式" class="headerlink" title="1.代理模式"></a>1.代理模式</h2><blockquote>
<p>代理模式是一种常见的设计模式，它提供间接对目标对象访问的方式，通过代理对象访问目标对象，从而在在目标对象现有的功能能上，增加额外的功能补充，实现扩展目标对象的功能</p>
</blockquote>
<p>例如，</p>
<p>Tom想邀请明星Mary演唱一首歌曲，但是Tom并不是直接和明星Mary沟通，而是联系明星的经纪人Lucy。</p>
<p>在这个过程中，明星Mary只要负责活动中核心内容的完成（演唱），其他的事情就交给他的经纪人Lucy来处理。</p>
<p>Mary是一个目标对象，用户（Tom）最终想完成目标对象的演唱功能，Lucy就是一个代理对象，不仅可以最终完成演唱功能，同时还能完成演唱之外的其他事情的处理。</p>
<p>没有代理的情况：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206080823247.png" alt="image-20201102165627765"></p>
<p>有代理的情况：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206080823874.png" alt="image-20201102165728572"></p>
<blockquote>
<p>可以看出，在不改变目标对象功能的基础上，使用代理对象，可以给目标对象添加的额外的功能。</p>
</blockquote>
<p>例如，</p>
<p>Web层调用Service层，完成业务逻辑处理：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206080823665.png" alt="image-20201102170538574"></p>
<p>如果在完成业务逻辑处理之外，需要再完成一些其他辅助工作，例如日志记录、事务管理、权限判断、参数处理等，但是要求不能改变原有的service层代码，那么此时可以使用代理对象再完成此功能：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206080823576.png" alt="image-20201102170727662"></p>
<blockquote>
<p>可以看出，service层对象只负责完成核心的业务处理，其他辅助工作全都交给代理对象来完成</p>
</blockquote>
<h2 id="2-代码实现"><a href="#2-代码实现" class="headerlink" title="2.代码实现"></a>2.代码实现</h2><p>对应的类图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206080823381.png" alt="image-20201014144539179"></p>
<p>代理模式主要包含三个角色：</p>
<ul>
<li><p>主题类角色</p>
<p>可以是接口，也可以是抽象类，需要让目标对象和代理对象去实现或者继承，目的是为了让目标对象和代理对象具有相同的方法</p>
</li>
<li><p>目标类角色</p>
<p>它的对象就是目标对象，核心业务逻辑的具体执行者</p>
</li>
<li><p>代理类角色</p>
<p>它的对象就是代理对象，内部含有对真实目标对象的引用，负责对目标对象方法的调用，并且在调用前后进行预处理</p>
</li>
</ul>
<p>例如，</p>
<p>公共接口<code>Singer</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Singer</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">sing</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>目标类<code>Target</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Target</span> <span class="keyword">implements</span> <span class="title">Singer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sing</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;目标对象进行歌曲演唱&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>代理类<code>Proxy</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Proxy</span> <span class="keyword">implements</span> <span class="title">Singer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//代理对象中，需要持有真正的目标对象的引用</span></span><br><span class="line">	<span class="comment">//其目的是在完成辅助工作之后，使用目标对象来完成真正的核心工作</span></span><br><span class="line">	<span class="keyword">private</span> Singer target;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Proxy</span><span class="params">(Singer target)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.target = target;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sing</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">//完成各种各种工作</span></span><br><span class="line">		System.out.println(<span class="string">&quot;安排时间&quot;</span>);</span><br><span class="line">		System.out.println(<span class="string">&quot;联系场地&quot;</span>);</span><br><span class="line">		System.out.println(<span class="string">&quot;安全保障&quot;</span>);</span><br><span class="line">		System.out.println(<span class="string">&quot;合同签订&quot;</span>);</span><br><span class="line">		System.out.println(<span class="string">&quot;费用结算&quot;</span>);</span><br><span class="line">		System.out.println(<span class="string">&quot;------------&quot;</span>);</span><br><span class="line">		<span class="comment">//使用目标对象来完成核心工作</span></span><br><span class="line">		<span class="keyword">this</span>.target.sing();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>用户类<code>User</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		Singer target = <span class="keyword">new</span> Target();</span><br><span class="line">		Singer singer = <span class="keyword">new</span> Proxy(target);</span><br><span class="line">		singer.sing();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206080823484.png" alt="image-20201102172650474"></p>
<p>总结：</p>
<p>从上述代码和结果中可知，代理类Proxy只是在目标类Target现有的功能上对其进行增强，Target中的代码没改变。</p>
<p>用户类User访问代理类Proxy中的方法，就可访问到已经被增强的方法。</p>
<p>例如，在实际开发过程中，可以将事务管理抽取出来，放到代理类中，从而实现对目标类进行事务管理</p>
<h2 id="3-静态代理"><a href="#3-静态代理" class="headerlink" title="3.静态代理"></a>3.静态代理</h2><p>静态代理是代理模式的实现方式之一，在程序运行前，手动创建代理类，从而实现对目标类中的方法进行增强。</p>
<p>上面的例子就是一个静态代理的实现。</p>
<h2 id="4-动态代理"><a href="#4-动态代理" class="headerlink" title="4.动态代理"></a>4.动态代理</h2><p>静态代理的例子中，目标类与代理类是一一对应，并且是提前写好的，如果多个目标类需要被代理，那么就需要在程序运行之前建立多个代理类为之代理。</p>
<p>动态代理则是在程序运行期间，采用字节码技术，动态生成的一个代理对象，从而实现目标对象中方法的增强。</p>
<p>例如，之前学习Mybaits的时候，有这样的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">IUserMapper mapper = sqlSession.getMapper(IUserMapper.class);</span><br><span class="line">mapper.findUserById(<span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p>该方法就是在程序运行期间，动态生成映射接口的一个实现类对象，这个实现类对象就是动态代理对象。该代理对象就可以实现使用xml文件中的sql语句，结合内部封装的JDBC代码来完成数据库的交互，而成完成查询功能。</p>
<blockquote>
<p>注意，在动态代理中，代理类是在运行时期生成的。因此，相比静态代理，动态代理可以很方便地对目标类的相关方法进行统一增强处理</p>
</blockquote>
<p>一般实现动态代理的方式有俩种：</p>
<ul>
<li>JDK动态代理（重要，需要掌握）</li>
<li>CGLIB动态代理（了解即可）</li>
</ul>
<h3 id="4-1-JDK动态代理"><a href="#4-1-JDK动态代理" class="headerlink" title="4.1 JDK动态代理"></a>4.1 JDK动态代理</h3><p>JDK动态代理主要是借助<code>java.lang.reflect.Proxy</code>生成代理对象</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206080823856.png" alt="image-20201014151627409"></p>
<p>Proxy类中的<code>newProxyInstance</code>方法，可以在运行启动期间，动态生成指定接口的代理类对象：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> java.lang.reflect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Proxy</span> <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *	loader,目标类的类加载器</span></span><br><span class="line"><span class="comment">     *  interfaces，目标类所实现的接口，可以是多个</span></span><br><span class="line"><span class="comment">     *  InvocationHandler，InvocationHandler接口的实现类对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">newProxyInstance</span><span class="params">(ClassLoader loader,Class&lt;?&gt;[] interfaces,InvocationHandler h)</span><span class="keyword">throws</span> IllegalArgumentException</span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><code>java.lang.reflect.InvocationHandler</code>接口中只有一个抽象方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> java.lang.reflect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">     *	proxy,将来动态生成的代理类对象</span></span><br><span class="line"><span class="comment">     *	method，将来需要代理的目标对象中的方法</span></span><br><span class="line"><span class="comment">     *  args，将来调用目标对象方法时所传入的参数列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> Throwable</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，在实际的操作中，主要使用的是第二和第三个参数</p>
</blockquote>
<p>例如，</p>
<blockquote>
<p>目标类和抽象主题接口代码不变，只需要改变<code>User</code>类代码即可,如下：</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//创建目标类对象</span></span><br><span class="line">		Singer target = <span class="keyword">new</span> Target();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//目标类的类加载</span></span><br><span class="line">		ClassLoader loader = Target.class.getClassLoader();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//目标类所实现的接口</span></span><br><span class="line">		Class&lt;?&gt;[] interfaces = Target.class.getInterfaces();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//InvocationHandler接口的实现类对象</span></span><br><span class="line">		InvocationHandler h = <span class="keyword">new</span> InvocationHandler() &#123;</span><br><span class="line"></span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">				</span><br><span class="line">				System.out.println(<span class="string">&quot;安排时间&quot;</span>);</span><br><span class="line">				System.out.println(<span class="string">&quot;联系场地&quot;</span>);</span><br><span class="line">				System.out.println(<span class="string">&quot;安全保障&quot;</span>);</span><br><span class="line">				System.out.println(<span class="string">&quot;合同签订&quot;</span>);</span><br><span class="line">				System.out.println(<span class="string">&quot;费用结算&quot;</span>);</span><br><span class="line">				System.out.println(<span class="string">&quot;------------&quot;</span>);</span><br><span class="line">				</span><br><span class="line">				<span class="comment">//反射调用目标对象中需要代理的方式，并传入参数</span></span><br><span class="line">				Object result = method.invoke(target, args);</span><br><span class="line">				</span><br><span class="line">				<span class="keyword">return</span> result;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;;</span><br><span class="line">		</span><br><span class="line">		Singer proxy = (Singer) Proxy.newProxyInstance(loader, interfaces, h);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//调用代理对象的sing方法</span></span><br><span class="line">		<span class="comment">//proxy对象将代理target对象中的sing</span></span><br><span class="line">		<span class="comment">//在完成真正的sing功能之前，会完成一些额外的功能</span></span><br><span class="line">		proxy.sing();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//观察这个代理对象真正的类型是什么</span></span><br><span class="line">		System.out.println(<span class="string">&quot;代理对象proxy的真实类型：&quot;</span>+proxy.getClass());</span><br><span class="line">				</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206080823239.png" alt="image-20201102221412688"></p>
<blockquote>
<p>注意，$Proxy0这个类型在程序运行之前是不存在的，是程序运行期间利用字节码技术动态生成的，它的的对象就是动态创建出来的动态代理对象。</p>
</blockquote>
<blockquote>
<p>注意，Mybaits中默认情况下，就是利用这种方式来完成的动态生成Mapper接口的动态代理对象</p>
</blockquote>
<p>例如，编写一个方法，可以给任意指定目标对象（必须实现接口）产生动态代理对象，该动态代理对象的作用是在完成目标对象中的功能之前，进行日志记录，输出 “xxx方法被调用了”</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyPrxoyFactory</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">getProxy</span><span class="params">(T target)</span></span>&#123;</span><br><span class="line">	    </span><br><span class="line">		Class&lt;?&gt; c = target.getClass();</span><br><span class="line">		ClassLoader classLoader = c.getClassLoader();</span><br><span class="line">		Class&lt;?&gt;[] interfaces = c.getInterfaces();</span><br><span class="line">	    </span><br><span class="line">		InvocationHandler h = <span class="keyword">new</span> MyInvocationHandler(target);</span><br><span class="line">		</span><br><span class="line">		T proxy = (T) Proxy.newProxyInstance(classLoader, interfaces, h);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> proxy;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInvocationHandler</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span></span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">private</span> Object target;</span><br><span class="line">		</span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="title">MyInvocationHandler</span><span class="params">(Object target)</span> </span>&#123;</span><br><span class="line">			<span class="keyword">this</span>.target = target;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">			</span><br><span class="line">			String className = target.getClass().getName();</span><br><span class="line">			String methodName = method.getName();</span><br><span class="line">			System.out.println(className+<span class="string">&quot; 类型对象中的 &quot;</span>+methodName+<span class="string">&quot; 方法被调用了&quot;</span>);</span><br><span class="line">			</span><br><span class="line">			Object result = method.invoke(target, args);</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">return</span> result;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyPrxoyFactoryTest</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		Singer target = <span class="keyword">new</span> Target();</span><br><span class="line">		</span><br><span class="line">		Singer proxy = MyPrxoyFactory.getProxy(target);</span><br><span class="line">		</span><br><span class="line">		proxy.sing();</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>运行结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">com.briup.proxy.Target 类型对象中的 sing 方法被调用了</span><br><span class="line">目标对象进行歌曲演唱</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，此时getProxy方法返回的代理对象，不仅可以代理Singer接口的实现对象（目标对象），还可以代理任意接口的实现对象（目标对象），在不改变原目标对象中代码的情况下，为其添加日志输出功能！</p>
</blockquote>
<h3 id="4-2-CGLIB动态代理"><a href="#4-2-CGLIB动态代理" class="headerlink" title="4.2 CGLIB动态代理"></a>4.2 CGLIB动态代理</h3><p>使用JDK动态代理，有一个前提条件，就是目标对象必须实现了一个或多个接口，那么产生的代理对象就是用来代理这个接口中的方法。</p>
<p>但是如果目标对象没有实现任何接口，那么就不能使用JDK动态代理，这时候可以使用CGLIB的动态代理</p>
<p>CGLIB通过ASM动态操作指令，生成了被代理类的子类，如果目标类是final修饰的，则不能够被代理。</p>
<p>CGLIB生成的代理对象，其实是目标对象的<strong>子类型</strong>对象，并重写了目标类中所有的<strong>非private</strong>、<strong>非final</strong>的方法，从而完成这些方法的代理工作。</p>
<p>例如，给service对象创建动态代理对象，在service方法执行前后加入事务管理的工作</p>
<p>1、项目中引入jar包（cglib和asm）</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206080824176.png" alt="image-20201102224853388"></p>
<p>2、目标类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.cglib;</span><br><span class="line"></span><br><span class="line"><span class="comment">//service对象</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentService</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveOrUpdate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;操作成功&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，此目标类并没有实现任何接口</p>
</blockquote>
<p>3、测试类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.cglib;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.proxy.Enhancer;</span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.proxy.MethodInterceptor;</span><br><span class="line"><span class="keyword">import</span> net.sf.cglib.proxy.MethodProxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CGLIBTest</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//CGLIB中产生代理对象的核心类型</span></span><br><span class="line">		Enhancer enhancer = <span class="keyword">new</span> Enhancer();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 设置代理类的父类对象</span></span><br><span class="line">		enhancer.setSuperclass(StudentService.class);</span><br><span class="line">		</span><br><span class="line">		enhancer.setCallback(<span class="keyword">new</span> MethodInterceptor() &#123;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">/**</span></span><br><span class="line"><span class="comment">			 * <span class="doctag">@param</span> proxy 代理对象实例</span></span><br><span class="line"><span class="comment">			 * <span class="doctag">@param</span> method 目标类中的方法对象</span></span><br><span class="line"><span class="comment">			 * <span class="doctag">@param</span> args 方法参数</span></span><br><span class="line"><span class="comment">			 * <span class="doctag">@param</span> methodProxy 方法代理对象</span></span><br><span class="line"><span class="comment">			 */</span></span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Object proxy, Method method, Object[] args, MethodProxy methodProxy)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">				System.out.println(<span class="string">&quot;开启事务&quot;</span>);</span><br><span class="line">				</span><br><span class="line">				<span class="comment">//调用代理对象父类型的中的指定方法</span></span><br><span class="line">				<span class="comment">//代理对象的父类型也就是目标对象的类型</span></span><br><span class="line">				<span class="comment">//因为CGLIB生成代理对象的方式就是给目标对象动态生成一个子类对象对象</span></span><br><span class="line">				<span class="comment">//这个子类型对象就是代理对象</span></span><br><span class="line">				Object result = methodProxy.invokeSuper(proxy, args);</span><br><span class="line">				</span><br><span class="line">				System.out.println(<span class="string">&quot;提交事务&quot;</span>);</span><br><span class="line">				</span><br><span class="line">				<span class="keyword">return</span> result;</span><br><span class="line">				</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 产生代理对象</span></span><br><span class="line">		StudentService studentService = (StudentService) enhancer.create();</span><br><span class="line">		</span><br><span class="line">		studentService.saveOrUpdate();</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206080824353.png" alt="image-20201102225916762"></p>
<blockquote>
<p>注意，此时使用CGLIB，就可以给没实现任何接口的目标对象，产生动态代理对象了</p>
</blockquote>
<h2 id="5-Spring-AOP"><a href="#5-Spring-AOP" class="headerlink" title="5. Spring AOP"></a>5. Spring AOP</h2><h3 id="5-1-概述-1"><a href="#5-1-概述-1" class="headerlink" title="5.1 概述"></a>5.1 概述</h3><p>在软件业中，AOP为Aspect Oriented Programming的缩写，意为：面向切面编程，通过预编译方式和运行期间动态代理实现程序功能的统一维护的一种技术。</p>
<p>AOP是OOP的延续，是软件开发中的一个热点，也是Spring框架中的一个重要内容，是函数式编程的一种衍生范型。</p>
<p>利用AOP可以对业务逻辑的各个部分进行隔离，从而使得业务逻辑各部分之间的耦合度降低，提高程序的可重用性，同时提高了开发的效率。</p>
<p>简单来说，将程序中重复的代码抽取出来，在程序执行的时候，利用动态代理技术，在不修改源码的基础上，把抽取出来的代码，在重新织入到原有的程序中，对现有的功能进行动态的增强。</p>
<h3 id="5-2-特点"><a href="#5-2-特点" class="headerlink" title="5.2 特点"></a>5.2 特点</h3><p>在程序运行期间，不修改源码对已有方法进行增强，这样操作带来的好处：</p>
<ul>
<li><p>减少代码重复</p>
</li>
<li><p>提高开发效率</p>
</li>
<li><p>提高可维护性</p>
</li>
</ul>
<h3 id="5-3-实现"><a href="#5-3-实现" class="headerlink" title="5.3 实现"></a>5.3 实现</h3><p>Spring框架中，会自动根据目标对象是否实现了接口，来选择使用JDK动态代理的方式来实现，还是使用CGLIB技术来实现。</p>
<h3 id="5-4-术语"><a href="#5-4-术语" class="headerlink" title="5.4 术语"></a>5.4 术语</h3><ul>
<li><p>切面/切面类（aspect）</p>
<p>将来要被织入到方法执行 前/后/异常 的时候去执行的代码片段</p>
</li>
<li><p>连接点（joinpoint）</p>
<p>Spring中的连接点是目标对象里面需要被代理的方法，默认情况下是目标对象中所有非final修饰的方法</p>
<p><strong>如果不是在SpringAOP中，joinPoint可能还会是属性</strong></p>
</li>
<li><p>切入点（pointCut）</p>
<p>一组连接点的集合，就是一个切入点。因为连接点就是方法(spring中是这样)，所有一个切入点也是一组方法的集合</p>
</li>
<li><p>通知/拦截器（advice）</p>
<p>控制 切面/切面类 将来要在目标对象中方法的什么位置执行，例如方法的前面或者后面或者抛异常的时候</p>
</li>
<li><p>织入（wave）</p>
<p>将切面类织入到指定方法中去执行的动作</p>
</li>
<li><p>目标对象（target）</p>
<p>需要被代理的对象，一般是代理目标对象的一个或多个指定的方法</p>
</li>
<li><p>代理对象（proxy）</p>
<p>代理目标对象，在完成核心功能的前提下，添加额外的代码去执行</p>
</li>
</ul>
<blockquote>
<p>注意，先熟悉每个术语的含义，在后面的例子中，将其套入进去，理解并掌握每个术语的在AOP中充当的角色</p>
</blockquote>
<h3 id="5-5-案例"><a href="#5-5-案例" class="headerlink" title="5.5 案例"></a>5.5 案例</h3><h4 id="5-5-1-准备"><a href="#5-5-1-准备" class="headerlink" title="5.5.1 准备"></a>5.5.1 准备</h4><p>1、导入AOP相关的jar包和其他jar</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206080824167.png" alt="image-20201103000209159"></p>
<p>2、目标类接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ITeacherService</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">saveOrUpdate</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">delete</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">deleteBatch</span><span class="params">()</span></span>;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>3、目标类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.service.ITeacherService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TeacherServiceImpl</span> <span class="keyword">implements</span> <span class="title">ITeacherService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveOrUpdate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;teacher:保存成功&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;teacher:删除成功&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteBatch</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;teacher:批量删除成功&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>4、切面类（Aspect）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.aspect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspect</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//将该代码片段织入到目标对象中方法的执行之前</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforAdvice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;前置通知&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//将该代码片段织入到目标对象中方法的执行之后（被代理的方法必须正常返回，抛出异常不织入）</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterReturn</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;后置通知&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//将该代码片段织入到目标对象中方法的执行抛异常的时候</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">throwable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;异常通知&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//将该代码片段织入到目标对象中方法的执行之后（被代理的方法正常返回或者抛出异常都会织入该代码片段）</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">after</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;最终通知&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//将该代码片段织入到目标对象中方法的执行之前和和之后</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">around</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;环绕通知：前&quot;</span>);</span><br><span class="line">		<span class="comment">// 获取执行方法的参数</span></span><br><span class="line">		Object[] args = joinPoint.getArgs();</span><br><span class="line">		joinPoint.proceed(args);</span><br><span class="line">		System.out.println(<span class="string">&quot;环绕通知: 后&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，切面类中的方法名是随意起的，但是一般会起一个有意义的，一看就知道将来需要织入到目标对象方法的什么位置</p>
</blockquote>
<h4 id="5-5-2-xml"><a href="#5-5-2-xml" class="headerlink" title="5.5.2 xml"></a>5.5.2 xml</h4><p>创建配置文件（src下面的applicationContext.xml）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">						 http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">						 http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="string"><span class="tag">						 http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置目标类到SpringIOC容器中--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;teacherService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.service.impl.TeacherServiceImpl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 配置切面类到SpringIOC容器中--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;myAspect&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.aspect.MyAspect&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 配置aop --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 配置切入点，一组连接点的集合（Spring中就是一组方法的集合） --&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- id: 切入点的唯一标识 --&gt;</span>			</span><br><span class="line">		<span class="comment">&lt;!-- expression:切入点表达式  --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;myPointcut1&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* com.briup.service..*.*(..))&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;myPointcut2&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* com.briup.service..*.delete*(..))&quot;</span>/&gt;</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">&lt;!-- 指定容器中，那个对象是切面类对象 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">id</span>=<span class="string">&quot;aspect&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;myAspect&quot;</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 注意，切入点myPointcut1和myPointcut2分别代表俩组不同的连接点（方法） --&gt;</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">&lt;!-- 前置通知，会将切面类中的代码片段（beforAdvice方法）织入到myPointcut1中 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;beforAdvice&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;myPointcut1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:before</span>&gt;</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">&lt;!-- 最终通知，会将切面类中的代码片段（after方法）织入到myPointcut1中 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">&quot;after&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;myPointcut1&quot;</span>/&gt;</span>		</span><br><span class="line">            </span><br><span class="line">            <span class="comment">&lt;!-- 后置通知，会将切面类中的代码片段（afterReturn方法）织入到myPointcut1中 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">&quot;afterReturn&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;myPointcut1&quot;</span>/&gt;</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">&lt;!-- 环绕通知，会将切面类中的代码片段（around方法）织入到myPointcut1中 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">&quot;around&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;myPointcut1&quot;</span>/&gt;</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">&lt;!-- 异常通知，会将切面类中的代码片段（throwable方法）织入到myPointcut2中 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">&quot;throwable&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;myPointcut2&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，该配置文件中，头部声明引入了aop相关的命名空间，以及指定了其对应的schema文件的位置</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206080824121.png" alt="image-20201102234013108"></p>
<p>默认情况下，如果目标类实现了接口，那么spring会采用JKD动态代理，如果这时候想使用CGLIB做代理，那么可以在<code>&lt;aop:config&gt;</code>标签中添加属性： <code>proxy-target-class=&quot;true&quot;</code></p>
<p>例如，</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span> <span class="attr">proxy-target-class</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">	//....</span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>





<p>其中AOP配置部分的详细说明：</p>
<p>1、<code>&lt;aop:config&gt;</code></p>
<p>aop配置标签，所有的aop配置代码都写入该标签里面</p>
<p>2、<code>&lt;aop:pointcut&gt;</code></p>
<p>配置切入点，需要使用execution表示来定义切入点</p>
<p>官方文档中，提供了很多参考的样例：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206080824616.png" alt="image-20201103001844032"></p>
<p>例如，</p>
<ul>
<li><p>the execution of any public method:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execution(<span class="keyword">public</span> * *(..))</span><br></pre></td></tr></table></figure></li>
<li><p>the execution of any method with a name beginning with “set”:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execution(* set*(..))</span><br></pre></td></tr></table></figure></li>
<li><p>the execution of any method defined by the <code>AccountService</code> interface:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execution(* com.xyz.service.AccountService.*(..))</span><br></pre></td></tr></table></figure></li>
<li><p>the execution of any method defined in the service package:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execution(* com.xyz.service.*.*(..))</span><br></pre></td></tr></table></figure></li>
<li><p>the execution of any method defined in the service package or a sub-package:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execution(* com.xyz.service..*.*(..))</span><br></pre></td></tr></table></figure></li>
<li><p>any join point (method execution only in Spring AOP) within the service package:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">within(com.xyz.service.*)</span><br></pre></td></tr></table></figure></li>
<li><p>any join point (method execution only in Spring AOP) within the service package or a sub-package:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">within(com.xyz.service..*)</span><br></pre></td></tr></table></figure></li>
<li><p>any join point (method execution only in Spring AOP) where the proxy implements the <code>AccountService</code> interface:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>(com.xyz.service.AccountService)</span><br></pre></td></tr></table></figure></li>
<li><p>any join point (method execution only in Spring AOP) where the target object implements the <code>AccountService</code> interface:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">target(com.xyz.service.AccountService)</span><br></pre></td></tr></table></figure></li>
<li><p>any join point (method execution only in Spring AOP) which takes a single parameter, and where the argument passed at runtime is <code>Serializable</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">args(java.io.Serializable)</span><br></pre></td></tr></table></figure></li>
<li><p>any join point (method execution only in Spring AOP) where the target object has an <code>@Transactional</code> annotation:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@target(org.springframework.transaction.annotation.Transactional)</span></span><br></pre></td></tr></table></figure></li>
<li><p>any join point (method execution only in Spring AOP) where the declared type of the target object has an <code>@Transactional</code> annotation:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@within(org.springframework.transaction.annotation.Transactional)</span></span><br></pre></td></tr></table></figure></li>
<li><p>any join point (method execution only in Spring AOP) where the executing method has an <code>@Transactional</code> annotation:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@annotation(org.springframework.transaction.annotation.Transactional)</span></span><br></pre></td></tr></table></figure></li>
<li><p>any join point (method execution only in Spring AOP) which takes a single parameter, and where the runtime type of the argument passed has the <code>@Classified</code> annotation:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@args(com.xyz.security.Classified)</span></span><br></pre></td></tr></table></figure></li>
<li><p>any join point (method execution only in Spring AOP) on a Spring bean named <code>tradeService</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bean(tradeService)</span><br></pre></td></tr></table></figure></li>
<li><p>any join point (method execution only in Spring AOP) on Spring beans having names that match the wildcard expression <code>*Service</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bean(*Service)</span><br></pre></td></tr></table></figure></li>
</ul>
<blockquote>
<p>注意，官网文档中给出很多种定义切入点的表达式写法案例，但是最常用的还是 <code>execution</code> 相关的语法</p>
</blockquote>
<p>3、<code>&lt;aop:aspect&gt;</code></p>
<p>配置切面，所有通知都写入该里面</p>
<p>属性：</p>
<ul>
<li><p>id:    切面唯一标识</p>
</li>
<li><p>ref:   容器中切面对象的唯一标识</p>
</li>
</ul>
<p>4、<code>advice</code></p>
<ul>
<li><p><code>&lt;aop:before&gt;</code> 前置通知，在切入点执行之前执行</p>
</li>
<li><p><code>&lt;aop:after-returning&gt;</code> 后置通知，在切入点执行之后执行，发生异常不执行</p>
</li>
<li><p><code>&lt;aop:after-throwing&gt;</code> 异常通知，在切入点发生异常时执行</p>
</li>
<li><p><code>&lt;aop:after&gt;</code> 最终通知，在切入点执行之后执行，发生异常也执行</p>
</li>
<li><p><code>&lt;aop:around&gt;</code> 环绕通知，在切入点执行之前，执行一部分，执行后执行一部分</p>
</li>
</ul>
<p>以上所有通知都有如下属性：</p>
<ul>
<li><p><code>method:</code>指定通知中方法的名称。</p>
</li>
<li><p><code>pointct:</code>定义切入点表达式（临时定义）</p>
</li>
<li><p><code>pointcut-ref:</code> 指定切入点表达式的引用（引用上面定义好的）</p>
</li>
</ul>
<p>测试类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.service.ITeacherService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(locations = &quot;classpath:applicationContext.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AOPXMLTest</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> ITeacherService teacherService;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(teacherService);</span><br><span class="line">		System.out.println(teacherService.getClass());</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_saveOrUpdate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		teacherService.saveOrUpdate();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_delete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		teacherService.delete();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_deleteBatch</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		teacherService.deleteBatch();</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 目标类中，不重toString方法，那么toString不会被代理</span></span><br><span class="line"><span class="comment">	 * 目标类中，重写toString后，那么toString也会被代理</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		teacherService.toString();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 目标类中自定义方法say</span></span><br><span class="line"><span class="comment">	 * 如果采用JDK动态代理，那么强转报错</span></span><br><span class="line"><span class="comment">	 * 如果采用CGLIB动态代理，强转成功，并且正常完成代理</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_say</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		((TeacherServiceImpl)teacherService).say();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，根据配置信息（XML），运行单元测试方法观察结果，在方法中主动抛出异常，再运行观察结果</p>
</blockquote>
<h4 id="5-5-3-注解"><a href="#5-5-3-注解" class="headerlink" title="5.5.3 注解"></a>5.5.3 注解</h4><p>接口不变，实现类（目标类）上加<code>@Service</code>，代替XML中的bean配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.service.ITeacherService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TeacherServiceImpl</span> <span class="keyword">implements</span> <span class="title">ITeacherService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveOrUpdate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;teacher:保存成功&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;teacher:删除成功&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteBatch</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;teacher:批量删除成功&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>切面类加入@Component注解，代替执行XML的bean配置，同时加入@Aspect注解，指定这是一个切面类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.aspect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.After;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.AfterReturning;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.AfterThrowing;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Around;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Before;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Pointcut;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspect</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//注意，方法名字就是这个切入点的名字</span></span><br><span class="line">	<span class="meta">@Pointcut(&quot;execution(* com.briup.service..*.*(..))&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pointcut1</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//注意，方法名字就是这个切入点的名字</span></span><br><span class="line">	<span class="meta">@Pointcut(&quot;execution(* com.briup.service..*.delete*(..))&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pointcut2</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Before(&quot;pointcut1()&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforAdvice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;前置通知&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@AfterReturning(&quot;pointcut1()&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterReturn</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;后置通知&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@AfterThrowing(&quot;pointcut2()&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">throwable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;异常通知&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@After(&quot;pointcut1()&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">after</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;最终通知&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Around(&quot;pointcut1()&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">around</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;环绕通知：前&quot;</span>);</span><br><span class="line">		<span class="comment">// 获取执行方法的参数</span></span><br><span class="line">		Object[] args = joinPoint.getArgs();</span><br><span class="line">		joinPoint.proceed(args);</span><br><span class="line">		System.out.println(<span class="string">&quot;环绕通知: 后&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这里将之前XML中的配置全都是要注解的方式配置到该类中</p>
</blockquote>
<p>其中AOP配置部分的详细说明：</p>
<p>1、<code>@Aspect</code></p>
<p>声明该类是一个切面类</p>
<p>2、<code>@Before</code></p>
<p>声明方法为前置通知，value属性，用来指定引用的切入点是谁</p>
<p>3、<code>@AfterReturning</code></p>
<p>声明方法为后置通知，value属性，用来指定引用的切入点是谁</p>
<p>4、<code>@AfterThrowing</code></p>
<p>声明方法为异常通知，value属性，用来指定引用的切入点是谁</p>
<p>5、<code>@After</code></p>
<p>声明方法为最终通知，value属性，用来指定引用的切入点是谁</p>
<p>6、<code>@Around</code></p>
<p>声明方法为环绕通知，value属性，用来指定引用的切入点是谁</p>
<p>7、<code>@Pointcut</code></p>
<p>定义切入点（一组方法的集合）</p>
<p>编写配置类，代替XML文件的读取</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.EnableAspectJAutoProxy;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.briup&quot;)</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AOPConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，@ComponentScan(“com.briup”)用来指定扫描com.briup包及其子包中类里面的注解信息</p>
</blockquote>
<blockquote>
<p>注意，@EnableAspectJAutoProxy用来指定当前spring配置中使用了AspectJ框架的注解</p>
</blockquote>
<blockquote>
<p>注意，AspectJ框架是专门实现AOP功能的一个框架，Spring中AOP功能也是依赖于AspectJ来实现的</p>
</blockquote>
<p>测试类：把之前测试用的toString和say方法先删掉，再做测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.config.AOPConfig;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.ITeacherService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(classes = AOPConfig.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AOPAnnotationTest</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> ITeacherService teacherService;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(teacherService);</span><br><span class="line">		System.out.println(teacherService.getClass());</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_saveOrUpdate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		teacherService.saveOrUpdate();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_delete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		teacherService.delete();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_deleteBatch</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		teacherService.deleteBatch();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，根据配置信息（注解），运行单元测试方法观察结果，在方法中主动抛出异常，再运行观察结果</p>
</blockquote>
<h1 id="spring-三"><a href="#spring-三" class="headerlink" title="spring(三)"></a>spring(三)</h1><h2 id="1-JDBC"><a href="#1-JDBC" class="headerlink" title="1.JDBC"></a>1.JDBC</h2><h3 id="1-1-概述"><a href="#1-1-概述" class="headerlink" title="1.1 概述"></a>1.1 概述</h3><p>Spring框架中提供的一个类<code>JdbcTemplate</code>，是对原始Jdbc-API的简单封装。除了这个模板类，Spring框架为提供了很多的操作模板类：</p>
<ul>
<li>操作关系型数据库：<code>JdbcTemplate</code> ,<code>HibernateTemplate</code></li>
<li>操作redis数据库的：<code>RedisTemplate</code></li>
<li>操作消息队列的：<code>JmsTemplate</code></li>
</ul>
<h3 id="1-2-案例"><a href="#1-2-案例" class="headerlink" title="1.2 案例"></a>1.2 案例</h3><p>1、导入jar</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206080824810.png" alt="image-20201103123014167"></p>
<blockquote>
<p>注意，spring-tx 是管理事务相关的jar包</p>
</blockquote>
<p>2、数据库建表（oracle）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> teacher;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> teacher(</span><br><span class="line">	id number <span class="keyword">primary</span> key,</span><br><span class="line">	name varchar2(<span class="number">22</span>),</span><br><span class="line">    age number,</span><br><span class="line">    salary number</span><br><span class="line">);</span><br></pre></td></tr></table></figure>



<p>3、POJO类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Teacher</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">double</span> salary;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>4、dao层接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Teacher;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ITeacherDao</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(Teacher teacher)</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(Teacher teacher)</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">deleteAll</span><span class="params">()</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">deleteById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function">Teacher <span class="title">selectById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function">List&lt;Teacher&gt; <span class="title">selectAll</span><span class="params">()</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">selectCount</span><span class="params">()</span></span>;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>4、dao层实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.dao.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.RowMapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Teacher;</span><br><span class="line"><span class="keyword">import</span> com.briup.dao.ITeacherDao;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TeacherDaoImpl</span> <span class="keyword">implements</span> <span class="title">ITeacherDao</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 注入 jdcbTemplate 对象</span></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(Teacher t)</span> </span>&#123;</span><br><span class="line">		String sql = <span class="string">&quot;insert into teacher values(?,?,?,?)&quot;</span>;</span><br><span class="line">		Object[] args = &#123;t.getId(),t.getName(),t.getAge(),t.getSalary()&#125;;</span><br><span class="line">		jdbcTemplate.update(sql,args);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Teacher t)</span> </span>&#123;</span><br><span class="line">		String sql = <span class="string">&quot;update teacher set name = ?,age = ?,salary = ? where id = ?&quot;</span>;</span><br><span class="line">		Object[] args = &#123;t.getName(),t.getAge(),t.getSalary(),t.getId()&#125;;</span><br><span class="line">		jdbcTemplate.update(sql,args);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		String sql = <span class="string">&quot;delete from teacher&quot;</span>;</span><br><span class="line">		jdbcTemplate.update(sql);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteById</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">		String sql = <span class="string">&quot;delete from teacher where id = ?&quot;</span>;</span><br><span class="line">		Object[] args = &#123;id&#125;;</span><br><span class="line">		jdbcTemplate.update(sql,args);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Teacher <span class="title">selectById</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">		String sql = <span class="string">&quot;select * from teacher where id = ?&quot;</span>;</span><br><span class="line">		Object[] args = &#123;id&#125;;</span><br><span class="line">		Teacher teacher = jdbcTemplate.queryForObject(sql,args,<span class="keyword">new</span> RowMapper&lt;Teacher&gt;() &#123;</span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> Teacher <span class="title">mapRow</span><span class="params">(ResultSet rs, <span class="keyword">int</span> rowNum)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">				Teacher t = <span class="keyword">new</span> Teacher();</span><br><span class="line">				t.setId(rs.getInt(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">				t.setName(rs.getString(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">				t.setAge(rs.getInt(<span class="string">&quot;age&quot;</span>));</span><br><span class="line">				t.setSalary(rs.getDouble(<span class="string">&quot;salary&quot;</span>));</span><br><span class="line">				<span class="keyword">return</span> t;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> teacher;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Teacher&gt; <span class="title">selectAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		String sql = <span class="string">&quot;select * from teacher&quot;</span>;</span><br><span class="line">		</span><br><span class="line">		List&lt;Teacher&gt; list = jdbcTemplate.query(sql,<span class="keyword">new</span> RowMapper&lt;Teacher&gt;() &#123;</span><br><span class="line"></span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> Teacher <span class="title">mapRow</span><span class="params">(ResultSet rs, <span class="keyword">int</span> index)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">				Teacher teacher = <span class="keyword">new</span> Teacher();</span><br><span class="line">				teacher.setId(rs.getInt(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">				teacher.setName(rs.getString(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">				teacher.setAge(rs.getInt(<span class="string">&quot;age&quot;</span>));</span><br><span class="line">				teacher.setSalary(rs.getDouble(<span class="string">&quot;salary&quot;</span>));</span><br><span class="line">				<span class="keyword">return</span> teacher;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> list;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">selectCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		String sql = <span class="string">&quot;select count(*) from teacher&quot;</span>;</span><br><span class="line">		<span class="keyword">return</span> jdbcTemplate.queryForObject(sql, <span class="keyword">int</span>.class);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>对应JdbcTemplate的使用，官方文档中，给出了很多案例：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206080824052.png" alt="image-20201103123220451"></p>
<p>5、配置类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.briup.dao&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcConfig</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 创建数据库连接池，并且交给Spring容器管理</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> DataSource <span class="title">dataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		DruidDataSource dataSource = <span class="keyword">new</span> DruidDataSource();</span><br><span class="line">		dataSource.setDriverClassName(<span class="string">&quot;oracle.jdbc.OracleDriver&quot;</span>);</span><br><span class="line">		dataSource.setUrl(<span class="string">&quot;jdbc:oracle:thin:@127.0.0.1:1521:XE&quot;</span>);</span><br><span class="line">		dataSource.setUsername(<span class="string">&quot;briup&quot;</span>);</span><br><span class="line">		dataSource.setPassword(<span class="string">&quot;briup&quot;</span>);</span><br><span class="line">		dataSource.setInitialSize(<span class="number">5</span>);</span><br><span class="line">		dataSource.setMaxActive(<span class="number">10</span>);</span><br><span class="line">		<span class="keyword">return</span> dataSource;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 创建JdbcTemplate对象交给Spring容器管理</span></span><br><span class="line"><span class="comment">	 * 注意，需要将配置好的数据源注入到JdbcTemplate中</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> JdbcTemplate <span class="title">jdbcTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		JdbcTemplate template = <span class="keyword">new</span> JdbcTemplate();</span><br><span class="line">		template.setDataSource(dataSource());</span><br><span class="line">		<span class="keyword">return</span> template;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果将该配置类的内容转换为xml配置，那么在xml文件中该怎么配置？（重要，手动操作，理解配置）</p>
</blockquote>
<p>7、测试类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Teacher;</span><br><span class="line"><span class="keyword">import</span> com.briup.config.JdbcConfig;</span><br><span class="line"><span class="keyword">import</span> com.briup.dao.ITeacherDao;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(classes = JdbcConfig.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcTest</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> ITeacherDao teacherDao;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_insert</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Teacher t = <span class="keyword">new</span> Teacher(<span class="number">1</span>,<span class="string">&quot;tom1&quot;</span>,<span class="number">21</span>,<span class="number">2000</span>);</span><br><span class="line">		teacherDao.insert(t);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_selectById</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Teacher t = teacherDao.selectById(<span class="number">1</span>);</span><br><span class="line">		System.out.println(t);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_selectAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		List&lt;Teacher&gt; list = teacherDao.selectAll();</span><br><span class="line">		System.out.println(list);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_selectCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> count = teacherDao.selectCount();</span><br><span class="line">		System.out.println(count);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		Teacher t = <span class="keyword">new</span> Teacher(<span class="number">1</span>,<span class="string">&quot;mary&quot;</span>,<span class="number">22</span>,<span class="number">3000</span>);</span><br><span class="line">		teacherDao.update(t);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_delete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		teacherDao.deleteById(<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_deleteAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		teacherDao.deleteAll();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="2-事务属性"><a href="#2-事务属性" class="headerlink" title="2.事务属性"></a>2.事务属性</h2><h3 id="2-1-概述"><a href="#2-1-概述" class="headerlink" title="2.1 概述"></a>2.1 概述</h3><blockquote>
<p>在项目的三层架构设计中，事务管理工作需要放在service进行来处理，用来保证当前正在完成的业务功能要么同时成功，要么同时失败</p>
</blockquote>
<p>Spring中操作事务的方式主要有两种：</p>
<ul>
<li>编程式事务</li>
<li>声明式事务</li>
</ul>
<p>1、编程式事务</p>
<p>使用编程的方式，自己去实现事务管理工作，例如事务的开启、提交、回滚操作，需要开发人员自己调用commit()或者rollback()等方法来实现。</p>
<p>编程式事务需要我们自己在逻辑代码中手动书写事务控制逻辑，所以编程式事务是具有侵入性的。</p>
<p>我们之前的代码中，对事务进行提交或者回滚的操作，就属于编程式事务。</p>
<p>2、声明式事务</p>
<p>只需要声明或者配置一个事务就可以了，不需要我们手动去编写事务管理代码。</p>
<p>这种方式属于非侵入性的，可以使用AOP思想实现事务管理，能够提高代码的复用性，提高开发效率。</p>
<p>例如，在Spring中，使用AOP来实现事务操作</p>
<ul>
<li>将service层事务的开启、提交、回滚等代码抽出来，封装成切面类</li>
<li>使用环绕通知，将事务管理的代码织入到service层需要事务支持的方法中</li>
<li>获取service 实现类的代理对象，调用方法时会动态加入事务管理的代码</li>
</ul>
<h3 id="2-2-接口"><a href="#2-2-接口" class="headerlink" title="2.2 接口"></a>2.2 接口</h3><p>Spring并不直接管理事务，而是提供了多种事务管理器，他们将事务管理的职责，委托给Hibernate或者JTA或者JDBC等持久化平台框架的事务来实现。</p>
<p>Spring事务管理器的接口是<code>org.springframework.transaction.PlatformTransactionManager</code>，通过这个接口，Spring为各个平台如JDBC、Hibernate、JPA、JTA等都提供了对应的事务管理器，但是具体的实现就是各个平台自己的事情了。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206080825945.png" alt="image-20201104111315104"></p>
<p>例如，如果使用JDBC，那么就需要配置对应的事务管理器，并且注入相应的数据源</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206080825053.png" alt="image-20201019170826733"></p>
<p><code>PlatformTransactionManager</code>接口中只有三个方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Public <span class="class"><span class="keyword">interface</span> <span class="title">PlatformTransactionManager</span></span>&#123;  </span><br><span class="line">    <span class="comment">// 由TransactionDefinition得到TransactionStatus对象</span></span><br><span class="line">    <span class="function">TransactionStatus <span class="title">getTransaction</span><span class="params">(TransactionDefinition definition)</span> <span class="keyword">throws</span> TransactionException</span>; </span><br><span class="line">    <span class="comment">// 提交</span></span><br><span class="line">    <span class="function">Void <span class="title">commit</span><span class="params">(TransactionStatus status)</span> <span class="keyword">throws</span> TransactionException</span>;  </span><br><span class="line">    <span class="comment">// 回滚</span></span><br><span class="line">    <span class="function">Void <span class="title">rollback</span><span class="params">(TransactionStatus status)</span> <span class="keyword">throws</span> TransactionException</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>该接口中的<code>getTransaction</code>方法通过<code>TransactionDefinition</code>类型参数，获取事务的状态</p>
</blockquote>
<p><code>org.springframework.transaction.TransactionDefinition</code>接口中，定义了事务的一些基本的属性，事务的属性主要包括五个方面：<strong>（重要）</strong></p>
<ul>
<li>传播行为</li>
<li>隔离级别</li>
<li>是否只读</li>
<li>事务超时</li>
<li>回滚规则</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.transaction;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.lang.Nullable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TransactionDefinition</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">int</span> PROPAGATION_REQUIRED = <span class="number">0</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">int</span> PROPAGATION_SUPPORTS = <span class="number">1</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">int</span> PROPAGATION_MANDATORY = <span class="number">2</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">int</span> PROPAGATION_REQUIRES_NEW = <span class="number">3</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">int</span> PROPAGATION_NOT_SUPPORTED = <span class="number">4</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">int</span> PROPAGATION_NEVER = <span class="number">5</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">int</span> PROPAGATION_NESTED = <span class="number">6</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">int</span> ISOLATION_DEFAULT = -<span class="number">1</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">int</span> ISOLATION_READ_UNCOMMITTED = Connection.TRANSACTION_READ_UNCOMMITTED;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">int</span> ISOLATION_READ_COMMITTED = Connection.TRANSACTION_READ_COMMITTED;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">int</span> ISOLATION_REPEATABLE_READ = Connection.TRANSACTION_REPEATABLE_READ;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">int</span> ISOLATION_SERIALIZABLE = Connection.TRANSACTION_SERIALIZABLE;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">int</span> TIMEOUT_DEFAULT = -<span class="number">1</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">getPropagationBehavior</span><span class="params">()</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">getIsolationLevel</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">getTimeout</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">isReadOnly</span><span class="params">()</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function">String <span class="title">getName</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h3 id="2-3-传播"><a href="#2-3-传播" class="headerlink" title="2.3 传播"></a>2.3 传播</h3><blockquote>
<p>事务传播行为（propagation behavior），当事务方法被另一个事务方法调用时，必须指定事务应该如何传播</p>
</blockquote>
<p>例如，在事务方法A调用事务方法B的时候，事务方法B可能继续在现有事务中运行，也可能开启一个新事务，并在这个自己的事务中运行。Spring定义了七种传播行为：</p>
<table>
<thead>
<tr>
<th>传播行为</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>PROPAGATION_REQUIRED</td>
<td>表示当前方法必须在运行在事务中，如果当前事务存在，方法将会在该事务中运行，否则会启动一个新事务</td>
</tr>
<tr>
<td>PROPAGATION_SUPPORTS</td>
<td>表示当前方法不需要事务上下文，但是如果存在当前事务的话，该方法就会在这个事务中运行</td>
</tr>
<tr>
<td>PROPAGATION_MANDATORY</td>
<td>表示当前方法必须在运行在事务中，如果当前事务不存在，则会抛出一个异常</td>
</tr>
<tr>
<td>PROPAGATION_REQUIRES_NEW</td>
<td>表示当前方法必须运行在它自己的事务中，一个新的事务将会被启动，如果存在当前事务，在该方法执行期间，当前事务会被挂起。</td>
</tr>
<tr>
<td>PROPAGATION_NOT_SUPPORTED</td>
<td>表示当前方法不应该运行在事务中，如果存在当前事务，在该方法运行期间，当前事务将被挂起。</td>
</tr>
<tr>
<td>PROPAGATION_NEVER</td>
<td>表示当前方法不应该运行在事务中，如果当前正有一个事务正在运行，则会抛出异常</td>
</tr>
<tr>
<td>PROPAGATION_NESTED</td>
<td>表示如果当前已经存在一个事务，那么该方法将会在嵌套的事务中运行。嵌套的事务可以独立于当前事务进行单独的提交或回滚。如果当前事务不存在，那么其行为与PROPAGATION_REQUIRED相同。注意，各个厂商对这种传播行为的支持有所不同，实际情况中需要参考具体的说明文档。</td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TransactionDefinition</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> PROPAGATION_REQUIRED = <span class="number">0</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">int</span> PROPAGATION_SUPPORTS = <span class="number">1</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">int</span> PROPAGATION_MANDATORY = <span class="number">2</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">int</span> PROPAGATION_REQUIRES_NEW = <span class="number">3</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">int</span> PROPAGATION_NOT_SUPPORTED = <span class="number">4</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">int</span> PROPAGATION_NEVER = <span class="number">5</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">int</span> PROPAGATION_NESTED = <span class="number">6</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getPropagationBehavior</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="2-4-隔离"><a href="#2-4-隔离" class="headerlink" title="2.4 隔离"></a>2.4 隔离</h3><p>相对于JDBC的隔离级别，Spring除了读未提交、读已提交、可重复读和串行化之外，还为我们提供了一个默认的隔离级别，例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TransactionDefinition</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ISOLATION_DEFAULT = -<span class="number">1</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">int</span> ISOLATION_READ_UNCOMMITTED = Connection.TRANSACTION_READ_UNCOMMITTED;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">int</span> ISOLATION_READ_COMMITTED = Connection.TRANSACTION_READ_COMMITTED;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">int</span> ISOLATION_REPEATABLE_READ = Connection.TRANSACTION_REPEATABLE_READ;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">int</span> ISOLATION_SERIALIZABLE = Connection.TRANSACTION_SERIALIZABLE;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getIsolationLevel</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>具体说明如下：</p>
<ul>
<li><p><code>ISOLATION_DEFAULT</code> 默认级别，归属下面级别中的某一种</p>
</li>
<li><p><code>ISOLATION_READ_UNCOMMITTED</code> 读未提交</p>
</li>
<li><p><code>ISOLATION_READ_COMMITTED</code> 读已提交 </p>
</li>
<li><p><code>ISOLATION_REPEATABLE_READ</code> 可重复读</p>
</li>
<li><p><code>ISOLATION_SERIALIZABLE</code> 串行化</p>
</li>
</ul>
<p>其中，<code>ISOLATION_DEFAULT</code>是<code>DataSourceTransactionManager</code>的默认隔离级别，该隔离级别的意思就是使用数据库默认的隔离级别：</p>
<ul>
<li>mysql是REPEATABLE_READ</li>
<li>oracle是READ_COMMITTED</li>
</ul>
<h3 id="2-5-只读"><a href="#2-5-只读" class="headerlink" title="2.5 只读"></a>2.5 只读</h3><blockquote>
<p>事务的第三个特性是它是否为只读事务</p>
</blockquote>
<p>如果事务中只包含对数据库的读操作，那么数据库可以利用事务的只读特性来进行一些特定的优化。</p>
<p>通过将事务设置为只读，你就可以给数据库一个机会，让它采用更为合适的优化措施。</p>
<p>只读事务并不是一个强制选项，它只是一个“暗示”，提示数据库驱动程序和数据库系统，这个事务并不包含更改数据的操作，那么JDBC驱动程序和数据库就有可能根据这种情况对该事务进行一些特定的优化，比方说不安排相应的数据库锁，以减轻事务对数据库的压力，毕竟事务也是要消耗数据库的资源的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TransactionDefinition</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isReadOnly</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="2-6-超时"><a href="#2-6-超时" class="headerlink" title="2.6 超时"></a>2.6 超时</h3><p>为了使应用程序很好地运行，事务不能运行太长的时间。因为事务可能涉及对后端数据库的锁定，所以长时间的事务会不必要的占用数据库资源。</p>
<p>事务超时就是事务的一个定时器，在特定时间内事务如果没有执行完毕，那么就会自动回滚，而不是一直等待其结束。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TransactionDefinition</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> TIMEOUT_DEFAULT = -<span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getTimeout</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-7-回滚"><a href="#2-7-回滚" class="headerlink" title="2.7 回滚"></a>2.7 回滚</h3><blockquote>
<p>在声明式事务的配置中，我们一般还会配置事务的另一个属性就是回滚规则</p>
</blockquote>
<p>默认配置下，事务只会对Error与RuntimeException及其子类这些UnChecked异常，做出回滚。非运行时异常这些Checked异常不会发生回滚，如果一般Exception想要回滚那么必须进行配置。</p>
<h2 id="3-事务案例"><a href="#3-事务案例" class="headerlink" title="3.事务案例"></a>3.事务案例</h2><p>在jdbc的案例基础上，添加service层代码：</p>
<p>1、导入jar包</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206080825134.png" alt="image-20201104192733079"></p>
<p>2、service层接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Teacher;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ITeacherService</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">save</span><span class="params">(Teacher t)</span></span>;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>3、service层实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Teacher;</span><br><span class="line"><span class="keyword">import</span> com.briup.dao.ITeacherDao;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.ITeacherService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TeacherServiceImpl</span> <span class="keyword">implements</span> <span class="title">ITeacherService</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> ITeacherDao teacherDao;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Teacher t)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		teacherDao.insert(t);</span><br><span class="line">        <span class="comment">//throw new RuntimeException(&quot;异常测试&quot;);</span></span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ITeacherDao <span class="title">getTeacherDao</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> teacherDao;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTeacherDao</span><span class="params">(ITeacherDao teacherDao)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.teacherDao = teacherDao;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这里提供了GET/SET方法</p>
</blockquote>
<p>4、dao层接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Teacher;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ITeacherDao</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(Teacher teacher)</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(Teacher teacher)</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">deleteAll</span><span class="params">()</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">deleteById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function">Teacher <span class="title">selectById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function">List&lt;Teacher&gt; <span class="title">selectAll</span><span class="params">()</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">selectCount</span><span class="params">()</span></span>;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>5、dao层实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.dao.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.RowMapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Teacher;</span><br><span class="line"><span class="keyword">import</span> com.briup.dao.ITeacherDao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TeacherDaoImpl</span> <span class="keyword">implements</span> <span class="title">ITeacherDao</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(Teacher t)</span> </span>&#123;</span><br><span class="line">		String sql = <span class="string">&quot;insert into teacher values(?,?,?,?)&quot;</span>;</span><br><span class="line">		Object[] args = &#123;t.getId(),t.getName(),t.getAge(),t.getSalary()&#125;;</span><br><span class="line">		jdbcTemplate.update(sql,args);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Teacher t)</span> </span>&#123;</span><br><span class="line">		String sql = <span class="string">&quot;update teacher set name = ?,age = ?,salary = ? where id = ?&quot;</span>;</span><br><span class="line">		Object[] args = &#123;t.getName(),t.getAge(),t.getSalary(),t.getId()&#125;;</span><br><span class="line">		jdbcTemplate.update(sql,args);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		String sql = <span class="string">&quot;delete from teacher&quot;</span>;</span><br><span class="line">		jdbcTemplate.update(sql);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteById</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">		String sql = <span class="string">&quot;delete from teacher where id = ?&quot;</span>;</span><br><span class="line">		Object[] args = &#123;id&#125;;</span><br><span class="line">		jdbcTemplate.update(sql,args);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Teacher <span class="title">selectById</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">		String sql = <span class="string">&quot;select * from teacher where id = ?&quot;</span>;</span><br><span class="line">		Object[] args = &#123;id&#125;;</span><br><span class="line">		Teacher teacher = jdbcTemplate.queryForObject(sql,args,<span class="keyword">new</span> RowMapper&lt;Teacher&gt;() &#123;</span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> Teacher <span class="title">mapRow</span><span class="params">(ResultSet rs, <span class="keyword">int</span> rowNum)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">				Teacher t = <span class="keyword">new</span> Teacher();</span><br><span class="line">				t.setId(rs.getInt(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">				t.setName(rs.getString(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">				t.setAge(rs.getInt(<span class="string">&quot;age&quot;</span>));</span><br><span class="line">				t.setSalary(rs.getDouble(<span class="string">&quot;salary&quot;</span>));</span><br><span class="line">				<span class="keyword">return</span> t;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> teacher;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Teacher&gt; <span class="title">selectAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		String sql = <span class="string">&quot;select * from teacher&quot;</span>;</span><br><span class="line">		</span><br><span class="line">		List&lt;Teacher&gt; list = jdbcTemplate.query(sql,<span class="keyword">new</span> RowMapper&lt;Teacher&gt;() &#123;</span><br><span class="line"></span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> Teacher <span class="title">mapRow</span><span class="params">(ResultSet rs, <span class="keyword">int</span> index)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">				Teacher teacher = <span class="keyword">new</span> Teacher();</span><br><span class="line">				teacher.setId(rs.getInt(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">				teacher.setName(rs.getString(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">				teacher.setAge(rs.getInt(<span class="string">&quot;age&quot;</span>));</span><br><span class="line">				teacher.setSalary(rs.getDouble(<span class="string">&quot;salary&quot;</span>));</span><br><span class="line">				<span class="keyword">return</span> teacher;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> list;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">selectCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		String sql = <span class="string">&quot;select count(*) from teacher&quot;</span>;</span><br><span class="line">		<span class="keyword">return</span> jdbcTemplate.queryForObject(sql, <span class="keyword">int</span>.class);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> JdbcTemplate <span class="title">getJdbcTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> jdbcTemplate;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJdbcTemplate</span><span class="params">(JdbcTemplate jdbcTemplate)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.jdbcTemplate = jdbcTemplate;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这里要提供GET和SET方法</p>
</blockquote>
<h3 id="3-1-xml"><a href="#3-1-xml" class="headerlink" title="3.1 xml"></a>3.1 xml</h3><p>1、xml头部声明中，引入tx命名空间：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/tx </span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/aop </span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，src下面的applicationContext.xml</p>
</blockquote>
<p>新增的内容如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206080825795.png" alt="image-20201104192941061"></p>
<p>2、在xml中进行配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/tx </span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/aop </span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置数据库连接池	 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 注入数据库连接属性 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;oracle.jdbc.OracleDriver&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:oracle:thin:@127.0.0.1:1521:XE&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;briup&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;briup&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置jdbcTemplate --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;jdbcTemplate&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.core.JdbcTemplate&quot;</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 注入数据源 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置Dao --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;teacherDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.dao.impl.TeacherDaoImpl&quot;</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 注入jdbcTemplate --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcTemplate&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;jdbcTemplate&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置Service --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;teacherService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.service.impl.TeacherServiceImpl&quot;</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 注入dao层实现类 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;teacherDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;teacherDao&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置JDBC的事务管理器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 注入数据源 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置事务拦截器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">&quot;txAdvice&quot;</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 配置事务属性 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">				name : 指定方法名称 *代表任意赐福</span></span><br><span class="line"><span class="comment">				read-only 是否是只读事务</span></span><br><span class="line"><span class="comment">				isolation：指定事务的隔离级别。默认值是使用数据库的默认隔离级别。</span></span><br><span class="line"><span class="comment">				propagation：指定事务的传播行为。</span></span><br><span class="line"><span class="comment">				timeout：指定超时时间。默认值为：-1。永不超时。</span></span><br><span class="line"><span class="comment">				rollback-for：用于指定一个异常，当执行产生该异常时，事务回滚。</span></span><br><span class="line"><span class="comment">				no-rollback-for：用于指定一个异常，当产生该异常时，事务不回滚。</span></span><br><span class="line"><span class="comment">			 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;find*&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;true&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;SUPPORTS&quot;</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;*&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRED&quot;</span> <span class="attr">rollback-for</span>=<span class="string">&quot;Exception&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">	<span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置 aop --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 定义切入点（一组方法的集合，这些方法需要织入事务控制代码） --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* com.briup.service..*.*(..))&quot;</span> <span class="attr">id</span>=<span class="string">&quot;txPointcut&quot;</span>/&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 定义advisor，可以用来组合已有的advice和pointcut --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 事务拦截器 会将 事务管理器的代码（切面类） 织入 到值的切入点内（一组方法的集合） --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">&quot;txAdvice&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;txPointcut&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span>	</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>3、测试类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Teacher;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.ITeacherService;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(locations = &quot;classpath:applicationContext.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TxXMLTest</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> ITeacherService teacherService;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_insert</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Teacher t = <span class="keyword">new</span> Teacher(<span class="number">2</span>,<span class="string">&quot;tom1&quot;</span>,<span class="number">21</span>,<span class="number">2000</span>);</span><br><span class="line">		teacherService.save(t);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，正常测试后，在service方法中主动抛出异常，观察是否可以成功回滚</p>
</blockquote>
<h3 id="3-2-注解"><a href="#3-2-注解" class="headerlink" title="3.2 注解"></a>3.2 注解</h3><p>1、dao层实现类，加入注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.dao.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.RowMapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Teacher;</span><br><span class="line"><span class="keyword">import</span> com.briup.dao.ITeacherDao;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TeacherDaoImpl</span> <span class="keyword">implements</span> <span class="title">ITeacherDao</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(Teacher t)</span> </span>&#123;</span><br><span class="line">		String sql = <span class="string">&quot;insert into teacher values(?,?,?,?)&quot;</span>;</span><br><span class="line">		Object[] args = &#123;t.getId(),t.getName(),t.getAge(),t.getSalary()&#125;;</span><br><span class="line">		jdbcTemplate.update(sql,args);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Teacher t)</span> </span>&#123;</span><br><span class="line">		String sql = <span class="string">&quot;update teacher set name = ?,age = ?,salary = ? where id = ?&quot;</span>;</span><br><span class="line">		Object[] args = &#123;t.getName(),t.getAge(),t.getSalary(),t.getId()&#125;;</span><br><span class="line">		jdbcTemplate.update(sql,args);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		String sql = <span class="string">&quot;delete from teacher&quot;</span>;</span><br><span class="line">		jdbcTemplate.update(sql);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteById</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">		String sql = <span class="string">&quot;delete from teacher where id = ?&quot;</span>;</span><br><span class="line">		Object[] args = &#123;id&#125;;</span><br><span class="line">		jdbcTemplate.update(sql,args);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Teacher <span class="title">selectById</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">		String sql = <span class="string">&quot;select * from teacher where id = ?&quot;</span>;</span><br><span class="line">		Object[] args = &#123;id&#125;;</span><br><span class="line">		Teacher teacher = jdbcTemplate.queryForObject(sql,args,<span class="keyword">new</span> RowMapper&lt;Teacher&gt;() &#123;</span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> Teacher <span class="title">mapRow</span><span class="params">(ResultSet rs, <span class="keyword">int</span> rowNum)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">				Teacher t = <span class="keyword">new</span> Teacher();</span><br><span class="line">				t.setId(rs.getInt(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">				t.setName(rs.getString(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">				t.setAge(rs.getInt(<span class="string">&quot;age&quot;</span>));</span><br><span class="line">				t.setSalary(rs.getDouble(<span class="string">&quot;salary&quot;</span>));</span><br><span class="line">				<span class="keyword">return</span> t;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> teacher;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Teacher&gt; <span class="title">selectAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		String sql = <span class="string">&quot;select * from teacher&quot;</span>;</span><br><span class="line">		</span><br><span class="line">		List&lt;Teacher&gt; list = jdbcTemplate.query(sql,<span class="keyword">new</span> RowMapper&lt;Teacher&gt;() &#123;</span><br><span class="line"></span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> Teacher <span class="title">mapRow</span><span class="params">(ResultSet rs, <span class="keyword">int</span> index)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">				Teacher teacher = <span class="keyword">new</span> Teacher();</span><br><span class="line">				teacher.setId(rs.getInt(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">				teacher.setName(rs.getString(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">				teacher.setAge(rs.getInt(<span class="string">&quot;age&quot;</span>));</span><br><span class="line">				teacher.setSalary(rs.getDouble(<span class="string">&quot;salary&quot;</span>));</span><br><span class="line">				<span class="keyword">return</span> teacher;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> list;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">selectCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		String sql = <span class="string">&quot;select count(*) from teacher&quot;</span>;</span><br><span class="line">		<span class="keyword">return</span> jdbcTemplate.queryForObject(sql, <span class="keyword">int</span>.class);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> JdbcTemplate <span class="title">getJdbcTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> jdbcTemplate;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJdbcTemplate</span><span class="params">(JdbcTemplate jdbcTemplate)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.jdbcTemplate = jdbcTemplate;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这里的GET和SET方法，写不写都可以</p>
</blockquote>
<p>2、service实现类，加入注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Propagation;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Teacher;</span><br><span class="line"><span class="keyword">import</span> com.briup.dao.ITeacherDao;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.ITeacherService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Transactional(propagation = Propagation.REQUIRED,rollbackFor = Exception.class)</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TeacherServiceImpl</span> <span class="keyword">implements</span> <span class="title">ITeacherService</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> ITeacherDao teacherDao;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Teacher t)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		teacherDao.insert(t);</span><br><span class="line">		<span class="comment">//throw new RuntimeException(&quot;异常测试&quot;);</span></span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这里的GET和SET方法，写不写都可以</p>
</blockquote>
<blockquote>
<p>注意，@Transactional中的属性配置和XML中配置的含义是一样的</p>
</blockquote>
<blockquote>
<p>注意，@Transactional可以写在类上面，也可以写在方法上面，作用优先级为： 方法 &gt; 类</p>
</blockquote>
<p>3、配置类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.datasource.DataSourceTransactionManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.PlatformTransactionManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.EnableTransactionManagement;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.briup&quot;)</span> <span class="comment">//指定扫描com.briup包及其子包下面类中的注解</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcConfig</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 创建数据库连接池，并且交给Spring容器管理</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> DataSource <span class="title">dataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		DruidDataSource dataSource = <span class="keyword">new</span> DruidDataSource();</span><br><span class="line">		dataSource.setDriverClassName(<span class="string">&quot;oracle.jdbc.OracleDriver&quot;</span>);</span><br><span class="line">		dataSource.setUrl(<span class="string">&quot;jdbc:oracle:thin:@127.0.0.1:1521:XE&quot;</span>);</span><br><span class="line">		dataSource.setUsername(<span class="string">&quot;briup&quot;</span>);</span><br><span class="line">		dataSource.setPassword(<span class="string">&quot;briup&quot;</span>);</span><br><span class="line">		dataSource.setInitialSize(<span class="number">5</span>);</span><br><span class="line">		dataSource.setMaxActive(<span class="number">10</span>);</span><br><span class="line">		<span class="keyword">return</span> dataSource;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 创建JdbcTemplate对象交给Spring容器管理</span></span><br><span class="line"><span class="comment">	 * 注意，需要将配置好的数据源注入到JdbcTemplate中</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> JdbcTemplate <span class="title">jdbcTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		JdbcTemplate template = <span class="keyword">new</span> JdbcTemplate();</span><br><span class="line">		template.setDataSource(dataSource());</span><br><span class="line">		<span class="keyword">return</span> template;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 配置JDBC的事务管理到spring容器中</span></span><br><span class="line"><span class="comment">	 * 注意，如果没有配置事务管理器的话，会报错，如下：</span></span><br><span class="line"><span class="comment">	 * No qualifying bean of type &#x27;org.springframework.transaction.PlatformTransactionManager&#x27; available</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> PlatformTransactionManager <span class="title">transactionManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		DataSourceTransactionManager transactionManager = <span class="keyword">new</span> DataSourceTransactionManager();</span><br><span class="line">		transactionManager.setDataSource(dataSource());</span><br><span class="line">		<span class="keyword">return</span> transactionManager;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，@EnableTransactionManagement表示开启事务注解配置的支持</p>
</blockquote>
<blockquote>
<p>注意，在xml中，也能通知spring，我们使用了注解的方式进行事务配置。例如，&lt;tx:annotation-driven/&gt;</p>
</blockquote>
<p>4、测试类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Teacher;</span><br><span class="line"><span class="keyword">import</span> com.briup.config.JdbcConfig;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.ITeacherService;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(classes = &#123;JdbcConfig.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TxAnnotationTest</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> ITeacherService teacherService;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_insert</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Teacher t = <span class="keyword">new</span> Teacher(<span class="number">1</span>,<span class="string">&quot;tom1&quot;</span>,<span class="number">21</span>,<span class="number">2000</span>);</span><br><span class="line">		teacherService.save(t);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，正常测试后，在service方法中主动抛出异常，观察是否可以成功回滚</p>
</blockquote>
<h2 id="4-Mybaits"><a href="#4-Mybaits" class="headerlink" title="4.Mybaits"></a>4.Mybaits</h2><blockquote>
<p>Spring也可以和Mybaits进行整合，主要分俩种情况，xml和注解</p>
</blockquote>
<p>Spring整合Mybaits的核心点有俩个：</p>
<ul>
<li>把Mybaits的SqlSessionFactory交给Spring容器进行管理</li>
<li>让Spring去扫描Mybatis的映射接口，以便为其生成动态代理对象</li>
</ul>
<h3 id="4-1-xml"><a href="#4-1-xml" class="headerlink" title="4.1 xml"></a>4.1 xml</h3><p>1、导入jar包</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206080825883.png" alt="image-20201104222911838"></p>
<p>2、建表语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> teacher;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> teacher(</span><br><span class="line">	id number <span class="keyword">primary</span> key,</span><br><span class="line">	name varchar2(<span class="number">22</span>),</span><br><span class="line">    age number,</span><br><span class="line">    salary number</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> sequence my_seq;</span><br></pre></td></tr></table></figure>



<p>3、实体类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Teacher</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">double</span> salary;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>3、dao层接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Teacher;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ITeacherDao</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">insertTeacher</span><span class="params">(Teacher teacher)</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function">Teacher <span class="title">selectTeacherById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这个相当于mybaits的映射接口</p>
</blockquote>
<p>4、sql映射文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span> </span><br><span class="line">			<span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> </span></span><br><span class="line"><span class="meta">			<span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.briup.dao.ITeacherDao&quot;</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertTeacher&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Teacher&quot;</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		<span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">order</span>=<span class="string">&quot;BEFORE&quot;</span>&gt;</span></span><br><span class="line">			select my_seq.nextVal from dual</span><br><span class="line">		<span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		insert into teacher(id,name,age,salary)</span><br><span class="line">		values(#&#123;id&#125;,#&#123;name&#125;,#&#123;age&#125;,#&#123;salary&#125;)</span><br><span class="line">		</span><br><span class="line">	<span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectTeacherById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Teacher&quot;</span>&gt;</span></span><br><span class="line">		select id,name,age,salary</span><br><span class="line">		from teacher</span><br><span class="line">		where id=#&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span> </span><br></pre></td></tr></table></figure>



<p>5、service接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Teacher;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ITeacherService</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">save</span><span class="params">(Teacher t)</span></span>;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>6、service层实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Teacher;</span><br><span class="line"><span class="keyword">import</span> com.briup.dao.ITeacherDao;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.ITeacherService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TeacherServiceImpl</span> <span class="keyword">implements</span> <span class="title">ITeacherService</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> ITeacherDao teacherDao;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Teacher t)</span> </span>&#123;</span><br><span class="line">		teacherDao.insertTeacher(t);</span><br><span class="line"><span class="comment">//		throw new RuntimeException(&quot;异常测试&quot;);</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ITeacherDao <span class="title">getTeacherDao</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> teacherDao;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTeacherDao</span><span class="params">(ITeacherDao teacherDao)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.teacherDao = teacherDao;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这里需要加入GET和SET方法</p>
</blockquote>
<p>7、log4j日志配置 log4j.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">log4j.rootLogger</span>=<span class="string">DEBUG, stdout </span></span><br><span class="line"><span class="meta">log4j.appender.stdout</span>=<span class="string">org.apache.log4j.ConsoleAppender </span></span><br><span class="line"><span class="meta">log4j.appender.stdout.layout</span>=<span class="string">org.apache.log4j.PatternLayout </span></span><br><span class="line"><span class="meta">log4j.appender.stdout.layout.ConversionPattern</span>=<span class="string">%d [%-5p] %c - %m%n</span></span><br><span class="line"><span class="comment">#show sql</span></span><br><span class="line"><span class="meta">log4j.logger.java.sql.ResultSet</span>=<span class="string">INFO  </span></span><br><span class="line"><span class="meta">log4j.logger.org.apache</span>=<span class="string">INFO  </span></span><br><span class="line"><span class="meta">log4j.logger.java.sql.Connection</span>=<span class="string">DEBUG  </span></span><br><span class="line"><span class="meta">log4j.logger.java.sql.Statement</span>=<span class="string">DEBUG  </span></span><br><span class="line"><span class="meta">log4j.logger.java.sql.PreparedStatement</span>=<span class="string">DEBUG </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># set springframework log-level</span></span><br><span class="line"><span class="meta">log4j.logger.org.springframework</span>=<span class="string">WARN</span></span><br><span class="line"><span class="comment"># set mybatis log-level</span></span><br><span class="line"><span class="meta">log4j.logger.org.mybatis</span>=<span class="string">WARN</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>8、资源文件 dataSource.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">jdbc.driverClassName</span>=<span class="string">oracle.jdbc.OracleDriver</span></span><br><span class="line"><span class="meta">jdbc.url</span>=<span class="string">jdbc:oracle:thin:@127.0.0.1:1521:XE</span></span><br><span class="line"><span class="meta">jdbc.username</span>=<span class="string">briup</span></span><br><span class="line"><span class="meta">jdbc.password</span>=<span class="string">briup</span></span><br></pre></td></tr></table></figure>



<p>9、spring配置文件 spring-dao.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/tx </span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/aop </span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 读取properties资源文件内容 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:dataSource.properties&quot;</span> /&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置数据库连接池	 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 注入数据库连接属性 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driverClassName&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置sqlSessionFactory --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 注入数据源 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置别名 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;typeAliasesPackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.briup.bean&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置sql映射文件路径，支持通配符 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;mapperLocations&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:com/briup/mapper/*Mapper.xml&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置映射接口所在位置 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;basePackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.briup.dao&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，配置文件的头部声明中的命名空间的引入以及对应的schame文件的引入</p>
</blockquote>
<blockquote>
<p>注意，在整合mybaits的时候，这里主要是将sqlSessionFactory配置到spring的容器中</p>
</blockquote>
<blockquote>
<p>注意，配置MapperScannerConfigurer主要是为了让其扫描映射接口，方便为其生成动态代理对象</p>
</blockquote>
<p>在这种配置下，mybatis是不需要配置文件mybatis-config.xml的，该文件中所有配置都写在了spring的配置中，当然也可以和以前一样，配置mybaits-congfig.xml文件，然后再让spring去读取这个文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置sqlSessionFactory --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 注入数据源 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置读取外部的mybatis-config.xml文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;configLocation&quot;</span> <span class="attr">value</span>=<span class="string">&quot;mybatis-config.xml&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>10、spring配置文件 spring-service.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/tx </span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/aop </span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置Service --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;teacherService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.service.impl.TeacherServiceImpl&quot;</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 注入dao层实现类 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;teacherDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;ITeacherDao&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置事务管理器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 注入数据源 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置事务拦截器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">&quot;txAdvice&quot;</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 配置事务属性 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;find*&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;true&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;SUPPORTS&quot;</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;*&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRED&quot;</span> <span class="attr">rollback-for</span>=<span class="string">&quot;Exception&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">	<span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置 aop --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 定义切入点（一组方法的集合，这些方法需要织入事务控制代码） --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* com.briup.service..*.*(..))&quot;</span> <span class="attr">id</span>=<span class="string">&quot;txPointcut&quot;</span>/&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 定义advisor，可以用来组合已有的advice和pointcut --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">&quot;txAdvice&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;txPointcut&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span>	</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这里配置service层对象，以及配置service事务，和之前是一样的</p>
</blockquote>
<p>11、spring配置文件 applicationContext.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/tx </span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/aop </span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;spring-dao.xml&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;spring-service.xml&quot;</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这里导入spring的另外俩个配置文件，将来读取这一个配置文件即可</p>
</blockquote>
<p>12、测试类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Teacher;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.ITeacherService;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="comment">//指定要读取的配置文件所在位置</span></span><br><span class="line"><span class="meta">@ContextConfiguration(locations = &quot;classpath:applicationContext.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisXMLTest</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> ITeacherService teacherService;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_insert</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//id以配置为使用序列自动生成</span></span><br><span class="line">		Teacher t = <span class="keyword">new</span> Teacher();</span><br><span class="line">		t.setName(<span class="string">&quot;tom&quot;</span>);</span><br><span class="line">		t.setAge(<span class="number">20</span>);</span><br><span class="line">		t.setSalary(<span class="number">2000</span>);</span><br><span class="line">		teacherService.save(t);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，正常测试后，在service方法中主动抛出异常，观察是否可以成功回滚</p>
</blockquote>
<p>整体的项目结构为：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206080826203.png" alt="image-20201104225350862"></p>
<h3 id="4-2-注解"><a href="#4-2-注解" class="headerlink" title="4.2 注解"></a>4.2 注解</h3><p>在上面xml配置的例子上进行修改即可，这里只描述改动的文件或代码，没做修改的不重复描述。</p>
<p>1、修改service实体类，添加注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Propagation;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Teacher;</span><br><span class="line"><span class="keyword">import</span> com.briup.dao.ITeacherDao;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.ITeacherService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Transactional(propagation = Propagation.REQUIRED,rollbackFor = Exception.class)</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TeacherServiceImpl</span> <span class="keyword">implements</span> <span class="title">ITeacherService</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> ITeacherDao teacherDao;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Teacher t)</span> </span>&#123;</span><br><span class="line">		teacherDao.insertTeacher(t);</span><br><span class="line"><span class="comment">//		throw new RuntimeException(&quot;异常测试&quot;);</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>2、新增配置类，SpringConfig.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.EnableTransactionManagement;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.briup.service&quot;)</span><span class="comment">//指定需要扫描的包及其子包</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span><span class="comment">//开启事务配置的注解支持</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConfig</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<p>3、新增配置类，MybatisConfig.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.SqlSessionFactoryBean;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.PropertySource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.support.PathMatchingResourcePatternResolver;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.support.ResourcePatternResolver;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.datasource.DataSourceTransactionManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.PlatformTransactionManager;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;classpath:dataSource.properties&quot;)</span><span class="comment">//读取资源文件</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.briup.dao&quot;)</span><span class="comment">//指定扫描映射接口的位置</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisConfig</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Value(&quot;$&#123;jdbc.driverClassName&#125;&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String driverClassName;</span><br><span class="line">	<span class="meta">@Value(&quot;$&#123;jdbc.url&#125;&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String url;</span><br><span class="line">	<span class="meta">@Value(&quot;$&#123;jdbc.username&#125;&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String username;</span><br><span class="line">	<span class="meta">@Value(&quot;$&#123;jdbc.password&#125;&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String password;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 配置数据源dataSource</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> DataSource <span class="title">dataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		DruidDataSource dataSource = <span class="keyword">new</span> DruidDataSource();</span><br><span class="line">		dataSource.setDriverClassName(<span class="string">&quot;oracle.jdbc.OracleDriver&quot;</span>);</span><br><span class="line">		dataSource.setUrl(<span class="string">&quot;jdbc:oracle:thin:@127.0.0.1:1521:XE&quot;</span>);</span><br><span class="line">		dataSource.setUsername(<span class="string">&quot;briup&quot;</span>);</span><br><span class="line">		dataSource.setPassword(<span class="string">&quot;briup&quot;</span>);</span><br><span class="line">		dataSource.setInitialSize(<span class="number">5</span>);</span><br><span class="line">		dataSource.setMaxActive(<span class="number">10</span>);</span><br><span class="line">		<span class="keyword">return</span> dataSource;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 配置SqlSessionFactoryBean，用来产生SqlSessionFactory，从而获取SqlSession</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SqlSessionFactoryBean <span class="title">sqlSessionFactoryBean</span><span class="params">()</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">		<span class="comment">//资源解析器，用来读取指定位置的xml映射文件</span></span><br><span class="line">        ResourcePatternResolver resourcePatternResolver = <span class="keyword">new</span> PathMatchingResourcePatternResolver();  </span><br><span class="line">        </span><br><span class="line">        <span class="comment">//创建SqlSessionFactoryBean对象</span></span><br><span class="line">        SqlSessionFactoryBean sqlSessionFactoryBean = <span class="keyword">new</span> SqlSessionFactoryBean();</span><br><span class="line">        <span class="comment">//注入数据源</span></span><br><span class="line">        sqlSessionFactoryBean.setDataSource(dataSource());</span><br><span class="line">        <span class="comment">//配置别名</span></span><br><span class="line">        sqlSessionFactoryBean.setTypeAliasesPackage(<span class="string">&quot;com.briup.bean&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//配置sql映射文件路径，支持通配符 </span></span><br><span class="line">        <span class="comment">//注意，这里调用的是getResources()方法，而不是getResource()方法</span></span><br><span class="line">        sqlSessionFactoryBean.setMapperLocations(resourcePatternResolver.getResources(<span class="string">&quot;classpath:com/briup/mapper/*Mapper.xml&quot;</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> sqlSessionFactoryBean;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 配置JDBC的事务管理器（Mybaits通用）</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> PlatformTransactionManager <span class="title">transactionManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		DataSourceTransactionManager transactionManager = <span class="keyword">new</span> DataSourceTransactionManager();</span><br><span class="line">		transactionManager.setDataSource(dataSource());</span><br><span class="line">		<span class="keyword">return</span> transactionManager;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，此配置类的作用是代替了之前的spring-dao.xml文件</p>
</blockquote>
<p>这里主要完成以下几个工作，以代替之前的xml配置：</p>
<ul>
<li>指定要扫描的映射接口所在包</li>
<li>配置数据源</li>
<li>配置事务管理器</li>
<li>配置SqlSessionFactoryBean（核心）</li>
</ul>
<p>4、测试类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Teacher;</span><br><span class="line"><span class="keyword">import</span> com.briup.config.MybatisConfig;</span><br><span class="line"><span class="keyword">import</span> com.briup.config.SpringConfig;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.ITeacherService;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="comment">//指定要读取的配置类</span></span><br><span class="line"><span class="meta">@ContextConfiguration(classes = &#123;SpringConfig.class,MybatisConfig.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisAnnotationTest</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> ITeacherService teacherService;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_insert</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//id以配置为使用序列自动生成</span></span><br><span class="line">		Teacher t = <span class="keyword">new</span> Teacher();</span><br><span class="line">		t.setName(<span class="string">&quot;tom&quot;</span>);</span><br><span class="line">		t.setAge(<span class="number">20</span>);</span><br><span class="line">		t.setSalary(<span class="number">2000</span>);</span><br><span class="line">		teacherService.save(t);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，正常测试后，在service方法中主动抛出异常，观察是否可以成功回滚</p>
</blockquote>
<p>整体的项目结构为：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206080826389.png" alt="image-20201104232423963"></p>
<blockquote>
<p>注意，此时使用注解功能的话，这里的spring配置文件都用不上了</p>
</blockquote>
<h2 id="5-web"><a href="#5-web" class="headerlink" title="5.web"></a>5.web</h2><h3 id="5-1-概述-2"><a href="#5-1-概述-2" class="headerlink" title="5.1 概述"></a>5.1 概述</h3><blockquote>
<p>Spring在web环境（Servlet）中的配置，主要分俩种情况，xml和注解</p>
</blockquote>
<p>Spring框架在web环境（Servlet）中的工作核心是：</p>
<ul>
<li>在web.xml中配置监听器，启动服务器的过程中读取Spring的配置文件或者配置类，创建Spring容器</li>
<li>在web环境中，Spring容器的类型是<code>WebApplicationContext</code>，它是<code>ApplicationContext</code>的子接口</li>
</ul>
<p>例如，完成Servlet+Spring+Mybaits的环境配置，将来学习SpringMVC后，在完成SpringMVC+Spring+Mybait的配置。</p>
<h3 id="5-2-xml"><a href="#5-2-xml" class="headerlink" title="5.2 xml"></a>5.2 xml</h3><p>新建动态web项目（spring-servlet-xml），maven项目也可以，只是引入jar的方式不同。</p>
<p>在此项目中进行配置，这里面的大多数<strong>配置和代码</strong>，可以参考上一个示例项目中的（spring-mybaits）配置，只是比它多了一个web层和 web环境</p>
<p>1、导入jar包</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206080826439.png" alt="image-20201105100025643"></p>
<blockquote>
<p>注意，这里额外引入了spring-web的jar包，提供spring对web的支持</p>
</blockquote>
<p>2、实体类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Teacher</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">double</span> salary;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>3、dao层映射接口 和 映射文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Teacher;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ITeacherDao</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">insertTeacher</span><span class="params">(Teacher teacher)</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function">Teacher <span class="title">selectTeacherById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>TeacherMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span> </span><br><span class="line">			<span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> </span></span><br><span class="line"><span class="meta">			<span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.briup.dao.ITeacherDao&quot;</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertTeacher&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Teacher&quot;</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		<span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">order</span>=<span class="string">&quot;BEFORE&quot;</span>&gt;</span></span><br><span class="line">			select my_seq.nextVal from dual</span><br><span class="line">		<span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		insert into teacher(id,name,age,salary)</span><br><span class="line">		values(#&#123;id&#125;,#&#123;name&#125;,#&#123;age&#125;,#&#123;salary&#125;)</span><br><span class="line">		</span><br><span class="line">	<span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectTeacherById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Teacher&quot;</span>&gt;</span></span><br><span class="line">		select id,name,age,salary</span><br><span class="line">		from teacher</span><br><span class="line">		where id=#&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span> </span><br></pre></td></tr></table></figure>



<p>4、service层接口 和 实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Teacher;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ITeacherService</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">save</span><span class="params">(Teacher t)</span></span>;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Teacher;</span><br><span class="line"><span class="keyword">import</span> com.briup.dao.ITeacherDao;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.ITeacherService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TeacherServiceImpl</span> <span class="keyword">implements</span> <span class="title">ITeacherService</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> ITeacherDao teacherDao;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Teacher t)</span> </span>&#123;</span><br><span class="line">		teacherDao.insertTeacher(t);</span><br><span class="line"><span class="comment">//		throw new RuntimeException(&quot;异常测试&quot;);</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ITeacherDao <span class="title">getTeacherDao</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> teacherDao;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTeacherDao</span><span class="params">(ITeacherDao teacherDao)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.teacherDao = teacherDao;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这里需要提供GET和SET方法</p>
</blockquote>
<p>5、资源文件 和 日志配置</p>
<p>dataSource.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">jdbc.driverClassName</span>=<span class="string">oracle.jdbc.OracleDriver</span></span><br><span class="line"><span class="meta">jdbc.url</span>=<span class="string">jdbc:oracle:thin:@127.0.0.1:1521:XE</span></span><br><span class="line"><span class="meta">jdbc.username</span>=<span class="string">briup</span></span><br><span class="line"><span class="meta">jdbc.password</span>=<span class="string">briup</span></span><br></pre></td></tr></table></figure>



<p>log4j.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">log4j.rootLogger</span>=<span class="string">DEBUG, stdout </span></span><br><span class="line"><span class="meta">log4j.appender.stdout</span>=<span class="string">org.apache.log4j.ConsoleAppender </span></span><br><span class="line"><span class="meta">log4j.appender.stdout.layout</span>=<span class="string">org.apache.log4j.PatternLayout </span></span><br><span class="line"><span class="meta">log4j.appender.stdout.layout.ConversionPattern</span>=<span class="string">%d [%-5p] %c - %m%n</span></span><br><span class="line"><span class="comment">#show sql</span></span><br><span class="line"><span class="meta">log4j.logger.java.sql.ResultSet</span>=<span class="string">INFO  </span></span><br><span class="line"><span class="meta">log4j.logger.org.apache</span>=<span class="string">INFO  </span></span><br><span class="line"><span class="meta">log4j.logger.java.sql.Connection</span>=<span class="string">DEBUG  </span></span><br><span class="line"><span class="meta">log4j.logger.java.sql.Statement</span>=<span class="string">DEBUG  </span></span><br><span class="line"><span class="meta">log4j.logger.java.sql.PreparedStatement</span>=<span class="string">DEBUG </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># set springframework log-level</span></span><br><span class="line"><span class="meta">log4j.logger.org.springframework</span>=<span class="string">WARN</span></span><br><span class="line"><span class="comment"># set mybatis log-level</span></span><br><span class="line"><span class="meta">log4j.logger.org.mybatis</span>=<span class="string">WARN</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>6、spring配置文件</p>
<p>spring-dao.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/tx </span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/aop </span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 读取properties资源文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:dataSource.properties&quot;</span> /&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置数据库连接池	 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 注入数据库连接属性 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driverClassName&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置sqlSessionFactory --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 注入数据源 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置别名 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;typeAliasesPackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.briup.bean&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置sql映射文件路径，支持通配符 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;mapperLocations&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:com/briup/mapper/*Mapper.xml&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置映射接口所在位置 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;basePackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.briup.dao&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>spring-service.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/tx </span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/aop </span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置Service --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;teacherService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.service.impl.TeacherServiceImpl&quot;</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 注入dao层实现类 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;teacherDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;ITeacherDao&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 事务配置代码 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 注入数据源 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置事务通知 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">&quot;txAdvice&quot;</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 配置事务属性 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;find*&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;true&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;SUPPORTS&quot;</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;*&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRED&quot;</span> <span class="attr">rollback-for</span>=<span class="string">&quot;Exception&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">	<span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置 aop --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 定义切入点（一组方法的集合，这些方法需要织入事务控制代码） --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* com.briup.service..*.*(..))&quot;</span> <span class="attr">id</span>=<span class="string">&quot;txPointcut&quot;</span>/&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 定义advisor，可以用来组合已有的advice和pointcut --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">&quot;txAdvice&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;txPointcut&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span>	</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>applicationContext.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/tx </span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/aop </span></span></span><br><span class="line"><span class="string"><span class="tag">						http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;spring-dao.xml&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;spring-service.xml&quot;</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>7、web.xml （重要）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">version</span>=<span class="string">&quot;3.1&quot;</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!--配置spring文件的加载路径--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 配置监听器，读取配置文件，创建spring容器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，服务器启动期间，读取Spring配置文件，创建Spring容器对象</p>
</blockquote>
<p>8、servlet</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.config.AutowireCapableBeanFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.WebApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.support.WebApplicationContextUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Teacher;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.ITeacherService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(value=&quot;/test&quot;,loadOnStartup = 1)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> ITeacherService teacherService;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">		<span class="comment">//获取spring容器，进行初始化</span></span><br><span class="line">		WebApplicationContext ac = WebApplicationContextUtils.getWebApplicationContext(<span class="keyword">this</span>.getServletContext());</span><br><span class="line">		teacherService = ac.getBean(ITeacherService.class);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		</span><br><span class="line">		 Teacher t = <span class="keyword">new</span> Teacher();</span><br><span class="line">		 t.setName(<span class="string">&quot;tom&quot;</span>);</span><br><span class="line">		 t.setAge(<span class="number">20</span>);</span><br><span class="line">		 t.setSalary(<span class="number">5000</span>);</span><br><span class="line">		 teacherService.save(t);</span><br><span class="line">		 </span><br><span class="line">		 resp.setContentType(<span class="string">&quot;text/plain;charset=utf-8&quot;</span>);</span><br><span class="line">		 </span><br><span class="line">		 PrintWriter out = resp.getWriter();</span><br><span class="line">		 </span><br><span class="line">		 out.println(<span class="string">&quot;操作成功！&quot;</span>);</span><br><span class="line">		 </span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这里的重点是init方法中，获取了Spring容器对象</p>
</blockquote>
<blockquote>
<p>注意，servlet在web容器中，并不归spring容器管理，所以需要单独从spring容器中拿到Service对象进行赋值</p>
</blockquote>
<p>9、部署项目、启动服务器进行测试</p>
<p>部署的时候，可以设置项目的ContexnPath为/</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206080826412.png" alt="image-20201105101348940"></p>
<blockquote>
<p>注意，正常测试后，在service方法中主动抛出异常，观察是否可以成功回滚</p>
</blockquote>
<p>最后的项目结构为：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206080826671.png" alt="image-20201105101751381"></p>
<h3 id="5-3-注解"><a href="#5-3-注解" class="headerlink" title="5.3 注解"></a>5.3 注解</h3><p>复制项目spring-servlet-xml，粘贴为新项目spring-servlet-annotation，在此基础上进行修改。</p>
<p>这里只描述修改或新增的文件/配置，没有改动的不再进行描述。</p>
<p>1、修改service实现，添加注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Propagation;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Teacher;</span><br><span class="line"><span class="keyword">import</span> com.briup.dao.ITeacherDao;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.ITeacherService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Transactional(propagation = Propagation.REQUIRED,rollbackFor = Exception.class)</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TeacherServiceImpl</span> <span class="keyword">implements</span> <span class="title">ITeacherService</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> ITeacherDao teacherDao;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Teacher t)</span> </span>&#123;</span><br><span class="line">		teacherDao.insertTeacher(t);</span><br><span class="line"><span class="comment">//		throw new RuntimeException(&quot;异常测试&quot;);</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>2、新增三个配置类</p>
<p>SpringConfig.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.EnableTransactionManagement;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.briup.service&quot;)</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConfig</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>MybatisConfig.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.SqlSessionFactoryBean;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.PropertySource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.support.PathMatchingResourcePatternResolver;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.support.ResourcePatternResolver;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.datasource.DataSourceTransactionManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.PlatformTransactionManager;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;classpath:dataSource.properties&quot;)</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.briup.dao&quot;)</span><span class="comment">//指定扫描映射接口的位置</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisConfig</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Value(&quot;$&#123;jdbc.driverClassName&#125;&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String driverClassName;</span><br><span class="line">	<span class="meta">@Value(&quot;$&#123;jdbc.url&#125;&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String url;</span><br><span class="line">	<span class="meta">@Value(&quot;$&#123;jdbc.username&#125;&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String username;</span><br><span class="line">	<span class="meta">@Value(&quot;$&#123;jdbc.password&#125;&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String password;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 配置数据源dataSource</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> DataSource <span class="title">dataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		DruidDataSource dataSource = <span class="keyword">new</span> DruidDataSource();</span><br><span class="line">		dataSource.setDriverClassName(<span class="string">&quot;oracle.jdbc.OracleDriver&quot;</span>);</span><br><span class="line">		dataSource.setUrl(<span class="string">&quot;jdbc:oracle:thin:@127.0.0.1:1521:XE&quot;</span>);</span><br><span class="line">		dataSource.setUsername(<span class="string">&quot;briup&quot;</span>);</span><br><span class="line">		dataSource.setPassword(<span class="string">&quot;briup&quot;</span>);</span><br><span class="line">		dataSource.setInitialSize(<span class="number">5</span>);</span><br><span class="line">		dataSource.setMaxActive(<span class="number">10</span>);</span><br><span class="line">		<span class="keyword">return</span> dataSource;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 配置SqlSessionFactoryBean，用来产生SqlSessionFactory，从而获取SqlSession</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SqlSessionFactoryBean <span class="title">sqlSessionFactoryBean</span><span class="params">()</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">		<span class="comment">//资源解析器，用来读取指定位置的xml映射文件</span></span><br><span class="line">        ResourcePatternResolver resourcePatternResolver = <span class="keyword">new</span> PathMatchingResourcePatternResolver();  </span><br><span class="line">        </span><br><span class="line">        <span class="comment">//创建SqlSessionFactoryBean对象</span></span><br><span class="line">        SqlSessionFactoryBean sqlSessionFactoryBean = <span class="keyword">new</span> SqlSessionFactoryBean();</span><br><span class="line">        <span class="comment">//注入数据源</span></span><br><span class="line">        sqlSessionFactoryBean.setDataSource(dataSource());</span><br><span class="line">        <span class="comment">//配置别名</span></span><br><span class="line">        sqlSessionFactoryBean.setTypeAliasesPackage(<span class="string">&quot;com.briup.bean&quot;</span>);</span><br><span class="line">        <span class="comment">//配置sql映射文件路径，支持通配符 </span></span><br><span class="line">        sqlSessionFactoryBean.setMapperLocations(resourcePatternResolver.getResources(<span class="string">&quot;classpath:com/briup/mapper/*Mapper.xml&quot;</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> sqlSessionFactoryBean;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 配置JDBC的事务管理器（Mybaits通用）</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> PlatformTransactionManager <span class="title">transactionManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		DataSourceTransactionManager transactionManager = <span class="keyword">new</span> DataSourceTransactionManager();</span><br><span class="line">		transactionManager.setDataSource(dataSource());</span><br><span class="line">		<span class="keyword">return</span> transactionManager;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>AppConfig.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Import;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Import(&#123;SpringConfig.class,MybatisConfig.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这里导入了另外俩个配置类，将来spring只要读取这一个配置类就可以了</p>
</blockquote>
<p>3、删除spring配置文件：spring-dao.xml 、 spring-service.xml、applicationContext.xml</p>
<p>因为已经分别使用SpringConfig、MybatisConfig、AppConfig三个配置类代替了</p>
<blockquote>
<p>注意，此时项目中就没有了Spring的配置文件了</p>
</blockquote>
<p>4、修改servlet</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.config.AutowireCapableBeanFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.WebApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.support.WebApplicationContextUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Teacher;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.ITeacherService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(value=&quot;/test&quot;,loadOnStartup = 1)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> ITeacherService teacherService;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">		<span class="comment">//获取spring容器，进行初始化</span></span><br><span class="line">		WebApplicationContext ac = WebApplicationContextUtils.getWebApplicationContext(<span class="keyword">this</span>.getServletContext());</span><br><span class="line">		<span class="comment">//通过Spring容器获取AutowireCapableBeanFactory</span></span><br><span class="line">		<span class="comment">//AutowireCapableBeanFactory可以让容器外的bean使用依赖注入</span></span><br><span class="line">		AutowireCapableBeanFactory autowireCapableBeanFactory  = ac.getAutowireCapableBeanFactory();</span><br><span class="line">		autowireCapableBeanFactory.autowireBean(<span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		</span><br><span class="line">		 Teacher t = <span class="keyword">new</span> Teacher();</span><br><span class="line">		 t.setName(<span class="string">&quot;tom&quot;</span>);</span><br><span class="line">		 t.setAge(<span class="number">20</span>);</span><br><span class="line">		 t.setSalary(<span class="number">5000</span>);</span><br><span class="line">		 teacherService.save(t);</span><br><span class="line">		 </span><br><span class="line">		 resp.setContentType(<span class="string">&quot;text/plain;charset=utf-8&quot;</span>);</span><br><span class="line">		 </span><br><span class="line">		 PrintWriter out = resp.getWriter();</span><br><span class="line">		 </span><br><span class="line">		 out.println(<span class="string">&quot;操作成功！&quot;</span>);</span><br><span class="line">		 </span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这里使用AutowireCapableBeanFactory，来配置容器外的对象（servlet），使用spring容器的依赖注入</p>
</blockquote>
<blockquote>
<p>注意，这里就可以让servlet使用spring的依赖注入了 @Autowired</p>
</blockquote>
<p>5、修改web.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">version</span>=<span class="string">&quot;3.1&quot;</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!--配置Spring专门读取注解和配置类的容器类型--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextClass<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>org.springframework.web.context.support.AnnotationConfigWebApplicationContext<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--配置自定义的spring配置类（全限定名）  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>com.briup.config.AppConfig<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span> </span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 配置监听器，启动服务器期间读取配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这里的头部声明中，加入了context命名空间和对应的schemaLocation</p>
</blockquote>
<p>6、部署、启动服务器，访问servlet</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206080827410.png" alt="image-20201105104634616"></p>
<blockquote>
<p>注意，正常测试后，在service方法中主动抛出异常，观察是否可以成功回滚</p>
</blockquote>
<p>最后的项目结构为：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/spring/202206080827304.png" alt="image-20201105112208979"></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/briup/" rel="tag">briup</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/" rel="tag">java</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-briup/briup-mybatis"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/archives/briup/briup-mybatis.html"
    >briup-mybatis</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/archives/briup/briup-mybatis.html" class="article-date">
  <time datetime="2022-05-22T08:09:35.000Z" itemprop="datePublished">2022-05-22</time>
</a>    
    </div>
     
	
	 
	
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="第一章-基础"><a href="#第一章-基础" class="headerlink" title="第一章-基础"></a>第一章-基础</h1><h2 id="0-jdbc"><a href="#0-jdbc" class="headerlink" title="0.jdbc"></a>0.jdbc</h2><p><code>jdbc 问题分析</code></p>
<p>1、数据库链接创建、释放频繁造成系统资源浪费从而影响系统性能，如果使用数据库链接池可解决此问题。 </p>
<p>2、Sql 语句在代码中硬编码，造成代码不易维护，实际应用 sql 变化的可能较大，sql 变动需要改变 java 代码。 </p>
<p>3、使用 preparedStatement 向占有位符号传参数存在硬编码，因为 sql 语句的 where 条件不一定，可能 多也可能少，修改 sql 还要修改代码，系统不易维护。 </p>
<p>4、对结果集解析存在硬编码（查询列名），sql 变化导致解析代码变化，系统不易维护，如果能将数据库记 录封装成 pojo 对象解析比较方便。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/mybatis/202205221733517.png" alt="image-20210914092945449"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">结构一样,sql不一样	</span><br><span class="line"><span class="meta">Jdbc-&gt;</span><span class="bash">JdbcUtil-&gt;QueryRunner-&gt;  Mybatis</span></span><br><span class="line">				JdbcTemplate   Hibernate</span><br><span class="line">				...</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">配置文件-&gt; mybatis加载配置文件 -&gt; SqlSesson -&gt; 调用sql</span><br><span class="line"></span><br><span class="line">加载配置文件</span><br><span class="line">	InputStream in = Resources.getRresourceAsStream(&quot;&quot;);</span><br><span class="line"></span><br><span class="line">获取session</span><br><span class="line">	SqlSessionFactory factory = new SqlSessionFactoryBuilder().build(in);</span><br><span class="line">	SqlSession session = factory.openSqlSession();</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">// 调用sql	</span><br><span class="line">	// session.insert(&quot;com.briup.dao.student.InsertStudent&quot;,student);</span><br><span class="line">调用Mapper接口</span><br><span class="line">	StudentMapper studentMapper= session.getMapper(StudentMapper.class);</span><br><span class="line">	studentMapper.insertStudent(student);</span><br><span class="line">	</span><br><span class="line">该方式可能不会出错</span><br><span class="line">	映射器:</span><br><span class="line">		映射接口和映射文件相关联</span><br><span class="line">		StudentMapper&#123;					 </span><br><span class="line">			insertStudent(Student);			</span><br><span class="line">		&#125;</span><br><span class="line">		StudentMapper.xml</span><br><span class="line">			 &lt;insert id=&quot;insert&quot; param=&quot;Student&quot;&gt;</span><br><span class="line">			 &lt;/insert&gt;</span><br><span class="line"></span><br><span class="line">主配置文件</span><br><span class="line">日志</span><br><span class="line">封装</span><br><span class="line">映射文件</span><br></pre></td></tr></table></figure>



<h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1.概述"></a>1.概述</h2><h3 id="1-1起源"><a href="#1-1起源" class="headerlink" title="1.1起源"></a>1.1起源</h3><p><code>MyBatis</code> 是一款优秀的持久层开源框架，它支持自定义 SQL、存储过程以及高级映射。<code>MyBatis</code>免除了几乎所有的 JDBC 代码以及设置参数和获取结果集的工作。<code>MyBatis</code>可以通过简单的 XML 或注解来配置和映射原始类型、接口和 Java POJO（Plain Old java Objects，普通老式 Java 对象）为数据库中的记录。</p>
<p>MyBatis的前身是iBATIS，iBATIS于2002年由ClintonBegin创建。MyBatis3是iBATIS的全新设计，支持注解和Mapper。</p>
<p>MyBatis流行的主要原因在于它的简单性和易使用性。在Java应用程序中，数据持久化层涉及到的工作有：</p>
<ul>
<li>将从数据库查询到的数据生成所需要的Java对象</li>
<li>将Java对象中的数据通SQL持久化到数据库中</li>
</ul>
<p>MyBatis通过抽象底层的JDBC代码，自动化封装SQL结果集产生Java对象、Java对象的数据持久化数据库中的过程使得对SQL的使用变得容易。</p>
<h3 id="1-2-获取"><a href="#1-2-获取" class="headerlink" title="1.2 获取"></a>1.2 获取</h3><p>iBATIS一词来源于internet和abatis的组合，是一个在2002年发起的开放源代码项目。于2010年6月16号被谷歌托管，改名为MyBatis。</p>
<p>ibatis的官网 <a target="_blank" rel="noopener" href="http://ibatis.apache.org/">http://ibatis.apache.org/</a> 进去官网会看到下面提示:</p>
<p>apache ibatis is retired at the apache software foundation (2010/06/16) the original project team has moved to mybatis hosted at google code. see <a target="_blank" rel="noopener" href="http://www.mybatis.org/">http://www.mybatis.org/</a> for more.然而<a target="_blank" rel="noopener" href="http://www.mybatis.org/%E8%BF%99%E4%B8%AA%E5%9C%B0%E5%9D%80%E4%B8%80%E7%9B%B4%E5%A4%84%E4%BA%8E%E6%89%93%E4%B8%8D%E5%BC%80%E7%8A%B6%E6%80%81">http://www.mybatis.org/这个地址一直处于打不开状态</a>…</p>
<p>但是我们最终是可以在github中找到mybatis的相关下载的:</p>
<p>mybatis在github中的地址</p>
<p><a target="_blank" rel="noopener" href="https://github.com/mybatis/mybatis-3">https://github.com/mybatis/mybatis-3</a></p>
<p>最新版本的mybatis的下载地址</p>
<p><a target="_blank" rel="noopener" href="https://github.com/mybatis/mybatis-3/releases">https://github.com/mybatis/mybatis-3/releases</a></p>
<p>doc文档</p>
<p><a target="_blank" rel="noopener" href="http://www.mybatis.org/mybatis-3/">http://www.mybatis.org/mybatis-3/</a></p>
<h3 id="1-3-特点"><a href="#1-3-特点" class="headerlink" title="1.3 特点"></a>1.3 特点</h3><p>通过上面我们了解到Mybatis的主要功能是<strong>数据持久化</strong>，这个时候你可能会回想起之前的<strong>JDBC</strong>课程，既然我们已经掌握了JDBC为什么还要再去学习Mybatis呢？</p>
<p>主要原因有以下几个方面：</p>
<ol>
<li>Mybatis消除了大量的JDBC冗余代码</li>
<li>Mybatis有低的学习曲线</li>
<li>Mybatis能很好地与传统数据库协同工作</li>
<li>Mybatis可以接受SQL语句</li>
<li>Mybatis提供了与Spring框架的集成支持</li>
<li>Mybatis提供了与第三方缓存类库的集成支持</li>
<li>Mybatis引入了更好的性能</li>
</ol>
<p>1）它消除了大量的JDBC冗余代码</p>
<p>Java通过JDBC的API来操作关系型数据库，但是JDBC是一个非常底层的API，我们需要书写大量的代码来完成对数据库的操作。例如一个插入操作(参考之前学习JDBC时候的代码实例)，但是使用mybatis来完成相同的插入操作要简单方便灵活的多。</p>
<p>特别之处的是，MyBatis还提供了其他的一些特性来简化持久化逻辑的实现，它支持复杂的SQL结果集数据映射到嵌套的对象结构，它支持一对一和一对多的结果集和Java对象的映射，它支持根据输入的数据构建动态的SQL语句</p>
<p>2）它有低的学习曲线</p>
<p>MyBatis能够流行的首要原因之一在于它学习和使用起来非常简单，它取决于你Java和 SQL方面的知识。如果开发人员很熟悉Java和SQL，他们会发现MyBatis入门非常简单。</p>
<p>3）它能很好地与传统数据库协同工作</p>
<p>有时我们可能需要用不正规形式与传统数据库协同工作，使用成熟的ORM框架(例如大家熟知的Hibernate)有可能、但是很难跟传统数据库很好地协同工作，因为他们尝试将Java对象静态地映射到数据库的表上.而MyBatis是将查询的结果与Java对象映射起来，这使得MyBatis可以很好地与传统数据库协同工作。你可以根据面相对象的模型创建Java域对象，执行传统数据库的查询，然后将结果映射到对应的Java对象上。</p>
<p>4）它可以接受SQL语句</p>
<p>成熟的ORM框架鼓励使用实体对象和在其底层自动产生SQL语句。由于这种的SQL生成方式，我们有可能不能够利用到数据库的一些特有的特性。Hibernate允许执行本地SQL，但是这样会打破持久层和数据库独立的原则。MyBatis框架接受SQL语句，而不是将其对开发人员隐藏起来。由于MyBatis不会产生任何的SQL语句，所以开发人员就要准备SQL语句，这样就可以充分利用数据库特有的特性并且可以准备自定义的查询。另外，MyBatis 对存储过程也提供了支持。</p>
<p>5）它提供了与Spring框架的集成支持</p>
<p>MyBatis提供了与流行的依赖注入框架Spring的开包即用的集成支持，这将进一步简化MyBatis的使用。</p>
<p>6）它提供了与第三方缓存类库的集成支持</p>
<p>MyBatis有内建的SqlSession级别的缓存机制，用于缓存Select语句查询出来的结果。除此之外，MyBatis提供了与多种第三方缓存类库的集成支持，如EHCache，OSCache，Hazelcast等。</p>
<p>7）它引入了更好的性能</p>
<p>性能问题是关乎软件应用成功与否的关键因素之一。为了达到更好的性能，需要考虑很多事情，而对很多应用而言，数据持久化层是整个系统性能的关键。MyBatis支持数据库连接池，消除了为每一个请求创建一个数据库连接的开销,MyBatis提供了内建的缓存机制，在SqlSession级别提供了对SQL查询结果的缓存。即:如果你调用了相同的select查询，MyBatis 会将放在缓存的结果返回，而不会去再查询数据库。MyBatis框架并没有大量地使用代理机制，因此对于其他的过度地使用代理的ORM框架而言，MyBatis可以获得更好的性能</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.demo;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.datasource.pooled.PooledDataSource;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.mapping.Environment;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.transaction.TransactionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.transaction.jdbc.JdbcTransactionFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.entity.User;</span><br><span class="line"><span class="keyword">import</span> com.briup.mappers.UserMapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestConn</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		PooledDataSource dataSource = <span class="keyword">new</span> PooledDataSource();</span><br><span class="line">		dataSource.setDriver(<span class="string">&quot;oracle.jdbc.driver.OracleDriver&quot;</span>);</span><br><span class="line">		dataSource.setUrl(<span class="string">&quot;jdbc:oracle:thin:@127.0.0.1:1521:XE&quot;</span>);</span><br><span class="line">		dataSource.setUsername(<span class="string">&quot;briup&quot;</span>);</span><br><span class="line">		dataSource.setPassword(<span class="string">&quot;briup&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		TransactionFactory transactionFactory = <span class="keyword">new</span> JdbcTransactionFactory();</span><br><span class="line">		</span><br><span class="line">		Environment environment = <span class="keyword">new</span> Environment(<span class="string">&quot;development&quot;</span>, transactionFactory, dataSource);</span><br><span class="line">		</span><br><span class="line">		Configuration configuration = <span class="keyword">new</span> Configuration(environment);</span><br><span class="line">		</span><br><span class="line">		configuration.addMapper(UserMapper.class);</span><br><span class="line">		</span><br><span class="line">		SqlSessionFactory sqlSessionFactory = </span><br><span class="line">				<span class="keyword">new</span> SqlSessionFactoryBuilder().build(configuration);</span><br><span class="line">		SqlSession session = sqlSessionFactory.openSession();</span><br><span class="line">		UserMapper mapper = session.getMapper(UserMapper.class);</span><br><span class="line">		</span><br><span class="line">		List&lt;User&gt; userList = mapper.findAll();</span><br><span class="line">		System.out.println(userList);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>







<h3 id="1-4-案例"><a href="#1-4-案例" class="headerlink" title="1.4 案例"></a>1.4 案例</h3><p>在实例开始之前我们先做一些准备工作。先来建表和建一个实体类。(==创建java项目即可==)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> students;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> students ( </span><br><span class="line">	id number <span class="keyword">PRIMARY</span> KEY, </span><br><span class="line">	name varchar2(<span class="number">50</span>) , </span><br><span class="line">	email varchar2(<span class="number">50</span>) , </span><br><span class="line">	dob <span class="type">date</span> </span><br><span class="line">); </span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Integer id; </span><br><span class="line">	<span class="keyword">private</span> String name; </span><br><span class="line">	<span class="keyword">private</span> String email; </span><br><span class="line">	<span class="keyword">private</span> Date dob;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getEmail</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> email;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmail</span><span class="params">(String email)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.email = email;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Date <span class="title">getDob</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> dob;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDob</span><span class="params">(Date dob)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.dob = dob;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">(Integer id, String name, String email, Date dob)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">		<span class="keyword">this</span>.email = email;</span><br><span class="line">		<span class="keyword">this</span>.dob = dob;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="1-4-1-jar包导入"><a href="#1-4-1-jar包导入" class="headerlink" title="1.4.1 jar包导入"></a>1.4.1 jar包导入</h4><blockquote>
<p>导入mybatis-jar/ojdbc.jar/junit.jar</p>
</blockquote>
<p>mybatis的核心包只有一个mybatis-3.x.x.jar,另外还有一些【可选】的依赖包(日志、代理等所需要的),在下载的压缩包中可以找到.也可以自行去下载。</p>
<p>如果是maven项目，只有引入依赖坐标即可：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.x.x<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="1-4-2-配置文件"><a href="#1-4-2-配置文件" class="headerlink" title="1.4.2 配置文件"></a>1.4.2 配置文件</h4><p>mybatis的配置文件一般来说名字是固定的，就叫<code>mybatis-config.xml</code>,其中包括数据库连接信息，类型别名,映射文件路径等等；直接创建在src目录下。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span> </span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span> </span></span><br><span class="line"><span class="meta">   <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">&quot;Student&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.briup.pojo.Student&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span> /&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">     &lt;property name=&quot;driver&quot; value=&quot;com.mysql.jdbc.Driver&quot; /&gt; </span></span><br><span class="line"><span class="comment">     &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/test&quot; /&gt; </span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;oracle.jdbc.driver.OracleDriver&quot;</span> /&gt;</span> </span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:oracle:thin:@127.0.0.1:1521:XE&quot;</span> /&gt;</span> </span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;briup&quot;</span> /&gt;</span> </span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;briup&quot;</span> /&gt;</span> </span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;com/briup/mappers/StudentMapper.xml&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span> </span><br></pre></td></tr></table></figure>

<h4 id="1-4-3-映射文件"><a href="#1-4-3-映射文件" class="headerlink" title="1.4.3 映射文件"></a>1.4.3 映射文件</h4><p>映射文件命名一般都是<code>XxxxMapper.xml</code>，<code>Xxxx</code>是对应的类的名字，这个xml文件中包括<code>Xxxx</code>类所对应的数据库表的各种增删改查sql语句。</p>
<p>例如:<code>StudentMapper.xml</code>文件中是<code>Student</code>类对应的表的各种<code>select</code> <code>insert</code> <code>update</code> <code>delete</code>。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span> </span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> </span></span><br><span class="line"><span class="meta">   <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.briup.dao.StudentMapper&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Student&quot;</span> <span class="attr">id</span>=<span class="string">&quot;StudentResult&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAllStudents&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;StudentResult&quot;</span>&gt;</span></span><br><span class="line">		SELECT * FROM STUDENTS</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findStudentById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span></span></span><br><span class="line"><span class="tag">		<span class="attr">resultType</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">		SELECT ID,NAME, EMAIL</span><br><span class="line">		FROM STUDENTS WHERE ID=#&#123;Id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertStudent&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">		INSERT INTO STUDENTS(ID,NAME,EMAIL)</span><br><span class="line">		VALUES(#&#123;id &#125;,#&#123;name&#125;,#&#123;email&#125;)</span><br><span class="line">	<span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span> </span><br></pre></td></tr></table></figure>

<h4 id="1-4-4-映射接口"><a href="#1-4-4-映射接口" class="headerlink" title="1.4.4 映射接口"></a>1.4.4 映射接口</h4><p>mybatis中的映射接口<code>XxxxMapper.java</code>(对<code>XxxxMapper.xml</code>中的sql语句进行映射)<br>mybatis中除了必须的jar包、各种xml配置文件之外,一般还需要有调用sql语句执行的接口XxxxMapper.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentMapper</span></span>&#123;</span><br><span class="line">	<span class="function">List&lt;Student&gt; <span class="title">findAllStudents</span><span class="params">()</span></span>; </span><br><span class="line">	<span class="function">Student <span class="title">findStudentById</span><span class="params">(Integer id)</span></span>; </span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">insertStudent</span><span class="params">(Student student)</span></span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这个名字依然可以叫StudentDao</p>
</blockquote>
<p>注意事项：</p>
<ol>
<li><p>接口中的方法的名字和XML文件定义的SQL映射语句的<code>id</code>值要相同</p>
</li>
<li><p>我们不需要去实现该接口,因为mybatis中提供了相应的方式在运行期间动态生成该接口的实现类对象.</p>
</li>
</ol>
<h4 id="1-4-5-测试"><a href="#1-4-5-测试" class="headerlink" title="1.4.5 测试"></a>1.4.5 测试</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.dao.StudentMapper;</span><br><span class="line"><span class="keyword">import</span> com.briup.pojo.Student;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentMapperTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			InputStream inputStream = Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line">			SqlSessionFactory sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);</span><br><span class="line">			SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">			StudentMapper studentMapper = sqlSession.getMapper(StudentMapper.class);</span><br><span class="line">			Student s = <span class="keyword">new</span> Student(<span class="number">1</span>, <span class="string">&quot;tom&quot;</span>, <span class="string">&quot;123@briup.com&quot;</span>, <span class="keyword">new</span> Date());</span><br><span class="line">			studentMapper.insertStudent(s);</span><br><span class="line">			sqlSession.commit();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="1-4-6-图解"><a href="#1-4-6-图解" class="headerlink" title="1.4.6 图解"></a>1.4.6 图解</h4><p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/mybatis/202205221734684.png" alt="image-20201019112222960"></p>
<blockquote>
<p>注意，该图描述了上述例子中的俩个过程，mybatis左边是配置的过程，mybatis右边是写代码的过程</p>
</blockquote>
<h2 id="2-配置"><a href="#2-配置" class="headerlink" title="2.配置"></a>2.配置</h2><h3 id="2-1-核心配置"><a href="#2-1-核心配置" class="headerlink" title="2.1 核心配置"></a>2.1 核心配置</h3><p>MyBatis最关键的组成部分是<code>SqlSessionFactory</code>，我们可以从中获取<code>SqlSession</code>， 并执行映射的SQL语句。要获取<code>SqlSessionFactory</code>对象，就必须要先读取 mybaits的核心配置文件<code>mybaits-config.xml</code></p>
<p>下面的 mybatis-config.xml展示了一个典型的MyBatis配置文件的内容：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;application.properties&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;db_user&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;verysecurepwd&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;cacheEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">&quot;Student&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.briup.pojo.Student&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.briup.pojo&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeHandlers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">&quot;com.mybatis3.typehandlers.PhoneTypeHandler&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.briup.typehandlers&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">typeHandlers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driverClassName&#125;&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;production&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;MANAGED&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;JNDI&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;data_source&quot;</span> <span class="attr">value</span>=<span class="string">&quot;java:comp/jdbc/MyBatisDemoDS&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;com/briup/mappers/StudentMapper.xml&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">url</span>=<span class="string">&quot;file:///D:/mybatis/mappers/StudentMapper.xml&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.dao.StudentMapper&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>mybaits-config.xml中的常见标签元素有：</p>
<ul>
<li><code>&lt;environments&gt;</code></li>
<li><code>&lt;dataSource&gt;</code></li>
<li><code>&lt;transactionManager&gt;</code></li>
<li><code>&lt;properties&gt;</code></li>
<li><code>&lt;typeAliases&gt;</code></li>
<li><code>&lt;typeHandlers&gt;</code></li>
<li><code>&lt;settings&gt;</code></li>
<li><code>&lt;mappers&gt;</code></li>
</ul>
<h4 id="2-1-1-environments"><a href="#2-1-1-environments" class="headerlink" title="2.1.1 environments"></a>2.1.1 environments</h4><p><code>environments</code>是配置mybatis当前工作的数据库环境的地方</p>
<p>MyBatis可以支持配置多个dataSource环境，可以将应用部署到不同的环境上，如DEV(开发环境)，TEST（测试环境），QA（质量评估环境）,UAT(用户验收环境),PRODUCTION（生产环境），可以通过将默认environments值设置成想要的environment的id值.</p>
<p>如果你的应用需要连接多个数据库，你需要将每个数据库配置成独立的环境，并且为每一个数据库创建一个SqlSessionFactory</p>
<p>例如:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;shoppingcart&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;shoppingcart&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;MANAGED&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;JNDI&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;data_source&quot;</span> <span class="attr">value</span>=<span class="string">&quot;java:comp/jdbc/ShoppingcartDS&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;reports&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">transaction</span> <span class="attr">Managertype</span>=<span class="string">&quot;MANAGED&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;JNDI&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;data_source&quot;</span> <span class="attr">value</span>=<span class="string">&quot;java:comp/jdbc/ReportsDS&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>我们可以为以上每个环境创建一个SqlSessionFactory</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">inputStream = Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line"><span class="comment">//默认的环境 default</span></span><br><span class="line">SqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);</span><br><span class="line"><span class="comment">//统计明细的环境 cart</span></span><br><span class="line">SqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(inputStream, <span class="string">&quot;shoppingcart&quot;</span>);</span><br><span class="line"><span class="comment">//统计报表的环境 report</span></span><br><span class="line">SqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(inputStream, <span class="string">&quot;reports&quot;</span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意:一个数据库环境对应一个SqlSessionFactory对象;对于environments,我们可以在其中配置多个environment子元素,同时还需要在environment中配置dataSource和transactionManager元素。</p>
</blockquote>
<h4 id="2-1-2-dataSource"><a href="#2-1-2-dataSource" class="headerlink" title="2.1.2 dataSource"></a>2.1.2 dataSource</h4><p><code>dataSource</code>表示的是数据源;至少会包括该连接数据库的四种信息.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driverClassName&#125;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>dataSource的类型type属性可以配置成其内置类型之一，如UNPOOLED，POOLED，JNDI。</p>
<p>如果将类型设置成UNPOOLED，MyBatis会为每一个数据库操作创建一个新的连接，使用完了并关闭它，该方式适用于只有小规模数量并发用户的简单应用程序上。</p>
<p>如果将属性设置成POOLED，MyBatis会创建一个数据库连接池，连接池中的一个连接将会被用作数据库操作(分配，管理，释放)。一旦数据库操作完成，MyBatis会将此连接返回给连接池。</p>
<p>如果将类型设置成JNDI(Java Naming and Directory Interface , Java命名和目录接口, 是SUN公司提供的一种标准的Java命名系统接口)，MyBatis从在应用服务器向配置好的JNDI数据源dataSource获取数据库连接。在生产环境中，优先考虑这种方式。</p>
<h4 id="2-1-3-transactionManager"><a href="#2-1-3-transactionManager" class="headerlink" title="2.1.3 transactionManager"></a>2.1.3 transactionManager</h4><p>MyBatis支持两种类型的<strong>事务管理器</strong>：JDBC 和 MANAGED.</p>
<p>JDBC事务管理器的使用，是在<code>JDBC程序</code>负责管理数据库连接的生命周期（提交、回退等等）的时候。如果将TransactionManager 属性设置成JDBC，MyBatis内部将使用JdbcTransactionFactory类创建TransactionManager。例如，部署到ApacheTomcat的应用程序，需要应用程序自己管理事务。</p>
<p>MANAGED 事务管理器的使用，是在<code>应用服务器</code>负责管理数据库连接生命周期的时候。如果TransactionManager属性设置成MANAGED时，MyBatis内部使用ManagedTransactionFactory 类创建事务管理器TransactionManager。例如，当一个Java EE的应用程序部署在类似JBoss，WebLogic，GlassFish等应用服务器上时，它们会使用EJB进行应用服务器的事务管理能力。在这些管理环境中，你可以使用MANAGED事务管理器。</p>
<blockquote>
<p>注：Managed 是托管的意思，即我们编写的应用程序本身不去管理事务，而是把事务管理交给应用所在的服务器进行管理。</p>
</blockquote>
<h4 id="2-1-4-properties"><a href="#2-1-4-properties" class="headerlink" title="2.1.4 properties"></a>2.1.4 properties</h4><p>属性配置元素properties可以将配置值写死到mybatis-config.xml中,也可以具体到一个属性文件中,并且使用属性文件的key名作为占位符。</p>
<p>在上述的配置中，我们将数据库连接属性配置到了application.properties文件中，并且为driver，URL等属性使用了占位符.</p>
<p>在applications.properties文件中配置数据库连接参数，如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">jdbc.driverClassName=oracle.jdbc.driver.OracleDriver</span><br><span class="line">jdbc.url=jdbc:oracle:thin:@<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">1521</span>:XE</span><br><span class="line">jdbc.username=briup</span><br><span class="line">jdbc.password=briup </span><br></pre></td></tr></table></figure>

<p>在mybatis-config.xml文件中，为属性使用application.properties文件中定义的占位符：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 读取application.properties文件中的数据key-value的形式 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;application.properties&quot;</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 注意:是applications.properties文件中的值优先级高 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbc.username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;briup&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbc.password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;briup&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driverClassName&#125;&quot;</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-1-5-typeAliases"><a href="#2-1-5-typeAliases" class="headerlink" title="2.1.5 typeAliases"></a>2.1.5 typeAliases</h4><p>在SQLMapper配置文件中，对于resultType和parameterType属性值，我们需要使用JavaBean 的完全限定名。</p>
<p>例如:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findStudentById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> </span></span><br><span class="line"><span class="tag">	<span class="attr">resultType</span>=<span class="string">&quot;com.briup.pojo.Student&quot;</span>&gt;</span></span><br><span class="line">	 SELECT  ID, NAME, EMAIL, DOB</span><br><span class="line">	 FROM STUDENTS WHERE id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateStudent&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.briup.pojo.Student&quot;</span>&gt;</span></span><br><span class="line">	 UPDATE STUDENTS</span><br><span class="line">	 SET NAME=#&#123;name&#125;, EMAIL=#&#123;email&#125;, DOB=#&#123;dob&#125;</span><br><span class="line">	 WHERE id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注:parameterType表示将来调用这个sql语句的时候所传的参数的类型(参数值或者参数对象里面的属性值 用来替换sql语句中的占位符)</p>
</blockquote>
<p><code>resultType</code>表示将来调用这个sql语句的时候所返回的结果的类型(方便mybatis给我们自动封装结果集)</p>
<p>这里我们为<code>resultType</code>和<code>parameterType</code>属性值设置为Student类型的完全限定名：com.briup.com.Student</p>
<p>我们可以为完全限定名取一个别名（alias），然后就可以在需要使用完全限定名的地方使用别名，而不是到处使用完全限定名。如下所示，为完全限定名起一个别名：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">&quot;Student&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.briup.pojo.Student&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">&quot;Teacher&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.briup.pojo.Teacher&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后在SQLMapper映射文件中, 如下使用Student的别名：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findStudentById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">resultType</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">	 SELECT  ID, NAME, EMAIL, DOB</span><br><span class="line">	 FROM STUDENTS</span><br><span class="line">	WHERE id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateStudent&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">	 UPDATE STUDENTS</span><br><span class="line">	 SET NAME=#&#123;name&#125;, EMAIL=#&#123;email&#125;, DOB=#&#123;dob&#125;</span><br><span class="line">	 WHERE id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>当然也可以不用为每一个JavaBean单独定义别名,你可以为配置出需要取别名的类的所在的包(package)，MyBatis会自动扫描包内定义的类，然后分别为每个类注册一个小写字母开头的简单类名形式的别名。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.briup.pojo&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果Student.java和 Teacher.java 定义在com.briup.pojo包中，则 com.briup.pojo.Student的别名会被注册为student。而com.briup.pojo.Teacher别名将会被注册为teacher</p>
<p>还有另外一种方式为JavaBeans起别名，使用注解 <code>@Alias</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Alias(&quot;stu&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span></span>&#123;</span><br><span class="line">          </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意: </p>
<p>@Alias注解将会覆盖配置文件中的&lt;typeAliases&gt;定义。</p>
<p>@Alias 要和<code>&lt;package name=&quot;&quot;/&gt;</code>标签配合使用,Mybatis会自动查看指定包内的类别名注解,如果没有这个注解,那么默认的别名就是类的名字。</p>
</blockquote>
<h4 id="2-1-6-typeHandlers"><a href="#2-1-6-typeHandlers" class="headerlink" title="2.1.6 typeHandlers"></a>2.1.6 typeHandlers</h4><p>当MyBatis将一个Java对象作为输入参数执行INSERT语句操作时，它会创建一个PreparedStatement对象，并且使用setXXX()方法对?号占位符设置相应的参数值 。这里，XXX可以是int，String，Date 等 Java对象属性类型的任意一个。示例如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertStudent&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">	 INSERT INTO STUDENTS(id,NAME,EMAIL,DOB)</span><br><span class="line">	 VALUES(#&#123;id&#125;,#&#123;name&#125;,#&#123;email&#125;,#&#123;dob&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>为执行这个语句，MyBatis将采取以下一系列动作，创建一个有占位符的PreparedStatement接口，如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PreparedStatement ps = connection.prepareStatement(<span class="string">&quot;INSERT INTO STUDENTS(id,NAME,EMAIL,DOB) VALUES(?,?,?,?)&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>检查Student对象的属性studId的类型，然后使用合适setXXX方法去设置参数值。这里studId是Integer类型，所以会使用setInt()方法：ps.setInt(1,student.getStudId());类似地，对于name和email属性都是String类型MyBatis使用setString()方法设置参数。</p>
<blockquote>
<p>   注意： MyBaits会将java.util.Date类型转换为java.sql.Timestamp并设值：</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps.setTimestamp(<span class="number">4</span>, <span class="keyword">new</span> Timestamp((student.getDob()).getTime()));</span><br></pre></td></tr></table></figure>

<p>MyBatis是怎么知道对于Integer类型属性使用setInt()和String类型属性使用setString()方法呢？其实MyBatis是通过使用类型处理器typeHandlers来决定这么做的。</p>
<p>MyBatis对于以下的类型使用内置的类型处理器：所有的基本数据类型、基本类型的包装类型、 byte[]、java.util.Date、java.sql.Date、java.sql.Time、java.sql.Timestamp、java枚举类型等。所以当MyBatis发现属性的类型属于上述类型，他会使用对应的类型处理器将值设置到PreparedStatement中，同样地，当SQL结果集封装成java类对象的时候，也有类似的过程。 </p>
<p>那如果有一个自定义的类型，怎么存储到数据库呢？示例如下：假设表STUDENTS 有一个 PHONE 字段，类型为 VARCHAR2(15)，而 Student类有一个自定义类型属性phone(PhoneNumber类) </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> students <span class="keyword">add</span> phone varchar2(<span class="number">15</span>);</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> students <span class="keyword">drop</span> <span class="keyword">column</span> phone;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PhoneNumber</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String countryCode;</span><br><span class="line">	<span class="keyword">private</span> String stateCode;</span><br><span class="line">	<span class="keyword">private</span> String number;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">PhoneNumber</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">PhoneNumber</span><span class="params">(String countryCode, String stateCode, String number)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.countryCode = countryCode;</span><br><span class="line">		<span class="keyword">this</span>.stateCode = stateCode;</span><br><span class="line">		<span class="keyword">this</span>.number = number;</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PhoneNumber</span><span class="params">(String str)</span></span>&#123; </span><br><span class="line">        <span class="comment">// 如果 == null</span></span><br><span class="line">        <span class="keyword">if</span>(str!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            String[] args = str.split(<span class="string">&quot;-&quot;</span>);</span><br><span class="line">            <span class="keyword">this</span>.countryCode = 	args[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">this</span>.stateCode = 	args[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">this</span>.number = 		args[<span class="number">2</span>];</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.countryCode = 	args[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">this</span>.stateCode = 	args[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">this</span>.number = 		args[<span class="number">2</span>] </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getAsString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> countryCode + <span class="string">&quot;-&quot;</span> + stateCode + <span class="string">&quot;-&quot;</span> + number;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// Setters and getters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id; </span><br><span class="line">    <span class="keyword">private</span> String name; </span><br><span class="line">    <span class="keyword">private</span> String email; </span><br><span class="line">    <span class="keyword">private</span> Date dob;</span><br><span class="line">    <span class="keyword">private</span> PhoneNumber phoneNumber;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>xml配置:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">   <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.briup.dao.StudentMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Student&quot;</span> <span class="attr">id</span>=<span class="string">&quot;StudentResult&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> /&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;phoneNumber&quot;</span> <span class="attr">column</span>=<span class="string">&quot;phone&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAllStudents&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;StudentResult&quot;</span>&gt;</span></span><br><span class="line">        SELECT * FROM STUDENTS</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findStudentById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">resultType</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">        SELECT ID, NAME, EMAIL,PHONE as phoneNumber</span><br><span class="line">        FROM STUDENTS WHERE ID=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertStudent&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">        INSERT INTO STUDENTS(ID,NAME,EMAIL,PHONE)</span><br><span class="line">        VALUES(#&#123;id &#125;,#&#123;name&#125;,#&#123;email&#125;,#&#123;phoneNumber&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意自动映射 PHONE as phoneNumber</p>
</blockquote>
<p>这里，参数对象中的属性phone的值需要传递给#{phone}；而参数对象的属性phone是 PhoneNumber类型。但是，MyBatis 并不知道该怎样来处理这个类型的对象。</p>
<p>为了让MyBatis明白怎样处理这个自定义的Java对象类型，如PhoneNumber，我们可以创建一个自定义的类型处理器,MyBatis提供了抽象类<code>BaseTypeHandler&lt;T&gt;</code> ，我们可以继承此类创建自定义类型处理器。</p>
<p>代码如下所示:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.typehandler;</span><br><span class="line"><span class="keyword">import</span> java.sql.CallableStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.type.BaseTypeHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.type.JdbcType;</span><br><span class="line"><span class="keyword">import</span> com.briup.pojo.PhoneNumber;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PhoneTypeHandler</span> <span class="keyword">extends</span> <span class="title">BaseTypeHandler</span>&lt;<span class="title">PhoneNumber</span>&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//遇到PhoneNumber参数的时候应该如何在ps中设置值</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNonNullParameter</span><span class="params">(PreparedStatement ps, <span class="keyword">int</span> i, PhoneNumber parameter, JdbcType jdbcType)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        ps.setString(i, parameter.getAsString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//查询中遇到PhoneNumber类型的应该如何封装(使用列名封装)</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PhoneNumber <span class="title">getNullableResult</span><span class="params">(ResultSet rs, String columnName)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PhoneNumber(rs.getString(columnName));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//查询中遇到PhoneNumber类型的应该如何封装(使用列的下标)</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PhoneNumber <span class="title">getNullableResult</span><span class="params">(ResultSet rs, <span class="keyword">int</span> columnIndex)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PhoneNumber(rs.getString(columnIndex));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//CallableStatement使用中遇到了PhoneNumber类型的应该如何封装</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PhoneNumber <span class="title">getNullableResult</span><span class="params">(CallableStatement cs, <span class="keyword">int</span> columnIndex)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PhoneNumber(cs.getString(columnIndex));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意:使用ps.setString()和rs.getString()方法是 :因为在数据库的表中phone列是VARCHAR类型。</p>
</blockquote>
<p>最后一旦我们实现了自定义的类型处理器，我们需要在mybatis-config.xml中注册它：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;application.properties&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeHandlers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">&quot;com.briup.typehandlers.PhoneTypeHandler&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">typeHandlers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注册PhoneTypeHandler后, MyBatis就能够将Phone类型的对象值存储到VARCHAR类型的列上。</p>
</blockquote>
<h4 id="2-1-7-settings"><a href="#2-1-7-settings" class="headerlink" title="2.1.7 settings"></a>2.1.7 settings</h4><blockquote>
<p>注意:大多数情况下，【这些参数使用它们的默认值即可】</p>
</blockquote>
<p> 为满足应用特定的需求，MyBatis默认的全局参数设置可以被覆盖掉，如下所示： </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 这个配置使全局的映射器启用或禁用缓存 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;cacheEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 全局启用或禁用延迟加载。当禁用时，所有关联对象都会即时加载 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;lazyLoadingEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 允许或不允许多种结果集从一个单独的语句中返回（需要适合的驱动） --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;multipleResultSetsEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 使用列标签代替列名。不同的驱动在这方便表现不同。参考驱动文档或充分测试两种方法来决定所使用的驱动 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;useColumnLabel&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 允许JDBC支持生成的键。需要适合的驱动。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;useGeneratedKeys&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定MyBatis如何自动映射列到字段/属性。PARTIAL只会自动映射简单、没有嵌套的结果。FULL会自动映射任意复杂的结果（嵌套的或其他情况） --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;autoMappingBehavior&quot;</span> <span class="attr">value</span>=<span class="string">&quot;PARTIAL&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置默认的执行器。SIMPLE执行器没有什么特别之处。REUSE执行器重用预处理语句。BATCH执行器重用语句和批量更新 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;defaultExecutorType&quot;</span> <span class="attr">value</span>=<span class="string">&quot;SIMPLE&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 设置超时时间，它决定驱动等待一个数据库响应的时间 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;defaultStatementTimeout&quot;</span> <span class="attr">value</span>=<span class="string">&quot;25000&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 允许在嵌套语句中使用分页（RowBounds）默认false --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;safeRowBoundsEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 是否开启自动驼峰命名规则（camel case）映射，即从经典数据库列名 A_COLUMN 到经典 Java 属性名 aColumn 的类似映射。默认false --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;mapUnderscoreToCamelCase&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- MyBatis 利用本地缓存机制（Local Cache）防止循环引用（circular references）和加速重复嵌套查询。 默认值为 SESSION，这种情况下会缓存一个会话中执行的所有查询。 若设置值为 STATEMENT，本地会话仅用在语句执行上，对相同 SqlSession 的不同调用将不会共享数据。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;localCacheScope&quot;</span> <span class="attr">value</span>=<span class="string">&quot;SESSION&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 当没有为参数提供特定的 JDBC 类型时，为空值指定 JDBC 类型。 某些驱动需要指定列的 JDBC 类型，多数情况直接用一般类型即可，比如 NULL、VARCHAR 或 OTHER。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;jdbcTypeForNull&quot;</span> <span class="attr">value</span>=<span class="string">&quot;OTHER&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定对象的哪个方法触发一次延迟加载。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;lazyLoadTriggerMethods&quot;</span> <span class="attr">value</span>=<span class="string">&quot;equals,clone,hashCode ,toString&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- CGLIB | JAVASSIST 默认JAVASSIST(MyBatis 3.3 or above) --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定 Mybatis 创建具有延迟加载能力的对象所用到的代理工具。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;proxyFactory&quot;</span> <span class="attr">value</span>=<span class="string">&quot;JAVASSIST&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 当启用时，对任意延迟属性的调用会使带有延迟加载属性的对象完整加载；反之，每种属性将会按需加载。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;aggressiveLazyLoading&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定 MyBatis 所用日志的具体实现，未指定时将自动查找。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;logImpl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;LOG4J &quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定 MyBatis 增加到日志名称的前缀。值可以是任意字符串 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;logPrefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;LOG4J &quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定当结果集中值为 null 的时候是否调用映射对象的 setter（map 对象时为 put）方法，这对于有 Map.keySet() 依赖或 null 值初始化的时候是有用的。注意基本类型（int、boolean等）是不能设置成 null 的。 默认false--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;callSettersOnNulls&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false &quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-1-8-mappers"><a href="#2-1-8-mappers" class="headerlink" title="2.1.8 mappers"></a>2.1.8 mappers</h4><p> Mapper文件中包含了要执行的SQL语句，我们需要在mybatis-config.xml文件中配置Mapper文件的位置。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;com/briup/mappers/StudentMapper.xml&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">url</span>=<span class="string">&quot;file:///D:/mybatisdemo/app/mappers/StudentMapper.xml&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.dao.StudentMapper&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.briup.mappers&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>以上每一个&lt;mapper&gt; 标签都可以从不同类型的资源中加载映射mapper：</p>
<ul>
<li>resource属性用来指定在classpath中的mapper文件。</li>
<li>url属性用来通过完全文件系统路径或者web URL地址来指向mapper文件 </li>
<li>class属性用来指向一个mapper接口<ul>
<li>需要注解sql</li>
<li>或者法要求 mapper 接口名称和 mapper 映射文件名称相同，且放在同一个目录中。</li>
</ul>
</li>
<li>package属性用来指向可以找到Mapper接口的包名 (需要注解sql)<ul>
<li>需要注解sql</li>
<li>或者法要求 mapper 接口名称和 mapper 映射文件名称相同，且放在同一个目录中。</li>
</ul>
</li>
</ul>
<h3 id="2-2-日志配置"><a href="#2-2-日志配置" class="headerlink" title="2.2 日志配置"></a>2.2 日志配置</h3><p>Mybatis 通过使用内置的日志工厂提供日志功能。内置日志工厂将会把日志工作委托给下面的实现之一：</p>
<ul>
<li><strong>SLF4J</strong></li>
<li><strong>Apache Commons Logging</strong></li>
<li><strong>Log4j 2</strong></li>
<li><strong>Log4j</strong></li>
<li><strong>JDK logging</strong></li>
</ul>
<p>MyBatis 内置日志工厂会基于运行时检测信息选择日志委托实现。它会（按上面罗列的顺序）使用第一个查找到的实现。当没有找到这些实现时，将会禁用日志功能。</p>
<p>如果想使用指定的日志实现，可以通过在 MyBatis 配置文件 mybatis-config.xml 里面添加一项 setting 来选择其它日志实现。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;logImpl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;LOG4J&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>可选的值有：SLF4J、LOG4J、LOG4J2、JDK_LOGGING、COMMONS_LOGGING、STDOUT_LOGGING、NO_LOGGING，或者是实现了 <code>org.apache.ibatis.logging.Log</code> 接口，且构造方法以字符串为参数的类的完全限定名。</p>
<p>你也可以调用以下任一方法来选择日志实现：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">org.apache.ibatis.logging.LogFactory.useSlf4jLogging();</span><br><span class="line">org.apache.ibatis.logging.LogFactory.useLog4JLogging();</span><br><span class="line">org.apache.ibatis.logging.LogFactory.useJdkLogging();</span><br><span class="line">org.apache.ibatis.logging.LogFactory.useCommonsLogging();</span><br><span class="line">org.apache.ibatis.logging.LogFactory.useStdOutLogging();</span><br></pre></td></tr></table></figure>

<p>你应该在调用其它 MyBatis 方法之前调用以上的某个方法。另外，仅当运行时类路径中存在该日志实现时，日志实现的切换才会生效。</p>
<p>关于 SLF4J、Apache Commons Logging、Apache Log4J 和 JDK Logging 的更多信息，可以参考以下链接：</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://www.slf4j.org/">SLF4J</a></li>
<li><a target="_blank" rel="noopener" href="http://commons.apache.org/logging">Apache Commons Logging</a></li>
<li><a target="_blank" rel="noopener" href="http://logging.apache.org/log4j/">Apache Log4j 1.x and 2.x</a></li>
<li><a target="_blank" rel="noopener" href="http://java.sun.com/j2se/1.4.1/docs/guide/util/logging/">JDK Logging API</a></li>
</ul>
<h4 id="2-2-1-添加-jar-包"><a href="#2-2-1-添加-jar-包" class="headerlink" title="2.2.1 添加  jar 包"></a>2.2.1 添加  jar 包</h4><p>由于我们使用的是 Log4J，我们要确保它的 jar 包可以被应用使用。为此，需要将 jar 包添加到应用的类路径中。Log4J 的 jar 包可以在上面的链接中下载。</p>
<p>对于 web 应用可以将 <code>log4j.jar</code> 添加到 <code>WEB-INF/lib</code> 目录下</p>
<h4 id="2-2-2-配置-Log4J"><a href="#2-2-2-配置-Log4J" class="headerlink" title="2.2.2 配置 Log4J"></a>2.2.2 配置 Log4J</h4><p>在应用的类路径中（例如src）创建一个名为 <code>log4j.properties</code> 的文件，文件的具体内容如下：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">log4j.rootLogger</span>=<span class="string">DEBUG, stdout </span></span><br><span class="line"><span class="meta">log4j.appender.stdout</span>=<span class="string">org.apache.log4j.ConsoleAppender </span></span><br><span class="line"><span class="meta">log4j.appender.stdout.layout</span>=<span class="string">org.apache.log4j.PatternLayout </span></span><br><span class="line"><span class="meta">log4j.appender.stdout.layout.ConversionPattern</span>=<span class="string">%d [%-5p] %c - %m%n</span></span><br><span class="line"><span class="comment">#show sql</span></span><br><span class="line"><span class="meta">log4j.logger.java.sql.ResultSet</span>=<span class="string">INFO  </span></span><br><span class="line"><span class="meta">log4j.logger.org.apache</span>=<span class="string">INFO  </span></span><br><span class="line"><span class="meta">log4j.logger.java.sql.Connection</span>=<span class="string">DEBUG  </span></span><br><span class="line"><span class="meta">log4j.logger.java.sql.Statement</span>=<span class="string">DEBUG  </span></span><br><span class="line"><span class="meta">log4j.logger.java.sql.PreparedStatement</span>=<span class="string">DEBUG </span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>此时运行mybatis程序后，就会有对应的日志输出了</p>
</blockquote>
<h3 id="2-3-基本封装"><a href="#2-3-基本封装" class="headerlink" title="2.3 基本封装"></a>2.3 基本封装</h3><p>每次读取配置文件,产生一个工厂对象SqlSessionFactory,然后再生成出SqlSession对象,这个过程虽然并不复杂,但是也都是一些重复的代码流程,所以我们可以对其进行一个简单的封装。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/9/5-09-05-6:04</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：com.briup.utils</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SqlSessionUtil</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SqlSessionUtil</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SqlSessionFactory sqlSessionFactory;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> SqlSessionFactory <span class="title">getSqlSessionFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (SqlSessionUtil.class)&#123;</span><br><span class="line">                <span class="keyword">if</span> (sqlSessionFactory == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    InputStream in = Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line">                    sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(in);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sqlSessionFactory;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SqlSession <span class="title">openSqlSession</span><span class="params">(<span class="keyword">boolean</span> autoCommint)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getSqlSessionFactory().openSession(autoCommint);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SqlSession <span class="title">openSqlSession</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> openSqlSession(<span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="第二章-映射"><a href="#第二章-映射" class="headerlink" title="第二章-映射"></a>第二章-映射</h1><h2 id="1-映射"><a href="#1-映射" class="headerlink" title="1.映射"></a>1.映射</h2><p>关系型数据库和SQL是经受时间考验和验证的数据存储机制。和其他的<code>ORM</code> 框架如Hibernate不同，MyBatis鼓励开发者可以直接使用数据库，而不是将其对开发者隐藏，因为这样可以充分发挥数据库服务器所提供的SQL语句的巨大威力。</p>
<p>与此同时，MyBaits消除了书写大量冗余代码的痛苦，它让使用SQL更容易。在代码里直接嵌套SQL语句是很差的编码实践，并且维护起来困难。MyBaits使用了映射文件或注解来配置SQL语句。</p>
<h3 id="1-1-调用"><a href="#1-1-调用" class="headerlink" title="1.1 调用"></a>1.1 调用</h3><p>我们已经看见了一些在映射器配置文件中配置基本的映射语句，以及怎样使用SqlSession对象调用它们的例子。现在让我们看一下在com.briup.mappers包中的StudentMapper.xml 配置文件内，是如何配置id为<code>findStudentById</code>的SQL语句的，代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--namespace+id 代表唯一sql--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;www.baidu.com&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findStudentById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">       select id,name,email,phone as phoneNumber</span><br><span class="line">       from students where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，Student类中的属性名字和数据库中表中字段的名字是可以不一样的，例如类中可以是studId，而表中的字段名字为id</p>
</blockquote>
<p>我们可以通过下列代码调用findStudentById映射的SQL语句:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Student <span class="title">findStudentById</span><span class="params">(Integer studId)</span> </span>&#123;</span><br><span class="line">		SqlSession sqlSession=<span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			sqlSession = MyBatisSqlSessionFactory.openSession();</span><br><span class="line">			Student student = sqlSession.selectOne(<span class="string">&quot;www.baidu.com.findStudentById&quot;</span>, studId);</span><br><span class="line">			<span class="keyword">return</span> student;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">finally</span> &#123;</span><br><span class="line">			sqlSession.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>我们可以通过字符串形式来调用映射的SQL语句，形式为 namespace + sql语句id值，但是这种方式容易出错。你需要检查映射器配置文件中的定义，以保证你的输入参数类型和结果返回类型是有效的。</p>
<blockquote>
<p>注意，使用这种字符串的形式来调用sql语句，即使接口中没有对应的方法，也不会影响sql语句的执行。</p>
</blockquote>
<p>MyBatis通过使用映射器Mapper接口，提供了更好的调用映射sql语句的方式。</p>
<p>要求xml映射文件中的namespace属性值和映射接口的全限定名保持一致，同时：</p>
<ul>
<li>方法名和配置文件中sql语句的id值一致</li>
<li>方法参数类型和parameterType属性值一致</li>
<li>方法返回值类型和returnType属性值一致</li>
</ul>
<p>上述的StudentMapper.xml文件,我们可以创建一个映射器接口StudentMapper.java如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentMapper</span></span>&#123;</span><br><span class="line">	<span class="function">Student <span class="title">findStudentById</span><span class="params">(Integer id)</span></span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>在Student Mapper.xml映射器配置文件中，其名空间namespace应该跟StudentMapper接口的全限定名保持一致。另外，StudentMapper.xml中语句id, parameterType，returnType 应该分别和StudentMapper接口中的方法名，参数类型，返回值相对应。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta"><span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.briup.dao.StudentMapper&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findStudentById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">        select id as studId, name, email, dob</span><br><span class="line">        from students</span><br><span class="line">        where id=#&#123;studId&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="1-2-映射sql"><a href="#1-2-映射sql" class="headerlink" title="1.2 映射sql"></a>1.2 映射sql</h3><p>MyBatis提供了多种元素来配置不同类型的语句，如SELECT，INSERT，UPDATE，DELETE。让我们看看如何具体配置映射语句</p>
<h4 id="1-2-1-INSERT"><a href="#1-2-1-INSERT" class="headerlink" title="1.2.1 INSERT"></a>1.2.1 INSERT</h4><p>一个INSERT语句可以在<code>&lt;insert&gt;</code>标签元素在映射器XML配置文件中配置，如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertStudent&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">    INSERT INTO</span><br><span class="line">    STUDENTS(ID,NAME,EMAIL,PHONE)</span><br><span class="line">    VALUES(#&#123;id&#125;,#&#123;name&#125;,#&#123;email&#125;,#&#123;phone&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>理解</strong></p>
<ul>
<li>parameterType<ul>
<li>代表参数的类型，因为我们要传入的是一个类的对象，所以类型就写类的全名称(或者别名)。</li>
</ul>
</li>
<li><code>#&#123;&#125;</code><ul>
<li>它代表占位符，相当于原来 jdbc 部分所学的?，都是用于执行语句时替换实际的数据。 具体的数据是由#{}里面的内容决定的。</li>
</ul>
</li>
<li>ognl表达式<ul>
<li>Object Graphic Navigation Language 对象图导航语言 </li>
<li>它是按照一定的语法格式来获取数据的。</li>
<li>语法格式就是使用 #{对象.对象}的方式</li>
</ul>
</li>
</ul>
<p>我们可以如下调用这个语句：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> count = sqlSession.insert(<span class="string">&quot;com.briup.dao.StudentMapper.insertStudent&quot;</span>, student);</span><br><span class="line"><span class="comment">//sqlSession.insert() 返回执行 INSERT 语句后所影响的行数。</span></span><br></pre></td></tr></table></figure>



<p>或者使用映射接口Mapper来调用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentMapper</span></span>&#123;</span><br><span class="line">	<span class="function">Student <span class="title">findStudentById</span><span class="params">(Integer id)</span></span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">StudentMapper mapper = sqlSession.getMapper(StudentMapper.class);</span><br><span class="line"><span class="keyword">int</span> count = mapper.insertStudent(student); </span><br></pre></td></tr></table></figure>



<p><strong>特别注意</strong>，有些版本的mybatis中，如果插入的对象中某一个属性为<strong>null</strong>，那么这时候运行会报错：（无效的列类型），原因是null在mybaits的JdbcType中没有对应的类型</p>
<ul>
<li><p>解决方式1，可以在insert语句中指定参数的类型，例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#&#123;phone&#125; </span><br><span class="line">修改为 </span><br><span class="line">#&#123;phone,jdbcType=VARCHAR&#125; </span><br></pre></td></tr></table></figure></li>
<li><p>解决方式2，可以在setting文件中进行统一的全局设置，例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;setting name=&quot;jdbcTypeForNull&quot; value=&quot;NULL&quot; /&gt;</span><br><span class="line">或者</span><br><span class="line">&lt;setting name=&quot;jdbcTypeForNull&quot; value=&quot;VARCHAR&quot; /&gt;</span><br></pre></td></tr></table></figure>

<p>​            </p>
</li>
</ul>
<p>自动生成主键:</p>
<p>在上述的INSERT语句中，我们为可以自动生成（auto-generated）主键的列 ID 插入值。我们可以使用useGeneratedKeys和keyProperty属性让数据库生成auto_increment列的值，并将生成的值设置到其中一个输入对象属性内，如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertStudent&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Student&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;studId&quot;</span>&gt;</span></span><br><span class="line">    INSERT INTO STUDENTS(NAME, EMAIL, PHONE)</span><br><span class="line">    VALUES(#&#123;name&#125;,#&#123;email&#125;,#&#123;phone&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>或者使用mysql的内置方法</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置保存时获取插入的 id --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyColumn</span>=<span class="string">&quot;id&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">	select last_insert_id();</span><br><span class="line"><span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>这里ID列值将会被数据库自动生成(如mysql)，并且生成的值会被设置到student对象的studId属性上。</p>
<p>但是有些数据库如Oracle并不支持AUTO_INCREMENT列，其使用序列（SEQUENCE）来生成主键值。    </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> sequence my_seq;</span><br><span class="line"><span class="keyword">create</span> sequence my_seq;</span><br></pre></td></tr></table></figure>



<p>这里我们使用了<code>&lt;selectKey&gt;</code>子元素来生成主键值，并将值保存到Student对象的studId 属性上。属性order=”before”表示MyBatis将取得序列的下一个值作为主键值，并且在执行INSERT语句之前将值设置到studId属性上。(程序中的student对象的studId属性)</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertStudent&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">&quot;studId&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;int&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">order</span>=<span class="string">&quot;BEFORE&quot;</span>&gt;</span></span><br><span class="line">        SELECT my_seq.nextval FROM DUAL</span><br><span class="line">    <span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br><span class="line">    INSERT INTO STUDENTS(ID,NAME,EMAIL, PHONE)</span><br><span class="line">    VALUES(#&#123;studId&#125;,#&#123;name&#125;,#&#123;email&#125;,#&#123;phone&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，SelectKey需要注意order属性，像MySQL、SQLServer等一类支持自动增长类型的数据库中，order需要设置为after才会取到正确的值，而Oracle这样取序列的情况，需要设置为before</p>
</blockquote>
<h4 id="1-2-2-UPDATE"><a href="#1-2-2-UPDATE" class="headerlink" title="1.2.2 UPDATE"></a>1.2.2 UPDATE</h4><p>一个UPDATE SQL语句可以在<code>&lt;update&gt;</code>元素在映射器XML配置文件中配置，如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateStudent&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">    UPDATE STUDENTS SET</span><br><span class="line">    NAME=#&#123;name&#125;, EMAIL=#&#123;email&#125;, PHONE=#&#123;phone&#125;</span><br><span class="line">    WHERE ID=#&#123;studId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以如下调用这个sql语句：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> updateCount = sqlSession.update(<span class="string">&quot;com.briup.dao.StudentMapper.updateStudent&quot;</span>, student);</span><br><span class="line"><span class="comment">//sqlSession.update();返回执行UPDATE语句之后影响的行数。</span></span><br></pre></td></tr></table></figure>



<p>或者使用映射接口Mapper来调用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentMapper</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">updateStudent</span><span class="params">(Student student)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">StudentMapper mapper = sqlSession.getMapper(StudentMapper.class);</span><br><span class="line"><span class="keyword">int</span> updateCount = mapper.updateStudent(student);</span><br></pre></td></tr></table></figure>



<h4 id="1-2-3-DELETE"><a href="#1-2-3-DELETE" class="headerlink" title="1.2.3 DELETE"></a>1.2.3 DELETE</h4><p>一个DELETE语句可以在<code>&lt;delete&gt;</code>标签元素中进行配置，如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteStudent&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">    DELETE FROM STUDENTS</span><br><span class="line">    WHERE ID=#&#123;studId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以如下调用这个sql语句：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SqlSession sqlSession = MyBatisSqlSessionFactory.openSession();</span><br><span class="line"><span class="keyword">int</span> studId = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> deleteCount = sqlSession.delete(<span class="string">&quot;com.briup.dao.StudentMapper.deleteStudent&quot;</span>, studId);</span><br><span class="line"><span class="comment">//sqlSession.delete()返回 delete 语句执行后影响的行数。</span></span><br></pre></td></tr></table></figure>



<p>或者使用映射接口Mapper来调用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentMapper</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">deleteStudent</span><span class="params">(<span class="keyword">int</span> studId)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">StudentMapper mapper = sqlSession.getMapper(StudentMapper.class);</span><br><span class="line"><span class="keyword">int</span> deleteCount = mapper.deleteStudent(studId);</span><br></pre></td></tr></table></figure>



<h4 id="1-2-4-SELECT"><a href="#1-2-4-SELECT" class="headerlink" title="1.2.4 SELECT"></a>1.2.4 SELECT</h4><blockquote>
<p>MyBatis真正强大的功能，在于映射SELECT查询结果到java的各种类型</p>
</blockquote>
<p>一个简单的select查询配置，如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findStudentById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">    SELECT ID, NAME, EMAIL, PHONE</span><br><span class="line">    FROM STUDENTS</span><br><span class="line">    WHERE ID=#&#123;studId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以如下调用这个sql语句：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Student student = sqlSession.selectOne(<span class="string">&quot;com.briup.dao.StudentMapper.findStudentById&quot;</span>, <span class="number">1</span>);</span><br></pre></td></tr></table></figure>



<p>或者使用映射接口Mapper来调用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentMapper</span></span>&#123;</span><br><span class="line">	<span class="function">Student <span class="title">findStudentById</span><span class="params">(Integer studId)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">StudentMapper mapper = sqlSession.getMapper(StudentMapper.class); </span><br><span class="line">Student student = mapper.findStudentById(studId); </span><br></pre></td></tr></table></figure>

<p>这时候Student对象的studId属性值为空，但是其他属性的值都有，因为数据库表中的字段为id,类中属性名为studId，所以没有自动把值封装进来。</p>
<p>这时给stud_id列起一个别名为studId，和类中属性名保持一致即可。如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findStudentById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">		SELECT ID AS studId, NAME,EMAIL, PHONE FROM STUDENTS</span><br><span class="line">		WHERE ID=#&#123;studId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>MyBatis执行返回多条结果的SELECT语句查询，如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAllStudents&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">		SELECT ID AS studId, NAME,EMAIL, PHONE</span><br><span class="line">		FROM STUDENTS</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以如下调用这个sql语句：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Student&gt; students =  </span><br><span class="line">		sqlSession.selectList(<span class="string">&quot;com.briup.dao.StudentMapper.findAllStudents&quot;</span>); </span><br></pre></td></tr></table></figure>



<p>或者使用映射接口Mapper来调用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentMapper</span></span>&#123;</span><br><span class="line">	<span class="function">List&lt;Student&gt; <span class="title">findAllStudents</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">StudentMapper mapper = sqlSession.getMapper(StudentMapper.class);</span><br><span class="line">List&lt;Student&gt; students = mapper.findAllStudents();</span><br></pre></td></tr></table></figure>



<p>除了List集合类型，也可以使用其他类型的 集合，如Set,Map等。</p>
<p>MyBatis会根据集合的类型，采用适当的集合实现，如下所示：</p>
<ul>
<li><p>对于List，Collection，Iterable类型，MyBatis将返回java.util.ArrayList</p>
</li>
<li><p>对于Map类型，MyBatis 将返回java.util.HashMap</p>
</li>
<li><p>对于Set类型，MyBatis 将返回java.util.HashSet</p>
</li>
<li><p>对于SortedSet类型，MyBatis将返回java.util.TreeSet</p>
</li>
</ul>
<p>例如1，查询【一条】数据填充到Map中</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findStudentById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">	SELECT * FROM STUDENTS WHERE ID=#&#123;studId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在这种情况下，结果集的列名将会作为Map中的key值，而列值将作为Map的value值。 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">HashMap&lt;String,Object&gt; studentMap = sqlSession.selectOne(<span class="string">&quot;com.briup.dao.StudentMapper.findStudentById&quot;</span>, studId);</span><br><span class="line">System.out.println(<span class="string">&quot;studId :&quot;</span> + studentMap.get(<span class="string">&quot;ID&quot;</span>));</span><br><span class="line">System.out.println(<span class="string">&quot;name :&quot;</span> + studentMap.get(<span class="string">&quot;NAME&quot;</span>));</span><br><span class="line">System.out.println(<span class="string">&quot;email :&quot;</span> + studentMap.get(<span class="string">&quot;EMAIL&quot;</span>));</span><br><span class="line">System.out.println(<span class="string">&quot;phone :&quot;</span> + studentMap.get(<span class="string">&quot;PHONE&quot;</span>));</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这里使用的selectOne方法，并且表中的字段名默认是大写</p>
</blockquote>
<blockquote>
<p>注意，这里也可以像之前一样，使用映射接口的方式来调用</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Map&lt;String,Object&gt; <span class="title">findStudentById</span><span class="params">(Integer studId)</span></span>; </span><br></pre></td></tr></table></figure>





<p>例如2， 查询【多条】数据填充到Map中</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAllStudents&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">	SELECT ID, NAME, EMAIL, PHONE FROM STUDENTS</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在这种情况下，最终返回的数据类型是List&lt;Map&lt;String,Object&gt;&gt;，如下所所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Map&lt;String, Object&gt;&gt; studentMapList = sqlSession.selectList(<span class="string">&quot;com.briup.dao.StudentMapper.findAllStudents&quot;</span>);</span><br><span class="line"><span class="keyword">for</span>(Map&lt;String, Object&gt; studentMap : studentMapList) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;studId :&quot;</span> + studentMap.get(<span class="string">&quot;ID&quot;</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;name :&quot;</span> + studentMap.get(<span class="string">&quot;NAME&quot;</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;email :&quot;</span> + studentMap.get(<span class="string">&quot;EMAIL&quot;</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;phone :&quot;</span> + studentMap.get(<span class="string">&quot;PHONE&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这里使用的selectList方法，并且表中的字段名默认是大写</p>
</blockquote>
<blockquote>
<p>注意，这里也可以像之前一样，使用映射接口的方式来调用</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Map&lt;String,Object&gt;&gt; findAllStudents(); </span><br></pre></td></tr></table></figure>





<p>例如3，查询到所有名字都放到List集合中并返回</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;findAllName_list&quot; resultType=&quot;String&quot;&gt;</span><br><span class="line">	SELECT NAME FROM STUDENTS</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<p>对应的映射接口中的方法为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">findAllName_list</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>



<p>例如4，查询表中的数据的条数</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findCount_int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">    SELECT count(*) FROM STUDENTS</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>对应的映射接口中的方法为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">findCount_int</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>



<h3 id="1-3-ResultMap"><a href="#1-3-ResultMap" class="headerlink" title="1.3 ResultMap"></a>1.3 ResultMap</h3><p>ResultMap被用来将SELECT语句的结果集映射到java对象属性中。</p>
<p>在映射文件中，可以先定义出结果集映射resultMap，然后在一些SELECT语句上引用这个resultMap。</p>
<p>所以，ResultMap就是提前定义好的一个映射规则，select语句可以使用ResultMap的映射规则来处理查询结果。</p>
<p>MyBatis的结果集映射resultMap非常强大，可以使用它指定sql查询出的结果集，会被怎么处理并封装成对象，也可以使用它完成复杂查询的映射，例如一对一、一对多关系的SELECT语句。</p>
<h4 id="1-3-1-简单ResultMap"><a href="#1-3-1-简单ResultMap" class="headerlink" title="1.3.1 简单ResultMap"></a>1.3.1 简单ResultMap</h4><p>定义一个resultMap，它的id值是唯一的，并且type属性是全限定类名或者是类型的别名。代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;StudentResult&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.briup.pojo.Student&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;dob&quot;</span> <span class="attr">column</span>=<span class="string">&quot;dob&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;phoneNumber&quot;</span> <span class="attr">column</span>=<span class="string">&quot;phone&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>&lt;resultMap&gt;</code>有俩个子元素：</p>
<ul>
<li><code>&lt;result&gt;</code>，用来将查询的数据中一个指定类列的值映射到对象指定的属性中</li>
<li><code>&lt;id&gt;</code>，和<code>&lt;result&gt;</code>标签功能相同，但是<code>&lt;id&gt;</code>用来映射的是表中的主键</li>
</ul>
<p>在select语句中，引用这个resultMap：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findStudentById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;StudentResult&quot;</span>&gt;</span></span><br><span class="line">		SELECT * FROM STUDENTS WHERE STUD_ID=#&#123;studId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAllStudents&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;StudentResult&quot;</span>&gt;</span></span><br><span class="line">		SELECT * FROM STUDENTS</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意事项：</p>
<ol>
<li><p>在<code>&lt;select&gt;</code>语句中，这里使用的是resultMap属性，而不是resultType属性</p>
</li>
<li><p>resultType属性中一般是写一个类型的全限定名或者别名，表示字段和属性名完全一致，进行自动封装即可</p>
</li>
<li><p>当<code>&lt;select&gt;</code>语句中配置了resutlMap属性，MyBatis会使用表中的列名与对象属性 【映射关系】 来填充对象中的属性值。</p>
</li>
<li><p>resultType和resultMap二者只能用其一，不能同时使用</p>
</li>
</ol>
<h4 id="1-3-2-继承ResultMap"><a href="#1-3-2-继承ResultMap" class="headerlink" title="1.3.2 继承ResultMap"></a>1.3.2 继承ResultMap</h4><blockquote>
<p>一个ResultMap可以继承另一个ResultMap，但是此功能是可选的，这里进行了解即可</p>
</blockquote>
<p>(注:这个可以在下面的一对一映射中进行测试,因为这里需要建立一对一关系的表结构)</p>
<p>第一个resultMap：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Student&quot;</span> <span class="attr">id</span>=<span class="string">&quot;StudentResult&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;studId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;stud_id&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;phone&quot;</span> <span class="attr">column</span>=<span class="string">&quot;phone&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>第二个resultMap：继承第一个ResultMap</p>
<p>假设新增了一个实体类Address，该类中有多个属性，分别和数据库中ADDRESSES表对应。<br>在Student类中又新增加了一个属性Address</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Student&quot;</span> <span class="attr">id</span>=<span class="string">&quot;StudentWithAddressResult&quot;</span> <span class="attr">extends</span>=<span class="string">&quot;StudentResult&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;address.addrId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;addr_id&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;address.street&quot;</span> <span class="attr">column</span>=<span class="string">&quot;street&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;address.city&quot;</span> <span class="attr">column</span>=<span class="string">&quot;city&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;address.state&quot;</span> <span class="attr">column</span>=<span class="string">&quot;state&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;address.zip&quot;</span> <span class="attr">column</span>=<span class="string">&quot;zip&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;address.country&quot;</span> <span class="attr">column</span>=<span class="string">&quot;country&quot;</span> /&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span> </span><br></pre></td></tr></table></figure>

<p><code>如果不继承</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Student&quot;</span> <span class="attr">id</span>=<span class="string">&quot;StudentResult&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;studId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;stud_id&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;phone&quot;</span> <span class="attr">column</span>=<span class="string">&quot;phone&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;address.addrId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;addr_id&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;address.street&quot;</span> <span class="attr">column</span>=<span class="string">&quot;street&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;address.city&quot;</span> <span class="attr">column</span>=<span class="string">&quot;city&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;address.state&quot;</span> <span class="attr">column</span>=<span class="string">&quot;state&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;address.zip&quot;</span> <span class="attr">column</span>=<span class="string">&quot;zip&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;address.country&quot;</span> <span class="attr">column</span>=<span class="string">&quot;country&quot;</span> /&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>如果只想映射Student数据，你可以使用id为StudentResult的resultMap,如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findStudentById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">resultMap</span>=<span class="string">&quot;StudentResult&quot;</span>&gt;</span></span><br><span class="line">    SELECT * FROM STUDENTS WHERE STUD_ID=#&#123;stud Id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span> </span><br></pre></td></tr></table></figure>



<p>如果你想将映射Student数据和Address数据，你可以使用id为StudentWithAddressResult的 resultMap：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectStudentWithAddress&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> </span></span><br><span class="line"><span class="tag">		<span class="attr">resultMap</span>=<span class="string">&quot;StudentWithAddressResult&quot;</span>&gt;</span></span><br><span class="line">    SELECT ID, NAME, EMAIL, PHONE, A.ADDR_ID, STREET, CITY, STATE, ZIP,</span><br><span class="line">    COUNTRY</span><br><span class="line">    FROM STUDENTS S LEFT OUTER JOIN ADDRESSES A ON S.ADDR_ID=A.ADDR_ID</span><br><span class="line">    WHERE STUD_ID=#&#123;studId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，该sql语句使用了连接查询中的外连接,也可以使用等值连接</p>
</blockquote>
<h4 id="1-3-3-sql标签"><a href="#1-3-3-sql标签" class="headerlink" title="1.3.3 sql标签"></a>1.3.3 sql标签</h4><p>mybatis中sql标签，主要是为了避免在项目开发的过程中，重复编写大量相同的sql语句。</p>
<p>例如，通过使用sql标签，可以将所有需要查询的字段封装在一个sql语句中 </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 将需要多次反复查的东西提取出来 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;querycolumns&quot;</span>&gt;</span></span><br><span class="line">	id,name,email,phone</span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findStudentById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;Student&quot;</span>&gt;</span>         </span><br><span class="line">	select <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;querycolumns&quot;</span>/&gt;</span> from students where id = #&#123;studId&#125; </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="1-4-一对一映射"><a href="#1-4-一对一映射" class="headerlink" title="1==.4 一对一映射=="></a>1==.4 一对一映射==</h3><blockquote>
<p>Student和Address是【一对一】关系</p>
</blockquote>
<p>建表以及数据插入:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> students;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> addresses;</span><br><span class="line"><span class="comment">--如果需要可以使用 cascade constraints;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> addresses(</span><br><span class="line">    addr_id number <span class="keyword">primary</span> key,</span><br><span class="line">    street varchar2(<span class="number">50</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    city varchar2(<span class="number">50</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    state varchar2(<span class="number">50</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    zip varchar2(<span class="number">10</span>),</span><br><span class="line">    country varchar2(<span class="number">50</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> students(</span><br><span class="line">    id number <span class="keyword">primary</span> key,</span><br><span class="line">    name varchar2(<span class="number">50</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    email varchar2(<span class="number">50</span>),</span><br><span class="line">    dob <span class="type">date</span> ,</span><br><span class="line">    phone varchar2(<span class="number">15</span>),  </span><br><span class="line">    addr_id number <span class="keyword">references</span> addresses(addr_id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> addresses(addr_id,street,city,state,zip,country) <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;redSt&#x27;</span>,<span class="string">&#x27;kunshan&#x27;</span>,<span class="string">&#x27;W&#x27;</span>,<span class="string">&#x27;12345&#x27;</span>,<span class="string">&#x27;china&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> addresses(addr_id,street,city,state,zip,country) <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;blueST&#x27;</span>,<span class="string">&#x27;kunshan&#x27;</span>,<span class="string">&#x27;W&#x27;</span>,<span class="string">&#x27;12345&#x27;</span>,<span class="string">&#x27;china&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> students(id,name,email,phone,addr_id) <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;John&#x27;</span>,<span class="string">&#x27;john@gmail.com&#x27;</span>,<span class="string">&#x27;123-456-7890&#x27;</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> students(id,name,email,phone,addr_id) <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;Paul&#x27;</span>,<span class="string">&#x27;paul@gmail.com&#x27;</span>,<span class="string">&#x27;111-222-3333&#x27;</span>,<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">commit</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，此时Students表中的主键列是id，addresses表中的主键列是addr_id</p>
</blockquote>
<blockquote>
<p>注意，一定要记得把事务提交commit，否则程序查询不到</p>
</blockquote>
<p>实体类：</p>
<blockquote>
<p>注意: 此处的PhoneNumber 需要使用类型转换器</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PhoneNumber</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String countryCode;</span><br><span class="line">	<span class="keyword">private</span> String stateCode;</span><br><span class="line">	<span class="keyword">private</span> String number;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;PhoneNumber&#123;&quot;</span> +</span><br><span class="line">				<span class="string">&quot;countryCode=&#x27;&quot;</span> + countryCode + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">				<span class="string">&quot;, stateCode=&#x27;&quot;</span> + stateCode + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">				<span class="string">&quot;, number=&#x27;&quot;</span> + number + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">				<span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">PhoneNumber</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// alt+insert</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">PhoneNumber</span><span class="params">(String countryCode, String stateCode, String number)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//  111</span></span><br><span class="line">		<span class="keyword">this</span>.countryCode = countryCode;</span><br><span class="line">		<span class="keyword">this</span>.stateCode = stateCode;</span><br><span class="line">		<span class="keyword">this</span>.number = number;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建方法将对象转成字符串 new Phone(&quot;000&quot;,&quot;111&quot;,&quot;222&quot;)</span></span><br><span class="line">	<span class="comment">// &quot;000-111-222&quot;</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">asStr</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.countryCode + <span class="string">&quot;-&quot;</span> + <span class="keyword">this</span>.stateCode + <span class="string">&quot;-&quot;</span> + <span class="keyword">this</span>.number;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建方法将字符串换成成对象</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">PhoneNumber</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// &quot;000-111-222&quot;</span></span><br><span class="line">		PhoneNumber phoneNumber = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">if</span> (str != <span class="keyword">null</span>) &#123;</span><br><span class="line">			String[] arr = str.split(<span class="string">&quot;-&quot;</span>);</span><br><span class="line">			<span class="comment">// phoneNumber = new PhoneNumber(arr[0], arr[1], arr[2]);</span></span><br><span class="line">			<span class="keyword">this</span>.countryCode = arr[<span class="number">0</span>];</span><br><span class="line">			<span class="keyword">this</span>.stateCode = arr[<span class="number">1</span>];</span><br><span class="line">			<span class="keyword">this</span>.number = arr[<span class="number">2</span>];</span><br><span class="line">			<span class="comment">// this.countryCode=...</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//return phoneNumber;</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getCountryCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> countryCode;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCountryCode</span><span class="params">(String countryCode)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.countryCode = countryCode;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getStateCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> stateCode;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStateCode</span><span class="params">(String stateCode)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.stateCode = stateCode;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getNumber</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> number;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNumber</span><span class="params">(String number)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.number = number;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.pojo.onetoone;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Address</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Integer addrId;</span><br><span class="line">	<span class="keyword">private</span> String street;</span><br><span class="line">	<span class="keyword">private</span> String city;</span><br><span class="line">	<span class="keyword">private</span> String state;</span><br><span class="line">	<span class="keyword">private</span> String zip;</span><br><span class="line">	<span class="keyword">private</span> String country;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getAddrId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> addrId;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAddrId</span><span class="params">(Integer addrId)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.addrId = addrId;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getStreet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> street;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStreet</span><span class="params">(String street)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.street = street;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getCity</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> city;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCity</span><span class="params">(String city)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.city = city;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> state;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setState</span><span class="params">(String state)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.state = state;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getZip</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> zip;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setZip</span><span class="params">(String zip)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.zip = zip;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getCountry</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> country;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCountry</span><span class="params">(String country)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.country = country;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">  	<span class="function"><span class="keyword">public</span> <span class="title">Address</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Address</span><span class="params">(Integer addrId, String street, String city, String state, String zip, String country)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.addrId = addrId;</span><br><span class="line">		<span class="keyword">this</span>.street = street;</span><br><span class="line">		<span class="keyword">this</span>.city = city;</span><br><span class="line">		<span class="keyword">this</span>.state = state;</span><br><span class="line">		<span class="keyword">this</span>.zip = zip;</span><br><span class="line">		<span class="keyword">this</span>.country = country;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;Address&#123;&quot;</span> +</span><br><span class="line">				<span class="string">&quot;addrId=&quot;</span> + addrId +</span><br><span class="line">				<span class="string">&quot;, street=&#x27;&quot;</span> + street + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">				<span class="string">&quot;, city=&#x27;&quot;</span> + city + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">				<span class="string">&quot;, state=&#x27;&quot;</span> + state + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">				<span class="string">&quot;, zip=&#x27;&quot;</span> + zip + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">				<span class="string">&quot;, country=&#x27;&quot;</span> + country + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">				<span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.pojo.onetoone;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Integer studId;</span><br><span class="line">	<span class="keyword">private</span> String name; </span><br><span class="line">	<span class="keyword">private</span> String email; </span><br><span class="line">	<span class="keyword">private</span> Date dob;</span><br><span class="line">	<span class="keyword">private</span> PhoneNumber phone;</span><br><span class="line">	<span class="keyword">private</span> Address address;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getStudId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> studId;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStudId</span><span class="params">(Integer studId)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.studId = studId;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getEmail</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> email;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmail</span><span class="params">(String email)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.email = email;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Date <span class="title">getDob</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> dob;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDob</span><span class="params">(Date dob)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.dob = dob;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> PhoneNumber <span class="title">getPhone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> phone;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPhone</span><span class="params">(PhoneNumber phone)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.phone = phone;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Address <span class="title">getAddress</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> address;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAddress</span><span class="params">(Address address)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.address = address;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">(Integer studId, String name, String email, Date dob)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.studId = studId;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">		<span class="keyword">this</span>.email = email;</span><br><span class="line">		<span class="keyword">this</span>.dob = dob;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;Student&#123;&quot;</span> +</span><br><span class="line">				<span class="string">&quot;studId=&quot;</span> + studId +</span><br><span class="line">				<span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">				<span class="string">&quot;, email=&#x27;&quot;</span> + email + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">				<span class="string">&quot;, dob=&quot;</span> + dob +</span><br><span class="line">				<span class="string">&quot;, phone=&quot;</span> + phone +</span><br><span class="line">				<span class="string">&quot;, address=&quot;</span> + address +</span><br><span class="line">				<span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>此时两张表的表结构以及样例数据如下所示</p>
<p>1.<code>addresses</code>表</p>
<table>
<thead>
<tr>
<th>addr_id</th>
<th>street</th>
<th>city</th>
<th>state</th>
<th>zip</th>
<th>country</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>redSt</td>
<td>kunshan</td>
<td>W</td>
<td>12345</td>
<td>china</td>
</tr>
<tr>
<td>2</td>
<td>blueST</td>
<td>kunshan</td>
<td>W</td>
<td>12345</td>
<td>china</td>
</tr>
</tbody></table>
<p>2.<code>students</code>表</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>email</th>
<th>phone</th>
<th>addr_id</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>John</td>
<td><a href="mailto:&#106;&#111;&#104;&#x6e;&#64;&#x67;&#x6d;&#x61;&#105;&#x6c;&#46;&#99;&#x6f;&#109;">&#106;&#111;&#104;&#x6e;&#64;&#x67;&#x6d;&#x61;&#105;&#x6c;&#46;&#99;&#x6f;&#109;</a></td>
<td>123-456-7890</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>Paul</td>
<td><a href="mailto:&#112;&#x61;&#117;&#108;&#64;&#x67;&#x6d;&#x61;&#x69;&#108;&#x2e;&#99;&#111;&#x6d;">&#112;&#x61;&#117;&#108;&#64;&#x67;&#x6d;&#x61;&#x69;&#108;&#x2e;&#99;&#111;&#x6d;</a></td>
<td>111-222-3333</td>
<td>2</td>
</tr>
</tbody></table>
<p>StudentMapper.xml文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Student&quot;</span> <span class="attr">id</span>=<span class="string">&quot;StudentWithAddressResult&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;studId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;phone&quot;</span> <span class="attr">column</span>=<span class="string">&quot;phone&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;address.addrId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;addr_id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;address.street&quot;</span> <span class="attr">column</span>=<span class="string">&quot;street&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;address.city&quot;</span> <span class="attr">column</span>=<span class="string">&quot;city&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;address.state&quot;</span> <span class="attr">column</span>=<span class="string">&quot;state&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;address.zip&quot;</span> <span class="attr">column</span>=<span class="string">&quot;zip&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;address.country&quot;</span> <span class="attr">column</span>=<span class="string">&quot;country&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectStudentWithAddress&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;StudentWithAddressResult&quot;</span>&gt;</span></span><br><span class="line">    select</span><br><span class="line">        s.id , s.name, s.email,s.dob,s.phone,</span><br><span class="line">        a.addr_id, a.street, a.city, a.state, a.zip, a.country</span><br><span class="line">    from</span><br><span class="line">    	students s</span><br><span class="line">    	left outer join addresses a on s.addr_id = a.addr_id</span><br><span class="line">    where</span><br><span class="line">    	id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：可以使用 对象.属性名 的方式为内嵌的对象内的属性赋值。例如 <code>address.city</code></p>
</blockquote>
<p>StudentMapper.java文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Student</span> <span class="title">Mapper</span></span>&#123; </span><br><span class="line">    <span class="function">Student <span class="title">selectStudentWithAddress</span><span class="params">(<span class="keyword">int</span> studId)</span></span>; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>



<p>测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> studId = <span class="number">1</span>; </span><br><span class="line">StudentMapper studentMapper = sqlSession.getMapper(StudentMapper.class); </span><br><span class="line">Student student = studentMapper.selectStudentWithAddress(studId); </span><br><span class="line">System.out.println(<span class="string">&quot;Student :&quot;</span> + student); </span><br><span class="line">System.out.println(<span class="string">&quot;Address :&quot;</span> + student.getAddress()); </span><br></pre></td></tr></table></figure>



<p>在使用这种方式映射的时候，如果address结果需要在其他的SELECT映射语句中单独封装成Address对象，那么就需要把同样的配置在重新写一遍，因为当前是在封装Student对象的时候嵌入了Address对象的封装，这段对Address映射的配置不能在其他地方重复的单独使用</p>
<p>针对于这种情况，MyBatis提供了更好地实现一对一关联映射的俩种方法：</p>
<ul>
<li>【嵌套结果】ResultMap</li>
<li>【嵌套查询】Select</li>
</ul>
<h4 id="1-4-1-嵌套结果"><a href="#1-4-1-嵌套结果" class="headerlink" title="1.4.1 嵌套结果"></a>1.4.1 嵌套结果</h4><p>使用【嵌套结果】ResultMap，实现一对一关系映射。</p>
<p>代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 独立的Address封装映射 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Address&quot;</span> <span class="attr">id</span>=<span class="string">&quot;AddressResult&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;addrId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;addr_id&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;street&quot;</span> <span class="attr">column</span>=<span class="string">&quot;street&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;city&quot;</span> <span class="attr">column</span>=<span class="string">&quot;city&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;state&quot;</span> <span class="attr">column</span>=<span class="string">&quot;state&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;zip&quot;</span> <span class="attr">column</span>=<span class="string">&quot;zip&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;country&quot;</span> <span class="attr">column</span>=<span class="string">&quot;country&quot;</span> /&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span> </span><br><span class="line">		</span><br><span class="line"><span class="comment">&lt;!-- Student封装映射，里面关联上Address的封装映射 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Student&quot;</span> <span class="attr">id</span>=<span class="string">&quot;StudentWithAddressResult&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;studId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;stud_id&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;dob&quot;</span> <span class="attr">column</span>=<span class="string">&quot;dob&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;phone&quot;</span> <span class="attr">column</span>=<span class="string">&quot;phone&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;address&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;AddressResult&quot;</span> /&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">		</span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectStudentWithAddress&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;StudentWithAddressResult&quot;</span>&gt;</span> </span><br><span class="line">    select </span><br><span class="line">        s.stud_id, s.name, s.email,s.dob,s.phone, </span><br><span class="line">        a.addr_id, a.street, a.city, a.state, a.zip, a.country</span><br><span class="line">    from </span><br><span class="line">    	students s </span><br><span class="line">    	left outer join addresses a on s.addr_id = a.addr_id</span><br><span class="line">    where </span><br><span class="line">    	stud_id = #&#123;id&#125;  </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span> </span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，<code>&lt;association&gt;</code>是关联的意思,常被用来表示(has-one)类型的关联。就是对象1里面关联另一个对象2</p>
</blockquote>
<p>同时我们也可以使用<code>&lt;association&gt; </code>定义【内联】的resultMap，代码如下所示：（了解即可，不常用）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 相当于把Student映射和Address映射又合并在一起写了，还是使用&lt;association&gt;标签 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Student&quot;</span> <span class="attr">id</span>=<span class="string">&quot;StudentWithAddressResult&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;studId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;stud_id&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;address&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;Address&quot;</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;addrId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;addr_id&quot;</span> /&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;street&quot;</span> <span class="attr">column</span>=<span class="string">&quot;street&quot;</span> /&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;city&quot;</span> <span class="attr">column</span>=<span class="string">&quot;city&quot;</span> /&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;state&quot;</span> <span class="attr">column</span>=<span class="string">&quot;state&quot;</span> /&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;zip&quot;</span> <span class="attr">column</span>=<span class="string">&quot;zip&quot;</span> /&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;country&quot;</span> <span class="attr">column</span>=<span class="string">&quot;country&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="1-4-2-嵌套查询"><a href="#1-4-2-嵌套查询" class="headerlink" title="1.4.2 嵌套查询"></a>1.4.2 嵌套查询</h4><p>使用【嵌套查询】select，实现一对一关系映射。</p>
<p>代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 独立的Address封装映射 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Address&quot;</span> <span class="attr">id</span>=<span class="string">&quot;AddressResult&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;addrId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;addr_id&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;street&quot;</span> <span class="attr">column</span>=<span class="string">&quot;street&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;city&quot;</span> <span class="attr">column</span>=<span class="string">&quot;city&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;state&quot;</span> <span class="attr">column</span>=<span class="string">&quot;state&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;zip&quot;</span> <span class="attr">column</span>=<span class="string">&quot;zip&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;country&quot;</span> <span class="attr">column</span>=<span class="string">&quot;country&quot;</span> /&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">		</span><br><span class="line"><span class="comment">&lt;!-- 独立的select查询，专门查询Address --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAddressById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;AddressResult&quot;</span>&gt;</span> </span><br><span class="line">    select * from addresses </span><br><span class="line">    where addr_id=#&#123;id&#125; </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span> </span><br><span class="line">		</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Student封装映射，里面关联了查询address使用的select语句，并指定数据库表中的这个关联的外键列的名字，这里是addr_id --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Student&quot;</span> <span class="attr">id</span>=<span class="string">&quot;StudentWithAddressResult&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;studId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;dob&quot;</span> <span class="attr">column</span>=<span class="string">&quot;dob&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;phone&quot;</span> <span class="attr">column</span>=<span class="string">&quot;phone&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;address&quot;</span> <span class="attr">column</span>=<span class="string">&quot;addr_id&quot;</span> <span class="attr">select</span>=<span class="string">&quot;findAddressById&quot;</span> /&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 查询Student的select语句，这里不用写多表查询，因为对于address的关联查询，已经在上边定义好了，并且在结果映射中关联进来了 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectStudentWithAddress&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;StudentWithAddressResult&quot;</span>&gt;</span> </span><br><span class="line">    	select </span><br><span class="line">	    	id,name,email,dob,phone,addr_id</span><br><span class="line">	    from </span><br><span class="line">	    	students </span><br><span class="line">	    where </span><br><span class="line">	    	id = #&#123;id&#125; </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span> </span><br></pre></td></tr></table></figure>

<p>在此方式中，<code>&lt;association</code>&gt;元素的select属性被设置成了id为findAddressById的语句。</p>
<p>两个分开的SQL语句将会在数据库中分别执行，第一个通过id查询student信息，而第二个调用findAddressById来加载address信息。</p>
<p>addr_id列的值将会被作为输入参数传递给selectAddressById语句作为参数进行条件查询。</p>
<p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">StudentMapper mapper = sqlSession.getMapper(StudentMapper.class); </span><br><span class="line">Student student = mapper.selectStudentWithAddress(<span class="number">1</span>); </span><br><span class="line">System.out.println(student); </span><br><span class="line">System.out.println(student.getAddress());</span><br></pre></td></tr></table></figure>



<p>嵌套查询，操作过程分析：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>通过用户传的id值，查询出指定的学生</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>注意，这个时候只是查询学生，没有查询地址</span><br><span class="line"><span class="keyword">select</span> id,name,email,dob,phone,addr_id <span class="keyword">from</span> students </span><br><span class="line"><span class="keyword">where</span> id <span class="operator">=</span> #&#123;studId&#125;</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>加上id为<span class="number">1</span></span><br><span class="line"><span class="keyword">select</span> id,name,email,dob,phone,addr_id <span class="keyword">from</span> students </span><br><span class="line"><span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>查询结果为</span><br><span class="line">        ID NAME    EMAIL           DOB    PHONE      ADDR_ID</span><br><span class="line"><span class="comment">---------- ------- --------------- ------ -------- ----------</span></span><br><span class="line">         <span class="number">1</span> John    john<span class="variable">@gmail</span>.com        <span class="number">123</span><span class="number">-456</span><span class="number">-7890</span>   <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>这时候，只能飞封装学生对象的普通属性，address属性是封装不了</span><br><span class="line">public class Student &#123;</span><br><span class="line">	<span class="operator">/</span><span class="operator">/</span>...其他普通属性</span><br><span class="line">	private Address address;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>需要专门的去查询和这个学生对应的address，然后进行封装</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>使用这个<span class="keyword">sql</span>语句</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> addresses </span><br><span class="line"><span class="keyword">where</span> addr_id <span class="operator">=</span> #&#123;id&#125; </span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>需要传入一个参数，表示和这个学生对应的地址id</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>其实这个参数,就是上面第一条<span class="keyword">sql</span>语句查询结果中的addr_id字段的值,也就是<span class="number">1</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> addresses </span><br><span class="line"><span class="keyword">where</span> addr_id <span class="operator">=</span> <span class="number">1</span> </span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>这一步操作对应的配置为：</span><br><span class="line"><span class="operator">&lt;</span>association property<span class="operator">=</span>&quot;address&quot; <span class="keyword">column</span><span class="operator">=</span>&quot;addr_id&quot; <span class="keyword">select</span><span class="operator">=</span>&quot;findAddressById&quot; <span class="operator">/</span><span class="operator">&gt;</span> </span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>查询结果为</span><br><span class="line">   ADDR_ID STREET     CITY       STATE ZIP        COUNTRY</span><br><span class="line"><span class="comment">---------- ---------- ---------- ----- ---------- ----------</span></span><br><span class="line">         <span class="number">1</span> redSt      kunshan    W     <span class="number">12345</span>      china</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>然后对这个数据进行封装，得到address对象</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>最后把address对存到student对象中即可</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>总结对比：</p>
<ul>
<li><p>嵌套结果</p>
<p>一条sql语句，查询出所有表中的数据，然后交给一个ResultMap去映射，这个ResultMap只负责映射封装一部分数据，另一部分数据交给第二个ResultMap来映射，这个俩个ResultMap之间，使用标签<code>&lt;association&gt;</code>进行关联</p>
<p>例如，<code>&lt;association property=&quot;address&quot; resultMap=&quot;AddressResult&quot; /&gt; </code></p>
</li>
<li><p>嵌套查询</p>
<p>把之前一条sql语句，拆分成多条sql语句，每条sql语句只查询一张表并封装一部分数据，然后使用标签<code>&lt;association&gt;</code>将多条sql语句关联起来，最后把结果合并起来就是完整的查询结果</p>
<p>例如，<code>&lt;association property=&quot;address&quot; column=&quot;addr_id&quot; select=&quot;findAddressById&quot; /&gt; </code></p>
</li>
</ul>
<h3 id="1-5-一对多映射"><a href="#1-5-一对多映射" class="headerlink" title="1.5 ==一对多映射=="></a>1.5 ==一对多映射==</h3><blockquote>
<p>在一对多关系中，数据库建表的时候外键，一定是在多的那一方建立</p>
</blockquote>
<p>例如，一个讲师tutors可以教授一个或者多个课程course。这意味着讲师和课程之间存在一对多的映射关系。</p>
<p>建表以及数据插入语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> courses;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> tutors;</span><br><span class="line"><span class="comment">--如果需要可以使用 cascade constraints;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tutors(</span><br><span class="line">    tutor_id number <span class="keyword">primary</span> key,</span><br><span class="line">    name varchar2(<span class="number">50</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    email varchar2(<span class="number">50</span>) ,</span><br><span class="line">    phone varchar2(<span class="number">15</span>) ,  </span><br><span class="line">    addr_id number(<span class="number">11</span>) <span class="keyword">references</span> addresses (addr_id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> courses(</span><br><span class="line">    course_id number <span class="keyword">primary</span> key,</span><br><span class="line">    name varchar2(<span class="number">100</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    description varchar2(<span class="number">512</span>),</span><br><span class="line">    start_date <span class="type">date</span> ,</span><br><span class="line">    end_date <span class="type">date</span> ,</span><br><span class="line">    tutor_id number <span class="keyword">references</span> tutors (tutor_id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tutors(tutor_id,name,email,phone,addr_id) <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;zs&#x27;</span>,<span class="string">&#x27;zs@briup.com&#x27;</span>,<span class="string">&#x27;123-456-7890&#x27;</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tutors(tutor_id,name,email,phone,addr_id) <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;ls&#x27;</span>,<span class="string">&#x27;ls@briup.com&#x27;</span>,<span class="string">&#x27;111-222-3333&#x27;</span>,<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> courses(course_id,name,description,start_date,end_date,tutor_id) <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;JavaSE&#x27;</span>,<span class="string">&#x27;JavaSE&#x27;</span>,to_date(<span class="string">&#x27;2022-01-10&#x27;</span>,<span class="string">&#x27;yyyy-mm-dd&#x27;</span>),to_date(<span class="string">&#x27;2022-02-10&#x27;</span>,<span class="string">&#x27;yyyy-mm-dd&#x27;</span>),<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> courses(course_id,name,description,start_date,end_date,tutor_id)	<span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;JavaEE&#x27;</span>,<span class="string">&#x27;JavaEE&#x27;</span>,to_date(<span class="string">&#x27;2022-01-10&#x27;</span>,<span class="string">&#x27;yyyy-mm-dd&#x27;</span>),to_date(<span class="string">&#x27;2022-03-10&#x27;</span>,<span class="string">&#x27;yyyy-mm-dd&#x27;</span>),<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> courses(course_id,name,description,start_date,end_date,tutor_id)	<span class="keyword">values</span>(<span class="number">3</span>,<span class="string">&#x27;MyBatis&#x27;</span>,<span class="string">&#x27;MyBatis&#x27;</span>,to_date(<span class="string">&#x27;2022-01-10&#x27;</span>,<span class="string">&#x27;yyyy-mm-dd&#x27;</span>),to_date(<span class="string">&#x27;2022-02-20&#x27;</span>,<span class="string">&#x27;yyyy-mm-dd&#x27;</span>),<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">commit</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，记得提交数据</p>
</blockquote>
<p>此时两张表中的示例数据如下</p>
<p>1.<code>tutors</code>表</p>
<table>
<thead>
<tr>
<th>tutor_id</th>
<th>name</th>
<th>email</th>
<th>phone</th>
<th>addr_id</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>zs</td>
<td><a href="mailto:&#x7a;&#115;&#64;&#98;&#114;&#x69;&#x75;&#x70;&#x2e;&#x63;&#x6f;&#x6d;">&#x7a;&#115;&#64;&#98;&#114;&#x69;&#x75;&#x70;&#x2e;&#x63;&#x6f;&#x6d;</a></td>
<td>123-456-7890</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>ls</td>
<td><a href="mailto:&#x6c;&#x73;&#x40;&#98;&#114;&#105;&#117;&#x70;&#46;&#x63;&#111;&#x6d;">&#x6c;&#x73;&#x40;&#98;&#114;&#105;&#117;&#x70;&#46;&#x63;&#111;&#x6d;</a></td>
<td>111-222-3333</td>
<td>2</td>
</tr>
</tbody></table>
<p>2.<code>courses</code>表</p>
<table>
<thead>
<tr>
<th>course_id</th>
<th>name</th>
<th>description</th>
<th>start_date</th>
<th>end_date</th>
<th>tutor_id</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>JavaSE</td>
<td>JavaSE</td>
<td>2022-01-10</td>
<td>2022-02-10</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>JavaEE</td>
<td>JavaEE</td>
<td>2022-01-10</td>
<td>2022-03-10</td>
<td>2</td>
</tr>
<tr>
<td>3</td>
<td>MyBatis</td>
<td>MyBatis</td>
<td>2022-01-10</td>
<td>2022-02-20</td>
<td>1</td>
</tr>
</tbody></table>
<p>在上述的表数据中，zs 讲师教授一个课程，而 ls 讲师教授两个课程。</p>
<p>实体类设计如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Course</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Integer courseId; </span><br><span class="line">	<span class="keyword">private</span> String name; </span><br><span class="line">	<span class="keyword">private</span> String description; </span><br><span class="line">	<span class="keyword">private</span> Date startDate; </span><br><span class="line">	<span class="keyword">private</span> Date endDate;</span><br><span class="line">    </span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getCourseId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> courseId;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCourseId</span><span class="params">(Integer courseId)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.courseId = courseId;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getDescription</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> description;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDescription</span><span class="params">(String description)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.description = description;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Date <span class="title">getStartDate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> startDate;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStartDate</span><span class="params">(Date startDate)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.startDate = startDate;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Date <span class="title">getEndDate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> endDate;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEndDate</span><span class="params">(Date endDate)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.endDate = endDate;</span><br><span class="line">	&#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">	</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Tutor</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer tutorId; </span><br><span class="line">    <span class="keyword">private</span> String name; </span><br><span class="line">    <span class="keyword">private</span> String email; </span><br><span class="line">    <span class="keyword">private</span> PhoneNumber phone;</span><br><span class="line">    <span class="keyword">private</span> Address address; </span><br><span class="line">    <span class="keyword">private</span> List&lt;Course&gt; courses;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getTutorId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> tutorId;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTutorId</span><span class="params">(Integer tutorId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.tutorId = tutorId;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getEmail</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> email;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmail</span><span class="params">(String email)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.email = email;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> PhoneNumber <span class="title">getPhone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> phone;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPhone</span><span class="params">(PhoneNumber phone)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.phone = phone;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Address <span class="title">getAddress</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAddress</span><span class="params">(Address address)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Course&gt; <span class="title">getCourses</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> courses;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCourses</span><span class="params">(List&lt;Course&gt; courses)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.courses = courses;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><code>&lt;collection&gt;</code>标签可以用来将多行课程结果映射成一个课程Course对象的集合。</p>
<p>和之前的一对一映射一样，可以使用【嵌套结果】ResultMap和【嵌套查询】Select语句两种方式，映射一对多关系。</p>
<h4 id="1-5-1-嵌套结果"><a href="#1-5-1-嵌套结果" class="headerlink" title="1.5.1 嵌套结果"></a>1.5.1 嵌套结果</h4><p>使用【嵌套结果】ResultMap 实现一对多映射，获得讲师及其课程信息，代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 独立的Address封装映射 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Address&quot;</span> <span class="attr">id</span>=<span class="string">&quot;AddressResult&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;addrId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;addr_id&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;street&quot;</span> <span class="attr">column</span>=<span class="string">&quot;street&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;city&quot;</span> <span class="attr">column</span>=<span class="string">&quot;city&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;state&quot;</span> <span class="attr">column</span>=<span class="string">&quot;state&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;zip&quot;</span> <span class="attr">column</span>=<span class="string">&quot;zip&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;country&quot;</span> <span class="attr">column</span>=<span class="string">&quot;country&quot;</span> /&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="comment">&lt;!-- 独立的Course封装映射 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Course&quot;</span> <span class="attr">id</span>=<span class="string">&quot;CourseResult&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;course_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;courseId&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;description&quot;</span> <span class="attr">property</span>=<span class="string">&quot;description&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;start_date&quot;</span> <span class="attr">property</span>=<span class="string">&quot;startDate&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;end_date&quot;</span> <span class="attr">property</span>=<span class="string">&quot;endDate&quot;</span> /&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span> </span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- Tutor封装映射，里面是有嵌套结果的方式关联一个Addres和多个Course，分别使用association标签和collection标签 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Tutor&quot;</span> <span class="attr">id</span>=<span class="string">&quot;TutorResult&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;tutor_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;tutorId&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;phone&quot;</span> <span class="attr">property</span>=<span class="string">&quot;phone&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;address&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;AddressResult&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;courses&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;CourseResult&quot;</span> /&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span> </span><br><span class="line">	</span><br><span class="line"><span class="comment">&lt;!-- 查询Tutor的select语句，多表连接查询，把查询的结果给个上面的映射结果统一进行封装 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findTutorById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;TutorResult&quot;</span>&gt;</span> </span><br><span class="line">		select </span><br><span class="line">			t.tutor_id, t.name, t.email,t.phone, </span><br><span class="line">			c.course_id, c.name, c.description, c.start_date, c.end_date,</span><br><span class="line">			a.addr_id,a.street,a.city,a.state,a.zip,a.country </span><br><span class="line">		from </span><br><span class="line">			tutors t </span><br><span class="line">			left outer join addresses a on t.addr_id  = a.addr_id </span><br><span class="line">			left outer join courses   c on t.tutor_id = c.tutor_id </span><br><span class="line">		where </span><br><span class="line">			t.tutor_id=#&#123;id&#125; </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span> </span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这里查询了三张表，如果表中有字段和其他表中的字段名字一样，那么一定要起别名进行区别，否则封装映射结果的时候会出问题。</p>
</blockquote>
<h4 id="1-5-2-嵌套查询"><a href="#1-5-2-嵌套查询" class="headerlink" title="1.5.2 嵌套查询"></a>1.5.2 嵌套查询</h4><p>使用【嵌套查询】Select，实现一对多映射，式获得讲师及其课程信息，代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 独立的Address封装映射 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Address&quot;</span> <span class="attr">id</span>=<span class="string">&quot;AddressResult&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;addrId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;addr_id&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;street&quot;</span> <span class="attr">column</span>=<span class="string">&quot;street&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;city&quot;</span> <span class="attr">column</span>=<span class="string">&quot;city&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;state&quot;</span> <span class="attr">column</span>=<span class="string">&quot;state&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;zip&quot;</span> <span class="attr">column</span>=<span class="string">&quot;zip&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;country&quot;</span> <span class="attr">column</span>=<span class="string">&quot;country&quot;</span> /&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 独立的Course封装映射 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Course&quot;</span> <span class="attr">id</span>=<span class="string">&quot;CourseResult&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;course_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;courseId&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;description&quot;</span> <span class="attr">property</span>=<span class="string">&quot;description&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;start_date&quot;</span> <span class="attr">property</span>=<span class="string">&quot;startDate&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;end_date&quot;</span> <span class="attr">property</span>=<span class="string">&quot;endDate&quot;</span> /&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="comment">&lt;!-- Tutor封装映射，里分别使用association和collection标签来进行关联查询，直接把对应的select查询语句管理进行 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Tutor&quot;</span> <span class="attr">id</span>=<span class="string">&quot;TutorResult&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;tutor_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;tutorId&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;phone&quot;</span> <span class="attr">property</span>=<span class="string">&quot;phone&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 把addr_id列的值当做参数传给findAddressById进行查询 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;address&quot;</span> <span class="attr">column</span>=<span class="string">&quot;addr_id&quot;</span> <span class="attr">select</span>=<span class="string">&quot;findAddressById&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 把tutor_id列的值当做参数传给findCoursesByTutor进行查询 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;courses&quot;</span> <span class="attr">column</span>=<span class="string">&quot;tutor_id&quot;</span> <span class="attr">select</span>=<span class="string">&quot;findCoursesByTutor&quot;</span> /&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span> </span><br><span class="line">	</span><br><span class="line"><span class="comment">&lt;!-- 单独的Tutor查询语句 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findTutorById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;TutorResult&quot;</span>&gt;</span> </span><br><span class="line">    select tutor_id,name,email,phone,addr_id</span><br><span class="line">    from tutors</span><br><span class="line">    where tutor_id = #&#123;tutor_id&#125; </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 单独的Address查询语句 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAddressById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;AddressResult&quot;</span>&gt;</span></span><br><span class="line">    select addr_id,street,city,state,zip,country</span><br><span class="line">    from addresses</span><br><span class="line">    where addr_id = #&#123;addr_id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 单独的Course查询语句 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findCoursesByTutor&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;CourseResult&quot;</span>&gt;</span></span><br><span class="line">    select course_id,name,description,start_date,end_date </span><br><span class="line">    from courses </span><br><span class="line">    where tutor_id = #&#123;tutor_id&#125; </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span> </span><br></pre></td></tr></table></figure>

<p>mapper接口代码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TutorMapper</span></span>&#123; </span><br><span class="line">    <span class="function">Tutor <span class="title">findTutorById</span><span class="params">(<span class="keyword">int</span> tutorId)</span></span>; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>


<p>测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">TutorMapper mapper = sqlSession.getMapper(TutorMapper.class); </span><br><span class="line">Tutor tutor = mapper.findTutorById(tutor Id); </span><br><span class="line">System.out.println(tutor); </span><br><span class="line">List&lt;Course&gt; courses = tutor.getCourses();</span><br><span class="line">courses.foreach(System.out::println);</span><br></pre></td></tr></table></figure>



<blockquote>
<p>注意，嵌套查询Select语句查询会导致性能问题。首先，主查询将会执行，对于主查询返回的每一行数据，另外一个查询将会被执行。对于大量数据而言，这会导致整体效率降低。</p>
</blockquote>
<p>==思考，这时候如果需要编写一个Course的插入功能，该如何操作？注意外键列在Course对应的表中==</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tutor(id,name,cName,tutor_id)</span><br><span class="line">	<span class="keyword">values</span>(#&#123;id&#125;,#&#123;name&#125;,#&#123;tutor.id&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="1-6-多对多映射"><a href="#1-6-多对多映射" class="headerlink" title="1.6 ==多对多映射=="></a>1.6 ==多对多映射==</h3><p>对于在mybatis中的多对多的处理，可以参照一对多来解决，以课程和学生为例</p>
<p>建表语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> student_course;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> course;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> student;</span><br><span class="line"><span class="comment">--如果需要可以使用 cascade constraints;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> course (</span><br><span class="line">    id number <span class="keyword">primary</span> key,</span><br><span class="line">    course_code varchar2(<span class="number">30</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    course_name varchar2(<span class="number">30</span>) <span class="keyword">not</span> <span class="keyword">null</span> </span><br><span class="line">);</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> student (</span><br><span class="line">    id number <span class="keyword">primary</span> key,</span><br><span class="line">    name varchar2(<span class="number">10</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    gender varchar2(<span class="number">10</span>) ,</span><br><span class="line">    major varchar2(<span class="number">10</span>) ,</span><br><span class="line">    grade varchar2(<span class="number">10</span>) </span><br><span class="line">);</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> student_course (</span><br><span class="line">    id number <span class="keyword">primary</span> key,</span><br><span class="line">    student_id number <span class="keyword">references</span> student(id),</span><br><span class="line">    course_id number <span class="keyword">references</span> course(id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>



<p>java实体类： 新建包 <code>com.briup.many2many</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.many2many;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Course</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Integer id;</span><br><span class="line">	<span class="keyword">private</span> String courseCode; <span class="comment">// 课程编号</span></span><br><span class="line">	<span class="keyword">private</span> String courseName;<span class="comment">// 课程名称</span></span><br><span class="line">	<span class="keyword">private</span> List&lt;Student&gt; students;<span class="comment">// 选课学生</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getCourseCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> courseCode;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCourseCode</span><span class="params">(String courseCode)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.courseCode = courseCode;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getCourseName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> courseName;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCourseName</span><span class="params">(String courseName)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.courseName = courseName;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Student&gt; <span class="title">getStudents</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> students;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStudents</span><span class="params">(List&lt;Student&gt; students)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.students = students;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.many2many;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Integer id;</span><br><span class="line">	<span class="keyword">private</span> String name; <span class="comment">// 姓名</span></span><br><span class="line">	<span class="keyword">private</span> String gender; <span class="comment">// 性别</span></span><br><span class="line">	<span class="keyword">private</span> String major; <span class="comment">// 专业</span></span><br><span class="line">	<span class="keyword">private</span> String grade; <span class="comment">// 年级</span></span><br><span class="line">	<span class="keyword">private</span> List&lt;Course&gt; courses;<span class="comment">// 所选的课程</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getGender</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> gender;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setGender</span><span class="params">(String gender)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.gender = gender;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getMajor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> major;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMajor</span><span class="params">(String major)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.major = major;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getGrade</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> grade;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setGrade</span><span class="params">(String grade)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.grade = grade;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Course&gt; <span class="title">getCourses</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> courses;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCourses</span><span class="params">(List&lt;Course&gt; courses)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.courses = courses;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>映射接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Many2ManyMapper</span> </span>&#123;</span><br><span class="line">	<span class="comment">//插入student数据</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertStudent</span><span class="params">(Student student)</span></span>;</span><br><span class="line">	<span class="comment">//插入course数据</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertCourse</span><span class="params">(Course course)</span></span>;</span><br><span class="line">	<span class="comment">//通过id查询学生</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Student <span class="title">getStudentById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">	<span class="comment">//通过id查询课程</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Course <span class="title">getCourseById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">  	<span class="comment">//学生x选课y</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">studentSelectCourse</span><span class="params">(Student student, Course course)</span></span>;</span><br><span class="line">    <span class="comment">//查询比指定id值小的学生信息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Student&gt; <span class="title">getStudentByIdOnCondition</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">    <span class="comment">//查询student级联查询出所选的course并且组装成完整的对象</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Student <span class="title">getStudentByIdWithCourses</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>映射文件：为了避免和之前类型的别名冲突，这里全都使用的是类型的全限定名</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> </span></span><br><span class="line"><span class="meta"> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.briup.mappers.Many2ManyMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertStudent&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.briup.many2many.Student&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;int&quot;</span> </span></span><br><span class="line"><span class="tag">                   <span class="attr">order</span>=<span class="string">&quot;BEFORE&quot;</span>&gt;</span></span><br><span class="line">            select my_seq.nextval from dual</span><br><span class="line">        <span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br><span class="line">        insert into</span><br><span class="line">        student(id,name,gender,major,grade)</span><br><span class="line">        values</span><br><span class="line">        (#&#123;id&#125;,#&#123;name&#125;,#&#123;gender&#125;,#&#123;major&#125;,#&#123;grade&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertCourse&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.briup.many2many.Course&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">order</span>=<span class="string">&quot;BEFORE&quot;</span>&gt;</span></span><br><span class="line">            select my_seq.nextval from dual</span><br><span class="line">        <span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br><span class="line">        insert into</span><br><span class="line">        course(id,course_code,course_name)</span><br><span class="line">        values</span><br><span class="line">        (#&#123;id&#125;,#&#123;courseCode&#125;,#&#123;courseName&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getStudentById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">resultType</span>=<span class="string">&quot;com.briup.many2many.Student&quot;</span>&gt;</span></span><br><span class="line">        select id,name,gender,major,grade</span><br><span class="line">        from student</span><br><span class="line">        where id=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getCourseById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">resultType</span>=<span class="string">&quot;com.briup.many2many.Course&quot;</span>&gt;</span></span><br><span class="line">        select id,course_code as courseCode,course_name as courseName</span><br><span class="line">        from course</span><br><span class="line">        where id=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- param1代表方法中第一个参数 以此类推 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;studentSelectCourse&quot;</span>&gt;</span></span><br><span class="line">        insert into</span><br><span class="line">        student_course(id,student_id,course_id)</span><br><span class="line">        values</span><br><span class="line">        (my_seq.nextval,#&#123;param1.id&#125;,#&#123;param2.id&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 如果有特殊符号的话 需要用 &lt;![CDATA[ 特殊符号 ]]&gt; 例如 &lt; &amp; 等等 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getStudentByIdOnCondition&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">resultType</span>=<span class="string">&quot;com.briup.many2many.Student&quot;</span>&gt;</span></span><br><span class="line">        select *</span><br><span class="line">        from student</span><br><span class="line">        where id &lt;![CDATA[ &lt; ]]&gt;</span><br><span class="line">        #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 这里使用了嵌套结果ResultMap的方式进行级联查询 当然也可以使用嵌套查询select --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 映射一个基本的Student查询结果 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;StudentResult&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.briup.many2many.Student&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sid&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">column</span>=<span class="string">&quot;gender&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;major&quot;</span> <span class="attr">column</span>=<span class="string">&quot;major&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;grade&quot;</span> <span class="attr">column</span>=<span class="string">&quot;grade&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 继承上面那个基本的映射,再扩展出级联查询 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;StudentResultWithCourses&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.briup.many2many.Student&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">extends</span>=<span class="string">&quot;StudentResult&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;courses&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;CourseResult&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 这里特别注意的是column=&quot;cid&quot; 这是和select语句中的 c.id as cid对应的 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;CourseResult&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.briup.many2many.Course&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;cid&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;courseCode&quot;</span> <span class="attr">column</span>=<span class="string">&quot;course_code&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;courseName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;course_name&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 注意:查询语句的中的c.id as cid这个地方,避免名字相同出现查询结果不正确的情况 同时在id=&quot;CourseResult&quot;的resultMap中也有与这里对应的设置要特别特别注意 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 注意，学生的id起的别名为sid --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getStudentByIdWithCourses&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">resultMap</span>=<span class="string">&quot;StudentResultWithCourses&quot;</span>&gt;</span></span><br><span class="line">        select </span><br><span class="line">			s.id  as sid,s.name,s.gender,s.major,s.grade,</span><br><span class="line">			c.id  as cid,c.course_code,c.course_name,</span><br><span class="line">			sc.id as scid,sc.student_id,sc.course_id</span><br><span class="line">		from </span><br><span class="line">			student s,</span><br><span class="line">			course c,</span><br><span class="line">			student_course sc</span><br><span class="line">		where</span><br><span class="line">			s.id= #&#123;id&#125;</span><br><span class="line">			and</span><br><span class="line">			s.id = sc.student_id</span><br><span class="line">			and</span><br><span class="line">			c.id = sc.course_id</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line">			</span><br></pre></td></tr></table></figure>


<p>测试：Many2ManyMapperTest.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_insertStudent</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    SqlSession session = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        session = MyBatisSqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">        Many2ManyMapper mapper = session.getMapper(Many2ManyMapper.class);</span><br><span class="line"></span><br><span class="line">        mapper.insertStudent(<span class="keyword">new</span> Student(<span class="string">&quot;张三&quot;</span>,<span class="string">&quot;男&quot;</span>,<span class="string">&quot;计算机&quot;</span>,<span class="string">&quot;大四&quot;</span>));</span><br><span class="line"></span><br><span class="line">        session.commit();</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        session.rollback();</span><br><span class="line">    &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(session!=<span class="keyword">null</span>)session.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_insertCourse</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    SqlSession session = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        session = MyBatisSqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">        Many2ManyMapper mapper = session.getMapper(Many2ManyMapper.class);</span><br><span class="line"></span><br><span class="line">        mapper.insertCourse(<span class="keyword">new</span> Course(<span class="string">&quot;001&quot;</span>,<span class="string">&quot;corejava&quot;</span>));</span><br><span class="line">        mapper.insertCourse(<span class="keyword">new</span> Course(<span class="string">&quot;002&quot;</span>,<span class="string">&quot;oracle&quot;</span>));</span><br><span class="line"></span><br><span class="line">        session.commit();</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        session.rollback();</span><br><span class="line">    &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(session!=<span class="keyword">null</span>)session.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_studentSelectCourse</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    SqlSession session = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        session = MyBatisSqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">        Many2ManyMapper mapper = session.getMapper(Many2ManyMapper.class);</span><br><span class="line"></span><br><span class="line">        Student student = mapper.getStudentById(<span class="number">58</span>);</span><br><span class="line">        Course course = mapper.getCourseById(<span class="number">59</span>);</span><br><span class="line"></span><br><span class="line">        mapper.studentSelectCourse(student, course);</span><br><span class="line"></span><br><span class="line">        session.commit();</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        session.rollback();</span><br><span class="line">    &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(session!=<span class="keyword">null</span>)session.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_getStudentByIdOnCondition</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    SqlSession session = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        session = MyBatisSqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">        Many2ManyMapper mapper = session.getMapper(Many2ManyMapper.class);</span><br><span class="line"></span><br><span class="line">        List&lt;Student&gt; list = mapper.getStudentByIdOnCondition(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(Student s:list)&#123;</span><br><span class="line">            System.out.println(s);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(session!=<span class="keyword">null</span>)session.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_getStudentByIdWithCourses</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    SqlSession session = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        session = MyBatisSqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">        Many2ManyMapper mapper = session.getMapper(Many2ManyMapper.class);</span><br><span class="line"></span><br><span class="line">        Student student = mapper.getStudentByIdWithCourses(<span class="number">58</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(student);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(session!=<span class="keyword">null</span>)session.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这是从student这边出发所做的一些操作 ,从course一边开始操作是一样的，因为俩者的关系是多对多(对称的)。</p>
</blockquote>
<h1 id="第三章-其他"><a href="#第三章-其他" class="headerlink" title="第三章-其他"></a>第三章-其他</h1><h2 id="1-动态"><a href="#1-动态" class="headerlink" title="1.==动态=="></a>1.==动态==</h2><blockquote>
<p>动态SQL 是 MyBatis 的强大特性之一</p>
</blockquote>
<p>很多时候，静态sql并不能完全满足程序的要求，我们需要根据用户输入的条件来动态的改变和构造一个sql语句。</p>
<p>mybaits通过以下标签对动态sql提供支持：</p>
<ol>
<li><p><code>&lt;if&gt;</code></p>
</li>
<li><p><code>&lt;choose&gt;</code> </p>
</li>
<li><p><code>&lt;where&gt;</code></p>
</li>
<li><p><code>&lt;foreach&gt;</code></p>
</li>
<li><p><code>&lt;trim&gt;</code> </p>
</li>
<li><p><code>&lt;set&gt;</code></p>
</li>
</ol>
<h3 id="1-1-if"><a href="#1-1-if" class="headerlink" title="1.1 if"></a>1.1 if</h3><p><code>&lt;if&gt;</code>标签被用来通过条件嵌入SQL片段，如果条件为true，则相应地SQL片段将会被添加到SQL语句中。</p>
<p>假定有一个课程搜索界面，设置了讲师（Tutor）下拉列表框，课程名称（CourseName）文本输入框，开始时间（StartDate）输入框，结束时间（EndDate）输入框，作为搜索条件，其中讲师下拉列表是必须选的，其他的都是可选的。</p>
<p>当用户点击搜索按钮时，需要显示符合条件的列表数据。</p>
<p>对应的sql映射文件，如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 独立的Course封装映射 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Course&quot;</span> <span class="attr">id</span>=<span class="string">&quot;CourseResult&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;course_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;courseId&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;description&quot;</span> <span class="attr">property</span>=<span class="string">&quot;description&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;start_date&quot;</span> <span class="attr">property</span>=<span class="string">&quot;startDate&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;end_date&quot;</span> <span class="attr">property</span>=<span class="string">&quot;endDate&quot;</span> /&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 查询Course的select语句，里面加入了if条件判断 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;searchCourses&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;map&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;CourseResult&quot;</span>&gt;</span></span><br><span class="line">    SELECT * FROM COURSES </span><br><span class="line">    WHERE TUTOR_ID= #&#123;tutorId&#125; </span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;courseName != null&quot;</span>&gt;</span> </span><br><span class="line">        AND NAME LIKE #&#123;courseName&#125; </span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;startDate != null&quot;</span>&gt;</span> </span><br><span class="line">        AND START_DATE &gt;= #&#123;startDate&#125; </span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;endDate != null&quot;</span>&gt;</span> </span><br><span class="line">        AND END_DATE &lt;![CDATA[ &lt;= ]]&gt; #&#123;endDate&#125; </span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span> </span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这里可以把多个参数存放到Map集合中，这样方法mybaits在sql语句中动态取值</p>
</blockquote>
<p>映射接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DynamicSqlMapper</span></span>&#123; </span><br><span class="line">    <span class="function">List&lt;Course&gt; <span class="title">searchCourses</span><span class="params">(Map&lt;String, Object&gt; map)</span></span>; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>



<p>测试方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_searchCourses1</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sqlSession = MyBatisSqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">        DynamicSqlMapper mapper = sqlSession.getMapper(DynamicSqlMapper.class);</span><br><span class="line"></span><br><span class="line">        Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;String,Object&gt;(); </span><br><span class="line">        map.put(<span class="string">&quot;tutorId&quot;</span>, <span class="number">1</span>); </span><br><span class="line">        map.put(<span class="string">&quot;courseName&quot;</span>, <span class="string">&quot;%Java%&quot;</span>); </span><br><span class="line"></span><br><span class="line">        LocalDate date = LocalDate.of(<span class="number">2022</span>, <span class="number">1</span>, <span class="number">10</span>);</span><br><span class="line">        map.put(<span class="string">&quot;startDate&quot;</span>, date);</span><br><span class="line"></span><br><span class="line">        List&lt;Course&gt; courses = mapper.searchCourses(map);</span><br><span class="line"></span><br><span class="line">        courses.forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>



<p>此处将生成查询语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> COURSES <span class="keyword">WHERE</span> TUTOR_ID<span class="operator">=</span> ? <span class="keyword">AND</span> NAME <span class="keyword">like</span> ? <span class="keyword">AND</span> START_DATE <span class="operator">&gt;=</span> ?</span><br></pre></td></tr></table></figure>



<h3 id="1-2-choose"><a href="#1-2-choose" class="headerlink" title="1.2 choose"></a>1.2 choose</h3><p>有时候，查询功能是以查询 类别 为基础的。</p>
<p>例如，页面中有一个下拉列表，可以选择查询的类别，可以选择根据讲师查询、或者根据课程名查询、或者根据时间查询等等，选择了列表之后，再输入关键字进行查询。</p>
<p>MyBatis提供了<code>&lt;choose&gt;</code>标签可以支持此类型的查询处理。</p>
<p>对应的sql映射文件，如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Course&quot;</span> <span class="attr">id</span>=<span class="string">&quot;CourseResult&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;course_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;courseId&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;description&quot;</span> <span class="attr">property</span>=<span class="string">&quot;description&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;start_date&quot;</span> <span class="attr">property</span>=<span class="string">&quot;startDate&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;end_date&quot;</span> <span class="attr">property</span>=<span class="string">&quot;endDate&quot;</span> /&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span> </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;searchCourses&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;map&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;CourseResult&quot;</span>&gt;</span> </span><br><span class="line">    SELECT * FROM COURSES </span><br><span class="line">    <span class="tag">&lt;<span class="name">choose</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;searchBy == &#x27;Tutor&#x27;&quot;</span>&gt;</span> </span><br><span class="line">            WHERE TUTOR_ID = #&#123;tutorId&#125; </span><br><span class="line">        <span class="tag">&lt;/<span class="name">when</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;searchBy == &#x27;CourseName&#x27;&quot;</span>&gt;</span> </span><br><span class="line">            WHERE name like #&#123;courseName&#125; </span><br><span class="line">        <span class="tag">&lt;/<span class="name">when</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span> </span><br><span class="line">            WHERE start_date &gt;= sysdate </span><br><span class="line">        <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">choose</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>测试方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_searchCourses2</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sqlSession = MyBatisSqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">        DynamicSqlMapper mapper = sqlSession.getMapper(DynamicSqlMapper.class);</span><br><span class="line"></span><br><span class="line">        Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;String,Object&gt;(); </span><br><span class="line">        <span class="comment">//			map.put(&quot;searchBy&quot;, &quot;Tutor&quot;); </span></span><br><span class="line">        <span class="comment">//			map.put(&quot;tutorId&quot;, 1); </span></span><br><span class="line">        map.put(<span class="string">&quot;searchBy&quot;</span>, <span class="string">&quot;CourseName&quot;</span>); </span><br><span class="line">        map.put(<span class="string">&quot;courseName&quot;</span>, <span class="string">&quot;%MyBatis%&quot;</span>); </span><br><span class="line"></span><br><span class="line">        List&lt;Course&gt; courses = mapper.searchCourses(map);</span><br><span class="line"></span><br><span class="line">        courses.forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="1-3-where"><a href="#1-3-where" class="headerlink" title="1.3 where"></a>1.3 where</h3><p>有时候，所有的查询条件应该是可选的。</p>
<p>在需要使用至少一种查询条件的情况下，可以直接使用WHERE子句，如果有多个条件，需要在条件中添加AND或OR。</p>
<p>MyBatis提供了<code>&lt;where&gt;</code>元素支持这种类型的动态SQL语句。 </p>
<p>例如，在查询课程界面，假设所有的查询条件是可选的</p>
<p>对应的sql映射文件，如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Course&quot;</span> <span class="attr">id</span>=<span class="string">&quot;CourseResult&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;course_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;courseId&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;description&quot;</span> <span class="attr">property</span>=<span class="string">&quot;description&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;start_date&quot;</span> <span class="attr">property</span>=<span class="string">&quot;startDate&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;end_date&quot;</span> <span class="attr">property</span>=<span class="string">&quot;endDate&quot;</span> /&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span> </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;searchCourses&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;map&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;CourseResult&quot;</span>&gt;</span> </span><br><span class="line">    SELECT * FROM COURSES </span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;tutorId != null &quot;</span>&gt;</span> </span><br><span class="line">            TUTOR_ID= #&#123;tutorId&#125; </span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;courseName != null&quot;</span>&gt;</span> </span><br><span class="line">            AND name like #&#123;courseName&#125; </span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;startDate != null&quot;</span>&gt;</span> </span><br><span class="line">            AND start_date &gt;= #&#123;startDate&#125; </span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span> </span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，<code>&lt;where&gt;</code>元素只有在其内部标签有返回内容时才会在动态语句上插入WHERE条件语句。<br>并且，如果WHERE子句以AND或者OR打头，则打头的AND或OR将会被移除。</p>
</blockquote>
<p>测试方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_searchCourses3</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sqlSession = MyBatisSqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">        DynamicSqlMapper mapper = sqlSession.getMapper(DynamicSqlMapper.class);</span><br><span class="line"></span><br><span class="line">        Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;String,Object&gt;(); </span><br><span class="line">        <span class="comment">//map.put(&quot;tutorId&quot;, 1); </span></span><br><span class="line">        <span class="comment">//map.put(&quot;courseName&quot;, &quot;JavaSE&quot;); </span></span><br><span class="line">        <span class="comment">//map.put(&quot;startDate&quot;, LocalDate.of(2022, 1, 10)); </span></span><br><span class="line"></span><br><span class="line">        List&lt;Course&gt; courses = mapper.searchCourses(map);</span><br><span class="line"></span><br><span class="line">        courses.forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="1-4-trim"><a href="#1-4-trim" class="headerlink" title="1.4 trim"></a>1.4 trim</h3><p><code>&lt;trim&gt;</code>元素和<code>&lt;where&gt;</code>元素类似，同时<code>&lt;trim&gt;</code>提供了添加 前缀/后缀 或者 移除 前缀/后缀 的功能。</p>
<p>例如，</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;searchCourses&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;map&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;CourseResult&quot;</span>&gt;</span> </span><br><span class="line">    SELECT * FROM COURSES </span><br><span class="line">    <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;WHERE&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;and&quot;</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot; tutorId != null &quot;</span>&gt;</span></span><br><span class="line">            TUTOR_ID = #&#123;tutorId&#125; and</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;courseName != null&quot;</span>&gt;</span> </span><br><span class="line">            name like #&#123;courseName&#125; and</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">trim</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>其中：</p>
<ul>
<li>prefix表示有一个if成立则插入where语句</li>
<li>suffix表示后缀,和prefix相反</li>
<li>suffixOverrides=”and”表示如果最后生成的sql语句多一个and,则自动去掉.</li>
<li>prefixOverrides的意思是处理前缀,和suffixOverrides相反</li>
</ul>
<p>测试方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_searchCourses4</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sqlSession = MyBatisSqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">        DynamicSqlMapper mapper = sqlSession.getMapper(DynamicSqlMapper.class);</span><br><span class="line"></span><br><span class="line">        Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;String,Object&gt;(); </span><br><span class="line">        <span class="comment">//			map.put(&quot;tutorId&quot;, 1); </span></span><br><span class="line">        <span class="comment">//			map.put(&quot;courseName&quot;, &quot;JavaSE&quot;); </span></span><br><span class="line"></span><br><span class="line">        List&lt;Course&gt; courses = mapper.searchCourses(map);</span><br><span class="line"></span><br><span class="line">        courses.forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="1-5-foreach"><a href="#1-5-foreach" class="headerlink" title="1.5 foreach"></a>1.5 foreach</h3><p>另外一个强大的动态SQL语句构造标签是<code>&lt;foreach&gt;</code></p>
<p>它可以迭代遍历一个数组或者集合，构造AND/OR条件或一个IN子句。</p>
<p>假设查询tutor_id为 1，3，6的讲师所教授的课程，我们可以传递一个tutor_id组成的列表给映射语句，然后通过<code>&lt;foreach&gt;</code>遍历此列表构造动态SQL。</p>
<p>例如，</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;searchCourses&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;map&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;CourseResult&quot;</span>&gt;</span> </span><br><span class="line">    SELECT * FROM COURSES </span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;tutorIds != null&quot;</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">item</span>=<span class="string">&quot;tutorId&quot;</span> <span class="attr">collection</span>=<span class="string">&quot;tutorIds&quot;</span>&gt;</span> </span><br><span class="line">                OR tutor_id = #&#123;tutorId&#125; </span><br><span class="line">            <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span> </span><br></pre></td></tr></table></figure>



<p>映射接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DynamicSqlMapper</span></span>&#123; </span><br><span class="line">	<span class="function">List&lt;Course&gt; <span class="title">searchCourses</span><span class="params">(Map&lt;String,Object&gt; map)</span></span>; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>



<p>测试方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_searchCourses5</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sqlSession = MyBatisSqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">        DynamicSqlMapper mapper = sqlSession.getMapper(DynamicSqlMapper.class);</span><br><span class="line"></span><br><span class="line">        Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;String,Object&gt;(); </span><br><span class="line"></span><br><span class="line">        List&lt;Integer&gt; tutorIds = <span class="keyword">new</span> ArrayList&lt;Integer&gt;(); </span><br><span class="line">        tutorIds.add(<span class="number">1</span>); </span><br><span class="line">        tutorIds.add(<span class="number">3</span>); </span><br><span class="line">        tutorIds.add(<span class="number">6</span>); </span><br><span class="line"></span><br><span class="line">        map.put(<span class="string">&quot;tutorIds&quot;</span>, tutorIds); </span><br><span class="line"></span><br><span class="line">        List&lt;Course&gt; courses = mapper.searchCourses(map);</span><br><span class="line"></span><br><span class="line">        courses.forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>和上面同样的功能，使用<code>&lt;foreach&gt;</code>生成IN子句：（常用）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;searchCourses&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;map&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;CourseResult&quot;</span>&gt;</span> </span><br><span class="line">    SELECT * FROM COURSES </span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;tutorIds != null&quot;</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span> </span><br><span class="line">            tutor_id IN </span><br><span class="line">            <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">item</span>=<span class="string">&quot;tempValue&quot;</span> <span class="attr">collection</span>=<span class="string">&quot;tutorIds&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span>&gt;</span> </span><br><span class="line">                #&#123;tempValue&#125; </span><br><span class="line">            <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span> </span><br></pre></td></tr></table></figure>

<blockquote>
<p>动态插入</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;saveOrderLine&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;collection&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	insert into</span><br><span class="line">	es_orderline(num,cost,book_id,orderForm_id)</span><br><span class="line">	values</span><br><span class="line"></span><br><span class="line">       <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;collection&quot;</span> <span class="attr">item</span>=<span class="string">&quot;orderLine&quot;</span> <span class="attr">index</span>=<span class="string">&quot;index&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">           (</span><br><span class="line">               #&#123;orderLine.num&#125;,</span><br><span class="line">               #&#123;orderLine.cost&#125;,</span><br><span class="line">               #&#123;orderLine.book.id&#125;,</span><br><span class="line">               #&#123;orderLine.orderForm.id&#125;</span><br><span class="line">           )</span><br><span class="line">       <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="1-6-set"><a href="#1-6-set" class="headerlink" title="1.6 set"></a>1.6 set</h3><p><code>&lt;set&gt;</code>元素和<code>&lt;where&gt;</code>元素类似，但是set元素只是针对update更新语句使用的。</p>
<p>例如，</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateStudent&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Student&quot;</span>&gt;</span> </span><br><span class="line">    update students  </span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null&quot;</span>&gt;</span>name=#&#123;name&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;email != null&quot;</span>&gt;</span>email=#&#123;email&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;phone != null&quot;</span>&gt;</span>phone=#&#123;phone&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span> </span><br><span class="line">    where id=#&#123;studId&#125; </span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span> </span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，如果<code>&lt;if&gt;</code>条件返回了任何文本内容，<code>&lt;set&gt;</code>将会插入set关键字和其文本内容，并且会剔除将末尾的逗号。</p>
</blockquote>
<p>测试方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_updateStudent</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sqlSession = MyBatisSqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">        DynamicSqlMapper mapper = sqlSession.getMapper(DynamicSqlMapper.class);</span><br><span class="line"></span><br><span class="line">        Student student = <span class="keyword">new</span> Student();</span><br><span class="line">        student.setStudId(<span class="number">45</span>);</span><br><span class="line">        student.setEmail(<span class="string">&quot;xx@briup.com&quot;</span>);</span><br><span class="line"></span><br><span class="line">        mapper.updateStudent(student);</span><br><span class="line"></span><br><span class="line">        sqlSession.commit();</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="2-特殊"><a href="#2-特殊" class="headerlink" title="2.特殊"></a>2.特殊</h2><p>除了简化数据库编程外，MyBatis还提供了各种<strong>特殊功能</strong>，这些对实现一些常用任务非常有用，比如分页查询，存取CLOB/BLOB类型的数据，处理枚举类型值等等。</p>
<p>可以新建包<strong>special</strong>，相关实体类存放到这里面。<br>另外，在mybaits-config文件中配置别名和新增映射文件。</p>
<h3 id="2-1-枚举类型"><a href="#2-1-枚举类型" class="headerlink" title="2.1 枚举类型"></a>2.1 枚举类型</h3><p>MyBatis支持持久化enum类型属性。</p>
<p>假设t_user表中有一列gender（性别）类型为 varchar2(10)，存储 MALE 或者 FEMALE 两种值。</p>
<p>并且，User对象有一个enum类型的gender 属性，如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">Gender</span> </span>&#123; </span><br><span class="line">    MALE,FEMALE; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>



<p>默认情况下MyBatis使用<code>EnumTypeHandler</code>来处理enum类型的Java属性，并且将其存储为enum值的名称。</p>
<p>我们不需要为此做任何额外的配置。可以像使用基本数据类型属性一样使用enum类型属性。</p>
<p>建表语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> t_user;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_user(</span><br><span class="line">  id number <span class="keyword">primary</span> key,</span><br><span class="line">  name varchar2(<span class="number">50</span>),</span><br><span class="line">  gender varchar2(<span class="number">10</span>)</span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>实体类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.special;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123; </span><br><span class="line">	<span class="keyword">private</span> Integer id; </span><br><span class="line">	<span class="keyword">private</span> String name; </span><br><span class="line">	<span class="keyword">private</span> Gender gender;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Gender <span class="title">getGender</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> gender;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setGender</span><span class="params">(Gender gender)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.gender = gender;</span><br><span class="line">	&#125; </span><br><span class="line"></span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>



<p>映射文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;User&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">order</span>=<span class="string">&quot;BEFORE&quot;</span>&gt;</span></span><br><span class="line">        select my_seq.nextval from dual</span><br><span class="line">    <span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br><span class="line">    insert into t_user(id,name,gender) </span><br><span class="line">    values(#&#123;id&#125;,#&#123;name&#125;,#&#123;gender&#125;) </span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>测试方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_insertUser</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sqlSession = MyBatisSqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">        SpecialMapper mapper = sqlSession.getMapper(SpecialMapper.class);</span><br><span class="line">        User user = <span class="keyword">new</span> User(<span class="string">&quot;tom&quot;</span>,Gender.MALE);</span><br><span class="line"></span><br><span class="line">        mapper.insertUser(user);</span><br><span class="line"></span><br><span class="line">        sqlSession.commit();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，当执行insertStudent语句的时候，MyBatis会取Gender枚举对象（FEMALE/MALE）的名称，存储到GENDER列中。</p>
</blockquote>
<p>如果我们想存储FEMALE为0，MALE为1到gender列中，需要在mybatis-config.xml文件中配置专门的<strong>类型处理器</strong>，并指定它处理的枚举类型是哪个。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">&quot;org.apache.ibatis.type.EnumOrdinalTypeHandler&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.briup.special.Gender&quot;</span>/&gt;</span> </span><br></pre></td></tr></table></figure>

<p>需要注意的是，枚举类型的【顺序值】是根据enum中的声明顺序赋值的。如果改变了Gender里面对象的声明顺序，则数据库存储的数据和此顺序值就不匹配了。</p>
<h3 id="2-2-CLOB-BLOB"><a href="#2-2-CLOB-BLOB" class="headerlink" title="2.2 CLOB/BLOB"></a>2.2 CLOB/BLOB</h3><p>BLOB和CLOB都是大字段类型。</p>
<p>BLOB是按二进制来存储的，而CLOB是可以直接存储文字的。</p>
<p>通常像图片、文件、音乐等信息就用BLOB字段来存储，先将文件转为二进制再存储进去。</p>
<p>文章或者是较长的文字，就用CLOB存储.</p>
<p>BLOB和CLOB在不同的数据库中对应的类型也不一样：</p>
<ul>
<li>在MySQL中，clob对应text/longtext，blob对应blob </li>
<li>在Oracle中，clob对应clob，blob对应blob  </li>
</ul>
<p>对此，MyBatis提供了内建的对CLOB/BLOB类型列的映射处理支持，无需我们额外配置和操作。</p>
<p>例如，</p>
<p>建表语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> user_pics;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> user_pics( </span><br><span class="line">    id number <span class="keyword">primary</span> key, </span><br><span class="line">    name varchar2(<span class="number">50</span>) , </span><br><span class="line">    pic <span class="type">blob</span>, </span><br><span class="line">    bio <span class="type">clob</span></span><br><span class="line">); </span><br></pre></td></tr></table></figure>

<p>照片（pic）可以是PNG,JPG或其他格式的。简介信息（bio）可以是比较长的文字描述。</p>
<p>默认情况下，MyBatis将CLOB类型的列映射到<code>java.lang.String</code>类型上、而把BLOB列映射到<code>byte[]</code>类型上。</p>
<p>实体类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.special;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserPic</span></span>&#123; </span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> id; </span><br><span class="line">	<span class="keyword">private</span> String name; </span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">byte</span>[] pic; <span class="comment">//blob</span></span><br><span class="line">	<span class="keyword">private</span> String bio; <span class="comment">//clob</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">byte</span>[] getPic() &#123;</span><br><span class="line">		<span class="keyword">return</span> pic;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPic</span><span class="params">(<span class="keyword">byte</span>[] pic)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.pic = pic;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getBio</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> bio;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBio</span><span class="params">(String bio)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.bio = bio;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>



<p>映射文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertUserPic&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;UserPic&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">order</span>=<span class="string">&quot;BEFORE&quot;</span>&gt;</span></span><br><span class="line">        select my_seq.nextval from dual</span><br><span class="line">    <span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br><span class="line">    insert into user_pics(id,name, pic,bio) </span><br><span class="line">    values(#&#123;id&#125;,#&#123;name&#125;,#&#123;pic&#125;,#&#123;bio&#125;) </span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span> </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserPicById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;UserPic&quot;</span>&gt;</span> </span><br><span class="line">    select * from user_pics where id=#&#123;id&#125; </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span> </span><br></pre></td></tr></table></figure>



<p>测试方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_insertUserPic</span><span class="params">()</span></span>&#123; </span><br><span class="line">    String name = <span class="string">&quot;tom&quot;</span>; </span><br><span class="line">    String bio = <span class="string">&quot;可以是很长的字符串&quot;</span>;</span><br><span class="line">    <span class="keyword">byte</span>[] pic = <span class="keyword">null</span>; </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//读取用户头像图片</span></span><br><span class="line">        File file = <span class="keyword">new</span> File(<span class="string">&quot;src/com/briup/special/1.gif&quot;</span>); </span><br><span class="line">        InputStream is = <span class="keyword">new</span> FileInputStream(file); </span><br><span class="line">        pic = <span class="keyword">new</span> <span class="keyword">byte</span>[is.available()]; </span><br><span class="line">        is.read(pic); </span><br><span class="line">        is.close(); </span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e)&#123; </span><br><span class="line">        e.printStackTrace(); </span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    <span class="comment">//准备好要插入到数据库中的数据并封装成对象</span></span><br><span class="line">    UserPic userPic = <span class="keyword">new</span> UserPic(name, pic , bio); </span><br><span class="line"></span><br><span class="line">    SqlSession sqlSession = <span class="keyword">null</span>; </span><br><span class="line">    <span class="keyword">try</span>&#123; </span><br><span class="line">        sqlSession = MyBatisSqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">        SpecialMapper mapper = sqlSession.getMapper(SpecialMapper.class);</span><br><span class="line"></span><br><span class="line">        mapper.insertUserPic(userPic);</span><br><span class="line"></span><br><span class="line">        sqlSession.commit(); </span><br><span class="line">    &#125;<span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_getUserPicById</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sqlSession = MyBatisSqlSessionFactory.openSession();</span><br><span class="line">        SpecialMapper mapper = sqlSession.getMapper(SpecialMapper.class);</span><br><span class="line">        UserPic userPic = mapper.getUserPicById(<span class="number">59</span>);</span><br><span class="line">        System.out.println(userPic.getId());</span><br><span class="line">        System.out.println(userPic.getName());</span><br><span class="line">        System.out.println(userPic.getBio());</span><br><span class="line">        System.out.println(userPic.getPic().length);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-多个参数"><a href="#2-3-多个参数" class="headerlink" title="2.3 多个参数"></a>2.3 多个参数</h3><p>MyBatis中的映射语句有一个parameterType属性来制定输入参数的类型。</p>
<p>如果我们想给映射语句传入多个参数的话，我们可以将所有的输入参数放到HashMap中，将HashMap传递给映射语句。</p>
<p>其实就是把多个参数存到Map中，把Map当做一个参数再传给sql语句，mybaits收到后再解析Map集合拿到每一个参数。</p>
<p>同时MyBatis还提供了另外一种传递多个输入参数给映射语句的方法。</p>
<p>例如，我们想通过给定的name和email信息查找学生信息，定义查询接口如下</p>
<p>映射文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateUserPicNameById1&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">    update user_pics set name = #&#123;name&#125; where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateUserPicNameById2&quot;</span>&gt;</span></span><br><span class="line">    update user_pics set name = #&#123;param2&#125; where id = #&#123;param1&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>对于映射器中的方法，MyBatis默认从左到右给方法的参数命名为param1、param2…，依次类推。</p>
</blockquote>
<p>映射接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">updateUserPicNameById1</span><span class="params">(Map&lt;String,String&gt; map)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">updateUserPicNameById2</span><span class="params">(Integer id,String name)</span></span>;</span><br></pre></td></tr></table></figure>



<p>测试方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_updateUserPicNameById1</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sqlSession = MyBatisSqlSessionFactory.openSession();</span><br><span class="line">        SpecialMapper mapper = sqlSession.getMapper(SpecialMapper.class);</span><br><span class="line">        Map&lt;String,String&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;64&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;zs&quot;</span>);</span><br><span class="line">        mapper.updateUserPicNameById1(map);</span><br><span class="line">        sqlSession.commit();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_updateUserPicNameById2</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sqlSession = MyBatisSqlSessionFactory.openSession();</span><br><span class="line">        SpecialMapper mapper = sqlSession.getMapper(SpecialMapper.class);</span><br><span class="line">        mapper.updateUserPicNameById2(<span class="number">64</span>,<span class="string">&quot;ww&quot;</span>);</span><br><span class="line">        sqlSession.commit();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-4-映射Map"><a href="#2-4-映射Map" class="headerlink" title="2.4 映射Map"></a>2.4 映射Map</h3><p>可以使用之前用过的方式，接口中方法返回值定义为Map类型，sql语句的resultType属性设置为map即可。这种情况默认把列名作为key,列中的值作为value。</p>
<p>如果有一些特殊的情况，比如需要使用id值作为key，把一行数据封装成的对象作为value放到map中的话，需要使用下面的方式。</p>
<p>例如，</p>
<p>映射文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAllUsers&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span> </span><br><span class="line">	select id,name,gender from t_user </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span> </span><br></pre></td></tr></table></figure>



<p>测试代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_findAllUsers_map</span><span class="params">()</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		sqlSession = MyBatisSqlSessionFactory.openSession();</span><br><span class="line">		Map&lt;Integer, User&gt; map = sqlSession.selectMap(<span class="string">&quot;com.briup.mappers.SpecialMapper.findAllUsers&quot;</span>,<span class="string">&quot;id&quot;</span>);</span><br><span class="line">		map.forEach((k,v)-&gt;System.out.println(k+<span class="string">&quot; : &quot;</span>+v));</span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意事项：</p>
<ul>
<li>这时候只能使用字符串来调用sql语句，不能使用映射接口的方式（不支持）</li>
<li>t_user表中gender列的值都是数字还是都是字符串，需要保持一致，否则查询报错</li>
<li>这里map将id作为key值，而每行数据封装成的User对象作为value值</li>
<li>map中的key我们可以指定，但是value只能是当前这条数据封装成的对象</li>
</ul>
<h3 id="2-5-分页查询"><a href="#2-5-分页查询" class="headerlink" title="2.5 分页查询"></a>2.5 分页查询</h3><p>MyBatis可以使用RowBounds逐页加载表数据。RowBounds对象可以使用offset和limit参数来构建。参数offset表示开始位置，而limit表示要取的记录的数目。</p>
<p>例如，</p>
<p>映射文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAllUsers&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span> </span><br><span class="line">    select id,name,gender from t_user </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span> </span><br></pre></td></tr></table></figure>



<p>映射接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">findAllUsers</span><span class="params">(RowBounds rowBounds)</span></span>;</span><br></pre></td></tr></table></figure>



<p>测试方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_findAllUsers_page</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sqlSession = MyBatisSqlSessionFactory.openSession();</span><br><span class="line">        SpecialMapper mapper = sqlSession.getMapper(SpecialMapper.class);</span><br><span class="line">        <span class="comment">//表示从第几条数据开始</span></span><br><span class="line">        <span class="keyword">int</span> offset = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">//连续取出几条数据</span></span><br><span class="line">        <span class="keyword">int</span> limit = <span class="number">5</span>; </span><br><span class="line">        RowBounds rowBounds = <span class="keyword">new</span> RowBounds(offset, limit); </span><br><span class="line">        List&lt;User&gt; list = mapper.findAllUsers(rowBounds);</span><br><span class="line">        list.forEach(System.out::println);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line">	</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，若规定每页5条数据，要展示第二页，使用offset=5,limit=5</p>
</blockquote>
<p>其实Mybatis的这种分页是基于内存的分页（查出所有记录再按偏移量offset和limit取结果），在大数据量的情况下这样的分页效率会很低，后面我们会使用mybaits的分页辅助/插件工具来完成分页。</p>
<p>之前，在学习oracle的时候，也学习了使用rownum进行分页：</p>
<p>例如，查询出行号在5~10之间的数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line">    <span class="keyword">select</span> rownum <span class="keyword">as</span> rowno, t.<span class="operator">*</span></span><br><span class="line">    <span class="keyword">from</span> t_user t</span><br><span class="line">    <span class="keyword">where</span> rownum <span class="operator">&lt;=</span> <span class="number">10</span></span><br><span class="line">) temp</span><br><span class="line"><span class="keyword">where</span> temp.rowno <span class="operator">&gt;=</span> <span class="number">5</span>;</span><br></pre></td></tr></table></figure>

<p>其中：</p>
<ul>
<li>rownum 可以等于1</li>
<li>rownum 可以大于0</li>
<li>rownum 可以小于任何数  </li>
</ul>
<p>但是可以给rownum起一个别名，并把sql语句查询结果当做一张表再查询，这样就可以对这个行号进行任意操作了。</p>
<h3 id="2-6-处理结果集"><a href="#2-6-处理结果集" class="headerlink" title="2.6 处理结果集"></a>2.6 处理结果集</h3><p>MyBatis提供了<code>ResultHandler</code>接口,可以让我们以任何自己喜欢的方式处理结果集ResultSet。</p>
<p><code>sqlSession.select()</code>方法，可以传递给它一个<code>ResultHandler</code>接口的实现，它会处理<code>ResultSet</code>中查询到的的每一条数据，这时候我们可以按照自己的需要进行封装。</p>
<p>例如，把t_user表中所有数据的id和name查询出来,并且把id值作为key,把name值作为value封装到Map集合中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_ResultHandler</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Map&lt;Integer,String&gt; map = <span class="keyword">new</span> HashMap&lt;Integer, String&gt;(); </span><br><span class="line">    SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sqlSession = MyBatisSqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">        sqlSession.select(<span class="string">&quot;com.briup.mappers.SpecialMapper.findAllUsers&quot;</span>, <span class="keyword">new</span> ResultHandler&lt;User&gt;() &#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleResult</span><span class="params">(ResultContext&lt;? extends User&gt; resultContext)</span> </span>&#123;</span><br><span class="line">                <span class="comment">//获取当这条数据封装好的User对象</span></span><br><span class="line">                User user = resultContext.getResultObject(); </span><br><span class="line">                <span class="comment">//按照自己的要求的方式进行封装</span></span><br><span class="line">                map.put(user.getId(), user.getName()); </span><br><span class="line">            &#125;</span><br><span class="line">                       </span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//也可以使用之前labmda表达式来完成</span></span><br><span class="line">        sqlSession.select(<span class="string">&quot;com.briup.dao.SpecialMapper.findAllUsers&quot;</span>,</span><br><span class="line">			(resultContext) -&gt; &#123;</span><br><span class="line">				User user = (User) resultContext.getResultObject();</span><br><span class="line">				map.put(user.getId(), user.getName());</span><br><span class="line">			&#125;</span><br><span class="line">		);</span><br><span class="line"></span><br><span class="line">        map.forEach((k,v)-&gt;System.out.println(k+<span class="string">&quot; : &quot;</span>+v));</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意: 方法名字叫select</p>
</blockquote>
<h3 id="2-7-缓存-redis"><a href="#2-7-缓存-redis" class="headerlink" title="2.7 缓存(redis)"></a>2.7 缓存(redis)</h3><p>默认情况下，mybatis会启用一级缓存。</p>
<p>如果使用同一个session对象调用了相同的SELECT语句，则直接会从缓存中返回结果，而不是再查询一次数据库。</p>
<blockquote>
<p>注意，session调用commit或close方法后,这个session中的一级缓存就会被清空 </p>
</blockquote>
<p>例如，根据日志输出可以看出,下面代码只会发出一条sql查询语句</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_cache1</span><span class="params">()</span></span>&#123;</span><br><span class="line">    SqlSession session = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        session = MyBatisSqlSessionFactory.openSession();</span><br><span class="line">        SpecialMapper mapper = session.getMapper(SpecialMapper.class);</span><br><span class="line">        User user1 = mapper.findUserById(<span class="number">56</span>);</span><br><span class="line">        System.out.println(user1);</span><br><span class="line">        User user2 = mapper.findUserById(<span class="number">56</span>);</span><br><span class="line">        System.out.println(user2);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，根据日志输出可以看出,下面代码只会发出一条sql查询语句</p>
</blockquote>
<blockquote>
<p>注意，session调用commit或close方法后,这个session中的一级缓存就会被清空 </p>
</blockquote>
<p>二级缓存，在不同的session对象之间可以共享缓存的数据</p>
<ol>
<li><code>mybatis-config.xml</code>文件中保证<code>&lt;setting name=&quot;cacheEnabled&quot; value=&quot;true&quot;/&gt;</code>设置中是缓存功能是开启的，默认就是开启的true</li>
<li>在需要二级缓存的xml映射文件中,手动开启缓存功能,在根元素中加入一个标签即可:<code>&lt;cache/&gt;</code></li>
<li>一个session查询完数据之后,需要调用commit或者close方法后,这个数据才会进入到二级缓存中,然后其他session就可以共享到这个缓存数据了</li>
<li>默认情况下,被二级缓存保存的对象需要实现序列化接口</li>
</ol>
<p>例如，</p>
<p>配置文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;cacheEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>映射文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.briup.mappers.SpecialMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">cache</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span>&gt;</span> ..<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span>&gt;</span> ..<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span>&gt;</span> ..<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>测试代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    SqlSession session = SqlSessionUtil.openSqlSession();</span><br><span class="line">    SpecialMapper mapper = session.getMapper(SpecialMapper.class);</span><br><span class="line">    List&lt;User&gt; userList1 = mapper.findAllUsers();</span><br><span class="line">    session.close();</span><br><span class="line"></span><br><span class="line">    SqlSession session2 = SqlSessionUtil.openSqlSession();</span><br><span class="line">    SpecialMapper mapper2 = session2.getMapper(SpecialMapper.class);</span><br><span class="line">    List&lt;User&gt; userList2 = mapper2.findAllUsers();</span><br><span class="line">    session2.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>二级缓存补充说明：</p>
<p>  　　1. 映射语句文件中的所有select语句将会被缓存<br>  　　2. 映射语句文件中的所有insert，update和delete语句会刷新缓存<br>  　　3. 缓存会使用Least Recently Used（LRU，最近最少使用的）算法来收回。<br>  　　4. 缓存会根据指定的时间间隔来刷新。<br>  　　5. 缓存会存储1024个对象</p>
<p>cache标签常用属性：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cache</span>  <span class="attr">eviction</span>=<span class="string">&quot;FIFO&quot;</span> <span class="attr">flushInterval</span>=<span class="string">&quot;60000&quot;</span> <span class="attr">size</span>=<span class="string">&quot;512&quot;</span> <span class="attr">readOnly</span>=<span class="string">&quot;true&quot;</span>/&gt;</span> </span><br></pre></td></tr></table></figure>

<p>其中：</p>
<ul>
<li>eviction=”FIFO” ，回收策略为先进先出</li>
<li>flushInterval=”60000” ，自动刷新时间60s</li>
<li>size=”512” ，最多缓存512个引用对象</li>
<li>readOnly=”true”，true表示对象不可以被序列化,false表示可以被序列化,默认值是false</li>
</ul>
<blockquote>
<p>注意，将来更多的时候我们会使用redis来进行对数据的缓存，而不是使用mybaits提供的缓存功能</p>
</blockquote>
<h2 id="3-注解"><a href="#3-注解" class="headerlink" title="3.注解"></a>3.注解</h2><blockquote>
<p>注解相关的内容作为了解即可，大多数情况下会还是会使用xml方式进行配置</p>
</blockquote>
<p>之前我们都是在映射器MapperXML配置文件中配置映射语句的。除此之外MyBatis也支持使用注解来配置映射语句。</p>
<p>当我们使用基于注解的映射器接口时，我们不再需要在XML配置文件中配置了。也可以同时使用基于XML和基于注解的映射语句。</p>
<p>例如，准备测试环境</p>
<p>建表语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> person;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> person(</span><br><span class="line">    id number <span class="keyword">primary</span> key,</span><br><span class="line">    name varchar2(<span class="number">15</span>),</span><br><span class="line">    age number</span><br><span class="line">);	</span><br></pre></td></tr></table></figure>



<p>实体类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.special;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Integer id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> Integer age;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> age;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.age = age;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-1-接口"><a href="#3-1-接口" class="headerlink" title="3.1 接口"></a>3.1 接口</h3><p>Mybatis中的注解，是直接写在映射接口中的。</p>
<p>MyBatis对于大部分的基于XML的映射配置（包括<code>&lt;select&gt;</code>,<code>&lt;update&gt;</code>等）提供了对应的基于注解的配置。然而在某些情况下，有些xml的配置功能，使用注解的方式是实现不了的。</p>
<h3 id="3-2-使用"><a href="#3-2-使用" class="headerlink" title="3.2 使用"></a>3.2 使用</h3><p>MyBatis提供了多种注解来支持不同类型的语句如:SELECT,INSERT,UPDATE,DELETE。</p>
<h4 id="3-2-1-Insert"><a href="#3-2-1-Insert" class="headerlink" title="3.2.1 @Insert"></a>3.2.1 @Insert</h4><p>我们可以使用 <code>@Insert</code>注解来定义一个INSERT映射语句：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.mappers; </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentMapper</span></span>&#123; </span><br><span class="line"></span><br><span class="line">	<span class="meta">@Insert(&quot;insert into students(stud_id,name,email,addr_id, phone) values(#&#123;studId&#125;,#&#123;name&#125;,#&#123;email&#125;,#&#123;address.addrId&#125;,#&#123;phone&#125;)&quot;)</span> </span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">insertStudent</span><span class="params">(Student student)</span></span>; </span><br><span class="line"></span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>注意，在mybatis-config.xml中，需要配置，通知mybaits，哪一个接口有注解的配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.dao.SpecialMapper&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>自动生成主键</p>
<p>可以使用 <code>@Options</code>注解的userGeneratedKeys和keyProperty属性让数据库产生 auto_increment（自增长）列的值，然后将生成的值设置到输入参数对象的属性中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Insert(&quot;insert into students(name,email,addr_id, phone) </span></span><br><span class="line"><span class="meta">		values(#&#123;name&#125;,#&#123;email&#125;,#&#123;address.addr Id&#125;,#&#123;phone&#125;)&quot;)</span> </span><br><span class="line"><span class="meta">@Options(useGeneratedKeys = true, keyProperty = &quot;studId&quot;)</span> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">insertStudent</span><span class="params">(Student student)</span></span>; </span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里ID列值将会通过MySQL数据库自动生成。并且生成的值将会被设置到student对象的studId属性中。</p>
</blockquote>
<p>有一些数据库如Oracle，并不支持AUTO_INCREMENT列属性，它使用序列（SEQUENCE）来产生主键的值。</p>
<p>我们可以使用 <code>@SelectKey</code>注解来为任意SQL语句来指定主键值，作为主键列的值。假设我们有一个名为STUD_ID_SEQ的序列来生成STUD_ID主键值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Insert(&quot;insert into students(stud_id,name,email,addr_id,phone) values(#&#123;studId&#125;,#&#123;name&#125;,#&#123;email&#125;,#&#123;address.addrId&#125;,#&#123;phone&#125;)&quot;)</span> </span><br><span class="line"><span class="meta">@SelectKey(statement=&quot;select my_seq.nextval from dual&quot;,  </span></span><br><span class="line"><span class="meta">           keyProperty=&quot;studId&quot;, resultType=int.class, before=true)</span> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">insertStudent</span><span class="params">(Student student)</span></span>; </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这里使用了<code>@SelectKey</code>来生成主键值，并且存储到了student对象的studId属性上。由于我们设置了<code>before=true</code>,该语句将会在执行INSERT语句之前执行</p>
<h4 id="3-2-2-Update"><a href="#3-2-2-Update" class="headerlink" title="3.2.2 @Update"></a>3.2.2 @Update</h4><p>我们可以使用 <code>@Update</code>注解来定义一个UPDATE映射语句，如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Update(&quot;update students set name=#&#123;name&#125;, email=#&#123;email&#125;,phone=#&#123;phone&#125; where stud_id=#&#123;studId&#125;&quot;)</span> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">updateStudent</span><span class="params">(Student student)</span></span>; </span><br></pre></td></tr></table></figure>

<h4 id="3-2-3-Delete"><a href="#3-2-3-Delete" class="headerlink" title="3.2.3 @Delete"></a>3.2.3 @Delete</h4><p>我们可以使用 <code>@Delete</code>注解来定义一个DELETE映射语句，如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Delete(&quot;delete from students where stud_id=#&#123;studId&#125;&quot;)</span> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">deleteStudent</span><span class="params">(<span class="keyword">int</span> studId)</span></span>;</span><br></pre></td></tr></table></figure>



<h4 id="3-2-4-Select"><a href="#3-2-4-Select" class="headerlink" title="3.2.4 @Select"></a>3.2.4 @Select</h4><p>我们可以使用 <code>@Select</code>注解来定义一个SELECT映射语句。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;select id as studid, name, email, phone from students where stud_id=#&#123;studId&#125;&quot;)</span> </span><br><span class="line"><span class="function">Student <span class="title">findStudentById</span><span class="params">(Integer studId)</span></span>; </span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这里为了将列名和对象中属性名匹配，为ID起了一个studId的别名。如果此查询返回了多行结果，将抛出TooManyResultsException异常</p>
</blockquote>
<h3 id="3-3-结果映射"><a href="#3-3-结果映射" class="headerlink" title="3.3 结果映射"></a>3.3 结果映射</h3><p>可以将查询结果通过别名或者是<code>@Results</code>注解与实体类的属性映射起来。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;select * from students&quot;)</span> </span><br><span class="line"><span class="meta">@Results(&#123; </span></span><br><span class="line"><span class="meta">        @Result(id = true, column = &quot;id&quot;, property = &quot;studId&quot;), </span></span><br><span class="line"><span class="meta">        @Result(column = &quot;name&quot;, property = &quot;name&quot;), </span></span><br><span class="line"><span class="meta">        @Result(column = &quot;email&quot;, property = &quot;email&quot;), </span></span><br><span class="line"><span class="meta">        @Result(column = &quot;addr_id&quot;, property = &quot;address.addrId&quot;) </span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="function">List&lt;Student&gt; <span class="title">findAllStudents</span><span class="params">()</span></span>; </span><br><span class="line">	</span><br></pre></td></tr></table></figure>



<p>也可以在xml中定义结果集，然后在注解中引用。例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;select * from students where stud_id=#&#123;studId&#125;&quot;)</span> </span><br><span class="line"><span class="meta">@Results(&#123; </span></span><br><span class="line"><span class="meta">		@Result(id = true, column = &quot;id&quot;, property = &quot;studId&quot;), </span></span><br><span class="line"><span class="meta">		@Result(column = &quot;name&quot;, property = &quot;name&quot;), </span></span><br><span class="line"><span class="meta">		@Result(column = &quot;email&quot;, property = &quot;email&quot;), </span></span><br><span class="line"><span class="meta">		@Result(column = &quot;addr_id&quot;, property = &quot;address.addrId&quot;) </span></span><br><span class="line"><span class="meta">&#125;)</span> </span><br><span class="line"><span class="function">Student <span class="title">findStudentById</span><span class="params">(<span class="keyword">int</span> studId)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Select(&quot;select * from students&quot;)</span> </span><br><span class="line"><span class="meta">@Results(&#123; </span></span><br><span class="line"><span class="meta">		@Result(id = true, column = &quot;id&quot;, property = &quot;studId&quot;), </span></span><br><span class="line"><span class="meta">		@Result(column = &quot;name&quot;, property = &quot;name&quot;), </span></span><br><span class="line"><span class="meta">		@Result(column = &quot;email&quot;, property = &quot;email&quot;), </span></span><br><span class="line"><span class="meta">		@Result(column = &quot;addr_id&quot;, property = &quot;address.addrId&quot;) </span></span><br><span class="line"><span class="meta">&#125;)</span> </span><br><span class="line"><span class="function">List&lt;Student&gt; <span class="title">findAllStudents</span><span class="params">()</span></span>; </span><br></pre></td></tr></table></figure>

<p>这里两个语句的 <code>@Results</code>配置完全相同，可以创建一个映射文件，文件中配置<code>&lt;resultMap&gt;</code>元素，然后使用 <code>@ResultMap</code>注解引用此<code>&lt;resultMap&gt;</code></p>
<p>在StudentMapper.xml中定义一个ID为StudentResult的<code>&lt;resultMap&gt;</code>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.briup.mappers.StudentMapper&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Student&quot;</span> <span class="attr">id</span>=<span class="string">&quot;StudentResult&quot;</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;studId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> /&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> /&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> /&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;phone&quot;</span> <span class="attr">column</span>=<span class="string">&quot;phone&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>在StudentMapper.java中,使用 <code>@ResultMap</code>引用名为StudentResult的resultMap:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentMapper</span></span>&#123; </span><br><span class="line">    <span class="meta">@Select(&quot;select * from students where stud_id=#&#123;studId&#125;&quot;)</span> </span><br><span class="line">    <span class="meta">@ResultMap(&quot;com.briup.mappers.StudentMapper.StudentResult&quot;)</span> </span><br><span class="line">    <span class="function">Student <span class="title">findStudentById</span><span class="params">(<span class="keyword">int</span> studId)</span></span>; </span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select(&quot;select * from students&quot;)</span> </span><br><span class="line">    <span class="meta">@ResultMap(&quot;com.briup.mappers.StudentMapper.StudentResult&quot;)</span> </span><br><span class="line">    <span class="function">List&lt;Student&gt; <span class="title">findAllStudents</span><span class="params">()</span></span>; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h3 id="3-4-一对一"><a href="#3-4-一对一" class="headerlink" title="3.4 一对一"></a>3.4 一对一</h3><p>MyBatis提供了 <code>@One</code>注解来使用嵌套select语句加载一对一关联查询数据。</p>
<p>例如，使用<code>@One</code>注解获取学生及其地址信息 <code>@Result</code>注解中，有one这个属性，也有many这个属性。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentMapper</span></span>&#123; </span><br><span class="line">    <span class="meta">@Select(&quot;select addr_id as addrId, street, city, state, zip, country from addresses where addr_id=#&#123;id&#125;&quot;)</span> </span><br><span class="line">    <span class="function">Address <span class="title">findAddressById</span><span class="params">(<span class="keyword">int</span> id)</span></span>; </span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select(&quot;select * from students where stud_id=#&#123;studId&#125; &quot;)</span> </span><br><span class="line">    <span class="meta">@Results(&#123; </span></span><br><span class="line"><span class="meta">            @Result(id = true, column = &quot;id&quot;, property = &quot;studId&quot;), </span></span><br><span class="line"><span class="meta">            @Result(column = &quot;name&quot;, property = &quot;name&quot;), </span></span><br><span class="line"><span class="meta">            @Result(column = &quot;email&quot;, property = &quot;email&quot;), </span></span><br><span class="line"><span class="meta">            @Result(property = &quot;address&quot;, column = &quot;addr_id&quot;, </span></span><br><span class="line"><span class="meta">                    one = @One(select = &quot;com.briup.mappers.Student Mapper.findAddressById&quot;)) </span></span><br><span class="line"><span class="meta">    &#125;)</span> </span><br><span class="line">    <span class="function">Student <span class="title">selectStudentWithAddress</span><span class="params">(<span class="keyword">int</span> studId)</span></span>; </span><br><span class="line">&#125; </span><br><span class="line">	</span><br></pre></td></tr></table></figure>

<p>这里使用了<code>@One</code>注解的select属性来指定一个方法，该方法会返回一个Address对象。</p>
<p>使用column=”addr_id”,则STUEDNTS表中列addr_id的值将会作为输入参数传递给findAddressById()方法。</p>
<p>如果 <code>@One</code> SELECT查询返回了多行结果，则会抛出TooManyResultsException异常。</p>
<p>测试代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> studId = <span class="number">1</span>; </span><br><span class="line">StudentMapper studentMapper = sqlSession.getMapper(StudentMapper.class); </span><br><span class="line">Student student = studentMapper.selectStudentWithAddress(studId); </span><br><span class="line">System.out.println(<span class="string">&quot;Student :&quot;</span>+student); </span><br><span class="line">System.out.println(<span class="string">&quot;Address :&quot;</span>+student.getAddress()); </span><br></pre></td></tr></table></figure>





<p>之前可以通过基于XML的映射配置，使用嵌套结果ResultMap来加载一对一关联的查询。而MyBatis当前版本中，并没有对应的注解支持。</p>
<p>但是可以在映射文件中把1对1的嵌套结果形式的映射信息配置好，然后在@ResultMap注解中去引用它。</p>
<p>在StudentMapper.xml中配置<code>&lt;resultMap&gt;</code>，如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.briup.mappers.StudentMapper&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Address&quot;</span> <span class="attr">id</span>=<span class="string">&quot;AddressResult&quot;</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;addrId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;addr_id&quot;</span> /&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;street&quot;</span> <span class="attr">column</span>=<span class="string">&quot;street&quot;</span> /&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;city&quot;</span> <span class="attr">column</span>=<span class="string">&quot;city&quot;</span> /&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;state&quot;</span> <span class="attr">column</span>=<span class="string">&quot;state&quot;</span> /&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;zip&quot;</span> <span class="attr">column</span>=<span class="string">&quot;zip&quot;</span> /&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;country&quot;</span> <span class="attr">column</span>=<span class="string">&quot;country&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Student&quot;</span> <span class="attr">id</span>=<span class="string">&quot;StudentWithAddressResult&quot;</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;studId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> /&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> /&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> /&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;address&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;AddressResult&quot;</span> /&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span> </span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentMapper</span></span>&#123; </span><br><span class="line">		<span class="meta">@Select(&quot;select stud_id, name, email, a.addr_id, street, city, state, zip, country&quot; + &quot; FROM students s left outer join addresses a on s.addr_id=a.addr_id&quot; + &quot; where stud_id=#&#123;studId&#125; &quot;)</span> </span><br><span class="line">		<span class="meta">@ResultMap(&quot;com.briup.mappers.StudentMapper.StudentWithAddressResult&quot;)</span> </span><br><span class="line">		<span class="function">Student <span class="title">selectStudentWithAddress</span><span class="params">(<span class="keyword">int</span> id)</span></span>; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>



<h3 id="3-5-一对多"><a href="#3-5-一对多" class="headerlink" title="3.5 一对多"></a>3.5 一对多</h3><p>MyBatis提供了<code>@Many</code>注解，用来使用嵌套Select语句加载一对多关联查询。</p>
<p>例如，使用<code>@Many</code>注解获取一个讲师及其教授课程列表信息：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TutorMapper</span></span>&#123; </span><br><span class="line">	<span class="meta">@Select(&quot;select addr_id as addrId, street, city, state, zip, </span></span><br><span class="line"><span class="meta">			country from addresses where addr_id=#&#123;id&#125;&quot;)</span> </span><br><span class="line">	<span class="function">Address <span class="title">findAddressById</span><span class="params">(<span class="keyword">int</span> id)</span></span>; </span><br><span class="line"></span><br><span class="line">	<span class="meta">@Select(&quot;select * from courses where tutor_id=#&#123;tutorId&#125;&quot;)</span> </span><br><span class="line">	<span class="meta">@Results( </span></span><br><span class="line"><span class="meta">	&#123; </span></span><br><span class="line"><span class="meta">		@Result(id = true, column = &quot;course_id&quot;, property = &quot;courseId&quot;), </span></span><br><span class="line"><span class="meta">		@Result(column = &quot;name&quot;, property = &quot;name&quot;), </span></span><br><span class="line"><span class="meta">		@Result(column = &quot;description&quot;, property = &quot;description&quot;), </span></span><br><span class="line"><span class="meta">		@Result(column = &quot;start_date&quot; property = &quot;startDate&quot;), </span></span><br><span class="line"><span class="meta">		@Result(column = &quot;end_date&quot; property = &quot;endDate&quot;) </span></span><br><span class="line"><span class="meta">	&#125;)</span> </span><br><span class="line">	<span class="function">List&lt;Course&gt; <span class="title">findCoursesByTutorId</span><span class="params">(<span class="keyword">int</span> tutorId)</span></span>; </span><br><span class="line"></span><br><span class="line">	<span class="meta">@Select(&quot;SELECT tutor_id, name as tutor_name, email, addr_id </span></span><br><span class="line"><span class="meta">			FROM tutors where tutor_id=#&#123;tutorId&#125;&quot;)</span> </span><br><span class="line">	<span class="meta">@Results( </span></span><br><span class="line"><span class="meta">	&#123; </span></span><br><span class="line"><span class="meta">		@Result(id = true, column = &quot;tutor_id&quot;, property = &quot;tutorId&quot;), </span></span><br><span class="line"><span class="meta">		@Result(column = &quot;tutor_name&quot;, property = &quot;name&quot;), </span></span><br><span class="line"><span class="meta">		@Result(column = &quot;email&quot;, property = &quot;email&quot;), </span></span><br><span class="line"><span class="meta">		@Result(property = &quot;address&quot;, column = &quot;addr_id&quot;, </span></span><br><span class="line"><span class="meta">		one = @One(select = &quot;com.briup.mappers.TutorMapper.findAddressById&quot;)), </span></span><br><span class="line"><span class="meta">		@Result(property = &quot;courses&quot;, column = &quot;tutor_id&quot;, </span></span><br><span class="line"><span class="meta">		many = @Many(select = &quot;com.briup.mappers.TutorMapper.findCoursesByTutorId&quot;)) </span></span><br><span class="line"><span class="meta">	&#125;)</span> </span><br><span class="line">	<span class="function">Tutor <span class="title">findTutorById</span><span class="params">(<span class="keyword">int</span> tutorId)</span></span>; </span><br><span class="line">&#125; </span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<p> 这里使用了<code>@Many</code>注解的select属性来指向一个方法，该方法将返回一个<code>List&lt;Course&gt;</code>对象。</p>
<p>使用column=”tutor_id”，TUTORS表中的tutor_id列值将会作为输入参数传递给findCoursesByTutorId()方法。 </p>
<p>之前可以通过基于XML的映射配置，使用嵌套结果ResultMap来加载一对N关联的查询。而MyBatis当前版本，并没有对应的注解支持。</p>
<p>但是可以在映射文件中把1对N的嵌套结果形式的映射信息配置好，然后在<code>@ResultMap</code>注解中去引用它。</p>
<p>例如，在TutorMapper.xml中配置<code>&lt;resultMap&gt;</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.briup.mappers.Tutor Mapper&quot;</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Address&quot;</span> <span class="attr">id</span>=<span class="string">&quot;AddressResult&quot;</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;addrId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;addr_id&quot;</span> /&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;street&quot;</span> <span class="attr">column</span>=<span class="string">&quot;street&quot;</span> /&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;city&quot;</span> <span class="attr">column</span>=<span class="string">&quot;city&quot;</span> /&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;state&quot;</span> <span class="attr">column</span>=<span class="string">&quot;state&quot;</span> /&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;zip&quot;</span> <span class="attr">column</span>=<span class="string">&quot;zip&quot;</span> /&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;country&quot;</span> <span class="attr">column</span>=<span class="string">&quot;country&quot;</span> /&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Course&quot;</span> <span class="attr">id</span>=<span class="string">&quot;CourseResult&quot;</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;course_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;course Id&quot;</span> /&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> /&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;description&quot;</span> <span class="attr">property</span>=<span class="string">&quot;description&quot;</span> /&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;start_date&quot;</span> <span class="attr">property</span>=<span class="string">&quot;startDate&quot;</span> /&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;end_date&quot;</span> <span class="attr">property</span>=<span class="string">&quot;endDate&quot;</span> /&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;Tutor&quot;</span> <span class="attr">id</span>=<span class="string">&quot;TutorResult&quot;</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;tutor_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;tutorId&quot;</span> /&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;tutor_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> /&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> /&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;address&quot;</span> <span class="attr">result</span> <span class="attr">Map</span>=<span class="string">&quot;AddressResult&quot;</span> /&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;courses&quot;</span> <span class="attr">result</span> <span class="attr">Map</span>=<span class="string">&quot;CourseResult&quot;</span> /&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TutorMapper</span></span>&#123; </span><br><span class="line">	<span class="meta">@Select(&quot;select t.tutor_id, t.name as tutor_name,email,a.addr_id, street, city, state, zip, country, course_id, c.name,description, start_date, end_date  from tutors t left outer join addresses a on t.addr_id=a.addr_id left outer join courses c on t.tutor_id=c.tutor_id where t.tutor_id=#&#123;tutorId&#125;&quot;)</span> </span><br><span class="line">	<span class="meta">@ResultMap(&quot;com.briup.mappers.TutorMapper.TutorResult&quot;)</span> </span><br><span class="line">	<span class="function">Tutor <span class="title">selectTutorById</span><span class="params">(<span class="keyword">int</span> tutorId)</span></span>; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

















 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/briup/" rel="tag">briup</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-briup/briup-ajax"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/archives/briup/briup-ajax.html"
    >briup-ajax</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/archives/briup/briup-ajax.html" class="article-date">
  <time datetime="2022-05-22T08:06:13.000Z" itemprop="datePublished">2022-05-22</time>
</a>    
    </div>
     
	
	 
	
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="ajax-jquery"><a href="#ajax-jquery" class="headerlink" title="ajax-jquery"></a>ajax-jquery</h1><h2 id="1-同步请求"><a href="#1-同步请求" class="headerlink" title="1 同步请求"></a>1 同步请求</h2><p>传统的应用中，浏览器发出的请求，一般都是同步请求，浏览器需要等待这个请求发出之后，服务器端的响应，浏览器接收到响应后，解析本次内容，再显示出来。</p>
<p>如果服务器响应时间过长，那么在这个期间，客户端浏览器只能等待着。</p>
<p>并且响应回来后，需要重新刷新和加载整个页面。</p>
<p>例如</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;</span><br><span class="line">    pageEncoding=&quot;UTF-8&quot;%&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>index<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">h1</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/test?username=tom&quot;</span>&gt;</span>同步请求测试<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;d1&quot;</span>&gt;</span>$&#123;msg &#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/test&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		String username = req.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Thread.sleep(<span class="number">1000</span>*<span class="number">10</span>);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		req.setAttribute(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;hello!&quot;</span>+username);</span><br><span class="line">		String path = <span class="string">&quot;/index.jsp&quot;</span>;</span><br><span class="line">		req.getRequestDispatcher(path).forward(req, resp);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>注意，tomcat中默认请求的超时时间是20秒，<code>connectionTimeout=&quot;20000&quot;</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">URIEncoding</span>=<span class="string">&quot;UTF-8&quot;</span> <span class="attr">connectionTimeout</span>=<span class="string">&quot;20000&quot;</span> <span class="attr">port</span>=<span class="string">&quot;8989&quot;</span> <span class="attr">protocol</span>=<span class="string">&quot;HTTP/1.1&quot;</span> <span class="attr">redirectPort</span>=<span class="string">&quot;8443&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>



<blockquote>
<p>可以看出，在响应回来之前，客户端只能等待着，那么这个过程是比较影响用户体验的</p>
</blockquote>
<blockquote>
<p>观察同步请求返回的响应内容，可以看出，该响应把整个页面的内容又发送了回来</p>
</blockquote>
<p>==同步请求存在的问题==</p>
<ul>
<li>网速慢的情况下，页面加载时间长，用户只能等待</li>
<li>表单提交后，如果一项内容不合格，需要重新填写所有表单内容</li>
<li>页面跳转，重新加载页面，造成资源浪费，增加用户等待时间</li>
</ul>
<h2 id="2-异步请求"><a href="#2-异步请求" class="headerlink" title="2 异步请求"></a>2 异步请求</h2><blockquote>
<p>异步请求，可以解决上述同步请求中，所遇到的问题</p>
</blockquote>
<p>AJAX（Asynchronous JavaScript And XML），异步的 JavaScript 和 XML。</p>
<p>它不是一门新的技术或者语言，它是把已经有的几种技术，结合在一起，出现的一种新的用法，至少在当时刚出现的时候是一种新的用法，但是现在ajax的应用已经相当成熟了。</p>
<p>同步请求是请求发送后，等待服务器响应回来，响应中带着当前要显示的新的页面内容（完整页面内容），然后浏览器接收响应，并且加载刷新整个页面，最后显示出一个新的页面。</p>
<p>ajax发出的异步请求，不需要等待服务器的响应，页面中可以继续完成其他工作，等响应回来后，会自动调用ajax中设置好的函数（回调函数），函数中接收响应中的数据（少量数据），并把数据更新到页面中（局部刷新）。</p>
<p>在整个异步请求的过程中，用户感受不到请求的发送，并且整个页面中也只有局部地方的数据有刷新，其他内容不变，用户的体验较好。</p>
<p>异步请求的特点：（八个字）</p>
<ul>
<li>异步交互</li>
<li>局部刷新</li>
</ul>
<p>例如，一个典型的场景，用户注册</p>
<p>如果是同步请求，需要用户填写完表单中的所有选项，然后点击注册，将数据发送给服务器，然后客户端等待服务器端的响应，如果这次响应回来，提示用户名已经被占用，需要换个名字重新注册，此时可以想象用户的内心感受。。。</p>
<p>如果是异步请求，当用户填写完第一项用户名的时候，就可以“偷偷”的发送异步请求，将用户名发送给服务器端验证，看是否可用，如果可用输入框后面可以提示出“该用户名可用”，如果不可用，输入框后提示“该用户名不可用”，此时就可以大大提高用户的使用体验。</p>
<p>==思考，还有哪些常见的场景中，会“偷偷”的发出异步请求？==</p>
<h2 id="3-XMLHttpRequest"><a href="#3-XMLHttpRequest" class="headerlink" title="3 XMLHttpRequest"></a>3 XMLHttpRequest</h2><p>能够完成异步请求的发送，完全依赖于一个核心的对象：<code>XMLHttpRequest</code></p>
<p>XMLHttpRequest最早在IE5中以ActiveX对象的形式实现的。现在，FireFox、Safari、Opera、Konqueror和IE都实现了XMLHttpRequest对象的行为。</p>
<p>XMLHttpRequest不是一个W3C的标准，所以可以采用多种方法来创建XMLHttpRequest的对象，IE把XMLHttpRequest实现为一个ActiveX的对象，而其它浏览器将它实现为一个本地的JavaScript对象。</p>
<p>如果浏览器支持ActiveX对象，就可以使用ActiveX来创建XMLHttpRequest对象，否则就要使用本地JavaScript对象技术来创建该对象。</p>
<p>例如，创建XMLHttpRequest对象</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">	</span></span><br><span class="line"><span class="javascript">	<span class="keyword">var</span> xmlHttp;</span></span><br><span class="line"><span class="javascript">    </span></span><br><span class="line"><span class="javascript">    <span class="comment">//创建XMLHttpRequest对象</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">//本地浏览器是否支持ActiveX对象，返回对象为true，返回null为false</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">if</span>(<span class="built_in">window</span>.ActiveXObject)&#123; </span></span><br><span class="line"><span class="javascript">        xmlHttp = <span class="keyword">new</span> ActiveXObject(<span class="string">&quot;Microsoft.XMLHTTP&quot;</span>);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">    <span class="comment">//本地浏览器是否支持XMLHttpRequest对象</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">window</span>.XMLHttpRequest)&#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">//作为一个JavaScript对象来创建</span></span></span><br><span class="line"><span class="javascript">        xmlHttp = <span class="keyword">new</span> XMLHttpRequest();</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">	</span></span><br><span class="line"><span class="javascript">	</span></span><br><span class="line"><span class="javascript">	alert(xmlHttp);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="4-使用ajax"><a href="#4-使用ajax" class="headerlink" title="4 使用ajax"></a>4 使用ajax</h2><p>JavaScript中，有了XMLHttpRequest对象后，就可以发送异步请求了。</p>
<p>例如，</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;</span><br><span class="line">    pageEncoding=&quot;UTF-8&quot;%&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>index<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">	<span class="function"><span class="keyword">function</span> <span class="title">createXMLHttpRequest</span>(<span class="params">xmlHttp</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">		<span class="keyword">if</span>(<span class="built_in">window</span>.ActiveXObject)&#123; </span></span><br><span class="line"><span class="javascript">			xmlHttp = <span class="keyword">new</span> ActiveXObject(<span class="string">&quot;Microsoft.XMLHTTP&quot;</span>);</span></span><br><span class="line"><span class="javascript">			</span></span><br><span class="line"><span class="javascript">		&#125;</span></span><br><span class="line"><span class="javascript">		<span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">window</span>.XMLHttpRequest)&#123;</span></span><br><span class="line"><span class="javascript">			xmlHttp = <span class="keyword">new</span> XMLHttpRequest();</span></span><br><span class="line"><span class="javascript">		&#125;</span></span><br><span class="line"><span class="javascript">	&#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">	<span class="function"><span class="keyword">function</span> <span class="title">ajaxRequest</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">		<span class="keyword">var</span> xmlHttp;</span></span><br><span class="line"><span class="javascript">		</span></span><br><span class="line"><span class="javascript">		<span class="comment">//1 创建核心对象</span></span></span><br><span class="line"><span class="javascript">		<span class="keyword">if</span>(<span class="built_in">window</span>.ActiveXObject)&#123; </span></span><br><span class="line"><span class="javascript">			xmlHttp = <span class="keyword">new</span> ActiveXObject(<span class="string">&quot;Microsoft.XMLHTTP&quot;</span>);</span></span><br><span class="line"><span class="javascript">		&#125;</span></span><br><span class="line"><span class="javascript">		<span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">window</span>.XMLHttpRequest)&#123;</span></span><br><span class="line"><span class="javascript">			xmlHttp = <span class="keyword">new</span> XMLHttpRequest();</span></span><br><span class="line"><span class="javascript">		&#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">		<span class="comment">//2 建立连接</span></span></span><br><span class="line"><span class="javascript">		<span class="comment">//参数1 请求方式</span></span></span><br><span class="line"><span class="javascript">		<span class="comment">//参数2 请求的URL</span></span></span><br><span class="line"><span class="javascript">		<span class="comment">//参数3 是否是异步请求</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 注意:参数不能为空,后台在write(username)</span></span></span><br><span class="line"><span class="javascript">		xmlHttp.open(<span class="string">&quot;GET&quot;</span>,<span class="string">&quot;/ajax-test?username=mary&quot;</span>,<span class="literal">true</span>);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">		<span class="comment">//3 发送请求</span></span></span><br><span class="line"><span class="javascript">		xmlHttp.send();</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">		<span class="comment">//4 指定回调函数，接受并处理来自服务器的响应结果</span></span></span><br><span class="line"><span class="javascript">		xmlHttp.onreadystatechange=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">			<span class="comment">//判断readyState就绪状态是否为4</span></span></span><br><span class="line"><span class="javascript">			<span class="comment">//判断status响应状态码是否为200</span></span></span><br><span class="line"><span class="javascript">	        <span class="keyword">if</span> (xmlHttp.readyState==<span class="number">4</span> &amp;&amp; xmlHttp.status==<span class="number">200</span>)&#123;</span></span><br><span class="line"><span class="javascript">	           <span class="comment">//获取服务器的响应结果</span></span></span><br><span class="line"><span class="javascript">	            <span class="keyword">var</span> responseText = xmlHttp.responseText;</span></span><br><span class="line"><span class="javascript">	            <span class="comment">//alert(responseText);</span></span></span><br><span class="line"><span class="javascript">	            <span class="keyword">var</span> div = <span class="built_in">document</span>.getElementById(<span class="string">&quot;d2&quot;</span>);</span></span><br><span class="line"><span class="javascript">	            div.innerHTML = responseText;</span></span><br><span class="line"><span class="javascript">	        &#125;</span></span><br><span class="line"><span class="javascript">		&#125;;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">	&#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">h1</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/test?username=tom&quot;</span>&gt;</span>同步请求测试<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0);&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;ajaxRequest()&quot;</span>&gt;</span>异步请求测试<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;d1&quot;</span>&gt;</span>$&#123;msg &#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;d2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意: 此时参数不能为空,后台在write</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/ajax-test&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AjaxTestServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		String username = req.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Thread.sleep(<span class="number">1000</span>*<span class="number">10</span>);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		resp.setContentType(<span class="string">&quot;text/plain;charset=utf-8&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		PrintWriter out = resp.getWriter();</span><br><span class="line">		</span><br><span class="line">		out.println(<span class="string">&quot;hello! &quot;</span>+username);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>同步为请求转发html,异步为写回局部数据</code></p>
<blockquote>
<p>观察同步请求返回的响应内容，可以看出该响应只把少量的数据返回了（hello! mary）,然后ajax的回调函数中把该内容局部刷到了页面的div里面</p>
</blockquote>
<blockquote>
<p>感受ajax发异步请求的特点：异步交互、局部刷新</p>
</blockquote>
<h2 id="5-jquery"><a href="#5-jquery" class="headerlink" title="5 jquery"></a>5 jquery</h2><blockquote>
<p>使用ajax的原生代码，完成异步交互还是比较繁琐的，通常会使用一些对JS封装的库中的函数完成</p>
</blockquote>
<h3 id="5-1-概述"><a href="#5-1-概述" class="headerlink" title="5.1 概述"></a>5.1 概述</h3><p>jquery是对js封装的一个库，也是一个js文件，使用的时候，只需要将jquery文件引入到当前页面中即可。</p>
<p>jquery的版本众多，不同版本中的函数稍有差异，这里我们使用的是1.8.3版本。</p>
<p>1、可以将jquery文件存放到项目中，然后再引入到页面中：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;</span><br><span class="line">    pageEncoding=&quot;UTF-8&quot;%&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>test<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/jquery/jquery-1.8.3.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，jquery可以在jsp页面中使用，也可以在html静态页面中使用，效果是一样的</p>
</blockquote>
<p>2、可以使用网络中公开的连接地址</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;</span><br><span class="line">    pageEncoding=&quot;UTF-8&quot;%&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>test<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcdn.net/ajax/libs/jquery/1.8.3/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>例如，使用 <a target="_blank" rel="noopener" href="https://www.bootcdn.cn/">https://www.bootcdn.cn/</a> 中的jquery地址</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/ajax/202205221608648.png" alt="image-20201008232743892"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/ajax/202205221608311.png" alt="image-20201008232806009"></p>
<p><img src="image/image-20201008232822183.png" alt="image-20201008232822183"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/ajax/202205221608972.png" alt="image-20201008232842734"></p>
<blockquote>
<p>类似的，如果将来要使用其他的js库，也可以在这里查找</p>
</blockquote>
<h3 id="5-2-加载"><a href="#5-2-加载" class="headerlink" title="5.2 加载"></a>5.2 加载</h3><blockquote>
<p>一般情况下，需要让浏览器先加载完整个页面的html元素后，在执行js或jquery代码，因为这样代码中才能操作指定的元素</p>
</blockquote>
<p>由于浏览器解析页面，是从上往下，依次解析，所以我们一般希望的是，先加载完所有的html标签元素，然后再执行js代码，这样就可以在js中获取已经加载的html标签元素了。</p>
<p>之前在js代码中，可以这样来实现该效果：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.getElementById(<span class="string">&quot;div&quot;</span>)</span></span><br><span class="line"><span class="javascript">            <span class="comment">//给window对象的onload事件绑定一个匿名函数</span></span></span><br><span class="line"><span class="javascript">            <span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="comment">// js代码，操作页面元素</span></span></span><br><span class="line"><span class="javascript">                <span class="built_in">document</span>.getElementById(<span class="string">&quot;div&quot;</span>)</span></span><br><span class="line"><span class="javascript">            &#125;;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        .....</span><br><span class="line">        .....<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div&quot;</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        .....</span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>该js代码表示，当window对象加载完毕之后，再执行匿名函数中的js代码</p>
<p>window对象加载完毕就表示整个html页面元素都加载完毕了</p>
</blockquote>
<p>在引入jquery后，也有对应的解决方案，其效果和以上js代码是一样的</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcdn.net/ajax/libs/jquery/1.8.3/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">            $(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="comment">//jquery代码，操作页面元素</span></span></span><br><span class="line"><span class="javascript">            &#125;);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        .....</span><br><span class="line">        .....</span><br><span class="line">        .....</span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，$是jQuery的一个简写形式，表示调用jquery中的函数</p>
</blockquote>
<p>这个代码可以简写为：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcdn.net/ajax/libs/jquery/1.8.3/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">            <span class="comment">//$();</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">//$(function()&#123;&#125;);</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">//将上面大括号展开即可</span></span></span><br><span class="line"><span class="javascript">            </span></span><br><span class="line"><span class="javascript">            $(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">               <span class="comment">//jquery代码，操作页面元素</span></span></span><br><span class="line"><span class="javascript">            &#125;);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>思考: js对象和jq对象的关系</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$(function() &#123;</span><br><span class="line">		var divEle = $(&quot;#d&quot;);</span><br><span class="line">		// console.log(divEle);</span><br><span class="line">		divEle.html(&quot;jq&quot;);</span><br><span class="line">		var divJS = divEle[0];</span><br><span class="line">		// console.log(divJS);</span><br><span class="line">		divJS.innerHTML = &quot;js&quot;;</span><br><span class="line">		var divJQ = $(divJS);</span><br><span class="line">		console.log(divJQ);</span><br><span class="line">	&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li>js-&gt;jq  <code>$(js)​</code></li>
<li>jq-&gt;js  <code>jq[0]</code></li>
</ul>
<h3 id="5-3-使用"><a href="#5-3-使用" class="headerlink" title="5.3 使用"></a>5.3 使用</h3><p>jquery极大的简化了js中对html元素的dom操作，jquery倡导的理念是：write less,do more</p>
<p>例如，</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;</span><br><span class="line">    pageEncoding=&quot;UTF-8&quot;%&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>test<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/jquery/jquery-1.8.3.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="comment">//页面加载完毕后，再执行jquery代码</span></span></span><br><span class="line"><span class="javascript">	$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">		<span class="comment">//给btn1按钮添加点击事件</span></span></span><br><span class="line"><span class="javascript">		$(<span class="string">&quot;#btn1&quot;</span>).on(<span class="string">&quot;click&quot;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">			<span class="comment">//点击触发事件后，给div添加内容，并且设置其css的样式</span></span></span><br><span class="line"><span class="javascript">			$(<span class="string">&quot;#dd&quot;</span>).html(<span class="string">&quot;hello world&quot;</span>).css(&#123;<span class="attr">width</span>:<span class="string">&quot;100px&quot;</span>,<span class="attr">height</span>:<span class="string">&quot;100px&quot;</span>,<span class="attr">border</span>:<span class="string">&quot;1px solid red&quot;</span>&#125;);</span></span><br><span class="line"><span class="javascript">		&#125;);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">		<span class="comment">//给btn2按钮添加点击事件</span></span></span><br><span class="line"><span class="javascript">		$(<span class="string">&quot;#btn2&quot;</span>).on(<span class="string">&quot;click&quot;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">			<span class="comment">//点击触发事件后，让div隐藏起来，并且使用动画效果</span></span></span><br><span class="line"><span class="javascript">			$(<span class="string">&quot;#dd&quot;</span>).slideUp();</span></span><br><span class="line"><span class="javascript">		&#125;);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">		<span class="comment">//给btn3按钮添加点击事件</span></span></span><br><span class="line"><span class="javascript">		$(<span class="string">&quot;#btn3&quot;</span>).on(<span class="string">&quot;click&quot;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">			<span class="comment">//点击触发事件后，让div显示出来，并且使用动画效果</span></span></span><br><span class="line"><span class="javascript">			$(<span class="string">&quot;#dd&quot;</span>).slideDown();</span></span><br><span class="line"><span class="javascript">		&#125;);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">	&#125;);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;btn1&quot;</span>&gt;</span>测试<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;btn2&quot;</span>&gt;</span>隐藏<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;btn3&quot;</span>&gt;</span>显示<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;dd&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>更多的操作，可以查看jquery1.8的api文档</p>
<p><a target="_blank" rel="noopener" href="http://t.mb5u.com/jquery/">jquery1.8在线API文档</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/mybatis/202205221652499.png" alt="image-20201008235649562"></p>
<blockquote>
<p>API文档中，有大量详细的案例，基本查看后即可使用</p>
</blockquote>
<h3 id="5-4-ajax"><a href="#5-4-ajax" class="headerlink" title="5.4 ajax"></a>5.4 ajax</h3><blockquote>
<p>jquery同样的对ajax代码也进行封装，让我们在页面中发送ajax请求变的更加简单，这也是我们在ajax中介绍并使用jquery的原因</p>
</blockquote>
<p>例如，修改AjaxTestServlet代码，重写doPost方法，doPost方法中调用doGet方法，这样不管是get请求还是post请求，都可以使用同样的代码来处理。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/ajax-test&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AjaxTestServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		</span><br><span class="line">		String username = req.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		resp.setContentType(<span class="string">&quot;text/plain;charset=utf-8&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		PrintWriter out = resp.getWriter();</span><br><span class="line">		</span><br><span class="line">		out.println(<span class="string">&quot;hello! &quot;</span>+username);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		doGet(req,resp);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>官网配置</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      $(<span class="string">&quot;#b01&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      htmlobj=$.ajax(&#123;<span class="attr">url</span>:<span class="string">&quot;/jquery/test1.txt&quot;</span>,<span class="attr">async</span>:<span class="literal">false</span>&#125;);</span><br><span class="line">      $(<span class="string">&quot;#myDiv&quot;</span>).html(htmlobj.responseText);</span><br><span class="line">      &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>





<p>使用jquery中封装的ajax函数，发送GET请求：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;</span><br><span class="line">    pageEncoding=&quot;UTF-8&quot;%&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>test<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/jquery/jquery-1.8.3.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">	$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">		$(<span class="string">&quot;#btn&quot;</span>).on(<span class="string">&quot;click&quot;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">			$.ajax(&#123;</span></span><br><span class="line"><span class="javascript">				<span class="attr">type</span>: <span class="string">&quot;GET&quot;</span>,</span></span><br><span class="line"><span class="javascript">				<span class="attr">url</span>: <span class="string">&quot;/ajax-test?username=mary&quot;</span>,</span></span><br><span class="line"><span class="javascript">				<span class="attr">dataType</span>: <span class="string">&quot;text&quot;</span>,</span></span><br><span class="line"><span class="javascript">				<span class="attr">success</span>: <span class="function"><span class="keyword">function</span>(<span class="params">result</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">					$(<span class="string">&quot;#dd&quot;</span>).html(result);</span></span><br><span class="line"><span class="javascript">                    <span class="comment">//$(&quot;#dd&quot;).html(result).css(&#123;width:&quot;100px&quot;,height:&quot;100px&quot;,border:&quot;1px solid red&quot;&#125;).hide().slideDown(4000,function()&#123;alert(&quot;加载完毕&quot;)&#125;);</span></span></span><br><span class="line"><span class="javascript">				&#125;</span></span><br><span class="line"><span class="javascript">			&#125;);</span></span><br><span class="line"><span class="javascript">			</span></span><br><span class="line"><span class="javascript">		&#125;);	</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">	&#125;);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;btn&quot;</span>&gt;</span>异步请求测试<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;dd&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这里的<code>dataType</code>属性，表示当前ajax请求，希望服务器返回的响应中的数据为text文本类型</p>
</blockquote>
<p><img src="image/image-20201009001943945.png" alt="image-20201009001943945"></p>
<p>使用jquery中封装的ajax函数，发送POST请求：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;</span><br><span class="line">    pageEncoding=&quot;UTF-8&quot;%&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>test<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/jquery/jquery-1.8.3.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">	$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">		$(<span class="string">&quot;#btn&quot;</span>).on(<span class="string">&quot;click&quot;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">			$.ajax(&#123;</span></span><br><span class="line"><span class="javascript">				<span class="attr">type</span>: <span class="string">&quot;POST&quot;</span>,</span></span><br><span class="line"><span class="javascript">				<span class="attr">url</span>: <span class="string">&quot;/ajax-test&quot;</span>,</span></span><br><span class="line"><span class="javascript">				<span class="comment">//data: &quot;username=lucy&quot;,</span></span></span><br><span class="line"><span class="javascript">             <span class="attr">data</span>: &#123;<span class="string">&quot;username&quot;</span>:<span class="string">&quot;jack&quot;</span>&#125;,</span></span><br><span class="line"><span class="javascript">				<span class="attr">dataType</span>: <span class="string">&quot;text&quot;</span>,</span></span><br><span class="line"><span class="javascript">				<span class="attr">success</span>: <span class="function"><span class="keyword">function</span>(<span class="params">result</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">					$(<span class="string">&quot;#dd&quot;</span>).html(result);</span></span><br><span class="line"><span class="javascript">                    <span class="comment">//$(&quot;#dd&quot;).html(result).css(&#123;width:&quot;100px&quot;,height:&quot;100px&quot;,border:&quot;1px solid red&quot;&#125;).hide().slideDown(4000,function()&#123;alert(&quot;加载完毕&quot;)&#125;);</span></span></span><br><span class="line"><span class="javascript">				&#125;</span></span><br><span class="line"><span class="javascript">			&#125;);</span></span><br><span class="line"><span class="javascript">			</span></span><br><span class="line"><span class="javascript">		&#125;);		</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">	&#125;);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;btn&quot;</span>&gt;</span>异步请求测试<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;dd&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，<code>data</code>属性，用来指定本次POST请求中所携带的数据，另外如果是GET请求，也可以使用该属性来指定携带的数据，它会自动将数据添加到请求的URI后面的</p>
<p>此处post和get传参没有明确区分</p>
</blockquote>
<h3 id="5-5-get"><a href="#5-5-get" class="headerlink" title="5.5 get"></a>5.5 get</h3><blockquote>
<p>jquery中，专门封装了get函数，用来简化ajax中的get请求的发送</p>
</blockquote>
<p>例如，</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;</span><br><span class="line">    pageEncoding=&quot;UTF-8&quot;%&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>test<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/jquery/jquery-1.8.3.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">	$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">		$(<span class="string">&quot;#btn&quot;</span>).on(<span class="string">&quot;click&quot;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">			</span></span><br><span class="line"><span class="javascript">            <span class="comment">//第二个参数，也可以写成 &quot;username=tom&quot; 或者 &#123;username:&quot;tom&quot;&#125;</span></span></span><br><span class="line"><span class="javascript">			$.get(<span class="string">&quot;/ajax-test&quot;</span>,&#123;<span class="attr">username</span>:<span class="string">&quot;tom&quot;</span>&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">result</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">				$(<span class="string">&quot;#dd&quot;</span>).html(result);</span></span><br><span class="line"><span class="javascript">				</span></span><br><span class="line"><span class="javascript">			&#125;,<span class="string">&quot;text&quot;</span>);</span></span><br><span class="line"><span class="javascript">			</span></span><br><span class="line"><span class="javascript">		&#125;);</span></span><br><span class="line"><span class="javascript">        </span></span><br><span class="line"><span class="javascript">        </span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">		</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">	&#125;);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;btn&quot;</span>&gt;</span>异步请求测试<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;dd&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>其中，get函数的四个参数分别为：</p>
<p><img src="image/image-20201009002944254.png" alt="image-20201009002944254"></p>
<blockquote>
<p>注意，除了第一个参数url地址后，后面三个参数都是可以不写的</p>
</blockquote>
<h3 id="5-6-post"><a href="#5-6-post" class="headerlink" title="5.6 post"></a>5.6 post</h3><blockquote>
<p>jquery中，专门封装了post函数，用来简化ajax中的post请求的发送</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;</span><br><span class="line">    pageEncoding=&quot;UTF-8&quot;%&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>test<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/jquery/jquery-1.8.3.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">	$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">		$(<span class="string">&quot;#btn&quot;</span>).on(<span class="string">&quot;click&quot;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">			</span></span><br><span class="line"><span class="javascript">            <span class="comment">//第二个参数，也可以写成 &quot;username=briup&quot; 或者 &#123;username:&quot;briup&quot;&#125;</span></span></span><br><span class="line"><span class="javascript">			$.post(<span class="string">&quot;/ajax-test&quot;</span>,&#123;<span class="attr">username</span>:<span class="string">&quot;briup&quot;</span>&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">result</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">				$(<span class="string">&quot;#dd&quot;</span>).html(result);</span></span><br><span class="line"><span class="javascript">				</span></span><br><span class="line"><span class="javascript">			&#125;,<span class="string">&quot;text&quot;</span>);</span></span><br><span class="line"><span class="javascript">			</span></span><br><span class="line"><span class="javascript">		&#125;);		</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">	&#125;);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;btn&quot;</span>&gt;</span>异步请求测试<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;dd&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>可以看出，post函数的用法和get函数是一样的，参数个数、顺序、类型都是相同的</p>
</blockquote>
<h2 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h2><p><strong>CheckServlet</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/checkServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CheckServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		<span class="comment">//模拟数据库数据</span></span><br><span class="line">		List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">		list.add(<span class="string">&quot;tom&quot;</span>);</span><br><span class="line">		list.add(<span class="string">&quot;lucy&quot;</span>);</span><br><span class="line">		list.add(<span class="string">&quot;jack&quot;</span>);</span><br><span class="line">		<span class="comment">//ajax携带用户名 校验</span></span><br><span class="line">		String username = req.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">		<span class="comment">//根据输入的用户名 比对数据</span></span><br><span class="line">		resp.setContentType(<span class="string">&quot;text/plain;charset=utf-8&quot;</span>);</span><br><span class="line">		<span class="keyword">if</span>(list.contains(username)) &#123;</span><br><span class="line">			<span class="comment">//如果存在,返回提示信息</span></span><br><span class="line">			resp.getWriter().write(<span class="string">&quot;&lt;font color=&#x27;red&#x27;&gt;用户名已经存在&lt;/font&gt;&quot;</span>);</span><br><span class="line">		&#125;	</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>login.html</strong></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> contentType=<span class="string">&quot;text/html; charset=UTF-8&quot;</span></span><br><span class="line">	pageEncoding=<span class="string">&quot;UTF-8&quot;</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">&lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span> src=<span class="string">&quot;/jq/jquery-1.8.3.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">	<span class="function">function <span class="title">check</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 发送ajax请求 ,校验用户名</span></span><br><span class="line">		<span class="keyword">var</span> value = $(<span class="string">&quot;#username&quot;</span>).val();</span><br><span class="line">		<span class="comment">//alert(value);</span></span><br><span class="line">		$.get(<span class="string">&quot;/check&quot;</span>, &#123;</span><br><span class="line">			<span class="string">&quot;username&quot;</span> : value</span><br><span class="line">		&#125;, function(result) &#123;</span><br><span class="line">			<span class="comment">//alert(result);</span></span><br><span class="line">			$(<span class="string">&quot;#tip&quot;</span>).html(result);</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;form action=<span class="string">&quot;/login&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">		用户名 &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;username&quot;</span> onblur=<span class="string">&quot;check();&quot;</span> id=<span class="string">&quot;username&quot;</span>&gt;</span><br><span class="line">		&lt;span id=<span class="string">&quot;tip&quot;</span>&gt;&lt;/span&gt;&lt;br&gt; 密码: &lt;input type=<span class="string">&quot;password&quot;</span></span><br><span class="line">			name=<span class="string">&quot;password&quot;</span>&gt;&lt;br&gt; &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;注册&quot;</span>&gt;</span><br><span class="line">	&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>







<p>json格式</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/jquery-1.8.3.min.js&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">checkName</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> value = $(<span class="string">&quot;#username&quot;</span>).val();</span></span><br><span class="line"><span class="javascript">        $.get(<span class="string">&quot;checkName&quot;</span>,&#123;<span class="string">&quot;username&quot;</span>:value&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(data);</span></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;#usernameTip&quot;</span>).text(data.tip).hide().css(&#123;<span class="string">&quot;color&quot;</span>:data.color&#125;).slideDown(<span class="number">2000</span>).slideUp(<span class="number">1000</span>);</span></span><br><span class="line"><span class="javascript">        &#125;,<span class="string">&quot;json&quot;</span>);</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;#&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">id</span> = <span class="string">&quot;username&quot;</span> <span class="attr">onblur</span>=<span class="string">&quot;checkName()&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;usernameTip&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span>  <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;注册&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: vanse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/10/18-10-18-13:55</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>：com.briup.web.servlet</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>：1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/checkName&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CheckName</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        list.add(<span class="string">&quot;tom&quot;</span>);</span><br><span class="line">        list.add(<span class="string">&quot;lucy&quot;</span>);</span><br><span class="line">        list.add(<span class="string">&quot;jack&quot;</span>);</span><br><span class="line">        String username = req.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        <span class="comment">// resp.setContentType(&quot;text/plain;charset=utf-8&quot;);</span></span><br><span class="line">        resp.setContentType(<span class="string">&quot;application/json;charset=utf-8&quot;</span>);</span><br><span class="line">        resp.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        String msg = <span class="string">&quot;  &#123;\&quot;tip\&quot;:\&quot;用户名已经存在\&quot;,\&quot;color\&quot;:\&quot;red\&quot;&#125; &quot;</span>;</span><br><span class="line">        String msg2 = <span class="string">&quot;  &#123;\&quot;tip\&quot;:\&quot;可以注册\&quot;,\&quot;color\&quot;:\&quot;green\&quot;&#125; &quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(list.contains(username))&#123;</span><br><span class="line">            resp.getWriter().write(msg);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            resp.getWriter().write(msg2);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/briup/" rel="tag">briup</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-briup/briup-jsp"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/archives/briup/briup-jsp.html"
    >briup-jsp</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/archives/briup/briup-jsp.html" class="article-date">
  <time datetime="2022-05-15T16:55:10.000Z" itemprop="datePublished">2022-05-16</time>
</a>    
    </div>
     
	
	 
	
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="jsp"><a href="#jsp" class="headerlink" title="jsp"></a>jsp</h1><h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1 概述"></a>1 概述</h2><blockquote>
<p>jsp全称Java Server Pages，是一种动态网页开发技术</p>
</blockquote>
<p>.html文件是静态页面<br>.jsp 文件是动态页面</p>
<p>jsp页面允许我们在html代码中嵌入java代码，这样就可以在html中使用java代码来完成的功能了。</p>
<p>所以，简单的理解：jsp就是html页面+java代码</p>
<p>例如，</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> contentType=<span class="string">&quot;text/html; charset=UTF-8&quot;</span></span><br><span class="line">    pageEncoding=<span class="string">&quot;UTF-8&quot;</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">&lt;title&gt;index.html&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;% String name = <span class="string">&quot;tom&quot;</span>; %&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;h1&gt;&lt;%=<span class="string">&quot;hello!&quot;</span>+name %&gt;&lt;/h1&gt;</span><br><span class="line">	</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>





<h2 id="2-运行"><a href="#2-运行" class="headerlink" title="2 运行"></a>2 运行</h2><p>浏览器可以直接运行html页面，但是不能直接运行jsp页面。</p>
<p>jsp是需要在web容器中运行（例如tomcat中），因为web容器中有JSP的运行环境。</p>
<p>其中最核心的是有JSP的引擎（jasper.jar）,它可以将jsp页面翻译成java程序，并编译成class文件，然后在运行。</p>
<p>所以jsp是运行在服务器端的，运行完之后，把动态生成的html页面再使用io流写回给浏览器，浏览器接收并且解析后再呈现出来效果。</p>
<h2 id="3-关系"><a href="#3-关系" class="headerlink" title="3 关系"></a>3 关系</h2><p>JSP和Servlet的关系：JSP本质上也是Servlet。</p>
<p>因为JSP页面第一次被访问的时，会被tomcat服务器编译成一个java类，这个java类默认继承<code>HttpJspBase</code>类，而<code>HttpJspBase</code>类是<code>HttpServlet</code>的子类，所以JSP其实就是一个Servlet程序。</p>
<p>这也是为什么JSP程序和Servlet一样，都需要运行在Web容器中。</p>
<p>jsp页面被tomcat服务器编译成的java文件及其class文件，保存在tomcat服务器里面的work目录中，在这里的代码中，我们还可以看见它是如何使用io流把生成的html页面代码一行一行写回给浏览器的。</p>
<blockquote>
<p>注意: 项目路径不要/ 否则生成class文件位置不对</p>
</blockquote>
<p>例如，index.jsp将会翻译成下面的java代码，然后再变成class文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Generated by the Jasper component of Apache Tomcat</span></span><br><span class="line"><span class="comment"> * Version: Apache Tomcat/8.5.58</span></span><br><span class="line"><span class="comment"> * Generated at: 2020-10-07 01:50:21 UTC</span></span><br><span class="line"><span class="comment"> * Note: The last modified time of this file was set to</span></span><br><span class="line"><span class="comment"> *       the last modified time of the source file after</span></span><br><span class="line"><span class="comment"> *       generation to assist with modification tracking.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> org.apache.jsp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.jsp.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">index_jsp</span> <span class="keyword">extends</span> <span class="title">org</span>.<span class="title">apache</span>.<span class="title">jasper</span>.<span class="title">runtime</span>.<span class="title">HttpJspBase</span></span></span><br><span class="line"><span class="class">    <span class="keyword">implements</span> <span class="title">org</span>.<span class="title">apache</span>.<span class="title">jasper</span>.<span class="title">runtime</span>.<span class="title">JspSourceDependent</span>,</span></span><br><span class="line"><span class="class">                 <span class="title">org</span>.<span class="title">apache</span>.<span class="title">jasper</span>.<span class="title">runtime</span>.<span class="title">JspSourceImports</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> javax.servlet.jsp.JspFactory _jspxFactory =</span><br><span class="line">          javax.servlet.jsp.JspFactory.getDefaultFactory();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> java.util.Map&lt;java.lang.String,java.lang.Long&gt; _jspx_dependants;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> java.util.Set&lt;java.lang.String&gt; _jspx_imports_packages;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> java.util.Set&lt;java.lang.String&gt; _jspx_imports_classes;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> &#123;</span><br><span class="line">    _jspx_imports_packages = <span class="keyword">new</span> java.util.HashSet&lt;&gt;();</span><br><span class="line">    _jspx_imports_packages.add(<span class="string">&quot;javax.servlet&quot;</span>);</span><br><span class="line">    _jspx_imports_packages.add(<span class="string">&quot;javax.servlet.http&quot;</span>);</span><br><span class="line">    _jspx_imports_packages.add(<span class="string">&quot;javax.servlet.jsp&quot;</span>);</span><br><span class="line">    _jspx_imports_classes = <span class="keyword">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">volatile</span> javax.el.ExpressionFactory _el_expressionfactory;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">volatile</span> org.apache.tomcat.InstanceManager _jsp_instancemanager;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> java.util.Map&lt;java.lang.String,java.lang.Long&gt; getDependants() &#123;</span><br><span class="line">    <span class="keyword">return</span> _jspx_dependants;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> java.util.Set&lt;java.lang.String&gt; getPackageImports() &#123;</span><br><span class="line">    <span class="keyword">return</span> _jspx_imports_packages;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> java.util.Set&lt;java.lang.String&gt; getClassImports() &#123;</span><br><span class="line">    <span class="keyword">return</span> _jspx_imports_classes;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> javax.el.<span class="function">ExpressionFactory <span class="title">_jsp_getExpressionFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (_el_expressionfactory == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (_el_expressionfactory == <span class="keyword">null</span>) &#123;</span><br><span class="line">          _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _el_expressionfactory;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> org.apache.tomcat.<span class="function">InstanceManager <span class="title">_jsp_getInstanceManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (_jsp_instancemanager == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (_jsp_instancemanager == <span class="keyword">null</span>) &#123;</span><br><span class="line">          _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _jsp_instancemanager;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">_jspInit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">_jspDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">_jspService</span><span class="params">(<span class="keyword">final</span> javax.servlet.http.HttpServletRequest request, <span class="keyword">final</span> javax.servlet.http.HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">      <span class="keyword">throws</span> java.io.IOException, javax.servlet.ServletException </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> java.lang.String _jspx_method = request.getMethod();</span><br><span class="line">    <span class="keyword">if</span> (!<span class="string">&quot;GET&quot;</span>.equals(_jspx_method) &amp;&amp; !<span class="string">&quot;POST&quot;</span>.equals(_jspx_method) &amp;&amp; !<span class="string">&quot;HEAD&quot;</span>.equals(_jspx_method) &amp;&amp; !javax.servlet.DispatcherType.ERROR.equals(request.getDispatcherType())) &#123;</span><br><span class="line">      response.sendError(HttpServletResponse.SC_METHOD_NOT_ALLOWED, <span class="string">&quot;JSP 只允许 GET、POST 或 HEAD。Jasper 还允许 OPTIONS&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> javax.servlet.jsp.PageContext pageContext;</span><br><span class="line">    javax.servlet.http.HttpSession session = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">final</span> javax.servlet.ServletContext application;</span><br><span class="line">    <span class="keyword">final</span> javax.servlet.ServletConfig config;</span><br><span class="line">    javax.servlet.jsp.JspWriter out = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">final</span> java.lang.Object page = <span class="keyword">this</span>;</span><br><span class="line">    javax.servlet.jsp.JspWriter _jspx_out = <span class="keyword">null</span>;</span><br><span class="line">    javax.servlet.jsp.PageContext _jspx_page_context = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      response.setContentType(<span class="string">&quot;text/html; charset=UTF-8&quot;</span>);</span><br><span class="line">      pageContext = _jspxFactory.getPageContext(<span class="keyword">this</span>, request, response,</span><br><span class="line">      			<span class="keyword">null</span>, <span class="keyword">true</span>, <span class="number">8192</span>, <span class="keyword">true</span>);</span><br><span class="line">      _jspx_page_context = pageContext;</span><br><span class="line">      application = pageContext.getServletContext();</span><br><span class="line">      config = pageContext.getServletConfig();</span><br><span class="line">      session = pageContext.getSession();</span><br><span class="line">      out = pageContext.getOut();</span><br><span class="line">      _jspx_out = out;</span><br><span class="line"></span><br><span class="line">      out.write(<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">      out.write(<span class="string">&quot;&lt;!DOCTYPE html&gt;\r\n&quot;</span>);</span><br><span class="line">      out.write(<span class="string">&quot;&lt;html&gt;\r\n&quot;</span>);</span><br><span class="line">      out.write(<span class="string">&quot;&lt;head&gt;\r\n&quot;</span>);</span><br><span class="line">      out.write(<span class="string">&quot;&lt;meta charset=\&quot;UTF-8\&quot;&gt;\r\n&quot;</span>);</span><br><span class="line">      out.write(<span class="string">&quot;&lt;title&gt;index.html&lt;/title&gt;\r\n&quot;</span>);</span><br><span class="line">      out.write(<span class="string">&quot;&lt;/head&gt;\r\n&quot;</span>);</span><br><span class="line">      out.write(<span class="string">&quot;&lt;body&gt;\r\n&quot;</span>);</span><br><span class="line">      out.write(<span class="string">&quot;\t&quot;</span>);</span><br><span class="line"> String name = <span class="string">&quot;tom&quot;</span>; </span><br><span class="line">      out.write(<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">      out.write(<span class="string">&quot;\t\r\n&quot;</span>);</span><br><span class="line">      out.write(<span class="string">&quot;\t&lt;h1&gt;&quot;</span>);</span><br><span class="line">      out.print(<span class="string">&quot;hello!&quot;</span>+name );</span><br><span class="line">      out.write(<span class="string">&quot;&lt;/h1&gt;\r\n&quot;</span>);</span><br><span class="line">      out.write(<span class="string">&quot;\t\r\n&quot;</span>);</span><br><span class="line">      out.write(<span class="string">&quot;&lt;/body&gt;\r\n&quot;</span>);</span><br><span class="line">      out.write(<span class="string">&quot;&lt;/html&gt;&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (java.lang.Throwable t) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!(t <span class="keyword">instanceof</span> javax.servlet.jsp.SkipPageException))&#123;</span><br><span class="line">        out = _jspx_out;</span><br><span class="line">        <span class="keyword">if</span> (out != <span class="keyword">null</span> &amp;&amp; out.getBufferSize() != <span class="number">0</span>)</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (response.isCommitted()) &#123;</span><br><span class="line">              out.flush();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              out.clearBuffer();</span><br><span class="line">            &#125;</span><br><span class="line">          &#125; <span class="keyword">catch</span> (java.io.IOException e) &#123;&#125;</span><br><span class="line">        <span class="keyword">if</span> (_jspx_page_context != <span class="keyword">null</span>) _jspx_page_context.handlePageException(t);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">throw</span> <span class="keyword">new</span> ServletException(t);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      _jspxFactory.releasePageContext(_jspx_page_context);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这里的<code>_jspService</code>方法，就相当于servlet中的<code>service</code>方法，jsp被访问的时候会自动调用该方法</p>
</blockquote>
<h2 id="4-代码"><a href="#4-代码" class="headerlink" title="4 代码"></a>4 代码</h2><p>jsp页面中嵌入java代码，一共有三种方式：</p>
<ul>
<li>表达式(expression)</li>
<li>脚本(scriptlet)</li>
<li>声明(declaration)</li>
</ul>
<h3 id="4-1-表达式"><a href="#4-1-表达式" class="headerlink" title="4.1 表达式"></a>4.1 表达式</h3><p>形式：</p>
<p><code>&lt;%= %&gt;</code></p>
<p>例如，</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;%=<span class="string">&quot;hello&quot;</span> %&gt;</span><br><span class="line">&lt;%=<span class="number">1</span>+<span class="number">1</span> %&gt;</span><br><span class="line">&lt;%=s.getName() %&gt;</span><br></pre></td></tr></table></figure>



<p>将来翻译到java文件中的位置：</p>
<p>_jspService方法中，out.print(..)代码的参数</p>
<p>例如，上面那几个例子会翻译成</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">out.print(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">out.print(<span class="number">1</span>+<span class="number">1</span>);</span><br><span class="line">out.print(s.getName());</span><br></pre></td></tr></table></figure>

<blockquote>
<p>所以out.prntln()这个方法的参数可以写什么，那么这个jsp页面中表达式里面就可以写什么</p>
</blockquote>
<blockquote>
<p>注意，在jsp中的表达式，语句的最后不需要加;号</p>
</blockquote>
<h3 id="4-2-脚本"><a href="#4-2-脚本" class="headerlink" title="4.2 脚本"></a>4.2 脚本</h3><p>形式：</p>
<p><code>&lt;% %&gt;</code></p>
<p>例如，</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> &lt;%</span><br><span class="line">    Student s = <span class="keyword">new</span> Student();</span><br><span class="line"></span><br><span class="line">    String name = <span class="string">&quot;tom&quot;</span>;</span><br><span class="line"></span><br><span class="line">    String username = s.getName();</span><br><span class="line"></span><br><span class="line">    List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line"></span><br><span class="line">    list.add(<span class="string">&quot;hello&quot;</span>)</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>



<p>将来翻译到java文件中的位置：</p>
<p>脚本中的代码将来会被直接翻译到_jspService这个方法中</p>
<blockquote>
<p>所以，在一个普通的方法中我们可以写什么样的代码，那么在脚本中就可以写什么样的代码.</p>
</blockquote>
<h3 id="4-3-声明"><a href="#4-3-声明" class="headerlink" title="4.3 声明"></a>4.3 声明</h3><p>形式：</p>
<p><code>&lt;%! %&gt;</code></p>
<p>例如，</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;%!</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">go</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;hello world &quot;</span>+name);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;this is go()&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>



<p>将来翻译到java文件中的位置：</p>
<p>直接将声明中的代码翻译到java文件里面所定义的类中</p>
<blockquote>
<p>所以，我们可以在一个类中写什么（属性和方法），就可以在声明中写什么</p>
</blockquote>
<h2 id="5-指令"><a href="#5-指令" class="headerlink" title="5 指令"></a>5 指令</h2><p>jsp的指令是给jsp引擎看的，让jsp引擎在翻译jsp页面成java文件的时候，知道需要注意哪些地方的设置。比如页面中的编码、页面中脚本里面所用的编程语言、翻译的java文件中需要引入哪些包下的java类等等</p>
<p>写法：</p>
<p><code>&lt;%@指令名字  属性=&quot;值&quot; ..  %&gt;</code></p>
<p>分类：</p>
<ul>
<li>page指令</li>
<li>include指令</li>
<li>taglib指令</li>
</ul>
<h3 id="5-1-page"><a href="#5-1-page" class="headerlink" title="5.1 page"></a>5.1 page</h3><p>page是常用的一个jsp指令，可以用来指定当前jsp的一些基本设置</p>
<p>例如，新建jsp页面后，文件头部会默认有以下page指令的设置</p>
<p><code>&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;     pageEncoding=&quot;UTF-8&quot;%&gt;</code></p>
<p>其作用分别是</p>
<ul>
<li>指定当前jsp页面中嵌入的语言是java</li>
<li>指定写回给浏览器页面的时候，contentType的内容</li>
<li>指定当前页面件保存时候所用的编码</li>
</ul>
<p>例如，在jsp中引入其他的类和接口</p>
<p><code>&lt;%@ page import=&quot;java.util.List,java.util.ArrayList&quot; %&gt;</code></p>
<p>例如，指定当前jsp页面中是否支持session的使用，默认值就是true</p>
<p><code>&lt;%@ page session=&quot;true&quot; %&gt;</code></p>
<p>例如，指定当前页面出错之后，会跳转到error.jsp页面</p>
<p><code>&lt;%@ page errorPage=&quot;error.jsp&quot; %&gt;</code></p>
<p>例如，指定当前页面是专门用来显示错误的页面，在当前页面中可以使用隐藏对象exception来显示错误信息</p>
<p><code>&lt;%@ page isErrorPage=&quot;true&quot; %&gt;</code></p>
<h3 id="5-2-include"><a href="#5-2-include" class="headerlink" title="5.2 include"></a>5.2 include</h3><p>include指令，可以将另一个页面的显示内容，引入到当前页面中的指定位置</p>
<p>形式，</p>
<p><code>&lt;%@include file=&quot;&quot; %&gt;</code></p>
<p>例如，</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> contentType=<span class="string">&quot;text/html; charset=UTF-8&quot;</span></span><br><span class="line">    pageEncoding=<span class="string">&quot;UTF-8&quot;</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">&lt;title&gt;hello&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;h1&gt;hello!jsp&lt;/h1&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> contentType=<span class="string">&quot;text/html; charset=UTF-8&quot;</span></span><br><span class="line">    pageEncoding=<span class="string">&quot;UTF-8&quot;</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">&lt;title&gt;index.html&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;h1&gt;index&lt;/h1&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;%@ include file=<span class="string">&quot;/hello.jsp&quot;</span> %&gt;</span><br><span class="line">	</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>



<p>访问页面index.jsp，查看其页面源代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>index.html<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">h1</span>&gt;</span>index<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">h1</span>&gt;</span>hello!jsp<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>可以看出，在index.jsp页面中的include指令处，把hello.jsp的内容引入了过来</p>
</blockquote>
<h3 id="5-3-taglib"><a href="#5-3-taglib" class="headerlink" title="5.3 taglib"></a>5.3 taglib</h3><p>taglib指令，在jsp中可以引入标签库，然后就可以使用标签库中的标签，来完成相应的功能了</p>
<p>例如，引入JSTL标签库 (简化jsp开发)</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> prefix=<span class="string">&quot;c&quot;</span> %&gt;</span><br></pre></td></tr></table></figure>



<p>例如，引入spring框架的标签库</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib uri=<span class="string">&quot;http://www.springframework.org/tags&quot;</span> prefix=<span class="string">&quot;s&quot;</span> %&gt;</span><br></pre></td></tr></table></figure>



<p>例如，引入struts2框架的标签</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib uri=<span class="string">&quot;/struts-tags&quot;</span> prefix=<span class="string">&quot;s&quot;</span> %&gt;</span><br></pre></td></tr></table></figure>



<p>注意1，引入标签库，需要先在项目中引入对应的jar包</p>
<p>注意2，uri属性，指的是标签库的设置的URI地址</p>
<p>注意3，prefix属性，指的是给引入的标签库起一个别名，这样使用起来较为方便</p>
<blockquote>
<p>注意，后面学习到JSTL标签库的时候，再具体来使用</p>
</blockquote>
<h2 id="6-动作"><a href="#6-动作" class="headerlink" title="6 动作"></a>6 动作</h2><p>jsp中还有内置的标签，称之为jsp的动作元素，它的本质就是把固定的java代码，封装成了标签的形式。</p>
<p>例如，</p>
<p><code>&lt;jsp:useBean id=&quot;s&quot; class=&quot;com.briup.bean.Student&quot; scope=&quot;page&quot;&gt;&lt;/jsp:useBean&gt;</code></p>
<p>相当于代码：</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> &lt;%</span><br><span class="line">    Student s = <span class="keyword">null</span>;</span><br><span class="line">    s = (Student)pageContext.getAttribute(<span class="string">&quot;s&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(s==<span class="keyword">null</span>)&#123;</span><br><span class="line">        s = <span class="keyword">new</span> Student();</span><br><span class="line">        pageContext.setAttribute(<span class="string">&quot;s&quot;</span>,s);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>

<p>查看效果</p>
<p><code>&lt;%= pageContext.getAttribute(&quot;user&quot;) %&gt;</code></p>
<p>例如，</p>
<p><code>&lt;jsp:setProperty property=&quot;name&quot; value=&quot;tom&quot; name=&quot;s&quot;/&gt;</code></p>
<p>相当于代码：</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">    Student s = (Student)pageContext.getAttribute(<span class="string">&quot;s&quot;</span>);</span><br><span class="line">    s.setName(<span class="string">&quot;tom&quot;</span>);</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>

<p>查看效果</p>
<p><code>&lt;%= pageContext.getAttribute(&quot;user&quot;) %&gt;</code></p>
<p>例如，</p>
<p><code>&lt;jsp:getProperty property=&quot;name&quot; name=&quot;s&quot;/&gt;</code></p>
<p>相当于代码：</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">	Student s = (Student)pageContext.getAttribute(<span class="string">&quot;s&quot;</span>);</span><br><span class="line">	out.write(s.getName());</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>





<p>JSP的动作元素中，常被用的有俩个：</p>
<ul>
<li>forward</li>
<li>include</li>
</ul>
<p>例如，页面跳转</p>
<p><code>&lt;jsp:forward page=&quot;target.jsp&quot;&gt;&lt;/jsp:forward&gt;</code></p>
<p>例如，跳转的同时还可以传参数</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;jsp:forward page=<span class="string">&quot;target.jsp&quot;</span>&gt;</span><br><span class="line">    &lt;jsp:param value=<span class="string">&quot;tom&quot;</span> name=<span class="string">&quot;name&quot;</span>/&gt;</span><br><span class="line">&lt;/jsp:forward&gt;</span><br></pre></td></tr></table></figure>



<p>例如，在当前页面中包含另一个页面</p>
<p><code>&lt;jsp:include page=&quot;foot.jsp&quot;&gt;&lt;/jsp:include&gt;</code></p>
<p>例如，在包含页面的同时，还可以传参</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;jsp:include page=<span class="string">&quot;foot.jsp&quot;</span>&gt;</span><br><span class="line">    &lt;jsp:param value=<span class="string">&quot;lisi&quot;</span> name=<span class="string">&quot;name&quot;</span>/&gt;</span><br><span class="line">&lt;/jsp:include&gt;</span><br></pre></td></tr></table></figure>

<p>foot.jsp</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">注册|登录|购物车 你好 &lt;%= request.getParameter(<span class="string">&quot;username&quot;</span>) %&gt;</span><br></pre></td></tr></table></figure>



<hr>
<p>一个页面包含/引入另外一个页面有俩种方式</p>
<ul>
<li>静态包含，<code>&lt;%@include file=&quot;&quot; %&gt;</code></li>
<li>动态包含，<code>&lt;jsp:include page=&quot;&quot;&gt;&lt;/jsp:include&gt;</code></li>
</ul>
<p>静态包含，在jsp翻译成java程序的时候，直接将另一个页面的内容原封不动的写入到代码中。</p>
<p>动态包含，在jsp翻译成java程序的时候，只会把包含的动作翻译成一个方法的调用，将来在访问的时候才会真正的去获取另一个页面的内容。</p>
<p><code>具体可查看编译后的字节码文件做对比</code></p>
<blockquote>
<p>注意，动态包含可以传参，静态包含不能穿参</p>
</blockquote>
<h2 id="7-注释"><a href="#7-注释" class="headerlink" title="7 注释"></a>7 注释</h2><p>jsp中的注释，分为三种</p>
<ul>
<li>html/xml中的注释方式</li>
<li>jsp中的注释方式</li>
<li>java中的注释方式</li>
</ul>
<h3 id="7-1-html注释"><a href="#7-1-html注释" class="headerlink" title="7.1 html注释"></a>7.1 html注释</h3><p>形式：</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- html/xml中的注释方式 --&gt;</span><br></pre></td></tr></table></figure>

<p>特点:</p>
<ol>
<li>用户在浏览器中右键查看源代码 【能】 看到这个注释</li>
<li>在服务器端,这个jsp页面被翻译成的java文件中 【能】 看到这个注释.</li>
</ol>
<blockquote>
<p>注意，jsp动作元素，放在这种注释里面可能不起作用(注释不起作用,jsp动作元素正常执行)</p>
</blockquote>
<p>例如：下面的注释不起作用</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- </span><br><span class="line">	&lt;jsp:forward page=<span class="string">&quot;hello.jsp&quot;</span>&gt;&lt;/jsp:forward&gt;</span><br><span class="line">--&gt;</span><br></pre></td></tr></table></figure>

<p>起作用</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- username: &lt;jsp:getProperty property=<span class="string">&quot;username&quot;</span> name=<span class="string">&quot;user&quot;</span>/&gt; --&gt;</span><br></pre></td></tr></table></figure>



<h3 id="7-2-jsp注释"><a href="#7-2-jsp注释" class="headerlink" title="7.2 jsp注释"></a>7.2 jsp注释</h3><p>形式：</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;%-- </span><br><span class="line">    jsp中的注释方式(隐藏注释)</span><br><span class="line">--%&gt;</span><br></pre></td></tr></table></figure>

<p>特点:</p>
<ol>
<li>用户在浏览器中右键查看源代码 【不能】看到这个注释。</li>
<li>在服务器端,这个jsp页面被翻译成的java文件中 [不能] 看到这个注释.</li>
</ol>
<blockquote>
<p>注意，这种注释，也被称为JSP中的隐藏注释</p>
</blockquote>
<h3 id="7-3-java注释"><a href="#7-3-java注释" class="headerlink" title="7.3 java注释"></a>7.3 java注释</h3><p>java中的注释方式，只能在jsp的脚本或者声明中使用。</p>
<p>例如，</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">	<span class="comment">//String name = &quot;tom&quot;;</span></span><br><span class="line">	<span class="comment">/* </span></span><br><span class="line"><span class="comment">		int b = 40;</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">  		 	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">		int a = 20;</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line"></span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>

<p>特点:</p>
<ol>
<li>用户在浏览器中右键查看源代码 【不能】 看到这个注释。</li>
<li>在服务器端,这个jsp页面被翻译成的java文件中 【能】 看到这个注释.</li>
</ol>
<h2 id="8-对象"><a href="#8-对象" class="headerlink" title="8 对象"></a>8 对象</h2><p>在jsp页面代码中，可以直接使用的内置的对象，只要对象名字写对即可。</p>
<p>jsp中的内置对象一共有九种：</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>名字</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>PageContext</td>
<td>pageContext</td>
<td>页面范围对象</td>
</tr>
<tr>
<td>HttpServletRequest</td>
<td>request</td>
<td>和servlet中的相同</td>
</tr>
<tr>
<td>HttpSession</td>
<td>session</td>
<td>和servlet中的相同</td>
</tr>
<tr>
<td>ServletContext</td>
<td>application</td>
<td>和servlet中的相同</td>
</tr>
<tr>
<td>Object</td>
<td>page</td>
<td>jsp页面本身（this）</td>
</tr>
<tr>
<td>HttpServletResponse</td>
<td>response</td>
<td>和servlet中的相同</td>
</tr>
<tr>
<td>JspWriter</td>
<td>out</td>
<td>输出流，可以给客户端写回内容</td>
</tr>
<tr>
<td>ServletConfig</td>
<td>config</td>
<td>和servlet中的相同</td>
</tr>
<tr>
<td>Throwable</td>
<td>exception</td>
<td>隐藏对象，表示jsp中的异常</td>
</tr>
</tbody></table>
<blockquote>
<p>注意，这些对象的类型和名字都是固定的，任意打开一个jsp页面翻译成的java代码，查看_jspService方法，就可以看到这些内置的对象</p>
</blockquote>
<blockquote>
<p>注意，JSP中比servlet多了一个更加小的传值范围pageContext，存进去的值，只会在一个页面中有效，比之前的request范围还要小</p>
</blockquote>
<p>默认情况下，jsp页面中是不能使用exception这个对象的，除非页面中设置了isErrorPage属性：</p>
<p><code>&lt;%@ page isErrorPage=&quot;true&quot; %&gt;</code></p>
<p>查看错误信息</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;%=</span><br><span class="line">    exception.getMessage()</span><br><span class="line">%&gt; </span><br></pre></td></tr></table></figure>



<h2 id="9-路径"><a href="#9-路径" class="headerlink" title="9 路径"></a>9 路径</h2><p>一般情况下，jsp中路径问题是和我们之前在servlet中讨论的html里面的路径问题是一样的，但是在jsp中可以动态获得该项目的URL地址</p>
<p>例如，</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> contentType=<span class="string">&quot;text/html; charset=UTF-8&quot;</span></span><br><span class="line">    pageEncoding=<span class="string">&quot;UTF-8&quot;</span>%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">	String path = request.getContextPath();</span><br><span class="line">	String basePath = request.getScheme()+<span class="string">&quot;://&quot;</span>+request.getServerName()+<span class="string">&quot;:&quot;</span>+request.getServerPort()+path+<span class="string">&quot;/&quot;</span>;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;base href=<span class="string">&quot;&lt;%=basePath%&gt;&quot;</span> /&gt;</span><br><span class="line">&lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">&lt;title&gt;index.html&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;h1&gt;index&lt;/h1&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;a href=<span class="string">&quot;hello.jsp&quot;</span>&gt;hello&lt;/a&gt;</span><br><span class="line">	</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里把项目的基础URL地址，动态的拼接了出来，并且使用了base标签，来指定页面中相对路径的参照点</p>
</blockquote>
<h2 id="10-EL"><a href="#10-EL" class="headerlink" title="10 EL"></a>10 EL</h2><blockquote>
<p>EL（Expression Language），称为EL表达式，目的是为了使JSP写起来更加简单</p>
</blockquote>
<p>在jsp页面中，使用EL表达式，就可以不用写大量的java代码了，这样可以提高页面的可读性和维护性。</p>
<p>形式：</p>
<p><code>$&#123;&#125;</code></p>
<p>例如，接收客户端参数</p>
<p><code>http://localhost:8989/day9-jsp/el.jsp?name=lucy</code></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;param.name1 &#125;  &lt;%requet.getParmeter(<span class="string">&quot;usernm&quot;</span>%&gt;</span><br></pre></td></tr></table></figure>



<p>例如，指定范围并取值</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$&#123;pageScope.name2 &#125;</span><br><span class="line">$&#123;requestScope.name3 &#125;</span><br><span class="line">$&#123;sessionScope.name4 &#125;</span><br><span class="line">$&#123;applicationScope.name5 &#125;</span><br></pre></td></tr></table></figure>



<p>例如，可以不指定范围再去取值</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;name&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这时候会按照pageContext request session application这样一个顺序依次的去找，有没有一个叫name的值存在，一旦找到了就输出出来，最终没有找到那么就什么都不输出</p>
</blockquote>
<p>例如，取出一个对象中的属性值</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$&#123;requestScope.student.id&#125;</span><br><span class="line">$&#123;requestScope.student.name&#125;</span><br><span class="line">$&#123;requestScope.student.age&#125;</span><br><span class="line"><span class="comment">//或者</span></span><br><span class="line">$&#123;student.id&#125;</span><br><span class="line">$&#123;student.name&#125;</span><br><span class="line">$&#123;student.age&#125;</span><br><span class="line"><span class="comment">//或者</span></span><br><span class="line">$&#123;student[<span class="string">&quot;id&quot;</span>]&#125;</span><br><span class="line">$&#123;student[<span class="string">&#x27;id&#x27;</span>]&#125;</span><br><span class="line"></span><br><span class="line">$&#123;student[<span class="string">&quot;name&quot;</span>]&#125;</span><br><span class="line">$&#123;student[<span class="string">&#x27;name&#x27;</span>]&#125;</span><br><span class="line"></span><br><span class="line">$&#123;student[<span class="string">&quot;age&quot;</span>]&#125;</span><br><span class="line">$&#123;student[<span class="string">&#x27;age&#x27;</span>]&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，${student.id}表示要调用student对象中的getId方法，至于对象中有没有id属性，对这个操作没有任何影响。所以这和id指的是对象中的property而不是attribute</p>
<p>${student[‘name’]}调用的是attribute</p>
</blockquote>
<p>例如，如果Student类中一个方法是getAddress，返回一个Address类的对象，Address类中有一个方法getCity，这个时候就可以这样写去拿到city属性的值.</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;student.address.city&#125;</span><br></pre></td></tr></table></figure>



<p>例如，输出字符串</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;<span class="string">&quot;hello&quot;</span>&#125;</span><br></pre></td></tr></table></figure>



<p>例如，输出运算结果或者boolean表达式</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">$&#123;<span class="number">1</span>+<span class="number">1</span> &#125;</span><br><span class="line">$&#123;(<span class="number">1</span>+<span class="number">2</span>)*<span class="number">3</span>-<span class="number">4</span>+<span class="number">5</span>*<span class="number">3</span> &#125;</span><br><span class="line">$&#123;u.age * <span class="number">10</span> &#125;</span><br><span class="line">$&#123;<span class="number">1</span>&lt;<span class="number">3</span> &#125;</span><br><span class="line">      </span><br><span class="line">&lt;%</span><br><span class="line">		String name = <span class="string">&quot;&quot;</span>;</span><br><span class="line">		String name2 = <span class="string">&quot;lucy&quot;</span>;</span><br><span class="line">	%&gt;      </span><br><span class="line"><span class="comment">//为空的话返回true 注意取不到脚本的值 可以将name存到request中</span></span><br><span class="line">$&#123;empty <span class="string">&quot;&quot;</span> &#125;</span><br><span class="line">$&#123;empty <span class="string">&quot;hello&quot;</span> &#125;</span><br><span class="line"> 判断<span class="number">1</span> $&#123;empty <span class="string">&quot;$&#123;name&#125;&quot;</span> &#125;&lt;br&gt;  </span><br><span class="line"><span class="comment">//取否 不为空的话返回true</span></span><br><span class="line">$&#123;not empty <span class="string">&quot;hello&quot;</span> &#125;</span><br><span class="line">$&#123;! empty <span class="string">&quot;hello&quot;</span> &#125;</span><br><span class="line">$&#123;param.score &gt;<span class="number">50</span> &#125;</span><br><span class="line">    </span><br><span class="line">$&#123;param.score &gt;<span class="number">60</span>?<span class="string">&quot;good&quot;</span>:<span class="string">&quot;bad&quot;</span> &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&lt;%</span><br><span class="line">		request.setAttribute(<span class="string">&quot;s&quot;</span>, <span class="keyword">new</span> Student(<span class="number">1</span>,<span class="string">&quot;lucy&quot;</span>));</span><br><span class="line">	%&gt;</span><br><span class="line">	$&#123;<span class="number">1</span>&lt;<span class="number">3</span> &#125; &lt;br&gt;</span><br><span class="line">	$&#123;empty <span class="number">1</span> &#125;&lt;br&gt;</span><br><span class="line">	$&#123;empty <span class="string">&quot;&quot;</span> &#125;&lt;br&gt;</span><br><span class="line">	$&#123;<span class="number">5</span>&lt;<span class="number">6</span>? <span class="number">5</span>:<span class="number">6</span> &#125;&lt;br&gt;</span><br><span class="line">	$&#123; empty requestScope.s? <span class="string">&quot;登录&quot;</span>:requestScope.s.name&#125;</span><br></pre></td></tr></table></figure>



<p>例如，输出数组、集合中的元素</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">String[] str = &#123;<span class="string">&quot;hello&quot;</span>,<span class="string">&quot;world&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">list.add(<span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line">list.add(<span class="string">&quot;lisi&quot;</span>);</span><br><span class="line"></span><br><span class="line">Map&lt;String,Integer&gt; map = <span class="keyword">new</span> HashMap&lt;String,Integer&gt;();</span><br><span class="line">map.put(<span class="string">&quot;a&quot;</span>,<span class="number">100</span>);</span><br><span class="line">map.put(<span class="string">&quot;b&quot;</span>,<span class="number">200</span>);</span><br><span class="line">map.put(<span class="string">&quot;c&quot;</span>,<span class="number">300</span>);</span><br><span class="line"></span><br><span class="line">request.setAttribute(<span class="string">&quot;str&quot;</span>,str);</span><br><span class="line">request.setAttribute(<span class="string">&quot;list&quot;</span>,list);</span><br><span class="line">request.setAttribute(<span class="string">&quot;map&quot;</span>,map);</span><br><span class="line"></span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">$&#123;str[<span class="number">0</span>] &#125;&lt;br&gt;</span><br><span class="line">$&#123;list[<span class="number">1</span>] &#125;&lt;br&gt;</span><br><span class="line">$&#123;map[<span class="string">&quot;c&quot;</span>] &#125;&lt;br&gt;</span><br></pre></td></tr></table></figure>



<p>遍历集合</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 遍历集合 放入表格中--&gt;</span><br><span class="line">	&lt;table border=<span class="string">&quot;1px&quot;</span> cellpadding=<span class="string">&quot;0px&quot;</span> cellspacing=<span class="string">&quot;0px&quot;</span>&gt;</span><br><span class="line">		&lt;tr&gt;</span><br><span class="line">			&lt;td&gt;name&lt;/td&gt;</span><br><span class="line">		&lt;/tr&gt;</span><br><span class="line">		&lt;%	</span><br><span class="line">			List&lt;String&gt; l = (List&lt;String&gt;)request.getAttribute(<span class="string">&quot;list&quot;</span>);</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; l.size(); i++ )&#123;</span><br><span class="line">				String name = l.get(i);</span><br><span class="line">		%&gt;</span><br><span class="line">		&lt;tr&gt;</span><br><span class="line">			&lt;td&gt;&lt;%= name %&gt;&lt;/td&gt;</span><br><span class="line">		&lt;/tr&gt;</span><br><span class="line">		&lt;%</span><br><span class="line">			&#125;</span><br><span class="line">		%&gt;</span><br><span class="line">	&lt;/table&gt;</span><br></pre></td></tr></table></figure>



<p>例如，key的值中含有特殊符号点</p>
<p>request对象中有一个key值为:javax.servlet.forward.request_uri</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;requestScope[<span class="string">&#x27;javax.servlet.forward.request_uri&#x27;</span>] &#125;</span><br></pre></td></tr></table></figure>





<h2 id="11-JSTL"><a href="#11-JSTL" class="headerlink" title="11 JSTL"></a>11 JSTL</h2><blockquote>
<p>JSTL（JSP Standard Tag Library），jsp标准的标签库，其目的也是简化jsp中java代码的编写</p>
</blockquote>
<h3 id="11-1-引入"><a href="#11-1-引入" class="headerlink" title="11.1 引入"></a>11.1 引入</h3><p>1、先将标签库对应的jar导入项目中</p>
<p>如果是动态的web项目，直接将jstl-1.2.jar复制粘贴到lib目录中即可。</p>
<p>如果是maven项目，引入其依赖坐标即可：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>2、然后再需要使用的JSP页面中，使用tablib指令，将标签库引入：</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> prefix=<span class="string">&quot;c&quot;</span> %&gt;</span><br></pre></td></tr></table></figure>



<h3 id="11-2-使用"><a href="#11-2-使用" class="headerlink" title="11.2 使用"></a>11.2 使用</h3><blockquote>
<p>注意，JSTL标签库一般会结合着EL表达式一起使用</p>
</blockquote>
<p>常用的几种标签为：</p>
<p><code>&lt;c:forEach&gt;</code>标签(遍历使用)</p>
<p>脚本遍历</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">		<span class="comment">// 准备数据</span></span><br><span class="line">		List&lt;User&gt; list = <span class="keyword">new</span> ArrayList&lt;User&gt;();</span><br><span class="line">		list.add(<span class="keyword">new</span> User(<span class="number">1</span>,<span class="string">&quot;lucy&quot;</span>));</span><br><span class="line">		list.add(<span class="keyword">new</span> User(<span class="number">2</span>,<span class="string">&quot;tom&quot;</span>));</span><br><span class="line">		list.add(<span class="keyword">new</span> User(<span class="number">1</span>,<span class="string">&quot;jack&quot;</span>));</span><br><span class="line">	%&gt;</span><br><span class="line">	&lt;table&gt;</span><br><span class="line">		&lt;tr&gt;</span><br><span class="line">			&lt;td&gt;id&lt;/td&gt;</span><br><span class="line">			&lt;td&gt;name&lt;/td&gt;</span><br><span class="line">		&lt;/tr&gt;</span><br><span class="line">		&lt;%</span><br><span class="line">		   <span class="keyword">for</span>(User user : list)&#123;</span><br><span class="line">			 <span class="keyword">int</span> id =  user.getId(); </span><br><span class="line">			 String username = user.getUsername();</span><br><span class="line">		%&gt;</span><br><span class="line">		&lt;tr&gt;</span><br><span class="line">			&lt;td&gt;&lt;%=id%&gt;&lt;/td&gt;</span><br><span class="line">			&lt;td&gt;&lt;%=username%&gt;&lt;/td&gt;</span><br><span class="line">		&lt;/tr&gt;</span><br><span class="line">		&lt;%  </span><br><span class="line">			&#125;</span><br><span class="line">		%&gt;</span><br><span class="line">	&lt;/table&gt;</span><br></pre></td></tr></table></figure>



<p>标签遍历，</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">    List&lt;Student&gt; list = <span class="keyword">new</span> ArrayList&lt;Student&gt;();</span><br><span class="line">    list.add(<span class="keyword">new</span> Student(<span class="number">1</span>,<span class="string">&quot;tom1&quot;</span>,<span class="number">21</span>));</span><br><span class="line">    list.add(<span class="keyword">new</span> Student(<span class="number">2</span>,<span class="string">&quot;tom2&quot;</span>,<span class="number">22</span>));</span><br><span class="line">    list.add(<span class="keyword">new</span> Student(<span class="number">3</span>,<span class="string">&quot;tom3&quot;</span>,<span class="number">23</span>));</span><br><span class="line">    list.add(<span class="keyword">new</span> Student(<span class="number">4</span>,<span class="string">&quot;tom4&quot;</span>,<span class="number">24</span>));</span><br><span class="line">    session.setAttribute(<span class="string">&quot;list&quot;</span>, list);</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">&lt;c:forEach items=<span class="string">&quot;$&#123;list &#125;&quot;</span> <span class="keyword">var</span> =<span class="string">&quot;stu&quot;</span> begin=<span class="string">&quot;0&quot;</span> end =<span class="string">&quot;3&quot;</span> varStatus=<span class="string">&quot;status&quot;</span> step=<span class="string">&quot;1&quot;</span>&gt;  </span><br><span class="line">    $&#123;status.index &#125; : $&#123;stu.id &#125; - $&#123;stu.name &#125; - $&#123;stu.age &#125; &lt;br&gt;  </span><br><span class="line">&lt;/c:forEach&gt;</span><br></pre></td></tr></table></figure>

<p>其中，</p>
<p><code>varStatus</code>表示当前循环遍历的序号</p>
<p><code>begin=&quot;&quot;</code>默认值是0  ，<code>end=&quot;&quot;</code>默认值是最后一个元素，<code>step=&quot;&quot;</code>默认值是1，一般的遍历只要写var和items来个属性即可</p>
<p>例如，遍历List集合，假设students是放进request对象中的一个List集合，集合中存放的是Student类型的对象</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:forEach items=<span class="string">&quot;$&#123;students&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;stu&quot;</span>&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;$&#123;stu.id &#125;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;$&#123;stu.name &#125;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;$&#123;stu.age &#125;&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">&lt;/c:forEach&gt;</span><br></pre></td></tr></table></figure>



<p>例如，遍历Map集合，假设有一个Map类型的集合，放到了request对象中，key是id值，value是Student对象</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:forEach items=<span class="string">&quot;$&#123;map&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;entry&quot;</span>&gt;</span><br><span class="line">  		$&#123;entry.key &#125;--&gt;$&#123;entry.value.id &#125; &amp;nbsp; $&#123;entry.value.name &#125; &amp;nbsp; $&#123;entry.value.age &#125;&lt;br&gt;</span><br><span class="line">&lt;/c:forEach&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>entry是定义的一个变量，用做接收每次遍历到的集合中的一组键值对,可以通过entry.key 和 entry.value分别拿到这次遍历到的key值和value值</p>
</blockquote>
<p><code>&lt;if&gt;</code>标签</p>
<p>例如，</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">    &lt;%</span><br><span class="line">        request.setAttribute(<span class="string">&quot;score&quot;</span>,<span class="number">40</span>);</span><br><span class="line">    %&gt;</span><br><span class="line"></span><br><span class="line">    &lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;score&gt;85 &#125;&quot;</span>&gt;</span><br><span class="line">        &lt;font color=<span class="string">&quot;red&quot;</span>&gt;你的分数超过了<span class="number">85</span>分&lt;/font&gt;</span><br><span class="line">    &lt;/c:<span class="keyword">if</span>&gt;</span><br><span class="line">&lt;!-- 注意放reuqest即可,session一直在会话级别 --&gt;</span><br><span class="line">&lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;!empty s&#125;&quot;</span>&gt;</span><br><span class="line">		&lt;font color=<span class="string">&quot;red&quot;</span>&gt;$&#123;s.name &#125;&lt;/font&gt;</span><br><span class="line">	&lt;/c:<span class="keyword">if</span>&gt;</span><br><span class="line">	&lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;empty s&#125;&quot;</span>&gt;</span><br><span class="line">		&lt;font color=<span class="string">&quot;green&quot;</span>&gt;登录&lt;/font&gt;</span><br><span class="line">	&lt;/c:<span class="keyword">if</span>&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;c:choose&gt;</span><br><span class="line">		&lt;c:when test=<span class="string">&quot;$&#123;!empty s&#125;&quot;</span>&gt;</span><br><span class="line">			&lt;font color=<span class="string">&quot;red&quot;</span>&gt;$&#123;s.name &#125;&lt;/font&gt;</span><br><span class="line">		&lt;/c:when&gt;</span><br><span class="line">		&lt;c:otherwise&gt;</span><br><span class="line">			&lt;font color=<span class="string">&quot;green&quot;</span>&gt;登录&lt;/font&gt;</span><br><span class="line">		&lt;/c:otherwise&gt;</span><br><span class="line">	&lt;/c:choose&gt;</span><br></pre></td></tr></table></figure>



<p><code>&lt;c:import&gt;</code>标签</p>
<p>和<code>&lt;jsp:include&gt;</code>的作用基本相同，但是<code>&lt;c:import&gt;</code>还可以选择把引入的内容先保存在一个变量中，之后通过EL表达式再拿出来显示</p>
<p>例如，</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:<span class="keyword">import</span> <span class="keyword">var</span>=<span class="string">&quot;data&quot;</span> url=<span class="string">&quot;a.jsp&quot;</span> /&gt;</span><br><span class="line"><span class="comment">// 什么时候导入 就什么时候用</span></span><br><span class="line">&lt;div&gt;$&#123;data&#125;&lt;/div&gt;</span><br></pre></td></tr></table></figure>



<p><code>&lt;c:redirect&gt;</code>标签</p>
<p>重定向标签</p>
<p>例如，</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:redirect url=<span class="string">&quot;a.jsp&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>





<h2 id="12-自定义"><a href="#12-自定义" class="headerlink" title="12 自定义"></a>12 自定义</h2><blockquote>
<p>除了使用现有的标签库之外，我们还可以自定义的自己的标签库。（作为扩展了解的内容即可）</p>
</blockquote>
<p>JSP1.1版本中增加了自定义标签库规范，但是在 JSP1.1规范中开发自定义标签库比较复杂，JSP2.0 及以上版本中简化了标签库的开发，只需如下几个步骤</p>
<ul>
<li><p>编写自定义标签处理类</p>
</li>
<li><p>建立一个 *.tld 文件，该文件放在WEB-INF下即可</p>
<p>每个 *.tld 文件对应一个标签库，每个标签库可以对应多个标签</p>
</li>
<li><p>在jsp文件中使用tablib指令引入并使用自定义标签</p>
</li>
<li><p>jsp页面中使用该标签库</p>
</li>
</ul>
<p><strong>例如1</strong>，编写一个标签，可以自动输出hello</p>
<p>第一步，继承SimpleTagSupport，重写doTag即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloTag</span> <span class="keyword">extends</span> <span class="title">SimpleTagSupport</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doTag</span><span class="params">()</span> <span class="keyword">throws</span> JspException, IOException </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.getJspContext().getOut().println(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>第二步，编写my-tag.tld文件(名字随意)，存放在WEB-INF下</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">taglib</span></span></span><br><span class="line"><span class="meta">   <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//Sun Microsystems, Inc.//DTD JSP Tag Library 1.2//EN&quot;</span></span></span><br><span class="line"><span class="meta">   <span class="meta-string">&quot;http://java.sun.com/j2ee/dtd/web-jsptaglibrary_1_2.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">taglib</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">tlib-version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">tlib-version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">jsp-version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">jsp-version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">short-name</span>&gt;</span>my-taglib<span class="tag">&lt;/<span class="name">short-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uri</span>&gt;</span>briup-taglib<span class="tag">&lt;/<span class="name">uri</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">tag</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tag-class</span>&gt;</span>com.briup.test.HelloTag<span class="tag">&lt;/<span class="name">tag-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">body-content</span>&gt;</span>empty<span class="tag">&lt;/<span class="name">body-content</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tag</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">taglib</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意1，该文件的样例可以在tomcat中的实例项目中复制出来修改</p>
<p>例如，tomcat\webapps\examples\WEB-INF\jsp\example-taglib.tld文件</p>
<p>注意2，<code>&lt;body-content&gt;</code>标签中的值，表示自定义标签中body部分可以填写的内容类型，有四种：</p>
<ul>
<li>empty，空标记，即起始标记和结束标记之间没有内容</li>
<li>scriptless，可以接收文本、EL和JSP动作</li>
<li>JSP，（SimpleTagSupport类型不支持），接受所有JSP语法，如定制的或内部的tag、scripts、静态HTML、脚本元素、JSP指令和动作</li>
<li>tagdependent，标签体内容直接被写入BodyContent，由自定义标签类来进行处理，而不被JSP容器解释</li>
</ul>
<p>第三步，jsp页面中引入并使用标签库</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> contentType=<span class="string">&quot;text/html; charset=UTF-8&quot;</span></span><br><span class="line">    pageEncoding=<span class="string">&quot;UTF-8&quot;</span>%&gt;</span><br><span class="line">&lt;%@ taglib uri=<span class="string">&quot;briup-taglib&quot;</span> prefix=<span class="string">&quot;briup&quot;</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">        &lt;title&gt;hello.jsp&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;briup:hello&gt;&lt;/briup:hello&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>



<p><strong>例如2</strong>，编写一个标签，可以自动输出hello，并附带上标签体中的内容</p>
<p>第一步，修改HelloTag类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloTag</span> <span class="keyword">extends</span> <span class="title">SimpleTagSupport</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doTag</span><span class="params">()</span> <span class="keyword">throws</span> JspException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//准备好一个StringWriter，接收标签体内容</span></span><br><span class="line">        StringWriter sw = <span class="keyword">new</span> StringWriter();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//把标签体内容写到StringWriter中</span></span><br><span class="line">        <span class="keyword">super</span>.getJspBody().invoke(sw);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//从StringWriter中获取标签体的内容</span></span><br><span class="line">        String tagBody = sw.toString();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">super</span>.getJspContext().getOut().println(<span class="string">&quot;hello! &quot;</span>+tagBody);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>第二步，修改my-tag.tld文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tag</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tag-class</span>&gt;</span>com.briup.test.HelloTag<span class="tag">&lt;/<span class="name">tag-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body-content</span>&gt;</span>scriptless<span class="tag">&lt;/<span class="name">body-content</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tag</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意，这里只是修改了<code>&lt;body-content&gt;</code>标签中的值，改为scriptless或者tagdependent都是可以的.其他地方不用修改</p>
<p>第三步，修改jsp文件，添加标签body内容即可</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;briup:hello&gt;tom&lt;/briup:hello&gt;</span><br></pre></td></tr></table></figure>





<p><strong>例如3</strong>，编写一个标签，可以自动输出hello，并附带上标签体中的内容，并且根据标签中属性的值，来确定内容将会输出多少次</p>
<p>第一步，修改HelloTag类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloTag</span> <span class="keyword">extends</span> <span class="title">SimpleTagSupport</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> count;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doTag</span><span class="params">()</span> <span class="keyword">throws</span> JspException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//准备好一个StringWriter，接收标签体内容</span></span><br><span class="line">        StringWriter sw = <span class="keyword">new</span> StringWriter();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//把标签体内容写到StringWriter中</span></span><br><span class="line">        <span class="keyword">super</span>.getJspBody().invoke(sw);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//从StringWriter中获取标签体的内容</span></span><br><span class="line">        String tagBody = sw.toString();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;count;i++) &#123;</span><br><span class="line">            <span class="keyword">super</span>.getJspContext().getOut().println(<span class="string">&quot;hello! &quot;</span>+tagBody+<span class="string">&quot;&lt;br&gt;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCount</span><span class="params">(<span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.count = count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改地方1，添加属性count，提供get/set方法，用来接收标签中属性的count属性的值<br>修改地方2，输出内容语句外面嵌套循环，循环次数由count的值来控制</p>
<p>第二步，修改my-tag.tld文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tag</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tag-class</span>&gt;</span>com.briup.test.HelloTag<span class="tag">&lt;/<span class="name">tag-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body-content</span>&gt;</span>scriptless<span class="tag">&lt;/<span class="name">body-content</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">attribute</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>count<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">required</span>&gt;</span>true<span class="tag">&lt;/<span class="name">required</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">attribute</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tag</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>修改地方，添加attribute标签来指定属性的相关信息</p>
<p>第三步，修改jsp文件，添加标签的属性</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;briup:hello count=<span class="string">&quot;5&quot;</span>&gt;tom&lt;/briup:hello&gt;</span><br></pre></td></tr></table></figure>



<p><strong>例如4</strong>，编写一个标签，可以自动输出hello，并附带上标签体中的内容，并且根据标签中属性的值，来确定内容将会输出多少次，同时标签体值和属性的值都是要EL表达式来表示</p>
<p>第一步，HelloTag类，和例3保持一致，不需要改动</p>
<p>第二步，修改my-tag.tld文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tag</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tag-class</span>&gt;</span>com.briup.test.HelloTag<span class="tag">&lt;/<span class="name">tag-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body-content</span>&gt;</span>scriptless<span class="tag">&lt;/<span class="name">body-content</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">attribute</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>count<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">required</span>&gt;</span>true<span class="tag">&lt;/<span class="name">required</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rtexprvalue</span>&gt;</span>true<span class="tag">&lt;/<span class="name">rtexprvalue</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">attribute</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tag</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>修改地方，添加标签<code>&lt;rtexprvalue&gt;</code>，表示支持EL</p>
<p>注意，rtexprvalue的意思是：Runtime Expression Value</p>
<p>第三步，修改jsp文件，添加标签的属性</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">    request.setAttribute(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;zs&quot;</span>);</span><br><span class="line">    request.setAttribute(<span class="string">&quot;count&quot;</span>, <span class="string">&quot;10&quot;</span>);</span><br><span class="line">%&gt;</span><br><span class="line">&lt;briup:hello count=<span class="string">&quot;$&#123;count &#125;&quot;</span>&gt;$&#123;name &#125;&lt;/briup:hello&gt;</span><br></pre></td></tr></table></figure>

<p>修改地方，添加了jsp脚本，配合测试，同时标签中是使用了EL表达式</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/briup/" rel="tag">briup</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-briup/briup-servlet"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/archives/briup/briup-servlet.html"
    >briup_servlet</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/archives/briup/briup-servlet.html" class="article-date">
  <time datetime="2022-05-12T15:12:01.000Z" itemprop="datePublished">2022-05-12</time>
</a>    
    </div>
     
	
	 
	
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="servlet（一）"><a href="#servlet（一）" class="headerlink" title="servlet（一）"></a>servlet（一）</h1><h2 id="1-JavaEE"><a href="#1-JavaEE" class="headerlink" title="1 JavaEE"></a>1 JavaEE</h2><h3 id="1-1-概述"><a href="#1-1-概述" class="headerlink" title="1.1 概述"></a>1.1 概述</h3><p>JavaEE，Java 平台企业版（Java Platform Enterprise Edition）是 Sun 公司为企业级应用推出的标准平台，用来开发B/S架构软件，可以说它是一种企业级应用开发规范。2018年3月更名为 Jakarta EE。（Oracle将JavaEE交给Eclipse基金会来维护）</p>
<p>JavaEE 5/6/7  版本都在oracle官网维护：</p>
<p><a target="_blank" rel="noopener" href="https://docs.oracle.com/javaee/7/">javaee 5/6/7</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132228230.png" alt="image-20200928160813377"></p>
<p>JavaEE 8 在oracle官网中也给出了介绍：</p>
<p><a target="_blank" rel="noopener" href="https://www.oracle.com/java/technologies/java-ee-glance.html">JavaEE 8</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132228198.png" alt="image-20200928161001881"></p>
<p>更多关于JavaEE新版本的动向，需要到JakartaEE官网上查看：</p>
<p><a target="_blank" rel="noopener" href="https://jakarta.ee/">JakartaEE</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132228767.png" alt="image-20200928161146662"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132228536.png" alt="image-20200928161250020"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132228814.png" alt="image-20200928161312140"></p>
<blockquote>
<p>可以看出，当前JakartaEE官网中，主推的是JakartaEE 8版本，同时JakartaEE 9也处于可用状态</p>
</blockquote>
<blockquote>
<p>虽然JavaEE已经更名为JakartaEE，但是现在大多数情况下，大家还是习惯叫它JavaEE</p>
</blockquote>
<h3 id="1-2-组成"><a href="#1-2-组成" class="headerlink" title="1.2 组成"></a>1.2 组成</h3><p>JavaEE 是企业级应用开发规范，它本身并不是一种技术，而是多种技术解决方案的集合，这些技术和解决方案，会涉及到企业级应用开发过程中，所遇到的各种各样的问题。</p>
<p>也就是说，使用java开发企业级应用的时候，如果遇到问题，可以使用JavaEE中，所指定的技术规范来进行问题的解决。但是一个问题的解决，一般会有很多种方案，JavaEE只是收录了其中一种方案，并制定成了规范标准。</p>
<p>例如，<strong>JavaEE 5 中的技术规范</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132228278.png" alt="image-20200928162515955"></p>
<blockquote>
<p>JavaEE中的每一种技术规范，都可以描述为JavaEE中的一种技术组件</p>
</blockquote>
<p>随着时代的进步，以及越来越多的公司和组织参与到Java世界，出现了各种各样的Java EE组件的代替者，比如Hibernate、Spring就是其中两个典型（第三方框架）。</p>
<p>同时，Java官方制定的一些Java EE技术规范并不太受欢迎，例如</p>
<ul>
<li>它们制定了JSF规范，但实际企业开发喜欢用Struts 2、Spring MVC；</li>
<li>它们制定了EJB规范，但实际企业开发往往还是喜欢用Spring；</li>
<li>它们制定了JPA规范，但实际企业开发往往还是喜欢直接用Hibernate、MyBatis。</li>
</ul>
<p>但是，JavaEE规范中，还是有一些非常重要的技术规范，成为javaEE被广泛使用的核心技术，例如Servlet、Jsp</p>
<p>除了，Servlet和Jsp之外，JavaEE中还有其他一些技术规范，其中核心的可以大致分为13种：</p>
<ul>
<li><p>JDBC(Java Database Connectivity)</p>
<p>JDBC API为访问不同的数据库提供了一种统一的途径</p>
</li>
<li><p>JNDI(Java Name and Directory Interface)</p>
<p>JNDI API被用于执行名字和目录服务</p>
</li>
<li><p>EJB(Enterprise JavaBean) </p>
<p>J2EE技术之所以赢得媒体广泛重视的原因之一就是EJB。它们提供了一个框架来开发和实施分布式商务逻辑，由此很显著地简化了具有可伸缩性和高度复杂的企业级应用的开发</p>
</li>
<li><p>RMI(Remote Method Invoke)</p>
<p>调用远程对象上的方法</p>
</li>
<li><p>Java IDL/CORBA</p>
<p>在Java IDL的支持下，开发人员可以将Java和CORBA集成在一起</p>
</li>
<li><p>JSP(Java Server Pages)</p>
<p>JSP页面由HTML代码和嵌入其中的Java代码所组成</p>
</li>
<li><p>Java Servlet</p>
<p>Servlet是一种Java程序，它扩展了Web服务器的功能，作为一种服务器端的应用，当被请求时开始执行。</p>
</li>
<li><p>XML(Extensible Markup Language)</p>
<p>Java中对XML的支持</p>
</li>
<li><p>JMS(Java Message Service)<br>JMS是用于和面向消息的中间件相互通信的应用程序接口</p>
</li>
<li><p>JTA(Java Transaction Architecture)</p>
<p>JTA定义了一种标准的API，应用系统由此可以访问各种事务监控</p>
</li>
<li><p>JTS(Java Transaction Service)<br>JTS事务管理器，对JTA提供支持和管理服务</p>
</li>
<li><p>JavaMail</p>
<p>JavaMail是用于存取邮件服务器的API，它提供了一套邮件服务器的抽象类</p>
</li>
<li><p>JAF(JavaBeans Activation Framework)</p>
<p>JavaMail可以利用JAF来处理MIME编码的邮件附件</p>
</li>
</ul>
<h3 id="1-3-区别"><a href="#1-3-区别" class="headerlink" title="1.3 区别"></a>1.3 区别</h3><p>在每一个JavaEE的版本中，会对一些指定的核心技术规范进行版本升级，或者新增一些技术规范</p>
<p>例如，<strong>JavaEE 7 中的技术规范</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132228790.png" alt="image-20200928164809409"></p>
<blockquote>
<p>其中，使用不同的颜色，表示出在此版本中，新增了哪些技术规范，以及哪些是可选的技术规范</p>
</blockquote>
<p>在官网中，会对JavaEE中，每项技术规范的版本罗列出来，并进行说明</p>
<p><a target="_blank" rel="noopener" href="https://www.oracle.com/java/technologies/javaee/javaeetechnologies.html#javaee7">JavaEE 7中技术规范版本</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132231046.png" alt="image-20200928165437589"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132231800.png" alt="image-20200928165535726"></p>
<blockquote>
<p>可以看出，这里列出了JavaEE 7中，关于web应用开发技术中，每项技术规范的版本</p>
</blockquote>
<p>下图是<strong>JavaEE 5</strong>中，对web开发技术中，每项技术规范的版本：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132231340.png" alt="image-20200928165737079"></p>
<blockquote>
<p>可以看出，JavaEE 5 和 JavaEE 7版本中，很多技术规范的版本的都有所升级</p>
</blockquote>
<p>JakartaEE官网中，对其新版本中的规范技术也有详细说明：</p>
<p><a target="_blank" rel="noopener" href="https://jakarta.ee/specifications/">JakartaEE官网版本说明</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132231316.png" alt="image-20200928170022610"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132231141.png" alt="image-20200928170055327"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132231332.png" alt="image-20200928170131504"></p>
<h3 id="1-4-选择"><a href="#1-4-选择" class="headerlink" title="1.4 选择"></a>1.4 选择</h3><p>在JavaEE技术规范中，我们主要关注的是Servlet和Jsp的版本，特别是Servlet，版本不同，会直接影响将来代码中功能实现的方式。这里，我们选择使用<strong>JavaEE 7</strong>中的<strong>Servlet3.1</strong>版本，这个也是当前使用最广泛的版本。</p>
<p>通过Maven中央仓库中的servlet依赖使用情况，也可以看出：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132232740.png" alt="image-20200928171345590"></p>
<blockquote>
<p>注意，一般情况下，高版本是会兼容低版本的功能的</p>
</blockquote>
<h3 id="1-5-下载"><a href="#1-5-下载" class="headerlink" title="1.5 下载"></a>1.5 下载</h3><p><a target="_blank" rel="noopener" href="https://download.oracle.com/otndocs/jcp/java_ee-7-fr-eval-spec/index.html">JavaEE 7官方说明文档下载</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132232860.png" alt="image-20200928171849967"></p>
<blockquote>
<p>注意，这个是JavaEE 7的总文档，里面包含各种技术组件的说明</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://download.oracle.com/otndocs/jcp/servlet-3_1-fr-eval-spec/index.html">Servlet3.1 官方文档下载</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132232934.png" alt="image-20200928171933203"></p>
<blockquote>
<p>注意，第一个是Servlet3.1的说明文档，第二个是Servlet3.1的API文档</p>
</blockquote>
<h3 id="1-6-容器"><a href="#1-6-容器" class="headerlink" title="1.6 容器"></a>1.6 容器</h3><p>通过前面的JavaEE技术组件图中，可以看出Servlet和Jsp，并不能像之前普通java程序一样，写一个main方法运行，而是需要将Servlet和Jsp程序，放到Web容器中运行：</p>
<p><strong>JavaEE 5中的技术组件图：</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132232449.png" alt="image-20200928172533726"></p>
<p><strong>JavaEE 7中的技术组件图：</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132232112.png" alt="image-20200928172504604"></p>
<p>Web容器，也称为Web Container，它其实是一个运行环境，它可以给Servlet和Jsp程序的运行，提供一个合适的运行环境。所以，将来在将web项目部署到服务器里面的时候，会要求服务器中含有<strong>web容器</strong>，以便支持Servlet和Jsp程序的运行。如果服务器中没有web容器，那么这个服务器中将不能运行servlet和jsp的程序。</p>
<p>一般情况下对服务器的描述有：</p>
<ul>
<li><p>web服务器</p>
<p>也称为web server或者http server，主要用于处理http请求以及返回响应。它可以处理请求，也可以将请求转发至其他服务器，多用于处理web中的静态资源。例如，Nginx 、apache</p>
</li>
<li><p>web容器</p>
<p>主要用于支持Servlet和Jsp的运行(没有主函数)，同时也可以处理http协议下的静态资源的访问，因为一般是在==web服务器中内嵌了web容器。例如，tomcat、jetty==</p>
</li>
<li><p>JavaEE应用服务器</p>
<p>它具备了 Web Server 处理http请求的能力（没有Web Server专业），同时也支持了JavaEE 技术组件，比如JMS、DI、JPA、Transactions、Concurrency等，同时也包含了Web Container。例如，WebLogic、WebSphere.(一般配合web服务器使用tomcat+nginx)</p>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132232595.png" alt="image-20200928195857793"></p>
<blockquote>
<p>后面，我们会选择tomcat作为web容器，去部署运行servlet和jsp相关的程序</p>
</blockquote>
<p>==思考，JavaEE、Servlet、Jsp、Web Container、tomcat这几者之间的关系是什么？==</p>
<h2 id="2-Tomcat"><a href="#2-Tomcat" class="headerlink" title="2 Tomcat"></a>2 Tomcat</h2><h3 id="2-1-概述"><a href="#2-1-概述" class="headerlink" title="2.1 概述"></a>2.1 概述</h3><p>Tomcat是由Apache基金组织维护的一款开源、免费、Java语言实现的web容器，同时它也是一个web服务器，支持Http协议下的资源访问（静态资源、动态资源）。</p>
<p>在Tomcat服务器中，可以部署web应用，然后对外提供Http协议下的资源访问</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132232808.png" alt="image-20200928202700541"></p>
<h3 id="2-2-下载"><a href="#2-2-下载" class="headerlink" title="2.2 下载"></a>2.2 下载</h3><p><a target="_blank" rel="noopener" href="https://tomcat.apache.org/">apache-tomcat官网</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132232498.png" alt="image-20200928202942725"></p>
<p>官网列出了tomcat和Servlet、Jsp等相关技术规范的版本关系：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132232937.png" alt="image-20200928203045326"></p>
<blockquote>
<p>可以看出，tomcat8.5刚好支持JavaEE 7里面的servlet3.1规范</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://tomcat.apache.org/download-80.cgi">tomcat 8.5下载</a></p>
<p>官网中分别提供了源码和编译后的软件下载：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132232866.png" alt="image-20200928203537201"></p>
<h3 id="2-3-安装"><a href="#2-3-安装" class="headerlink" title="2.3 安装"></a>2.3 安装</h3><p>将下载完成的压缩包，直接解压到文件中即可，例如</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132232776.png" alt="image-20200928203849722"></p>
<blockquote>
<p>注意，这个解压安装的路径中，不要有中文、空格、特殊符号等</p>
</blockquote>
<h3 id="2-4-目录"><a href="#2-4-目录" class="headerlink" title="2.4 目录"></a>2.4 目录</h3><p>tomcat解压后，每个目录的作用：</p>
<ul>
<li><p>bin目录，存放运行tomcat需要的命令文件</p>
<p>例如，tomcat启动和关闭的命令</p>
<p>windows中，startup.bat、shutdown.bat</p>
<p>Unix中，startup.sh、shutdown.sh</p>
</li>
<li><p>conf目录，存放tomcat相关的配置文件</p>
<p>其中最重要的一个配置文件就是server.xml</p>
<p>例如，在该文件中配置tomcat启动后监听的端口号</p>
</li>
<li><p>lib目录，存放项目运行时需要的jar包</p>
<p>这个目录中存放的是公共的jar包，部署到tomcat服务器中的多个web项目，可以共享这些jar包</p>
<p>例如，servlet-api.jar，在使用servlet规范编写代码的时候，需要该jar中的接口</p>
</li>
<li><p>logs目录，存放tomcat运行时的日志文件</p>
<p>tomcat把会运行时的重要信息记录下来</p>
<p>例如，tomcat中部署的web项目发生了严重错误</p>
</li>
<li><p>temp目录，存放tomcat运行时产生的临时文件</p>
<p>tomcat在运行期间，可能会产生一些临时文件，这些文件默认放到这个目录下</p>
</li>
<li><p>webapps目录，部署web项目的位置</p>
<p>把web项目部署到tomcat服务器中，其实就是把项目放到这个目录下面</p>
</li>
<li><p>work目录，编译Jsp页面后所存放的目录</p>
</li>
</ul>
<h3 id="2-5-端口"><a href="#2-5-端口" class="headerlink" title="2.5 端口"></a>2.5 端口</h3><p>tomcat启动后，会默认监听端口8080，如果和本机中的其他服务器程序(oracle)有冲突，可以在配置文件中进行修改：</p>
<p><code>conf/server.xml</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132232264.png" alt="image-20200928205335160"></p>
<p>例如，可以修改成8989</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132233106.png" alt="image-20200928205414023"></p>
<blockquote>
<p>注意，也可以修改成其它，自己想使用的端口号，和本地已有的程序没有冲突即可</p>
</blockquote>
<h3 id="2-6-运行"><a href="#2-6-运行" class="headerlink" title="2.6 运行"></a>2.6 运行</h3><p>因为tomcat软件是java编写的，所以在启动运行tomcat的时候，需要有JDK的支持，并且通过tomcat官网给出的版本关系图可知，当前使用的Tomcat 8.5 需要有JDK7或以上的版本支持。</p>
<p>第一步，安装JDK7或以上版本，并正确配置好JAVA_HOME，以便让Tomcat在启动时可以找到安装的JDK</p>
<p>第二步，运行bin目录下的启动文件即可（双击startup.bat）</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132233282.png" alt="image-20200928210142789"></p>
<blockquote>
<p>注意，如果出现命令窗口一闪而过，并且消失，那么很可能是JAVA_HOME配置问题</p>
</blockquote>
<blockquote>
<p>注意，这里出现日志显示乱码，是因为Windows中默认编码的问题</p>
</blockquote>
<h3 id="2-7-访问"><a href="#2-7-访问" class="headerlink" title="2.7 访问"></a>2.7 访问</h3><p>Tomcat成功启动后，可以使用URL地址，来访问部署到Tomcat中的web项目：</p>
<p><a target="_blank" rel="noopener" href="http://localhost:8989/your_project/resource_in_project">http://localhost:8989/your_project/resource_in_project</a><br><a target="_blank" rel="noopener" href="http://127.0.0.1:8989/your_project/resource_in_project">http://127.0.0.1:8989/your_project/resource_in_project</a></p>
<p>webapps目录是Tomcat中部署项目的位置，默认情况下，里面已经有了一些示例项目：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132233796.png" alt="image-20200928210721010"></p>
<blockquote>
<p>注意，webapps中，文件夹的名字，默认就是部署的项目名字</p>
</blockquote>
<p>例如，<a target="_blank" rel="noopener" href="http://127.0.0.1:8989/examples/index.html">http://127.0.0.1:8989/examples/index.html</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132233426.png" alt="image-20200928210821686"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132233211.png" alt="image-20200928210912034"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132233570.png" alt="image-20200928210928468"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132233217.png" alt="image-20200928210941237"></p>
<h3 id="2-8-关闭"><a href="#2-8-关闭" class="headerlink" title="2.8 关闭"></a>2.8 关闭</h3><p>tomcat启动后，如果关闭，可以直接运行bin目录下的shutdown.bat文件，或者在tomcat的运行窗口的右上角，直接点击叉号：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132233650.png" alt="image-20200928211342512"></p>
<blockquote>
<p>注意，双击shutdown.bat关闭服务器和点击叉号关闭服务器，俩种虽然都可以关闭，但是关闭的细节有所不同，特殊场景下会导出程序再次运行的结果不同，后面在实际操作过程中，会具体解释</p>
</blockquote>
<blockquote>
<p>注意，代码+环境+操作 = 正常的程序执行结果</p>
</blockquote>
<h2 id="3-Project"><a href="#3-Project" class="headerlink" title="3 Project"></a>3 Project</h2><h3 id="3-1-概述"><a href="#3-1-概述" class="headerlink" title="3.1 概述"></a>3.1 概述</h3><p>在Tomcat中，部署的Web项目，是有固定的结构要求的，假设以web-test项目为例，进行说明。</p>
<p>这里描述的是，把web项目部署到Tomcat中之后的目录结构，并不是项目在Eclipse中的结构，所以Eclipse帮我们部署项目的时候，其实是把原来的项目结构进行处理，变为tomcat中要求的项目结构，然后再部署到tomcat里面的webapps目录中的。</p>
<p>对应一个web项目（例如，web-test），部署后最基本的项目结构为：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">web-test/</span><br><span class="line">└─WEB-INF/</span><br><span class="line">    │  web.xml</span><br><span class="line">    │</span><br><span class="line">    ├─classes/</span><br><span class="line">    └─lib/</span><br></pre></td></tr></table></figure>

<p>其中，</p>
<p>web-test，它是项目的根目录，也是web项目的名字</p>
<ul>
<li>这里面一定要有子目录WEB-INF</li>
<li>除此之外，这里还可以存放web项目的静态资源（html、css、js、image）</li>
<li>这里还可以新建其它子目录</li>
</ul>
<p>WEB-INF，它是web项目中的核心目录，客户端浏览器是无法直接访问该目录下的资源</p>
<ul>
<li>classes，存放项目中编译好的class文件</li>
<li>lib，存放项目中使用到的第三方jar包（不会给其他tomcat部署的web项目共享）</li>
<li>web.xml，它是web项目中核心的配置文件，tomcat启动后会自动读取项目中web.xml文件</li>
</ul>
<h3 id="3-2-操作"><a href="#3-2-操作" class="headerlink" title="3.2 操作"></a>3.2 操作</h3><p>在桌面创建好web-test项目，其结构按照上面描述的规则。</p>
<p>然后进行以下操作，<strong>感受</strong>一个web项目编写、编译、部署、运行、访问的过程</p>
<p>1、新建index.html页面，存放到web-test项目目录下</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>index<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">h1</span>&gt;</span>hello world<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>2、在桌面创建java类（servlet）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> IOException, ServletException</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        response.setContentType(<span class="string">&quot;text/html&quot;</span>);</span><br><span class="line">        PrintWriter out = response.getWriter();</span><br><span class="line">        out.println(<span class="string">&quot;&lt;html&gt;&quot;</span>);</span><br><span class="line">        out.println(<span class="string">&quot;&lt;head&gt;&quot;</span>);</span><br><span class="line">        out.println(<span class="string">&quot;&lt;title&gt;index&lt;/title&gt;&quot;</span>);</span><br><span class="line">        out.println(<span class="string">&quot;&lt;/head&gt;&quot;</span>);</span><br><span class="line">        out.println(<span class="string">&quot;&lt;body&gt;&quot;</span>);</span><br><span class="line">        out.println(<span class="string">&quot;&lt;h1&gt;Hello World! briup&lt;/h1&gt;&quot;</span>);</span><br><span class="line">        out.println(<span class="string">&quot;&lt;/body&gt;&quot;</span>);</span><br><span class="line">        out.println(<span class="string">&quot;&lt;/html&gt;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>3、编译此java类（servlet）</p>
<p>当前类中，使用到了servlet规范，需要用到servlet-api.jar，此jar包在tomcat中lib里面中，所以在编译的时候，需要指定jar所在的路径：</p>
<p><code>javac -cp D:\briup\apache-tomcat-8.5.58\lib\servlet-api.jar -d . HelloWorld.java</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132233637.png" alt="image-20200928215132763"></p>
<p>4、将编译好的class文件，连同包对应的目录，一起剪切到WEB-INF下面的classes目录</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132233057.png" alt="image-20200928215359894"></p>
<p>5、配置web.xml</p>
<p>在tomcat的目录中，有web.xml文件的配置模板：conf/web.xml</p>
<p>复制过来，进行修改，如下</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee</span></span></span><br><span class="line"><span class="string"><span class="tag">                      http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">version</span>=<span class="string">&quot;3.1&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.briup.test.HelloWorld<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">    <span class="comment">&lt;!-- 当前浏览器访问web-test项目中的动态资源/hello-world的时候--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- tomcat会自动帮我们调用com.briup.test.HelloWorld中的方法来进行处理--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/hello-world<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<p>6、部署项目</p>
<p>将完成以上步骤的web-test项目，部署到tomcat中的webapps目录中。（复制过去即可）</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132234649.png" alt="image-20200928220234198"></p>
<p>7、启动</p>
<p>如果tomcat之前已经启动了，可以关闭后重写启动。</p>
<p>8、访问</p>
<p>先访问web-test项目中的静态资源</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:8989/web-test/index.html">http://127.0.0.1:8989/web-test/index.html</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132234796.png" alt="image-20200928220545658"></p>
<p>再访问web-test项目中的动态资源</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:8989/web-test/hello-world">http://127.0.0.1:8989/web-test/hello-world</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132234475.png" alt="image-20200928220623329"></p>
<h3 id="3-3-思考"><a href="#3-3-思考" class="headerlink" title="3.3 思考"></a>3.3 思考</h3><p>以上例子中，我们新建了一个java类<code>HelloWorld</code>，此类中并没有编写main方法，只有一个<code>doGet</code>方法，那么最后我们通过浏览器访问/hello-world路径的时候，该方法是怎么执行的？</p>
<p>大致思路如下：</p>
<ol>
<li>浏览器发送请求，访问web-test项目中的/hello-world资源</li>
<li>tomcat接收到请求，根据web.xml文件的配置信息，找到/hello-world对应的是com.briup.test.HelloWorld</li>
<li>tomcat创建HelloWorld类的对象（反射）</li>
<li>tomcat调用HelloWorld对象中的方法</li>
<li>最后doGet方法被执行，向浏览器写回一个html页面的源代码</li>
<li>浏览器接到tomcat写回来的html页面源代码，解析并显示出来</li>
</ol>
<h2 id="4-Eclipse"><a href="#4-Eclipse" class="headerlink" title="4 Eclipse"></a>4 Eclipse</h2><p>上面示例，是自己通过手动的方式，创建一个web项目，然后再进行编写、编译、部署、启动、运行。</p>
<p>同时，也可以使用Eclipse来简化以上操作的步骤</p>
<h3 id="4-1-关联"><a href="#4-1-关联" class="headerlink" title="4.1 关联"></a>4.1 关联</h3><p>在Eclipse中，新建服务器，关联外部解压的tomcat</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132234546.png" alt="image-20200928222557951"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132234299.png" alt="image-20200928222617948"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132234469.png" alt="image-20200928222700920"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132234155.png" alt="image-20200928222718421"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132234715.png" alt="image-20200928222756686"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132234340.png" alt="image-20200928222838990"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132234110.png" alt="image-20200928222859017"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132238143.png" alt="image-20200928223031128"></p>
<blockquote>
<p>此时，Eclipse中多了一个Servers的项目，里面是关联了外部tomcat的配置文件</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132234472.png" alt="image-20200928223226355"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132234871.png" alt="image-20200928223345650"></p>
<p>对默认配置进行修改，如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132234868.png" alt="image-20200928223455105"></p>
<blockquote>
<p>注意，第一个修改地方表示使用外部的tomcat的位置，第二个修改的地方表示web项目部署的位置</p>
</blockquote>
<p>如果还要修改端口号，也可以在这里修改：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132234951.png" alt="image-20200928224641385"></p>
<h3 id="4-2-启动"><a href="#4-2-启动" class="headerlink" title="4.2 启动"></a>4.2 启动</h3><p>启动之前，可以先把之前手动不是的web-test项目，从webapps目录中删除掉。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132234200.png" alt="image-20200928223607332"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132234606.png" alt="image-20200928224006472"></p>
<blockquote>
<p>控制台中，可以看到tomcat启动的日志信息</p>
</blockquote>
<h3 id="4-2-关闭"><a href="#4-2-关闭" class="headerlink" title="4.2 关闭"></a>4.2 关闭</h3><p>在Eclipse，关闭已经启动的Tomcat服务器，也很简单。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132234615.png" alt="image-20200928224358321"></p>
<p>或者，也可以点击console右上方的红点，直接停止JVM的运行，那么tomcat服务器也就停止了：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132234188.png" alt="image-20200928224457926"></p>
<h3 id="4-3-dynamic-web"><a href="#4-3-dynamic-web" class="headerlink" title="4.3 dynamic-web"></a>4.3 dynamic-web</h3><p>在Eclipse中，创建web项目，可以使用Eclipse中的动态web项目（dynamic  web）</p>
<h4 id="4-3-1-创建"><a href="#4-3-1-创建" class="headerlink" title="4.3.1 创建"></a>4.3.1 创建</h4><p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132234262.png" alt="image-20200928225125715"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132234892.png" alt="image-20200928225158905"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132235938.png" alt="image-20200928225449055"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132235761.png" alt="image-20200928225547450"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132235870.png" alt="image-20200928225750688"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132235462.png" alt="image-20200928230110222"></p>
<p>如果之前没有打钩自动生成web.xml文件，这时候也可以点击项目然后自动生成：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132235958.png" alt="image-20200928230230925"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132235431.png" alt="image-20200928230339161"></p>
<blockquote>
<p>注意，如果需要关联servlet-api.jar的源代码，可以直接将apache-tomcat-8.5.58-src.zip配置关联过去即可</p>
</blockquote>
<h4 id="4-3-2-编写"><a href="#4-3-2-编写" class="headerlink" title="4.3.2 编写"></a>4.3.2 编写</h4><p>项目中，src里面是编写java源代码的地方</p>
<p><code>HelloWorld</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/hello-world&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		</span><br><span class="line">		resp.setContentType(<span class="string">&quot;text/html&quot;</span>);</span><br><span class="line">        PrintWriter out = resp.getWriter();</span><br><span class="line">        out.println(<span class="string">&quot;&lt;html&gt;&quot;</span>);</span><br><span class="line">        out.println(<span class="string">&quot;&lt;head&gt;&quot;</span>);</span><br><span class="line">        out.println(<span class="string">&quot;&lt;title&gt;index&lt;/title&gt;&quot;</span>);</span><br><span class="line">        out.println(<span class="string">&quot;&lt;/head&gt;&quot;</span>);</span><br><span class="line">        out.println(<span class="string">&quot;&lt;body&gt;&quot;</span>);</span><br><span class="line">        out.println(<span class="string">&quot;&lt;h1&gt;Hello World! dynamic web&lt;/h1&gt;&quot;</span>);</span><br><span class="line">        out.println(<span class="string">&quot;&lt;/body&gt;&quot;</span>);</span><br><span class="line">        out.println(<span class="string">&quot;&lt;/html&gt;&quot;</span>);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这里使用一个注解 <code>@WebServlet</code>，来代替了之前web.xml中的配置，其效果是一样的</p>
</blockquote>
<p>==思考，这里用到的servlet规范，在servlet-api.jar里面，此jar在什么地方，该项目是怎么引入的？==</p>
<p>项目中，WebContent里面是编写页面的地方</p>
<p><code>index.html</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>index<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">h1</span>&gt;</span>hello world!dynamic web<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132235327.png" alt="image-20200928231330732"></p>
<h4 id="4-3-3-部署"><a href="#4-3-3-部署" class="headerlink" title="4.3.3 部署"></a>4.3.3 部署</h4><p>仔细观察会发现，此时Eclipse中的web项目结构，和要求的部署到Tomcat中的项目结构，是有所不同的，那么在部署的时候，Eclipse里会进行自动处理，因为Eclipse中对项目的部署做映射配置：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132235095.png" alt="image-20200928231721322"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132235815.png" alt="image-20200928231953209"></p>
<blockquote>
<p>默认情况下，Eclipse已经把当前的项目结构，和最后部署到Tomcat中的项目结构的对应关系，都配置好了</p>
</blockquote>
<p><strong>接下来部署项目：</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132235359.png" alt="image-20200928232133403"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132235343.png" alt="image-20200928232144212"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132235486.png" alt="image-20200928232157368"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132235319.png" alt="image-20200928232217507"></p>
<h4 id="4-3-4-启动"><a href="#4-3-4-启动" class="headerlink" title="4.3.4 启动"></a>4.3.4 启动</h4><p>部署完成后，就可以启动tomcat了</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132235248.png" alt="image-20200928232300519"></p>
<p>启动成功后，观察tomcat中的webapps目录里面，是否已经完成了项目部署：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132235713.png" alt="image-20200928232422146"></p>
<h4 id="4-3-5-访问"><a href="#4-3-5-访问" class="headerlink" title="4.3.5 访问"></a>4.3.5 访问</h4><p>访问静态资源：</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:8989/dynamic-web/index.html">http://127.0.0.1:8989/dynamic-web/index.html</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132235992.png" alt="image-20200928232510037"></p>
<p>访问动态资源：</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:8989/dynamic-web/hello-world">http://127.0.0.1:8989/dynamic-web/hello-world</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132236656.png" alt="image-20200928232537584"></p>
<h4 id="4-3-6-移除"><a href="#4-3-6-移除" class="headerlink" title="4.3.6 移除"></a>4.3.6 移除</h4><p>项目如果不需要运行了，还可以从tomcat的部署中移除：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132236980.png" alt="image-20200928232644327"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132236319.png" alt="image-20200928232716802"></p>
<p>观察tomcat中的webapps目录中是否已经将当前项目给移除：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132236234.png" alt="image-20200928232744989"></p>
<p>因为项目移除了，此时浏览器访问会出现404，资源找不到的情况：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132236145.png" alt="image-20200928233122326"></p>
<h3 id="4-4-maven-web"><a href="#4-4-maven-web" class="headerlink" title="4.4 maven-web"></a>4.4 maven-web</h3><p>在Eclipse中，创建web项目，还可以使用maven项目</p>
<h4 id="4-4-1-创建"><a href="#4-4-1-创建" class="headerlink" title="4.4.1 创建"></a>4.4.1 创建</h4><p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132236632.png" alt="image-20200928233325758"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132236128.png" alt="image-20200928233343830"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132236653.png" alt="image-20200928233530045"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132236351.png" alt="image-20200928233606264"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132236439.png" alt="image-20200928234300664"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132236000.png" alt="image-20220512103524555"></p>
<p>在webapp中，新建目录WEB-INF，里面在新建web.xml</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132236616.png" alt="image-20200928234426964"></p>
<p><code>web.xml</code> 文件内容： </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">version</span>=<span class="string">&quot;3.1&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">display-name</span>&gt;</span>maven-web<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>可以复制之前的web.xml，修改下即可</p>
</blockquote>
<p>配置pom.xml文件，指定maven项目的JDK版本、项目编码、以及相关项目依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.briup.test<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 引入servlet3.1的依赖 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">        <span class="comment">&lt;!-- 引入jstl的依赖，jsp页面中会使用到 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这里将servlet的依赖范围（scope）设置为了provided，因为tomcat的lib目录中也有这个jar包，将来部署的时候，使用tomcat自带的jar包即可</p>
</blockquote>
<p>修改完这些配置后，记得对maven项目进行update操作：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132236897.png" alt="image-20200928234927413"></p>
<p>此时，maven项目中就不会报错了：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132236135.png" alt="image-20200928235011223"></p>
<blockquote>
<p>注意，因为maven项目中会对web.xml文件进行验证，从网络上下载schame，但是可能会因为网络原因下载验证失败，导致maven项目还会报错，这个错误不影响运行，或多更新几次项目就可以了。</p>
</blockquote>
<blockquote>
<p>注意，此时的maven项目并没有像动态web项目一样，引用了tomcat的运行环境，而且我们在pom文件中，自己添加了依赖，将需要用的的servlet-api.jar引入了进来</p>
</blockquote>
<h4 id="4-4-2-编写"><a href="#4-4-2-编写" class="headerlink" title="4.4.2 编写"></a>4.4.2 编写</h4><p>在maven项目中，完成和上面项目中一样的功能，进行测试。</p>
<p>项目中，src/main/java里面是编写java源代码的地方</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/hello-world&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		</span><br><span class="line">		resp.setContentType(<span class="string">&quot;text/html&quot;</span>);</span><br><span class="line">        PrintWriter out = resp.getWriter();</span><br><span class="line">        out.println(<span class="string">&quot;&lt;html&gt;&quot;</span>);</span><br><span class="line">        out.println(<span class="string">&quot;&lt;head&gt;&quot;</span>);</span><br><span class="line">        out.println(<span class="string">&quot;&lt;title&gt;index&lt;/title&gt;&quot;</span>);</span><br><span class="line">        out.println(<span class="string">&quot;&lt;/head&gt;&quot;</span>);</span><br><span class="line">        out.println(<span class="string">&quot;&lt;body&gt;&quot;</span>);</span><br><span class="line">        out.println(<span class="string">&quot;&lt;h1&gt;Hello World! maven web&lt;/h1&gt;&quot;</span>);</span><br><span class="line">        out.println(<span class="string">&quot;&lt;/body&gt;&quot;</span>);</span><br><span class="line">        out.println(<span class="string">&quot;&lt;/html&gt;&quot;</span>);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这里输出的是maven web，之前上个例子有所不同</p>
</blockquote>
<p>项目中，webapp里面是编写页面的地方</p>
<p><code>index.html</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>index<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">h1</span>&gt;</span>hello world!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132236069.png" alt="image-20200928235843519"></p>
<h4 id="4-4-3-部署"><a href="#4-4-3-部署" class="headerlink" title="4.4.3 部署"></a>4.4.3 部署</h4><p>Eclipse中，也对Maven项目，做了部署映射，可以将maven项目的结构，转换为Tomcat中部署项目的结构要求：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132236836.png" alt="image-20200929000015319"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132237705.png" alt="image-20200929000050330"></p>
<blockquote>
<p>所以，maven项目的结构虽然和Tomcat中部署项目的结构有很大区别，但是最终部署完成后，还是会变成最终要求的项目结构</p>
</blockquote>
<p>接下来进行项目的部署：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132237905.png" alt="image-20200929000230541"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132237642.png" alt="image-20200929000304499"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132237468.png" alt="image-20200929000325275"></p>
<h4 id="4-4-4-启动"><a href="#4-4-4-启动" class="headerlink" title="4.4.4 启动"></a>4.4.4 启动</h4><p>部署完成后，就可以启动tomcat了，如果已经启动了，也可以重启一次。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132237020.png" alt="image-20200929000447419"></p>
<p>启动成功后，观察tomcat中的webapps目录里面，是否已经完成了项目部署：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132237794.png" alt="image-20200929000522218"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132237331.png" alt="image-20220512110054611"></p>
<h4 id="4-4-5-访问"><a href="#4-4-5-访问" class="headerlink" title="4.4.5 访问"></a>4.4.5 访问</h4><p>访问静态资源：</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:8989/maven-web/index.html">http://127.0.0.1:8989/maven-web/index.html</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132237115.png" alt="image-20200929000612531"></p>
<p>访问动态资源：</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:8989/maven-web/hello-world">http://127.0.0.1:8989/maven-web/hello-world</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132237403.png" alt="image-20200929000712569"></p>
<h4 id="4-4-6-移除"><a href="#4-4-6-移除" class="headerlink" title="4.4.6 移除"></a>4.4.6 移除</h4><p>项目如果不需要运行了，还可以从tomcat的部署中移除：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132237499.png" alt="image-20200929000824385"></p>
<blockquote>
<p>注意，如果tomact还在运行期间，把项目移除了，可能会导致控制台中输出错误信息，但是这个影响，重新启动tomcat就可以了。</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132237805.png" alt="image-20200929000934737"></p>
<p>观察tomcat中的webapps目录中是否已经将当前项目给移除：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132237141.png" alt="image-20200929001001172"></p>
<p>因为项目移除了，此时浏览器访问会出现404，资源找不到的情况：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132237814.png" alt="image-20200929001046633"></p>
<h2 id="5-Http"><a href="#5-Http" class="headerlink" title="5 Http"></a>5 Http</h2><blockquote>
<p>在上面的测试中，客户端浏览器和tomcat服务器进行访问交互，其采用的协议是http，该协议规定了客户端和服务器之间的交互方式，以及交互内容的格式要求。</p>
</blockquote>
<h3 id="5-1-概述"><a href="#5-1-概述" class="headerlink" title="5.1 概述"></a>5.1 概述</h3><p>超文本传输协议 (HTTP-Hypertext transfer protocol) 是一种详细规定了浏览器和万维网服务器之间互相通信的规则，通过因特网传送万维网文档的数据传送协议。HTTP是一个应用层协议，由请求和响应构成，是一个标准的客户端服务器模型。</p>
<h3 id="5-2-交互方式"><a href="#5-2-交互方式" class="headerlink" title="5.2 交互方式"></a>5.2 交互方式</h3><p>http协议规定，默认情况下：</p>
<ul>
<li>先由客户端（浏览器）向服务器（tomcat）发送请求（request）</li>
<li>服务器接收到请求后，根据请求的资源路径，在服务器内部部署的项目中，查找是否有该资源</li>
<li>如果该资源存在，那么服务器就会将该资源返回（静态资源），或者把该资源的运行结果返回（动态资源）</li>
<li>如果该资源不存在，那么服务器就会返回一个状态码（404），表示本次访问的资源找不到</li>
<li>不管资源存在还是不存在，服务器都会针对这次请求，返回一个结果，这个结果就被称之为响应（response）</li>
<li>客户端（浏览器）接收到本次请求的响应内容后，解析并显示出来</li>
</ul>
<p>此时，本次http协议下的访问结束。用户还可以再次发出请求，那么就重复上述过程。</p>
<h3 id="5-3-内容格式"><a href="#5-3-内容格式" class="headerlink" title="5.3 内容格式"></a>5.3 内容格式</h3><blockquote>
<p>无论是客户端发送的请求内容，还是服务器返回的响应内容，在http协议中，都是有固定的格式要求的。</p>
</blockquote>
<h4 id="5-3-1-请求"><a href="#5-3-1-请求" class="headerlink" title="5.3.1 请求"></a>5.3.1 请求</h4><p>客户端发送到服务器端的请求消息，称之为请求(request)，其实就是一个按照http协议的规则拼接而成的字符串</p>
<p>Request请求消息包含三部分：</p>
<ul>
<li>请求行，request line</li>
<li>消息报头（请求头），request head</li>
<li>请求正文，request body</li>
</ul>
<p><strong>1、请求行，request line</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//格式: CRLF表示回车和换行</span><br><span class="line">Method Request-URI HTTP-Version CRLF</span><br></pre></td></tr></table></figure>

<ul>
<li>Method表示请求方法；一般为GET或者POST</li>
<li>Request-URI是一个统一资源标识符，本次请求的资源路径</li>
<li>HTTP-Version表示请求的HTTP协议版本，HTTP/1.1</li>
</ul>
<p>例如，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /test.html HTTP/1.1</span><br></pre></td></tr></table></figure>



<p><strong>2、消息报头（请求头），request head</strong></p>
<blockquote>
<p>注意，此部分作为了解，遇到具体情况再进行查阅即可</p>
</blockquote>
<p>http请求报头的生成，主要有三种情况：</p>
<ul>
<li><p>浏览器自动生成的请求</p>
<p>绝大部分正常用户访问都是这类情况，只要是用户主动输入网址访问时发送的http请求，那这些头部字段都是浏览器自动生成的，比如host，cookie，user-agent, Accept-Encoding:等</p>
</li>
<li><p>浏览器插件</p>
<p>javascript脚本增加或者修改的header。JS能够控制浏览器发起请求，也能在这里增加一些header，但是考虑到安全和性能的原因，对JS控制 header的能力做了一些限制，比如host和cookie, user-agent等这些字段，JS是无法干预的</p>
</li>
<li><p>中间代理</p>
<p>如果用户请求要经过一些中间代理（比如运营商或者公司网关），中间代理能够查看和修改用户的全部数据和任何头部字段。除非使用了HTTPS</p>
</li>
</ul>
<p>http消息报头包括普通报头、请求报头、响应报头、实体报头这四大类，它们的作用是描述 客户端或者服务器 的属性，并且都是由 名字+冒号+空格+值 组成，例如， Content-Type: text/html</p>
<ul>
<li><p>普通报头</p>
<p>即可用于请求，也可用于响应，是作为一个整体而不是特定资源与事务相关联</p>
<p>例如，</p>
<p>Cache-Control<br>Connection<br>Date<br>Pragma<br>Transfer-Encoding<br>Upgrade<br>Via</p>
</li>
<li><p>请求报头</p>
<p>允许客户端传递关于自身信息和希望的响应形式</p>
<p>例如，</p>
<p>Accept<br>Accept-Charset<br>Accept-Encoding<br>Accept-Language<br>Authorization<br>Host<br>User-Agent<br>From<br>If-Modified-Since<br>If-Match<br>If-None-Match<br>If-Range<br>If-Unmodified-Since<br>Max-Forwards<br>Proxy-Authorization<br>Range<br>Referer</p>
</li>
<li><p>响应报头</p>
<p>允许服务器传递关于自身信息的响应</p>
<p>例如，</p>
<p>Location<br>Server<br>WWW-Authenticate<br>Age<br>Proxy-Authenticate<br>Public<br>Retry-After<br>Vary<br>Warning</p>
</li>
<li><p>实体报头</p>
<p>定义被传送资源的信息。即可用于请求，也可用于响应</p>
<p>例如，</p>
<p>Content-Encoding<br>Content-Language<br>Content-Length<br>Content-Type<br>Last-Modified<br>Expires<br>Allow<br>Content-Base<br>Content-Location<br>Content-MD5<br>Content-Range<br>Etag<br>extension-header</p>
</li>
</ul>
<p>例如:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GET /test.html HTTP/1.1</span><br><span class="line">Host: 127.0.0.1:9999</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:47.0) Gecko/20100101 Firefox/47.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,en;q=0.8,zh;q=0.5,en-US;q=0.3</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: keep-alive</span><br></pre></td></tr></table></figure>

<p>​        </p>
<p>具体的可以在浏览器的web控制台中，进行查看</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132237163.png" alt="image-20200929004449654"></p>
<p><strong>3、请求正文，request body</strong></p>
<p>请求头和请求正文之间是一个空行，这个行非常重要，它表示请求头已经结束，接下来的是请求正文。</p>
<p>请求正文中可以包含客户提交的字符串信息</p>
<p>例如，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">POST /test.html HTTP/1.1</span><br><span class="line">Host: 127.0.0.1:9999</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:47.0) Gecko/20100101 Firefox/47.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,en;q=0.8,zh;q=0.5,en-US;q=0.3</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: keep-alive</span><br><span class="line"></span><br><span class="line">id=1&amp;name=tom&amp;age=20</span><br></pre></td></tr></table></figure>



<h4 id="5-3-2-响应"><a href="#5-3-2-响应" class="headerlink" title="5.3.2 响应"></a>5.3.2 响应</h4><p>服务器在接收和解析客户端的请求消息后，会返回给客户端一个HTTP响应消息（response）。</p>
<p>其实也是一个按照http协议的规则拼接而成的一个字符串。</p>
<p>HTTP响应也是由三个部分组成：</p>
<ul>
<li>响应状态行，response status line</li>
<li>消息报头（响应头），response head</li>
<li>响应正文，response body</li>
</ul>
<p><strong>1、响应状态行，response status line</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//格式如下：CRLF表示回车和换行</span><br><span class="line">HTTP-Version Status-Code Reason-Phrase CRLF</span><br></pre></td></tr></table></figure>

<ul>
<li>HTTP-Version表示服务器HTTP协议的版本</li>
<li>Status-Code表示服务器发回的响应状态代码</li>
<li>Reason-Phrase表示状态代码的文本描述</li>
</ul>
<p>例如，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br></pre></td></tr></table></figure>



<p>关于响应状态代码，共分为5种类型：</p>
<table>
<thead>
<tr>
<th align="left">分类</th>
<th align="left">分类描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1xx</td>
<td align="left">信息，服务器收到请求，需要请求者继续执行操作</td>
</tr>
<tr>
<td align="left">2xx</td>
<td align="left">成功，操作被成功接收并处理</td>
</tr>
<tr>
<td align="left">3xx</td>
<td align="left">重定向，需要进一步的操作以完成请求</td>
</tr>
<tr>
<td align="left">4xx</td>
<td align="left">客户端错误，请求包含语法错误或无法完成请求</td>
</tr>
<tr>
<td align="left">5xx</td>
<td align="left">服务器错误，服务器在处理请求的过程中发生了错误</td>
</tr>
</tbody></table>
<p><strong>HTTP状态码列表</strong></p>
<table>
<thead>
<tr>
<th align="left">状态码</th>
<th align="left">状态码英文名称</th>
<th align="left">中文描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">100</td>
<td align="left">Continue</td>
<td align="left">继续。客户端应继续其请求</td>
</tr>
<tr>
<td align="left">101</td>
<td align="left">Switching Protocols</td>
<td align="left">切换协议。服务器根据客户端的请求切换协议。只能切换到更高级的协议，例如，切换到HTTP的新版本协议</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">200</td>
<td align="left">OK</td>
<td align="left">请求成功。一般用于GET与POST请求</td>
</tr>
<tr>
<td align="left">201</td>
<td align="left">Created</td>
<td align="left">已创建。成功请求并创建了新的资源</td>
</tr>
<tr>
<td align="left">202</td>
<td align="left">Accepted</td>
<td align="left">已接受。已经接受请求，但未处理完成</td>
</tr>
<tr>
<td align="left">203</td>
<td align="left">Non-Authoritative Information</td>
<td align="left">非授权信息。请求成功。但返回的meta信息不在原始的服务器，而是一个副本</td>
</tr>
<tr>
<td align="left">204</td>
<td align="left">No Content</td>
<td align="left">无内容。服务器成功处理，但未返回内容。在未更新网页的情况下，可确保浏览器继续显示当前文档</td>
</tr>
<tr>
<td align="left">205</td>
<td align="left">Reset Content</td>
<td align="left">重置内容。服务器处理成功，用户终端（例如：浏览器）应重置文档视图。可通过此返回码清除浏览器的表单域</td>
</tr>
<tr>
<td align="left">206</td>
<td align="left">Partial Content</td>
<td align="left">部分内容。服务器成功处理了部分GET请求</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">300</td>
<td align="left">Multiple Choices</td>
<td align="left">多种选择。请求的资源可包括多个位置，相应可返回一个资源特征与地址的列表用于用户终端（例如：浏览器）选择</td>
</tr>
<tr>
<td align="left">301</td>
<td align="left">Moved Permanently</td>
<td align="left">永久移动。请求的资源已被永久的移动到新URI，返回信息会包括新的URI，浏览器会自动定向到新URI。今后任何新的请求都应使用新的URI代替</td>
</tr>
<tr>
<td align="left">302</td>
<td align="left">Found</td>
<td align="left">临时移动。与301类似。但资源只是临时被移动。客户端应继续使用原有URI</td>
</tr>
<tr>
<td align="left">303</td>
<td align="left">See Other</td>
<td align="left">查看其它地址。与301类似。使用GET和POST请求查看</td>
</tr>
<tr>
<td align="left">304</td>
<td align="left">Not Modified</td>
<td align="left">未修改。所请求的资源未修改，服务器返回此状态码时，不会返回任何资源。客户端通常会缓存访问过的资源，通过提供一个头信息指出客户端希望只返回在指定日期之后修改的资源</td>
</tr>
<tr>
<td align="left">305</td>
<td align="left">Use Proxy</td>
<td align="left">使用代理。所请求的资源必须通过代理访问</td>
</tr>
<tr>
<td align="left">306</td>
<td align="left">Unused</td>
<td align="left">已经被废弃的HTTP状态码</td>
</tr>
<tr>
<td align="left">307</td>
<td align="left">Temporary Redirect</td>
<td align="left">临时重定向。与302类似。使用GET请求重定向</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">400</td>
<td align="left">Bad Request</td>
<td align="left">客户端请求的语法错误，服务器无法理解</td>
</tr>
<tr>
<td align="left">401</td>
<td align="left">Unauthorized</td>
<td align="left">请求要求用户的身份认证</td>
</tr>
<tr>
<td align="left">402</td>
<td align="left">Payment Required</td>
<td align="left">保留，将来使用</td>
</tr>
<tr>
<td align="left">403</td>
<td align="left">Forbidden</td>
<td align="left">服务器理解请求客户端的请求，但是拒绝执行此请求</td>
</tr>
<tr>
<td align="left">404</td>
<td align="left">Not Found</td>
<td align="left">服务器无法根据客户端的请求找到资源（网页）。通过此代码，网站设计人员可设置”您所请求的资源无法找到”的个性页面</td>
</tr>
<tr>
<td align="left">405</td>
<td align="left">Method Not Allowed</td>
<td align="left">客户端请求中的方法被禁止</td>
</tr>
<tr>
<td align="left">406</td>
<td align="left">Not Acceptable</td>
<td align="left">服务器无法根据客户端请求的内容特性完成请求</td>
</tr>
<tr>
<td align="left">407</td>
<td align="left">Proxy Authentication Required</td>
<td align="left">请求要求代理的身份认证，与401类似，但请求者应当使用代理进行授权</td>
</tr>
<tr>
<td align="left">408</td>
<td align="left">Request Time-out</td>
<td align="left">服务器等待客户端发送的请求时间过长，超时</td>
</tr>
<tr>
<td align="left">409</td>
<td align="left">Conflict</td>
<td align="left">服务器完成客户端的PUT请求是可能返回此代码，服务器处理请求时发生了冲突</td>
</tr>
<tr>
<td align="left">410</td>
<td align="left">Gone</td>
<td align="left">客户端请求的资源已经不存在。410不同于404，如果资源以前有现在被永久删除了可使用410代码，网站设计人员可通过301代码指定资源的新位置</td>
</tr>
<tr>
<td align="left">411</td>
<td align="left">Length Required</td>
<td align="left">服务器无法处理客户端发送的不带Content-Length的请求信息</td>
</tr>
<tr>
<td align="left">412</td>
<td align="left">Precondition Failed</td>
<td align="left">客户端请求信息的先决条件错误</td>
</tr>
<tr>
<td align="left">413</td>
<td align="left">Request Entity Too Large</td>
<td align="left">由于请求的实体过大，服务器无法处理，因此拒绝请求。为防止客户端的连续请求，服务器可能会关闭连接。如果只是服务器暂时无法处理，则会包含一个Retry-After的响应信息</td>
</tr>
<tr>
<td align="left">414</td>
<td align="left">Request-URI Too Large</td>
<td align="left">请求的URI过长（URI通常为网址），服务器无法处理</td>
</tr>
<tr>
<td align="left">415</td>
<td align="left">Unsupported Media Type</td>
<td align="left">服务器无法处理请求附带的媒体格式</td>
</tr>
<tr>
<td align="left">416</td>
<td align="left">Requested range not satisfiable</td>
<td align="left">客户端请求的范围无效</td>
</tr>
<tr>
<td align="left">417</td>
<td align="left">Expectation Failed</td>
<td align="left">服务器无法满足Expect的请求头信息</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">500</td>
<td align="left">Internal Server Error</td>
<td align="left">服务器内部错误，无法完成请求</td>
</tr>
<tr>
<td align="left">501</td>
<td align="left">Not Implemented</td>
<td align="left">服务器不支持请求的功能，无法完成请求</td>
</tr>
<tr>
<td align="left">502</td>
<td align="left">Bad Gateway</td>
<td align="left">作为网关或者代理工作的服务器尝试执行请求时，从远程服务器接收到了一个无效的响应</td>
</tr>
<tr>
<td align="left">503</td>
<td align="left">Service Unavailable</td>
<td align="left">由于超载或系统维护，服务器暂时的无法处理客户端的请求。延时的长度可包含在服务器的Retry-After头信息中</td>
</tr>
<tr>
<td align="left">504</td>
<td align="left">Gateway Time-out</td>
<td align="left">充当网关或代理的服务器，未及时从远端服务器获取请求</td>
</tr>
<tr>
<td align="left">505</td>
<td align="left">HTTP Version not supported</td>
<td align="left">服务器不支持请求的HTTP协议的版本，无法完成处理</td>
</tr>
</tbody></table>
<p><strong>常见状态码&amp;含义</strong></p>
<pre><code> 200 - 请求成功，已经正常处理完毕
</code></pre>
<p>​    301 - 请求永久重定向，转移到其它URL</p>
<p>​    302 - 请求临时重定向</p>
<p>​    304 - 请求被重定向到客户端本地缓存</p>
<p>​    400 - 客户端请求存在语法错误</p>
<p>​    401 - 客户端请求没有经过授权</p>
<p>​    403 - 客户端的请求被服务器拒绝，一般为客户端没有访问权限</p>
<p>​    404 - 客户端请求的URL在服务端不存在</p>
<p>​    500 - 服务端错误</p>
<p><strong>2、消息报头（响应头），response head</strong></p>
<p>和请求报头中的描述一致。</p>
<p>额外的，在响应的消息报头中，一般都会有Content-Type字段，用来告诉浏览器，本次响应回去的内容是什么类型的数据，浏览器可以根据就这个对内容进行解析。</p>
<p>例如，如果响应的数据是html，则响应报头中应该有，<code>Content-Type: text/html</code></p>
<p>例如，如果响应的数据是xml，则响应报头中应该有，<code>Content-Type: text/xml</code></p>
<p>例如，如果响应的数据是普通文本，则响应报头中应该有，<code>Content-Type: text/plain</code></p>
<p>例如，如果响应的数据是png图片，则响应报头中应该有，<code>Content-Type: image/png</code></p>
<p><strong>3、响应正文，response body</strong></p>
<p>响应正文就是服务器返回的资源的内容，响应正文和消息报头之间也需要有一个空行！</p>
<p>例如，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: text/html;charset=ISO-8859-1</span><br><span class="line">Content-Length: 106</span><br><span class="line">Date: Mon, 28 Sep 2020 16:59:15 GMT</span><br><span class="line">Keep-Alive: timeout=20</span><br><span class="line">Connection: keep-alive</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;index&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Hello World! maven web&lt;/h1&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>



<p>具体的可以在浏览器的控制台中查看：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132238815.png" alt="image-20200929010159867"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132239046.png" alt="image-20200929010227874"></p>
<h1 id="servlet（二）"><a href="#servlet（二）" class="headerlink" title="servlet（二）"></a>servlet（二）</h1><h2 id="1-实现方式"><a href="#1-实现方式" class="headerlink" title="1 实现方式"></a>1 实现方式</h2><h3 id="1-1-概述-1"><a href="#1-1-概述-1" class="headerlink" title="1.1 概述"></a>1.1 概述</h3><p>Servlet技术可以扩展服务器端的功能，让java代码在服务器端也能成为一种资源（动态资源），客户端浏览器可以通过指定的资源地址（URI），来访问这个java代码（Servlet），同时在Servlet代码中，还可以使用IO流把结果写回给浏览器。</p>
<p>按照Servlet规范要求，编写一个Servlet程序，只需要让自己的类实现<code>javax.servlet.Servlet</code>接口就可以了，但是该接口也有一些默认的实现类，所以除了实现接口的方式之外，我们也可以继承它默认的几个实现类，并且重写指定方法，也同样可以完成Servlet程序的编写。</p>
<h3 id="1-2-Servlet"><a href="#1-2-Servlet" class="headerlink" title="1.2 Servlet"></a>1.2 Servlet</h3><p><code>javax.servlet.Servlet</code></p>
<p>它是Servlet技术的核心接口，所有的Servlet程序，都必须是该接口的实现类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> javax.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Servlet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//初始化servlet对象的时候被调用</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(ServletConfig config)</span> <span class="keyword">throws</span> ServletException</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//返回ServletConfig对象,该对象封装了Servlet的配置信息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServletConfig <span class="title">getServletConfig</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//访问servlet对象的时候被调用（最重要的方法）</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(ServletRequest req, ServletResponse res)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//返回servlet相关信息,比如作者、版本、版权等</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getServletInfo</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//销毁servlet对象的时候被调用</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>在这五个方法中，最重要的是 <code>service(ServletRequest req, ServletResponse res)</code>方法，因为当客户端浏览器通过指定地址访问该Servlet的时候，Tomcat会自动调用Servlet中的service方法。</p>
<p>service方法的作用就是处理客户端浏览器发送的请求，并且写回本次请求的响应内容，所以我们在重写的service方法中，可以按照当前的功能需求，来完成代码的编写。</p>
<p>例如，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.Servlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletConfig;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloServlet</span> <span class="keyword">implements</span> <span class="title">Servlet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(ServletConfig config)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ServletConfig <span class="title">getServletConfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(ServletRequest req, ServletResponse res)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		</span><br><span class="line">        <span class="comment">//接收请求中携带的参数，指定参数名为name</span></span><br><span class="line">		String name = req.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">		</span><br><span class="line">        <span class="comment">//设置本次响应回去内容的类型，并且指定了编码，这是给浏览器看的</span></span><br><span class="line">		res.setContentType(<span class="string">&quot;text/plain;charset=utf-8&quot;</span>);</span><br><span class="line">		</span><br><span class="line">        <span class="comment">//通过响应对象获取输出流</span></span><br><span class="line">		PrintWriter out = res.getWriter();</span><br><span class="line">		</span><br><span class="line">        <span class="comment">//给浏览器写回内容</span></span><br><span class="line">		out.println(<span class="string">&quot;hello! &quot;</span>+name);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getServletInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><code>web.xml</code>中进行配置，目的是为了告诉tomcat，这个servlet对应的URI地址是什么，其实就是一种映射关系的配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">version</span>=<span class="string">&quot;3.1&quot;</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.briup.test.HelloServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/hello<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>





<p>通过url地址访问此Servlet，并且携带参数：</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:8989/servlet-test/hello?name=tom">http://127.0.0.1:8989/servlet-test/hello?name=tom</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132226977.png" alt="image-20200929165014319"></p>
<blockquote>
<p>可以看出，响应头信息中的Content-Type字段值，就是我们在Servlet中进行设置的值</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132226729.png" alt="image-20200929165110420"></p>
<blockquote>
<p>火狐浏览器中还提供了详细的字段解释说明，在电脑联网的时候，可以点击字段前面的问号进行查看</p>
</blockquote>
<h3 id="1-3-GenericServlet"><a href="#1-3-GenericServlet" class="headerlink" title="1.3 GenericServlet"></a>1.3 GenericServlet</h3><p><code>javax.servlet.GenericServlet</code></p>
<p>它是一个抽象类，它对Servlet接口中的方法进行了默认实现，但是最重要的<code>service</code>方法并没有实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> javax.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Enumeration;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericServlet</span> <span class="keyword">implements</span> <span class="title">Servlet</span>, <span class="title">ServletConfig</span>,</span></span><br><span class="line"><span class="class">        <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> ServletConfig config;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GenericServlet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// NOOP</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// NOOP by default</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getInitParameter</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getServletConfig().getInitParameter(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Enumeration&lt;String&gt; <span class="title">getInitParameterNames</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getServletConfig().getInitParameterNames();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServletConfig <span class="title">getServletConfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> config;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServletContext <span class="title">getServletContext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getServletConfig().getServletContext();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getServletInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(ServletConfig config)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.config = config;</span><br><span class="line">        <span class="keyword">this</span>.init();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">        <span class="comment">// NOOP by default</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">log</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        getServletContext().log(getServletName() + <span class="string">&quot;: &quot;</span> + msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">log</span><span class="params">(String message, Throwable t)</span> </span>&#123;</span><br><span class="line">        getServletContext().log(getServletName() + <span class="string">&quot;: &quot;</span> + message, t);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(ServletRequest req, ServletResponse res)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> ServletException, IOException</span>;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getServletName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> config.getServletName();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，该类中，实现了Servlet接口中的init(ServletConfig config)方法，同时又重载了一个无参的init方法，并且有参数的init方法中又调用了这个重载的无参init方法。</p>
<p>由此可知，将来我们对Servlet进行初始化操作的时候，重写这个无参的init方法即可。</p>
</blockquote>
<p>例如，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.GenericServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/hello-generic&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloGenericServlet</span> <span class="keyword">extends</span> <span class="title">GenericServlet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(ServletRequest req, ServletResponse res)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		</span><br><span class="line">		String name = req.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		res.setContentType(<span class="string">&quot;text/plain;charset=utf-8&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		PrintWriter out = res.getWriter();</span><br><span class="line">		</span><br><span class="line">		out.println(<span class="string">&quot;hello!&quot;</span>+name);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这里使用注解<code>@WebServlet</code>来代替web.xml中的映射配置，俩者的效果是一样的</p>
</blockquote>
<blockquote>
<p>注意，这种方式只要实现一个<code>service</code>方法即可，其他方法在父类中已经进行了默认实现</p>
</blockquote>
<p>通过url地址访问此Servlet，并且携带参数：</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:8989/servlet-test/hello-generic?name=tom">http://127.0.0.1:8989/servlet-test/hello-generic?name=tom</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132226402.png" alt="image-20200929171544550"></p>
<h3 id="1-4-HttpServlet"><a href="#1-4-HttpServlet" class="headerlink" title="1.4 HttpServlet"></a>1.4 HttpServlet</h3><p><code>javax.servlet.http.HttpServlet</code></p>
<p>它是一个抽象类，但是类中没有抽象方法。</p>
<p>它继承了 <code>GenericServlet</code>，对接收到的客户端请求，进行了细分，对应不同的请求类型：</p>
<ul>
<li>DELETE</li>
<li>HEAD</li>
<li>GET</li>
<li>OPTIONS</li>
<li>POST</li>
<li>PUT</li>
<li>TRACE</li>
</ul>
<p>分别使用不同的方法进行处理。</p>
<p>例如，当前如果是GET请求，那么就调用doGet方法进行处理，当前如果是POST请求，那么就调用doPost方法进行处理，所以在HttpServlet中，定义了很多doXxx方法，用来处理不同类型的请求。</p>
<p>源码较长，这里给出部分代码，能说明问题即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> javax.servlet.http;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpServlet</span> <span class="keyword">extends</span> <span class="title">GenericServlet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String METHOD_DELETE = <span class="string">&quot;DELETE&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String METHOD_HEAD = <span class="string">&quot;HEAD&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String METHOD_GET = <span class="string">&quot;GET&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String METHOD_OPTIONS = <span class="string">&quot;OPTIONS&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String METHOD_POST = <span class="string">&quot;POST&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String METHOD_PUT = <span class="string">&quot;PUT&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String METHOD_TRACE = <span class="string">&quot;TRACE&quot;</span>;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> ServletException, IOException</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        String msg = lStrings.getString(<span class="string">&quot;http.method_get_not_supported&quot;</span>);</span><br><span class="line">        sendMethodNotAllowed(req, resp, msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doHead</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (DispatcherType.INCLUDE.equals(req.getDispatcherType())) &#123;</span><br><span class="line">            doGet(req, resp);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            NoBodyResponse response = <span class="keyword">new</span> NoBodyResponse(resp);</span><br><span class="line">            doGet(req, response);</span><br><span class="line">            response.setContentLength();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        String msg = lStrings.getString(<span class="string">&quot;http.method_post_not_supported&quot;</span>);</span><br><span class="line">        sendMethodNotAllowed(req, resp, msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPut</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        String msg = lStrings.getString(<span class="string">&quot;http.method_put_not_supported&quot;</span>);</span><br><span class="line">        sendMethodNotAllowed(req, resp, msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doDelete</span><span class="params">(HttpServletRequest req,</span></span></span><br><span class="line"><span class="params"><span class="function">                            HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        String msg = lStrings.getString(<span class="string">&quot;http.method_delete_not_supported&quot;</span>);</span><br><span class="line">        sendMethodNotAllowed(req, resp, msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	    </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doOptions</span><span class="params">(HttpServletRequest req,</span></span></span><br><span class="line"><span class="params"><span class="function">            HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//..</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doTrace</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> ServletException, IOException</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">		</span><br><span class="line">        <span class="comment">//..</span></span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        String method = req.getMethod();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (method.equals(METHOD_GET)) &#123;</span><br><span class="line">            <span class="keyword">long</span> lastModified = getLastModified(req);</span><br><span class="line">            <span class="keyword">if</span> (lastModified == -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="comment">// servlet doesn&#x27;t support if-modified-since, no reason</span></span><br><span class="line">                <span class="comment">// to go through further expensive logic</span></span><br><span class="line">                doGet(req, resp);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">long</span> ifModifiedSince;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    ifModifiedSince = req.getDateHeader(HEADER_IFMODSINCE);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IllegalArgumentException iae) &#123;</span><br><span class="line">                    <span class="comment">// Invalid date header - proceed as if none was set</span></span><br><span class="line">                    ifModifiedSince = -<span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (ifModifiedSince &lt; (lastModified / <span class="number">1000</span> * <span class="number">1000</span>)) &#123;</span><br><span class="line">                    <span class="comment">// If the servlet mod time is later, call doGet()</span></span><br><span class="line">                    <span class="comment">// Round down to the nearest second for a proper compare</span></span><br><span class="line">                    <span class="comment">// A ifModifiedSince of -1 will always be less</span></span><br><span class="line">                    maybeSetLastModified(resp, lastModified);</span><br><span class="line">                    doGet(req, resp);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    resp.setStatus(HttpServletResponse.SC_NOT_MODIFIED);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(METHOD_HEAD)) &#123;</span><br><span class="line">            <span class="keyword">long</span> lastModified = getLastModified(req);</span><br><span class="line">            maybeSetLastModified(resp, lastModified);</span><br><span class="line">            doHead(req, resp);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(METHOD_POST)) &#123;</span><br><span class="line">            doPost(req, resp);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(METHOD_PUT)) &#123;</span><br><span class="line">            doPut(req, resp);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(METHOD_DELETE)) &#123;</span><br><span class="line">            doDelete(req, resp);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(METHOD_OPTIONS)) &#123;</span><br><span class="line">            doOptions(req,resp);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(METHOD_TRACE)) &#123;</span><br><span class="line">            doTrace(req,resp);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//</span></span><br><span class="line">            <span class="comment">// Note that this means NO servlet supports whatever</span></span><br><span class="line">            <span class="comment">// method was requested, anywhere on this server.</span></span><br><span class="line">            <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">            String errMsg = lStrings.getString(<span class="string">&quot;http.method_not_implemented&quot;</span>);</span><br><span class="line">            Object[] errArgs = <span class="keyword">new</span> Object[<span class="number">1</span>];</span><br><span class="line">            errArgs[<span class="number">0</span>] = method;</span><br><span class="line">            errMsg = MessageFormat.format(errMsg, errArgs);</span><br><span class="line"></span><br><span class="line">            resp.sendError(HttpServletResponse.SC_NOT_IMPLEMENTED, errMsg);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(ServletRequest req, ServletResponse res)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        HttpServletRequest  request;</span><br><span class="line">        HttpServletResponse response;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            request = (HttpServletRequest) req;</span><br><span class="line">            response = (HttpServletResponse) res;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassCastException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ServletException(lStrings.getString(<span class="string">&quot;http.non_http&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        service(request, response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>注意1，HttpServlet是抽象类，但是里面没有抽象方法</p>
<p>注意2，HttpServlet继承了GenericServlet，实现了service方法，并且对service方法进行了重载</p>
<p>注意3，实现的service方法中，对请求和响应进行了强制类型转换，将普通的请求和响应对象，强制转换成了针对HTTP协议的请求和响应，然后调用重载的service方法，将转换的请求和响应传入</p>
<p>注意4，重载后的service方法中，根据当前请求的类型（get、post获取其他），再调用对应的doXxx方法进行处理</p>
<p>注意5，doXxx方法中会有一些默认的实现，例如doGet方法中会默认返回<code>http.method_delete_not_supported</code></p>
<p>由以上代码可知，我们编写子类继承 <code>HttpServlet</code>，并且重写方法即可，如果需要处理GET方式的请求，那么就重写doGet方法，如果需要处理POST方式的请求，那么就重写doPost方法。</p>
<p>例如，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/hello-http-servlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloHttpServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		</span><br><span class="line">		String name = req.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		resp.setContentType(<span class="string">&quot;text/plain;charset=utf-8&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		PrintWriter out = resp.getWriter();</span><br><span class="line">		</span><br><span class="line">		out.println(<span class="string">&quot;GET: hello！&quot;</span>+name);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		</span><br><span class="line">		String name = req.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		resp.setContentType(<span class="string">&quot;text/plain;charset=utf-8&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		PrintWriter out = resp.getWriter();</span><br><span class="line">		</span><br><span class="line">		out.println(<span class="string">&quot;POST: hello！&quot;</span>+name);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>在页面中编写一个表单，跳转表单提交的方式，来最终观察get和post方式发送请求后，Servlet中方法调用情况：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>index<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">	<span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;hello-http-servlet&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">		用户名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>根据测试结果可知，当前页面中发送GET请求的时候，Servlet中的doGet方法被调用，当页面中发送POST请求的时候，Servlet中的doPost方法被调用</p>
</blockquote>
<h2 id="2-GET和POST"><a href="#2-GET和POST" class="headerlink" title="2 GET和POST"></a>2 GET和POST</h2><blockquote>
<p>HTTP协议中，定义了很多种请求的方式，但是浏览器默认情况下，只能发出GET方式请求和POST方式请求</p>
</blockquote>
<h3 id="2-1-常见情况"><a href="#2-1-常见情况" class="headerlink" title="2.1 常见情况"></a>2.1 常见情况</h3><p>在页面中，常见的发送GET方式请求的情况有：</p>
<ul>
<li>浏览器地址栏直接输入地址访问</li>
<li>超链接访问  <a href=""></li>
<li><code>&lt;image src=&quot;&quot;&gt;</code>访问图片</li>
<li>外部js文件的引入</li>
<li>外部css文件的引入</li>
<li>表单提交数据，method=”get”</li>
<li>在javascript代码中访问资源</li>
<li>ajax中设置请求为get方式</li>
<li>使用jsp相关标签访问资源</li>
</ul>
<p>在页面中，常见的发送POST方式请求的情况有：</p>
<ul>
<li>表单提交数据，method=”post”</li>
<li>ajax中设置请求为post方式</li>
</ul>
<blockquote>
<p>可以看出，浏览器中发出的请求，大多数都是GET方式请求</p>
</blockquote>
<h3 id="2-2-特点区别"><a href="#2-2-特点区别" class="headerlink" title="2.2 特点区别"></a>2.2 特点区别</h3><p>http协议下的请求格式为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1部分: 请求行   get /hello http 1.1			</span><br><span class="line">2部分: 请求头部/消息报头	</span><br><span class="line">3部分: \r\n</span><br><span class="line">4部分: 请求正文	参数放的位置</span><br></pre></td></tr></table></figure>



<p>GET方式传参数，参数在uri后面：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GET /hello?name=tom HTTP1.1</span><br><span class="line">key: value</span><br><span class="line">key: value</span><br><span class="line">key: value</span><br><span class="line">.....</span><br><span class="line">\r\n</span><br></pre></td></tr></table></figure>

<blockquote>
<p>GET方式传参，参数会显示在地址栏中，并且参数的长度也会被地址栏的长度而限制</p>
</blockquote>
<p>post方式传参，参数在请求正文中：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">POST /hello HTTP1.1</span><br><span class="line">key: value</span><br><span class="line">key: value</span><br><span class="line">key: value</span><br><span class="line">.....</span><br><span class="line">\r\n</span><br><span class="line">name=tom</span><br></pre></td></tr></table></figure>

<blockquote>
<p>POST方式传参，参数不会显示在地址中，而是在请求体中，并且参数长度并没有直接限制</p>
</blockquote>
<h2 id="3-生命周期"><a href="#3-生命周期" class="headerlink" title="3 生命周期"></a>3 生命周期</h2><blockquote>
<p>Servlet生命周期，是指一个Servlet创建、初始化、执行、销毁的过程</p>
</blockquote>
<h3 id="3-1-创建"><a href="#3-1-创建" class="headerlink" title="3.1 创建"></a>3.1 创建</h3><p>项目中，编写Servlet程序，然后进行映射配置（指定URI地址），最后把项目部署到Tomcat中运行。</p>
<p>在Tomcat启动过程中，会检查Servlet的配置，根据配置来决定Servlet实例何时创建：</p>
<ul>
<li>第一次被访问的时候创建（默认）</li>
<li>Tomcat启动过程中创建（需要配置）</li>
</ul>
<p><strong>第一次被访问的时候创建：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LifeServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">LifeServlet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;servlet创建&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;servlet执行&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">version</span>=<span class="string">&quot;3.1&quot;</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>life<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.briup.test.LifeServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>life<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/life<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>从结果可以看出，只有第一次访问的时候创建了servlet实例，之后就不再创了，访问后直接执行方法</p>
</blockquote>
<blockquote>
<p>注意，servlet在运行期间是单例模式</p>
</blockquote>
<p><strong>Tomcat启动过程中创建：</strong></p>
<p>配置中加入标签 <code>&lt;load-on-startup&gt;</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">version</span>=<span class="string">&quot;3.1&quot;</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>life<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.briup.test.LifeServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>life<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/life<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>修改配置后，启动Tomcat过程中，就可以看到servlet实例被创建，如果有多个servlet实例都需要在启动期间进创建，那么 <code>&lt;load-on-startup&gt;</code> 标签中的值越小，越会被优先创建 (该值&gt;=0)</p>
</blockquote>
<h3 id="3-2-初始化"><a href="#3-2-初始化" class="headerlink" title="3.2 初始化"></a>3.2 初始化</h3><p>Servlet实例被创建之后，Tomcat还会调用Servlet实例中的init方法，来对该Servlet实例做初始化工作，所以如果有需要，我们可以重写Servlet中的init方法（重写无参init即可），给当前Servlet做初始化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LifeServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">LifeServlet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;servlet创建&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;servlet初始化&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;servlet执行&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>可以看出，Tomcat创建Servlet实例之后，就会调用其init方法做初始化工作</p>
</blockquote>
<p><strong>初始化传参：</strong></p>
<p>通过配置，我们可以给Servlet进行初始化参数，init方法中可以通过<code>ServletConfig</code>对象来获取该参数。</p>
<p>在配置中，使用<code>&lt;init-param&gt;</code>可以进行初始化传参</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">version</span>=<span class="string">&quot;3.1&quot;</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>life<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.briup.test.LifeServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>username<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>briup<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>password<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>life<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/life<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LifeServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">LifeServlet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;servlet创建&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;servlet初始化&quot;</span>);</span><br><span class="line">		String username = getServletConfig().getInitParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">		String password = getServletConfig().getInitParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">		System.out.println(<span class="string">&quot;\t初始化参数：username=&quot;</span>+username);</span><br><span class="line">		System.out.println(<span class="string">&quot;\t初始化参数：password=&quot;</span>+password);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;servlet执行&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，<code>getServletConfig()</code>方法在父类中已经实现，该方法可以返回ServletConifg对象，对象中封装了当前Servlet的相关配置信息</p>
</blockquote>
<h3 id="3-3-执行"><a href="#3-3-执行" class="headerlink" title="3.3 执行"></a>3.3 执行</h3><p>当客户端浏览器通过URI地址访问Servlet的时候，Tomcat会根据我们配置的映射关系，通过当前URI地址找到对应的Servlet实例，然后调用其<code>service(ServletRequest req, ServletResponse res)</code>方法。</p>
<p>由于父类中，service方法的重载，最终会根据当前请求方法（get或post等），调用到对应的doXxx方法，然后我们在子类中重写了这个doXxx方法，那么最后会调用到我们重写的doXxx方法。</p>
<p>这里需要注意的是，Tomcat接收到请求后，只会调用Servlet接口中的service方法，而不是直接调用我们的doGet方法等，由于方法的层层调用，最后才调用到我们重写的doGet等方法。</p>
<p>==思考，如果我们在子类中没有重写doGet方法，这时候浏览器发送get方法进行访问，会出现什么结果？==</p>
<h3 id="3-4-销毁"><a href="#3-4-销毁" class="headerlink" title="3.4 销毁"></a>3.4 销毁</h3><p>当前服务器进行正常关闭或者重启的时候，Tomcat会调用Servlet实例的<code>destroy()</code>方法，如果我们重写了该方法，那么会调用到我们重写之后的方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LifeServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">LifeServlet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;servlet创建&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;servlet初始化&quot;</span>);</span><br><span class="line">		String username = getServletConfig().getInitParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">		String password = getServletConfig().getInitParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">		System.out.println(<span class="string">&quot;\t初始化参数：username=&quot;</span>+username);</span><br><span class="line">		System.out.println(<span class="string">&quot;\t初始化参数：password=&quot;</span>+password);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;servlet执行&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;servlet销毁&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，服务器需要正常关闭或者重启的时候才会调用销毁的方法，如果直接调用console右上角的红点关闭服务器的话，是看不到执行销毁方法的。</p>
</blockquote>
<p>:tipping_hand_man: vanse</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.life;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletConfig;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * servlet生命周期</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> vanse</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LifeServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 创建</span></span><br><span class="line"><span class="comment">	 * 	默认: 访问该资源时才创建(懒加载) 并且只会创建一次(单例)</span></span><br><span class="line"><span class="comment">	 *  修改: 启动服务器就创建(及时加载) 并且只会创建一次(单例)</span></span><br><span class="line"><span class="comment">	 *  	web.xml  load-on-startup 该值&gt;=0 即可 </span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">LifeServlet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;servlet创建&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 初始化</span></span><br><span class="line"><span class="comment">	 * 		和创建方法一起调用 只会初始化一次</span></span><br><span class="line"><span class="comment">	 * 		可以获取配置信息的初始化值</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line"><span class="comment">//	@Override</span></span><br><span class="line"><span class="comment">//	public void init() throws ServletException &#123;</span></span><br><span class="line"><span class="comment">//		System.out.println(&quot;servlet...init&quot;);</span></span><br><span class="line"><span class="comment">//	&#125;</span></span><br><span class="line">	String username = <span class="string">&quot;&quot;</span>;</span><br><span class="line">	String password = <span class="string">&quot;&quot;</span>;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(ServletConfig config)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">		username = config.getInitParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">		password = config.getInitParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 执行</span></span><br><span class="line"><span class="comment">	 * 		每访问一次资源路径时执行 (执行多次)</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(ServletRequest req, ServletResponse res)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;servelt...service&quot;</span>);</span><br><span class="line">		<span class="comment">// 准备好的数据</span></span><br><span class="line">		System.out.println(username + <span class="string">&quot;=&quot;</span> + password);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 销毁</span></span><br><span class="line"><span class="comment">	 * 		正常关闭(重启)服务器 该servlet销毁 调用一次</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;servlet...destory&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h3 id="3-5-注解"><a href="#3-5-注解" class="headerlink" title="3.5 注解"></a>3.5 注解</h3><p>以上在web.xml中的配置，都可以使用注解配置来代替：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebInitParam;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="comment">//@WebServlet(value = &quot;/life&quot;,initParams = &#123;&#125;,loadOnStartup = 1)</span></span><br><span class="line"><span class="meta">@WebServlet(value = &quot;/life&quot;,initParams = &#123;</span></span><br><span class="line"><span class="meta">		@WebInitParam(name = &quot;username&quot;,value = &quot;briup&quot;),</span></span><br><span class="line"><span class="meta">		@WebInitParam(name = &quot;password&quot;,value = &quot;123456&quot;)</span></span><br><span class="line"><span class="meta">&#125;,loadOnStartup = 1)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LifeServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">LifeServlet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;servlet创建&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;servlet初始化&quot;</span>);</span><br><span class="line">		String username = getServletConfig().getInitParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">		String password = getServletConfig().getInitParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">		System.out.println(<span class="string">&quot;\t初始化参数：username=&quot;</span>+username);</span><br><span class="line">		System.out.println(<span class="string">&quot;\t初始化参数：password=&quot;</span>+password);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;servlet执行&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;servlet销毁&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>其效果和之前使用xml配置是一样的</p>
</blockquote>
<p>例如，</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>life<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.briup.web.servlet.LifeServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>username<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>briup<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>password<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>life<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/life<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>上面XML中的配置，和下面类中注解的配置，是等价的，效果一样</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@WebServlet(value = &quot;/life&quot;,initParams = &#123;&#125;,loadOnStartup = 1)</span></span><br><span class="line"><span class="meta">@WebServlet(value = &quot;/life&quot;,initParams = &#123;</span></span><br><span class="line"><span class="meta">	@WebInitParam(name = &quot;username&quot;,value = &quot;briup&quot;),</span></span><br><span class="line"><span class="meta">	@WebInitParam(name = &quot;password&quot;,value = &quot;123456&quot;)</span></span><br><span class="line"><span class="meta">&#125;,loadOnStartup = 1)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LifeServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line">    <span class="comment">//..</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-6-思考"><a href="#3-6-思考" class="headerlink" title="3.6 思考"></a>3.6 思考</h3><p>通过上面Servlet生命周期的描述可知，在Tomcat运行期间，一个Servlet的实例只会有一个（单例），那么在实际访问过程中，是否会出现线程安全问题？</p>
<p>例如，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebInitParam;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="comment">//@WebServlet(value = &quot;/life&quot;,initParams = &#123;&#125;,loadOnStartup = 1)</span></span><br><span class="line"><span class="meta">@WebServlet(value = &quot;/life&quot;,initParams = &#123;</span></span><br><span class="line"><span class="meta">		@WebInitParam(name = &quot;username&quot;,value = &quot;briup&quot;),</span></span><br><span class="line"><span class="meta">		@WebInitParam(name = &quot;password&quot;,value = &quot;123456&quot;)</span></span><br><span class="line"><span class="meta">&#125;,loadOnStartup = 1)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LifeServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">LifeServlet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;servlet创建&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;servlet初始化&quot;</span>);</span><br><span class="line">		String username = getServletConfig().getInitParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">		String password = getServletConfig().getInitParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">		System.out.println(<span class="string">&quot;\t初始化参数：username=&quot;</span>+username);</span><br><span class="line">		System.out.println(<span class="string">&quot;\t初始化参数：password=&quot;</span>+password);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;servlet执行&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		name = req.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		System.out.println(<span class="string">&quot;name = &quot;</span>+name);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;servlet销毁&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>启动服务器后，连续两次访问该Servlet，并且分别传不同的参数，观察其执行结果。</p>
</blockquote>
<blockquote>
<p>结论，在Servlet中，应该尽量避免使用成员变量，如果有需要，可以使用synchronized进行代码块加锁</p>
</blockquote>
<h2 id="4-接收参数-request"><a href="#4-接收参数-request" class="headerlink" title="4 接收参数(request)"></a>4 接收参数(request)</h2><blockquote>
<p>在Servlet中，一项重要的工作，就是接收页面请求中携带的参数。</p>
</blockquote>
<h3 id="4-1-方式"><a href="#4-1-方式" class="headerlink" title="4.1 方式"></a>4.1 方式</h3><p>虽然GET请求和POST请求携带参数的方式（位置）不同，但是由于Servlet底层API的封装，我们在Servlet中，通过请求（request）获取参数的方式都是一样的。</p>
<p>所以下面的示例中，都以GET方式传参的方式进行说明。</p>
<h3 id="4-2-单值"><a href="#4-2-单值" class="headerlink" title="4.2 单值"></a>4.2 单值</h3><p>接收请求中单一的参数值的时候，也就是一个参数名对应一个值，使用<code>getParameter</code>方法即可：</p>
<p><code>/param?name=tom&amp;age=20</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/param&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ParamServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		</span><br><span class="line">		String name = req.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">		String age = req.getParameter(<span class="string">&quot;age&quot;</span>);</span><br><span class="line">		System.out.println(name);</span><br><span class="line">		System.out.println(age);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，Servlet获取到的参数值，默认都是String类型的，如果需要可以自己进行类转换</p>
</blockquote>
<h3 id="4-3-多值"><a href="#4-3-多值" class="headerlink" title="4.3 多值"></a>4.3 多值</h3><p>一个参数名对应多个值，例如页面中的多选框，此时可以使用<code>getParameterValues</code>方法</p>
<p><code>/param?like=0&amp;like=1</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/param&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ParamServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		</span><br><span class="line">		String[] like = req.getParameterValues(<span class="string">&quot;like&quot;</span>);</span><br><span class="line">		System.out.println(Arrays.toString(like));</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，该方法返回是一个String类型数组，因为一个参数名可能会对应多个值</p>
</blockquote>
<h3 id="4-4-特殊"><a href="#4-4-特殊" class="headerlink" title="4.4 特殊"></a>4.4 特殊</h3><p>在一些特殊情况下，需要获取请求中携带的所有<strong>参数名</strong>，此时可以使用<code>getParameterNames</code>方法</p>
<p><code>/param?name=tom&amp;age=20&amp;like=0&amp;like=1</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Enumeration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/param&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ParamServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		</span><br><span class="line">		Enumeration&lt;String&gt; names = req.getParameterNames();</span><br><span class="line">		<span class="keyword">while</span>(names.hasMoreElements())&#123;</span><br><span class="line">			String paramName = names.nextElement();</span><br><span class="line">			System.out.println(paramName);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//运行结果：</span></span><br><span class="line">name</span><br><span class="line">age</span><br><span class="line">like</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，<code>hasMoreElements</code>可以判断是否有下一个元素，<code>nextElement</code>可以返回一下元素</p>
</blockquote>
<p>在一些特殊情况下，需要获取请求中携带的所有<strong>参数</strong>和对应的<strong>值</strong>，此时可以使用<code>getParameterMap</code>方法</p>
<p><code>/param?name=tom&amp;age=20&amp;like=0&amp;like=1</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/param&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ParamServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		</span><br><span class="line">		Map&lt;String, String[]&gt; map = req.getParameterMap();</span><br><span class="line">		<span class="keyword">for</span>(String key:map.keySet())&#123;</span><br><span class="line">			System.out.println(key+<span class="string">&quot; : &quot;</span>+Arrays.toString(map.get(key)));</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//运行结果：</span></span><br><span class="line">name : [tom]</span><br><span class="line">age  : [<span class="number">20</span>]</span><br><span class="line">like : [<span class="number">0</span>, <span class="number">1</span>]</span><br></pre></td></tr></table></figure>



<p>==思考，什么情况下，会不知道客户端传什么名字的参数给我们？==</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.requestparam;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Enumeration;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 后台处理请求参数  HttpServletRequest</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> vanse</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/requestParam&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RequestParamServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * HttpServletRequest: 封装了请求内容</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		<span class="comment">// 1.获取单个参数值</span></span><br><span class="line">		<span class="comment">// String name = req.getParameter(&quot;name&quot;);</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 2.获取多个参数值</span></span><br><span class="line"><span class="comment">//		String[] hobby = req.getParameterValues(&quot;hobby&quot;);</span></span><br><span class="line"><span class="comment">//		System.out.println(Arrays.toString(hobby));</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 3.获取所有名称 (基本不用)</span></span><br><span class="line"><span class="comment">//		Enumeration&lt;String&gt; names = req.getParameterNames();</span></span><br><span class="line"><span class="comment">//		while(names.hasMoreElements()) &#123;</span></span><br><span class="line"><span class="comment">//			System.out.println(names.nextElement());</span></span><br><span class="line"><span class="comment">//		&#125;</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 获取所有名称和值</span></span><br><span class="line">		Map&lt;String, String[]&gt; map = req.getParameterMap();</span><br><span class="line">		map.forEach((k,v) -&gt; System.out.println(k+<span class="string">&quot;=&quot;</span>+Arrays.toString(v)));</span><br><span class="line">		</span><br><span class="line">		<span class="comment">/**</span></span><br><span class="line"><span class="comment">		 * 将来可以封装class User&#123;</span></span><br><span class="line"><span class="comment">		 * 	private String name;</span></span><br><span class="line"><span class="comment">		 *  private String[] hobby;</span></span><br><span class="line"><span class="comment">		 * &#125;</span></span><br><span class="line"><span class="comment">		 * 反射调用 setName(lucy)  springmvc</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line"><span class="comment">//	public void saveUser(User user) &#123;</span></span><br><span class="line"><span class="comment">//		</span></span><br><span class="line"><span class="comment">//	&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="5-参数乱码"><a href="#5-参数乱码" class="headerlink" title="5 参数乱码"></a>5 参数乱码</h2><p>客户端发起的请求中，携带参数给Servlet，或者Servlet把数据写回给客户端，在这期间，如果出现中文，那么就会有可能出现中文乱码的问题。</p>
<h3 id="5-1-GET传参"><a href="#5-1-GET传参" class="headerlink" title="5.1 GET传参"></a>5.1 GET传参</h3><p>如果是GET请求中携带的参数，出现乱码，可以在Tomcat服务器的server.xml文件中进行配置。</p>
<p>因为GET请求的参数写在URI后的，所以需要在<code>&lt;Connector&gt;</code>中加入新的属性URIEncoding=”XXX”</p>
<p>例如，</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">URIEncoding</span>=<span class="string">&quot;UTF-8&quot;</span> <span class="attr">connectionTimeout</span>=<span class="string">&quot;20000&quot;</span> <span class="attr">port</span>=<span class="string">&quot;8989&quot;</span> <span class="attr">protocol</span>=<span class="string">&quot;HTTP/1.1&quot;</span> <span class="attr">redirectPort</span>=<span class="string">&quot;8443&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>



<p>例如，</p>
<p><code>/encoding?name=张三</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/encoding&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EncodingServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		</span><br><span class="line">		String name = req.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		System.out.println(<span class="string">&quot;name = &quot;</span>+name);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>如果是server.xml中配置为：<code>URIEncoding=&quot;GBK&quot;</code></p>
<p>执行结果为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name = 寮犱笁</span><br></pre></td></tr></table></figure>



<p>如果是server.xml中配置为：<code>URIEncoding=&quot;UTF-8&quot;</code></p>
<p>执行结果为</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name = 张三</span><br></pre></td></tr></table></figure>



<blockquote>
<p>具体的情况，还要看当前自己电脑中运行环境才行，因为有可能根据当前环境，设置为GBK刚好不是乱码</p>
</blockquote>
<blockquote>
<p>注意，这种设置编码方式，只能解决GET方式传参乱码，对POST方式无效</p>
</blockquote>
<h3 id="5-2-POST传参"><a href="#5-2-POST传参" class="headerlink" title="5.2 POST传参"></a>5.2 POST传参</h3><p>如果是POST请求中携带的参数，出现乱码，可以调用<code>setCharacterEncoding</code>方法设置获取参数时使用的编码</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>index<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">h1</span>&gt;</span>hello world! dynamic web<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;encoding&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">		用户名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>页面表单中提交参数<code>name=张三</code>给当前Servlet</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/encoding&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EncodingServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//注意，此时是POST提交方式，Servlet中重写的是doPost方法</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//req.setCharacterEncoding(&quot;UTF-8&quot;);</span></span><br><span class="line">		</span><br><span class="line">		String name = req.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		System.out.println(<span class="string">&quot;name = &quot;</span>+name);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//执行结果：</span></span><br><span class="line">name = å¼ ä¸</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果在获取参数之前，先使用setCharacterEncoding方法设置编码UTF-8，执行结果为 name = 张三</p>
</blockquote>
<blockquote>
<p>注意，这种方式只针对POST方式传参乱码，对GET方式无效</p>
</blockquote>
<h3 id="5-3-写回数据"><a href="#5-3-写回数据" class="headerlink" title="5.3 写回数据"></a>5.3 写回数据</h3><p>Servlet中将中文写回给浏览器的时候，也可能会出现中文乱码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/encoding&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EncodingServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		</span><br><span class="line">	</span><br><span class="line">		resp.setContentType(<span class="string">&quot;text/plain&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		PrintWriter out = resp.getWriter();</span><br><span class="line">		</span><br><span class="line">		out.println(<span class="string">&quot;你好，程序员&quot;</span>);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>访问后，浏览器中出现乱码：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132227716.png" alt="image-20200930015814334"></p>
<p><strong>修改代码：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/encoding&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EncodingServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		</span><br><span class="line">        <span class="comment">//设置响应中的编码为UTF-8</span></span><br><span class="line">		resp.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">		</span><br><span class="line">        <span class="comment">//告诉浏览器当前响应中的内容的类型，和内容的编码为UTF-8</span></span><br><span class="line">		resp.setContentType(<span class="string">&quot;text/plain;charset=UTF-8&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		PrintWriter out = resp.getWriter();</span><br><span class="line">		</span><br><span class="line">		out.println(<span class="string">&quot;你好，程序员&quot;</span>);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>访问后，浏览器中显示正常：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132227067.png" alt="image-20200930020103012"></p>
<h3 id="5-4-总结"><a href="#5-4-总结" class="headerlink" title="5.4 总结"></a>5.4 总结</h3><p>一般在Servlet中，会<strong>先</strong>进行编码设置，方法POST方式传参乱码，和方法响应写回数据乱码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">request.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">response.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br></pre></td></tr></table></figure>



<p>同时，在给浏览器写回数据的时候，先设置响应的类型和编码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">resp.setContentType(<span class="string">&quot;text/plain;charset=UTF-8&quot;</span>);</span><br><span class="line"><span class="comment">//或者</span></span><br><span class="line">resp.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line"><span class="comment">//或者</span></span><br><span class="line">resp.setContentType(<span class="string">&quot;application/json;charset=UTF-8&quot;</span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，因为一般写回给浏览器的数据是普通文本或者html页面，将来还可能是json格式字符串数据</p>
<p>其目的是，让浏览器在解析数据之前，有个准备，提前知道数据的类型和编码</p>
</blockquote>
<p>如果GET方式传参出现乱码，则需要在server.xml文件中进行配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">URIEncoding</span>=<span class="string">&quot;UTF-8&quot;</span> <span class="attr">connectionTimeout</span>=<span class="string">&quot;20000&quot;</span> <span class="attr">port</span>=<span class="string">&quot;8989&quot;</span> <span class="attr">protocol</span>=<span class="string">&quot;HTTP/1.1&quot;</span> <span class="attr">redirectPort</span>=<span class="string">&quot;8443&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>



<p>:tipping_hand_man: vanse</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.encode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/responseEncoding&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResponseEncodingServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		<span class="comment">// 设置请求编码</span></span><br><span class="line">		req.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">		<span class="comment">// 设置响应编码</span></span><br><span class="line">		resp.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">		<span class="comment">// 浏览器乱码 </span></span><br><span class="line">		resp.setContentType(<span class="string">&quot;text/plain;charset=utf-8&quot;</span>); <span class="comment">// 普通文本</span></span><br><span class="line">		<span class="comment">// resp.setContentType(&quot;text/html;charset=utf-8&quot;); // html</span></span><br><span class="line">		</span><br><span class="line">		String name = req.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">		System.out.println(name);</span><br><span class="line">		PrintWriter writer = resp.getWriter();</span><br><span class="line">		<span class="comment">// 流输出到浏览器 中文</span></span><br><span class="line">		writer.write(name);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>







<hr>
<p>额外的，了解一下Unicode(字符集)和UTF-8(编码规则)的对应关系：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Unicode符号范围      | UTF-8编码方式</span><br><span class="line">十六进制			   二进制</span><br><span class="line">0000 0000-0000 007F | 0xxxxxxx</span><br><span class="line">0000 0080-0000 07FF | 110xxxxx 10xxxxxx</span><br><span class="line">0000 0800-0000 FFFF | 1110xxxx 10xxxxxx 10xxxxxx</span><br><span class="line">0001 0000-0010 FFFF | 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx</span><br></pre></td></tr></table></figure>

<blockquote>
<p>所以，在UTF-8的编码规则下，一个字符可能是1字节，2字节、3字节、4字节，主要是看该字符的Unicode值的所在范围。</p>
</blockquote>
<p>例如“汉”字的Unicode编码是6C49。6C49在0800-FFFF之间，所以肯定要用3字节模板了：1110xxxx 10xxxxxx 10xxxxxx。</p>
<h2 id="6-跳转和重定向-response"><a href="#6-跳转和重定向-response" class="headerlink" title="6 跳转和重定向(response)"></a>6 跳转和重定向(response)</h2><h3 id="6-1-概述"><a href="#6-1-概述" class="headerlink" title="6.1 概述"></a>6.1 概述</h3><p>如果访问一个servlet，需要让servlet把一个已经存在html页面返回，我们可以使用IO流读取这个页面，并写回.</p>
<p><code>hello.html</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">h1</span>&gt;</span>hello world! <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/html&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HtmlServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		</span><br><span class="line">		req.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">		resp.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		resp.setContentType(<span class="string">&quot;text/html;charset=utf-8&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		PrintWriter out = resp.getWriter();</span><br><span class="line">		String realPath = getServletContext().getRealPath(<span class="string">&quot;/hello.html&quot;</span>);</span><br><span class="line">		BufferedReader in = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(<span class="keyword">new</span> FileInputStream(realPath),<span class="string">&quot;utf-8&quot;</span>));</span><br><span class="line">		</span><br><span class="line">		String line = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">while</span>((line=in.readLine())!=<span class="keyword">null</span>)&#123;</span><br><span class="line">			out.println(line);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		in.close();</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，<code>getServletContext().getRealPath(&quot;/hello.html&quot;)</code>是获取这个html页面，部署在服务器中的绝对路径，方便IO流的读取。</p>
</blockquote>
<blockquote>
<p>用io流的方式读取字节无法解决乱码</p>
</blockquote>
<p>但是，这样实现功能有点麻烦，而且很多都是固定的代码，所以可以进行封装。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.response;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 响应已经存在的html</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> vanse</span></span><br><span class="line"><span class="comment"> *	io流</span></span><br><span class="line"><span class="comment"> *		读该html文件</span></span><br><span class="line"><span class="comment"> *	        将内容写到页面</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/responseReadyHtml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResponseReadyHtmlServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		<span class="comment">// 1.设置编码</span></span><br><span class="line">		resp.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">		resp.setContentType(<span class="string">&quot;text/html;charset=utf-8&quot;</span>);</span><br><span class="line">		<span class="comment">// 2.找到该文件</span></span><br><span class="line">			<span class="comment">// 2.1 文件路径 (本地磁盘写死)</span></span><br><span class="line">		<span class="comment">// D:\备课\相关软件\jd12\day61-web-maven\src\main\webapp\test.html</span></span><br><span class="line">		<span class="comment">//String path = &quot;D:\\备课\\相关软件\\jd12\\day61-web-maven\\src\\main\\webapp\\test.html&quot;;</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 动态获取test.html在服务器(项目)中的路径</span></span><br><span class="line">		<span class="comment">// 容器(项目)的上下文</span></span><br><span class="line">		String path = getServletContext().getRealPath(<span class="string">&quot;test.html&quot;</span>);</span><br><span class="line">		<span class="comment">// E:\soft-it\tomcat\apache-tomcat-8.5.58\webapps\day61-web-maven\test.html</span></span><br><span class="line">		System.out.println(path);</span><br><span class="line">		File file = <span class="keyword">new</span> File(path);</span><br><span class="line">		<span class="comment">// 3.读写文件</span></span><br><span class="line">			<span class="comment">// 输入流 读</span></span><br><span class="line">		BufferedReader reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(<span class="keyword">new</span> FileInputStream(file),<span class="string">&quot;utf-8&quot;</span>));</span><br><span class="line">			<span class="comment">// 输出流 写</span></span><br><span class="line">		PrintWriter writer = resp.getWriter();</span><br><span class="line">		String line = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">while</span>( (line = reader.readLine()) != <span class="keyword">null</span>  ) &#123;</span><br><span class="line">			<span class="comment">// 读一行写一行</span></span><br><span class="line">			writer.write(line);  <span class="comment">// </span></span><br><span class="line">			writer.flush();</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 该流需要手动关</span></span><br><span class="line">		reader.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<p>其实Servlet中已经专门对这种情况进行了封装处理，我们可以使用专门的方法来完成此效果：</p>
<ul>
<li>跳转</li>
<li>重定向</li>
</ul>
<h3 id="6-2-跳转"><a href="#6-2-跳转" class="headerlink" title="6.2 跳转"></a>6.2 跳转</h3><p>也称之为，服务器内部跳转。</p>
<p>其本质是，在servlet接收到一个请求的时候，可以将此请求转发给服务器内部的另一个资源中，如果这个资源是一个html页面，那么tomcat就会自动读取这个html页面并写回给浏览器。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.RequestDispatcher;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/forward&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ForwardServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		</span><br><span class="line">        <span class="comment">//path表示为一个页面的地址</span></span><br><span class="line">		String path = <span class="string">&quot;/hello.html&quot;</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//根据指定地址，获取请求转发对象（RequestDispatcher）</span></span><br><span class="line">		RequestDispatcher dispatcher = req.getRequestDispatcher(path);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//使用请求转发对象，把请求对象和响应对象转发给服务器内部的另一个资源（html）</span></span><br><span class="line">		<span class="comment">//完成跳转效果</span></span><br><span class="line">		dispatcher.forward(req, resp);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>需要注意的是，服务器内部跳转，不仅可以从一个Servlet跳转到一个html页面中，也可以从一个Servlet跳转到另一个Servlet中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.RequestDispatcher;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/forward&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ForwardServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		</span><br><span class="line">        <span class="comment">//path表示为一个servlet的映射地址</span></span><br><span class="line">		String path = <span class="string">&quot;/html&quot;</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//根据指定地址，获取请求转发对象（RequestDispatcher）</span></span><br><span class="line">		RequestDispatcher dispatcher = req.getRequestDispatcher(path);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//使用请求转发对象，把请求对象和响应对象转发给服务器内部的另一个资源（servlet）</span></span><br><span class="line">		<span class="comment">//完成跳转效果</span></span><br><span class="line">		dispatcher.forward(req, resp);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>此时整体访问情况如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132227141.png" alt="image-20200930023542815"></p>
<p><strong>服务器内部跳转的特点：</strong></p>
<ul>
<li>需要使用request对象来完成</li>
<li>服务器内部跳转期间，其实就是把请求request和响应response转发到下一个资源中，所以在整个过程中,使用的是同一个request和response</li>
<li>服务器内部跳转,【不会】改变浏览器地址栏中的地址，因为从始至终浏览器只发出了一个请求</li>
</ul>
<h3 id="6-3-重定向"><a href="#6-3-重定向" class="headerlink" title="6.3 重定向"></a>6.3 重定向</h3><p>也称之为，客户端重定向。</p>
<p>其本质是，客户端浏览器发送第一次请求，访问servlet获取资源，但是服务器中，已经将资源转移到另一个位置了，所以需要通知客户端浏览器，重新发送第二次请求，访问一个新的资源位置。</p>
<p>此时，服务器需要通知浏览器发送第二次请求，并且请求新的资源位置</p>
<ul>
<li>通过响应状态码（302），通知浏览器需要重定向</li>
<li>通过响应头字段（Location: 新地址），通知浏览器新的资源位置</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/redirect&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedirectServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//需要客户端重定向的一个新的资源位置</span></span><br><span class="line">		String location = <span class="string">&quot;hello.html&quot;</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//通知客户端浏览器进行资源重定向</span></span><br><span class="line">		resp.sendRedirect(location);</span><br><span class="line"></span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><strong>访问结果为：</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132227347.png" alt="image-20200930024921090"></p>
<blockquote>
<p>可以看出，第一次访问/redirect的响应状态码是302，并且响应头信息中指定了新的资源地址，浏览器根据这个新地址发出了第二次请求，并且当前浏览器地址栏中的地址，显示的是第二次请求的地址</p>
</blockquote>
<p><strong>此时整体访问情况如下：</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132227837.png" alt="image-20200930031120256"></p>
<p><strong>客户端重定向的特点：</strong></p>
<ul>
<li>需要使用response对象来完成</li>
<li>客户端重定向，会让浏览器发出第二次请求，那么在服务器内部会产生新的request对象和response对象</li>
<li>客户端重定向,【会】改变浏览器地址栏中的地址，因为发出了第二次请求</li>
</ul>
<p>客户端重定向不仅可以重定向到一个html页面，也可以重定向到另一个Servlet中，只要改变重定向地址即可。</p>
<h3 id="6-4-总结"><a href="#6-4-总结" class="headerlink" title="6.4 总结"></a>6.4 总结</h3><p>服务器内部跳转：</p>
<ul>
<li>使用request完成</li>
<li>跳转的本质是在服务器内部把请求和响应进行转发，转发给下一个指定的资源</li>
<li>如果request中有数据，在跳转到的下一个资源中是可以拿到这个数据，因为只有一个request请求对象</li>
<li>由于服务器跳转是把请求和响应在服务器内部中进行转发，所以浏览器的地址栏中的地址是不受影响的，始终还是第一次发出请求的地址，其实浏览器根本就不知道服务器内部的请求转发情况</li>
<li>在设置跳转的资源地址的时候，路径的前面一般要加上/，例如 <code>String path = &quot;/hello.html&quot;;</code></li>
</ul>
<p>客户端重定向：</p>
<ul>
<li><p>使用response完成</p>
</li>
<li><p>重定向的本质是把新的资源路径返回给浏览器，让浏览器向这个新地址发送一个新请求</p>
<p>此处是利用了响应的状态码302和响应头信息中的Location字段来完成</p>
</li>
<li><p>如果request中有数据，重定向后在新的资源中是拿不到这个数据的，因为重定向会发出新的请求，但是数据在上一个老的请求中</p>
</li>
<li><p>由于重定向让浏览器发出新的请求，所以浏览器地址栏中的地址会变成新请求的地址</p>
</li>
<li><p>在设置重定向的资源地址的时候，路径的前面一般不加/</p>
<p>例如，<code>String path = &quot;hello.html&quot;;</code></p>
<p>但是如果一定要加/的话,那么还需要额外加上一个项目名</p>
<p>例如，<code>String path = &quot;/servlet/hello.html&quot;;</code></p>
<p>同时也可以动态获取项目：<code>req.getContextPath()</code></p>
<p>例如，<code>String path = req.getContextPath()+&quot;/hello.html&quot;;</code></p>
</li>
</ul>
<blockquote>
<p>注意，关于路径问题，后面会有专门的部分去讲解</p>
</blockquote>
<h1 id="servlet（三）"><a href="#servlet（三）" class="headerlink" title="servlet（三）"></a>servlet（三）</h1><h2 id="1-项目路径"><a href="#1-项目路径" class="headerlink" title="1 项目路径"></a>1 项目路径</h2><h3 id="1-1-斜杠（-）"><a href="#1-1-斜杠（-）" class="headerlink" title="1.1 斜杠（/）"></a>1.1 斜杠（/）</h3><p>斜杠（/）在路径中，一般的意思就是路径之间的分割，但是web项目中经常会来看到有一些路径，它的最前面会有一个斜杠（/），例如</p>
<ul>
<li>/index.html</li>
<li>/hello</li>
<li>/servlet/user/hello</li>
</ul>
<p>那么这个路径中开头斜杠（/）的解析，有俩种情况：</p>
<ul>
<li>由服务器解析</li>
<li>由客户端解析</li>
</ul>
<h4 id="1-1-1-客户端解析"><a href="#1-1-1-客户端解析" class="headerlink" title="1.1.1 客户端解析"></a>1.1.1 客户端解析</h4><p>当由客户端（浏览器）解析路径最左边斜杠（/）的时候，这个斜杠指的是端口号后面的斜杠（/）</p>
<p><a href="http://ip:port/">http://ip:port/</a></p>
<p>例如，在页面中有一个超链接</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/hello.html&quot;</span>&gt;</span>测试<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这个斜杠（/）由客户端浏览器进行解析，当点击这个超链接的时候，地址栏中的中会变成：</p>
<p><a href="http://ip:port/hello.html">http://ip:port/hello.html</a></p>
<p>例如，在servlet中，完成客户端重定向</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String url = <span class="string">&quot;/hello.html&quot;</span>;</span><br><span class="line">response.sendRedirect(url);</span><br></pre></td></tr></table></figure>

<p>客户端重定是把url地址返回给浏览器，浏览器解析之后，发出新的请求，这时候浏览器地址栏中的url地址变为：</p>
<p><a href="http://ip:port/hello.html">http://ip:port/hello.html</a></p>
<blockquote>
<p>可以看出，这种情况代码虽然是写在服务器端的，但是路径最后是返回给浏览器进行解析</p>
</blockquote>
<h4 id="1-1-2-服务器解析"><a href="#1-1-2-服务器解析" class="headerlink" title="1.1.2 服务器解析"></a>1.1.2 服务器解析</h4><p>当由服务器端解析路径最左边斜杠（/）的时候，这个斜杠指的是项目名后面的斜杠（/）</p>
<p><a href="http://ip:port/projectName/">http://ip:port/projectName/</a></p>
<p>例如，在web.xml文件中配置servlet的映射路径</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/hello<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这个斜杠（/）由服务器端进行解析，它代表的是项目名后的斜杠（/），这个资源的访问需要使用以下URL：</p>
<p><a href="http://ip:port/projectName/hello">http://ip:port/projectName/hello</a></p>
<blockquote>
<p>注意，使用注解的方式配置servlet的效果也是一样的效果</p>
</blockquote>
<p>例如，在servlet中进行服务器内部跳转操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String url = <span class="string">&quot;/test&quot;</span>;</span><br><span class="line">request.getRequestDispatcher(url).forward(request, response);</span><br></pre></td></tr></table></figure>

<p>这个斜杠（/）由服务器端进行解析，它代表的是项目名后的斜杠（/），最后内部跳转所访问的URL地址就是：</p>
<p><a href="http://ip:port/projectName/test">http://ip:port/projectName/test</a></p>
<h3 id="1-2-方法"><a href="#1-2-方法" class="headerlink" title="1.2 方法"></a>1.2 方法</h3><blockquote>
<p>Servlet中提供了一些和路径相关的方法</p>
</blockquote>
<h4 id="1-2-1-HttpServletRequest"><a href="#1-2-1-HttpServletRequest" class="headerlink" title="1.2.1 HttpServletRequest"></a>1.2.1 HttpServletRequest</h4><p><code>javax.servlet.http.HttpServletRequest</code>接口，表示http协议的请求</p>
<p>常用的和路径相关的方法：</p>
<ul>
<li><code>getContextPath()</code>，获取项目的根路径（默认是项目名）</li>
<li><code>getServletPath()</code>，获取当前访问的servlet地址</li>
<li><code>getRequestURL()</code>，获取当前请求的URL地址</li>
<li><code>getRequestURI()</code>，获取当前请求的URI地址</li>
</ul>
<p>例如，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/path&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PathServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;req.getContextPath() = &quot;</span>+req.getContextPath());</span><br><span class="line">		System.out.println(<span class="string">&quot;req.getServletPath() = &quot;</span>+req.getServletPath());</span><br><span class="line">		System.out.println(<span class="string">&quot;req.getRequestURL()  = &quot;</span>+req.getRequestURL());</span><br><span class="line">		System.out.println(<span class="string">&quot;req.getRequestURI()  = &quot;</span>+req.getRequestURI());</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>访问地址 <a target="_blank" rel="noopener" href="http://127.0.0.1:8989/servlet-test/path">http://127.0.0.1:8989/servlet-test/path</a></p>
<p>运行结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">req.getContextPath() = /servlet-test</span><br><span class="line">req.getServletPath() = /path</span><br><span class="line">req.getRequestURL()  = http://127.0.0.1:8989/servlet-test/path</span><br><span class="line">req.getRequestURI()  = /servlet-test/path</span><br></pre></td></tr></table></figure>





<h4 id="1-2-2-ServletContext"><a href="#1-2-2-ServletContext" class="headerlink" title="1.2.2 ServletContext"></a>1.2.2 ServletContext</h4><p><code>javax.servlet.ServletContext</code>接口，表示Servlet上下文环境，代表了整个web项目，是非常重要的一个对象</p>
<p>常用的和路径相关的方法：</p>
<ul>
<li><p><code>getContextPath()</code>，获取当前项目的根路径（默认就是项目名）</p>
</li>
<li><p><code>getRealPath(String path)</code>，获取一个资源在服务器中的绝对路径</p>
</li>
<li><p><code>getResourcePaths(String path)</code>，获取一个路径下面的所有资源</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/path&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PathServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		<span class="comment">//通过request对象获取ServletContext对象</span></span><br><span class="line">		ServletContext servletContext = getServletContext();</span><br><span class="line">		</span><br><span class="line">		String contextPath = servletContext.getContextPath();</span><br><span class="line">		System.out.println(<span class="string">&quot;contextPath = &quot;</span>+contextPath);</span><br><span class="line">		</span><br><span class="line">		String realPath = servletContext.getRealPath(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">		System.out.println(<span class="string">&quot;realPath = &quot;</span>+realPath);</span><br><span class="line">		</span><br><span class="line">		Set&lt;String&gt; resourcePaths = servletContext.getResourcePaths(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">		resourcePaths.forEach(System.out::println);</span><br><span class="line">			</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>访问地址 <a target="_blank" rel="noopener" href="http://127.0.0.1:8989/servlet-test/path">http://127.0.0.1:8989/servlet-test/path</a></p>
<p>运行结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">contextPath = /servlet-test</span><br><span class="line">realPath = D:\briup\apache-tomcat-8.5.58\webapps\servlet-test\</span><br><span class="line">/META-INF/</span><br><span class="line">/hello.html</span><br><span class="line">/WEB-INF/</span><br><span class="line">/index.html</span><br></pre></td></tr></table></figure>



<h3 id="1-3-相对路径"><a href="#1-3-相对路径" class="headerlink" title="1.3 相对路径"></a>1.3 相对路径</h3><p><strong>例如1</strong>，假设path.html和hello.html在同一个目录下。</p>
<p>path.html页面中有一个超链接：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;hello.html&quot;</span>&gt;</span>测试<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>超链接中的这个路径就是一个相对路径，相对于<strong>当前路径</strong>，当前路径指的是浏览器地址栏中这个时候的路径。</p>
<p>所以当点击超链接的时候，就是在当前路径后面加上这个相对路径：</p>
<p>1、访问path.html的url地址：</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:8989/servlet-test/path.html">http://127.0.0.1:8989/servlet-test/path.html</a></p>
<p>2、点击超链接之后，地址栏中的地址变为：当前路径+相对路径</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:8989/servlet_test/">http://127.0.0.1:8989/servlet_test/</a><br>+<br>hello.html<br>=<br><a target="_blank" rel="noopener" href="http://127.0.0.1:8989/servlet-test/hello.html">http://127.0.0.1:8989/servlet-test/hello.html</a></p>
<p><strong>例如2</strong>，假设path.html和hello.html不在同一个目录下，path.html在test目录下</p>
<p>path.html页面中有一个超链接</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;hello.html&quot;</span>&gt;</span>测试<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>超链接中的这个路径就是一个相对路径，相对于当前路径，当前路径指的是浏览器地址栏中这个时候的路径。</p>
<p>所以当点击超链接的时候，就是在当前路径后面加上这个相对路径：</p>
<p>1、访问path.html的url地址：</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:8989/servlet-test/test/path.html">http://127.0.0.1:8989/servlet-test/test/path.html</a></p>
<p>2、点击超链接之后,地址栏中的地址变为：当前路径+相对路径</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:8989/servlet-test/test">http://127.0.0.1:8989/servlet-test/test</a><br>+<br>hello.html<br>=<br><a target="_blank" rel="noopener" href="http://127.0.0.1:8989/servlet-test/test/hello.html">http://127.0.0.1:8989/servlet-test/test/hello.html</a></p>
<p>这时候出现404错误，页面找不到，因为访问地址不对。<br>修改连接地址如下，即可正常点击访问：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;../hello.html&quot;</span>&gt;</span>测试<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p><strong>例如3</strong>，假设path.html和hello.html在同一个目录下(此时web.xml)</p>
<p>path.html页面中有一个超链接</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;hello.html&quot;</span>&gt;</span>测试<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>web.xml中映射的路径为：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/servlet/path<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>访问这个servlet之后，进行一个服务器内部跳转，跳转到path.html页面<br>这时候，浏览器地址栏中地址为servlet地址，显示的内容为path.html页面，点击超链接观察效果。</p>
<p>1、访问servlet的url地址：</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:8989/servlet-test/servlet/path">http://127.0.0.1:8989/servlet-test/servlet/path</a></p>
<p>2、然后点击页面中的超链接</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;hello.html&quot;</span>&gt;</span>测试<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>超链接中的这个路径就是一个相对路径，相对于当前路径，当前路径指的是浏览器地址栏中这个时候的路径。</p>
<p>所以当点击超链接的时候，就是在当前路径后面加上这个相对路径：</p>
<p>3、点击超链接之后,地址栏中的地址变为：当前路径+相对路径</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:8989/servlet-test/servlet">http://127.0.0.1:8989/servlet-test/servlet</a><br>+<br>hello.html<br>=<br><a target="_blank" rel="noopener" href="http://127.0.0.1:8989/servlet-test/servlet/hello.html">http://127.0.0.1:8989/servlet-test/servlet/hello.html</a></p>
<blockquote>
<p>可以看出，此时又会出现404错误</p>
</blockquote>
<p><strong>例如4</strong>，页面中使用<code>&lt;base&gt;</code>标签</p>
<p>在html页面添加base标签之后，这个页面中的所有相对路径，就不再是相对于地址栏中的路径了，而是相对于base标签中设置的路径</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="meta-string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">base</span> <span class="attr">href</span>=<span class="string">&quot;http://127.0.0.1:8989/servlet-test/&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>path.html<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;hello.html&quot;</span>&gt;</span>测试<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>默认情况下，页面中的相对路径，参照点是浏览器地址栏中的当前地址，使用<code>&lt;base&gt;</code>标签之前，页面中这些相对路径的参照点，就变成了<code>&lt;base href=&quot;...&quot;&gt;</code>标签中指定的地址</p>
</blockquote>
<h3 id="1-4-修改路径"><a href="#1-4-修改路径" class="headerlink" title="1.4 修改路径"></a>1.4 修改路径</h3><p>默认情况下，项目部署后，项目路径（ContextPath）就是项目的名字，也可以根据情况对该路径进行修改。</p>
<p>例如，把ContextPath修改为/</p>
<p>在Eclipse中部署后，server.xml文件中会多一个配置：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Context</span> <span class="attr">docBase</span>=<span class="string">&quot;servlet&quot;</span> <span class="attr">path</span>=<span class="string">&quot;/servlet&quot;</span> <span class="attr">reloadable</span>=<span class="string">&quot;true&quot;</span> <span class="attr">source</span>=<span class="string">&quot;org.eclipse.jst.jee.server:servlet&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">Host</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>此时项目的ContextPath为 <code>/servlet</code>，可以在这里直接修改为 <code>/</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Context</span> <span class="attr">docBase</span>=<span class="string">&quot;servlet&quot;</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">reloadable</span>=<span class="string">&quot;true&quot;</span> <span class="attr">source</span>=<span class="string">&quot;org.eclipse.jst.jee.server:servlet&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">Host</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>启动后，原来是这样访问的路径：<a target="_blank" rel="noopener" href="http://127.0.0.1:8989/servlet/index.html">http://127.0.0.1:8989/servlet/index.html</a></p>
<p>现在可以这样来访问：<a target="_blank" rel="noopener" href="http://127.0.0.1:8989/index.html">http://127.0.0.1:8989/index.html</a></p>
<p>或者在部署之前，也可以直接修改项目的ContextPath：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132228502.png" alt="image-20201005213218225"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132224597.png" alt="image-20201005213239196"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132224812.png" alt="image-20201005213315890"></p>
<blockquote>
<p>最后，部署启动即可</p>
</blockquote>
<h2 id="2-范围对象"><a href="#2-范围对象" class="headerlink" title="2 范围对象"></a>2 范围对象</h2><h3 id="2-1-概述-1"><a href="#2-1-概述-1" class="headerlink" title="2.1 概述"></a>2.1 概述</h3><p>在web项目中，如果有数据，需要进行传递，并且要求在某一个范围内进行传递，那么就可以在servlet中使用以下几个对象，在指定的范围内，进行数据传递。</p>
<table>
<thead>
<tr>
<th>接口类型</th>
<th>对象名</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>javax.servlet.http.HttpServletRequest</td>
<td>request</td>
<td>请求范围，数据存入后，在同一个请求内有效</td>
</tr>
<tr>
<td>javax.servlet.http.HttpSession</td>
<td>session</td>
<td>会话范围，数据存入后，在同一个会话内有效</td>
</tr>
<tr>
<td>javax.servlet.ServletContext</td>
<td>application</td>
<td>应用范围，数据存入后，在同一个项目内有效</td>
</tr>
</tbody></table>
<h3 id="2-2-获取"><a href="#2-2-获取" class="headerlink" title="2.2 获取"></a>2.2 获取</h3><p>在servlet程序中，如何获取这三种对象</p>
<p>1、request对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		</span><br><span class="line">	<span class="comment">//request和response是方法的参数，可以直接使用</span></span><br><span class="line">		</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>2、session对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">	<span class="comment">//使用request对象，调用getSession方法即可</span></span><br><span class="line">	HttpSession session = request.getSession();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//如果request有对应的session,则返回这个session</span></span><br><span class="line">    <span class="comment">//如果request没有对应的session,则创建一个新的session并返回</span></span><br><span class="line">    <span class="comment">//request.getSession()等价于这种情况</span></span><br><span class="line">    HttpSession session = request.getSession(<span class="keyword">true</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//如果request有对应的session,则返回这个session</span></span><br><span class="line">    <span class="comment">//如果request没有对应的session,则返回null</span></span><br><span class="line">	HttpSession session = request.getSession(<span class="keyword">false</span>);</span><br><span class="line">		</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<p>3、application对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		</span><br><span class="line">		ServletContext application = request.getServletContext();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//或者使用以下方式，默认当前servlet继承了HttpServlet</span></span><br><span class="line"><span class="comment">//		request.getSession().getServletContext();</span></span><br><span class="line"><span class="comment">//		super.getServletContext();</span></span><br><span class="line"><span class="comment">//		super.getServletConfig().getServletContext();</span></span><br><span class="line">		</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，application对象有且只有一个，所以无论什么方式获取到的，都是同一个对象（内存地址一样）</p>
</blockquote>
<h3 id="2-3-声明周期"><a href="#2-3-声明周期" class="headerlink" title="2.3 声明周期"></a>2.3 声明周期</h3><p>1、request对象</p>
<p>客户端每次发请求，服务器就会创建一个新的request对象，本次访问结束后，该request对象就会被销毁，所以每次请求都是一个全新的request对象。</p>
<blockquote>
<p>可以看出，存入request中的数据，只能在一次请求之内有效</p>
</blockquote>
<p>2、session对象</p>
<p><code>request.getSession()</code>方法第一次被调用时，会创建session对象，<code>session.invalidate()</code>调用的时候会销毁session。</p>
<p>session如果自动超时的话，也会被销毁，默认超时时间为30分钟，可以在web.xml中进行设置，单位是分钟</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">session-config</span>&gt;</span>  </span><br><span class="line">	<span class="tag">&lt;<span class="name">session-timeout</span>&gt;</span>30<span class="tag">&lt;/<span class="name">session-timeout</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">session-config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，session超时时间指的是，客户端不与服务器进行交互的时间</p>
</blockquote>
<blockquote>
<p>一个会话中可以有多个request请求，所以放在session中的数据，可以被多个请求所共享</p>
</blockquote>
<p>3、application对象</p>
<p>启动tomcat服务器的时候，就会被创建，关闭tomcat服务器的时候，就会被销毁。</p>
<p>每个项目在运行期间，都会<strong>有且只有一个</strong>application对象，与这个项目对应。</p>
<blockquote>
<p>整个项目在运行期间，因为只有一个application对象，所以这个对象是所有用户共享的。大家都可以向这个对象里面存值，也可以再拿出来。</p>
</blockquote>
<h3 id="2-4-存取数据"><a href="#2-4-存取数据" class="headerlink" title="2.4 存取数据"></a>2.4 存取数据</h3><p>使用三种对象进行存数据、取数据的方式是一样的：</p>
<p>例如，存值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">request.setAttribute(<span class="string">&quot;key&quot;</span>, value);</span><br><span class="line">session.setAttribute(<span class="string">&quot;key&quot;</span>, value);</span><br><span class="line">application.setAttribute(<span class="string">&quot;key&quot;</span>, value);</span><br></pre></td></tr></table></figure>



<p>例如，取值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">request.getAttribute(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">session.getAttribute(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">application.getAttribute(<span class="string">&quot;key&quot;</span>);</span><br></pre></td></tr></table></figure>



<p>例如，还可以删除指定的数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">request.removeAttribute(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">session.removeAttribute(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">application.removeAttribute(<span class="string">&quot;key&quot;</span>);</span><br></pre></td></tr></table></figure>



<h3 id="2-5-思考"><a href="#2-5-思考" class="headerlink" title="2.5 思考"></a>2.5 思考</h3><p>1、每次request对象创建之后，服务器怎么知道这个request和哪个session对象相对应?</p>
<p>2、服务器正常关闭和非正常关闭对session对象是否有影响？</p>
<ul>
<li>正常关闭再打开,session还在</li>
<li>非正常关闭再打开,session不在</li>
</ul>
<h2 id="3-会话追踪"><a href="#3-会话追踪" class="headerlink" title="3 会话追踪"></a>3 会话追踪</h2><h3 id="3-1-无状态访问"><a href="#3-1-无状态访问" class="headerlink" title="3.1 无状态访问"></a>3.1 无状态访问</h3><p>http协议的访问是无状态的访问，当前访问是不会知道之前访问的状态的，也就是说http协议的访问是不会帮我们保存访问的记录/痕迹的。</p>
<p>但是，有些时候我们需要记录之前的访问状态。</p>
<p>例如，在购物网站中，第一次访问点击购买了一个手机，第二次访问点击购买了一个电脑，第三次访问点击购物车结算，这个时候我们就必须知道前两次访问的时候购买了什么，要不然就没有方法去结算。</p>
<blockquote>
<p>会话追踪技术，就可以用来解决这种类似的问题</p>
</blockquote>
<h3 id="3-2-cookie"><a href="#3-2-cookie" class="headerlink" title="3.2 cookie"></a>3.2 cookie</h3><p>cookie是常用到的一种会话追踪技术，cookie是浏览器中用来存储信息的一种本地文件，浏览器再向服务器发送请求的时候，可以根据服务器的地址，将对应的cookie中的信息，携带到请求头中，一起发送给服务器。</p>
<blockquote>
<p>注意，session是保存在服务器端的对象，而cookie是保存在客户端（浏览器）的一种本地文件</p>
</blockquote>
<p>不同的浏览器，查看cookie的方式不同，但是基本都在内置的“隐私与安全”选项中：</p>
<p>例如，火狐浏览器</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132224108.png" alt="image-20201004195948843"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132224861.png" alt="image-20201004200024202"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132224036.png" alt="image-20201004200055613"></p>
<p><strong>也可以在火狐中安装插件，更加方便查看cookie：</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132224092.png" alt="image-20201004200153391"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132224700.png" alt="image-20201004200222127"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132224076.png" alt="image-20201004200246170"></p>
<p>例如，使用chrome浏览器</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132224759.png" alt="image-20201004200721510"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132224941.png" alt="image-20201004200747122"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132225236.png" alt="image-20201004200802686"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132225425.png" alt="image-20201004202955925"></p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132225719.png" alt="image-20201004203015415"></p>
<h4 id="3-2-1-cookie和session"><a href="#3-2-1-cookie和session" class="headerlink" title="3.2.1 cookie和session"></a>3.2.1 cookie和session</h4><p>如果在一次请求的过程中，服务器端产生了session，那么这个session的id值，会写入到响应（response）中，然后由响应将session的id值，带回到浏览器中，浏览器收到后，再把这个id值写入到本地的cookie的文件中。</p>
<p>并且这个session的id值，在浏览器的cookie的文件中，有一个默认的名字：JSESSIONID</p>
<p>之后，浏览器发送请求的时候，会把之前保存在cookie文件中的JSESSIONID的值，传给服务器。</p>
<p>服务器通过这个JESSIONID的值，就能够知道服务器内存中是哪一个session对象，和当前这个客户端对应。</p>
<blockquote>
<p>这种情况下，就能到达一个效果，客户端的每一次访问，在服务器端都能够拿到相同的一个session对象，从而实现不同请求之间通过相同的session对象进行数据的共享</p>
</blockquote>
<h4 id="3-3-2-服务器写回cookie"><a href="#3-3-2-服务器写回cookie" class="headerlink" title="3.3.2 服务器写回cookie"></a>3.3.2 服务器写回cookie</h4><p>使用response对象，可以把cookie带回到浏览器，然后浏览器把cookie对象中的内容保存到对应的一个cookie的文件中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建cookie对象</span></span><br><span class="line">Cookie c1 = <span class="keyword">new</span> Cookie(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;tom&quot;</span>);</span><br><span class="line">Cookie c2 = <span class="keyword">new</span> Cookie(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"><span class="comment">//设置cookie的有效时间</span></span><br><span class="line">c1.setMaxAge(<span class="number">60</span>*<span class="number">60</span>*<span class="number">24</span>*<span class="number">365</span>);</span><br><span class="line">c2.setMaxAge(<span class="number">60</span>*<span class="number">60</span>*<span class="number">24</span>*<span class="number">365</span>*<span class="number">10</span>);</span><br><span class="line"><span class="comment">//把cookie放到response里面</span></span><br><span class="line">response.addCookie(c1);</span><br><span class="line">response.addCookie(c2);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，如果没有设置cookie生效的时间，那么这个cookie就是会话cookie，也就是当关闭浏览器的时候cookie就是失效了。</p>
</blockquote>
<h4 id="3-2-3-服务器读取cookie"><a href="#3-2-3-服务器读取cookie" class="headerlink" title="3.2.3 服务器读取cookie"></a>3.2.3 服务器读取cookie</h4><p>servlet中，可以使用request对象拿到从浏览器发送过来的cookie数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//从request中拿到一个cookie数组</span></span><br><span class="line"><span class="comment">//如果没任何cookie数据则返回null</span></span><br><span class="line">Cookie[] cookies = request.getCookies();</span><br><span class="line"><span class="comment">//遍历数组 拿出key和value</span></span><br><span class="line"><span class="keyword">for</span>(Cookie c:cookies)&#123;</span><br><span class="line">    String key = c.getName();</span><br><span class="line">    String value = c.getValue();</span><br><span class="line">    System.out.println(key+<span class="string">&quot; : &quot;</span>+value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>==思考，浏览器向A网站发送请求，那么会不会把B网站的cookie携带过去(跨域)？==</p>
<h3 id="3-3-URL重写"><a href="#3-3-URL重写" class="headerlink" title="3.3 URL重写"></a>3.3 URL重写</h3><blockquote>
<p>会话追踪，除了使用cookie技术来实现之外，还可以使用另一种方式来实现：URL重写</p>
</blockquote>
<h4 id="3-3-1-概述"><a href="#3-3-1-概述" class="headerlink" title="3.3.1 概述"></a>3.3.1 概述</h4><p>当用户把浏览器的cookie功能禁用之后，浏览器在发请求的时候，响应（response）把cookie带回来，但是浏览器无法接收，这其中就包括最重要的JSESSIONID。</p>
<p>例如，</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132225127.png" alt="image-20201004213359668"></p>
<blockquote>
<p>这时候，浏览器无法接收响应携带回来的cookie值，请求中也不会携带cookie。</p>
</blockquote>
<h4 id="3-3-2-使用"><a href="#3-3-2-使用" class="headerlink" title="3.3.2 使用"></a>3.3.2 使用</h4><p>浏览器cookie被禁用后，可以URL重写技术，也可以到达会话追踪的效果。</p>
<p>将需要进行会话追踪的链接，使用指定方法进行处理后，得到新的链接地址：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String url = response.encodeURL(<span class="string">&quot;url&quot;</span>);  <span class="comment">// lookUserCookie?jesssionId</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，重写后的url和原来的url比较，其实就是在url后面拼接上了JSESSIONID的值，以便点击链接的时候可以把JSESSIONID的值也传过来，从而达到会话追踪的效果</p>
</blockquote>
<p>例如，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/url&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">URLServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		</span><br><span class="line">		request.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">		response.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		request.getSession().setAttribute(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;tom&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		response.setContentType(<span class="string">&quot;text/html;charset=utf-8&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		PrintWriter out = response.getWriter();</span><br><span class="line">		</span><br><span class="line">		String url = request.getContextPath()+<span class="string">&quot;/sayHello&quot;</span>;</span><br><span class="line">		<span class="comment">//这里就是对当前这个url进行的重写的操作</span></span><br><span class="line">        <span class="comment">//原来的url为：/servlet-test/sayHello</span></span><br><span class="line">        <span class="comment">//重写后url为：/servlet-test/sayHello;jsessionid=587325D14741A0DB1688E98D8D30AE59</span></span><br><span class="line">        <span class="comment">//url = response.encodeURL(url);  此时需要禁用cookie</span></span><br><span class="line">		</span><br><span class="line">		out.println(<span class="string">&quot;&lt;html&gt;&quot;</span>);</span><br><span class="line">		out.println(<span class="string">&quot;&lt;head&gt;&quot;</span>);</span><br><span class="line">		out.println(<span class="string">&quot;&lt;/head&gt;&quot;</span>);</span><br><span class="line">		out.println(<span class="string">&quot;&lt;body&gt;&quot;</span>);</span><br><span class="line">		out.write(<span class="string">&quot;&lt;a href = &quot;</span>+url+<span class="string">&quot;&gt;点击&lt;/a&gt;&quot;</span>);</span><br><span class="line">      </span><br><span class="line">		out.println(<span class="string">&quot;&lt;/body&gt;&quot;</span>);</span><br><span class="line">		out.println(<span class="string">&quot;&lt;/html&gt;&quot;</span>);</span><br><span class="line">			</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/sayHello&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SayHelloServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		</span><br><span class="line">		String name = (String)request.getSession().getAttribute(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		System.out.println(<span class="string">&quot;hello!&quot;</span>+name);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>注意事项，</p>
<p>1、测试前先确保浏览器的cookie功能已经被禁用</p>
<p>2、<code>response.encodeURL(url);</code>核心代码分别注释掉和代开，来观察测试结果</p>
<blockquote>
<p>注意，无论是cookie还是URL重写，其核心都是将sessionID保存到客户端，然后发请求的时候，把这个id值传给服务器，服务器通过这个id值，找到服务器内存中哪一个session对象和当前请求相对应。</p>
</blockquote>
<h2 id="cookie和sesson的思考"><a href="#cookie和sesson的思考" class="headerlink" title="cookie和sesson的思考"></a>cookie和sesson的思考</h2><p><code>cookie的安全问题</code></p>
<p>问: 如果登录了网站A,再登录网站B,B会获取到A的cookie信息吗?</p>
<ul>
<li>由于同源策略,B无法获取</li>
</ul>
<p>但是</p>
<ul>
<li>XSS，跨站脚本攻击。攻击者获得页面的js权限，能操作页面的一切，包括Session Storage和未设置HTTP Only属性的Cookie</li>
<li>CSRF，跨站请求伪造，就是钓鱼网站</li>
</ul>
<h1 id="servlet（四）"><a href="#servlet（四）" class="headerlink" title="servlet（四）"></a>servlet（四）</h1><h2 id="1-filter"><a href="#1-filter" class="headerlink" title="==1 filter=="></a>==1 filter==</h2><h3 id="1-1-概述-2"><a href="#1-1-概述-2" class="headerlink" title="1.1 概述"></a>1.1 概述</h3><p>在一个请求去访问某个资源的时候，filter（过滤器）可以在这个请求，访问到这个资源之前，把请求拦下，然后做出一系列的处理，例如编码转换、信息过滤、登录验证、权限判断等等，最后filter再决定，是否要让这个请求去访问那个目标资源。</p>
<h3 id="1-2-编写"><a href="#1-2-编写" class="headerlink" title="1.2 编写"></a>1.2 编写</h3><p><code>javax.Servlet.Filter</code>是Servlet技术中，提供的一个接口，实现该接口的类，并且完成对应的配置，那么这个类就是一个过滤器。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> javax.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//过滤器对象初始化时调用的方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException</span>;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//当过滤器拦截到请求的时候,会调用这个doFilter方法进行处理</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response,</span></span></span><br><span class="line"><span class="params"><span class="function">            FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//过滤器对象销毁时调用的方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><code>doFilter</code>方法有三个参数，前两个分别是请求和响应对象，第三个参数是比较重要的一个参数</p>
<p><code>javax.servlet.FilterChain</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> javax.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">FilterChain</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   	<span class="comment">//FilterChain是一个接口,表示过滤器链,这个接口中只有一个方法doFilter</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> IOException, ServletException</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>同一个请求有可能要依次的通过两个或者多个过滤器，在servlet中，把这样多个过滤器看做一个过滤器链，这个过滤器链就用<code>FilterChain</code>接口类型来表示。</p>
<p><code>chain.doFilter(req,res)</code>，表示把当前的req和res传给这个过滤器链中的下一个过滤器对象，然后对该请求进行处理，如果说链中已经没有下一个过滤器了，那么就把这次访问放行，去访问它真正要访问的目标资源。</p>
<p>例如，编写一个编码过滤器，设置请求和响应的编码为UTF-8</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.Filter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterConfig;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EncodingFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">		<span class="comment">//过滤器初始化的时候调用该方法</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//设置编码</span></span><br><span class="line">		request.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">		response.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//将请求放行</span></span><br><span class="line">		chain.doFilter(request, response);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">//过滤器销毁时候调用该方法</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>例如，当请求中没有指定参数的时候，就不让其访问目标资源，并且返回提示页面</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.Filter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterConfig;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CheckFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">		</span><br><span class="line">		String username = request.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>(username == <span class="keyword">null</span>) &#123;</span><br><span class="line">			response.setContentType(<span class="string">&quot;text/html;charset=utf-8&quot;</span>);</span><br><span class="line">			PrintWriter out = response.getWriter();</span><br><span class="line">			</span><br><span class="line">			out.println(<span class="string">&quot;&lt;html&gt;&quot;</span>);</span><br><span class="line">			out.println(<span class="string">&quot;&lt;body&gt;&quot;</span>);</span><br><span class="line">			out.println(<span class="string">&quot;&lt;h1&gt;请在请求中携带username参数&lt;/h1&gt;&quot;</span>);</span><br><span class="line">			out.println(<span class="string">&quot;&lt;/body&gt;&quot;</span>);</span><br><span class="line">			out.println(<span class="string">&quot;&lt;/html&gt;&quot;</span>);</span><br><span class="line">			</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">//如果满足条件，那么就放行</span></span><br><span class="line">			chain.doFilter(request, response);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h3 id="1-3-配置"><a href="#1-3-配置" class="headerlink" title="1.3  配置"></a>1.3  配置</h3><p>和servlet程序一样，filter过滤器编写完成后，并不能立刻工作，还需要进行配置，指定这个过滤器会对哪些路径的访问生效。</p>
<p>例如，在web.xml中配置编码过滤的filter对所有路径都生效</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>com.briup.filter.EncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>其中<code>&lt;url-pattern&gt;&lt;/url-pattern&gt;</code>有四种配置方式</p>
<ul>
<li><p>精确匹配</p>
<p>例如，<code>&lt;url-pattern&gt;/test_servlet&lt;/url-pattern&gt;</code></p>
<p>表示此拦截器只会拦截/test_servlet这一个路径</p>
</li>
<li><p>扩展名匹配</p>
<p>例如，<code>&lt;url-pattern&gt;*.html&lt;/url-pattern&gt;</code></p>
<p>表示此拦截器只会拦截后缀名是.html的路径</p>
</li>
<li><p>路径匹配</p>
<p>例如，<code>&lt;url-pattern&gt;/test/*&lt;/url-pattern&gt;</code></p>
<p>表示此拦截器拦截/test路径下的所有资源</p>
</li>
<li><p>匹配任意路径</p>
<p>例如，<code>&lt;url-pattern&gt;/*&lt;/url-pattern&gt;</code></p>
<p>表示此拦截器拦截项目下所有资源</p>
</li>
</ul>
<h3 id="1-4-顺序"><a href="#1-4-顺序" class="headerlink" title="1.4 顺序"></a>1.4 顺序</h3><p>如果有多个过滤器，并且多个过滤器拦截的路径有相同的部分，就有一些路径被    这多个过滤器共同拦截，那么过滤器的顺序是按照web.xml中配置的顺序从上到下执行的</p>
<p>例如，</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">version</span>=<span class="string">&quot;3.1&quot;</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>com.briup.filter.EncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">dispatcher</span>&gt;</span><span class="tag">&lt;/<span class="name">dispatcher</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>checkFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>com.briup.filter.CheckFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>checkFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/test<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>当请求方法/test的时候，encodingFilter会先拦截，然后是checkFilter再拦截</p>
</blockquote>
<h3 id="1-5-其他"><a href="#1-5-其他" class="headerlink" title="1.5 其他"></a>1.5 其他</h3><h4 id="1-5-1-生命周期"><a href="#1-5-1-生命周期" class="headerlink" title="1.5.1 生命周期"></a>1.5.1 生命周期</h4><p>当前服务器启动的时候，Filter会被创建并调用init方法初始化，服务器关闭的时候会被销毁并调用destory方法。</p>
<p>重写init和destory方法，启动服务器、访问资源被拦截、再关闭服务器，即可看到生命周期中的创建、初始化、访问、销毁的过程</p>
<h4 id="1-5-2-初始化"><a href="#1-5-2-初始化" class="headerlink" title="1.5.2 初始化"></a>1.5.2 初始化</h4><p>和servlet一样，filter初始化的时候，也可以传入参数</p>
<p>例如，</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">version</span>=<span class="string">&quot;3.1&quot;</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>com.briup.filter.EncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">	    	<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">	    	<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.Filter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterConfig;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EncodingFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> String encoding;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">		<span class="comment">//过滤器初始化的时候调用该方法</span></span><br><span class="line">		encoding = filterConfig.getInitParameter(<span class="string">&quot;encoding&quot;</span>);</span><br><span class="line">		</span><br><span class="line">        <span class="comment">//默认值是UTF-8</span></span><br><span class="line">		<span class="keyword">if</span>(encoding==<span class="keyword">null</span>) &#123;</span><br><span class="line">			encoding = <span class="string">&quot;UTF-8&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span><span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        </span><br><span class="line">		HttpServletRequest req = (HttpServletRequest) request;</span><br><span class="line">		System.out.println(<span class="string">&quot;encodingFilter : &quot;</span>+req.getRequestURI());</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//设置编码</span></span><br><span class="line">		request.setCharacterEncoding(encoding);</span><br><span class="line">		response.setCharacterEncoding(encoding);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//将请求放行</span></span><br><span class="line">		chain.doFilter(request, response);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">//过滤器销毁时候调用该方法</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="1-5-3-拦截类型"><a href="#1-5-3-拦截类型" class="headerlink" title="1.5.3 拦截类型"></a>1.5.3 拦截类型</h4><p>在web.xml中进行配置的时候，还可以配置拦截器拦截的请求类型，默认是REQUEST，也就是只要是浏览器发送的请求，且满足路径要求，就会被拦截器拦截。</p>
<p>例如，默认情况下，服务器内部跳转的请求，就无法被拦截，除非进行配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>checkFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>com.briup.filter.CheckFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>checkFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/test<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dispatcher</span>&gt;</span>FORWARD<span class="tag">&lt;/<span class="name">dispatcher</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dispatcher</span>&gt;</span>REQUEST<span class="tag">&lt;/<span class="name">dispatcher</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里默认的配置是REQUEST类型的请求拦截，也就是浏览器直接发送请求</p>
</blockquote>
<blockquote>
<p>除此之外，还有其他的拦截类型，了解知道即可。重点关注的时候REQUEST和FORWARD俩种</p>
</blockquote>
<blockquote>
<p>配置后在拦截器中测试,看是否拦截到路径 此处应该只拦截转发路径,请求路径不会拦截</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(<span class="string">&quot;验证过滤器执行: &quot;</span>);</span><br><span class="line">HttpServletRequest req = (HttpServletRequest) request;</span><br><span class="line">System.out.println(req.getRequestURI());</span><br></pre></td></tr></table></figure>



<h3 id="1-6-注解"><a href="#1-6-注解" class="headerlink" title="1.6 注解"></a>1.6 注解</h3><p>同时，也可以使用注解来完成过滤器的配置工作。</p>
<p>例如，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.DispatcherType;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.Filter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterConfig;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebFilter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebInitParam;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebFilter(value = &quot;/*&quot;,initParams = &#123;@WebInitParam(name = &quot;encoding&quot;,value = &quot;UTF-8&quot;)&#125;,dispatcherTypes = &#123;DispatcherType.REQUEST&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EncodingFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> String encoding;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">		<span class="comment">//过滤器初始化的时候调用该方法</span></span><br><span class="line">		encoding = filterConfig.getInitParameter(<span class="string">&quot;encoding&quot;</span>);</span><br><span class="line">		System.out.println(<span class="string">&quot;encoding = &quot;</span>+encoding);</span><br><span class="line">		<span class="keyword">if</span>(encoding==<span class="keyword">null</span>) &#123;</span><br><span class="line">			encoding = <span class="string">&quot;UTF-8&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">		HttpServletRequest req = (HttpServletRequest) request;</span><br><span class="line">		System.out.println(<span class="string">&quot;encodingFilter:&quot;</span>+req.getRequestURI());</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//设置编码</span></span><br><span class="line">		request.setCharacterEncoding(encoding);</span><br><span class="line">		response.setCharacterEncoding(encoding);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//将请求放行</span></span><br><span class="line">		chain.doFilter(request, response);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">//过滤器销毁时候调用该方法</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>需要注意的是，使用注解<code>@WebFilter</code>的形式来配置的过滤的话，那么多个过滤器拦截同一个路径，过滤器的执行顺序是<strong>过滤器类名的首字母</strong>的顺序来执行的</p>
<h2 id="2-listener"><a href="#2-listener" class="headerlink" title="2 listener"></a>2 listener</h2><h3 id="2-1-概述-2"><a href="#2-1-概述-2" class="headerlink" title="2.1 概述"></a>2.1 概述</h3><p>监听器（listener）用于监听web程序中的事件，监听器主要用于对 Session、request、application进行监控。</p>
<p>例如，创建、修改、删除Session、request、application等，并触发响应的事件。</p>
<h3 id="2-2-分类"><a href="#2-2-分类" class="headerlink" title="2.2 分类"></a>2.2 分类</h3><p>不同功能的监听器，需要实现不同的接口，可以大致分为以下几种监听器类型：</p>
<p>1、监听 request、Session、application 的创建和销毁，这些接口分别为</p>
<ul>
<li>ServletRequestListener</li>
<li>HttpSessionListener</li>
<li>ServletContextListener</li>
</ul>
<p>2、监听request、session、application三个对象中属性变化，这些接口分别为</p>
<ul>
<li>ServletRequestAttributeListener</li>
<li>HttpSessionAttributeListener</li>
<li>ServletContextAttributeListener</li>
</ul>
<p>3、监听Session对象里面存放着的其他对象，这些接口分别为</p>
<ul>
<li>HttpSessionBindingListener    </li>
<li>HttpSessionActivationListener</li>
</ul>
<h3 id="2-3-使用"><a href="#2-3-使用" class="headerlink" title="2.3 使用"></a>2.3 使用</h3><p><strong>1、监听 request、Session、application 的创建和销毁</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.listener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContextEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContextListener;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequestEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequestListener;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebListener;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionListener;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebListener</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ListenerTest</span> <span class="keyword">implements</span> <span class="title">HttpSessionListener</span>, <span class="title">ServletContextListener</span>, <span class="title">ServletRequestListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建 session</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionCreated</span><span class="params">(HttpSessionEvent se)</span> </span>&#123;</span><br><span class="line">		HttpSession session = se.getSession();</span><br><span class="line">		System.out.println(<span class="string">&quot;新创建一个session, ID为: &quot;</span> + session.getId());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 销毁 session</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionDestroyed</span><span class="params">(HttpSessionEvent se)</span> </span>&#123;</span><br><span class="line">		HttpSession session = se.getSession();</span><br><span class="line">		System.out.println(<span class="string">&quot;销毁一个session, ID为: &quot;</span> + session.getId());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 加载 application</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextInitialized</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</span><br><span class="line">		ServletContext servletContext = sce.getServletContext();</span><br><span class="line">		System.out.println(<span class="string">&quot;即将启动&quot;</span> + servletContext.getContextPath());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 卸载 application</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextDestroyed</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</span><br><span class="line">		ServletContext servletContext = sce.getServletContext();</span><br><span class="line">		System.out.println(<span class="string">&quot;即将关闭&quot;</span> + servletContext.getContextPath());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建 request</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">requestInitialized</span><span class="params">(ServletRequestEvent sre)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		HttpServletRequest request = (HttpServletRequest) sre.getServletRequest();</span><br><span class="line"></span><br><span class="line">		String uri = request.getRequestURI(); <span class="comment">// /helloSerlvet?name=lucy</span></span><br><span class="line">       <span class="comment">// name=lucy</span></span><br><span class="line">		uri = request.getQueryString() == <span class="keyword">null</span> ? uri : (uri + <span class="string">&quot;?&quot;</span> + request.getQueryString());</span><br><span class="line"></span><br><span class="line">		request.setAttribute(<span class="string">&quot;dateCreated&quot;</span>, System.currentTimeMillis());</span><br><span class="line"></span><br><span class="line">		System.out.println(<span class="string">&quot;IP &quot;</span> + request.getRemoteAddr() + <span class="string">&quot; 请求 &quot;</span> + uri);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 销毁 request</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">requestDestroyed</span><span class="params">(ServletRequestEvent sre)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		HttpServletRequest request = (HttpServletRequest) sre.getServletRequest();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">long</span> time = System.currentTimeMillis() - (Long) request.getAttribute(<span class="string">&quot;dateCreated&quot;</span>);</span><br><span class="line"></span><br><span class="line">		System.out.println(request.getRemoteAddr() + <span class="string">&quot;请求处理结束, 用时&quot;</span> + time + <span class="string">&quot;毫秒. &quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这里的监听器使用了注解配置，也可以使用xml配置，在web.xml中</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>com.briup.listener.TestListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br></pre></td></tr></table></figure>





<p><strong>2、监听request、session、application三个对象中属性变化</strong></p>
<p>三种监听器中的方法是一样的，这里以session为例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.listener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebListener;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionAttributeListener;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionBindingEvent;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebListener</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SessionAttributeListenerTest</span> <span class="keyword">implements</span> <span class="title">HttpSessionAttributeListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 添加属性</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attributeAdded</span><span class="params">(HttpSessionBindingEvent se)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//HttpSession session = se.getSession();</span></span><br><span class="line">		String name  = se.getName();</span><br><span class="line">		Object value = se.getValue();</span><br><span class="line">		System.out.println(<span class="string">&quot;新建session属性：&quot;</span> + name + <span class="string">&quot;, 值为：&quot;</span> + value);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 删除属性</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attributeRemoved</span><span class="params">(HttpSessionBindingEvent se)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//HttpSession session = se.getSession();</span></span><br><span class="line">		String name = se.getName();</span><br><span class="line">		Object value = se.getValue();</span><br><span class="line">		System.out.println(<span class="string">&quot;删除session属性：&quot;</span> + name + <span class="string">&quot;, 值为：&quot;</span> + value);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 修改属性</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attributeReplaced</span><span class="params">(HttpSessionBindingEvent se)</span> </span>&#123;</span><br><span class="line">		HttpSession session = se.getSession();</span><br><span class="line">		String name = se.getName();</span><br><span class="line">		Object oldValue = se.getValue();</span><br><span class="line">		Object newValue = session.getAttribute(name);</span><br><span class="line">		System.out.println(<span class="string">&quot;修改session属性：&quot;</span> + name + <span class="string">&quot;, 原值：&quot;</span> + oldValue + <span class="string">&quot;, 新值：&quot;</span> + newValue);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><strong>3、监听Session对象里面存放着的其他对象</strong></p>
<blockquote>
<p>注意，这种请求是需要让被监测的对象（一般是实体类）来实现指定接口</p>
<p>注意，这种情况使用较少，了解即可</p>
</blockquote>
<p><code>javax.servlet.http.HttpSessionBindingListener</code>接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> javax.servlet.http;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.EventListener;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">HttpSessionBindingListener</span> <span class="keyword">extends</span> <span class="title">EventListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//对象被放进session前调用</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">valueBound</span><span class="params">(HttpSessionBindingEvent event)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//对象从session中移除后调用</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">valueUnbound</span><span class="params">(HttpSessionBindingEvent event)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><code>javax.servlet.http.HttpSessionActivationListener</code>接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> javax.servlet.http;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.EventListener;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">HttpSessionActivationListener</span> <span class="keyword">extends</span> <span class="title">EventListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//session即将被持久化到硬盘时</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionWillPassivate</span><span class="params">(HttpSessionEvent se)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//session从硬盘加载后调用</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionDidActivate</span><span class="params">(HttpSessionEvent se)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>例如，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionActivationListener;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionBindingEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionBindingListener;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionEvent;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">HttpSessionBindingListener</span>,<span class="title">HttpSessionActivationListener</span>,<span class="title">Serializable</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">long</span> id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(<span class="keyword">long</span> id, String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">long</span> id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;User [id=&quot;</span> + id + <span class="string">&quot;, name=&quot;</span> + name + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// session从硬盘加载后  </span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionDidActivate</span><span class="params">(HttpSessionEvent se)</span> </span>&#123;  </span><br><span class="line">		HttpSession session = se.getSession();  </span><br><span class="line">		System.out.println(<span class="keyword">this</span> + <span class="string">&quot;已经成功从硬盘中加载。sessionId: &quot;</span> + session.getId());  </span><br><span class="line">	&#125;  </span><br><span class="line">  </span><br><span class="line">	<span class="comment">// session即将被持久化到硬盘时  </span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionWillPassivate</span><span class="params">(HttpSessionEvent se)</span> </span>&#123;  </span><br><span class="line">		HttpSession session = se.getSession();  </span><br><span class="line">		System.out.println(<span class="keyword">this</span> + <span class="string">&quot;即将保存到硬盘。sessionId: &quot;</span> + session.getId());  </span><br><span class="line">	&#125;  </span><br><span class="line">  </span><br><span class="line">	<span class="comment">// 当前对象被放进session前  </span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">valueBound</span><span class="params">(HttpSessionBindingEvent event)</span> </span>&#123;  </span><br><span class="line">		HttpSession session = event.getSession();  </span><br><span class="line">		String name = event.getName();  </span><br><span class="line">		System.out.println(<span class="keyword">this</span> + <span class="string">&quot;被绑定到session \&quot;&quot;</span> + session.getId() + <span class="string">&quot;\&quot;的&quot;</span> + name + <span class="string">&quot;属性上&quot;</span>);  </span><br><span class="line">	&#125;  </span><br><span class="line">  </span><br><span class="line">	<span class="comment">// 当前对象从session中移除后  </span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">valueUnbound</span><span class="params">(HttpSessionBindingEvent event)</span> </span>&#123;  </span><br><span class="line">		HttpSession session = event.getSession();  </span><br><span class="line">		String name = event.getName();  </span><br><span class="line">		System.out.println(<span class="keyword">this</span> + <span class="string">&quot;被从session \&quot;&quot;</span> + session.getId() + <span class="string">&quot;\&quot;的&quot;</span> + name + <span class="string">&quot;属性上移除&quot;</span>);  </span><br><span class="line">	&#125; </span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">&#125;	</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>配合测试的Servlet为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.entity.User;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/test&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		String flag = request.getParameter(<span class="string">&quot;flag&quot;</span>);</span><br><span class="line">		<span class="keyword">if</span>(flag==<span class="keyword">null</span>) &#123;</span><br><span class="line">			request.getSession().setAttribute(<span class="string">&quot;user&quot;</span>, <span class="keyword">new</span> User(<span class="number">1L</span>,<span class="string">&quot;tom&quot;</span>));</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			request.getSession().removeAttribute(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意: 如果user从session移除,序列化不成功</p>
</blockquote>
<h2 id="3-error-page"><a href="#3-error-page" class="headerlink" title="3 error-page"></a>3 error-page</h2><p>在web.xml中，可以使用<code>&lt;error-page&gt;</code>来定制错误的返回页面</p>
<p>例如，如果出现404情况，则跳转到/404.html页面中</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">error-page</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">error-code</span>&gt;</span>404<span class="tag">&lt;/<span class="name">error-code</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">location</span>&gt;</span>/404.html<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">error-page</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>也可以指定servlet中出现的异常情况：</p>
<p>例如，当servlet程序的时候，如果出现了以下类型异常，则跳转到not_found.html页面</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">error-page</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">exception-type</span>&gt;</span>java.io.FileNotFoundException<span class="tag">&lt;/<span class="name">exception-type</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">location</span>&gt;</span>/404.html<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">error-page</span>&gt;</span></span><br></pre></td></tr></table></figure>





<h2 id="4-WEB-INF"><a href="#4-WEB-INF" class="headerlink" title="4 WEB-INF"></a>4 WEB-INF</h2><p>WEB-INF是Java的WEB应用中的安全目录。</p>
<p>安全目录指的是客户端无法访问，只有服务端可以访问的目录。</p>
<p>例如，如果将hello.html页面存放在WEB-INF下，那么浏览器中是无法通过以下地址【直接】访问到该页面的：</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:8989/servlet-test/WEB-INF/hello.html">http://127.0.0.1:8989/servlet-test/WEB-INF/hello.html</a></p>
<p>但是，在servlet中是可以通过服务器内部跳转，来访问到WEB-INF目录下的资源的。</p>
<p>所以，浏览器可以访问servlet，让servlet再通过服务器内部跳转的方式，来访问WEB-INF下的hello.html，从而提高页面的安全性，因为在servlet中可以对本次请求进行验证，通过后跳转到WEB-INF下的页面，否则返回错误信息。</p>
<h2 id="5-上传"><a href="#5-上传" class="headerlink" title="5 上传"></a>5 上传</h2><h3 id="5-1-概述-1"><a href="#5-1-概述-1" class="headerlink" title="5.1 概述"></a>5.1 概述</h3><p>在不同版本的servlet中，完成上传的方式不同，servlet3.0及之前的版本，完成上传较为麻烦（了解即可），servlet3.1版本完成上传较为简单。</p>
<p>servlet3.0之前上传需要注意事项： </p>
<ol>
<li>需要导入两个包：commons-fileupload-1.4.jar,commons-io-2.8.0.jar</li>
<li>页面表单一定要是post方式提交</li>
<li>表单编码类型设置为：enctype=”multipart/form-data”，默认是 application/x-www-form-urlencoded</li>
<li>上传成功的时候，上传的文件可以在项目中的目录，也可以在系统目录</li>
<li>设置了表单的enctype=”multipart/form-data” 就【无法】通过HttpServletRequest对象的getParameter方法获取请求参数值。</li>
</ol>
<p>servlet3.1上传需要注意事项：</p>
<ol>
<li>不需要导入额外的jar包，使用servlet提供的@MultipartConfig注解和javax.servlet.http.Part接口类型对象即可</li>
<li>页面表单一定要是post方式提交</li>
<li>表单编码类型设置为：enctype=”multipart/form-data”，默认是 application/x-www-form-urlencoded</li>
<li>上传成功的时候，上传的文件可以在项目中的目录，也可以在系统目录</li>
<li>设置了表单的enctype=”multipart/form-data” 【也可以】通过HttpServletRequest对象的getParameter方法获取请求参数值。</li>
</ol>
<blockquote>
<p>注意，MultipartConfig和Part在Servlet3.0就加入了，但是里面的一些方法使用Servlet3.1在新增的</p>
</blockquote>
<h3 id="5-2-实现"><a href="#5-2-实现" class="headerlink" title="5.2 实现"></a>5.2 实现</h3><h4 id="5-2-1-servlet3-0"><a href="#5-2-1-servlet3-0" class="headerlink" title="5.2.1 servlet3.0"></a>5.2.1 servlet3.0</h4><p>1、引入jar</p>
<p>如果是动态的web项目，将需要的jar包，直接复制粘贴到项目中WEB-INF里面的lib目录中即可</p>
<p>如果是maven项目，直接引入依赖坐标即可：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">maven.compiler.soruce</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.soruce</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>2、编写页面upload.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>上传<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	 </span><br><span class="line">	<span class="tag">&lt;<span class="name">h1</span>&gt;</span>hello world<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">h2</span>&gt;</span>上传<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/upload1&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;上传&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>3、编写servlet</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.FileItem;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.disk.DiskFileItemFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.fileupload.servlet.ServletFileUpload;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * servlet3.0之前的上传操作</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/upload1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UpLoadServlet1</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	<span class="keyword">private</span> String path = <span class="string">&quot;D:\\briup\\upload&quot;</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">       <span class="comment">// 防止上传文件名乱拿吗</span></span><br><span class="line">		req.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">		resp.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">		String username = request.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">		<span class="comment">//页面表单中设置了enctype=&quot;multipart/form-data&quot;后</span></span><br><span class="line">		<span class="comment">//无法直接通过getParameter方法获取普通组件的参数值</span></span><br><span class="line">		System.out.println(<span class="string">&quot;getParameter username = &quot;</span>+username);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//如果是上传的目录在项目中，可以通过该方法获得该上传目录的绝对路径</span></span><br><span class="line"><span class="comment">//		String realpath = getServletContext().getRealPath(path);</span></span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">//构造一个文件上传处理对象</span></span><br><span class="line">			DiskFileItemFactory factory = <span class="keyword">new</span> DiskFileItemFactory();</span><br><span class="line">			ServletFileUpload upLoad = <span class="keyword">new</span> ServletFileUpload(factory);</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//获得表单中提交内容</span></span><br><span class="line">			List&lt;FileItem&gt; list = upLoad.parseRequest(request);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">for</span> (FileItem fileItem : list) &#123;</span><br><span class="line">				<span class="comment">//fileItem.isFormField()返回true表示是普通的表单组件</span></span><br><span class="line">				<span class="comment">//fileItem.isFormField()返回false表示是上传输入框</span></span><br><span class="line">				<span class="keyword">if</span> (fileItem.isFormField()) &#123;</span><br><span class="line">					<span class="comment">//getFieldName()方法获得普通表单组件的参数名</span></span><br><span class="line">					String FieldName = fileItem.getFieldName();</span><br><span class="line">					<span class="comment">//获得该参数所对应的值并指定编码</span></span><br><span class="line">					String Content = fileItem.getString(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">					<span class="comment">//为了后面可以把普通参数从request中拿出来</span></span><br><span class="line">					request.setAttribute(FieldName, Content);</span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					<span class="comment">//getName()取得上传文件的名字</span></span><br><span class="line">					String fileName = fileItem.getName();</span><br><span class="line">					<span class="comment">//避免文件名字重复</span></span><br><span class="line">					fileName = System.currentTimeMillis()+<span class="string">&quot;-&quot;</span>+fileName;</span><br><span class="line">					File dir = <span class="keyword">new</span> File(path);</span><br><span class="line">					<span class="keyword">if</span>(!dir.exists()) &#123;</span><br><span class="line">						dir.mkdirs();</span><br><span class="line">					&#125;</span><br><span class="line">					File file = <span class="keyword">new</span> File(dir, fileName);</span><br><span class="line">					<span class="comment">//把上传文件进行指定目录</span></span><br><span class="line">					fileItem.write(file);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//因为上面解析request中是数据后,把普通表单组件中的key和value放到了request中,所以这里可以拿出来</span></span><br><span class="line">			System.out.println(<span class="string">&quot;request.getAttribute(\&quot;username\&quot;) = &quot;</span>+request.getAttribute(<span class="string">&quot;username&quot;</span>));</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h4 id="5-2-2-servlet3-1"><a href="#5-2-2-servlet3-1" class="headerlink" title="5.2.2 servlet3.1"></a>5.2.2 servlet3.1</h4><p>1、编写页面upload.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>上传<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	 </span><br><span class="line">	<span class="tag">&lt;<span class="name">h1</span>&gt;</span>hello world<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">h2</span>&gt;</span>上传<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/upload2&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;上传&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>2、编写servlet</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.MultipartConfig;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.Part;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * servlet3.1的上传操作</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/upload2&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@MultipartConfig(location = &quot;D:\\briup\\upload&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UpLoadServlet2</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//可以使用filter来进行编码设置</span></span><br><span class="line">		<span class="comment">//request.setCharacterEncoding(&quot;UTF-8&quot;);</span></span><br><span class="line">		<span class="comment">//response.setCharacterEncoding(&quot;UTF-8&quot;);</span></span><br><span class="line">		</span><br><span class="line">		String username = request.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//获取上传的文件</span></span><br><span class="line">		Part part = request.getPart(<span class="string">&quot;file&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//获取上传文件的名字</span></span><br><span class="line">		<span class="comment">//servlet3.1的方法</span></span><br><span class="line">		String fileName = part.getSubmittedFileName();</span><br><span class="line">		</span><br><span class="line">		System.out.println(username+<span class="string">&quot; 上传了文件：&quot;</span>+fileName);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//避免上传的文件重复，文件名前面加上时间戳</span></span><br><span class="line">		part.write(System.currentTimeMillis()+<span class="string">&quot;-&quot;</span>+fileName);</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">       <span class="comment">//		String realPath = getServletContext().getRealPath(&quot;/upload&quot;);</span></span><br><span class="line">		<span class="comment">//		File file = new File(realPath);</span></span><br><span class="line">        <span class="comment">//		if(!file.exists()) &#123;</span></span><br><span class="line">        <span class="comment">//			file.mkdirs();</span></span><br><span class="line">        <span class="comment">//		&#125;</span></span><br><span class="line">        <span class="comment">//		part.write(realPath+&quot;/&quot;+fileName);</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// String realPath = &quot;D:/upload&quot;;</span></span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意:@MultipartConfig(location = “D:\briup\upload”)  该方式D:\briup\upload必须存在</p>
<p>可以有多种路径写法</p>
</blockquote>
<p><code>@MutipartConfig</code>注解参数：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132226274.png" alt="image-20201006010856560"></p>
<p><code>Part</code>接口的方法：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangsidandan/blog_images@main/servlet/202205132226705.png" alt="image-20201006011014051"></p>
<h2 id="6-下载"><a href="#6-下载" class="headerlink" title="6 下载"></a>6 下载</h2><p>servlet下载需要注意事项:</p>
<ol>
<li>servlet其实就是用io流不停的去读那个文件，然后再用输出流不停的写给客户端浏览器</li>
<li>下载结束，也就是说输出流结束之后，下面是不能再写跳转的代码的，要不然会报错</li>
<li>按照http协议的要求，设置下载的响应类型ContentType，以及设置响应头Content-Disposition来指定下载文件的名字</li>
</ol>
<p>1、编写页面download.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>下载<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">h1</span>&gt;</span>hello world<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">h2</span>&gt;</span>servlet下载<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;download?fileName=下载.png&quot;</span>&gt;</span>我的文档<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>2、编写servlet</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletOutputStream;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/download&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DownLoadServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	<span class="keyword">private</span> String path = <span class="string">&quot;D:\\briup\\upload&quot;</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request,</span></span></span><br><span class="line"><span class="params"><span class="function">			HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 获得用户需要下载文件的名字</span></span><br><span class="line">		String fileName = request.getParameter(<span class="string">&quot;fileName&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 如果是下载文件的目录在项目中，可以通过该方法获得该下载文件目录的绝对路径</span></span><br><span class="line"><span class="comment">//		String realPath = getServletContext().getRealPath(path);</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">// 响应类型设置为下载:application/x-download</span></span><br><span class="line">		response.setContentType(<span class="string">&quot;application/x-download&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 下载文件时显示文件的保存名称</span></span><br><span class="line">		String fileDisplay = <span class="string">&quot;briup_&quot;</span>+fileName;</span><br><span class="line">		<span class="comment">// 下载文件名的中文编码转换 因为写回去的时候是字节流</span></span><br><span class="line">		<span class="comment">// 不设置会出现下载文件的中文名字乱码</span></span><br><span class="line">		fileDisplay = <span class="keyword">new</span> String(fileDisplay.getBytes(<span class="string">&quot;utf-8&quot;</span>),<span class="string">&quot;ISO-8859-1&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 设置响应头部信息(http协议中的固定设置方式)</span></span><br><span class="line">		response.addHeader(<span class="string">&quot;Content-Disposition&quot;</span>, <span class="string">&quot;attachment;filename=&quot;</span>+fileDisplay);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		FileInputStream in = <span class="keyword">null</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">// 获取servlet中是输出流</span></span><br><span class="line">			ServletOutputStream out = response.getOutputStream();</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 使用IO流读取需要下载的文件</span></span><br><span class="line">			File file = <span class="keyword">new</span> File(path,fileName);</span><br><span class="line">			in = <span class="keyword">new</span> FileInputStream(file);</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 读取文件后再写回给浏览器</span></span><br><span class="line">			<span class="keyword">byte</span>[] b = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">			<span class="keyword">int</span> len = -<span class="number">1</span>;</span><br><span class="line">			<span class="keyword">while</span> ((len = in.read(b)) != -<span class="number">1</span>) &#123;</span><br><span class="line">				out.write(b, <span class="number">0</span>, len);</span><br><span class="line">			&#125;</span><br><span class="line">            <span class="comment">// ImageIoUtil.copy(in,out); </span></span><br><span class="line">			in.close();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">			<span class="keyword">if</span>(in!=<span class="keyword">null</span>) &#123;</span><br><span class="line">				in.close();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//注意下载之后就不能使用request跳转了,因为response已经返回了</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>可以看出，设置好响应头字段后，其他的就是使用IO流读取数据后再写回给浏览器</p>
</blockquote>
<blockquote>
<p>http header头要求其内容必须为iso-8859-1编码</p>
</blockquote>
<h2 id="7-三层架构"><a href="#7-三层架构" class="headerlink" title="7 三层架构"></a>7 三层架构</h2><p>在web项目的代码结构中，经常会使用到三层架构：</p>
<ul>
<li>web层  servlet/filter/listener</li>
<li>service层 </li>
<li>dao层</li>
</ul>
<p>web层中代码的主要任务：</p>
<ul>
<li>接收客户端传来的参数</li>
<li>把参数封装成对象   saveUser(user)</li>
<li>把封装好的对象/数据传给service</li>
<li>根据service层的处理结果决定把那个页面/数据返回给客户端</li>
</ul>
<p>service层中代码的主要任务：</p>
<ul>
<li>接收web层传过来的对象/数据(如果有的话)</li>
<li>根据这些信息进行业务逻辑处理</li>
</ul>
<p>例如，完成一个登录功能，web层接收到用户名和密码之后，把数据传给service层，service层就要根据这些信息来判断用户名是否存在、密码是否正确、用户是否有权限、用户状态当前是否可用、用户是否推送信息、是否给用户相关提示等，这些都属于登录的业务逻辑处理</p>
<p>dao层中代码的主要任务：</p>
<ul>
<li>接受service传的参数(如果有的话)</li>
<li>和数据库进行交互</li>
<li>把交互结果返回给service层</li>
</ul>
<p>==思考，项目的代码为何要分层编写，全部代码写到一个类中进行实现，是否可以？==</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/briup-java/" rel="tag">briup_java</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
  </article>
  

  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2015-2022
        <i class="ri-heart-fill heart_icon"></i> vanse
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>访问人数:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>浏览次数:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.svg" alt="vanse"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/playlist">音乐</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/photos">相册</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/friends">友链</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="https://gitee.com/vanse/images/raw/master/bruip_course/aliapy.png">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="https://gitee.com/vanse/images/raw/master/bruip_course/wechat.png">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->

<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script>

<script src="/js/clickBoom1.js"></script>
 
<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->
 
<script src="/js/dz.js"></script>
 
<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    <div id="music">
    
    
    
    <iframe frameborder="no" border="1" marginwidth="0" marginheight="0" width="200" height="52"
        src="//music.163.com/outchain/player?type=2&id=506654324&auto=0&height=32"></iframe>
</div>

<style>
    #music {
        position: fixed;
        right: 15px;
        bottom: 0;
        z-index: 998;
    }
</style>
    
    
<script>
  const password = "briup!";
  const lock_password = window.sessionStorage.getItem("lock_password");
  console.log(password, lock_password);
  if (lock_password !== password) {
    Swal.fire({
      title: "请输入访问密码",
      input: "password",
      inputAttributes: {
        autocapitalize: "off",
      },
      showCancelButton: false,
      showLoaderOnConfirm: true,
      allowOutsideClick: false,
      confirmButtonText: "确定",
    }).then((result) => {
      console.log(result);
      if (result.isConfirmed) {
        console.log(password);
        if (result.value === password) {
          window.sessionStorage.setItem("lock_password", result.value);
        } else {
          Swal.fire({
            icon: "error",
            title: "密码错误，请重试",
            confirmButtonText: "确定",
            allowOutsideClick: false,
          }).then(() => {
            window.location.reload();
          });
        }
      }
    });
  }
</script>


  </div>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>

</html>