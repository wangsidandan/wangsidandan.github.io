<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
        
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title> vanse</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/favicon.ico" />
       
<link rel="stylesheet" href="/dist/main.css">

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/css/remixicon.min.css"
      />
      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
       
 

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    </head>
  </html>
</html>


<body>
  <div id="app">
    
      <canvas class="fireworks"></canvas>
      <style>
        .fireworks {
          position: fixed;
          left: 0;
          top: 0;
          z-index: 99999;
          pointer-events: none;
        }
      </style>
      
      
    <main class="content on">
      
<section class="cover">
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="https://gitee.com/vanse/images/raw/master/photo_life/bg.jpeg" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">vanse</a></h1>
      <div id="subtitle-box">
        
        <span id="subtitle"></span>
        
      </div>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js"></script>


<!-- Subtitle -->

  <script>
    try {
      var typed = new Typed("#subtitle", {
        strings: ['你好啊！', '愿你一生努力，一生被爱', '想要的都拥有，得不到的都释怀'],
        startDelay: 0,
        typeSpeed: 200,
        loop: true,
        backSpeed: 100,
        showCursor: true
      });
    } catch (err) {
      console.log(err)
    }
  </script>
  
<div id="main">
  <section class="outer">
  
  
  

<div class="notice" style="margin-top:50px">
    <i class="ri-heart-fill"></i>
    <div class="notice-content" id="broad"></div>
</div>
<script type="text/javascript">
    fetch('https://v1.hitokoto.cn')
        .then(response => response.json())
        .then(data => {
            document.getElementById("broad").innerHTML = data.hitokoto;
        })
        .catch(console.error)
</script>

<style>
    .notice {
        padding: 20px;
        border: 1px dashed #e6e6e6;
        color: #969696;
        position: relative;
        display: inline-block;
        width: 100%;
        background: #fbfbfb50;
        border-radius: 10px;
    }

    .notice i {
        float: left;
        color: #999;
        font-size: 16px;
        padding-right: 10px;
        vertical-align: middle;
        margin-top: -2px;
    }

    .notice-content {
        display: initial;
        vertical-align: middle;
    }
</style>
  
  <article class="articles">
    
    
    
    
    <article
  id="post-briup-cms"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/archives/briup-cms.html"
    >cms</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/archives/briup-cms.html" class="article-date">
  <time datetime="2021-11-16T01:15:03.000Z" itemprop="datePublished">2021-11-16</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/project/">project</a>
  </div>
   
    </div>
     
	
	 
	
    <div class="article-entry" itemprop="articleBody">
       
  <p>前言</p>
<ul>
<li>教程: cms</li>
<li>时间: 2121/11/10</li>
<li>整理人: vanse(刘聪)</li>
<li>班级：菁英班</li>
</ul>
<h1 id="项目准备"><a href="#项目准备" class="headerlink" title="项目准备"></a>项目准备</h1><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><pre><code>在日常生活中，内容管理系统占到所有系统的80%以上，比如个人博客，腾讯新闻，今日头条，搜狐新 闻等。 这些都是我们日常生活中经常使用到的系统，它的核心就是可以概括为内容（资讯），一篇文章就是一个资讯，大家越来越喜欢将生活中的所见所闻简述出来。
</code></pre>
<p>如图：</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20210317215643452.png" alt="image-20210317215643452"></p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20210317215652686.png" alt="image-20210317215652686"></p>
<blockquote>
<p>可以看出，目前来讲对于资讯系统的需求量是非常大的</p>
</blockquote>
<pre><code>通用的看点资讯管理系统，采用前后台分离开发的技术，将系统分为前台页面展示以及后台资讯管理系统。对于后台系统是基本上是通用的，而前台可根据不同客户的需求去修改定制。
</code></pre>
<p>  (不涉及页面  使用某些前端模板)</p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>看点资讯系统最核心的数据是内容，例如文章、新闻等，所以后台主要功能是实现这些内容的管理，例如栏目管理、评论管理、用户管理以及角色管理等，对于前台可以灵活得展示后台的数据。<br>例如，</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20210317215829625.png" alt="image-20210317215829625"></p>
<h2 id="技术"><a href="#技术" class="headerlink" title="技术"></a>技术</h2><p>后台采用的技术：</p>
<ul>
<li>springboot(脚手架)</li>
<li>spring(容器)</li>
<li>springmvc(servlet封装 传输数据)</li>
<li>springdata-jpa(jdbc 处理数据)</li>
</ul>
<p>数据库：</p>
<ul>
<li>mysql    </li>
</ul>
<p>文档管理：</p>
<ul>
<li>swagger</li>
</ul>
<p>架构选取：</p>
<ul>
<li>三层架构<ul>
<li>controller</li>
<li>service</li>
<li>dao</li>
</ul>
</li>
</ul>
<h2 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h2><h3 id="用户模块"><a href="#用户模块" class="headerlink" title="用户模块"></a>用户模块</h3><blockquote>
<p>对应的实体类为User</p>
</blockquote>
<p>1、新增用户</p>
<ul>
<li>参数1：User</li>
</ul>
<p>2、编辑用户</p>
<ul>
<li>参数1：User</li>
</ul>
<p>3、查询用户（分页）</p>
<ul>
<li>参数1：Integer num(页数)</li>
<li>参数2：Integer size（每页显示多少条数据）</li>
</ul>
<p>4、删除用户（批量，注销用户）</p>
<ul>
<li>参数1：List<Long> ids</li>
</ul>
<p>5、禁用或解封用户信息（更新用户状态）</p>
<ul>
<li>参数1：Long id</li>
<li>参数2：String status</li>
</ul>
<p>6、根据用户名获取用户信息</p>
<ul>
<li>参数1：String username</li>
</ul>
<p>7、登录</p>
<ul>
<li>参数1：String username</li>
<li>参数2：String password</li>
</ul>
<h3 id="角色模块"><a href="#角色模块" class="headerlink" title="角色模块"></a>角色模块</h3><blockquote>
<p>对应的实体类为Role</p>
</blockquote>
<p>1、新增角色</p>
<ul>
<li>参数1：Role r</li>
</ul>
<p>2、编辑角色</p>
<ul>
<li>参数1：Role r</li>
</ul>
<p>3、查询角色（分页）</p>
<ul>
<li>参数1：Integer num(页数)</li>
<li>参数2：Integer size（每页显示多少条数据）</li>
</ul>
<p>4、批量删除角色</p>
<ul>
<li>参数1：List<Long> ids</li>
</ul>
<h3 id="资讯模块"><a href="#资讯模块" class="headerlink" title="资讯模块"></a>资讯模块</h3><blockquote>
<p>资讯在这里主要指的的是文章，对应的实体类为Article</p>
</blockquote>
<p>1、新增资讯</p>
<ul>
<li>参数1：Article article</li>
</ul>
<p>2、编辑资讯</p>
<ul>
<li>参数1：Article article</li>
</ul>
<p>3、查询资讯（分页）</p>
<ul>
<li>参数1：Integer num(页数)</li>
<li>参数2：Integer size（每页显示多少条数据）</li>
</ul>
<p>4、批量删除资讯</p>
<ul>
<li>参数1：List<Long> ids</li>
</ul>
<p>5、审核资讯</p>
<ul>
<li>参数1：Long id</li>
<li>参数2：String status</li>
</ul>
<p>6、根据类别ID查询，分页获取资讯信息，并且按照阅读量降序排</p>
<ul>
<li>参数1：Long categoryId</li>
<li>参数2：Integer pageNum</li>
<li>参数3：Integer pageSize</li>
</ul>
<p>7、根据用户分页获取资讯信息</p>
<ul>
<li>参数1：Long userId</li>
<li>参数2：Integer pageNum</li>
<li>参数3：Integer pageSize</li>
</ul>
<h3 id="类别模块"><a href="#类别模块" class="headerlink" title="类别模块"></a>类别模块</h3><blockquote>
<p>类别也就是栏目： Category</p>
</blockquote>
<p>1、新增类别</p>
<ul>
<li>参数1：Category category</li>
</ul>
<p>2、编辑类别</p>
<ul>
<li>参数1：Category category</li>
</ul>
<p>3、查询类别（分页）</p>
<ul>
<li>参数1：Integer num(页数)</li>
<li>参数2：Integer size（每页显示多少条数据）</li>
</ul>
<p>4、批量删除类别</p>
<ul>
<li>参数1：List<Long> ids</li>
</ul>
<p>5、更新类别序号</p>
<ul>
<li>参数1：Long id</li>
<li>参数2：Long no</li>
</ul>
<p>6、按照序号升序分页获取类别信息</p>
<ul>
<li>参数1：Integer num(页数)</li>
<li>参数2：Integer size（每页显示多少条数据）</li>
</ul>
<h3 id="评论模块"><a href="#评论模块" class="headerlink" title="评论模块"></a>评论模块</h3><blockquote>
<p>对应的实体类为Comment</p>
</blockquote>
<p>1、新增评论</p>
<ul>
<li>参数1：Comment comment</li>
</ul>
<p>2、编辑评论</p>
<ul>
<li>参数1：Comment comment</li>
</ul>
<p>3、批量删除评论</p>
<ul>
<li>参数1：List<Long> ids</li>
</ul>
<p>4、查询评论（分页）</p>
<ul>
<li>参数1：Integer num(页数)</li>
<li>参数2：Integer size（每页显示多少条数据）</li>
</ul>
<p>5、分页获取指定文章下所有的评论</p>
<ul>
<li>参数1：Long articleId</li>
<li>参数2：Integer num</li>
<li>参数3：Integer size</li>
</ul>
<h2 id="字典"><a href="#字典" class="headerlink" title="字典"></a>字典</h2><p>1、用户表，cms_user</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20210317221131577.png" alt="image-20210317221131577"></p>
<p>2、角色表，cms_role</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20210317221149140.png" alt="image-20210317221149140"></p>
<p>3、文章类别表，cms_category</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20210317221204520.png" alt="image-20210317221204520"></p>
<p>4、文章表，cms_article</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20210317221220121.png" alt="image-20210317221220121"></p>
<p>5、评论表，cms_comment</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20210317221235341.png" alt="image-20210317221235341"></p>
<blockquote>
<p>注意，因为项目中使用了JPA，可以在实体类中配置完关系映射后，让JPA根据配置自动创建表</p>
</blockquote>
<h2 id="原型图"><a href="#原型图" class="headerlink" title="原型图"></a>原型图</h2><p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20210317230950797.png" alt="image-20210317230950797"></p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20210317231012612.png" alt="image-20210317231012612"></p>
<h1 id="项目搭建"><a href="#项目搭建" class="headerlink" title="项目搭建"></a>项目搭建</h1><blockquote>
<p>创建cms项目</p>
</blockquote>
<h2 id="pom"><a href="#pom" class="headerlink" title="pom"></a>pom</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">relativePath</span> /&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.briup<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cms<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-co.nnector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="properties"><a href="#properties" class="headerlink" title="properties"></a>properties</h2><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">9999</span></span><br><span class="line"><span class="meta">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/cms?characterEncoding=utf8&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=GMT%2B8</span></span><br><span class="line"><span class="meta">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">spring.datasource.password</span>=<span class="string">root</span></span><br><span class="line"><span class="comment">#cj  8.0</span></span><br><span class="line"><span class="meta">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 如果需要,可以进行自动建表</span></span><br><span class="line"><span class="meta">spring.jpa.hibernate.ddl-auto</span>=<span class="string">update</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 如果需要,可以执行指定的sql文件进行建表 </span></span><br><span class="line"><span class="comment">#spring.datasource.schema=sql/test.sql</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 如果需要,可以显示执行的sql语句</span></span><br><span class="line"><span class="meta">spring.jpa.show-sql</span>=<span class="string">true</span></span><br><span class="line"><span class="comment"># 如果需要,可以格式化sql语句</span></span><br><span class="line"><span class="meta">spring.jpa.properties.hibernate.format_sql</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure>

<h2 id="entity"><a href="#entity" class="headerlink" title="entity"></a>entity</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;cms_user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">	<span class="meta">@Id</span></span><br><span class="line">	<span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">	<span class="keyword">private</span> Integer id;</span><br><span class="line">	<span class="meta">@Column(nullable = false)</span></span><br><span class="line">	<span class="keyword">private</span> String username;</span><br><span class="line">	<span class="meta">@Column(nullable = false)</span></span><br><span class="line">	<span class="keyword">private</span> String password;</span><br><span class="line">	<span class="keyword">private</span> String phone;</span><br><span class="line">	<span class="meta">@Column(name = &quot;real_name&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String realName;</span><br><span class="line">	<span class="keyword">private</span> String gender;</span><br><span class="line">	<span class="keyword">private</span> Date birthday;</span><br><span class="line">	<span class="meta">@Column(name = &quot;register_time&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Date registerTime;</span><br><span class="line">	<span class="meta">@Column(nullable = false,columnDefinition = &quot;varchar(5) COMMENT &#x27;状态 正常0 禁用1&#x27;&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String status;</span><br><span class="line">	<span class="keyword">private</span> String image;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="dao"><a href="#dao" class="headerlink" title="dao"></a>dao</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDao</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">User</span>, <span class="title">Integer</span>&gt;</span>&#123;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="main"><a href="#main" class="headerlink" title="main"></a>main</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CmsApplication</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		SpringApplication.run(CmsApplication.class, args);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="test"><a href="#test" class="headerlink" title="test"></a>test</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestJPA</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> UserDao userDao;</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testInsert</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		User user = <span class="keyword">new</span> User();</span><br><span class="line">		user.setUsername(<span class="string">&quot;vanse&quot;</span>);</span><br><span class="line">		user.setPassword(<span class="string">&quot;000&quot;</span>);</span><br><span class="line">		user.setStatus(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">		userDao.save(user);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		List&lt;User&gt; userList = userDao.findAll();</span><br><span class="line">		System.out.println(userList);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="service"><a href="#service" class="headerlink" title="service"></a>service</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">	<span class="function">List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line">------------------------</span><br><span class="line"> <span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span></span>&#123;</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> UserDao userDao;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		List&lt;User&gt; userList = userDao.findAll();</span><br><span class="line">		<span class="keyword">return</span> userList;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="controller"><a href="#controller" class="headerlink" title="controller"></a>controller</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> UserService userService;</span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/findAll&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> userService.findAll();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="启动项目"><a href="#启动项目" class="headerlink" title="启动项目"></a>启动项目</h2><p><a target="_blank" rel="noopener" href="http://localhost:9999/user/findAll">访问路径</a></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">&quot;username&quot;</span>: <span class="string">&quot;vanse&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;password&quot;</span>: <span class="string">&quot;000&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;phone&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">&quot;realName&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">&quot;gender&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">&quot;birthday&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">&quot;registerTime&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">&quot;status&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;image&quot;</span>: <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>



<h2 id="热部署"><a href="#热部署" class="headerlink" title="热部署"></a>热部署</h2><p>pom.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 热部署 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- optional=true, 依赖不会传递, 该项目依赖devtools; 之后依赖boot项目的项目如果想要使用devtools, </span></span><br><span class="line"><span class="comment">				需要重新引入 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 热部署</span></span><br><span class="line"><span class="meta">spring.devtools.restart.enabled</span>=<span class="string">true   </span></span><br><span class="line"><span class="meta">spring.devtools.restart.additional-paths</span>=<span class="string">src/main/java </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#返回json的全局时间格式 如果设置全局 生日也得是这个格式</span></span><br><span class="line"><span class="comment">#spring.jackson.date-format=yyyy-MM-dd HH:mm:ss</span></span><br><span class="line"><span class="comment">#spring.jackson.time-zone=GMT+8</span></span><br></pre></td></tr></table></figure>







<p><code>问题</code></p>
<p>前后端分离的情况下，数据对接。</p>
<hr>
<h1 id="swagger"><a href="#swagger" class="headerlink" title="swagger"></a>swagger</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><blockquote>
<p>项目采用前后台分离的架构进行开发，后台可以使用Swagger，生成在线API文档，方便前端人员对接使用</p>
</blockquote>
<p><code>Swagger </code>是一个规范和完整的框架，用于生成、描述、调用和可视化 RESTful 风格的 Web 服务。</p>
<p><a target="_blank" rel="noopener" href="https://swagger.io/">Swagger官网</a></p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20211110235217141.png" alt="image-20211110235217141"></p>
<p><a target="_blank" rel="noopener" href="https://petstore.swagger.io/?_ga=2.236238660.419502645.1636559508-49422942.1636559508">配置生成的在线API文档样例：</a></p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20211110235430680.png" alt="image-20211110235430680"></p>
<p><code>springfox </code>，是一个开源的API Doc的框架， 它的前身是swagger-springmvc，可以将我们的Controller中<br>的方法以文档的形式展现。</p>
<p><a target="_blank" rel="noopener" href="http://springfox.github.io/springfox/">springfox官网</a></p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20211110235736768.png" alt="image-20211110235736768"></p>
<p><code>springfox-swagger2 </code>，它是整合springmvc和swagger2的一个项目，项目中使用swagger时，要引入它<br>的<a target="_blank" rel="noopener" href="https://mvnrepository.com/artifact/io.springfox/springfox-swagger2">依赖</a></p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20211110235947547.png" alt="image-20211110235947547"></p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>swagger-demo</p>
<h2 id="整合"><a href="#整合" class="headerlink" title="整合"></a>整合</h2><h3 id="pom-1"><a href="#pom-1" class="headerlink" title="pom"></a>pom</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- swagger-ui依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--swagger依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.swagger<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>swagger-models<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.swagger<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>swagger-models<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="config"><a href="#config" class="headerlink" title="config"></a>config</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.cms.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.ApiInfoBuilder;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.PathSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.RequestHandlerSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.ApiInfo;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.Contact;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spi.DocumentationType;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spring.web.plugins.Docket;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.swagger2.annotations.EnableSwagger2;</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Swagger2Config</span> </span>&#123;</span><br><span class="line">	<span class="comment">// ApiSelectorBuilder select() api选择器</span></span><br><span class="line">	<span class="comment">// 指定处理器 任何路径</span></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Docket <span class="title">createDocket</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2)</span><br><span class="line">				.apiInfo(apiInfo())</span><br><span class="line">				.select()</span><br><span class="line">				.apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.briup.cms.controller&quot;</span>))</span><br><span class="line">				.paths(PathSelectors.any())</span><br><span class="line">				.build();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// swagger页面中显示的基本信息</span></span><br><span class="line">	<span class="comment">//@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> ApiInfo <span class="title">apiInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> ApiInfoBuilder()</span><br><span class="line">				.title(<span class="string">&quot;cms&quot;</span>)</span><br><span class="line">				.description(<span class="string">&quot;新闻发布系统&quot;</span>)</span><br><span class="line">				.version(<span class="string">&quot;1.0&quot;</span>)</span><br><span class="line">				.contact(<span class="keyword">new</span> Contact(<span class="string">&quot;vanse&quot;</span>, <span class="string">&quot;http://wangsidandan.github.io&quot;</span>, <span class="string">&quot;wangsidandan@gmail.com&quot;</span>))</span><br><span class="line">				.build();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，swagger中基本都是固定的配置，按照自己的项目情况，进行修改字符串变量即可</p>
</blockquote>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20211111101837824.png" alt="image-20211111101837824"></p>
<p><code>问题</code></p>
<p>前端同事可看接口，但是不明其意。</p>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p><strong>UserController.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="comment">// 模块注释</span></span><br><span class="line"><span class="meta">@Api(tags  = &quot;用户模块&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> UserService userService;</span><br><span class="line">	</span><br><span class="line">       <span class="comment">// 方法注释</span></span><br><span class="line">	<span class="meta">@ApiOperation(value = &quot;查询所有用户&quot;,notes = &quot;不需要参数&quot;)</span></span><br><span class="line">	<span class="meta">@GetMapping</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> userService.findAll();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ApiOperation(value = &quot;根据id查找用户&quot;,notes = &quot;需要参数id&quot;)</span></span><br><span class="line">        <span class="comment">// rest风格</span></span><br><span class="line">	<span class="meta">@GetMapping(&quot;&#123;id&#125;&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> User <span class="title">findById</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">			<span class="meta">@ApiParam(name = &quot;id&quot;,value = &quot;用户id&quot;,required = true)</span> </span></span></span><br><span class="line"><span class="params"><span class="function">			<span class="meta">@PathVariable(&quot;id&quot;)</span> </span></span></span><br><span class="line"><span class="params"><span class="function">			Integer id)</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">		<span class="keyword">return</span> userService.findById(id);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>UserService</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">	<span class="function">List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function">User <span class="title">findById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>UserServiceImpl</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span></span>&#123;</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> UserDao userDao;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		List&lt;User&gt; userList = userDao.findAll();</span><br><span class="line">		<span class="keyword">return</span> userList;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * getOne: 懒加载</span></span><br><span class="line"><span class="comment">	 * 		如果是懒加载，此时返回json数据会报错</span></span><br><span class="line"><span class="comment">	 * 		需要在实体类上做处理 @JsonIgnoreProperties(&#123;&quot;hibernateLazyInitializer&quot;,&quot;handler&quot;&#125;)</span></span><br><span class="line"><span class="comment">	 * findById：及时 加载</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> User <span class="title">findById</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 懒加载</span></span><br><span class="line">		<span class="comment">//User user = userDao.getOne(id);</span></span><br><span class="line">		<span class="comment">// 及时加载   </span></span><br><span class="line">		User user = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			user = userDao.findById(id).get(); <span class="comment">// 如果id不存在 会报错</span></span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> CustomerException(ResultCode.DATA_NONE);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> user;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20211111124209738.png" alt="image-20211111124209738"></p>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><ul>
<li>前后端需要统一返回格式</li>
<li>抛出异常数据需要处理</li>
</ul>
<h1 id="响应数据"><a href="#响应数据" class="headerlink" title="响应数据"></a>响应数据</h1><p>导入工具类  <strong>Result和ResultCode</strong></p>
<p>Result</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 统一Controller中RESTFul风格接口返回的结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Result</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> Integer code;</span><br><span class="line">	<span class="keyword">private</span> String msg;</span><br><span class="line">	<span class="keyword">private</span> Object data;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="title">Result</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="title">Result</span><span class="params">(Integer code, String msg)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.code = code;</span><br><span class="line">		<span class="keyword">this</span>.msg = msg;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setResultCode</span><span class="params">(ResultCode code)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.code = code.code();</span><br><span class="line">		<span class="keyword">this</span>.msg = code.message();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 操作失败，自定义code和msg</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title">failure</span><span class="params">(Integer code, String msg)</span> </span>&#123;</span><br><span class="line">		Result result = <span class="keyword">new</span> Result(code,msg);</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 操作成功，没有返回的数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title">success</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Result result = <span class="keyword">new</span> Result();</span><br><span class="line">		result.setResultCode(ResultCode.SUCCESS);</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 操作成功，有返回的数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title">success</span><span class="params">(Object data)</span> </span>&#123;</span><br><span class="line">		Result result = <span class="keyword">new</span> Result();</span><br><span class="line">		result.setResultCode(ResultCode.SUCCESS);</span><br><span class="line">		result.setData(data);</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 操作失败，没有返回的数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title">failure</span><span class="params">(ResultCode resultCode)</span> </span>&#123;</span><br><span class="line">		Result result = <span class="keyword">new</span> Result();</span><br><span class="line">		result.setResultCode(resultCode);</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 操作失败，有返回的数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title">failure</span><span class="params">(ResultCode resultCode, Object data)</span> </span>&#123;</span><br><span class="line">		Result result = <span class="keyword">new</span> Result();</span><br><span class="line">		result.setResultCode(resultCode);</span><br><span class="line">		result.setData(data);</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> code;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCode</span><span class="params">(Integer code)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.code = code;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getMsg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> msg;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMsg</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.msg = msg;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">getData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> data;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setData</span><span class="params">(Object data)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.data = data;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ResultCode</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 统一并自定义返回状态码，如有需求可以另外增加</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">ResultCode</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/* 成功状态码 */</span></span><br><span class="line">	SUCCESS(<span class="number">1</span>, <span class="string">&quot;操作成功&quot;</span>),</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/* 参数错误：10001-19999 */</span></span><br><span class="line">	PARAM_IS_INVALID(<span class="number">10001</span>, <span class="string">&quot;参数无效&quot;</span>),</span><br><span class="line">	PARAM_IS_BLANK(<span class="number">10002</span>, <span class="string">&quot;参数为空&quot;</span>),</span><br><span class="line">	PARAM_TYPE_BIND_ERROR(<span class="number">10003</span>, <span class="string">&quot;参数类型错误&quot;</span>),</span><br><span class="line">	PARAM_NOT_COMPLETE(<span class="number">10004</span>, <span class="string">&quot;参数缺失&quot;</span>),</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/* 用户错误：20001-29999*/</span></span><br><span class="line">	USER_NOT_LOGIN(<span class="number">20001</span>, <span class="string">&quot;用户未登录&quot;</span>),</span><br><span class="line">	USER_LOGIN_ERROR(<span class="number">20002</span>, <span class="string">&quot;账号不存在或密码错误&quot;</span>),</span><br><span class="line">	USER_ACCOUNT_FORBIDDEN(<span class="number">20003</span>, <span class="string">&quot;账号已被禁用&quot;</span>),</span><br><span class="line">	USER_NOT_EXIST(<span class="number">20004</span>, <span class="string">&quot;用户不存在&quot;</span>),</span><br><span class="line">	USER_HAS_EXISTED(<span class="number">20005</span>, <span class="string">&quot;用户已存在&quot;</span>),</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/* 业务错误：30001-39999 */</span></span><br><span class="line">	SPECIFIED_QUESTIONED_USER_NOT_EXIST(<span class="number">30001</span>, <span class="string">&quot;业务逻辑出现问题&quot;</span>),</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/* 系统错误：40001-49999 */</span></span><br><span class="line">	SYSTEM_INNER_ERROR(<span class="number">40001</span>, <span class="string">&quot;系统内部错误，请稍后重试&quot;</span>),</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/* 数据错误：50001-599999 */</span></span><br><span class="line">	DATA_NONE(<span class="number">50001</span>, <span class="string">&quot;数据未找到&quot;</span>),</span><br><span class="line">	DATA_WRONG(<span class="number">50002</span>, <span class="string">&quot;数据错误&quot;</span>),</span><br><span class="line">	DATA_EXISTED(<span class="number">50003</span>, <span class="string">&quot;数据已存在&quot;</span>),</span><br><span class="line">	DATA_USEING(<span class="number">50004</span>,<span class="string">&quot;该数据正在被引用&quot;</span>),</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/* 接口错误：60001-69999 */</span></span><br><span class="line">	INTERFACE_INNER_INVOKE_ERROR(<span class="number">60001</span>, <span class="string">&quot;内部系统接口调用异常&quot;</span>),</span><br><span class="line">	INTERFACE_OUTTER_INVOKE_ERROR(<span class="number">60002</span>, <span class="string">&quot;外部系统接口调用异常&quot;</span>),</span><br><span class="line">	INTERFACE_FORBID_VISIT(<span class="number">60003</span>, <span class="string">&quot;该接口禁止访问&quot;</span>),</span><br><span class="line">	INTERFACE_ADDRESS_INVALID(<span class="number">60004</span>, <span class="string">&quot;接口地址无效&quot;</span>),</span><br><span class="line">	INTERFACE_REQUEST_TIMEOUT(<span class="number">60005</span>, <span class="string">&quot;接口请求超时&quot;</span>),</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/* 权限错误：70001-79999 */</span></span><br><span class="line">	PERMISSION_NO_ACCESS(<span class="number">70001</span>, <span class="string">&quot;无访问权限&quot;</span>);</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> Integer code;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> String message;</span><br><span class="line"></span><br><span class="line">	ResultCode(Integer code, String message) &#123;</span><br><span class="line">		<span class="keyword">this</span>.code = code;</span><br><span class="line">		<span class="keyword">this</span>.message = message;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">code</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.code;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">message</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.message;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>测试</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;code&quot;</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">&quot;msg&quot;</span>: <span class="string">&quot;操作成功&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;data&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="attr">&quot;username&quot;</span>: <span class="string">&quot;vanse&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;password&quot;</span>: <span class="string">&quot;000&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;phone&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">&quot;realName&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">&quot;gender&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">&quot;birthday&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">&quot;registerTime&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">&quot;status&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;image&quot;</span>: <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>问题</code></p>
<p>如果异常，统一响应格式失效</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;timestamp&quot;</span>: <span class="string">&quot;2021-11-11T06:00:16.631+0000&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;status&quot;</span>: <span class="number">500</span>,</span><br><span class="line">  <span class="attr">&quot;error&quot;</span>: <span class="string">&quot;Internal Server Error&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;message&quot;</span>: <span class="string">&quot;/ by zero&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;path&quot;</span>: <span class="string">&quot;/user/1&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="全局异常"><a href="#全局异常" class="headerlink" title="全局异常"></a>全局异常</h1><h2 id="默认异常"><a href="#默认异常" class="headerlink" title="默认异常"></a>默认异常</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobleExceptionHandler</span> </span>&#123;</span><br><span class="line">	<span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Result <span class="title">handler</span><span class="params">(Exception e)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> Result.failure(<span class="number">500</span>, <span class="string">&quot;服务器异常: &quot;</span> + e.getMessage());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="自定义异常"><a href="#自定义异常" class="headerlink" title="自定义异常"></a>自定义异常</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// throw new CustomerException(&quot;&quot;);</span></span><br><span class="line"><span class="comment">// throw new CustomerException(ResultCode.failure)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	<span class="keyword">private</span> ResultCode resultCode;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">CustomerException</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(message);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">CustomerException</span><span class="params">(ResultCode resultCode)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//this(resultCode.message());</span></span><br><span class="line">		<span class="keyword">this</span>.resultCode = resultCode;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> ResultCode <span class="title">getResultCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> resultCode;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setResultCode</span><span class="params">(ResultCode resultCode)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.resultCode = resultCode;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//new CustomerException(&quot;&quot;);</span></span><br><span class="line">		<span class="keyword">new</span> CustomerException(ResultCode.DATA_EXISTED);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>改造 GlobleExceptionHandler</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobleExceptionHandler</span> </span>&#123;</span><br><span class="line">	<span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Result <span class="title">handler</span><span class="params">(Exception e)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(e <span class="keyword">instanceof</span> CustomerException) &#123;</span><br><span class="line">			<span class="comment">// new CustomerException(ResultCode.DATA_EXISTED) 对方抛出ResultCode</span></span><br><span class="line">			<span class="comment">// 全局捕获到ResultCode</span></span><br><span class="line">			<span class="keyword">return</span> Result.failure( ((CustomerException)e).getResultCode() );</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> Result.failure(<span class="number">500</span>, <span class="string">&quot;服务器异常: &quot;</span> + e.getMessage());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;根据id查找用户&quot;,notes = &quot;需要参数id&quot;)</span></span><br><span class="line">	<span class="meta">@GetMapping(&quot;&#123;id&#125;&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Result <span class="title">findById</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">			<span class="meta">@ApiParam(name = &quot;id&quot;,value = &quot;用户id&quot;,required = true)</span> </span></span></span><br><span class="line"><span class="params"><span class="function">			<span class="meta">@PathVariable(&quot;id&quot;)</span> </span></span></span><br><span class="line"><span class="params"><span class="function">			Integer id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(id &lt; <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> CustomerException(ResultCode.DATA_NONE);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> Result.success(userService.findById(id));</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;code&quot;</span>: <span class="number">50001</span>,</span><br><span class="line">  <span class="attr">&quot;msg&quot;</span>: <span class="string">&quot;数据未找到&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;data&quot;</span>: <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="用户模块-1"><a href="#用户模块-1" class="headerlink" title="用户模块"></a>用户模块</h1><h2 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.service;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IUserService</span> </span>&#123;</span><br><span class="line">		<span class="comment">//分页获取所有用户信息</span></span><br><span class="line">		<span class="function">Page&lt;User&gt; <span class="title">getAll</span><span class="params">(Integer pageNum,Integer pageSize)</span></span>;</span><br><span class="line">		<span class="comment">//新增用户信息或者更新学生信息</span></span><br><span class="line">		<span class="function"><span class="keyword">void</span> <span class="title">saveOrUpdateUser</span><span class="params">(User user)</span></span>;</span><br><span class="line">		<span class="comment">//批量删除用户信息</span></span><br><span class="line">		<span class="function"><span class="keyword">void</span> <span class="title">deleteUserInBatch</span><span class="params">(List&lt;Integer&gt; ids)</span></span>;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//修改用户的状态</span></span><br><span class="line">		<span class="function"><span class="keyword">void</span> <span class="title">updateUserStatus</span><span class="params">(Integer id,String status)</span></span>;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//登录</span></span><br><span class="line">		<span class="function">User <span class="title">login</span><span class="params">(String username,String password)</span></span>;</span><br><span class="line">		<span class="comment">//根据用户名获取用户信息</span></span><br><span class="line">		<span class="function">User <span class="title">findUserByUsername</span><span class="params">(String username)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="新增-更新"><a href="#新增-更新" class="headerlink" title="新增/更新"></a>新增/更新</h2><h3 id="UserServiceImpl"><a href="#UserServiceImpl" class="headerlink" title="UserServiceImpl"></a>UserServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveOrUpdateUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// user部分数据后台处理</span></span><br><span class="line">		user.setRegisterTime(<span class="keyword">new</span> Date());</span><br><span class="line">		user.setStatus(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">		userDao.save(user);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>



<h3 id="UserController"><a href="#UserController" class="headerlink" title="UserController"></a>UserController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;插入或更新&quot;,notes = &quot;有id:更新 无id:插入&quot;)</span></span><br><span class="line">	<span class="meta">@PostMapping</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Result <span class="title">saveOrUpdateUser</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span> </span>&#123;</span><br><span class="line">		userService.saveOrUpdateUser(user);</span><br><span class="line">		<span class="keyword">return</span> Result.success();</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p><strong>User需要更改</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 生日只有年月日 转换日期格式，只要日期即可</span></span><br><span class="line"><span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd&quot;,timezone=&quot;GMT+8&quot;)</span></span><br><span class="line"><span class="keyword">private</span> Date birthday;</span><br></pre></td></tr></table></figure>



<h3 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 添加</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;birthday&quot;</span>: <span class="string">&quot;2000-11-04&quot;</span>,  # 后台时间模式为 yyyy-MM-dd  注意补全</span><br><span class="line">  <span class="attr">&quot;gender&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;image&quot;</span>: <span class="string">&quot;string&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;password&quot;</span>: <span class="string">&quot;000&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;phone&quot;</span>: <span class="string">&quot;110&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;realName&quot;</span>: <span class="string">&quot;tom&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;username&quot;</span>: <span class="string">&quot;追风少年&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>问题</code></p>
<p>前端同事不知道字段含义 不知道哪些必须传</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;cms_user&quot;)</span></span><br><span class="line"><span class="meta">@ApiModel(&quot;用户模型&quot;)</span></span><br><span class="line"><span class="comment">// 解决懒加载返回null报错的问题</span></span><br><span class="line"><span class="meta">@JsonIgnoreProperties(&#123;&quot;hibernateLazyInitializer&quot;,&quot;handler&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">	<span class="meta">@Id</span></span><br><span class="line">	<span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">	<span class="meta">@ApiModelProperty(name = &quot;id&quot;,value = &quot;用户id,不加为新增,添加为修改&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Integer id;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ApiModelProperty(name = &quot;username&quot;,value = &quot;用户名&quot;,required = true,example = &quot;vanse&quot;)</span></span><br><span class="line">	<span class="meta">@Column(nullable = false)</span></span><br><span class="line">	<span class="keyword">private</span> String username;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ApiModelProperty(name = &quot;password&quot;,value = &quot;密码&quot;,required = true,example = &quot;000&quot;)</span></span><br><span class="line">	<span class="meta">@Column(nullable = false)</span></span><br><span class="line">	<span class="keyword">private</span> String password;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ApiModelProperty(name = &quot;phone&quot;,value = &quot;手机号&quot;,required = true,example = &quot;175********&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String phone;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ApiModelProperty(name = &quot;realName&quot;,value = &quot;真实姓名&quot;,required = true,example = &quot;老刘&quot;)</span></span><br><span class="line">	<span class="meta">@Column(name = &quot;real_name&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String realName;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ApiModelProperty(name = &quot;gender&quot;,value = &quot;性别&quot;,required = true,example = &quot;0&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String gender;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 生日只有年月日</span></span><br><span class="line">	<span class="meta">@ApiModelProperty(name = &quot;birthday&quot;,value = &quot;生日&quot;,required = true,example = &quot;1900-01-12&quot;)</span></span><br><span class="line">	<span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd&quot;,timezone=&quot;GMT+8&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Date birthday;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ApiModelProperty(hidden = true)</span></span><br><span class="line">	<span class="meta">@Column(name = &quot;register_time&quot;)</span></span><br><span class="line">    <span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;,timezone=&quot;GMT+8&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Date registerTime;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Column(nullable = false,columnDefinition = &quot;varchar(5) COMMENT &#x27;状态 正常0 禁用1&#x27;&quot;)</span></span><br><span class="line">	<span class="meta">@ApiModelProperty(name = &quot;状态&quot;,value = &quot;默认为0,添加不需要&quot;,example = &quot;1&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String status;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ApiModelProperty(name = &quot;image&quot;,value = &quot;图片路径&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String image;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<img src="https://gitee.com/vanse/images/raw/master/cms/image-20211111153006270.png" alt="image-20211111153006270" style="zoom:50%;" />

<h3 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveOrUpdateUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(user.getId() == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="comment">// user部分数据后台处理</span></span><br><span class="line">			user.setRegisterTime(<span class="keyword">new</span> Date());</span><br><span class="line">			user.setStatus(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">			userDao.save(user);</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">// 选择性更新 可能丢失注册时间</span></span><br><span class="line">			User target = findById(user.getId());</span><br><span class="line">			NotNullNameUtil.getNotNullNames(user, target);</span><br><span class="line">			userDao.save(target);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">---------------------------</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NotNullNameUtil</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 获取对象的值为空的 属性数组</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">getNotNullNames</span><span class="params">(Object source,Object target)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">final</span> BeanWrapper src = <span class="keyword">new</span> BeanWrapperImpl(source);</span><br><span class="line">		java.beans.PropertyDescriptor[] pds = src.getPropertyDescriptors();</span><br><span class="line"></span><br><span class="line">		Set&lt;String&gt; emptyNames = <span class="keyword">new</span> HashSet&lt;String&gt;();</span><br><span class="line">		<span class="keyword">for</span> (java.beans.PropertyDescriptor pd : pds) &#123;</span><br><span class="line">			Object srcValue = src.getPropertyValue(pd.getName());</span><br><span class="line">			<span class="keyword">if</span> (srcValue == <span class="keyword">null</span>)</span><br><span class="line">				emptyNames.add(pd.getName());</span><br><span class="line">		&#125;</span><br><span class="line">        	<span class="comment">// 返回空属性数组</span></span><br><span class="line">		String[] names = emptyNames.toArray(<span class="keyword">new</span> String[emptyNames.size()]);</span><br><span class="line">        	<span class="comment">// 复制对象时忽视属性</span></span><br><span class="line">		BeanUtils.copyProperties(source, target,names);</span><br><span class="line">		<span class="keyword">return</span> target;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>测试</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="comment">//  &quot;birthday&quot;: &quot;1900-01-12&quot;,</span></span><br><span class="line">  <span class="string">&quot;gender&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;id&quot;</span>: <span class="number">3</span>,</span><br><span class="line">   <span class="comment">// &quot;image&quot;: &quot;string&quot;,</span></span><br><span class="line">  <span class="string">&quot;password&quot;</span>: <span class="string">&quot;000&quot;</span>,</span><br><span class="line">  <span class="string">&quot;phone&quot;</span>: <span class="string">&quot;175********&quot;</span>,</span><br><span class="line">  <span class="string">&quot;realName&quot;</span>: <span class="string">&quot;老刘&quot;</span>,</span><br><span class="line">  <span class="string">&quot;status&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">  <span class="string">&quot;username&quot;</span>: <span class="string">&quot;wangsidandan&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="修改新增"><a href="#修改新增" class="headerlink" title="修改新增"></a>修改新增</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveOrUpdateUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(user.getId() == <span class="keyword">null</span>) &#123;</span><br><span class="line">			String username = user.getUsername();</span><br><span class="line">			<span class="comment">// 参数不能为空</span></span><br><span class="line">			<span class="keyword">if</span> (username == <span class="keyword">null</span> || <span class="string">&quot;&quot;</span>.equals(username.trim())) &#123;</span><br><span class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> CustomerException(ResultCode.PARAM_IS_BLANK);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">// 姓名不能重复</span></span><br><span class="line">			User userFromDB = findUserByUsername(username);</span><br><span class="line">			<span class="keyword">if</span> (userFromDB != <span class="keyword">null</span>) &#123;</span><br><span class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> CustomerException(ResultCode.DATA_EXISTED);</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// user部分数据后台处理</span></span><br><span class="line">			user.setRegisterTime(<span class="keyword">new</span> Date());</span><br><span class="line">			user.setStatus(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">			userDao.save(user);</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">// 选择性更新 可能丢失注册时间</span></span><br><span class="line">			User target = findById(user.getId());</span><br><span class="line">			BeanUtils.copyProperties(user, target,ObjectNullNames.getNullPropertyNames(user));</span><br><span class="line">			userDao.save(target);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">-------------------------</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDao</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">User</span>, <span class="title">Integer</span>&gt;</span>&#123;</span><br><span class="line">	<span class="function">User <span class="title">findByUsername</span><span class="params">(String username)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a><code>总结</code></h3><ul>
<li><p>新增</p>
<ul>
<li>校验 自定义异常</li>
<li>部分数据后台处理</li>
</ul>
</li>
<li><p>更新</p>
<ul>
<li>选择性更新</li>
</ul>
</li>
</ul>
<h2 id="分页"><a href="#分页" class="headerlink" title="分页"></a>分页</h2><h3 id="UserServiceImpl-1"><a href="#UserServiceImpl-1" class="headerlink" title="UserServiceImpl"></a>UserServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Page&lt;User&gt; <span class="title">getAll</span><span class="params">(Integer pageNum, Integer pageSize)</span> </span>&#123;</span><br><span class="line">		Pageable pageable = PageRequest.of(pageNum, pageSize);</span><br><span class="line">		<span class="keyword">return</span> userDao.findAll(pageable);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h3 id="UserController-1"><a href="#UserController-1" class="headerlink" title="UserController"></a>UserController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;分页查找用户&quot;,notes = &quot;需要当前也和每页条数&quot;)</span></span><br><span class="line">	<span class="meta">@GetMapping(&quot;&#123;pageNum&#125;/&#123;pageSize&#125;&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Result <span class="title">findByPage</span><span class="params">(	</span></span></span><br><span class="line"><span class="params"><span class="function">		<span class="meta">@ApiParam(name = &quot;pageNum&quot;,value = &quot;当前页&quot;,required = true,defaultValue = &quot;0&quot;)</span>	 <span class="meta">@PathVariable(&quot;pageNum&quot;)</span> Integer pageNum,</span></span></span><br><span class="line"><span class="params"><span class="function">		<span class="meta">@ApiParam(name = &quot;pageSize&quot;,value = &quot;每页条数&quot;,required = true,defaultValue = &quot;5&quot;)</span>  <span class="meta">@PathVariable(&quot;pageSize&quot;)</span> Integer pageSize)</span> </span>&#123;</span><br><span class="line">		Page&lt;User&gt; page = userService.getAll(pageNum, pageSize);</span><br><span class="line">		<span class="keyword">long</span> total = page.getTotalElements(); <span class="comment">// 获取总条数</span></span><br><span class="line">		List&lt;User&gt; content = page.getContent();</span><br><span class="line">		Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">		map.put(<span class="string">&quot;total&quot;</span>, total);</span><br><span class="line">		map.put(<span class="string">&quot;content&quot;</span>, content);</span><br><span class="line">		<span class="keyword">return</span> Result.success(map);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;code&quot;</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">&quot;msg&quot;</span>: <span class="string">&quot;操作成功&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;data&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;total&quot;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">&quot;content&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">&quot;username&quot;</span>: <span class="string">&quot;vanse&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;password&quot;</span>: <span class="string">&quot;000&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;phone&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;realName&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;gender&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;birthday&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;registerTime&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;status&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;image&quot;</span>: <span class="literal">null</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="更新状态"><a href="#更新状态" class="headerlink" title="更新状态"></a>更新状态</h2><h3 id="UserServiceImpl-2"><a href="#UserServiceImpl-2" class="headerlink" title="UserServiceImpl"></a>UserServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 更新状态</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateUserStatus</span><span class="params">(Integer id, String status)</span> </span>&#123;</span><br><span class="line">        	<span class="comment">// 此处无须额外处理  该方法已经有异常处理</span></span><br><span class="line">		User user = findById(id);</span><br><span class="line">		user.setStatus(status);</span><br><span class="line">		userDao.save(user);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h3 id="UserController-2"><a href="#UserController-2" class="headerlink" title="UserController"></a>UserController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;改变用户状态&quot;,notes = &quot;需要用户id和用户状态参数&quot;)</span></span><br><span class="line">	<span class="meta">@PutMapping(&quot;&#123;id&#125;/&#123;status&#125;&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Result <span class="title">saveOrUpdateUser</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">		<span class="meta">@ApiParam(name = &quot;id&quot;,value = &quot;用户id&quot;,required = true)</span>	<span class="meta">@PathVariable(&quot;id&quot;)</span>Integer id,</span></span></span><br><span class="line"><span class="params"><span class="function">		<span class="meta">@ApiParam(name = &quot;status&quot;,value = &quot;用户状态&quot;,required = true)</span> <span class="meta">@PathVariable(&quot;status&quot;)</span>String status)</span> </span>&#123;</span><br><span class="line">		userService.updateUserStatus(id, status);</span><br><span class="line">		<span class="keyword">return</span> Result.success();</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>



<h2 id="批量删除"><a href="#批量删除" class="headerlink" title="批量删除"></a>批量删除</h2><h3 id="UserServiceImpl-3"><a href="#UserServiceImpl-3" class="headerlink" title="UserServiceImpl"></a>UserServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 批量删除</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteUserInBatch</span><span class="params">(List&lt;Integer&gt; ids)</span> </span>&#123;</span><br><span class="line">		List&lt;User&gt; userList =  userDao.findAllById(ids);</span><br><span class="line">		<span class="keyword">if</span>(userList == <span class="keyword">null</span> || userList.size() == <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> CustomerException(ResultCode.DATA_NONE);</span><br><span class="line">		&#125;</span><br><span class="line">		userDao.deleteInBatch(userList);	</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>



<h3 id="UserController-3"><a href="#UserController-3" class="headerlink" title="UserController"></a>UserController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 批量删除</span></span><br><span class="line">	<span class="meta">@ApiOperation(value = &quot;批量删除&quot;,notes = &quot;需要传递多个id&quot;)</span></span><br><span class="line">	<span class="meta">@ApiImplicitParams(&#123;</span></span><br><span class="line"><span class="meta">		@ApiImplicitParam(name = &quot;ids&quot;,value = &quot;多个id&quot;,paramType = &quot;query&quot;,dataType = &quot;Integer&quot;,allowMultiple = true)</span></span><br><span class="line"><span class="meta">		&#125;)</span></span><br><span class="line">	<span class="meta">@DeleteMapping(&quot;/deleteBatch&quot;)</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * 	@RequestParam(&quot;ids&quot;)</span></span><br><span class="line"><span class="comment">		@ApiParam(name = &quot;ids&quot;,value = &quot;批量id&quot;,required = true)</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Result <span class="title">deleteBatch</span><span class="params">(<span class="meta">@RequestParam(&quot;ids&quot;)</span> List&lt;Integer&gt; ids)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// @ApiParam 默认是json格式</span></span><br><span class="line">		userService.deleteUserInBatch(ids);</span><br><span class="line">		<span class="keyword">return</span> Result.success();</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>



<h2 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h2><h3 id="UserServiceImpl-4"><a href="#UserServiceImpl-4" class="headerlink" title="UserServiceImpl"></a>UserServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> User <span class="title">login</span><span class="params">(String username, String password)</span> </span>&#123;</span><br><span class="line">		User user = findUserByUsername(username);</span><br><span class="line">		<span class="keyword">if</span>(user == <span class="keyword">null</span> || !password.equals(user.getPassword())) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> CustomerException(ResultCode.USER_LOGIN_ERROR);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> user;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h3 id="UserController-4"><a href="#UserController-4" class="headerlink" title="UserController"></a>UserController</h3><p>此处将参数拼接在地址栏</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 登录</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;登录&quot;,notes = &quot;用户名和密码&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Result <span class="title">loign</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">		<span class="meta">@RequestParam(&quot;username&quot;)</span></span></span></span><br><span class="line"><span class="params"><span class="function">		<span class="meta">@ApiParam(name = &quot;username&quot;,value = &quot;用户名&quot;,required = true)</span>String username,</span></span></span><br><span class="line"><span class="params"><span class="function">		<span class="meta">@RequestParam(&quot;password&quot;)</span></span></span></span><br><span class="line"><span class="params"><span class="function">		<span class="meta">@ApiParam(name = &quot;password&quot;,value = &quot;密码&quot;,required = true)</span>String password)</span> </span>&#123;</span><br><span class="line">	User user = userService.login(username, password);</span><br><span class="line">	<span class="keyword">return</span> Result.success(<span class="string">&quot;登录成功&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 登录</span></span><br><span class="line">	<span class="meta">@ApiOperation(value = &quot;登录&quot;,notes = &quot;用户名和密码&quot;)</span></span><br><span class="line">	<span class="meta">@ApiImplicitParams(&#123;</span></span><br><span class="line"><span class="meta">			@ApiImplicitParam(name = &quot;username&quot;,value = &quot;用户名&quot;,paramType = &quot;form&quot;,dataType = &quot;string&quot;,defaultValue = &quot;wangsidandan&quot; ),</span></span><br><span class="line"><span class="meta">			@ApiImplicitParam(name = &quot;password&quot;,value = &quot;密码&quot;,paramType = &quot;form&quot;,dataType = &quot;string&quot;,defaultValue = &quot;000&quot; )&#125;)</span></span><br><span class="line">	<span class="meta">@PostMapping(value = &quot;/login&quot;,consumes = &quot;application/x-www-form-urlencoded&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Result <span class="title">loign</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">			String username,String password)</span> </span>&#123;</span><br><span class="line">		User user = userService.login(username, password);</span><br><span class="line">		<span class="keyword">return</span> Result.success(<span class="string">&quot;登录成功&quot;</span>);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>其中：<br><code>@Api</code> ，用来指定当前API模块的名称<br><code>@ApiOperation </code>，用来设置API方法的简介说明<br><code>@ApiImplicitParams</code> ，用来设置API方法的参数，可以有多个参数<br><code>@ApiImplicitParam </code>，用来设置一个参数的详细信息</p>
<ul>
<li>name，参数的名称</li>
<li>value，参数的介绍</li>
<li>dataType，参数的数据类型，例如String</li>
<li>required，是否为必须参数</li>
<li>defaultValue，默认填入输入框的值</li>
<li>paramType，参数的类型：<ul>
<li>path    /user/{id} </li>
<li>query /user?id=</li>
<li>body 正文</li>
<li>header 请求头</li>
<li>form 请求表单</li>
</ul>
</li>
</ul>
<h1 id="jwt"><a href="#jwt" class="headerlink" title="jwt"></a>jwt</h1><h2 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h2><p>传统的Web应用中，使用session来存在用户的信息，每次用户认证通过以后，服务器需要创建一条记录<br>保存用户信息，通常是在内存中。</p>
<ul>
<li>随着认证通过的用户越来越多，服务器的在这里的开销就会越来越大,</li>
<li>由于Session是在内存中的，这就带来一些扩展性的问题<ul>
<li>servlet依赖于web容器    </li>
</ul>
</li>
</ul>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20210318005044861.png" alt="image-20210318005044861"></p>
<blockquote>
<p>JSON Web Token (JWT,token的一种)，是一个开放标准(RFC 7519)，它定义了一种紧凑的、自包含的方式，用于作为JSON对象在各方之间安全地传输信息。该信息可以被验证和信任，因为它是数字签名的。</p>
</blockquote>
<ul>
<li>JWT存放在客户端（前端），每次请求的请求头中，携带此JWT发送给服务器，服务器端负责接收<br>和验证</li>
<li>服务器端可以不用存储JWT，这样可以降低服务器的内存的开销</li>
<li>JWT和语言无关，扩展起来非常方便，无论是PC端还是移动端，都可以很容易的使用</li>
<li>不受cookie的限制</li>
</ul>
<p>如图：</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20210318005232445.png" alt="image-20210318005232445"></p>
<blockquote>
<p>注意，session和JWT的主要区别就是保存的位置，session是保存在服务端的，而JWT是保存在客户<br>端的</p>
</blockquote>
<blockquote>
<p>注意，JWT就是一个固定格式的字符串</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://jwt.io/">JWT官网</a></p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20210318005358285.png" alt="image-20210318005358285"></p>
<h2 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h2><p>JWT固定各种的字符串，由三部分组成：</p>
<ul>
<li>Header，头部</li>
<li>Payload，载荷</li>
<li>Signature，签名</li>
</ul>
<blockquote>
<p>注意，把这三部分使用点（.）连接起来，就是一个JWT字符串</p>
</blockquote>
<p>如图：</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20210319084618060.png" alt="image-20210319084618060"></p>
<h3 id="头部"><a href="#头部" class="headerlink" title="头部"></a>头部</h3><blockquote>
<p>header一般的由两部分组成：token的类型（“JWT”）和算法名称（比如：HMAC SHA256或者RSA等等）。</p>
</blockquote>
<p>JWT里验证和签名使用的算法列表如下：</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20210319084933149.png" alt="image-20210319084933149"></p>
<p>例如，</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;alg&quot;</span>: <span class="string">&quot;HS256&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;typ&quot;</span>: <span class="string">&quot;JWT&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="载荷"><a href="#载荷" class="headerlink" title="载荷"></a>载荷</h3><blockquote>
<p>payload主要用来包含声明（claims ），这个声明一般是关于实体(通常是用户)和其他数据的声明。</p>
</blockquote>
<p>声明有三种类型:</p>
<ul>
<li>registered</li>
<li>public</li>
<li>private</li>
</ul>
<p>具体如下：</p>
<p>Registered claims : 这里有一组预定义的声明，它们不是强制的，但是推荐。</p>
<ul>
<li>iss: jwt签发者</li>
<li>sub: jwt所面向的用户</li>
<li>aud: 接收jwt的一方</li>
<li>exp: jwt的过期时间，这个过期时间必须要大于签发时间 </li>
<li>nbf: 定义在什么时间之前，该jwt都是不可用的</li>
<li>iat: jwt的签发时间</li>
<li>jti: jwt的唯一身份标识，主要用来作为一次性token，从而回避重放攻击</li>
</ul>
<p>Public claims : 可以随意定义</p>
<ul>
<li>自定义数据:存放在token中存放的key-value值</li>
</ul>
<p>Private claims : 用于在同意使用它们的各方之间共享信息，并且不是注册的或公开的声明</p>
<p>例如，</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;iss&quot;</span>: <span class="string">&quot;briup&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;iat&quot;</span>: <span class="number">1446593502</span>,</span><br><span class="line">    <span class="attr">&quot;exp&quot;</span>: <span class="number">1446594722</span>,</span><br><span class="line">    <span class="attr">&quot;aud&quot;</span>: <span class="string">&quot;www.briup.com&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;sub&quot;</span>: <span class="string">&quot;briup@briup.com&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;username&quot;</span>: <span class="string">&quot;tom&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，不要在JWT的payload或header中放置敏感信息，除非它们是加密的</p>
</blockquote>
<p>把头部和载荷分别进行Base64编码之后得到两个字符串，然后再将这两个编码后的字符串用英文句号.<br>连接在一起（头部在前），形成新的字符串：</p>
<p><code>eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJhdWQiOiI2MmI2OWNlZC02YWNlLTRmYzAtOTk5MS00YWUwMjIxODQ0OTciLCJleHAiOjE2MDYwNTQzNjl9</code></p>
<p>###签名</p>
<p>最后，将上面拼接完的字符串用HS256算法进行加密，在加密的时候，还需要提供一个密钥（secret）。加密后的内容也是一个字符串，这个字符串就是签名。</p>
<p>把这个签名拼接在刚才的字符串后面就能得到完整的JWT字符串。<br>header部分和payload部分如果被篡改，由于篡改者不知道密钥是什么，也无法生成新的signature部分，<br>服务端也就无法通过。</p>
<blockquote>
<p>在JWT中，消息体是透明的，使用签名可以保证消息不被篡改。</p>
</blockquote>
<blockquote>
<p>确保密钥不会泄露,否则会被篡改</p>
</blockquote>
<p>例如，使用HMACSHA256加密算法，配合秘钥，将前俩部进行加密，生成签名</p>
<p><code>HMACSHA256(base64UrlEncode(header) + &quot;.&quot; + base64UrlEncode(payload), secret)</code></p>
<p>例如，将Header、Payload、Signature三部分使用点（.）连接起来</p>
<p><code>eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJhdWQiOiI2MmI2OWNlZC02YWNlLTRmYzAtOTk5MS00Y WUwMjIxODQ0OTciLCJleHAiOjE2MDYwNTQzNjl9.DNVhr36j66JpQBfcYoo64IRp84dKiQeaq7axHTBcP9 E</code></p>
<p>例如，使用官网提供的工具，可以对该JWT进行验证和解析</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20210319085334765.png" alt="image-20210319085334765"></p>
<blockquote>
<p>注意，在代码中，我们使用JWT封装的工具类，也可以完成此操作</p>
</blockquote>
<h2 id="整合-1"><a href="#整合-1" class="headerlink" title="整合"></a>整合</h2><h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.auth0<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>java-jwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.11.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="工具类"><a href="#工具类" class="headerlink" title="工具类"></a>工具类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JwtUtil</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 过期时间5分钟</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> EXPIRE_TIME = <span class="number">5</span> * <span class="number">60</span> * <span class="number">1000</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * jwt 密钥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SECRET = <span class="string">&quot;jwt_secret&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成签名，五分钟后过期</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> info，Map的value只能存放的值的类型为：Map, List, Boolean, Integer, Long, Double, String and Date</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">sign</span><span class="params">(String userId,Map&lt;String,Object&gt; info)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Date date = <span class="keyword">new</span> Date(System.currentTimeMillis() + EXPIRE_TIME);</span><br><span class="line">            Algorithm algorithm = Algorithm.HMAC256(SECRET);</span><br><span class="line">            <span class="keyword">return</span> JWT.create()</span><br><span class="line">                    <span class="comment">// 将 user id 保存到 token 里面</span></span><br><span class="line">                    .withAudience(userId)</span><br><span class="line">                    <span class="comment">// 存放自定义数据</span></span><br><span class="line">                    .withClaim(<span class="string">&quot;info&quot;</span>, info)</span><br><span class="line">                    <span class="comment">// 五分钟后token过期</span></span><br><span class="line">                    .withExpiresAt(date)</span><br><span class="line">                    <span class="comment">// token 的密钥</span></span><br><span class="line">                    .sign(algorithm);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        	e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据token获取userId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> token</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getUserId</span><span class="params">(String token)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String userId = JWT.decode(token).getAudience().get(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">return</span> userId;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JWTDecodeException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据token获取自定义数据info</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> token</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String,Object&gt; <span class="title">getInfo</span><span class="params">(String token)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> JWT.decode(token).getClaim(<span class="string">&quot;info&quot;</span>).asMap();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JWTDecodeException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 校验token</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> token</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">checkSign</span><span class="params">(String token)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Algorithm algorithm = Algorithm.HMAC256(SECRET);</span><br><span class="line">            JWTVerifier verifier = JWT.require(algorithm)</span><br><span class="line">                    <span class="comment">// .withClaim(&quot;username&quot;, username)</span></span><br><span class="line">                    .build();</span><br><span class="line">            verifier.verify(token);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JWTVerificationException exception) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;token 无效，请重新获取&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="拦截器"><a href="#拦截器" class="headerlink" title="拦截器"></a>拦截器</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 拦截认证资源</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JwtInteceptors</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="comment">// 判断是不是认证资源(根据拦截器配置 auth/**) 不是的话直接放行</span></span><br><span class="line">		<span class="comment">//System.out.println(handler); //class org.springframework.web.method.HandlerMethod</span></span><br><span class="line">		<span class="keyword">if</span>(!(handler <span class="keyword">instanceof</span> HandlerMethod))&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 从请求头中获取token</span></span><br><span class="line">		String token = request.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">		<span class="comment">// 判断token是否为空 空直接抛异常 </span></span><br><span class="line">		<span class="keyword">if</span>(token == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;无token,请登录&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 校验token</span></span><br><span class="line">		JwtUtil.checkSign(token);</span><br><span class="line">		<span class="comment">// 取出token中的信息</span></span><br><span class="line">		String userId = JwtUtil.getUserId(token);</span><br><span class="line">		System.out.println(userId);</span><br><span class="line">		Map&lt;String, Object&gt; info = JwtUtil.getInfo(token);</span><br><span class="line">		info.forEach((k,v)-&gt;&#123;</span><br><span class="line">			System.out.println(k+<span class="string">&quot;=&quot;</span>+v);</span><br><span class="line">		&#125;);</span><br><span class="line">		<span class="comment">// 放行</span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="mvc配置"><a href="#mvc配置" class="headerlink" title="mvc配置"></a>mvc配置</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MvcConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">		registry.addInterceptor(<span class="keyword">new</span> JwtInteceptors())</span><br><span class="line">		.addPathPatterns(<span class="string">&quot;/auth/**&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="资源"><a href="#资源" class="headerlink" title="资源"></a>资源</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/auth&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;测试模块&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthController</span> </span>&#123;</span><br><span class="line">	<span class="meta">@GetMapping(&quot;/hello&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="测试-2"><a href="#测试-2" class="headerlink" title="测试"></a>测试</h3><p><strong>直接访问</strong></p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20211112093343903.png" alt="image-20211112093343903"></p>
<p><strong>获取token</strong></p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20211112093718429.png" alt="image-20211112093718429"></p>
<p><strong>携带请求头</strong></p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20211112093811250.png" alt="image-20211112093811250"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line">gender=0</span><br><span class="line">username=wangsidandan</span><br></pre></td></tr></table></figure>



<p><strong>修改token，故意写错后，再访问测试</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;code&quot;</span>:<span class="number">500</span>,<span class="attr">&quot;msg&quot;</span>:<span class="string">&quot;服务器异常: token 无效，请重新获取&quot;</span>,<span class="attr">&quot;data&quot;</span>:<span class="literal">null</span>&#125;</span><br></pre></td></tr></table></figure>

<p><strong>获取新的token测试通过后，等待5分钟后，再次访问</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;code&quot;</span>:<span class="number">500</span>,<span class="attr">&quot;msg&quot;</span>:<span class="string">&quot;服务器异常: token 无效，请重新获取&quot;</span>,<span class="attr">&quot;data&quot;</span>:<span class="literal">null</span>&#125;</span><br></pre></td></tr></table></figure>



<h3 id="swagger-1"><a href="#swagger-1" class="headerlink" title="swagger"></a>swagger</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/auth&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;测试模块&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthController</span> </span>&#123;</span><br><span class="line">	<span class="meta">@ApiOperation(value = &quot;测试&quot;,notes = &quot;token放请求头&quot;)</span></span><br><span class="line">	<span class="meta">@ApiImplicitParams(&#123;</span></span><br><span class="line"><span class="meta">		@ApiImplicitParam(name = &quot;token&quot;,value = &quot;token值&quot;,dataType = &quot;string&quot;,paramType = &quot;header&quot;,required = true)</span></span><br><span class="line"><span class="meta">	&#125;)</span></span><br><span class="line">	<span class="meta">@GetMapping(&quot;/hello&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>问题</code></p>
<p>每个需要拦截的资源都要手动配置token</p>
<h2 id="全局配置"><a href="#全局配置" class="headerlink" title="全局配置"></a>全局配置</h2><h3 id="1-概述"><a href="#1-概述" class="headerlink" title="1.概述"></a>1.概述</h3><blockquote>
<p>很多请求中，会携带token到服务器端进行认证，token有效时才可以进行本次访问，调用相应的接口</p>
</blockquote>
<p>使用swagger进行接口测试后，可以给swagger中测试的接口，添加全局的参数，让每一个接口都含义指定的参数，这样就不需要每一个接上添加swagger的注解了。</p>
<h3 id="2-使用"><a href="#2-使用" class="headerlink" title="2.使用"></a>2.使用</h3><h4 id="方式1"><a href="#方式1" class="headerlink" title="方式1"></a><strong>方式1</strong></h4><p>第一种设置全局变量的方式：</p>
<blockquote>
<p>注意，复制之前springboot-swagger项目，再添加少量修改即可</p>
</blockquote>
<p>修改配置类SwaggerConfig2.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.cms.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.ApiInfoBuilder;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.ParameterBuilder;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.PathSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.RequestHandlerSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.schema.ModelRef;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.ApiInfo;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.Contact;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.Parameter;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spi.DocumentationType;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spring.web.plugins.Docket;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.swagger2.annotations.EnableSwagger2;</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Swagger2Config</span> </span>&#123;</span><br><span class="line">	<span class="comment">// ApiSelectorBuilder select() api选择器</span></span><br><span class="line">	<span class="comment">// 指定处理器 任何路径</span></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Docket <span class="title">createDocket</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">//配置全局参数</span></span><br><span class="line">				ParameterBuilder tokenPar = <span class="keyword">new</span> ParameterBuilder();  </span><br><span class="line">				Parameter param = tokenPar.name(<span class="string">&quot;token&quot;</span>)</span><br><span class="line">							        	  .description(<span class="string">&quot;JWT令牌&quot;</span>)</span><br><span class="line">							        	  .modelRef(<span class="keyword">new</span> ModelRef(<span class="string">&quot;string&quot;</span>))</span><br><span class="line">							        	  .parameterType(<span class="string">&quot;header&quot;</span>)</span><br><span class="line">							        	  .required(<span class="keyword">false</span>)</span><br><span class="line">							        	  .build();  </span><br><span class="line">		        </span><br><span class="line">		        List&lt;Parameter&gt; pars = <span class="keyword">new</span> ArrayList&lt;Parameter&gt;();  </span><br><span class="line">		        pars.add(param);  </span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2)</span><br><span class="line">				.apiInfo(apiInfo())</span><br><span class="line">				.select()</span><br><span class="line">				.apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.briup.cms.controller&quot;</span>))</span><br><span class="line">				.paths(PathSelectors.any())</span><br><span class="line">				.build()</span><br><span class="line">				.globalOperationParameters(pars)</span><br><span class="line">				.ignoredParameterTypes(HttpServletRequest.class,HttpServletResponse.class);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// swagger页面中显示的基本信息</span></span><br><span class="line">	<span class="comment">//@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> ApiInfo <span class="title">apiInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> ApiInfoBuilder()</span><br><span class="line">				.title(<span class="string">&quot;cms&quot;</span>)</span><br><span class="line">				.description(<span class="string">&quot;新闻发布系统&quot;</span>)</span><br><span class="line">				.version(<span class="string">&quot;1.0&quot;</span>)</span><br><span class="line">				.contact(<span class="keyword">new</span> Contact(<span class="string">&quot;vanse&quot;</span>, <span class="string">&quot;http://wangsidandan.github.io&quot;</span>, <span class="string">&quot;wangsidandan@gmail.com&quot;</span>))</span><br><span class="line">				.build();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20210321163623737.png" alt="image-20210321163623737"></p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20210321163643126.png" alt="image-20210321163643126"></p>
<blockquote>
<p>注意，此时在swagger中显示的接口，都自动添加了这个全局参数token，并且请求时也携带了指定的token值</p>
</blockquote>
<p><code>问题</code></p>
<p>不需要认证的接口也添加了token</p>
<p>####方式2</p>
<p>第二种设置全局变量的方式：</p>
<blockquote>
<p>注意，复制之前springboot-swagger项目，再添加少量修改即可</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.cms.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.common.base.Predicate;</span><br><span class="line"><span class="keyword">import</span> com.google.common.base.Predicates;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.ApiInfoBuilder;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.PathSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.RequestHandlerSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.ApiInfo;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.ApiKey;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.AuthorizationScope;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.Contact;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.SecurityReference;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spi.DocumentationType;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spi.service.contexts.SecurityContext;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spring.web.plugins.Docket;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.swagger2.annotations.EnableSwagger2;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Swagger2Config</span> </span>&#123;</span><br><span class="line">	<span class="comment">// ApiSelectorBuilder select() api选择器</span></span><br><span class="line">	<span class="comment">// 指定处理器 任何路径</span></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Docket <span class="title">createDocket</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2).apiInfo(apiInfo()).select()</span><br><span class="line">				.apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.briup.cms.controller&quot;</span>)).paths(PathSelectors.any())</span><br><span class="line">				.build().securitySchemes(security()).securityContexts(securityContexts())</span><br><span class="line">				.ignoredParameterTypes(HttpServletRequest.class, HttpServletResponse.class);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// swagger页面中显示的基本信息</span></span><br><span class="line">	<span class="comment">// @Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> ApiInfo <span class="title">apiInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> ApiInfoBuilder().title(<span class="string">&quot;cms&quot;</span>).description(<span class="string">&quot;新闻发布系统&quot;</span>).version(<span class="string">&quot;1.0&quot;</span>)</span><br><span class="line">				.contact(<span class="keyword">new</span> Contact(<span class="string">&quot;vanse&quot;</span>, <span class="string">&quot;http://wangsidandan.github.io&quot;</span>, <span class="string">&quot;wangsidandan@gmail.com&quot;</span>)).build();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 设置认证中显示的显示的基本信息</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> List&lt;ApiKey&gt; <span class="title">security</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> Collections.singletonList(<span class="keyword">new</span> ApiKey(<span class="string">&quot;Authorization&quot;</span>, <span class="string">&quot;token&quot;</span>, <span class="string">&quot;header&quot;</span>));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 设置认证规则</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> List&lt;SecurityContext&gt; <span class="title">securityContexts</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		List&lt;String&gt; antPaths = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">		antPaths.add(<span class="string">&quot;/auth/**&quot;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> Collections.singletonList(SecurityContext.builder().securityReferences(defaultAuth())</span><br><span class="line">				.forPaths(antPathsCondition(antPaths)).build());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 返回认证路径的条件</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> Predicate&lt;String&gt; <span class="title">antPathsCondition</span><span class="params">(List&lt;String&gt; antPaths)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		List&lt;Predicate&lt;String&gt;&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">		antPaths.forEach(path -&gt; list.add(PathSelectors.ant(path)));</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> Predicates.or(list);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 设置认证的范围，以及认证的类型</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> List&lt;SecurityReference&gt; <span class="title">defaultAuth</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		AuthorizationScope authorizationScope = <span class="keyword">new</span> AuthorizationScope(<span class="string">&quot;global&quot;</span>, <span class="string">&quot;accessEverything&quot;</span>);</span><br><span class="line">		AuthorizationScope[] authorizationScopes = <span class="keyword">new</span> AuthorizationScope[<span class="number">1</span>];</span><br><span class="line">		authorizationScopes[<span class="number">0</span>] = authorizationScope;</span><br><span class="line">		<span class="keyword">return</span> Collections.singletonList(<span class="keyword">new</span> SecurityReference(<span class="string">&quot;Authorization&quot;</span>, authorizationScopes));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这里比之前新增的代码如下：</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20210321171405316.png" alt="image-20210321171405316"></p>
<blockquote>
<p>注意，新增代码如图所示，以及下面新增的几个方法</p>
</blockquote>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20210321171428922.png" alt="image-20210321171428922"></p>
<blockquote>
<p>注意，这里会显示一个“锁”的图标，表示这里有些接口是需要认证的</p>
</blockquote>
<p>展开模块后，访问路径符合要求接口，也会显示“锁”的图标</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20210321171450952.png" alt="image-20210321171450952"></p>
<p>点击锁的图标，添加请求头中的统一认证信息（token）：</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20210321171509563.png" alt="image-20210321171509563"></p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20210321171519876.png" alt="image-20210321171519876"></p>
<p>点击认证按钮后，进行访问测试：</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20210321171537958.png" alt="image-20210321171537958"></p>
<p>注意，这时候，有“锁”图标的接口，在访问的时候，都会携带刚刚设置的请求头中的认证信息token值</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20210321171609118.png" alt="image-20210321171609118"></p>
<p>注意，这时候，无“锁”图标的接口，在访问的时候，默认是不会携带设置的请求头信息的</p>
<h1 id="cors"><a href="#cors" class="headerlink" title="cors"></a>cors</h1><h2 id="1-概述-1"><a href="#1-概述-1" class="headerlink" title="1.概述"></a>1.概述</h2><p>跨域访问，是指从一个域名的网页去请求另一个域名的资源。比如从<a target="_blank" rel="noopener" href="http://www.baidu.com/">www.baidu.com</a> 页面去请求 <a target="_blank" rel="noopener" href="http://www.google.com/">www.google.com</a> 的资源。但是一般情况下不能这么做跨域访问，因为有浏览器的“<strong>同源策略</strong>”存在，这是浏览器对JavaScript施加的安全限制。</p>
<blockquote>
<p>跨域，指的是浏览器不能执行其他网站的脚本。它是由浏览器的同源策略造成的，是浏览器对JavaScript施加的安全限制。</p>
</blockquote>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20210321224558036.png" alt="image-20210321224558036"></p>
<p><strong>“同源策略”</strong>简单的说，就是A网站页面访问B网站的资源受限（跨域访问），除非A和B是“同源”。<br><strong>“同源”</strong>是指三个相同，协议相同、域名相同、端口相同，只有有任何一个地方不同，就认为是跨域。</p>
<p>例如，<br>网页A的地址为， <a target="_blank" rel="noopener" href="http://www.example.com/dir/page.html">http://www.example.com/dir/page.html</a><br>假设，网页A要访问的网页B地址为：</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://www.example.com/dir2/other.html">http://www.example.com/dir2/other.html</a> ： 同源（正常访问）</li>
<li><a target="_blank" rel="noopener" href="https://www.example.com/dir/other.html">https://www.example.com/dir/other.html</a> ：不同源（协议不同，跨域）</li>
<li><a target="_blank" rel="noopener" href="http://vip.www.example.com/dir/other.html">http://vip.www.example.com/dir/other.html</a> ：不同源（域名不同，跨域）</li>
<li><a target="_blank" rel="noopener" href="http://www.example.com:81/dir/other.html">http://www.example.com:81/dir/other.html</a> ：不同源（端口不同，跨域）</li>
</ul>
<p>随着互联网的发展，“同源政策”越来越严格，目前，如果非同源（跨域），共有三种行为受到限制：</p>
<ul>
<li>Cookie 、LocalStorage、IndexDB 无法访问</li>
<li>DOM 无法获取</li>
<li>AJAX请求不能发送</li>
</ul>
<p>浏览器的用“同源策略”来限制跨域访问的目的是为了安全，例如，假设没有跨域访问的限制</p>
<ul>
<li><p>用户访问<a target="_blank" rel="noopener" href="http://www.mybank.com/">www.mybank.com</a> ，登陆并进行网银操作，这时cookie、token等数据信息存放在浏览器中</p>
</li>
<li><p>用户访问<a target="_blank" rel="noopener" href="http://www.abc.com/">www.abc.com</a></p>
</li>
<li><p>这时<a target="_blank" rel="noopener" href="http://www.abc.com/">www.abc.com</a> 网站就可以在拿到银行的cookie或token等，然后发起对<a target="_blank" rel="noopener" href="http://www.mybank.com/">www.mybank.com</a> 的操作</p>
</li>
</ul>
<p>我们在项目中，需要设置对跨域访问的支持，是因为项目的架构需要，例如</p>
<ul>
<li>公司内部有多个不同的子系统，例如A和B，分别部署在不同的服务器上，其域名也不相同</li>
<li>由于公司内部的数据需要，现在A系统中，跨域访问B系统，从而获取内部的一些信息资源</li>
</ul>
<blockquote>
<p>注意，在前后端分离的项目中，前端页面部署在一个服务器上，后端项目部署在另一个服务器上，从前端页面上发送ajax请求到后端系统中，这种情况，就属于跨域访问</p>
</blockquote>
<h2 id="2-案例"><a href="#2-案例" class="headerlink" title="2.案例"></a>2.案例</h2><p>1、新建项目，springboot-html</p>
<img src="https://gitee.com/vanse/images/raw/master/cms/image-20210321230538847.png" alt="image-20210321230538847" style="zoom:50%;" />



<p>2、页面代码：ajax.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>test<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;script src=&quot;https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js&quot;&gt;&lt;/script&gt;--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--不需要写static--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/jquery.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">        $(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;.btn1&quot;</span>).on(<span class="string">&quot;click&quot;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="attr">type</span>: <span class="string">&quot;GET&quot;</span>,</span></span><br><span class="line"><span class="javascript">                    <span class="attr">url</span> : <span class="string">&quot;http://localhost:8989/hi&quot;</span>,</span></span><br><span class="line"><span class="javascript">                    <span class="attr">success</span>: <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                        <span class="built_in">console</span>.log(msg);</span></span><br><span class="line"><span class="javascript">                    &#125;,</span></span><br><span class="line"><span class="javascript">                    <span class="attr">error</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                        alert(<span class="string">&#x27;error&#x27;</span>);</span></span><br><span class="line"><span class="javascript">                    &#125;</span></span><br><span class="line"><span class="javascript">                &#125;);</span></span><br><span class="line"><span class="javascript">            &#125;);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        &#125;);</span></span><br><span class="line"><span class="javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn1&quot;</span>&gt;</span>test1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>3、pom文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>4、配置文件application.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">9999</span></span><br></pre></td></tr></table></figure>

<p>5、Controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.cms.web.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@GetMapping(&quot;/ajax&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;ajax&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>6、运行访问</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20210321231102544.png" alt="image-20210321231102544"></p>
<p><strong>再构建提供接口访问的后端项目</strong></p>
<p>1、新建项目，springboot-cors</p>
<img src="https://gitee.com/vanse/images/raw/master/cms/image-20210321231146093.png" alt="image-20210321231146093" style="zoom:67%;" />

<p>2、pom文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>3、配置文件，application.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">8989</span></span><br></pre></td></tr></table></figure>

<p>4、Controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.cms.web.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@GetMapping(&quot;/hi&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>5、启动，访问</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20210321231321782.png" alt="image-20210321231321782"></p>
<p>最后，访问springboot-html项目中的ajax.html页面，点击页面中的按钮，发送ajax请求，访问springbootcors<br>项目中的接口：</p>
<p>当前页面的访问地址： <a target="_blank" rel="noopener" href="http://localhost:9999/ajax">http://localhost:9999/ajax</a><br>点击按钮后请求地址： <a target="_blank" rel="noopener" href="http://localhost:8989/hi">http://localhost:8989/hi</a><br>可以看出，此时这俩个地址，属于“非同源”，本次访问属于跨域访问。</p>
<p>点击后，控制台上输出的错误信息：<br>已拦截跨源请求：同源策略禁止读取位于 <a target="_blank" rel="noopener" href="http://localhost:8989/hi">http://localhost:8989/hi</a> 的远程资源。<br>（原因：CORS 头缺少 ‘Access-Control-Allow-Origin’）。</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20210321232022681.png" alt="image-20210321232022681"></p>
<p>点开网络模块，查看具体的请求信息：<br>请求头中，自动添加了信息 Origin: <a target="_blank" rel="noopener" href="http://localhost:9999/">http://localhost:9999</a> ，通知服务器本次是跨域访问</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20210321232136576.png" alt="image-20210321232136576"></p>
<p>从本次响应的内容中，可以看到，其实响应的内容已经成功返回了，但是由于浏览器的同源政策，把这些结果都给舍弃了。并且执行了Ajax中的回调函数error</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20210321232221184.png" alt="image-20210321232221184"></p>
<h2 id="3-解决"><a href="#3-解决" class="headerlink" title="3.解决"></a>3.解决</h2><p>避开同源政策给跨域访问带来的限制，方式有很多：</p>
<ol>
<li>nginx</li>
<li>CORS</li>
<li>JSONP</li>
<li>WebSocket</li>
<li>Node.js</li>
<li>document.domain+iframe</li>
<li>other</li>
</ol>
<p>这里主要说下nginx反向代理和CORS跨域资源共享，这俩种跨域解决方案</p>
<h3 id="3-1-nginx"><a href="#3-1-nginx" class="headerlink" title="3.1 nginx"></a>3.1 nginx</h3><p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20210322064446018.png" alt="image-20210322064446018"></p>
<p>Nginx是一款开源的、高性能的HTTP和反向代理服务器</p>
<ul>
<li>也是一个IMAP/POP3/SMTP代理服务器</li>
<li>由C语言编写，其系统开销、CPU使用效率都很优秀</li>
<li>性能稳定、功能丰富、配置简洁</li>
<li>服务器中没有web容器</li>
</ul>
<p>正向代理，一般需要自己手动进行配置：(<strong>已知代理服务器</strong>)<br>代理服务器和客户端在同一个网络中。</p>
<p>例如，我们访问不了某个网站B，但是能访问某个代理服务器P，这个代理服务器P却可以访问到网络B，<br>那么我就先自己手动配置连上代理服务器P，然后让代理服务器P帮我访问网站B，并把结果返回。</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20211005101017166.png" alt="image-20211005101017166"></p>
<p>反向代理，一般是指以代理服务器来接收网络上的请求，然后将请求再转发给内部网络上的其他服务<br>器：<br>代理服务器和Web服务器在同一个网络中。一般不需要用户自己设置服务器，用户甚至感受不到自己访问的是反向代理服务器。</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20210322064703065.png" alt="image-20210322064703065"></p>
<p>例如，Nginx的反向代理功能，解决访问跨域问题，或者实现多个服务器负载均衡的效果。</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20210322064734300.png" alt="image-20210322064734300"></p>
<p>1、修改nginx的配置文件nginx.conf</p>
<p>修改前的配置文件为：</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20210322064805891.png" alt="image-20210322064805891"></p>
<p>修改后的配置文件为：</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20210322064827250.png" alt="image-20210322064827250"></p>
<blockquote>
<p>特别注意，nginx启动的时候，一定不要存放在有中文的路径中，如果启动失败，查看错误的日志记录</p>
</blockquote>
<p>conf.config</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line">#user  nobody;</span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">#error_log  logs/error.log;</span><br><span class="line">#error_log  logs/error.log  notice;</span><br><span class="line">#error_log  logs/error.log  info;</span><br><span class="line"></span><br><span class="line">#pid        logs/nginx.pid;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    #log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">    #                  &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">    #                  &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class="line"></span><br><span class="line">    #access_log  logs/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line">    #keepalive_timeout  0;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    #gzip  on;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  localhost;</span><br><span class="line"></span><br><span class="line">        #charset koi8-r;</span><br><span class="line"></span><br><span class="line">        #access_log  logs/host.access.log  main;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            root   html;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        #error_page  404              /404.html;</span><br><span class="line"></span><br><span class="line">        # redirect server error pages to the static page /50x.html</span><br><span class="line">        #</span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        # proxy the PHP scripts to Apache listening on 127.0.0.1:80</span><br><span class="line">        #</span><br><span class="line">        #location ~ \.php$ &#123;</span><br><span class="line">        #    proxy_pass   http://127.0.0.1;</span><br><span class="line">        #&#125;</span><br><span class="line"></span><br><span class="line">        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span><br><span class="line">        #</span><br><span class="line">        #location ~ \.php$ &#123;</span><br><span class="line">        #    root           html;</span><br><span class="line">        #    fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">        #    fastcgi_index  index.php;</span><br><span class="line">        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span><br><span class="line">        #    include        fastcgi_params;</span><br><span class="line">        #&#125;</span><br><span class="line"></span><br><span class="line">        # deny access to .htaccess files, if Apache&#x27;s document root</span><br><span class="line">        # concurs with nginx&#x27;s one</span><br><span class="line">        #</span><br><span class="line">        #location ~ /\.ht &#123;</span><br><span class="line">        #    deny  all;</span><br><span class="line">        #&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    # another virtual host using mix of IP-, name-, and port-based configuration</span><br><span class="line">    #</span><br><span class="line">    #server &#123;</span><br><span class="line">    #    listen       8000;</span><br><span class="line">    #    listen       somename:8080;</span><br><span class="line">    #    server_name  somename  alias  another.alias;</span><br><span class="line"></span><br><span class="line">    #    location / &#123;</span><br><span class="line">    #        root   html;</span><br><span class="line">    #        index  index.html index.htm;</span><br><span class="line">    #    &#125;</span><br><span class="line">    #&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    # HTTPS server</span><br><span class="line">    #</span><br><span class="line">    #server &#123;</span><br><span class="line">    #    listen       443 ssl;</span><br><span class="line">    #    server_name  localhost;</span><br><span class="line"></span><br><span class="line">    #    ssl_certificate      cert.pem;</span><br><span class="line">    #    ssl_certificate_key  cert.key;</span><br><span class="line"></span><br><span class="line">    #    ssl_session_cache    shared:SSL:1m;</span><br><span class="line">    #    ssl_session_timeout  5m;</span><br><span class="line"></span><br><span class="line">    #    ssl_ciphers  HIGH:!aNULL:!MD5;</span><br><span class="line">    #    ssl_prefer_server_ciphers  on;</span><br><span class="line"></span><br><span class="line">    #    location / &#123;</span><br><span class="line">    #        root   html;</span><br><span class="line">    #        index  index.html index.htm;</span><br><span class="line">    #    &#125;</span><br><span class="line">    #&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>其中：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location /html &#123;</span><br><span class="line">    rewrite ^/html/(.*)$ /$1 break;</span><br><span class="line">    proxy_pass http://localhost:9999/;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>当访问指定地址 <a target="_blank" rel="noopener" href="http://localhost/html">http://localhost/html</a> 的时候，会先重写URI地址</li>
<li>URI符合正则表达式^/api/(.*)$ 的地址会被重写为 /$1</li>
<li>$1表示正则表达式中第一个()中的字符串</li>
<li>最后把重写后的新地址，转发给<a target="_blank" rel="noopener" href="http://localhost:9999/">http://localhost:9999/</a></li>
</ul>
<p>例如，<br>浏览器中访问<a target="_blank" rel="noopener" href="http://localhost/html/ajax">http://localhost/html/ajax</a><br>nginx代理后，先重写地址，将/html/ajax，重写为/ajax<br>然后转发给<a target="_blank" rel="noopener" href="http://localhost:9999/">http://localhost:9999/</a> ，最终访问的是<a target="_blank" rel="noopener" href="http://localhost:9999/ajax">http://localhost:9999/ajax</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location /api &#123;</span><br><span class="line">    rewrite ^/api/(.*)$ /$1 break;</span><br><span class="line">    proxy_pass http://localhost:8989/;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，和上面的描述的含义相同</p>
</blockquote>
<p>2、ajax页面中，新增按钮和ajax请求</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">  $(&quot;.btn2&quot;).on(&quot;click&quot;,function()&#123;</span><br><span class="line">                $.ajax(&#123;</span><br><span class="line">                    type: &quot;GET&quot;,</span><br><span class="line">                    url : &quot;/api/hi&quot;,</span><br><span class="line">                    success: function(msg)&#123;</span><br><span class="line">                        console.log(msg);</span><br><span class="line">                    &#125;,</span><br><span class="line">                    error: function()&#123;</span><br><span class="line">                        alert(&#x27;error&#x27;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn2&quot;</span>&gt;</span>test2<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>3、启动nginx服务器，访问地址</p>
<p><a target="_blank" rel="noopener" href="http://localhost/html/ajax">http://localhost/html/ajax</a></p>
<blockquote>
<p>注意，此时访问springboot-html项目中的页面地址，和之前是不一样的</p>
</blockquote>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20210322074942961.png" alt="image-20210322074942961"></p>
<p>没有使用nginx之前，访问springboot-html中页面的地址： <a target="_blank" rel="noopener" href="http://localhost:9999/ajax">http://localhost:9999/ajax</a></p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20210322070308045.png" alt="image-20210322070308045"></p>
<p>使用nginx之后，访问springboot-html中页面的地址： <a target="_blank" rel="noopener" href="http://localhost/html/ajax">http://localhost/html/ajax</a></p>
<p>4、点击按钮2，发送ajax请求</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20210322075035934.png" alt="image-20210322075035934"></p>
<blockquote>
<p>可以看出，此时ajax请求已经成功了</p>
</blockquote>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20210322075121167.png" alt="image-20210322075121167"></p>
<blockquote>
<p>注意，此时ajax请求的地址为： <a target="_blank" rel="noopener" href="http://localhost/api/hi">http://localhost/api/hi</a></p>
</blockquote>
<blockquote>
<p>可以看出，已完成跨域访问，但其实是使用nginx代理服务器来“欺骗”浏览器，让浏览器认为是 “同源访问”</p>
</blockquote>
<p>如图：</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20210322070521188.png" alt="image-20210322070521188"></p>
<blockquote>
<p>浏览器中，从始至终都是访问<a target="_blank" rel="noopener" href="http://localhost/">http://localhost/</a> 下面的资源，所以浏览器认为一直是“同源访问”</p>
</blockquote>
<blockquote>
<p>浏览器不知道的是，它访问的服务器是一个nginx代理服务器，它会接收浏览器请求，重写URI地址<br>后，转发给真正的服务器。</p>
</blockquote>
<h3 id="3-2-cors"><a href="#3-2-cors" class="headerlink" title="3.2 cors"></a>3.2 cors</h3><h4 id="1、概念"><a href="#1、概念" class="headerlink" title="1、概念"></a>1、概念</h4><p>CORS(Cross-origin resource sharing)，是一个W3C标准，全称是”跨域资源共享”。</p>
<ul>
<li>整个CORS通信过程，都是浏览器自动完成，不需要用户参与。</li>
<li>对于开发者来说，CORS通信与同源的AJAX通信没有差别，代码完全一样。</li>
<li>浏览器一旦发现AJAX请求跨源，就会自动添加一些附加的头信息。（Origin）</li>
<li>有时还会多出一次附加的请求，但用户不会有感觉。（options方式的请求）</li>
</ul>
<h4 id="2、分类"><a href="#2、分类" class="headerlink" title="2、分类"></a>2、分类</h4><p>浏览器将CORS请求分成两类：</p>
<ul>
<li>简单请求（simple request）</li>
<li>非简单请求（not-so-simple request）</li>
</ul>
<p>只要同时满足以下两大条件，就属于简单请求：</p>
<p>请求方法是以下三种方法之一<br>    GET<br>    POST<br>    HEAD<br>HTTP的头信息不超出以下几种字段<br>    Accept<br>    Accept-Language</p>
<p>​    Content-Language<br>​    Last-Event-ID<br>​    Content-Type，该字段的值只能是以下三种</p>
<p>​        application/x-www-form-urlencoded</p>
<p>​        multipart/form-data<br>​        text/plain</p>
<blockquote>
<p>注意，只要不能同时满足上面两个条件，就属于非简单请求。</p>
</blockquote>
<h4 id="3、简单请求"><a href="#3、简单请求" class="headerlink" title="3、简单请求"></a>3、简单请求</h4><p>对于简单请求，浏览器直接发出CORS请求，同时在请求头中增加一个Origin字段。<br>该字段表示，本次请求来自哪个源（协议 + 域名 + 端口），服务器根据这个值，决定是否同意这次请<br>求。</p>
<p>Origin指定的源，即使不在服务器许可范围内，服务器还是会返回一个正常的HTTP响应，但是响应头中<br>不含指定Access-Control-Allow-Origin字段，浏览器这时候就知道本次跨域访问失败。<br>但是这个时候，响应状态可能是200，同时在一些工具中还能看到正确的返回值。<br>例如，</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20210322070848847.png" alt="image-20210322070848847"></p>
<p>其中，</p>
<ol>
<li>浏览器在请求头中自动添加了Origin 字段</li>
<li>服务器在响应中没有添加Access-Control-Allow-Origin 字段（说明服务器不支持此请求跨域访<br>问）</li>
<li>响应的状态码是200，并且从响应内容中可以看到正确的返回内容</li>
<li>同时，浏览器会抛出一个错误，被ajax的核心对象XMLHttpRequest的onerror 回调函数捕获</li>
</ol>
<p>如果Origin指定的域名在服务器的许可范围内，服务器返回的响应，会多出几个头信息字段：</p>
<ol>
<li><p>Access-Control-Allow-Origin<br>该字段是必须的。<br>它的值要么是请求时Origin字段的值，要么是一个*，表示接受任意域名的跨域请求。</p>
</li>
<li><p>Access-Control-Allow-Credentials</p>
<p>该字段可选<br>表示是否允许发送Cookie。<br>设为true，即表示服务器已经允许了，跨域请求中可以携带Cookie。<br>但是这需要AJAX中设置withCredentials=true进行配合。<br>如果服务器不要浏览器发送Cookie，删除该字段即可。</p>
</li>
</ol>
<p><code>3. Access-Control-Expose-Headers</code></p>
<p>​    该字段可选<br>​    列出了哪些首部可以作为响应的一部分暴露给外部。<br>​    默认情况下，只有七种可以暴露给外部<br>​    Cache-Control<br>​    Content-Language<br>​    Content-Length<br>​    Content-Type<br>​    Expires<br>​    Last-Modified<br>​    Pragma</p>
<p>​    如果想要让客户端可以访问到其他的首部信息，可以将它们在Access-Control-Expose-Headers里面指定</p>
<h4 id="4、非简单请求"><a href="#4、非简单请求" class="headerlink" title="4、非简单请求"></a>4、非简单请求</h4><p>非简单请求是那种对服务器有特殊要求的请求，比如请求方法是PUT或DELETE，或者Content-Type字段<br>的类型是application/json。<br>非简单请求的CORS请求，会在正式通信之前，增加一次HTTP查询请求，称为”预检”请求（preflight）。<br>浏览器先询问服务器，当前网页所在的域名是否在服务器的许可名单之中，以及可以使用哪些HTTP动词<br>和头信息字段。只有得到肯定答复，浏览器才会发出正式的XMLHttpRequest请求，否则就报错。</p>
<p>例如，</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;.btn1&quot;</span>).on(<span class="string">&quot;click&quot;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">$.ajax(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">        <span class="attr">url</span> : <span class="string">&quot;http://localhost:8989/hi&quot;</span>,</span><br><span class="line">        <span class="attr">contentType</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">        <span class="attr">success</span>: <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(msg);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">error</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        alert(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，在请求头中，指定contentType为application/json</p>
</blockquote>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20210322071208502.png" alt="image-20210322071208502"></p>
<blockquote>
<p>可以看出，请求头中有Content-Type:application/json 字段，属于非简单请求，浏览器会提前发送一个option方式的“预检请求”(预检请求会缓存)</p>
</blockquote>
<p>在这个“预检请求”的响应中，服务器会返回一些数据来通知浏览器，服务器对跨域请求的要求</p>
<p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20210322071259213.png" alt="image-20210322071259213"></p>
<p>如果浏览器否定了“预检”请求，也会返回一个正常的HTTP回应，但是没有任何CORS相关的头信息字段。<br>这时，浏览器就会认定，服务器不同意预检请求，因此触发一个错误，被XMLHttpRequest对象的onerror<br>回调函数捕获。</p>
<blockquote>
<p>测试简单请求和非简单请求</p>
</blockquote>
<p>==“预检”成功的常见响应头部字段有：==</p>
<ul>
<li>Access-Control-Allow-Origin</li>
<li>Access-Control-Allow-Methods</li>
<li>Access-Control-Allow-Headers</li>
<li>Access-Control-Allow-Credentials<br>标签允许客户端携带验证信息，例如 cookie<pre><code>Access-Control-Max-Age
表示预检请求的返回结果（即Access-Control-Allow-Methods 和Access-Control-Allow-Headers提供的信息） 可以被缓存多久。
</code></pre>
</li>
</ul>
<p>注意，ajax跨域访问的时候，如果需要在请求中携带cookie，需要有以下设置</p>
<ol>
<li><p>前端ajax请求中，指定withCredentials属性为ture</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$.ajax(&#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">    <span class="attr">url</span> : <span class="string">&quot;http://localhost:8989/hi&quot;</span>,</span><br><span class="line">    <span class="attr">xhrFields</span>:&#123;</span><br><span class="line">   		 <span class="attr">withCredentials</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">success</span>: <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(msg);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">error</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    alert(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
<li><p>后端响应头中，设置Access-Control-Allow-Credentials属性为true</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//允许跨域携带cookie</span></span><br><span class="line">response.setHeader(<span class="string">&quot;Access-Control-Allow-Credentials&quot;</span>, <span class="string">&quot;true&quot;</span>);</span><br></pre></td></tr></table></figure></li>
</ol>
<ol start="3">
<li>后端响应头中，设置Access-Control-Allow-Origin属性为具体的值，而不是能通配符*</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//response.setHeader(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;);</span></span><br><span class="line">response.setHeader(<span class="string">&quot;Access-Control-Allow-Origin&quot;</span>, <span class="string">&quot;http://127.0.0.1:9999&quot;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 允许cookie的情况下 前端配置 后台配置</span></span><br><span class="line">	<span class="meta">@GetMapping(&quot;/hi&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">(HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">		response.setHeader(<span class="string">&quot;Access-Control-Allow-Credentials&quot;</span>, <span class="string">&quot;true&quot;</span>);</span><br><span class="line">		response.setHeader(<span class="string">&quot;Access-Control-Allow-Origin&quot;</span>, <span class="string">&quot;http://localhost:9999&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">   <span class="comment">// 不允许cookie的情况下</span></span><br><span class="line">   <span class="meta">@GetMapping(&quot;/hi&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">(HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">		response.setHeader(<span class="string">&quot;Access-Control-Allow-Origin&quot;</span>, <span class="string">&quot;*&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>前端访问 <a target="_blank" rel="noopener" href="http://localhost:9999/ajax">http://localhost:9999/ajax</a> 后台就配 localhost</p>
<p>此时无法处理预检查请求</p>
</blockquote>
<p>可添加拦截器（了解）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.cms.web.interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CosInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		response.setHeader(<span class="string">&quot;Access-Control-Allow-Credentials&quot;</span>, <span class="string">&quot;true&quot;</span>);</span><br><span class="line">		response.setHeader(<span class="string">&quot;Access-Control-Allow-Origin&quot;</span>, <span class="string">&quot;http://localhost:9999&quot;</span>);</span><br><span class="line">		response.setHeader(<span class="string">&quot;Access-Control-Allow-Methods&quot;</span>,<span class="string">&quot;POST, GET, OPTIONS, DELETE&quot;</span>);</span><br><span class="line">		response.setHeader(<span class="string">&quot;Access-Control-Allow-Headers&quot;</span>, <span class="string">&quot;Content-Type, x-requested-with, X-Custom-Header, Authorization&quot;</span>);</span><br><span class="line">		System.out.println(<span class="string">&quot;跨域&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.cms.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.CorsRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.cms.web.interceptor.CosInterceptor;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addInterceptor(cosInterceptor())</span><br><span class="line">                .addPathPatterns(<span class="string">&quot;/**&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CosInterceptor <span class="title">cosInterceptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CosInterceptor();</span><br><span class="line">    &#125;	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<blockquote>
<p>注意，这里后端代码使用的使用response设置的，在springmvc中，也可以专门的设置方法来代替这种方式</p>
</blockquote>
<h4 id="5、使用"><a href="#5、使用" class="headerlink" title="5、使用"></a>5、使用</h4><p>springboot-html项目中的ajax.html页面：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>test<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;script src=&quot;https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js&quot;&gt;&lt;/script&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/jquery.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">        $(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;.btn1&quot;</span>).on(<span class="string">&quot;click&quot;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="attr">type</span>: <span class="string">&quot;GET&quot;</span>,</span></span><br><span class="line"><span class="javascript">                    <span class="attr">url</span> : <span class="string">&quot;http://localhost:8989/hi&quot;</span>,</span></span><br><span class="line"><span class="javascript">                    <span class="attr">success</span>: <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                        <span class="built_in">console</span>.log(msg);</span></span><br><span class="line"><span class="javascript">                    &#125;,</span></span><br><span class="line"><span class="javascript">                    <span class="attr">error</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                        alert(<span class="string">&#x27;error&#x27;</span>);</span></span><br><span class="line"><span class="javascript">                    &#125;</span></span><br><span class="line"><span class="javascript">                &#125;);</span></span><br><span class="line"><span class="javascript">            &#125;);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;.btn2&quot;</span>).on(<span class="string">&quot;click&quot;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="attr">type</span>: <span class="string">&quot;GET&quot;</span>,</span></span><br><span class="line"><span class="javascript">                    <span class="attr">url</span> : <span class="string">&quot;/api/hi&quot;</span>,</span></span><br><span class="line"><span class="javascript">                    <span class="attr">success</span>: <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                        <span class="built_in">console</span>.log(msg);</span></span><br><span class="line"><span class="javascript">                    &#125;,</span></span><br><span class="line"><span class="javascript">                    <span class="attr">error</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                        alert(<span class="string">&#x27;error&#x27;</span>);</span></span><br><span class="line"><span class="javascript">                    &#125;</span></span><br><span class="line"><span class="javascript">                &#125;);</span></span><br><span class="line"><span class="javascript">            &#125;);</span></span><br><span class="line"><span class="javascript">            </span></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;.btn3&quot;</span>).on(<span class="string">&quot;click&quot;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="attr">type</span>: <span class="string">&quot;GET&quot;</span>,</span></span><br><span class="line"><span class="javascript">                    <span class="attr">url</span> : <span class="string">&quot;http://localhost:8989/hi&quot;</span>,</span></span><br><span class="line"><span class="javascript">                    <span class="attr">success</span>: <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                        <span class="built_in">console</span>.log(msg);</span></span><br><span class="line"><span class="javascript">                    &#125;,</span></span><br><span class="line"><span class="javascript">                    <span class="attr">error</span>: <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                        alert(<span class="string">&#x27;error&#x27;</span>);</span></span><br><span class="line"><span class="javascript">                    &#125;</span></span><br><span class="line"><span class="javascript">                &#125;);</span></span><br><span class="line"><span class="javascript">            &#125;);</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        &#125;);</span></span><br><span class="line"><span class="javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn1&quot;</span>&gt;</span>test1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn2&quot;</span>&gt;</span>test2<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn3&quot;</span>&gt;</span>test3<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这里主要测试的是test3按钮</p>
</blockquote>
<p>springboot-cors项目中的Controller：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.cms.web.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@GetMapping(&quot;/hi&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>springboot-cors项目中的配置类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.cms.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.CorsRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addMapping(<span class="string">&quot;/**&quot;</span>)<span class="comment">//映射所有路径</span></span><br><span class="line">        .allowedOrigins(<span class="string">&quot;*&quot;</span>)<span class="comment">//运行所有客户端访问</span></span><br><span class="line">        .allowCredentials(<span class="keyword">false</span>)<span class="comment">//不允许携带cookie</span></span><br><span class="line">        .allowedMethods(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>, <span class="string">&quot;PUT&quot;</span>, <span class="string">&quot;DELETE&quot;</span>, <span class="string">&quot;OPTIONS&quot;</span>)<span class="comment">//</span></span><br><span class="line">        支持的方法</span><br><span class="line">        .allowedHeaders(<span class="string">&quot;*&quot;</span>)<span class="comment">//运行所有请求头字段</span></span><br><span class="line">        .maxAge(<span class="number">3600</span>);<span class="comment">//允许客户端缓存“预检请求”中获取的信息，3600秒</span></span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这里主要配置了跨域访问的属性</p>
</blockquote>
<p>启动俩个项目，访问页面，点击按钮，测试ajax跨域访问：</p>
<blockquote>
<p>可以看出，此时ajax请求进行跨域访问，已经成功</p>
</blockquote>
<blockquote>
<p>注意，此时可以尝试在ajax请求中，设置contentType: application/json ,观察是否会发出“预检”请求</p>
</blockquote>
<p>同时，也可以修改ajax请求，让其写的cookie和指定字段的头部：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;.btn3&quot;</span>).on(<span class="string">&quot;click&quot;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">        <span class="attr">url</span> : <span class="string">&quot;http://localhost:8989/hi&quot;</span>,</span><br><span class="line">        <span class="attr">xhrFields</span>:&#123;</span><br><span class="line">        <span class="attr">withCredentials</span>: <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">headers</span>:&#123;</span><br><span class="line">        <span class="attr">token</span>:<span class="string">&quot;aaa.bbb.ccc&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">contentType</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">        <span class="attr">success</span>: <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(msg);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">error</span>: <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;</span><br><span class="line">        alert(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>此时，对应的后端跨域设置为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addMapping(<span class="string">&quot;/**&quot;</span>)</span><br><span class="line">        .allowedOrigins(<span class="string">&quot;http://localhost:9999&quot;</span>)</span><br><span class="line">        .allowCredentials(<span class="keyword">true</span>)</span><br><span class="line">        .allowedMethods(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>, <span class="string">&quot;PUT&quot;</span>, <span class="string">&quot;DELETE&quot;</span>, <span class="string">&quot;OPTIONS&quot;</span>)</span><br><span class="line">        .allowedHeaders(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">        .maxAge(<span class="number">3600</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="6、其他"><a href="#6、其他" class="headerlink" title="6、其他"></a>6、其他</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> </span>&#123;</span><br><span class="line">    registry.addMapping(<span class="string">&quot;/**&quot;</span>)<span class="comment">//映射所有路径</span></span><br><span class="line">    .allowedOrigins(<span class="string">&quot;*&quot;</span>)<span class="comment">//运行所有客户端访问</span></span><br><span class="line">    .allowCredentials(<span class="keyword">false</span>)<span class="comment">//不允许携带cookie</span></span><br><span class="line">    .allowedMethods(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>, <span class="string">&quot;PUT&quot;</span>, <span class="string">&quot;DELETE&quot;</span>, <span class="string">&quot;OPTIONS&quot;</span>)<span class="comment">//支持的方法</span></span><br><span class="line">    .allowedHeaders(<span class="string">&quot;*&quot;</span>)<span class="comment">//运行所有请求头字段</span></span><br><span class="line">    .maxAge(<span class="number">3600</span>);<span class="comment">//允许客户端缓存“预检请求”中获取的信息，3600秒</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在此配置中，如果设置allowCredentials(true) ，那么allowedOrigins(“*”) 这里就不能使用通<br>配符了，必须要写一个或者多个（可变参数）客户端的地址<br>例如， allowedOrigins(“<a href="http://127.0.0.1:9999&quot;">http://127.0.0.1:9999&quot;</a>)</p>
<p>另外，如果只是想让Controller中的某一个方法或者几个方法被跨域访问，那么可以在方法上使用<br>@CrossOrigin 注解，例如</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@CrossOrigin(origins = &#123;&quot;http://127.0.0.1:9999&quot;&#125;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/hi&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，此时就不需要在配置类中做其他配置了，直接一个注解就可以让该方法被跨域访问了</p>
</blockquote>
<h1 id="角色模块-1"><a href="#角色模块-1" class="headerlink" title="角色模块"></a>角色模块</h1><ul>
<li>一个角色有多个用户 外键在用户方</li>
<li>jpa实体映射可以只配置一方</li>
</ul>
<h2 id="实体"><a href="#实体" class="headerlink" title="实体"></a>实体</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.cms.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.Column;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GeneratedValue;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GenerationType;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Table;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModel;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModelProperty;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;cms_role&quot;)</span></span><br><span class="line"><span class="meta">@ApiModel(&quot;角色模型&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Role</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Id</span></span><br><span class="line">	<span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">	<span class="meta">@ApiModelProperty(name = &quot;id&quot;,value = &quot;角色id&quot;,example = &quot;1&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Integer id;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ApiModelProperty(name = &quot;name&quot;,value = &quot;角色名称&quot;,example = &quot;admin&quot;)</span></span><br><span class="line">	<span class="meta">@Column(nullable = false)</span></span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ApiModelProperty(name = &quot;name&quot;,value = &quot;角色描述&quot;,example = &quot;manager&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String description;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//private Set&lt;User&gt; userList;</span></span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getDescription</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> description;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDescription</span><span class="params">(String description)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.description = description;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="接口-1"><a href="#接口-1" class="headerlink" title="接口"></a>接口</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">RoleService</span> </span>&#123;</span><br><span class="line">	<span class="comment">//分页获取所有角色信息</span></span><br><span class="line">	<span class="function">Page&lt;Role&gt; <span class="title">findAll</span><span class="params">(Integer pageNum,Integer pageSize)</span><span class="keyword">throws</span> ServiceException</span>;</span><br><span class="line">	<span class="comment">//新增角色信息或者更新角色信息</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">saveOrUpdateRole</span><span class="params">(Role role)</span><span class="keyword">throws</span> ServiceException</span>;</span><br><span class="line">	<span class="comment">//批量删除角色信息</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">deleteRoleInBatch</span><span class="params">(List&lt;Integer&gt; ids)</span><span class="keyword">throws</span> ServiceException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="插入角色"><a href="#插入角色" class="headerlink" title="插入角色"></a>插入角色</h2><h3 id="service-1"><a href="#service-1" class="headerlink" title="service"></a>service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveOrUpdateRole</span><span class="params">(Role role)</span> <span class="keyword">throws</span> ServiceException </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(role.getId() == <span class="keyword">null</span>) &#123;</span><br><span class="line">			roleDao.save(role);</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			Role target = roleDao.findById(role.getId()).get();</span><br><span class="line">			NotNullNameUtil.getNotNullNames(role, target);</span><br><span class="line">			roleDao.save(target);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>



<h3 id="controller-1"><a href="#controller-1" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line">	<span class="meta">@ApiOperation(value = &quot;添加或修改角色&quot;,notes = &quot;无id: 添加 有id：修改&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Result <span class="title">saveOrUpdate</span><span class="params">(<span class="meta">@RequestBody</span> Role role)</span> </span>&#123;</span><br><span class="line">		roleService.saveOrUpdateRole(role);</span><br><span class="line">		<span class="keyword">return</span> Result.success();</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>



<h2 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h2><h3 id="service-2"><a href="#service-2" class="headerlink" title="service"></a>service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Page&lt;Role&gt; <span class="title">findAll</span><span class="params">(Integer pageNum, Integer pageSize)</span> <span class="keyword">throws</span> ServiceException </span>&#123;</span><br><span class="line">		Pageable page = PageRequest.of(pageNum, pageSize);</span><br><span class="line">		<span class="keyword">return</span> roleDao.findAll(page);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>



<h3 id="controller-2"><a href="#controller-2" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;&#123;pageNum&#125;/&#123;pageSize&#125;&quot;)</span></span><br><span class="line">	<span class="meta">@ApiOperation(value = &quot;分页查询&quot;,notes = &quot;当前页面页码和每页条数&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Result <span class="title">findByPage</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">			<span class="meta">@ApiParam(name = &quot;pageNum&quot;,value = &quot;当前页&quot;,required = true)</span> </span></span></span><br><span class="line"><span class="params"><span class="function">				<span class="meta">@PathVariable(&quot;pageNum&quot;)</span> </span></span></span><br><span class="line"><span class="params"><span class="function">					Integer pageNum,</span></span></span><br><span class="line"><span class="params"><span class="function">			<span class="meta">@ApiParam(name = &quot;pageSize&quot;,value = &quot;每页显示条数&quot;,required = true)</span> </span></span></span><br><span class="line"><span class="params"><span class="function">				<span class="meta">@PathVariable(&quot;pageSize&quot;)</span></span></span></span><br><span class="line"><span class="params"><span class="function">					Integer pageSize)</span> </span>&#123;</span><br><span class="line">		Page&lt;Role&gt; page = roleService.findAll(pageNum, pageSize);</span><br><span class="line">		List&lt;Role&gt; context = page.getContent();</span><br><span class="line">		<span class="keyword">long</span> total = page.getTotalElements();</span><br><span class="line">		Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">		map.put(<span class="string">&quot;context&quot;</span>, context);</span><br><span class="line">		map.put(<span class="string">&quot;total&quot;</span>, total);</span><br><span class="line">		<span class="keyword">return</span> Result.success(map);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>



<h2 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h2><h3 id="service-3"><a href="#service-3" class="headerlink" title="service"></a>service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteRoleInBatch</span><span class="params">(List&lt;Integer&gt; ids)</span> <span class="keyword">throws</span> ServiceException </span>&#123;</span><br><span class="line">		List&lt;Role&gt; roleList  = roleDao.findAllById(ids);</span><br><span class="line">		<span class="keyword">if</span>(roleList == <span class="keyword">null</span> || roleList.size() == <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> CustomerException(ResultCode.DATA_NONE);</span><br><span class="line">		&#125;</span><br><span class="line">		roleDao.deleteInBatch(roleList);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h3 id="controller-3"><a href="#controller-3" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping</span></span><br><span class="line">	<span class="meta">@ApiOperation(value = &quot;删除角色&quot;,notes = &quot;传多个Id值&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Result <span class="title">deleteBatch</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">			<span class="meta">@RequestParam(name=&quot;ids&quot;)</span></span></span></span><br><span class="line"><span class="params"><span class="function">			<span class="meta">@ApiParam(name = &quot;ids&quot;,value = &quot;角色id&quot;,required = true)</span> List&lt;Integer&gt; ids)</span> </span>&#123;</span><br><span class="line">		roleService.deleteRoleInBatch(ids);</span><br><span class="line">		<span class="keyword">return</span> Result.success();</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p><code>问题</code></p>
<p>外键被引用无法删除。</p>
<ul>
<li>删除角色级联删除用户？</li>
<li>判断如果角色在使用不让删除？</li>
<li>删除角色 将用户外键置空</li>
</ul>
<h2 id="外键置空"><a href="#外键置空" class="headerlink" title="外键置空"></a>外键置空</h2><h3 id="数据库设置"><a href="#数据库设置" class="headerlink" title="数据库设置"></a>数据库设置</h3><p><img src="https://gitee.com/vanse/images/raw/master/cms/image-20211112193132222.png" alt="image-20211112193132222"></p>
<h3 id="jpa设置"><a href="#jpa设置" class="headerlink" title="jpa设置"></a>jpa设置</h3><blockquote>
<p>JPA默认删除外键策略是外键置空 但是需要两方都设置关系 不建议，否则两边都维护外键关系</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ManyToOne(targetEntity = Role.class)</span></span><br><span class="line"><span class="meta">@JoinColumn(name=&quot;role_id&quot;,referencedColumnName = &quot;id&quot;)</span></span><br><span class="line"><span class="keyword">private</span> Role role;</span><br><span class="line"></span><br><span class="line"><span class="meta">@OneToMany(targetEntity = User.class)</span></span><br><span class="line"><span class="meta">@JoinColumn(name = &quot;role_id&quot;, referencedColumnName = &quot;id&quot;)</span></span><br><span class="line"><span class="keyword">private</span> List&lt;User&gt; userList;</span><br></pre></td></tr></table></figure>



<h2 id="用户"><a href="#用户" class="headerlink" title="用户"></a>用户</h2><blockquote>
<p>由于设置了角色和用户的关系，此时用户模块的接口发生了变化</p>
</blockquote>
<h3 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h3><blockquote>
<p>jpa自带导航查询，查找用户时同时查找角色</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;code&quot;</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">&quot;msg&quot;</span>: <span class="string">&quot;操作成功&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;data&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="attr">&quot;username&quot;</span>: <span class="string">&quot;xvxcv&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;password&quot;</span>: <span class="string">&quot;sdfs&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;phone&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">&quot;realName&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">&quot;gender&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">&quot;birthday&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">&quot;registerTime&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">&quot;status&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;image&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">&quot;role&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;id&quot;</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;sdf&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;sdf&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="新增"><a href="#新增" class="headerlink" title="新增"></a>新增</h3><blockquote>
<p>  插入用户时 会默认提供角色类</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;birthday&quot;</span>: <span class="string">&quot;1900-01-13&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;gender&quot;</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;image&quot;</span>: <span class="string">&quot;string&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;password&quot;</span>: <span class="string">&quot;000&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;phone&quot;</span>: <span class="string">&quot;175********&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;realName&quot;</span>: <span class="string">&quot;老刘&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;role&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;id&quot;</span>: <span class="number">2</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;username&quot;</span>: <span class="string">&quot;jack2&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h1 id="目录模块"><a href="#目录模块" class="headerlink" title="目录模块"></a>目录模块</h1><ul>
<li><p>一个目录有多个子目录</p>
</li>
<li><p>一个目录有多个文章</p>
</li>
<li><p>一个用户有多个文章</p>
</li>
<li><p>一个用户有多个评论</p>
</li>
<li><p>一个文章有多个评论</p>
</li>
<li><p>一个评论有多个子评论</p>
</li>
</ul>
<h2 id="实体-1"><a href="#实体-1" class="headerlink" title="实体"></a>实体</h2><p>目录</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;cms_category&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Category</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Id</span></span><br><span class="line">	<span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">	<span class="meta">@ApiModelProperty(name = &quot;id&quot;,value = &quot;分类id&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Integer id;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Column(nullable = false)</span></span><br><span class="line">	<span class="meta">@ApiModelProperty(name = &quot;name&quot;,value = &quot;分类名称&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ApiModelProperty(name = &quot;description&quot;,value = &quot;分类描述&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String description;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Column(columnDefinition = &quot;int(10) COMMENT &#x27;序号&#x27;&quot;)</span></span><br><span class="line">	<span class="meta">@ApiModelProperty(name = &quot;no&quot;,value = &quot;排序编号&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> no;</span><br><span class="line">	<span class="comment">//lprivate int parent_id;</span></span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ManyToOne</span></span><br><span class="line">	<span class="meta">@JoinColumn(name = &quot;parent_id&quot;,referencedColumnName = &quot;id&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Category category; <span class="comment">// 父目录</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>文章</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;cms_article&quot;)</span></span><br><span class="line"><span class="meta">@ApiModel(&quot;文章模型&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Article</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Id</span></span><br><span class="line">	<span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">	<span class="meta">@ApiModelProperty(name = &quot;id&quot;,value = &quot;文章id&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Integer id;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Column(nullable = false)</span></span><br><span class="line">	<span class="meta">@ApiModelProperty(name = &quot;title&quot;,value = &quot;文章标题&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String title;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Column(nullable = false,length = 1024)</span></span><br><span class="line">	<span class="meta">@ApiModelProperty(name = &quot;content&quot;,value = &quot;文章内容&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String content;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Column(name = &quot;publish_time&quot;)</span></span><br><span class="line">	<span class="meta">@ApiModelProperty(name = &quot;publishTime&quot;,value = &quot;文章发布时间&quot;,hidden = true)</span></span><br><span class="line">	<span class="keyword">private</span> Date publishTime;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ApiModelProperty(name = &quot;status&quot;,value = &quot;审核状态&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> status;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ApiModelProperty(name = &quot;readTimes&quot;,value = &quot;阅读次数&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> readTimes;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Column(name = &quot;thumb_up&quot;)</span></span><br><span class="line">	<span class="meta">@ApiModelProperty(name = &quot;thumbUp&quot;,value = &quot;点赞数&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> thumbUp;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Column(name = &quot;thumb_down&quot;)</span></span><br><span class="line">	<span class="meta">@ApiModelProperty(name = &quot;thumbDown&quot;,value = &quot;点踩数&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> thumbDown;</span><br><span class="line">	<span class="comment">//private int userId;</span></span><br><span class="line">	<span class="comment">//private categoryId;</span></span><br><span class="line">	<span class="meta">@ManyToOne</span></span><br><span class="line">	<span class="meta">@JoinColumn(name = &quot;category_id&quot;,referencedColumnName = &quot;id&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Category category;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ManyToOne</span></span><br><span class="line">	<span class="meta">@JoinColumn(name = &quot;user_id&quot;,referencedColumnName = &quot;id&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> User user;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@OneToMany(mappedBy = &quot;article&quot;,cascade = CascadeType.ALL,targetEntity = Comment.class)</span></span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">	<span class="keyword">private</span> Set&lt;Comment&gt; comments = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>评论</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;cms_comment&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Comment</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Id</span></span><br><span class="line">	<span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">	<span class="meta">@ApiModelProperty(name = &quot;id&quot;,value = &quot;评论id&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Integer id;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ApiModelProperty(name = &quot;content&quot;,value = &quot;评论内容&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String content;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ApiModelProperty(name = &quot;time&quot;,value = &quot;评论时间&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Date time; <span class="comment">// 评论时间</span></span><br><span class="line"><span class="comment">//	private int userId;</span></span><br><span class="line"><span class="comment">//	private int articleId;</span></span><br><span class="line"><span class="comment">//	private int parentId;</span></span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ManyToOne</span></span><br><span class="line">	<span class="meta">@JoinColumn(name = &quot;user_id&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> User user;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ManyToOne</span></span><br><span class="line">	<span class="meta">@JoinColumn(name = &quot;article_id&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Article article;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ManyToOne</span></span><br><span class="line">	<span class="meta">@JoinColumn(name = &quot;comment_id&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Comment comment;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="接口-2"><a href="#接口-2" class="headerlink" title="接口"></a>接口</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CategoryService</span> </span>&#123;</span><br><span class="line">	<span class="comment">//分页获取所有分类</span></span><br><span class="line">	<span class="function">Page&lt;Category&gt; <span class="title">findAll</span><span class="params">(Integer pageNum,Integer pageSize)</span><span class="keyword">throws</span> ServiceException</span>;</span><br><span class="line">	<span class="comment">//新增分类或者更新分类</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">saveOrUpdateCategory</span><span class="params">(Category category)</span><span class="keyword">throws</span> ServiceException</span>;</span><br><span class="line">	<span class="comment">//批量删除分类</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">deleteCategoryInBatch</span><span class="params">(List&lt;Integer&gt; ids)</span><span class="keyword">throws</span> ServiceException</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//按序号升序查询分类信息，并进行分页</span></span><br><span class="line">	<span class="function">Page&lt;Category&gt; <span class="title">findAllSortbyno</span><span class="params">(Integer pageNum,Integer pageSize)</span><span class="keyword">throws</span> ServiceException</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//更新分类序号</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">updateCategoryNo</span><span class="params">(Integer id,<span class="keyword">int</span> no)</span><span class="keyword">throws</span> ServiceException</span>;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="新增-更新-1"><a href="#新增-更新-1" class="headerlink" title="新增/更新"></a>新增/更新</h2><h3 id="service-4"><a href="#service-4" class="headerlink" title="service"></a>service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加或者更新目录 </span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveOrUpdateCategory</span><span class="params">(Category category)</span> <span class="keyword">throws</span> ServiceException </span>&#123;</span><br><span class="line">		Integer id = category.getId();</span><br><span class="line">		String name = category.getName();</span><br><span class="line">		<span class="keyword">if</span>(id == <span class="keyword">null</span>) &#123;</span><br><span class="line">			categoryDao.save(category);</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			Category target = categoryDao.findById(id).get();</span><br><span class="line">			NotNullNameUtil.getNotNullNames(category, target);</span><br><span class="line">			categoryDao.save(target);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h3 id="controller-4"><a href="#controller-4" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;新增/更新目录&quot;,notes = &quot;新增/更新目录，需要json格式的字符串&quot;)</span></span><br><span class="line">	<span class="meta">@PostMapping(&quot;/category&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Result <span class="title">saveOrUpdateCategory</span><span class="params">(<span class="meta">@RequestBody</span> Category category)</span> </span>&#123;</span><br><span class="line">	    categoryService.saveOrUpdateCategory(category);</span><br><span class="line">	    <span class="keyword">return</span> Result.success();</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>



<h2 id="批量删除-1"><a href="#批量删除-1" class="headerlink" title="批量删除"></a>批量删除</h2><h3 id="service-5"><a href="#service-5" class="headerlink" title="service"></a>service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteCategoryInBatch</span><span class="params">(List&lt;Integer&gt; ids)</span> <span class="keyword">throws</span> ServiceException </span>&#123;</span><br><span class="line">		<span class="comment">// 目录关联了文章 不能删除 </span></span><br><span class="line">		<span class="keyword">for</span> (Integer id : ids) &#123;</span><br><span class="line">			<span class="comment">// 如果目录下有子目录 不让删除  该id是不是父类</span></span><br><span class="line">			List&lt;Category&gt; categoryList = categoryDao.findByCategoryId(id);</span><br><span class="line">			<span class="keyword">if</span> (categoryList != <span class="keyword">null</span> &amp;&amp; categoryList.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">				System.out.println(<span class="string">&quot;目录下有子目录&quot;</span>);</span><br><span class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> CustomerException(ResultCode.DATA_USEING);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">// 如果目录下有文章 不让删除</span></span><br><span class="line">			List&lt;Article&gt; articleList = articleService.findByCategoryId(id);</span><br><span class="line">			<span class="keyword">if</span>(articleList != <span class="keyword">null</span> &amp;&amp; articleList.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">				System.out.println(<span class="string">&quot;目录下有文章&quot;</span>);</span><br><span class="line">				 <span class="keyword">throw</span> <span class="keyword">new</span> CustomerException(ResultCode.DATA_USEING);</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 删除目录</span></span><br><span class="line">			categoryDao.deleteById(id);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h3 id="controller-5"><a href="#controller-5" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;删除目录&quot;,notes = &quot;提供多个id,批量删除&quot;)</span></span><br><span class="line">	<span class="meta">@DeleteMapping(&quot;/deleteCategoryInBatch&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Result <span class="title">deleteCategoryInBatch</span><span class="params">(<span class="meta">@RequestParam(&quot;ids&quot; )</span><span class="meta">@ApiParam(name = &quot;ids&quot;,value = &quot;id列表&quot;)</span> List&lt;Integer&gt;ids)</span> </span>&#123;</span><br><span class="line">		categoryService.deleteCategoryInBatch(ids);</span><br><span class="line">		<span class="keyword">return</span> Result.success();</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h3 id="CategoryDao"><a href="#CategoryDao" class="headerlink" title="CategoryDao"></a>CategoryDao</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CategoryDao</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Category</span>, <span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function">List&lt;Category&gt; <span class="title">findByCategoryId</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ArticleServiceImpl"><a href="#ArticleServiceImpl" class="headerlink" title="ArticleServiceImpl"></a>ArticleServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Article&gt; <span class="title">findByCategoryId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">		List&lt;Article&gt; articleList = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			articleList = articleDao.findByCategoryId(id);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> articleList;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>



<h2 id="分页升序"><a href="#分页升序" class="headerlink" title="分页升序"></a>分页升序</h2><h3 id="service-6"><a href="#service-6" class="headerlink" title="service"></a>service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Page&lt;Category&gt; <span class="title">findAllSortbyno</span><span class="params">(Integer pageNum, Integer pageSize)</span> <span class="keyword">throws</span> ServiceException </span>&#123;</span><br><span class="line">		<span class="comment">// 排序 分页</span></span><br><span class="line">		Pageable page = PageRequest.of(pageNum, pageSize, Direction.ASC, <span class="string">&quot;no&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> categoryDao.findAll(page);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h3 id="controller-6"><a href="#controller-6" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;查询目录&quot;,notes = &quot;分页并且顺序查询&quot; )</span></span><br><span class="line">	<span class="meta">@GetMapping(&quot;/find/&#123;pageNum&#125;/&#123;pageSize&#125;&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Result <span class="title">findAllSortbyno</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">			<span class="meta">@ApiParam(name = &quot;pageNum&quot;,value = &quot;当前页&quot;,required = true)</span> <span class="meta">@PathVariable(&quot;pageNum&quot;)</span><span class="keyword">int</span> pageNum,</span></span></span><br><span class="line"><span class="params"><span class="function">			<span class="meta">@ApiParam(name = &quot;pageSize&quot;,value = &quot;每页数量&quot;,required = true)</span> <span class="meta">@PathVariable(&quot;pageSize&quot;)</span> <span class="keyword">int</span> pageSize)</span> </span>&#123;</span><br><span class="line">		Page&lt;Category&gt; page = categoryService.findAllSortbyno(pageNum, pageSize);</span><br><span class="line">		List&lt;Category&gt; content = page.getContent();</span><br><span class="line">		<span class="keyword">long</span> total = page.getTotalElements();</span><br><span class="line">		Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">		map.put(<span class="string">&quot;total&quot;</span>, total);</span><br><span class="line">		map.put(<span class="string">&quot;content&quot;</span>, content);</span><br><span class="line">		<span class="keyword">return</span> Result.success(map);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>



<h2 id="更新分类序号"><a href="#更新分类序号" class="headerlink" title="更新分类序号"></a>更新分类序号</h2><h3 id="service-7"><a href="#service-7" class="headerlink" title="service"></a>service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateCategoryNo</span><span class="params">(Integer id, <span class="keyword">int</span> no)</span> <span class="keyword">throws</span> ServiceException </span>&#123;</span><br><span class="line">		Category category = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			category = categoryDao.findById(id).get();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			 <span class="keyword">throw</span> <span class="keyword">new</span> CustomerException(ResultCode.DATA_NONE);</span><br><span class="line">		&#125;</span><br><span class="line">		category.setNo(no);</span><br><span class="line">		categoryDao.save(category);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h3 id="controller-7"><a href="#controller-7" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;更新分类排序&quot;,notes = &quot;改变排序字段&quot;)</span></span><br><span class="line">	<span class="meta">@PutMapping(&quot;/update/&#123;id&#125;/&#123;no&#125;&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Result <span class="title">updateCategoryNo</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">			<span class="meta">@ApiParam(name = &quot;id&quot;,value = &quot;分类id&quot;,required = true)</span> <span class="meta">@PathVariable(&quot;id&quot;)</span> <span class="keyword">int</span> id,</span></span></span><br><span class="line"><span class="params"><span class="function">			<span class="meta">@ApiParam(name = &quot;no&quot;,value = &quot;排序字段&quot;,required = true)</span>  <span class="meta">@PathVariable(&quot;no&quot;)</span> <span class="keyword">int</span> no)</span> </span>&#123;</span><br><span class="line">		categoryService.updateCategoryNo(id, no);</span><br><span class="line">		<span class="keyword">return</span> Result.success();</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>





<h1 id="文章模块"><a href="#文章模块" class="headerlink" title="文章模块"></a>文章模块</h1><h2 id="接口-3"><a href="#接口-3" class="headerlink" title="接口"></a>接口</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ArticleService</span> </span>&#123;</span><br><span class="line">	<span class="comment">//发布资讯或者编辑资讯</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">saveOrUpdateArticle</span><span class="params">(Article article)</span><span class="keyword">throws</span> ServiceException</span>;</span><br><span class="line">	<span class="comment">//分页获取所有资讯</span></span><br><span class="line">	<span class="comment">//pageNum:页码，pageSize：一页显示多少条数据</span></span><br><span class="line">	<span class="function">Page&lt;Article&gt; <span class="title">findAll</span><span class="params">(Integer pageNum,Integer pageSize)</span><span class="keyword">throws</span> ServiceException</span>;</span><br><span class="line">	<span class="comment">//批量删除资讯</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">deleteArticleInBatch</span><span class="params">(List&lt;Integer&gt; ids)</span><span class="keyword">throws</span> ServiceException</span>;</span><br><span class="line">	<span class="comment">//管理员审核资讯</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">updateArticleStatus</span><span class="params">(Integer id,String status)</span><span class="keyword">throws</span> ServiceException</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 查询分类下的文章</span></span><br><span class="line">	<span class="function">List&lt;Article&gt; <span class="title">findByCategoryId</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="添加-更新"><a href="#添加-更新" class="headerlink" title="添加/更新"></a>添加/更新</h2><h3 id="service-8"><a href="#service-8" class="headerlink" title="service"></a>service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveOrUpdateArticle</span><span class="params">(Article article)</span> <span class="keyword">throws</span> ServiceException </span>&#123;</span><br><span class="line">		Integer id = article.getId();</span><br><span class="line">		String title = article.getTitle();</span><br><span class="line">		<span class="keyword">if</span> (id == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (title == <span class="keyword">null</span> || <span class="string">&quot;&quot;</span>.equals(title.trim())) &#123;</span><br><span class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> CustomerException(ResultCode.PARAM_IS_BLANK);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">// 还需要判断标题是否已经存在</span></span><br><span class="line">			article.setPublishTime(<span class="keyword">new</span> Date());</span><br><span class="line">			article.setReadTimes(<span class="number">0</span>); <span class="comment">// 阅读次数 查看文章详情时 阅读次数+1</span></span><br><span class="line">			article.setStatus(<span class="number">0</span>); <span class="comment">// 未审核</span></span><br><span class="line">			article.setThumbDown(<span class="number">0</span>); <span class="comment">// 点踩数</span></span><br><span class="line">			article.setThumbUp(<span class="number">0</span>); <span class="comment">// 点赞数</span></span><br><span class="line">			articleDao.save(article);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			Article target = articleDao.findById(id).get();</span><br><span class="line">			NotNullNameUtil.getNotNullNames(article, target);</span><br><span class="line">			articleDao.save(target);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h3 id="controller-8"><a href="#controller-8" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;新增文章&quot;, notes = &quot;新增文章，需要json格式的字符串&quot;)</span></span><br><span class="line">	<span class="meta">@PostMapping</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Result <span class="title">saveOrUpdateArticle</span><span class="params">(<span class="meta">@RequestBody</span> Article article)</span> </span>&#123;</span><br><span class="line">		articleService.saveOrUpdateArticle(article);</span><br><span class="line">		<span class="keyword">return</span> Result.success();</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;category&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;id&quot;</span>: <span class="number">1</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;content&quot;</span>: <span class="string">&quot;666&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;readTimes&quot;</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;论corejava的学习&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;user&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;id&quot;</span>: <span class="number">3</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="分页-1"><a href="#分页-1" class="headerlink" title="分页"></a>分页</h2><h3 id="service-9"><a href="#service-9" class="headerlink" title="service"></a>service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Page&lt;Article&gt; <span class="title">findAll</span><span class="params">(Integer pageNum, Integer pageSize)</span> <span class="keyword">throws</span> ServiceException </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> articleDao.findAll(PageRequest.of(pageNum, pageSize));</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>###controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;分页查询文章&quot;, notes = &quot;提供当前页码和每页显示条数&quot;)</span></span><br><span class="line">	<span class="meta">@GetMapping(&quot;&#123;pageNum&#125;/&#123;pageSize&#125;&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Result <span class="title">findAll</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">		<span class="meta">@ApiParam(name = &quot;pageNum&quot;,value = &quot;当前页&quot;,required = true,defaultValue = &quot;0&quot;)</span>	<span class="meta">@PathVariable(&quot;pageNum&quot;)</span> <span class="keyword">int</span> pageNum, </span></span></span><br><span class="line"><span class="params"><span class="function">		<span class="meta">@ApiParam(name = &quot;pageSize&quot;,value = &quot;每页条数&quot;,required = true,defaultValue = &quot;5&quot;)</span>	<span class="meta">@PathVariable(&quot;pageSize&quot;)</span> <span class="keyword">int</span> pageSize)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//返回完整分页信息（包括总条数，上一页下一页等。）</span></span><br><span class="line">		Page&lt;Article&gt; page = articleService.findAll(pageNum, pageSize);</span><br><span class="line">		<span class="comment">//此处为了页面效果暂时只返回数据  ，可自行调整</span></span><br><span class="line">		List&lt;Article&gt; content = page.getContent();</span><br><span class="line">		<span class="keyword">long</span> total = page.getTotalElements();</span><br><span class="line">		Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">		map.put(<span class="string">&quot;content&quot;</span>, content);</span><br><span class="line">		map.put(<span class="string">&quot;total&quot;</span>, total);</span><br><span class="line">		<span class="keyword">return</span> Result.success(map);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h2 id="审核"><a href="#审核" class="headerlink" title="审核"></a>审核</h2><h3 id="service-10"><a href="#service-10" class="headerlink" title="service"></a>service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateArticleStatus</span><span class="params">(Integer id, Integer status)</span> <span class="keyword">throws</span> ServiceException </span>&#123;</span><br><span class="line">		Article article = articleDao.findById(id).get();</span><br><span class="line">		article.setStatus(status);</span><br><span class="line">		articleDao.save(article);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="controller-9"><a href="#controller-9" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;修改文章状态&quot;, notes = &quot;提供id和status&quot;)</span></span><br><span class="line">	<span class="meta">@PutMapping(&quot;&#123;id&#125;/&#123;status&#125;&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Result <span class="title">updateArticleStatus</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">			<span class="meta">@ApiParam(name = &quot;id&quot;,value = &quot;文章id&quot;,required = true)</span>	<span class="meta">@PathVariable(&quot;id&quot;)</span>Integer id,</span></span></span><br><span class="line"><span class="params"><span class="function">			<span class="meta">@ApiParam(name = &quot;status&quot;,value = &quot;审核状态&quot;,required = true)</span> <span class="meta">@PathVariable(&quot;status&quot;)</span> Integer status)</span> </span>&#123;</span><br><span class="line">		articleService.updateArticleStatus(id, status);</span><br><span class="line">		<span class="keyword">return</span> Result.success();</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h2 id="批量删除-2"><a href="#批量删除-2" class="headerlink" title="批量删除"></a>批量删除</h2><h3 id="service-11"><a href="#service-11" class="headerlink" title="service"></a>service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 批量删除文章 以及评论</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteArticleInBatch</span><span class="params">(List&lt;Integer&gt; ids)</span> <span class="keyword">throws</span> ServiceException </span>&#123;</span><br><span class="line">		List&lt;Article&gt; articleList = articleDao.findAllById(ids);</span><br><span class="line">		<span class="keyword">if</span> (articleList == <span class="keyword">null</span> || articleList.size() == <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> CustomerException(ResultCode.DATA_NONE);</span><br><span class="line">		&#125;</span><br><span class="line">		articleDao.deleteInBatch(articleList);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h3 id="controller-10"><a href="#controller-10" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;批量删除文章&quot;, notes = &quot;提供id集合&quot;)</span></span><br><span class="line">	<span class="meta">@DeleteMapping</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Result <span class="title">deleteBatch</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">			<span class="meta">@RequestParam(&quot;ids&quot;)</span></span></span></span><br><span class="line"><span class="params"><span class="function">			<span class="meta">@ApiParam(name = &quot;ids&quot;,value = &quot;文章id&quot;,required = true)</span> List&lt;Integer&gt; ids)</span> </span>&#123;</span><br><span class="line">		articleService.deleteArticleInBatch(ids);</span><br><span class="line">		<span class="keyword">return</span> Result.success();</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>此处测试cascade可用，但是web不可用，删了表重建可解决</p>
</blockquote>
<h2 id="关联"><a href="#关联" class="headerlink" title="关联"></a>关联</h2><p>此处有用户外键，需要处理用户删除时，文章的处理，置为空</p>
<h1 id="评论模块-1"><a href="#评论模块-1" class="headerlink" title="评论模块"></a>评论模块</h1><h2 id="接口-4"><a href="#接口-4" class="headerlink" title="接口"></a>接口</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CommentService</span> </span>&#123;</span><br><span class="line">	<span class="comment">//分页获取所有评论</span></span><br><span class="line">	<span class="function">Page&lt;Comment&gt; <span class="title">findAll</span><span class="params">(Integer pageNum, Integer pageSize)</span><span class="keyword">throws</span> ServiceException</span>;</span><br><span class="line">	<span class="comment">//新增评论或者更新评论</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">saveOrUpdateComment</span><span class="params">(Comment comment)</span><span class="keyword">throws</span> ServiceException</span>;</span><br><span class="line">	<span class="comment">//批量删除评论</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">deleteCommentInBatch</span><span class="params">(List&lt;Integer&gt; ids)</span><span class="keyword">throws</span> ServiceException</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//根据资讯id分页获取所有评论</span></span><br><span class="line">	<span class="function">Page&lt;Comment&gt; <span class="title">findAllByArticleId</span><span class="params">(Integer articleId,Integer pageNum, Integer pageSize)</span><span class="keyword">throws</span> ServiceException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="新增-1"><a href="#新增-1" class="headerlink" title="新增"></a>新增</h2><h3 id="service-12"><a href="#service-12" class="headerlink" title="service"></a>service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveOrUpdateComment</span><span class="params">(Comment comment)</span> <span class="keyword">throws</span> ServiceException </span>&#123;</span><br><span class="line">		String content = comment.getContent();</span><br><span class="line">		<span class="keyword">if</span>(content == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> CustomerException(ResultCode.PARAM_IS_BLANK);</span><br><span class="line">		&#125;</span><br><span class="line">		comment.setTime(<span class="keyword">new</span> Date());</span><br><span class="line">		<span class="comment">// 评论不需要修改</span></span><br><span class="line">		commentDao.save(comment);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>



<h3 id="controller-11"><a href="#controller-11" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;添加评论&quot;,notes = &quot;参数为json格式&quot;)</span></span><br><span class="line">	<span class="meta">@PostMapping</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Result <span class="title">saveOrUpdateComment</span><span class="params">(<span class="meta">@RequestBody</span> Comment comment)</span> </span>&#123;</span><br><span class="line">		commentService.saveOrUpdateComment(comment);</span><br><span class="line">		<span class="keyword">return</span> Result.success();</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;article&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;id&quot;</span>: <span class="number">4</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;comment&quot;</span>:&#123;</span><br><span class="line">    <span class="attr">&quot;id&quot;</span>: <span class="number">7</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;content&quot;</span>: <span class="string">&quot;你也一样&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;user&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;id&quot;</span>: <span class="number">3</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="分页查询-1"><a href="#分页查询-1" class="headerlink" title="分页查询"></a>分页查询</h2><h3 id="service-13"><a href="#service-13" class="headerlink" title="service"></a>service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Page&lt;Comment&gt; <span class="title">findAll</span><span class="params">(Integer pageNum, Integer pageSize)</span> <span class="keyword">throws</span> ServiceException </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> commentDao.findAll(PageRequest.of(pageNum, pageSize));</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>



<h3 id="controller-12"><a href="#controller-12" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 分页查询</span></span><br><span class="line">	<span class="meta">@ApiOperation(value = &quot;分页查询评论&quot;, notes = &quot;提供当前页码和每页显示条数&quot;)</span></span><br><span class="line">	<span class="meta">@GetMapping(&quot;&#123;pageNum&#125;/&#123;pageSize&#125;&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Result <span class="title">findAll</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">		<span class="meta">@ApiParam(name = &quot;pageNum&quot;,value = &quot;当前页&quot;,required = true,defaultValue = &quot;0&quot;)</span>	<span class="meta">@PathVariable(&quot;pageNum&quot;)</span> <span class="keyword">int</span> pageNum, </span></span></span><br><span class="line"><span class="params"><span class="function">		<span class="meta">@ApiParam(name = &quot;pageSize&quot;,value = &quot;每页条数&quot;,required = true,defaultValue = &quot;5&quot;)</span>	<span class="meta">@PathVariable(&quot;pageSize&quot;)</span> <span class="keyword">int</span> pageSize)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//返回完整分页信息（包括总条数，上一页下一页等。）</span></span><br><span class="line">		Page&lt;Comment&gt; page = commentService.findAll(pageNum, pageSize);</span><br><span class="line">		<span class="comment">//此处为了页面效果暂时只返回数据  ，可自行调整</span></span><br><span class="line">		List&lt;Comment&gt; content = page.getContent();</span><br><span class="line">		<span class="keyword">long</span> total = page.getTotalElements();</span><br><span class="line">		Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">		map.put(<span class="string">&quot;content&quot;</span>, content);</span><br><span class="line">		map.put(<span class="string">&quot;total&quot;</span>, total);</span><br><span class="line">		<span class="keyword">return</span> Result.success(map);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>



<p><strong>jpa嵌套查询 栈溢出</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Article.java</span><br><span class="line"><span class="meta">@JsonIgnore</span></span><br><span class="line"><span class="keyword">private</span> Set&lt;Comment&gt; comments = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br></pre></td></tr></table></figure>



<h2 id="批量删除-3"><a href="#批量删除-3" class="headerlink" title="批量删除"></a>批量删除</h2><h3 id="service-14"><a href="#service-14" class="headerlink" title="service"></a>service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteCommentInBatch</span><span class="params">(List&lt;Integer&gt; ids)</span> <span class="keyword">throws</span> ServiceException </span>&#123;</span><br><span class="line">		<span class="comment">// 父子评论 级联删除即可</span></span><br><span class="line">		List&lt;Comment&gt; commentList = commentDao.findAllById(ids);</span><br><span class="line">		commentDao.deleteAll(commentList);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>



<h3 id="controller-13"><a href="#controller-13" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;批量删除评论&quot;, notes = &quot;提供id集合&quot;)</span></span><br><span class="line">	<span class="meta">@DeleteMapping</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Result <span class="title">deleteBatch</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">			<span class="meta">@RequestParam(&quot;ids&quot;)</span></span></span></span><br><span class="line"><span class="params"><span class="function">			<span class="meta">@ApiParam(name = &quot;ids&quot;,value = &quot;评论id&quot;,required = true)</span> List&lt;Integer&gt; ids)</span> </span>&#123;</span><br><span class="line">		commentService.deleteCommentInBatch(ids);</span><br><span class="line">		<span class="keyword">return</span> Result.success();</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>



<h2 id="分页某文章评论"><a href="#分页某文章评论" class="headerlink" title="分页某文章评论"></a>分页某文章评论</h2><h3 id="service-15"><a href="#service-15" class="headerlink" title="service"></a>service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Page&lt;Comment&gt; <span class="title">findAllByArticleId</span><span class="params">(Integer articleId, Integer pageNum, Integer pageSize)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServiceException </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> commentDao.findAllByArticleId(articleId,PageRequest.of(pageNum, pageSize));</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h3 id="controller-14"><a href="#controller-14" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;分页查询某文章评论&quot;, notes = &quot;提供当前页码和每页显示条数,文章id&quot;)</span></span><br><span class="line">		<span class="meta">@GetMapping(&quot;&#123;articleId&#125;/&#123;pageNum&#125;/&#123;pageSize&#125;&quot;)</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> Result <span class="title">findAllByArticleId</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">			<span class="meta">@ApiParam(name = &quot;articleId&quot;,value = &quot;文章id&quot;,required = true,defaultValue = &quot;0&quot;)</span>	<span class="meta">@PathVariable(&quot;articleId&quot;)</span> <span class="keyword">int</span> articleId,</span></span></span><br><span class="line"><span class="params"><span class="function">			<span class="meta">@ApiParam(name = &quot;pageNum&quot;,value = &quot;当前页&quot;,required = true,defaultValue = &quot;0&quot;)</span>	<span class="meta">@PathVariable(&quot;pageNum&quot;)</span> <span class="keyword">int</span> pageNum, </span></span></span><br><span class="line"><span class="params"><span class="function">			<span class="meta">@ApiParam(name = &quot;pageSize&quot;,value = &quot;每页条数&quot;,required = true,defaultValue = &quot;5&quot;)</span>	<span class="meta">@PathVariable(&quot;pageSize&quot;)</span> <span class="keyword">int</span> pageSize)</span> </span>&#123;</span><br><span class="line">			<span class="comment">//返回完整分页信息（包括总条数，上一页下一页等。）</span></span><br><span class="line">			Page&lt;Comment&gt; page = commentService.findAllByArticleId(articleId,pageNum, pageSize);</span><br><span class="line">			<span class="comment">//此处为了页面效果暂时只返回数据  ，可自行调整</span></span><br><span class="line">			List&lt;Comment&gt; content = page.getContent();</span><br><span class="line">			<span class="keyword">long</span> total = page.getTotalElements();</span><br><span class="line">			Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">			map.put(<span class="string">&quot;content&quot;</span>, content);</span><br><span class="line">			map.put(<span class="string">&quot;total&quot;</span>, total);</span><br><span class="line">			<span class="keyword">return</span> Result.success(map);</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>

<h3 id="CommentDao"><a href="#CommentDao" class="headerlink" title="CommentDao"></a>CommentDao</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CommentDao</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Comment</span>, <span class="title">Integer</span>&gt;</span>&#123;</span><br><span class="line">	<span class="function">Page&lt;Comment&gt; <span class="title">findAllByArticleId</span><span class="params">(Integer articleId, Pageable page)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h1 id="security"><a href="#security" class="headerlink" title="security"></a>security</h1> 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/briup/" rel="tag">briup</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/springboot/" rel="tag">springboot</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-briup_springmvc"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/archives/briup_springmvc.html"
    >springmvc</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/archives/briup_springmvc.html" class="article-date">
  <time datetime="2021-11-06T05:23:53.000Z" itemprop="datePublished">2021-11-06</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/briup/">briup</a>
  </div>
   
    </div>
     
	
	 
	
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="springmvc-一"><a href="#springmvc-一" class="headerlink" title="springmvc(一)"></a>springmvc(一)</h1><h2 id="1-MVC"><a href="#1-MVC" class="headerlink" title="1 MVC"></a>1 MVC</h2><h3 id="1-1-Web"><a href="#1-1-Web" class="headerlink" title="1.1 Web"></a>1.1 Web</h3><p>完成一次web请求的过程：</p>
<ul>
<li>Web浏览器发起请求</li>
<li>Web服务器接收请求并处理请求,最后产生响应(一般为html)</li>
<li>Web服务器处理完成后,返回内容给web客户端,客户端对接收的内容进行处理并显示出来</li>
</ul>
<p>从这里可以看出,在Web中,都是Web客户端发起请求,Web服务器接收处理请求并产生响应。</p>
<p>一般Web服务器是不能主动通知Web客户端更新内容。虽然有些技术可以帮我们实现这样的效果,如服务器推技术（Comet）、还有HTML5中的websocket等。</p>
<h3 id="1-2-MVC"><a href="#1-2-MVC" class="headerlink" title="1.2 MVC"></a>1.2 MVC</h3><p>MVC（Model-View-Controller），是一种架构型的模式,本身不引入新功能,只是帮助我们将开发的代码结构,组织的更加合理。其中：</p>
<ul>
<li><p>Model(模型)</p>
<p>负责提供要展示的数据,因此包含数据和行为,行为是用来处理这些数据的。</p>
<p>不过现在一般都分离开来，例如分为Value Object（数据） 和 服务层（行为）。</p>
<p>也就是数据由实体类或者javabean来提供,行为由service层来提供。</p>
</li>
<li><p>View(视图)</p>
<p>负责进行模型的展示,一般就是我们见到的用户界面,客户想看到的东西</p>
</li>
<li><p>Controller(控制器)</p>
<p>负责接收用户请求,委托给模型进行处理,处理完毕后把返回的模型数据交给给视图。</p>
<p>也就是说控制器在中间起到一个调度的作用。</p>
</li>
</ul>
<p>如图：</p>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201109094045228.png" alt="image-20201109094045228"></p>
<blockquote>
<p>注意，在标准的MVC中,模型能主动推数据给视图进行更新，但在Web开发中模型是无法主动推给视图，因为在Web的访问是请求-响应的模式。必须由客户端主动发出请求后,服务器才能把数据返回。</p>
</blockquote>
<h3 id="1-3-WebMVC"><a href="#1-3-WebMVC" class="headerlink" title="1.3 WebMVC"></a>1.3 WebMVC</h3><p>Web中MVC里面的模型、视图、控制器的概念，和标准MVC概念是一样的。</p>
<p>但是在Web MVC模式下,模型无法【<strong>主动</strong>】推数据给视图,如果用户想要视图更新,需要再发送一次请求。</p>
<p>在我们之前的学习中：</p>
<ul>
<li>把Servlet作为Controller(控制器)</li>
<li>把jsp作为View(视图)</li>
<li>把javabean作为Model(模型)中的数据,service层作为Model(模型)中的行为</li>
</ul>
<blockquote>
<p>注意，一定要区分MVC和三层架构的区别</p>
</blockquote>
<h2 id="2-Spring-Web-MVC"><a href="#2-Spring-Web-MVC" class="headerlink" title="2 Spring Web MVC"></a>2 Spring Web MVC</h2><h3 id="2-1-概述"><a href="#2-1-概述" class="headerlink" title="2.1 概述"></a>2.1 概述</h3><p>SpringWebMVC简称SpringMVC，它是Spring Framework框架中提供的一个模块,通过实现MVC模式来很好地将数据、业务与展现进行分离。</p>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201109094601635.png" alt="image-20201109094601635"></p>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201109094646288.png" alt="image-20201109094646288"></p>
<blockquote>
<p>注意，SpringMVC框架的目的是要简化我们日常的Web开发</p>
</blockquote>
<p>SpringMVC的几个特点：</p>
<ul>
<li><p>SpringMVC框架跟其他的WebMVC框架一样,都是请求驱动。</p>
</li>
<li><p>SpringMVC框架设计并围绕一个能够分发请求到控制器的核心Servlet(DispatcherServlet,即前端控制器)。</p>
</li>
<li><p>SpringMVC框架和spring的IOC容器完全整合,并且允许使用spring中其他的所有功能。</p>
</li>
<li><p>SpringMVC框架设计的一个核心的原则就是”开闭原则”,对扩展开放,对修改关闭。所以SpringMVC框架中很多方法都是final的,不允许用户随意覆盖,但是却提供给用户很多可扩展的机制。</p>
</li>
<li><p>SpringMVC框架目前已经成为非常流行的web应用的框架。</p>
</li>
</ul>
<h3 id="2-1-获取"><a href="#2-1-获取" class="headerlink" title="2.1 获取"></a>2.1 获取</h3><p>由于SpringMVC是Spring框架中的一个模块,所以我们下载Spring框架即可,因为里面包含了Spring框架的各个模块的相关东西,当然也包含了SpringMVC的(jar包、API文档、说明文档、源代码等)</p>
<p>SpringMVC框架的jar包分为四部分：</p>
<p>1、web及webmvc的jar包（必选）</p>
<ul>
<li>spring-web-x.x.x.RELEASE</li>
<li>spring-webmvc-x.x.x.RELEASE</li>
</ul>
<p>2、Spring框架的核心模块的jar包（必选）</p>
<ul>
<li>spring-beans-x.x.x.RELEASE</li>
<li>spring-core-x.x.x.RELEASE</li>
<li>spring-context-x.x.x.RELEASE</li>
<li>spring-expression-x.x.x.RELEASE</li>
<li>spring-aop-x.x.x.RELEASE</li>
</ul>
<p>3、日志的jar包（可选）</p>
<ul>
<li>commons-logging-x.x</li>
<li>log4j-x.x.x</li>
</ul>
<p>4、其他（可选）</p>
<ul>
<li>jstl-1.2.jar （如果使用jsp的话，必须引入） </li>
</ul>
<h3 id="2-3-组件"><a href="#2-3-组件" class="headerlink" title="2.3 组件"></a>2.3 组件</h3><p>SpringMVC中的核心组件，有以下几种：</p>
<ul>
<li><p><code>DispatcherServlet</code></p>
<p>前端控制器。用来过滤客户端发送过来,想要进行逻辑处理的请求</p>
</li>
<li><p><code>Controller/Headler</code></p>
<p>控制器/处理器。开发人员自定义,用来处理用户请求的,并且处理完成之后返回给用户指定视图的对象</p>
<p>相当于我们之前编写的Servlet</p>
</li>
<li><p><code>HandlerMapping</code></p>
<p>处理器映射器（简称映射器）。DispatcherServlet接收到客户端请求的URL之后,根据一定的匹配规则,再把请求转发给对应的Handler,这个匹配规则由<code>HandlerMapping</code>决定</p>
</li>
<li><p><code>HandlerAdaptor</code></p>
<p>处理器适配器（简称适配器）。用来适配每一个要执行的Handler对象。通过HandlerAdapter可以支持任意的类作为处理器。作用是告诉SpringMVC框架，将来需要调用Controller中的哪一个方法。</p>
</li>
<li><p><code>ViewResolver</code></p>
<p>视图解析器（简称解析器）。Controller/Headler返回的是逻辑视图名,需要有一个解析器能够将逻辑视图名转换成实际的物理视图。例如，Controller中返回的逻辑视图名字为”hello”，解析器可以给这个逻辑视图名转换为真正的物理视图名，例如加入前缀和后缀：/WEB-INF/jsp/hello.jsp</p>
<p>SpringMVC的可扩展性，决定了视图可以有很多种,所以不同的情况下需要不同的视图解析器，例如使用jsp充当视图的时候，就需要使用专门的jsp解析器</p>
</li>
</ul>
<p>当一个请求进来之前，SpringMVC中的核心组件会一起配合来完成本次请求的处理：</p>
<ol>
<li>请求被前端控制器（DispatcherServlet）接收到</li>
<li>前端控制器（DispatcherServlet）根据映射器（HandlerMapping）中配置的映射关系，将这个请求转交给真正能够处理客户端请求的处理器（Controller/Headler）</li>
<li>处理器（Controller/Headler）通过适配器（HandlerAdaptor），执行指定方法进行处理，完成后返回给用户ModelAndView（模型和视图的结合体）</li>
<li>视图解析器（ViewResolver）根据ModelAndView中的逻辑视图名找到真正的物理视图</li>
<li>使用ModelAndView中的模型对视图进行渲染</li>
</ol>
<p>如图1：</p>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/SpringMVC_work_flow.png" alt="SpringMVC_work_flow"></p>
<p>如图2：</p>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201109102752002.png" alt="image-20201109102752002"></p>
<p>如图3：</p>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201109102819924.png" alt="image-20201109102819924"></p>
<blockquote>
<p>注意，以上三个图形，描述的都是同一件事情，就是SpringMVC如何处理一个请求</p>
</blockquote>
<h2 id="3-项目搭建"><a href="#3-项目搭建" class="headerlink" title="3 项目搭建"></a>3 项目搭建</h2><h3 id="3-1-步骤"><a href="#3-1-步骤" class="headerlink" title="3.1 步骤"></a>3.1 步骤</h3><p>SpringMVC框架在web项目中搭建并配置，可以分为如下几步（核心）：</p>
<ol>
<li>构建Web项目</li>
<li>导入所需jar包</li>
<li>配置前端控制器<code>DispatcherServlet</code></li>
<li>编写<code>Controller</code>控制器(也称为<code>Handler</code>处理器)</li>
<li>配置处理器映射器(可省去,有默认配置)</li>
<li>配置处理器适配器(可省去,有默认配置)</li>
<li>配置视图解析器(可省去,有默认配置,但是前缀和后缀都为””)</li>
<li>配置控制器/处理器</li>
</ol>
<h3 id="3-2-详解"><a href="#3-2-详解" class="headerlink" title="3.2 详解"></a>3.2 详解</h3><p>1、构建Web项目</p>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201109104110885.png" alt="image-20201109104110885"></p>
<p>2、导入所需的jar包</p>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201109113631374.png" alt="image-20201109113631374"></p>
<p>3、配置前端控制器<code>DispatcherServlet</code></p>
<p>SpringMVC的前端控制器就是一个Servlet对象,继承自HttpServlet,所以需要在web.xml文件中配置。</p>
<p>例如，</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>SpringMVC<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>SpringMVC<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--这里将url设置为*.action代表拦截所有以.action结尾的请求--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.action<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，框架会自动去当前应用的WEB-INF目录下查找名字为SpringMVC-servlet.xml文件(默认前缀和<code>&lt;servlet-name&gt;</code>标签中的值一致)。</p>
</blockquote>
<p>SpringMVC是Spring提供的一个模块,Spring所有的模块都是基于Spring IOC功能的。</p>
<p>所以SpringMVC的DispatcherServlet对象在初始化之前也会去实例化Spring的容器对象（ApplicationContext）,那么就需要读取Spring的配置文件。</p>
<p>默认SpringMVC会在web应用的WEB-INF目录下查找一个名字为[servlet-name]-servlet.xml文件,并且创建在这个文件中定义的bean对象。</p>
<p>如果你提供的spring配置文件的名字或者位置和默认的不同,那么需要在配置servlet时同时指定配置文件的位置。</p>
<p>例如，读取classpath下面的spring-web-mvc.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>SpringMVC<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring-web-mvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>SpringMVC<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.action<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>





<p>例如，读取WEB-INF下面的spring-web-mvc.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>SpringMVC<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>/WEB-INF/spring-web-mvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>SpringMVC<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.action<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>最后如图：</p>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201109105611267.png" alt="image-20201109105611267"></p>
<p>文件内容：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line">   </span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>4、编写处理器(Handler/Controller)</p>
<p>处理器（Handler），也可以叫控制器（Controller），是用来接收并且处理用户请求的。</p>
<p>它是MVC中的部分C,因为此处的控制器主要负责功能处理部分：</p>
<ul>
<li>收集、验证请求参数并封装到对象上</li>
<li>将对象交给业务层,由业务对象处理并返回模型数据</li>
<li>返回ModelAndView(Model部分是业务层返回的模型数据,View部分为逻辑视图名)</li>
</ul>
<p>前端控制器(DispatcherServlet)主要负责整体的控制流程的调度部分：</p>
<ul>
<li>负责将请求委托给控制器进行处理（Handler/Controller）</li>
<li>根据控制器返回的逻辑视图名选择具体的视图进行渲染(并把模型数据传入)</li>
</ul>
<p>因此MVC中完整的C(包含控制逻辑+功能处理)由(DispatcherServlet + Controller)组成</p>
<p><code>org.springframework.web.servlet.mvc.Controller</code>接口</p>
<ul>
<li>只有一个抽象方法：<code>ModelAndView handleRequest(HttpServletRequest request, HttpServletResponse response) throws Exception</code></li>
<li>方法中接收两个参数,分别对应Servlet对象中的request,response对象。可以从request中获取客户端提交过来的请求参数。</li>
<li>返回值ModelAndView,既包含要返回给客户端浏览器的逻辑视图又包含要对视图进行渲染的数据模型。</li>
</ul>
<p>例如，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.mvc.Controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> <span class="keyword">implements</span> <span class="title">Controller</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ModelAndView <span class="title">handleRequest</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		</span><br><span class="line">		String name = request.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//ModelAndView对象中包括了要返回的逻辑视图,以及数据模型</span></span><br><span class="line">		ModelAndView mv = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//设置逻辑视图名称</span></span><br><span class="line">		mv.setViewName(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">		<span class="comment">//设置数据模型</span></span><br><span class="line">		mv.addObject(<span class="string">&quot;name&quot;</span>, name);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> mv;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>5、配置映射器(可省去,有默认配置)</p>
<p>Spring容器需要根据映射器来将用户提交的请求url和后台Controller/Handler进行绑定,所以需要配置映射器</p>
<p>例如，</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line">   </span><br><span class="line">	<span class="comment">&lt;!-- 配置映射器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping&quot;</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，该映射器表示将请求的URL和Bean名字映射,如URL为 “/hello”,则Spring配置文件必须有一个名字为”/hello”的Bean.</p>
</blockquote>
<p>6、配置适配器(可省去,有默认配置)</p>
<p>想要正确运行自定义处理器，需要配置处理器适配器，适配器的作用就是适配并调用处理器中的方法。</p>
<p>例如，</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line">   </span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置映射器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping&quot;</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置适配器--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter&quot;</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>查看<code>SimpleControllerHandlerAdapter</code>源代码，就可以指定它的作用了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.web.servlet.mvc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.lang.Nullable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerAdapter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleControllerHandlerAdapter</span> <span class="keyword">implements</span> <span class="title">HandlerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supports</span><span class="params">(Object handler)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (handler <span class="keyword">instanceof</span> Controller);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="meta">@Nullable</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ModelAndView <span class="title">handle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> ((Controller) handler).handleRequest(request, response);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getLastModified</span><span class="params">(HttpServletRequest request, Object handler)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (handler <span class="keyword">instanceof</span> LastModified) &#123;</span><br><span class="line">			<span class="keyword">return</span> ((LastModified) handler).getLastModified(request);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> -<span class="number">1L</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>7、配置视图解析器(可省去,有默认配置,但是前缀和后缀都为””)</p>
<p>当处理器执行完成后,返回给spring容器一个ModelAndView对象,这个对象需要能够被解析成与之相对应的视图,并且使用返回的Model数据对视图进行渲染。</p>
<p>例如，</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line">   </span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置映射器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping&quot;</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置适配器--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter&quot;</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置视图解析器--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span>  </span><br><span class="line">		<span class="comment">&lt;!-- 设置生成的视图的类型，如果是jsp的话，必须要引入jstl-1.2.jar --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;viewClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;org.springframework.web.servlet.view.JstlView&quot;</span>/&gt;</span> </span><br><span class="line">		<span class="comment">&lt;!-- 设置视图前缀 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/jsp/&quot;</span>/&gt;</span>  </span><br><span class="line">		<span class="comment">&lt;!-- 设置视图后缀 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>/&gt;</span>  </span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span> </span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，使用jsp的话，项目中必须要引入jstl-1.2.jar</p>
</blockquote>
<p>其中：</p>
<ul>
<li><p>InternalResourceViewResolver：用于支持Servlet、JSP视图解析</p>
</li>
<li><p>viewClass：JstlView表示JSP模板页面需要使用JSTL标签库,classpath中必须包含jstl的相关jar包</p>
</li>
<li><p>prefix和suffix：视图页面的前缀和后缀(前缀+逻辑视图名+后缀)</p>
<p>例如，传进来的逻辑视图名为hello,则该该jsp视图页面应该存放在”WEB-INF/jsp/hello.jsp”</p>
</li>
</ul>
<p>8、配置处理器（必须）</p>
<p>前面我们已经编写好了处理器（HelloController），想让正常工作，还需要将其配置到Spring容器中。</p>
<p>例如，</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line">   </span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置映射器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping&quot;</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置适配器--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter&quot;</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置视图解析器--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span>  </span><br><span class="line">		<span class="comment">&lt;!-- 设置生成的视图的类型 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;viewClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;org.springframework.web.servlet.view.JstlView&quot;</span>/&gt;</span> </span><br><span class="line">		<span class="comment">&lt;!-- 设置视图前缀 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/jsp/&quot;</span>/&gt;</span>  </span><br><span class="line">		<span class="comment">&lt;!-- 设置视图后缀 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>/&gt;</span>  </span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span> </span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置处理器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;/hello.action&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.web.controller.HelloController&quot;</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>9、配置日志文件log4j.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">log4j.rootLogger</span>=<span class="string">INFO, stdout </span></span><br><span class="line"><span class="meta">log4j.appender.stdout</span>=<span class="string">org.apache.log4j.ConsoleAppender </span></span><br><span class="line"><span class="meta">log4j.appender.stdout.layout</span>=<span class="string">org.apache.log4j.PatternLayout </span></span><br><span class="line"><span class="meta">log4j.appender.stdout.layout.ConversionPattern</span>=<span class="string">%d [%-5p] %c - %m%n</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，如果要看详细的启动或访问日志，可以将级别设置为<code>DEBUG</code></p>
</blockquote>
<p>10、WEB-INF/jsp中新建hello.jsp文件</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> contentType=<span class="string">&quot;text/html; charset=UTF-8&quot;</span></span><br><span class="line">    pageEncoding=<span class="string">&quot;UTF-8&quot;</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">&lt;title&gt;hello&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;h1&gt;hello!$&#123;name&#125;&lt;/h1&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>



<p>11、将项目的ContextPath设为/</p>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201109112633525.png" alt="image-20201109112633525"></p>
<p>12、部署、运行、访问</p>
<p>通过URL地址，访问Controller</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:8989/hello.action?name=tom">http://127.0.0.1:8989/hello.action?name=tom</a></p>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201109113900584.png" alt="image-20201109113900584"></p>
<h3 id="3-3-流程"><a href="#3-3-流程" class="headerlink" title="3.3 流程"></a>3.3 流程</h3><p>以上整个访问的流程为：</p>
<ol>
<li>首先用户发送请求,前端控制器DispatcherServlet收到请求后自己不进行处理，而是委托给其他的Controller进行处理，前端控制器作为统一访问点，进行全局的流程控制</li>
<li>DispatcherServlet把请求转交给HandlerMapping， HandlerMapping将会把请求映射为HandlerExecutionChain对象(包含一个Handler处理器对象、多个HandlerInterceptor拦截器)对象</li>
<li>DispatcherServlet再把请求转交给HandlerAdapter，HandlerAdapter将会把处理器包装为适配器，从而支持多种类型的处理器。简单点说就是让我们知道接下来应该调用Handler处理器里面的什么方法</li>
<li>HandlerAdapter将会根据适配的结果调用真正的处理器的功能处理方法，完成功能处理；并返回一个ModelAndView对象（包含模型数据、逻辑视图名）</li>
<li>ModelAndView的逻辑视图名交给ViewResolver解析器， ViewResolver解析器把逻辑视图名解析为具体的View，通过这种策略模式，很容易更换其他视图技术</li>
<li>View会根据传进来的Model模型数据进行渲染，此处的Model实际是一个Map数据结构，因此很容易支持其他视图技术</li>
<li>最后返回到DispatcherServlet，由DispatcherServlet返回响应给用户，到此一个流程结束</li>
</ol>
<h3 id="3-4-默认"><a href="#3-4-默认" class="headerlink" title="3.4 默认"></a>3.4 默认</h3><p>Spring配置文件中的处理器适配器，处理器映射器，视图解析器等都的配置都可以省略，都有默认配置。</p>
<p>默认配置在spring-webmvc-x.x.x.RELEASE.jar中的<code>org.springframework.web.servlet</code>包下的<code>DispatcherServlet.properties</code>文件中：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Default implementation classes for DispatcherServlet&#x27;s strategy interfaces.</span></span><br><span class="line"><span class="comment"># Used as fallback when no matching beans are found in the DispatcherServlet context.</span></span><br><span class="line"><span class="comment"># Not meant to be customized by application developers.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">org.springframework.web.servlet.LocaleResolver</span>=<span class="string">org.springframework.web.servlet.i18n.AcceptHeaderLocaleResolver</span></span><br><span class="line"></span><br><span class="line"><span class="meta">org.springframework.web.servlet.ThemeResolver</span>=<span class="string">org.springframework.web.servlet.theme.FixedThemeResolver</span></span><br><span class="line"></span><br><span class="line"><span class="meta">org.springframework.web.servlet.HandlerMapping</span>=<span class="string">org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping,\</span></span><br><span class="line"><span class="string">	org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping</span></span><br><span class="line"></span><br><span class="line"><span class="meta">org.springframework.web.servlet.HandlerAdapter</span>=<span class="string">org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter,\</span></span><br><span class="line"><span class="string">	org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter,\</span></span><br><span class="line"><span class="string">	org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter</span></span><br><span class="line"></span><br><span class="line"><span class="meta">org.springframework.web.servlet.HandlerExceptionResolver</span>=<span class="string">org.springframework.web.servlet.mvc.method.annotation.ExceptionHandlerExceptionResolver,\</span></span><br><span class="line"><span class="string">	org.springframework.web.servlet.mvc.annotation.ResponseStatusExceptionResolver,\</span></span><br><span class="line"><span class="string">	org.springframework.web.servlet.mvc.support.DefaultHandlerExceptionResolver</span></span><br><span class="line"></span><br><span class="line"><span class="meta">org.springframework.web.servlet.RequestToViewNameTranslator</span>=<span class="string">org.springframework.web.servlet.view.DefaultRequestToViewNameTranslator</span></span><br><span class="line"></span><br><span class="line"><span class="meta">org.springframework.web.servlet.ViewResolver</span>=<span class="string">org.springframework.web.servlet.view.InternalResourceViewResolver</span></span><br><span class="line"></span><br><span class="line"><span class="meta">org.springframework.web.servlet.FlashMapManager</span>=<span class="string">org.springframework.web.servlet.support.SessionFlashMapManager</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>可以看出，这里已经给出了默认的配置的，如果使用这些默认的配置，那么在自己的xml中就不用配置了</p>
</blockquote>
<blockquote>
<p>注意，如果视图解析器没有配置的话，那么默认的前缀和后缀都是空（””）</p>
</blockquote>
<h3 id="3-5-映射"><a href="#3-5-映射" class="headerlink" title="3.5 映射"></a>3.5 映射</h3><p>DispatcherServlet中的映射路径，可以设置为多种情况</p>
<p>例如，</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>SpringMVC<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>SpringMVC<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>1、拦截所有请求</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>此处需要特别强调的是,配置中使用的是/,而不是/*</p>
<p>如果使用/*,那么请求时可以通过DispatcherServlet转发到相应的Controller中,但是Controller返回的时候,如返回的jsp还会再次被拦截,这样导致404错误,即访问不到jsp</p>
<p>同时，这种情况，也会导致静态文件（jpg,js,css）被拦截后不能正常显示</p>
<p>例如，</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;/static/css/hello.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>





<p>2、自定义拦截请求的后缀名</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.action<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这是最传统的方式,最简单也最实用。不会导致静态文件（jpg,js,css）被拦截。</p>
<p>但是Controller的后缀只能固定成某一种</p>
<blockquote>
<p>注意，将在使用的时候，大多数情况会使用第一种方式，也就是前端控制器的映射配置配置为<code>/</code></p>
</blockquote>
<h3 id="3-6-静态"><a href="#3-6-静态" class="headerlink" title="3.6 静态"></a>3.6 静态</h3><p>如果DispatcherServlet拦截<code>*.do</code>这样的有后缀的URL,就不存在访问不到静态资源的问题。<br>如果DispatcherServlet拦截<code>/</code>,拦截了所有的请求,那么同时对静态文件的访问也就被拦截了</p>
<p>例如，这些静态资源就会被拦截，无法访问</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;static/css/hello.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;static/js/hello.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">alt</span>=<span class="string">&quot;none&quot;</span> <span class="attr">src</span>=<span class="string">&quot;static/images/logo.png&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>解决方式一：利用Tomcat的defaultServlet来处理静态文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>default<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.jpg<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>default<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.js<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>default<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.css<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>特点：</p>
<ul>
<li>要配置多个，每种静态资源配置一个映射</li>
<li>要写在DispatcherServlet的前面(和tomcat版本有关),让defaultServlet先拦截请求</li>
<li>高性能</li>
</ul>
<p>解决方式二: 使用<code>&lt;mvc:resources&gt;</code>标签，配置静态资源不被拦截</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;</span>&gt;</span></span><br><span class="line">   </span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置映射器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping&quot;</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置适配器--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter&quot;</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置视图解析器--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span>  </span><br><span class="line">		<span class="comment">&lt;!-- 设置生成的视图的类型 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;viewClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;org.springframework.web.servlet.view.JstlView&quot;</span>/&gt;</span>  </span><br><span class="line">		<span class="comment">&lt;!-- 设置视图前缀 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/jsp/&quot;</span>/&gt;</span>  </span><br><span class="line">		<span class="comment">&lt;!-- 设置视图后缀 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>/&gt;</span>  </span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span> </span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置处理器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;/hello.action&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.web.controller.HelloController&quot;</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">&quot;/static/images/**&quot;</span> <span class="attr">location</span>=<span class="string">&quot;/static/images/&quot;</span>/&gt;</span>  </span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">&quot;/static/js/**&quot;</span> <span class="attr">location</span>=<span class="string">&quot;/static/js/&quot;</span>/&gt;</span>  </span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">&quot;/static/css/**&quot;</span> <span class="attr">location</span>=<span class="string">&quot;/static/css/&quot;</span>/&gt;</span> </span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>其中：</p>
<ul>
<li><code>location</code>：是静态资源的位置</li>
<li><code>mapping</code>： 映射地址，两个*,表示映射指定路径下所有的URL,包括子路径</li>
</ul>
<blockquote>
<p>这种方式可以指定哪些静态资源不会被拦截</p>
</blockquote>
<blockquote>
<p>注意，xml中头部声明中，mvc命名空间和schame文件的引入</p>
</blockquote>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201109121327178.png" alt="image-20201109121327178"></p>
<p>解决方式三: 使用<code>&lt;mvc:default-servlet-handler/&gt;</code>标签</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;</span>&gt;</span></span><br><span class="line">   </span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置映射器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping&quot;</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置适配器--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter&quot;</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置视图解析器--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span>  </span><br><span class="line">		<span class="comment">&lt;!-- 设置生成的视图的类型 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;viewClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;org.springframework.web.servlet.view.JstlView&quot;</span>/&gt;</span>  </span><br><span class="line">		<span class="comment">&lt;!-- 设置视图前缀 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/jsp/&quot;</span>/&gt;</span>  </span><br><span class="line">		<span class="comment">&lt;!-- 设置视图后缀 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>/&gt;</span>  </span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span> </span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置处理器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;/hello.action&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.web.controller.HelloController&quot;</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>这种方式是最简单的配置方法，SpringMVC也是让tomcat中默认的servlet对静态资源进行处理</p>
</blockquote>
<h3 id="3-7-编码"><a href="#3-7-编码" class="headerlink" title="3.7 编码"></a>3.7 编码</h3><p>SpringMVC中，提供了一个编码过滤器<code>org.springframework.web.filter.CharacterEncodingFilter</code>，配置后，可以设置请求中的编码，之前我们都是自己手动写一个编码过滤器，然后进行配置。</p>
<p>现在直接使用SpringMVC提供的编码过滤器，也能完成同样的功能。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="3-8-特殊"><a href="#3-8-特殊" class="headerlink" title="3.8 特殊"></a>3.8 特殊</h3><p>如果想直接在处理器/控制器里使用response向客户端写回数据,可以通过返回<code>null</code>，来告诉DispatcherServlet我们已经写出响应了,不需要它进行视图解析。</p>
<p>例如，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.mvc.Controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> <span class="keyword">implements</span> <span class="title">Controller</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ModelAndView <span class="title">handleRequest</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		</span><br><span class="line">		response.getWriter().write(<span class="string">&quot;Hello World!!&quot;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="4-适配器"><a href="#4-适配器" class="headerlink" title="4 适配器"></a>4 适配器</h2><p>一般情况下,<code>SimpleControllerHandlerAdapter</code>会是我们常用的适配器,也是SpringMVC中默认的适配器,该适配器中的主要代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleControllerHandlerAdapter</span> <span class="keyword">implements</span> <span class="title">HandlerAdapter</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supports</span><span class="params">(Object handler)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (handler <span class="keyword">instanceof</span> Controller);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">handle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ((Controller) handler).handleRequest(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从代码中可以看出,它首先会判断我们的handler是否实现了Controller接口,如果实现了,那么会调用Controller接口中的handleRequest方法。</p>
<p>那么根据这种方式能看出,我们也可以有自己的适配器的实现,那么就可以让任意类成为SpringMVC中的handler了,无论我们的类是否实现了Controller接口</p>
<p>例如</p>
<p>1、自定义处理器接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.adapter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MyHandler</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> ModelAndView <span class="title">handler_test</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span><span class="keyword">throws</span> Exception</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>2、自定义适配器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.adapter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerAdapter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyHandlerAdapter</span> <span class="keyword">implements</span> <span class="title">HandlerAdapter</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supports</span><span class="params">(Object handler)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (handler <span class="keyword">instanceof</span> MyHandler);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">handle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ((MyHandler)handler).handler_test(request, response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getLastModified</span><span class="params">(HttpServletRequest request, Object handler)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1L</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>3、编写直接的处理器/控制器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.web.adapter.MyHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyController</span> <span class="keyword">implements</span> <span class="title">MyHandler</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ModelAndView <span class="title">handler_test</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		String name = request.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">		ModelAndView mv = <span class="keyword">new</span> ModelAndView(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">		mv.addObject(<span class="string">&quot;name&quot;</span>, name);</span><br><span class="line">		<span class="keyword">return</span> mv;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>4、配置xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;</span>&gt;</span></span><br><span class="line">   </span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置映射器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping&quot;</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置适配器--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.web.adapter.MyHandlerAdapter&quot;</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置视图解析器--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span>  </span><br><span class="line">		<span class="comment">&lt;!-- 设置生成的视图的类型 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;viewClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;org.springframework.web.servlet.view.JstlView&quot;</span>/&gt;</span> </span><br><span class="line">		<span class="comment">&lt;!-- 设置视图前缀 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/jsp/&quot;</span>/&gt;</span>  </span><br><span class="line">		<span class="comment">&lt;!-- 设置视图后缀 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>/&gt;</span>  </span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span> </span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置处理器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;/hello&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.web.controller.HelloController&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;/test&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.web.controller.MyController&quot;</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这里比之前添加了直接的适配器和处理器的配置</p>
</blockquote>
<p>5、部署、启动、运行</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:8989/test?name=mary">http://127.0.0.1:8989/test?name=mary</a></p>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201109123413206.png" alt="image-20201109123413206"></p>
<p>==思考，如果使用自定义注解，是否可以完成以上同样的功能?==</p>
<h2 id="5-拦截器"><a href="#5-拦截器" class="headerlink" title="5 拦截器"></a>5 拦截器</h2><blockquote>
<p>SpringMVC的拦截器类似于Servlet 开发中的过滤器Filter,用于对处理器进行预处理和后处理</p>
</blockquote>
<h3 id="5-1-场景"><a href="#5-1-场景" class="headerlink" title="5.1 场景"></a>5.1 场景</h3><p>SpringMVC中的拦截器（Interceptor），应用的场景有：</p>
<ul>
<li>日志记录</li>
<li>权限检查</li>
<li>性能监控</li>
<li>通用行为</li>
</ul>
<h3 id="5-2-接口"><a href="#5-2-接口" class="headerlink" title="5.2 接口"></a>5.2 接口</h3><p>拦截器接口为：<code>org.springframework.web.servlet.HandlerInterceptor</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.lang.Nullable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.method.HandlerMethod;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">default</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler,</span></span></span><br><span class="line"><span class="params"><span class="function">			<span class="meta">@Nullable</span> ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler,</span></span></span><br><span class="line"><span class="params"><span class="function">			<span class="meta">@Nullable</span> Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>其中：</p>
<ul>
<li><p><code>preHandle</code></p>
<p>预处理回调方法，实现处理器的预处理，第三个参数为的处理器(本次请求要访问的那个Controller)<br>返回值:</p>
<ul>
<li>true表示继续流程，也就是将请求放行(如调有下一个拦截器或处理器)        </li>
<li>false表示流程中断，此时需要通过response来产生响应</li>
</ul>
</li>
<li><p><code>postHandle</code></p>
<p>后处理回调方法，实现处理器的后处理(但在渲染视图之前),此时我们可以通过modelAndView对模型数据进行处理或对视图进行处理,modelAndView也可能为null</p>
</li>
<li><p><code>afterCompletion</code></p>
<p>整个请求处理完毕回调方法,即在视图渲染完毕时回调</p>
</li>
</ul>
<blockquote>
<p>注意，使用拦截器，可以在处理器（Handler/Controller）中的方法执行之前或之后，添加额外代码功能，这个效果就是使用代理对象完成的AOP功能</p>
</blockquote>
<h3 id="5-3-适配"><a href="#5-3-适配" class="headerlink" title="5.3 适配"></a>5.3 适配</h3><p>有时候，我们可能只需要实现三个回调方法中的某一个,但是如果实现<code>HandlerInterceptor</code> 接口的话,三个方法必须实现（JDK1.8之前）。</p>
<p>Spring 提供了一个<code>HandlerInterceptorAdapter</code> 适配器,允许我们只实现需要的回调方法。</p>
<p>在<code>HandlerInterceptorAdapter</code>中,对<code>HandlerInterceptor</code> 接口中的三个方法都进行了空实现,其中preHandle方法的返回值,默认是true</p>
<p>适配器源码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.web.servlet.handler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.lang.Nullable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.AsyncHandlerInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">HandlerInterceptorAdapter</span> <span class="keyword">implements</span> <span class="title">AsyncHandlerInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * This implementation always returns &#123;<span class="doctag">@code</span> true&#125;.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * This implementation is empty.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler,</span></span></span><br><span class="line"><span class="params"><span class="function">			<span class="meta">@Nullable</span> ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * This implementation is empty.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler,</span></span></span><br><span class="line"><span class="params"><span class="function">			<span class="meta">@Nullable</span> Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * This implementation is empty.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterConcurrentHandlingStarted</span><span class="params">(HttpServletRequest request, HttpServletResponse response,</span></span></span><br><span class="line"><span class="params"><span class="function">			Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="5-4-测试"><a href="#5-4-测试" class="headerlink" title="5.4 测试"></a>5.4 测试</h3><p>自定义拦截器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.handler.HandlerInterceptorAdapter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInterceptor</span> <span class="keyword">extends</span> <span class="title">HandlerInterceptorAdapter</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;MyInterceptor preHandle&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler,</span></span></span><br><span class="line"><span class="params"><span class="function">			ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;MyInterceptor postHandle&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;MyInterceptor afterCompletion&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;</span>&gt;</span></span><br><span class="line">   	</span><br><span class="line">   	<span class="comment">&lt;!-- 配置拦截器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;myInterceptor&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.web.interceptor.MyInterceptor&quot;</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置映射器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping&quot;</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 注入拦截器，可以有多个 --&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 将来使用该映射器的请求，都会被指定拦截器拦截 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;interceptors&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;myInterceptor&quot;</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置适配器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.web.adapter.MyHandlerAdapter&quot;</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置视图解析器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span>  </span><br><span class="line">		<span class="comment">&lt;!-- 设置生成的视图的类型 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;viewClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;org.springframework.web.servlet.view.JstlView&quot;</span>/&gt;</span>  </span><br><span class="line">		<span class="comment">&lt;!-- 设置视图前缀 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/jsp/&quot;</span>/&gt;</span>  </span><br><span class="line">		<span class="comment">&lt;!-- 设置视图后缀 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>/&gt;</span>  </span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span> </span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置处理器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;/hello&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.web.controller.HelloController&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;/test&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.web.controller.MyController&quot;</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>这里比之前添加的配置为：</p>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201109133021970.png" alt="image-20201109133021970"></p>
<p>此时，访问一个Controller，</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:8989/test?name=mary">http://127.0.0.1:8989/test?name=mary</a></p>
<p>控制台输出结果：</p>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201109132630599.png" alt="image-20201109132630599"></p>
<h3 id="5-5-标签"><a href="#5-5-标签" class="headerlink" title="5.5 标签"></a>5.5 标签</h3><p>SpringMVC中，还专门提供了一个标签，来进行拦截器的配置</p>
<p>例如，</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;</span>&gt;</span></span><br><span class="line">   	</span><br><span class="line">   	<span class="comment">&lt;!-- 配置拦截器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;myInterceptor&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.web.interceptor.MyInterceptor&quot;</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 使用专门的mvc标签配置拦截器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 指定需要拦截的请求路径 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">&quot;/**&quot;</span>/&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 指定不进行拦截的请求路径 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">mvc:exclude-mapping</span> <span class="attr">path</span>=<span class="string">&quot;/test&quot;</span>/&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 指定拦截器对象 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;myInterceptor&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置映射器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping&quot;</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置适配器--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.web.adapter.MyHandlerAdapter&quot;</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置视图解析器--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span>  </span><br><span class="line">		<span class="comment">&lt;!-- 设置生成的视图的类型 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;viewClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;org.springframework.web.servlet.view.JstlView&quot;</span>/&gt;</span>  </span><br><span class="line">		<span class="comment">&lt;!-- 设置视图前缀 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/jsp/&quot;</span>/&gt;</span>  </span><br><span class="line">		<span class="comment">&lt;!-- 设置视图后缀 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>/&gt;</span>  </span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span> </span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置处理器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;/hello&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.web.controller.HelloController&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;/test&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.web.controller.MyController&quot;</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这里配置的/**，表示通配，指定路径和子路径</p>
</blockquote>
<blockquote>
<p>注意，推荐使用这种方式进行拦截器的配置</p>
</blockquote>
<h3 id="5-6-单例"><a href="#5-6-单例" class="headerlink" title="5.6 单例"></a>5.6 单例</h3><blockquote>
<p>SpringMVC中的拦截器是单例，因此不管多少用户请求多少次，都只有一个拦截器实现，即非线程安全</p>
</blockquote>
<p>所以在必要时，可以在拦截器中使用ThreadLocal,它是和线程绑定,一个线程一个ThreadLocal。</p>
<p>例如，A 线程中只能看到A线程的ThreadLocal,不能看到B线程的ThreadLocal。那么将值存到ThreadLocal中，那么一个线程在执行期间，就知道能拿到自己线程中的ThreadLocal里面的值了</p>
<p>例如，记录执行Controller所用时间</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.handler.HandlerInterceptorAdapter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TimeInterceptor</span> <span class="keyword">extends</span> <span class="title">HandlerInterceptorAdapter</span></span>&#123;</span><br><span class="line">	<span class="comment">//拦截器是单例,不是线程安全的,所以这里使用ThreadLocal</span></span><br><span class="line">	<span class="keyword">private</span> ThreadLocal&lt;Long&gt; local = <span class="keyword">new</span> ThreadLocal&lt;&gt;();</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">		local.set(start);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line">		System.out.println(<span class="string">&quot;共耗时:&quot;</span>+(end-local.get()));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>配置文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;</span>&gt;</span></span><br><span class="line">   	</span><br><span class="line">   	<span class="comment">&lt;!-- 配置拦截器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;timeInterceptor&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.web.interceptor.TimeInterceptor&quot;</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 使用专门的mvc标签配置拦截器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 指定需要拦截的请求路径 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">&quot;/test&quot;</span>/&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 指定拦截器对象 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;timeInterceptor&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置映射器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping&quot;</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置适配器--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.web.adapter.MyHandlerAdapter&quot;</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置视图解析器--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span>  </span><br><span class="line">		<span class="comment">&lt;!-- 设置生成的视图的类型 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;viewClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;org.springframework.web.servlet.view.JstlView&quot;</span>/&gt;</span>  </span><br><span class="line">		<span class="comment">&lt;!-- 设置视图前缀 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/jsp/&quot;</span>/&gt;</span>  </span><br><span class="line">		<span class="comment">&lt;!-- 设置视图后缀 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>/&gt;</span>  </span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span> </span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置处理器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;/hello&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.web.controller.HelloController&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;/test&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.web.controller.MyController&quot;</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>测试：</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:8989/test?name=mary">http://127.0.0.1:8989/test?name=mary</a></p>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201109134132437.png" alt="image-20201109134132437"></p>
<h3 id="5-7-区别"><a href="#5-7-区别" class="headerlink" title="5.7 区别"></a>5.7 区别</h3><p>Servlet中的<code>Filter</code>和SpringMVC中的<code>Interceptor</code>的区别：</p>
<ul>
<li>二者都可用于对处理器进行预处理和后处理</li>
<li><code>Filter</code>是servlet中的组件，任何Java web工程都可以使用</li>
<li><code>Interceptor</code>是属于SpringMVC的，只有使用了SpringMVC框架的工程才能使用</li>
<li><code>Filter</code>可以拦截任意资源路径，也包括SpringMVC中的Controller</li>
<li><code>Interceptor</code>只能拦截SpringMVC中的Controller</li>
</ul>
<h1 id="springmvc-二"><a href="#springmvc-二" class="headerlink" title="springmvc(二)"></a>springmvc(二)</h1><h2 id="1-注解配置"><a href="#1-注解配置" class="headerlink" title="1 注解配置"></a>1 注解配置</h2><p>在实际的项目中，我们更多的会使用注解的方式，来对Controller进行配置，一般情况下，使用俩个注解就可以完成Controller的配置：</p>
<ul>
<li><code>@Controller</code></li>
<li><code>@RequestMapping</code></li>
</ul>
<h3 id="1-1-Controller"><a href="#1-1-Controller" class="headerlink" title="1.1 @Controller"></a>1.1 @Controller</h3><p>使用注解后，就不需要再实现特定的接口，任意一个类都可以当做处理器。</p>
<p>例如，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>让spring在启动的时候，读取新的配置文件：spring-web-mvc-annotation.xml</p>
<p>web.xml文件配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">version</span>=<span class="string">&quot;3.1&quot;</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">	        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">	        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">	        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">	        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>SpringMVC<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">	        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 指定springmvc在项目启动时，读取新的配置文件 --&gt;</span></span><br><span class="line">	        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring-web-mvc-annotation.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>SpringMVC<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这里修改了新的配置文件的名称，spring-web-mvc-annotation.xml</p>
</blockquote>
<p>使用<code>@Controller</code>后，TestController就成为了SpringIOC容器中的bean对象了，但是需要我们在xml中，指定Spring扫描的包路径，这样Spring就可以找到TestController类上面的注解了。</p>
<p>同时，需要开启springmvc注解功能的支持</p>
<p>spring-web-mvc-annotation.xml文件配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;</span>&gt;</span></span><br><span class="line">   	</span><br><span class="line">    <span class="comment">&lt;!-- 指定spring扫描的包路径 --&gt;</span></span><br><span class="line">   	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.briup.web.controller&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 开启springmvc的注解功能 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置视图解析器--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span>  </span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;viewClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;org.springframework.web.servlet.view.JstlView&quot;</span>/&gt;</span>  </span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/jsp/&quot;</span>/&gt;</span>  </span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>/&gt;</span>  </span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span> </span><br><span class="line">	</span><br><span class="line">    <span class="comment">&lt;!-- 配置静态资源不被拦截 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，映射器和适配器，使用默认的配置即可，这里不需要再进行配置</p>
</blockquote>
<blockquote>
<p>注意，<code>&lt;mvc:annotation-driven&gt;</code>必须要配置，以开启springmvc的注解功能</p>
</blockquote>
<h3 id="1-2-RequestMapping"><a href="#1-2-RequestMapping" class="headerlink" title="1.2 @RequestMapping"></a>1.2 @RequestMapping</h3><p><code>@RequestMapping</code>注解，可以指定控制器中的方法和对应的映射路径</p>
<p>例如，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ModelAndView <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">		ModelAndView mv = <span class="keyword">new</span> ModelAndView(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> mv;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，test方法的俩个参数，request和response，如果用不到，可以不写</p>
</blockquote>
<p>部署项目，并启动服务器后，可以正常访问该Controller</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:8989/test">http://127.0.0.1:8989/test</a></p>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201109233816948.png" alt="image-20201109233816948"></p>
<p>Controller中的方法，除了返回<code>ModelAndView</code>之外，还可以返回<code>String</code>，表示返回的逻辑视图名</p>
<p>例如，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ModelAndView <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">		ModelAndView mv = <span class="keyword">new</span> ModelAndView(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> mv;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/test1&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">test1</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，test1方法的返回值”hello”，就是要展示的视图的逻辑视图名</p>
</blockquote>
<p>Controller中的方法，返回值还可以是void，表示不需要前端控制器处理，方法内部就处理本次请求的响应了</p>
<p>例如，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ModelAndView <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">		ModelAndView mv = <span class="keyword">new</span> ModelAndView(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> mv;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/test1&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">test1</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/test2&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">(HttpServletResponse response)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">		response.getWriter().println(<span class="string">&quot;hello world&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>Controller中的方法，如果要接收参数，可以在参数列表中声明request，如果要传值给视图，可以在参数列表中声明model，将数据存放在model中即可</p>
<p>例如，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ModelAndView <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">		ModelAndView mv = <span class="keyword">new</span> ModelAndView(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> mv;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/test1&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">test1</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/test2&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">(HttpServletResponse response)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">		response.getWriter().println(<span class="string">&quot;hello world&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/test3&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">test3</span><span class="params">(HttpServletRequest request, Model model)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">		</span><br><span class="line">		String name = request.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		model.addAttribute(<span class="string">&quot;name&quot;</span>, name);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，request、response、model，这些参数只要声明，就可以直接使用，springmvc在调用的时候会自动注入的，参数的名字和顺序没要求，只要参数的类型正确即可</p>
</blockquote>
<blockquote>
<p>注意，这里的参数model，表示模型，将数据存入后，可以传给视图，并取出显示</p>
</blockquote>
<p>访问地址：<a target="_blank" rel="noopener" href="http://127.0.0.1:8989/test3?name=tom">http://127.0.0.1:8989/test3?name=tom</a></p>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201110000313947.png" alt="image-20201110000313947"></p>
<p><code>@RequestMapping</code>注解，不仅可以用在方法上，还可以用在类上</p>
<p>例如，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/mvc&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ModelAndView <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">		ModelAndView mv = <span class="keyword">new</span> ModelAndView(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> mv;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，此时Controller中所有的映射方法的访问，都会多一个前缀 <code>/mvc</code></p>
</blockquote>
<p>访问地址：<a target="_blank" rel="noopener" href="http://127.0.0.1:8989/mvc/test">http://127.0.0.1:8989/mvc/test</a></p>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201110002635060.png" alt="image-20201110002635060"></p>
<h3 id="1-3-其他"><a href="#1-3-其他" class="headerlink" title="1.3 其他"></a>1.3 其他</h3><p>Spring2.5中，引入注解对Controller进行支持</p>
<ul>
<li>@Controller，用于标识是处理器类</li>
<li>@RequestMapping，请求到处理器功能方法的映射规则</li>
<li>@RequestParam，请求参数到处理器功能处理方法的方法参数上的绑定</li>
<li>@ModelAttribute，请求参数到Model中的绑定</li>
<li>@SessionAttributes，用于声明session级别的数据存储</li>
<li>@InitBinder，自定义数据绑定的注册支持</li>
</ul>
<p>Spring3中，引入了更多的注解，其中包含了对<code>RESTful</code>架构风格的支持</p>
<ul>
<li>@CookieValue，cookie数据到处理器功能处理方法的方法参数上的绑定</li>
<li>@RequestHeader，请求头数据到处理器功能处理方法的方法参数上的绑定</li>
<li>@RequestBody，请求的body体的绑定</li>
<li>@ResponseBody，处理器功能处理方法的返回值作为响应体</li>
<li>@ResponseStatus，定义处理器功能处理方法/异常处理器返回的状态码和原因</li>
<li>@ExceptionHandler，注解式声明异常处理器</li>
<li>@PathVariable，请求URI 中的模板变量部分到处理器功能处理方法的方法参数上的绑定,从而支持<code>RESTful</code>架构风格的URI</li>
</ul>
<p>Spring4以后，引入了的一些注解，简化之前注解的配置</p>
<ul>
<li><p>@RestController</p>
</li>
<li><p>@GetMapping</p>
</li>
<li><p>@PostMapping</p>
</li>
<li><p>@PutMapping</p>
</li>
<li><p>@DeleteMapping</p>
</li>
<li><p>@PatchMapping</p>
</li>
</ul>
<blockquote>
<p>注意，在后面的章节中，会陆续学习和认识到这些注解的使用</p>
</blockquote>
<h2 id="2-请求映射"><a href="#2-请求映射" class="headerlink" title="2 请求映射"></a>2 请求映射</h2><h3 id="2-1-http协议请求"><a href="#2-1-http协议请求" class="headerlink" title="2.1 http协议请求"></a>2.1 http协议请求</h3><p>假设浏览器发送了一个请求如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST /login	HTTP1.1</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,en;q=0.8,zh;q=0.5,en-US;q=0.3</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Cookie: JSESSIONID=DBC6367DEB1C024A836F3EA35FCFD5A2</span><br><span class="line">Host: 127.0.0.1:8989</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:82.0) Gecko/20100101 Firefox/82.0</span><br><span class="line"></span><br><span class="line">username=tom&amp;password=123</span><br></pre></td></tr></table></figure>


<p>http协议的请求格式如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">请求方法 URL 协议版本号</span><br><span class="line">请求头信息</span><br><span class="line">请求头信息</span><br><span class="line">请求头信息</span><br><span class="line">..</span><br><span class="line">回车换行</span><br><span class="line">请求正文</span><br></pre></td></tr></table></figure>



<p>从格式中我们可以看到【请求方法、URL、请求头信息、请求正文】这四部分一般是可变的</p>
<p>因此我们可以把请求中的这些信息在Controller的【功能处理方法】中进行的映射</p>
<p>所有请求的映射分为如下几种：</p>
<ol>
<li><p>URL路径映射</p>
<p>使用URL映射到处理器的功能处理方法</p>
</li>
<li><p>请求方法映射</p>
<p>例如，限定功能处理方法只处理GET请求</p>
</li>
<li><p>请求参数映射</p>
<p>例如，限定只处理包含username参数的请求</p>
</li>
<li><p>请求头映射</p>
<p>例如，限定只处理”Accept=application/json”的请求</p>
</li>
</ol>
<h3 id="2-2-请求路径映射"><a href="#2-2-请求路径映射" class="headerlink" title="2.2 请求路径映射"></a>2.2 请求路径映射</h3><p><strong>1、普通URL路径映射</strong></p>
<p>例如，</p>
<p><code>@RequestMapping(value=&quot;/test&quot;)</code></p>
<p><code>@RequestMapping(&quot;/hello&quot;)</code></p>
<ul>
<li>注解中只出现一个参数且参数名为value的话,可以将参数名去掉</li>
</ul>
<p><code>@RequestMapping(&#123;&quot;/test&quot;, &quot;/user/hello&quot;&#125;)</code></p>
<ul>
<li>多个URL路径可以映射到同一个处理器的功能处理方法</li>
</ul>
<p><strong>2、URI模板模式映射</strong></p>
<p><code>@RequestMapping(value=&quot;/users/&#123;userId&#125;&quot;)</code></p>
<ul>
<li>{userId}占位符, 请求的URL可以是”/users/123456”或”/users/abcd”</li>
<li>之后可以通过@PathVariable可以提取URI模板模式中的{userId}中的值</li>
</ul>
<p><code>@RequestMapping(value=&quot;/users/&#123;userId&#125;/create&quot;) </code></p>
<ul>
<li>这样也是可以的,请求的URL可以是”/users/123/create”</li>
</ul>
<p><code>@RequestMapping(value=&quot;/users/&#123;userId&#125;/topics/&#123;topicId&#125;&quot;)</code></p>
<ul>
<li>这样也是可以的,请求的URL可以是”/users/123/topics/123”</li>
</ul>
<p><strong>3、Ant风格的URL路径映射</strong></p>
<p><code>@RequestMapping(value=&quot;/users/**&quot;)</code></p>
<ul>
<li>可以匹配”/users/abc/123”</li>
<li>**代表该路径及其子路径</li>
<li>但”/users/123”将会被【URI模板模式映射中的”/users/{userId}”模式优先映射到】</li>
</ul>
<p><code>@RequestMapping(value=&quot;/product/?&quot;)</code></p>
<ul>
<li>可匹配”/product/1”或”/product/a”</li>
<li>但不匹配”/product”或”/product/aa”</li>
<li>?代表有且只有一个字符</li>
</ul>
<p><code>@RequestMapping(value=&quot;/product*&quot;)</code></p>
<ul>
<li>可匹配”/productabc”或”/product”</li>
<li>但不匹配”/productabc/abc”</li>
<li>*代表0~n个字符</li>
</ul>
<p><code>@RequestMapping(value=&quot;/product/*&quot;)</code></p>
<ul>
<li>可匹配”/product/abc”</li>
<li>但不匹配”/productabc”</li>
</ul>
<p><code>@RequestMapping(value=&quot;/products/**/&#123;productId&#125;&quot;)</code></p>
<ul>
<li>可匹配”/products/abc/abc/123”或”/products/123”</li>
<li>也就是Ant风格和URI模板变量风格可混用</li>
<li>**代表所有的子路径</li>
</ul>
<p><strong>4、正则表达式风格的URL路径映射</strong></p>
<p>从Spring3.0 开始，支持正则表达式风格的URL路径映射。</p>
<p>格式为{变量名:正则表达式}，然后通过<code>@PathVariable</code>可以提取{XXX:正则表达式}中的XXX这个变量的值。</p>
<p><code>@RequestMapping(value=&quot;/products/&#123;categoryCode:\\d+&#125;-&#123;pageNumber:\\d+&#125;&quot;)</code></p>
<ul>
<li>可以匹配”/products/123-1”</li>
<li>但不能匹配”/products/abc-1”</li>
<li>这样可以设计更加严格的规则</li>
</ul>
<p><code>@RequestMapping(value=&quot;/user/&#123;userId:^\\d&#123;4&#125;-[a-z]&#123;2&#125;$&#125;&quot;)</code></p>
<ul>
<li>可以匹配”/user/1234-ab”</li>
</ul>
<blockquote>
<p>注意，\d表示数字，但是\在java的字符串中是特殊字符，所以需要再加一个\进行转义即可</p>
</blockquote>
<blockquote>
<p>注意，这时候如果接收参数的时候，类型应该为String</p>
</blockquote>
<p><strong>了解</strong>正则表达式的一些规则：</p>
<p>括号</p>
<ul>
<li>[abc]     查找方括号之间的任何字符。</li>
<li>[^abc]     查找任何不在方括号之间的字符。</li>
<li>[0-9]     查找任何从 0 至 9 的数字。</li>
<li>[a-z]     查找任何从小写 a 到小写 z 的字符。</li>
<li>[A-Z]     查找任何从大写 A 到大写 Z 的字符。</li>
<li>[A-z]     查找任何从大写 A 到小写 z 的字符。</li>
<li>(red|blue|green)     查找任何指定的选项。</li>
</ul>
<p>元字符</p>
<ul>
<li>.     查找单个任意字符,除了换行和行结束符.如果要表示.这个字符,需要转义</li>
<li>\w     查找单词字符。     字母 数字 _</li>
<li>\W     查找非单词字符。非 字母 数字 _</li>
<li>\d     查找数字</li>
<li>\D     查找非数字字符</li>
<li>\s     查找空白字符</li>
<li>\S     查找非空白字符</li>
<li>\b     匹配单词边界</li>
<li>\B     匹配非单词边界</li>
<li>\0     查找 NUL 字符</li>
<li>\n     查找换行符</li>
<li>\f     查找换页符</li>
<li>\r     查找回车符</li>
<li>\t     查找制表符</li>
<li>\v     查找垂直制表符</li>
</ul>
<p>量词</p>
<ul>
<li>n+         匹配任何包含至少一个 n 的字符串</li>
<li>n*         匹配任何包含零个或多个 n 的字符串</li>
<li>n?         匹配任何包含零个或一个 n 的字符串</li>
<li>n{X}     匹配包含 X 个 n 的序列的字符串</li>
<li>n{X,Y}     匹配包含 X 到 Y 个 n 的序列的字符串</li>
<li>n{X,}     匹配包含至少 X 个 n 的序列的字符串</li>
<li>n$         匹配任何结尾为 n 的字符串</li>
<li>^n         匹配任何开头为 n 的字符串</li>
<li>?=n     匹配任何其后紧接指定字符串 n 的字符串</li>
<li>?!n     匹配任何其后没有紧接指定字符串 n 的字符串</li>
</ul>
<h3 id="2-2-请求方法映射"><a href="#2-2-请求方法映射" class="headerlink" title="2.2 请求方法映射"></a>2.2 请求方法映射</h3><p>一般获取数据为GET请求方法，提交表单一般为POST请求方法。</p>
<p>但之前URL路径映射方式对任意请求方法都是接受的，因此我们需要某种方式来告诉相应的功能处理方法，只处理如GET方式的请求或POST方式的请求。</p>
<p>例如，</p>
<p><code>@RequestMapping(value=&quot;/user/&#123;userId:\\d+&#125;&quot;,method=RequestMethod.GET)</code></p>
<ul>
<li>可以匹配”/user/100”</li>
<li>并且请求方式只能是GET</li>
</ul>
<p><code>@RequestMapping(value=&quot;/hello&quot;, method=&#123;RequestMethod.POST,RequestMethod.GET&#125;)</code></p>
<ul>
<li>可以匹配”/hello”</li>
<li>并且请求方式只能是POST或者GET</li>
</ul>
<blockquote>
<p>注意，除了GET、POST方式请求之外，还有PUT、DELETE，以及HEAD、OPTIONS、TRACE</p>
</blockquote>
<h3 id="2-3-请求参数映射"><a href="#2-3-请求参数映射" class="headerlink" title="2.3 请求参数映射"></a>2.3 请求参数映射</h3><p><strong>1、请求数据中有指定参数名</strong></p>
<p><code>@RequestMapping(params=&quot;create&quot;,method=RequestMethod.GET)</code></p>
<ul>
<li>必须是GET方式请求</li>
<li>请求参数中必须有create参数</li>
</ul>
<p><strong>2、请求数据中没有指定参数名</strong></p>
<p><code>@RequestMapping(params=&quot;!create&quot;, method=RequestMethod.GET)</code></p>
<ul>
<li>必须是GET方式请求</li>
<li>请求参数中不能出现create参数</li>
</ul>
<p><strong>3、请求数据中指定参数名和值</strong></p>
<p><code>@RequestMapping(params=&quot;username=tom&quot;)</code></p>
<ul>
<li>请求参数中必须出现username=tom</li>
</ul>
<p><strong>4、请求数据中指定参数名!=值</strong></p>
<p><code>@RequestMapping(params=&quot;username!=tom&quot;)</code></p>
<ul>
<li>username参数名可以不出现</li>
<li>如果出现，那么参数值一定不能等于tom</li>
</ul>
<p><strong>5、组合使用是”且”的关系</strong></p>
<p><code>@RequestMapping(params=&#123;&quot;create&quot;,&quot;username=tom&quot;&#125;)</code></p>
<ul>
<li>请求参数中必须有create参数</li>
<li>请求参数中必须有username=tom</li>
</ul>
<h3 id="2-4-请求头映射"><a href="#2-4-请求头映射" class="headerlink" title="2.4 请求头映射"></a>2.4 请求头映射</h3><p><strong>1、请求头数据中有指定参数名</strong></p>
<p><code>@RequestMapping(value=&quot;/header/test1&quot;, headers=&quot;Accept&quot;)</code></p>
<ul>
<li>请求的URL必须为”/header/test1”</li>
<li>请求头中必须有Accept参数</li>
</ul>
<p><strong>2、请求头数据中没有指定参数名</strong></p>
<p><code>@RequestMapping(value=&quot;/header/test2&quot;, headers=&quot;!abc&quot;)</code></p>
<ul>
<li>请求的URL必须为”/header/test2”</li>
<li>请求头中必须没有abc参数</li>
</ul>
<p><strong>3、请求头数据中指定参数名=值</strong></p>
<p><code>@RequestMapping(value=&quot;/header/test3&quot;, headers=&quot;Content-Type=application/json&quot;)</code></p>
<ul>
<li>请求的URL必须为”/header/test3”</li>
<li>请求头中必须有”Content-Type=application/json”参数</li>
</ul>
<p><strong>4、请求头数据中指定参数名!=值</strong></p>
<p><code>@RequestMapping(value=&quot;/header/test4&quot;, headers=&quot;Accept!=text/html&quot;)</code></p>
<ul>
<li>请求的URL必须为”/header/test4”</li>
<li>请求头中必须有Accept参数,但是值不等于text/html</li>
</ul>
<p><strong>5、组合使用是”且”的关系</strong></p>
<p><code>@RequestMapping(value=&quot;/header/test5&quot;, headers=&#123;&quot;Accept!=text/html&quot;, &quot;abc=123&quot;&#125;)</code></p>
<ul>
<li>请求的URL必须为”/header/test5”</li>
<li>请求头中必须有”Accept”参数，但值不等于”text/html”</li>
<li>请求中必须有参数”abc=123”</li>
</ul>
<p><strong>6、consumes属性和produces属性</strong>（<font color="red">重要</font>）</p>
<p>consumes 指定处理请求中所提交数据类型(消费)</p>
<p><code>@RequestMapping(value=&quot;/test&quot;,consumes=&quot;application/json&quot;)  </code></p>
<ul>
<li>方法仅处理请求中,Content-Type为”application/json”的情况</li>
</ul>
<blockquote>
<p>注意，请求头中的Content-Type属性，表示请求中携带给服务器的数据是什么类型的</p>
</blockquote>
<p>produces 指定返回的数据类型(生产)</p>
<p><code>@RequestMapping(value= &quot;/test&quot;, produces=&quot;application/json&quot;)</code></p>
<ul>
<li>方法将产生json格式的数据</li>
<li>此时根据请求头中的Accept进行匹配,如请求头”Accept=application/json”时即可匹配</li>
</ul>
<blockquote>
<p>注意，请求中Accept属性，表示请求希望服务器返回的数据是什么类型的</p>
</blockquote>
<p>例如，要求请求头字段中，必须包括 <code>Content-Type: application/json</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value=&quot;test6&quot;,consumes=&quot;application/json&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">test6</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;test6...&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>如果请求头中没有包括<code>Content-Type: application/json</code>：</p>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201110101504780.png" alt="image-20201110101504780"></p>
<p>如果请求头中包括了<code>Content-Type: application/json</code>：</p>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201110101612087.png" alt="image-20201110101612087"></p>
<p>例如， 要求请求头字段中，必须包括 <code>Accept: application/json</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value=&quot;test7&quot;,produces=&quot;application/json&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">test7</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;test7...&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，Accept: */* 可以适配所有情况，且这个是默认值</p>
</blockquote>
<p>如果请求头中没有设置Accept属性</p>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201110102215259.png" alt="image-20201110102215259"></p>
<blockquote>
<p>可以正常访问，因为Accept默认值是 */*，表示接受服务器返回的任何类型的数据</p>
</blockquote>
<p>如果请求头中设置属性：<code>Accept: text/html</code></p>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201110102423220.png" alt="image-20201110102423220"></p>
<p>如果请求头中设置属性：<code>Accept: application/json</code></p>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201110102513212.png" alt="image-20201110102513212"></p>
<blockquote>
<p>注意，RESTClient是Firefox浏览器中的插件，可以直接在线安装，当然也可以使用其他插件或工具进行测试</p>
</blockquote>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201110102737979.png" alt="image-20201110102737979"></p>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201110102811490.png" alt="image-20201110102811490"></p>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201110102834944.png" alt="image-20201110102834944"></p>
<h2 id="3-方法参数"><a href="#3-方法参数" class="headerlink" title="3 方法参数"></a>3 方法参数</h2><blockquote>
<p>Controller中处理方法的参数，支持多种类型，当我们使用这些类型的变量作为参数，在Controller中处理方法的参数列表声明出来的时候，SpringMVC框架在调用方法的时候，会自动注入的</p>
</blockquote>
<p><strong>1、HttpServletRequest 和 HttpServletResponse</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;test1&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">(HttpServletRequest request,HttpServletResponse response)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;request = &quot;</span>+request);</span><br><span class="line">    System.out.println(<span class="string">&quot;response = &quot;</span>+response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>2、InputStream/OutputStream 和 Reader/Writer</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;test2&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">(InputStream in,OutputStream out)</span></span>&#123;</span><br><span class="line">    <span class="comment">//对应request.getInputStream();</span></span><br><span class="line">    System.out.println(<span class="string">&quot;in = &quot;</span>+in);</span><br><span class="line">    <span class="comment">//对应response.getOutputStream();</span></span><br><span class="line">    System.out.println(<span class="string">&quot;out = &quot;</span>+out);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;test2&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">(Reader in,Writer out)</span></span>&#123;</span><br><span class="line">    <span class="comment">//request.getReader();</span></span><br><span class="line">    System.out.println(<span class="string">&quot;in = &quot;</span>+in);</span><br><span class="line">    <span class="comment">//response.getWriter();</span></span><br><span class="line">    System.out.println(<span class="string">&quot;out = &quot;</span>+out);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>3、WebRequest/NativeWebRequest</strong></p>
<p>WebRequest是SpringMVC提供的统一请求访问接口,可以访问各个范围的数据；NativeWebRequest继承了WebRequest,并提供访问本地ServletAPI的方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;test3&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">test3</span><span class="params">(WebRequest webRequest, NativeWebRequest nativeWebRequest)</span></span>&#123;</span><br><span class="line">    System.out.println(webRequest.getParameter(<span class="string">&quot;test&quot;</span>));</span><br><span class="line">    webRequest.setAttribute(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;tom&quot;</span>,WebRequest.SCOPE_REQUEST);  </span><br><span class="line">    System.out.println(webRequest.getAttribute(<span class="string">&quot;name&quot;</span>, WebRequest.SCOPE_REQUEST));  </span><br><span class="line">    HttpServletRequest request =   </span><br><span class="line">        nativeWebRequest.getNativeRequest(HttpServletRequest.class);</span><br><span class="line">    HttpServletResponse response =   </span><br><span class="line">        nativeWebRequest.getNativeResponse(HttpServletResponse.class);  </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;test&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>4、HttpSession</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;test4&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test4</span><span class="params">(HttpSession session)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;session = &quot;</span>+session);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>5、值对象（Value Object）</strong></p>
<p>请求中含有 id=1&amp;name=tom，这些值就会被封装到User对象中，需要参数名和属性名字一致</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;test5&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test5</span><span class="params">(User user)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;user = &quot;</span>+user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>6、Model、Map、ModelMap</strong></p>
<p>SpringMVC提供Model、Map或ModelMap让我们能去封装模型数据，将来再传入视图中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;test6&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">test6</span><span class="params">(Model m1, Map&lt;String,Object&gt; m2, ModelMap m3)</span></span>&#123;</span><br><span class="line">    model.addAttribute(<span class="string">&quot;name1&quot;</span>, <span class="string">&quot;tom1&quot;</span>);</span><br><span class="line">	map.put(<span class="string">&quot;name2&quot;</span>, <span class="string">&quot;tom2&quot;</span>);</span><br><span class="line">	modelMap.addAttribute(<span class="string">&quot;name3&quot;</span>, <span class="string">&quot;tom3&quot;</span>);</span><br><span class="line">		</span><br><span class="line">	System.out.println(model);</span><br><span class="line">		</span><br><span class="line">	System.out.println(model == map);</span><br><span class="line">	System.out.println(model == modelMap);</span><br><span class="line">		</span><br><span class="line">	System.out.println(model.getClass());</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，虽然此处注入的是三个不同的类型参数，但三者是同一个对象</p>
</blockquote>
<p><strong>7、HttpEntity&lt;T&gt;和ResponseEntity&lt;T&gt;</strong></p>
<p>例如，HttpEntity可以获取请求中各个部分的内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;test7&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">test7</span><span class="params">(HttpEntity&lt;String&gt; httpEntity)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获得请求中的所有的header部分</span></span><br><span class="line">    HttpHeaders headers = httpEntity.getHeaders();</span><br><span class="line">    <span class="comment">//获得请求中的所有的body部分</span></span><br><span class="line">    String body = httpEntity.getBody();  </span><br><span class="line"></span><br><span class="line">    Set&lt;Entry&lt;String,List&lt;String&gt;&gt;&gt; set = headers.entrySet();</span><br><span class="line">    StringBuffer s = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">    <span class="keyword">for</span>(Entry&lt;String,List&lt;String&gt;&gt; entry:set)&#123;</span><br><span class="line">        String key = entry.getKey();</span><br><span class="line">        s.append(key+<span class="string">&quot;: &quot;</span>);</span><br><span class="line">        List&lt;String&gt; list = entry.getValue();</span><br><span class="line">        <span class="keyword">for</span>(String value:list)&#123;</span><br><span class="line">            s.append(value+<span class="string">&quot; &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(s.toString());</span><br><span class="line">        s.setLength(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(<span class="string">&quot;----------------&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;body = &quot;</span>+body);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>例如，ResponseEntity作为返回类型，可以自定义响应的各个部分</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;test7&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;String&gt; <span class="title">test7</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//创建响应头对象</span></span><br><span class="line">    HttpHeaders headers = <span class="keyword">new</span> HttpHeaders();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建MediaType对象</span></span><br><span class="line">    MediaType mt = <span class="keyword">new</span> MediaType(<span class="string">&quot;text&quot;</span>,<span class="string">&quot;html&quot;</span>,Charset.forName(<span class="string">&quot;UTF-8&quot;</span>)); </span><br><span class="line">    <span class="comment">//设置ContentType</span></span><br><span class="line">    headers.setContentType(mt);  </span><br><span class="line"></span><br><span class="line">    <span class="comment">//准备好响应体</span></span><br><span class="line">    String content = <span class="keyword">new</span> String(<span class="string">&quot;hello world&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//根据 响应内容/响应头信息/响应状态码 创建响应对象</span></span><br><span class="line">    ResponseEntity&lt;String&gt; re = <span class="keyword">new</span> ResponseEntity&lt;String&gt;(content,headers,HttpStatus.OK);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//返回ResponseEntity对象</span></span><br><span class="line">    <span class="keyword">return</span> re;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>8、其他</strong></p>
<p>除了这些参数类型之外，SpringMVC还支持参数类型有</p>
<ul>
<li>SessionStatus</li>
<li>RedirectAttributes</li>
<li>BindingResult</li>
<li>Errors</li>
<li>Locale</li>
<li>Principal</li>
<li>UriComponentsBuilder</li>
<li>….</li>
</ul>
<blockquote>
<p>注意，其他的一些参数类型，之后用到了再具体来说明</p>
</blockquote>
<h2 id="4-数据绑定"><a href="#4-数据绑定" class="headerlink" title="4 数据绑定"></a>4 数据绑定</h2><blockquote>
<p>请求中携带的参数，或者将数据存放到Model（request）或者session中，或者设置响应中携带的数据，这些事情Springmvc中都提供了相应的注解，可以帮我们很方便的完成</p>
</blockquote>
<h3 id="4-1-RequestParam"><a href="#4-1-RequestParam" class="headerlink" title="4.1 @RequestParam"></a>4.1 @RequestParam</h3><p><code>@RequestParam</code>用于将请求参数<strong>映射</strong>到功能处理方法的参数上</p>
<p>例如，获取请求中的name参数的值，并注入到test1方法参数username中，如果没name参数，则会抛异常</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/test1&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">test1</span><span class="params">(<span class="meta">@RequestParam(&quot;name&quot;)</span> String username)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;username = &quot;</span>+username);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>例如，如果没name参数，不会抛出异常</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/test1&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">test1</span><span class="params">(<span class="meta">@RequestParam(value=&quot;name&quot;,required=false)</span> String username)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;username = &quot;</span>+username);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>例如，如果没name参数，不会抛出异常，并且指定默认值为briup</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/test1&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">test1</span><span class="params">(<span class="meta">@RequestParam(value=&quot;name&quot;,required=false,defaultValue=&quot;briup&quot;)</span> String username)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;username = &quot;</span>+username);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>例如，如果没name参数，不会抛出异常，并且指定默认值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/test1&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">test1</span><span class="params">(<span class="meta">@RequestParam(value=&quot;name&quot;,required=false,defaultValue=&quot;#&#123;systemProperties[&#x27;java.vm.name&#x27;]&#125;&quot;)</span> String username)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;username = &quot;</span>+username);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中：</p>
<ul>
<li>defaultValue默认值可以是spring中的<strong>SpEL</strong> 表达式,如<code>&quot;#&#123;systemProperties[&#39;java.vm.name&#39;]&#125;&quot;</code></li>
<li>systemProperties是SpringIOC容器中的一个Properties对象</li>
<li>该对象中很多系统变量,要取值只需#{systemProperties[‘key’]}即可</li>
<li>后面知识点中有对spEL的更多介绍和使用，官方说明文档中也有详细说明和案例</li>
</ul>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201110113403954.png" alt="image-20201110113403954"></p>
<h3 id="4-2-PathVariable"><a href="#4-2-PathVariable" class="headerlink" title="4.2 @PathVariable"></a>4.2 @PathVariable</h3><p><code>@PathVariable</code>用于将请求URL中的模板变量映射到功能处理方法的参数上</p>
<p>例如，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/test2/&#123;name&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">test2</span><span class="params">(<span class="meta">@PathVariable(&quot;name&quot;)</span> String username)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;username = &quot;</span>+username);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，@PathVariabl还可以自动的把数据放到模型中去，页面中可以直接使用EL表达式取值 : ${name}</p>
</blockquote>
<p>访问地址：<a target="_blank" rel="noopener" href="http://127.0.0.1:8989/test2/tom">http://127.0.0.1:8989/test2/tom</a></p>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201110122540764.png" alt="image-20201110122540764"></p>
<p>例如，如果占位符的名字和参数的名字一致，那么可以自动配置，不用手动指定参数名称</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/test2/&#123;name&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">test2</span><span class="params">(<span class="meta">@PathVariable</span> String name)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;name = &quot;</span>+name);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="4-3-CookieValue"><a href="#4-3-CookieValue" class="headerlink" title="4.3 @CookieValue"></a>4.3 @CookieValue</h3><p><code>@CookieValue</code>用于将请求中的Cookie数据映射到功能处理方法的参数上</p>
<p>例如，自动将JSESSIONID 值入参到sessionId 参数上</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/test3&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">test3</span><span class="params">(<span class="meta">@CookieValue(value=&quot;JSESSIONID&quot;,required=false)</span> String sessionId)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;sessionId = &quot;</span>+sessionId);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，defaultValue 表示Cookie中没有JSESSIONID时默认为空</p>
</blockquote>
<p>例如，传入参数类型也可以是javax.servlet.http.Cookie</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/test3&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">test3</span><span class="params">(<span class="meta">@CookieValue(value=&quot;JSESSIONID&quot;,required=false)</span> Cookie cookie)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;cookie = &quot;</span>+cookie);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="4-4-RequestHeader"><a href="#4-4-RequestHeader" class="headerlink" title="4.4 @RequestHeader"></a>4.4 @RequestHeader</h3><p><code>@RequestHeader</code>用于将请求的头中的值映射到功能处理方法的参数上</p>
<p>例如，自动将请求头”User-Agent”的值，入参到userAgent参数上，并将”Accept”请求头值入参到accepts参数上</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/test4&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">test4</span><span class="params">(<span class="meta">@RequestHeader(&quot;User-Agent&quot;)</span> String userAgent,<span class="meta">@RequestHeader(value=&quot;Accept&quot;)</span> String[] accepts)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;userAgent = &quot;</span>+userAgent);</span><br><span class="line">    System.out.println(<span class="string">&quot;accepts = &quot;</span>+Arrays.toString(accepts));</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>








<h1 id="springmvc-三"><a href="#springmvc-三" class="headerlink" title="springmvc(三)"></a>springmvc(三)</h1><h2 id="1-数据绑定"><a href="#1-数据绑定" class="headerlink" title="1 数据绑定"></a>1 数据绑定</h2><h3 id="1-1-ModelAttribute"><a href="#1-1-ModelAttribute" class="headerlink" title="1.1 @ModelAttribute"></a>1.1 @ModelAttribute</h3><p><code>@ModelAttribute</code>注解用于将方法的参数或方法的返回值绑定到指定的模型属性上，并返回给Web视图</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.PARAMETER, ElementType.METHOD&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> ModelAttribute &#123;</span><br><span class="line"> 	<span class="comment">//...   </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，该注解可以用在方法上，也可以用在参数上</p>
</blockquote>
<p>例如，@ModelAttribute加在普通方法上</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ModelAttribute;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/model&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ModelAttributeController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//任何映射方法执行之前，都会先调用该方法，将返回值存入模型中</span></span><br><span class="line">    <span class="comment">//key默认为返回类型的首字母小写，string</span></span><br><span class="line">	<span class="meta">@ModelAttribute</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">addModel1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//任何映射方法执行之前，都会先调用该方法，将返回值存入模型中</span></span><br><span class="line">    <span class="comment">//如果是集合，key默认为泛型类型首字小写+List，这里为stringList</span></span><br><span class="line">	<span class="meta">@ModelAttribute</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">addModel2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> java.util.Arrays.asList(<span class="string">&quot;hello&quot;</span>,<span class="string">&quot;world&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//任何映射方法执行之前，都会先调用该方法，将返回值存入模型中</span></span><br><span class="line">    <span class="comment">//可以指定key的值，这里设置为name</span></span><br><span class="line">	<span class="meta">@ModelAttribute(&quot;name&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">addModel3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;tom&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">(Model model)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">        <span class="comment">//输出model，可以看出里面存放的key和value</span></span><br><span class="line">		System.out.println(model);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>访问地址：<a target="_blank" rel="noopener" href="http://127.0.0.1:8989/model/test">http://127.0.0.1:8989/model/test</a></p>
<p>控制台的输出结果为：</p>
<p><code>&#123;name=tom, string=hello, stringList=[hello, world]&#125;</code></p>
<p>例如，如果处理器方法的参数是自定义实体类型（例如User），会默认存放到模型中，key的默认值为类型首字母小写</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">long</span> id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">long</span> id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;User [id=&quot;</span> + id + <span class="string">&quot;, name=&quot;</span> + name + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.web.bean.User;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/model&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ModelAttributeController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">(User user,Model model)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		System.out.println(model);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>访问地址：<a target="_blank" rel="noopener" href="http://127.0.0.1:8989/model/test?id=1&amp;name=tom">http://127.0.0.1:8989/model/test?id=1&amp;name=tom</a></p>
<p>控制台的输出结果为：</p>
<p><code>&#123;user=User [id=1, name=tom], org.springframework.validation.BindingResult.user=org.springframework.validation.BeanPropertyBindingResult: 0 errors&#125;</code></p>
<blockquote>
<p>注意，这里除了把User对象放入模型中，还把参数的验证结果存放了进来，之外在数据验证的时候会用到</p>
</blockquote>
<p>例如，如果处理器方法的参数是基本类型或者字符串，是不会默认存到模型中的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/model&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ModelAttributeController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">(String name,Model model)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		System.out.println(model);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>访问地址：<a target="_blank" rel="noopener" href="http://127.0.0.1:8989/model/test?name=tom">http://127.0.0.1:8989/model/test?name=tom</a></p>
<p>控制台的输出结果为：</p>
<p><code>&#123;&#125;</code></p>
<blockquote>
<p>注意，方法的参数名 和 传参的参数名 如果一致，会自动接收</p>
</blockquote>
<p>例如，无论是自定义实体类User，还是基本类型或者字符串类型，都可以使用<code>@ModelAttribute</code>注解将其存入模型中，并指定key的值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ModelAttribute;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/model&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ModelAttributeController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">(<span class="meta">@ModelAttribute(&quot;name&quot;)</span> String name,Model model)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		System.out.println(model);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>访问地址：<a target="_blank" rel="noopener" href="http://127.0.0.1:8989/model/test?name=tom">http://127.0.0.1:8989/model/test?name=tom</a></p>
<p>控制台的输出结果为：</p>
<p><code>&#123;name=tom, org.springframework.validation.BindingResult.name=org.springframework.validation.BeanPropertyBindingResult: 0 errors&#125;</code></p>
<p>例如，如果模型中已经有了指定key的值，<code>@ModelAttribute</code>还会从模型中取值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ModelAttribute;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/model&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ModelAttributeController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//这个方法会在功能处理方法执行之前，先进行把数据添加到模型Model中</span></span><br><span class="line">	<span class="meta">@ModelAttribute(&quot;name&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">addModel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;tom&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//@ModelAttribute(&quot;name&quot;)会先从模型中查询key为name的值</span></span><br><span class="line">    <span class="comment">//如果有key为name的值，那么就取出来注入到这个方法参数name上，这个值显示为：tom</span></span><br><span class="line">    <span class="comment">//及时这个时候访问地址并传参 /test?name=lucy ,这个lucy的是无法接收的</span></span><br><span class="line">    <span class="comment">//除非再添加一个注解 @RequestParam(&quot;name&quot;) ,这时候就可以拿到请求参数中的name值：lucy</span></span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">(<span class="meta">@ModelAttribute(&quot;name&quot;)</span>String name,Model model)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;name = &quot;</span>+name);</span><br><span class="line">		System.out.println(model);</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h3 id="1-2-SessionAttributes"><a href="#1-2-SessionAttributes" class="headerlink" title="1.2 @SessionAttributes"></a>1.2 @SessionAttributes</h3><p><code>@SessionAttributes</code>注解只用作用在类上，作用是将指定的 Model 的键值对保存在 <strong>session</strong> 中</p>
<p>例如，将Model中的key-value，存入到Session中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.SessionAttributes;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SessionAttributes(&#123;&quot;name&quot;&#125;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/session&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SessionAttributesController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/test1&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">test1</span><span class="params">(Model model)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		model.addAttribute(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;mary&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/test2&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">test2</span><span class="params">(HttpSession session)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		System.out.println(session.getAttribute(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>先访问地址：<a target="_blank" rel="noopener" href="http://127.0.0.1:8989/model/test1">http://127.0.0.1:8989/model/test1</a></p>
<p>此时，将name=mary存入了model中，同时也存入了session中</p>
<p>再访问地址：<a target="_blank" rel="noopener" href="http://127.0.0.1:8989/model/test2">http://127.0.0.1:8989/model/test2</a></p>
<p>控制台的输出结果为：</p>
<p><code>mary</code></p>
<p>例如，如果使用@ModelAttribute 和 @SessionAttributes，并且@ModelAttribute用在参数上，<strong>此时会报错</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ModelAttribute;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.SessionAttributes;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SessionAttributes(&#123;&quot;name&quot;&#125;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/session&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SessionAttributesController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/test1&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">test1</span><span class="params">(<span class="meta">@ModelAttribute(&quot;name&quot;)</span> String name)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/test2&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">test2</span><span class="params">(HttpSession session)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		System.out.println(session.getAttribute(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>访问地址：<a target="_blank" rel="noopener" href="http://127.0.0.1:8989/session/test1?name=tom">http://127.0.0.1:8989/session/test1?name=tom</a></p>
<p>报错信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Expected session attribute &#x27;name&#x27;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，@ModelAttribute也会从session中取key为name值</p>
</blockquote>
<h3 id="1-3-Value"><a href="#1-3-Value" class="headerlink" title="1.3 @Value"></a>1.3 @Value</h3><p><code>@Value</code>可以将一个SpEL表达式结果映射到功能处理方法的参数上</p>
<p>例如，使用SpEL，从SpringIOC容器对象中取值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/value&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ValueController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/test1&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">test1</span><span class="params">(<span class="meta">@Value(&quot;#&#123;systemProperties[&#x27;java.vm.version&#x27;]&#125;&quot;)</span> String jvmVersion)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		System.out.println(jvmVersion);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>其中：</p>
<ul>
<li>systemProperties是SpringIOC容器中的一个Properties对象</li>
<li>该对象中很多系统变量,要取值只需#{systemProperties[‘key’]}即可</li>
</ul>
<p>例如，使用SpEL，访问Spring容器中bean对象的属性和方法</p>
<p>修改User类，添加sayHello方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">long</span> id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">long</span> id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;User [id=&quot;</span> + id + <span class="string">&quot;, name=&quot;</span> + name + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello world!&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello world! &quot;</span>+name;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>修改配置文件，添加bean标签对User进行配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;</span>&gt;</span></span><br><span class="line">   	</span><br><span class="line">   	<span class="comment">&lt;!-- 指定spring扫描的包路径 --&gt;</span></span><br><span class="line">   	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.briup.web.annotation&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 开启springmvc的注解功能 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置视图解析器--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span>  </span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;viewClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;org.springframework.web.servlet.view.JstlView&quot;</span>/&gt;</span>  </span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/jsp/&quot;</span>/&gt;</span>  </span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>/&gt;</span>  </span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span> </span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置静态资源不被拦截 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.web.bean.User&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;tom&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>





<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/value&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ValueController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/test1&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">test1</span><span class="params">(<span class="meta">@Value(&quot;#&#123;systemProperties[&#x27;java.vm.version&#x27;]&#125;&quot;)</span> String jvmVersion)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		System.out.println(jvmVersion);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/test2&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">test2</span><span class="params">(<span class="meta">@Value(&quot;#&#123;user.name&#125;&quot;)</span> String username)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		System.out.println(username);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/test3&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">test3</span><span class="params">(<span class="meta">@Value(&quot;#&#123;user.sayHello()&#125;&quot;)</span> String msg)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		System.out.println(msg);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/test4&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">test4</span><span class="params">(<span class="meta">@Value(&quot;#&#123;user.sayHello(&#x27;mary&#x27;)&#125;&quot;)</span> String msg)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		System.out.println(msg);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//这里的?号，是为了防止空指针，以为sayHello()方法可能返回null,不为null的时候才会继续调用</span></span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/test5&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">test5</span><span class="params">(<span class="meta">@Value(&quot;#&#123;user.sayHello()?.toUpperCase()&#125;&quot;)</span> String msg)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		System.out.println(msg);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<p>例如，如果要调用的某个类是外部类的静态方法,而不是spring中定义的bean,使用表达式T()</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/value&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ValueController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/test6&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">test6</span><span class="params">(<span class="meta">@Value(&quot;#&#123;T(java.lang.Math).random()&#125;&quot;)</span> String msg)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		System.out.println(msg);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="1-4-InitBinder"><a href="#1-4-InitBinder" class="headerlink" title="1.4 @InitBinder"></a>1.4 @InitBinder</h3><p><code>@InitBinder</code>注解可以解决类型转换的问题</p>
<p>例如，</p>
<p>User中添加日期属性dob</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">long</span> id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> Date dob;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">long</span> id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Date <span class="title">getDob</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> dob;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDob</span><span class="params">(Date dob)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.dob = dob;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;User [id=&quot;</span> + id + <span class="string">&quot;, name=&quot;</span> + name + <span class="string">&quot;, dob=&quot;</span> + dob + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.propertyeditors.CustomDateEditor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.WebDataBinder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.InitBinder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.web.bean.User;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/binder&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InitBinderController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">		System.out.println(user);</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@InitBinder</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">format</span><span class="params">(WebDataBinder binder)</span></span>&#123;</span><br><span class="line">		SimpleDateFormat dateFormat = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd&quot;</span>);  </span><br><span class="line">		<span class="comment">//指定日期转换的格式，true表示允许为空</span></span><br><span class="line">		binder.registerCustomEditor(Date.class, <span class="keyword">new</span> CustomDateEditor(dateFormat, <span class="keyword">true</span>));  </span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，默认情况下，SpringMVC无法将1999-11-11这样的字符串转为日期，添加上面format方法并使用注解@InitBinder后，就可以正常转换了</p>
</blockquote>
<p>访问地址：<a target="_blank" rel="noopener" href="http://127.0.0.1:8989/binder/test?dob=1999-11-11">http://127.0.0.1:8989/binder/test?dob=1999-11-11</a></p>
<p>除了这种方式，将接收到的日期参数进行转换外，还有另一种方式，只需要添加一个<code>@DateTimeFormat</code>注解即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.format.annotation.DateTimeFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">long</span> id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Date dob;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">long</span> id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Date <span class="title">getDob</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> dob;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDob</span><span class="params">(Date dob)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.dob = dob;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;User [id=&quot;</span> + id + <span class="string">&quot;, name=&quot;</span> + name + <span class="string">&quot;, dob=&quot;</span> + dob + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，此时不需要使用@InitBinder注解的方法，也可以完成日期转换</p>
</blockquote>
<h3 id="1-5-Scope"><a href="#1-5-Scope" class="headerlink" title="1.5 @Scope"></a>1.5 @Scope</h3><p>Controller默认情况下和servlet一样也是单例,但是spring提供了一个@Scope注解可以让Controller对象变为非单例,只需在Controller类上面加入@Scope(“prototype”)即可</p>
<p>例如，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line"><span class="meta">@Scope(&quot;prototype&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorldController</span></span>&#123;</span><br><span class="line">	<span class="comment">//....</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="1-6-RequestBody"><a href="#1-6-RequestBody" class="headerlink" title="1.6 @RequestBody"></a>1.6 @RequestBody</h3><p><code>@RequestBody</code>表示从请求正文中取值</p>
<p>例如，获取POST请求正文中的内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/request-body&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RequestBodyController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">    </span><br><span class="line">	<span class="meta">@RequestMapping(value=&quot;/test&quot;,method = RequestMethod.POST)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">(<span class="meta">@RequestBody</span> String content)</span> </span>&#123;</span><br><span class="line">		System.out.println(content);</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>访问地址：<a target="_blank" rel="noopener" href="http://127.0.0.1:8989/request-body/test">http://127.0.0.1:8989/request-body/test</a></p>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201111012653803.png" alt="image-20201111012653803"></p>
<p>控制台的输出结果为：</p>
<p><code>name=tom&amp;age=20</code></p>
<p>该注解一般用于接收请求体中的JSON格式字符串，并转换为java对象，但是需要引入操作json的相关jar包</p>
<ul>
<li>jackson-core-2.11.3.jar</li>
<li>jackson-annotations-2.11.3.jar</li>
<li>jackson-databind-2.11.3.jar</li>
</ul>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201111013555721.png" alt="image-20201111013555721"></p>
<p>例如，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.web.bean.User;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/request-body&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RequestBodyController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(value=&quot;/test&quot;,method = RequestMethod.POST,consumes = &quot;application/json&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span> </span>&#123;</span><br><span class="line">		System.out.println(user);</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>访问地址：<a target="_blank" rel="noopener" href="http://127.0.0.1:8989/request-body/test">http://127.0.0.1:8989/request-body/test</a></p>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201111013929450.png" alt="image-20201111013929450"></p>
<p>控制台的输出结果为：</p>
<p><code>User [id=1, name=tom, dob=Thu Nov 11 08:00:00 CST 1999]</code></p>
<blockquote>
<p>可以看出，已经成功接收到请求体中的json格式的字符串，并且转换为了User对象</p>
</blockquote>
<p>也可以使用ajax，发出POST请求，并携带json格式字符串：ajax.jsp</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;#btn&quot;</span>).on(<span class="string">&quot;click&quot;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> json = &#123;<span class="attr">id</span>:<span class="number">1</span>,<span class="attr">name</span>:<span class="string">&quot;tom&quot;</span>,<span class="attr">dob</span>:<span class="string">&quot;1999-11-11&quot;</span>&#125;;</span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">        <span class="attr">type</span>:<span class="string">&quot;post&quot;</span>,</span><br><span class="line">        <span class="attr">url</span>:<span class="string">&quot;/request-body/test&quot;</span>,</span><br><span class="line">        <span class="attr">contentType</span>:<span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">        <span class="attr">data</span>:<span class="built_in">JSON</span>.stringify(json),</span><br><span class="line">        <span class="attr">dataType</span>:<span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="attr">success</span>:<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;data = &quot;</span>+data);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，http中的Content-Type,在jquery中是contentType</p>
</blockquote>
<p>/WEB-INF/jsp/ajax.jsp页面，因为在WEB-INF下，所以浏览器无法直接方法，需要先放我Controller，然后返回逻辑视图名”ajax”，经过视图解析器，解析成真实的物理视图的路径，然后在显示。</p>
<p>这个过程可以使用一个mvc的专用标签进行简化：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:view-controller</span> <span class="attr">path</span>=<span class="string">&quot;/ajax&quot;</span> <span class="attr">view-name</span>=<span class="string">&quot;ajax&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>该配置的意思是，浏览器中放我/ajax，SpringMVC中直接返回ajax逻辑视图名</p>
</blockquote>
<p>由于是ajax请求，那么Controller中的处理方法就不能返回视图页面了，而是直接写回数据给页面</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value=&quot;/test&quot;,method = RequestMethod.POST,consumes = &quot;application/json&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(<span class="meta">@RequestBody</span> User user,Writer out)</span><span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    System.out.println(user);</span><br><span class="line">    out.write(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>在此过程中，ajax发送json数据给Controller,Controller里面接收json数据并且转换为对象，需要注意：</p>
<ul>
<li>ajax请求发送的时候要指定为post方式</li>
<li>ajax请求发送的时候要指定contentType:”application/json”</li>
<li>ajax请求发送的时候要把json对象转换为字符串再发送</li>
<li>Controller中要使用@RequestBody指定接收请求体中的数据</li>
<li>项目中要引入json相关的jar包</li>
<li>如果此ajax请求还希望Controller返回的数据也是json格式的,那么需要在发送ajax请求的时候指定dataType:”json”</li>
<li>Controller中的方法要返回json格式的数据给客户端,可以使用<code>@ResponseBody</code>标签 或者 在方法中自己使用response对象获得io流给客户端写回去</li>
</ul>
<p>如图：</p>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201112151104991.png" alt="image-20201112151104991"></p>
<blockquote>
<p>注意，ajax发送请求的时候,请求头中的Content-Type默认值是: application/x-www-form-urlencoded,表示当前请求中如果有数据的话,将会是key=value&amp;key=value的形式</p>
</blockquote>
<p>jquery的ajax代码，http协议请求中的字段，RequestMapping注解中的属性，三者之间的对应关系：</p>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201112152333168.png" alt="image-20201112152333168"></p>
<blockquote>
<p>注意，这里三个红颜色的框对应起来，三个蓝颜色的框对应起来</p>
</blockquote>
<h3 id="1-7-ResponseBody"><a href="#1-7-ResponseBody" class="headerlink" title="1.7 @ResponseBody"></a>1.7 @ResponseBody</h3><p><code>@ResponseBody</code>注解用于将处理器中功能处理方法返回的对象，经过转换为指定格式后，写入到Response对象的body数据区，也就是响应正文。</p>
<p>例如，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/response-body&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResponseBodyController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ResponseBody</span></span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//test方法和test1方法效果一样，是等价的</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/test1&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">tes1t</span><span class="params">(PrintWriter out)</span> </span>&#123;</span><br><span class="line">		out.println(<span class="string">&quot;hello world&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这里的处理器方法上加入了@ResponseBody注解，表示这个方法的返回值，将存入到响应正文中</p>
</blockquote>
<p>访问地址：<a target="_blank" rel="noopener" href="http://127.0.0.1:8989/response-body/test">http://127.0.0.1:8989/response-body/test</a></p>
<p>访问结果：</p>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201111110655564.png" alt="image-20201111110655564"></p>
<p><code>@ResponseBody</code>一般在处理器方法返回的数据不是html页面，而是json数据的时候使用，并且可以自动将对象转为json格式的字符串，放入响应体中，并返回。</p>
<p><strong>前提是已经导入了json相关jar包。</strong></p>
<p>例如，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.web.bean.User;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/response-body&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResponseBodyController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ResponseBody</span></span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ResponseBody</span></span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/test1&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> User <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		User user = <span class="keyword">new</span> User();</span><br><span class="line">		user.setId(<span class="number">1L</span>);</span><br><span class="line">		user.setName(<span class="string">&quot;tom&quot;</span>);</span><br><span class="line">		user.setDob(<span class="keyword">new</span> Date());</span><br><span class="line">		<span class="keyword">return</span> user;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>访问地址：<a target="_blank" rel="noopener" href="http://127.0.0.1:8989/response-body/test1">http://127.0.0.1:8989/response-body/test1</a></p>
<p>访问结果：</p>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201111111521815.png" alt="image-20201111111521815"></p>
<p>可以看出，它默认把dob这个日期对象转为了一个时间戳，如果想按照自己的日期格式进行转换，那么需要自定义一个json的日期类型格式化类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.json;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.JsonGenerator;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.JsonProcessingException;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.JsonSerializer;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.SerializerProvider;</span><br><span class="line"></span><br><span class="line"><span class="comment">//java对象中的日期属性 转 json字符串的时候，日期格式的设置</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DateJsonSerializer</span> <span class="keyword">extends</span> <span class="title">JsonSerializer</span>&lt;<span class="title">Date</span>&gt; </span>&#123;  </span><br><span class="line">	<span class="meta">@Override</span>  </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">serialize</span><span class="params">(Date value, JsonGenerator jgen, SerializerProvider provider)</span> <span class="keyword">throws</span> IOException,JsonProcessingException </span>&#123;  </span><br><span class="line">		 SimpleDateFormat formatter = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd&quot;</span>);  </span><br><span class="line">		 String formattedDate = formatter.format(value);  </span><br><span class="line">		 jgen.writeString(formattedDate);  </span><br><span class="line">	&#125;  </span><br><span class="line">&#125; </span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>然后，在User类中的getDob方法上添加注解：<code>@JsonSerialize(using=DateJsonSerializer.class)</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.format.annotation.DateTimeFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.web.json.DateJsonSerializer;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.annotation.JsonSerialize;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">long</span> id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Date dob;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">long</span> id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@JsonSerialize(using=DateJsonSerializer.class)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Date <span class="title">getDob</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> dob;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDob</span><span class="params">(Date dob)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.dob = dob;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;User [id=&quot;</span> + id + <span class="string">&quot;, name=&quot;</span> + name + <span class="string">&quot;, dob=&quot;</span> + dob + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>其中：</p>
<ul>
<li><code>@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</code>，是SpringMVC接收客户端请求中参数的时候，字符串转日期对象的格式</li>
<li><code>@JsonSerialize(using=DateJsonSerializer.class)</code>，是Controller处理方法的返回值，将java对象转为json格式字符串的日期格式</li>
</ul>
<p>访问地址：<a target="_blank" rel="noopener" href="http://127.0.0.1:8989/response-body/test1">http://127.0.0.1:8989/response-body/test1</a></p>
<p>访问结果：</p>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201111112506050.png" alt="image-20201111112506050"></p>
<p>同时，也可以在html页面中，使用ajax来访问这个Controller</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;#btn&quot;</span>).on(<span class="string">&quot;click&quot;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> json = &#123;<span class="attr">id</span>:<span class="number">1</span>,<span class="attr">name</span>:<span class="string">&quot;tom&quot;</span>,<span class="attr">dob</span>:<span class="string">&quot;1999-11-11&quot;</span>&#125;;</span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">        <span class="attr">type</span>:<span class="string">&quot;post&quot;</span>,</span><br><span class="line">        <span class="attr">url</span>:<span class="string">&quot;/response-body/test1&quot;</span>,</span><br><span class="line">        <span class="attr">contentType</span>:<span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">        <span class="attr">data</span>:<span class="built_in">JSON</span>.stringify(json),</span><br><span class="line">        <span class="attr">dataType</span>:<span class="string">&quot;json&quot;</span>,</span><br><span class="line">        <span class="attr">success</span>:<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(data);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这里的<code>dataType:&quot;json&quot;</code> 表示ajax响应回来的数据应该是json格式字符串</p>
</blockquote>
<h2 id="2-数据交互"><a href="#2-数据交互" class="headerlink" title="2 数据交互"></a>2 数据交互</h2><p>在项目中，经常会遇到这样的场景，前端页面中发送ajax请求给Controller中的处理方法，处理方法返回json格式的字符串给这个ajax请求。</p>
<p>当然，前面页面发送的请求中携带的参数，也可以是正常的k=v的形式</p>
<h3 id="2-1-接收参数"><a href="#2-1-接收参数" class="headerlink" title="2.1 接收参数"></a>2.1 接收参数</h3><p>1、参数是基本数据类型/包装类型/String</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;test&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">(<span class="keyword">int</span> age)</span></span>&#123;...&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">(<span class="keyword">long</span> id)</span></span>&#123;...&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">(<span class="keyword">boolean</span> flag)</span></span>&#123;...&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">(Long id)</span></span>&#123;...&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">(String name)</span></span>&#123;...&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，参数名字要和客户端传的参数名一致,否则需要使用<code>@RequestParam</code>来指定参数名</p>
</blockquote>
<p>2、参数是数组类型</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;test&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">(<span class="keyword">int</span>[] age)</span></span>&#123;...&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">(<span class="keyword">long</span>[] id)</span></span>&#123;...&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">(<span class="keyword">boolean</span>[] flag)</span></span>&#123;...&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">(Long[] id)</span></span>&#123;...&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">(String[] name)</span></span>&#123;...&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，客户端传值类似于这样：name=tom&amp;name=lisi</p>
</blockquote>
<p>3、参数是数组类型（json格式）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/index&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">index</span><span class="params">(<span class="meta">@RequestBody</span> String[] arr)</span></span>&#123;...&#125;</span><br></pre></td></tr></table></figure>



<p>前端对应的js代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;#btn&quot;</span>).on(<span class="string">&quot;click&quot;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> arr = [];</span><br><span class="line">    arr.push(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">    arr.push(<span class="string">&quot;world&quot;</span>);</span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">        <span class="attr">type</span>:<span class="string">&quot;post&quot;</span>,</span><br><span class="line">        <span class="attr">url</span>:<span class="string">&quot;test/index&quot;</span>,</span><br><span class="line">        <span class="attr">contentType</span>:<span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">        <span class="attr">data</span>:<span class="built_in">JSON</span>.stringify(arr),</span><br><span class="line">        <span class="attr">dataType</span>:<span class="string">&quot;json&quot;</span>,</span><br><span class="line">        <span class="attr">success</span>:<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;data = &quot;</span>+data);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<p>4、参数是类类型</p>
<p>例如，实体类Uesr、Student等</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;test&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">(User user)</span></span>&#123;...&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，客户端传值类似于这样：id=1&amp;name=tom&amp;dob=1999-11-11</p>
</blockquote>
<p>5、参数是类类型的数组（json格式）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">(<span class="meta">@RequestBody</span> User[] users)</span></span>&#123;...&#125;</span><br></pre></td></tr></table></figure>



<p>前端对应的js代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;#btn&quot;</span>).on(<span class="string">&quot;click&quot;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> arr = [];</span><br><span class="line">    <span class="keyword">var</span> json1 = &#123;<span class="attr">id</span>:<span class="number">1</span>,<span class="attr">name</span>:<span class="string">&quot;tom&quot;</span>,<span class="attr">dob</span>:<span class="string">&quot;1999-11-11&quot;</span>&#125;;</span><br><span class="line">    <span class="keyword">var</span> json2 = &#123;<span class="attr">id</span>:<span class="number">2</span>,<span class="attr">name</span>:<span class="string">&quot;zss&quot;</span>,<span class="attr">dob</span>:<span class="string">&quot;2000-11-11&quot;</span>&#125;;</span><br><span class="line">    arr.push(json1);</span><br><span class="line">    arr.push(json2);</span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">        <span class="attr">type</span>:<span class="string">&quot;post&quot;</span>,</span><br><span class="line">        <span class="attr">url</span>:<span class="string">&quot;/test&quot;</span>,</span><br><span class="line">        <span class="attr">contentType</span>:<span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">        <span class="attr">data</span>:<span class="built_in">JSON</span>.stringify(arr),</span><br><span class="line">        <span class="attr">dataType</span>:<span class="string">&quot;json&quot;</span>,</span><br><span class="line">        <span class="attr">success</span>:<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;data = &quot;</span>+data);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>





<p>6、参数是List/Set集合（json格式）</p>
<p>例如，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/index&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">index</span><span class="params">(<span class="meta">@RequestBody</span> List&lt;String&gt; list)</span></span>&#123;...&#125;</span><br></pre></td></tr></table></figure>



<p>前端对应的js代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;#btn&quot;</span>).on(<span class="string">&quot;click&quot;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> arr = [];</span><br><span class="line">    arr.push(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">    arr.push(<span class="string">&quot;world&quot;</span>);</span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">        <span class="attr">type</span>:<span class="string">&quot;post&quot;</span>,</span><br><span class="line">        <span class="attr">url</span>:<span class="string">&quot;test/index&quot;</span>,</span><br><span class="line">        <span class="attr">contentType</span>:<span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">        <span class="attr">data</span>:<span class="built_in">JSON</span>.stringify(arr),</span><br><span class="line">        <span class="attr">dataType</span>:<span class="string">&quot;json&quot;</span>,</span><br><span class="line">        <span class="attr">success</span>:<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;data = &quot;</span>+data);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<p>例如，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/index&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">index</span><span class="params">(<span class="meta">@RequestBody</span> List&lt;User&gt; list)</span></span>&#123;....&#125;</span><br></pre></td></tr></table></figure>



<p>前端对应的js代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;#btn&quot;</span>).on(<span class="string">&quot;click&quot;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> arr = [];</span><br><span class="line">    <span class="keyword">var</span> json1 = &#123;<span class="attr">id</span>:<span class="number">1</span>,<span class="attr">name</span>:<span class="string">&quot;tom&quot;</span>,<span class="attr">dob</span>:<span class="string">&quot;1999-11-11&quot;</span>&#125;;</span><br><span class="line">    <span class="keyword">var</span> json2 = &#123;<span class="attr">id</span>:<span class="number">2</span>,<span class="attr">name</span>:<span class="string">&quot;zss&quot;</span>,<span class="attr">dob</span>:<span class="string">&quot;2000-11-11&quot;</span>&#125;;</span><br><span class="line">    arr.push(json1);</span><br><span class="line">    arr.push(json2);</span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">        <span class="attr">type</span>:<span class="string">&quot;post&quot;</span>,</span><br><span class="line">        <span class="attr">url</span>:<span class="string">&quot;test/index&quot;</span>,</span><br><span class="line">        <span class="attr">contentType</span>:<span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">        <span class="attr">data</span>:<span class="built_in">JSON</span>.stringify(arr),</span><br><span class="line">        <span class="attr">dataType</span>:<span class="string">&quot;json&quot;</span>,</span><br><span class="line">        <span class="attr">success</span>:<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;data = &quot;</span>+data);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>





<p>7、参数是Map集合（json格式）</p>
<p>例如，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/index&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">index</span><span class="params">(<span class="meta">@RequestBody</span> Map&lt;Long,User&gt; map)</span></span>&#123;...&#125;</span><br></pre></td></tr></table></figure>



<p>前端对应的js代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;#btn&quot;</span>).on(<span class="string">&quot;click&quot;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> map = &#123;&#125;;</span><br><span class="line">    <span class="keyword">var</span> json1 = &#123;<span class="attr">id</span>:<span class="number">1</span>,<span class="attr">name</span>:<span class="string">&quot;tom&quot;</span>,<span class="attr">dob</span>:<span class="string">&quot;1999-11-11&quot;</span>&#125;;</span><br><span class="line">    <span class="keyword">var</span> json2 = &#123;<span class="attr">id</span>:<span class="number">2</span>,<span class="attr">name</span>:<span class="string">&quot;zss&quot;</span>,<span class="attr">dob</span>:<span class="string">&quot;2000-11-11&quot;</span>&#125;;</span><br><span class="line">    map[json1.id] = json1;</span><br><span class="line">    map[json2.id] = json2;</span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">        <span class="attr">type</span>:<span class="string">&quot;post&quot;</span>,</span><br><span class="line">        <span class="attr">url</span>:<span class="string">&quot;test/index&quot;</span>,</span><br><span class="line">        <span class="attr">contentType</span>:<span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">        <span class="attr">data</span>:<span class="built_in">JSON</span>.stringify(map),</span><br><span class="line">        <span class="attr">dataType</span>:<span class="string">&quot;json&quot;</span>,</span><br><span class="line">        <span class="attr">success</span>:<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;data = &quot;</span>+data);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<p>8、其他情况</p>
<p>在遇到特殊情况下，可以使用自定义类型转换器，将一个类型转换为另一种类型</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Converter</span>&lt;<span class="title">S</span>, <span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">T <span class="title">convert</span><span class="params">(S source)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>例如，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.converter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.core.convert.converter.Converter;</span><br><span class="line"></span><br><span class="line"><span class="comment">//转换器 负责把String转换为Date</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringToDateConverter</span> <span class="keyword">implements</span> <span class="title">Converter</span>&lt;<span class="title">String</span>,<span class="title">Date</span>&gt;</span>&#123;</span><br><span class="line">	<span class="keyword">private</span> SimpleDateFormat dateFormat = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Date <span class="title">convert</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">		Date date = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="keyword">if</span>(str!=<span class="keyword">null</span> &amp;&amp; !<span class="string">&quot;&quot;</span>.equals(str.trim()))&#123;</span><br><span class="line">				date = dateFormat.parse(str);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> date;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>配置文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span> <span class="attr">conversion-service</span>=<span class="string">&quot;formatService&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;formatService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.format.support.FormattingConversionServiceFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;converters&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 自己编写的类型转换器,可以有多个 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.web.converter.StringToDateConverter&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>





<h3 id="2-2-返回数据"><a href="#2-2-返回数据" class="headerlink" title="2.2 返回数据"></a>2.2 返回数据</h3><p>1、给ajax请求返回单值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@RequestMapping(value=&quot;test1&quot;,consumes=&quot;application/json&quot;,produces=&quot;application/json&quot; ,method=RequestMethod.POST)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">test1</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;user = &quot;</span>+user);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<p>2、给ajax请求返回数组（json格式）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@RequestMapping(value=&quot;test2&quot;,consumes=&quot;application/json&quot;,produces=&quot;application/json&quot; ,method=RequestMethod.POST)</span></span><br><span class="line"><span class="keyword">public</span> String[] test2(<span class="meta">@RequestBody</span> User user)&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;user = &quot;</span>+user);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> String[]&#123;<span class="string">&quot;hello&quot;</span>,<span class="string">&quot;world&quot;</span>,<span class="string">&quot;tom&quot;</span>&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>3、给ajax请求返回自定义类型的数组（json格式）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@RequestMapping(value=&quot;test3&quot;,consumes=&quot;application/json&quot;,produces=&quot;application/json&quot; ,method=RequestMethod.POST)</span></span><br><span class="line"><span class="keyword">public</span> User[] test3(<span class="meta">@RequestBody</span> User user)&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;user = &quot;</span>+user);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> User[]&#123;<span class="keyword">new</span> User(<span class="number">1L</span>,<span class="string">&quot;tom1&quot;</span>),<span class="keyword">new</span> User(<span class="number">2L</span>,<span class="string">&quot;tom2&quot;</span>),<span class="keyword">new</span> User(<span class="number">3L</span>,<span class="string">&quot;tom3&quot;</span>)&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<p>4、给ajax请求返回List集合（json格式）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@RequestMapping(value=&quot;test4&quot;,consumes=&quot;application/json&quot;,produces=&quot;application/json&quot; ,method=RequestMethod.POST)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">test4</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;user = &quot;</span>+user);</span><br><span class="line">    <span class="keyword">return</span> Arrays.asList(<span class="keyword">new</span> User(<span class="number">1L</span>,<span class="string">&quot;tom1&quot;</span>),<span class="keyword">new</span> User(<span class="number">2L</span>,<span class="string">&quot;tom2&quot;</span>),<span class="keyword">new</span> User(<span class="number">3L</span>,<span class="string">&quot;tom3&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<p>5、给ajax请求返回Set集合（json格式）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@RequestMapping(value=&quot;test5&quot;,consumes=&quot;application/json&quot;,produces=&quot;application/json&quot; ,method=RequestMethod.POST)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Set&lt;User&gt; <span class="title">test5</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;user = &quot;</span>+user);</span><br><span class="line">    Set&lt;User&gt; set = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">    set.add(<span class="keyword">new</span> User(<span class="number">1L</span>,<span class="string">&quot;tom1&quot;</span>));</span><br><span class="line">    set.add(<span class="keyword">new</span> User(<span class="number">2L</span>,<span class="string">&quot;tom2&quot;</span>));</span><br><span class="line">    set.add(<span class="keyword">new</span> User(<span class="number">3L</span>,<span class="string">&quot;tom3&quot;</span>));</span><br><span class="line">    <span class="keyword">return</span> set;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<p>6、给ajax请求返回Map集合（json格式）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@RequestMapping(value=&quot;test6&quot;,consumes=&quot;application/json&quot;,produces=&quot;application/json&quot; ,method=RequestMethod.POST)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Map&lt;String,User&gt; <span class="title">test6</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;user = &quot;</span>+user);</span><br><span class="line">    Map&lt;String,User&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    map.put(<span class="string">&quot;tom1&quot;</span>, <span class="keyword">new</span> User(<span class="number">1L</span>,<span class="string">&quot;tom1&quot;</span>));</span><br><span class="line">    map.put(<span class="string">&quot;tom2&quot;</span>, <span class="keyword">new</span> User(<span class="number">2L</span>,<span class="string">&quot;tom2&quot;</span>));</span><br><span class="line">    map.put(<span class="string">&quot;tom3&quot;</span>, <span class="keyword">new</span> User(<span class="number">3L</span>,<span class="string">&quot;tom3&quot;</span>));</span><br><span class="line">    <span class="keyword">return</span> map;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="3-页面跳转"><a href="#3-页面跳转" class="headerlink" title="3 页面跳转"></a>3 页面跳转</h2><h3 id="3-1-servlet"><a href="#3-1-servlet" class="headerlink" title="3.1 servlet"></a>3.1 servlet</h3><blockquote>
<p>因为在Controller中的功能处理方法上可以获得到request和response,所以可以像之前<strong>servlet</strong>中一样,进行<strong>服务器内部跳转</strong>和<strong>客户端重定向</strong></p>
</blockquote>
<p>例如，testA方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/forward-redirect&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ForwardAndRedirectController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/a&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">testA</span><span class="params">(HttpServletRequest request,HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException</span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;testA&quot;</span>);</span><br><span class="line">		<span class="comment">//服务器内部跳转到一个页面</span></span><br><span class="line">		<span class="comment">//request.getRequestDispatcher(&quot;/WEB-INF/jsp/hello.jsp&quot;).forward(request, response);</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">//服务器内部跳转到一个功能处理方法</span></span><br><span class="line">		<span class="comment">//request.getRequestDispatcher(&quot;/forward-redirect/test&quot;).forward(request, response);</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">//客户端重定向到另一个功能处理方法</span></span><br><span class="line">		response.sendRedirect(<span class="string">&quot;/forward-redirect/test&quot;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	&#125;	</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="3-2-字符串"><a href="#3-2-字符串" class="headerlink" title="3.2 字符串"></a>3.2 字符串</h3><blockquote>
<p>Controller中可以使用<strong>字符串</strong>表示服务器内部跳转和客户端重定向</p>
</blockquote>
<p>例如，testB方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/forward-redirect&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ForwardAndRedirectController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/a&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">testA</span><span class="params">(HttpServletRequest request,HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException</span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;testA&quot;</span>);</span><br><span class="line">		<span class="comment">//服务器内部跳转到一个页面</span></span><br><span class="line">		<span class="comment">//request.getRequestDispatcher(&quot;/WEB-INF/jsp/hello.jsp&quot;).forward(request, response);</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">//服务器内部跳转到一个功能处理方法</span></span><br><span class="line">		<span class="comment">//request.getRequestDispatcher(&quot;/forward-redirect/test&quot;).forward(request, response);</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">//客户端重定向到另一个功能处理方法</span></span><br><span class="line">		response.sendRedirect(<span class="string">&quot;/forward-redirect/test&quot;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/b&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">testB</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;testB&quot;</span>);</span><br><span class="line">		<span class="comment">//服务器内部跳转到另一个功能处理方法</span></span><br><span class="line">		<span class="comment">//return &quot;forward:/forward-redirect/test&quot;;</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">//客户端重定向到另一个功能处理方法</span></span><br><span class="line">		<span class="comment">//return &quot;redirect:/forward-redirect/test&quot;;</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">//服务器内部跳转到一个页面</span></span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h3 id="3-3-ModelAndView"><a href="#3-3-ModelAndView" class="headerlink" title="3.3 ModelAndView"></a>3.3 ModelAndView</h3><blockquote>
<p>Controller中使用<strong>ModelAndView</strong>进行跳转和重定向</p>
</blockquote>
<p>例如，testC方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/forward-redirect&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ForwardAndRedirectController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/a&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">testA</span><span class="params">(HttpServletRequest request,HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException</span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;testA&quot;</span>);</span><br><span class="line">		<span class="comment">//服务器内部跳转到一个页面</span></span><br><span class="line">		<span class="comment">//request.getRequestDispatcher(&quot;/WEB-INF/jsp/hello.jsp&quot;).forward(request, response);</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">//服务器内部跳转到一个功能处理方法</span></span><br><span class="line">		<span class="comment">//request.getRequestDispatcher(&quot;/forward-redirect/test&quot;).forward(request, response);</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">//客户端重定向到另一个功能处理方法</span></span><br><span class="line">		response.sendRedirect(<span class="string">&quot;/forward-redirect/test&quot;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/b&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">testB</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;testB&quot;</span>);</span><br><span class="line">		<span class="comment">//服务器内部跳转到另一个功能处理方法</span></span><br><span class="line">		<span class="comment">//return &quot;forward:/forward-redirect/test&quot;;</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">//客户端重定向到另一个功能处理方法</span></span><br><span class="line">		<span class="comment">//return &quot;redirect:/forward-redirect/test&quot;;</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">//服务器内部跳转到一个页面</span></span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/c&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ModelAndView <span class="title">testC</span><span class="params">()</span> <span class="keyword">throws</span> ServletException, IOException</span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;testC&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//服务器内部跳转到另一个功能处理方法</span></span><br><span class="line">		<span class="comment">//ModelAndView mv = new ModelAndView(&quot;forward:/forward-redirect/test&quot;);</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">//客户端重定向到另一个功能处理方法</span></span><br><span class="line">		<span class="comment">//ModelAndView mv = new ModelAndView(&quot;redirect:/forward-redirect/test&quot;);</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">//服务器内部跳转到一个页面</span></span><br><span class="line">		ModelAndView mv = <span class="keyword">new</span> ModelAndView(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> mv;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="4-数据验证"><a href="#4-数据验证" class="headerlink" title="4 数据验证"></a>4 数据验证</h2><blockquote>
<p>通常在项目中使用较多的是前端校验，比如页面中js校验。对于安全要求较高的建议在服务端同时校验</p>
</blockquote>
<p>SpringMVC使用hibernate的实现的校验框架validation，所以需要导入相关依赖的jar包，共四个：</p>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201112004503417.png" alt="image-20201112004503417"></p>
<p>例如，</p>
<p>实体类<code>Teacher</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Min;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotNull;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Past;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Size;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.format.annotation.DateTimeFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Teacher</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@NotNull(message = &quot;ID不能为空&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Long id;</span><br><span class="line">	<span class="meta">@Size(min=5,max=8,message = &quot;长度需要在5-8之间&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="meta">@Min(value = 18,message = &quot;年龄必须是18以上&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Integer age;</span><br><span class="line">	<span class="meta">@Past(message = &quot;必须是过去的日期时间&quot;)</span></span><br><span class="line">	<span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Date dob;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Long <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> age;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.age = age;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Date <span class="title">getDob</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> dob;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDob</span><span class="params">(Date dob)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.dob = dob;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，@DateTimeFormat(pattern = “yyyy-MM-dd”)是为了接收参数时候的日期字符串格式的设置</p>
</blockquote>
<p>测试<code>Controller</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.validation.Valid;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.validation.BindingResult;</span><br><span class="line"><span class="keyword">import</span> org.springframework.validation.ObjectError;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.web.bean.Teacher;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/valid&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ValidController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(value=&quot;/test&quot;,method = &#123;RequestMethod.GET,RequestMethod.POST&#125;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">addTeacher</span><span class="params">(<span class="meta">@Valid</span> Teacher teacher,BindingResult bindingResult)</span></span>&#123;</span><br><span class="line">		<span class="comment">//如果验证数据中有错误信息,将保存在bindingResult对象中</span></span><br><span class="line">		<span class="keyword">if</span>(bindingResult.hasErrors())&#123;</span><br><span class="line">			List&lt;ObjectError&gt; errorList = bindingResult.getAllErrors();             </span><br><span class="line">			<span class="keyword">for</span>(ObjectError error : errorList)&#123;                 </span><br><span class="line">				System.out.println(error.getDefaultMessage());             </span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，方法参数teacher前面加了注解@Valid，表示要做数据验证</p>
</blockquote>
<blockquote>
<p>注意，方法参数bindingResult表示验证的结果如果有错误信息，会存入该对象中</p>
</blockquote>
<p>访问地址：<a target="_blank" rel="noopener" href="http://127.0.0.1:8989/valid/test?name=tom&amp;age=10&amp;dob=2999-11-11">http://127.0.0.1:8989/valid/test?name=tom&amp;age=10&amp;dob=2999-11-11</a></p>
<p>控制台输入结果：</p>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201112005908139.png" alt="image-20201112005908139"></p>
<p><strong>常用的验证注解有：</strong>  <code>javax.validation.constraints.*</code></p>
<table>
<thead>
<tr>
<th>注解</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>@Null</td>
<td>值只能为null</td>
</tr>
<tr>
<td>@NotNull</td>
<td>值不能为null</td>
</tr>
<tr>
<td>@NotEmpty</td>
<td>值不为null且不为空</td>
</tr>
<tr>
<td>@NotBlank</td>
<td>值不为null且不为空(先去除首尾空格)</td>
</tr>
<tr>
<td>@Pattern</td>
<td>正则表达式验证</td>
</tr>
<tr>
<td>@Size</td>
<td>限制长度在x和y之间</td>
</tr>
<tr>
<td>@Max</td>
<td>最大值</td>
</tr>
<tr>
<td>@Min</td>
<td>最小值</td>
</tr>
<tr>
<td>@Future</td>
<td>必须是一个将来的日期(和现在比)</td>
</tr>
<tr>
<td>@Past</td>
<td>必须是一个过去的日期(和现在比)</td>
</tr>
<tr>
<td>@Email</td>
<td>校验email格式</td>
</tr>
</tbody></table>
<p><strong>同时，也可以配合页面来完成数据验证</strong></p>
<p>例如，在上个例子上进行修改即可</p>
<p>新增页面valid.jsp</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> contentType=<span class="string">&quot;text/html; charset=UTF-8&quot;</span></span><br><span class="line">    pageEncoding=<span class="string">&quot;UTF-8&quot;</span>%&gt;</span><br><span class="line">&lt;%<span class="meta">@taglib</span> prefix=<span class="string">&quot;sf&quot;</span> uri=<span class="string">&quot;http://www.springframework.org/tags/form&quot;</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span><br><span class="line">&lt;title&gt;valid.jsp&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;sf:form method=<span class="string">&quot;post&quot;</span> modelAttribute=<span class="string">&quot;teacher&quot;</span>&gt;</span><br><span class="line">		&lt;sf:label path=<span class="string">&quot;name&quot;</span>&gt;用户名:&lt;/sf:label&gt; </span><br><span class="line">		&lt;sf:input path=<span class="string">&quot;name&quot;</span>/&gt;</span><br><span class="line">		&lt;sf:errors path=<span class="string">&quot;name&quot;</span> cssStyle=<span class="string">&quot;color:red&quot;</span>&gt;&lt;/sf:errors&gt;&lt;br&gt;</span><br><span class="line"></span><br><span class="line">		&lt;sf:label path=<span class="string">&quot;age&quot;</span>&gt; 年   龄:&lt;/sf:label&gt;</span><br><span class="line">		&lt;sf:input path=<span class="string">&quot;age&quot;</span>/&gt;</span><br><span class="line">		&lt;sf:errors path=<span class="string">&quot;age&quot;</span> cssStyle=<span class="string">&quot;color:red&quot;</span>&gt;&lt;/sf:errors&gt;&lt;br&gt;</span><br><span class="line"></span><br><span class="line">		&lt;sf:label path=<span class="string">&quot;dob&quot;</span>&gt; 生   日:&lt;/sf:label&gt;  </span><br><span class="line">		&lt;sf:input path=<span class="string">&quot;dob&quot;</span>/&gt;</span><br><span class="line">		&lt;sf:errors path=<span class="string">&quot;dob&quot;</span> cssStyle=<span class="string">&quot;color:red&quot;</span>&gt;&lt;/sf:errors&gt;&lt;br&gt;</span><br><span class="line"></span><br><span class="line">		&lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;提交&quot;</span>/&gt;</span><br><span class="line">	&lt;/sf:form&gt;</span><br><span class="line">	</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，数据校验之后,如果有错误信息,那么可以使用spring提供的标签库中的标签在页面中显示校验信息</p>
</blockquote>
<p>修改Controller代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.validation.Valid;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.validation.BindingResult;</span><br><span class="line"><span class="keyword">import</span> org.springframework.validation.ObjectError;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.web.bean.Teacher;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/valid&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ValidController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//支持GET请求，模型中添加teacher对象，并返回valid视图页面</span></span><br><span class="line">	<span class="meta">@RequestMapping(value=&quot;/test&quot;, method = &#123;RequestMethod.GET&#125;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">showAddPage</span><span class="params">(Model model)</span></span>&#123;</span><br><span class="line">        <span class="comment">//保证返回到valid页面的时候，模型中有teacher对象</span></span><br><span class="line">		<span class="keyword">if</span>(!model.containsAttribute(<span class="string">&quot;teacher&quot;</span>))&#123;</span><br><span class="line">			model.addAttribute(<span class="string">&quot;teacher&quot;</span>, <span class="keyword">new</span> Teacher());</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;valid&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//支持POST请求，接收表单数据，做数据验证</span></span><br><span class="line">    <span class="comment">//有错误信息，就返回valid视图，显示错误信息</span></span><br><span class="line">    <span class="comment">//没有错误信息，就返回hello视图</span></span><br><span class="line">	<span class="meta">@RequestMapping(value=&quot;/test&quot;,method = &#123;RequestMethod.POST&#125;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">addTeacher</span><span class="params">(<span class="meta">@Valid</span> Teacher teacher,BindingResult bindingResult)</span></span>&#123;</span><br><span class="line">		<span class="comment">//如果验证数据中有错误信息,将保存在bindingResult对象中</span></span><br><span class="line">		<span class="keyword">if</span>(bindingResult.hasErrors())&#123;</span><br><span class="line">			List&lt;ObjectError&gt; errorList = bindingResult.getAllErrors();             </span><br><span class="line">			<span class="keyword">for</span>(ObjectError error : errorList)&#123;                 </span><br><span class="line">				System.out.println(error.getDefaultMessage());             </span><br><span class="line">			&#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;valid&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>注意事项：</p>
<ul>
<li>访问Controller跳转到valid页面的时候，需要向模型中添加一个名字叫teacher的对象，否则会报错</li>
<li>表单中没有写action属性值，那么默认把数据提交给当前地址，但是提交方式是post</li>
<li>页面中input标签中的path属性的值对应的是表单对象中的属性</li>
<li>Controller中，GET方式访问/valid/test地址，是显示页面，POST方式访问/valid/test地址，是提交表单</li>
<li>Controller中，在需要验证的参数前面加入@Valid注解</li>
<li>方法参数列表中，加入BindingResult对象，用来接收验证的错误信息，并根据这个进行不同情况的跳转</li>
<li>在被验证的表单对象所属类中，给需要验证的属性上加入指定注解</li>
</ul>
<p>访问地址：<a target="_blank" rel="noopener" href="http://127.0.0.1:8989/valid/test">http://127.0.0.1:8989/valid/test</a></p>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201112012342408.png" alt="image-20201112012342408"></p>
<p>填写内容，提交表单：</p>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201112012409944.png" alt="image-20201112012409944"></p>
<h1 id="springmvc-四"><a href="#springmvc-四" class="headerlink" title="springmvc(四)"></a>springmvc(四)</h1><h2 id="1-异常处理"><a href="#1-异常处理" class="headerlink" title="1 异常处理"></a>1 异常处理</h2><blockquote>
<p>在SpringMVC中可以把异常统一进行处理，可以xml配置，也可以注解配置</p>
</blockquote>
<h3 id="1-1-xml"><a href="#1-1-xml" class="headerlink" title="1.1 xml"></a>1.1 xml</h3><p><strong>1、默认的异常解析器</strong></p>
<p>只要在xml配置文件中，添加一个异常解析器即可，并且指定一般异常需要跳转的视图，以及特定的异常需要跳转的视图。</p>
<p>例如，在jsp目录下新建一个error目录,然后放入专门显示错误的页面，然后添加以下配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.handler.SimpleMappingExceptionResolver&quot;</span>&gt;</span> </span><br><span class="line">    <span class="comment">&lt;!-- 定义默认的异常处理页面 --&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!-- value=&quot;error/error&quot; 表示error/目录下的逻辑视图，名字为error --&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;defaultErrorView&quot;</span> <span class="attr">value</span>=<span class="string">&quot;error/error&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span>  </span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 定义异常处理页面用来获取异常信息的变量名，默认名为exception --&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;exceptionAttribute&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ex&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span>  </span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 定义需要特殊处理的异常，用简单类名或全限定名作为key，异常页名的逻辑视图名作为value --&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;exceptionMappings&quot;</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">props</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;IOException&quot;</span>&gt;</span>error/error_io<span class="tag">&lt;/<span class="name">prop</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;java.sql.SQLException&quot;</span>&gt;</span>error/error_sql<span class="tag">&lt;/<span class="name">prop</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">props</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>jsp页面中，显示异常信息</p>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201112093635009.png" alt="image-20201112093635009"></p>
<ul>
<li>如果使用jsp的脚本显示信息</li>
</ul>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 因为spring中修改了异常的默认名字,所以这里是ex --&gt;</span><br><span class="line">&lt;% Exception ex = (Exception)request.getAttribute(<span class="string">&quot;ex&quot;</span>); %&gt; </span><br><span class="line">&lt;H2&gt;Exception: &lt;%= ex.getMessage()%&gt;&lt;/H2&gt; </span><br><span class="line">&lt;P/&gt; </span><br><span class="line">&lt;% ex.printStackTrace(<span class="keyword">new</span> java.io.PrintWriter(out)); %&gt; </span><br></pre></td></tr></table></figure>

<ul>
<li>如果是EL显示错误信息</li>
</ul>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;$&#123;ex &#125;&lt;/div&gt;</span><br><span class="line">&lt;div&gt;$&#123;ex.message &#125;&lt;/div&gt;</span><br></pre></td></tr></table></figure>



<p>Controller：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/error&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ErrorController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">		Random random = <span class="keyword">new</span> Random();</span><br><span class="line">		<span class="keyword">int</span> num = random.nextInt(<span class="number">10</span>);</span><br><span class="line">		<span class="keyword">if</span>(num%<span class="number">2</span>==<span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;Runtime异常测试&quot;</span>);</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> IOException(<span class="string">&quot;IO异常测试&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，每次访问可能抛出不同的错误信息</p>
</blockquote>
<p>访问地址：<a target="_blank" rel="noopener" href="http://127.0.0.1:8989/error/test">http://127.0.0.1:8989/error/test</a></p>
<p>页面结果：</p>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201112093756263.png" alt="image-20201112093756263"></p>
<p><strong>2、自定义的异常解析器</strong></p>
<p>实现接口<code>HandlerExceptionResolver</code>，实现类中指定不同的异常跳转不同的错误页面</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.resolver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerExceptionResolver;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyExceptionResolver</span> <span class="keyword">implements</span> <span class="title">HandlerExceptionResolver</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ModelAndView <span class="title">resolveException</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler,</span></span></span><br><span class="line"><span class="params"><span class="function">			Exception ex)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		Map&lt;String,Object&gt; model = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">		model.put(<span class="string">&quot;ex&quot;</span>, ex);</span><br><span class="line">		</span><br><span class="line">		String viewName = <span class="string">&quot;error/error&quot;</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>(ex <span class="keyword">instanceof</span> IOException) &#123;</span><br><span class="line">			viewName = <span class="string">&quot;error/error_io&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(ex <span class="keyword">instanceof</span> SQLException) &#123;</span><br><span class="line">			viewName = <span class="string">&quot;error/error_sql&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(viewName, model);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>在xml中配置自定义的异常解析器：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;</span>&gt;</span></span><br><span class="line">   	</span><br><span class="line">   	<span class="comment">&lt;!-- 指定spring扫描的包路径 --&gt;</span></span><br><span class="line">   	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.briup.web.annotation&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 开启springmvc的注解功能 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置视图解析器--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span>  </span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;viewClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;org.springframework.web.servlet.view.JstlView&quot;</span>/&gt;</span>  </span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/jsp/&quot;</span>/&gt;</span>  </span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>/&gt;</span>  </span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span> </span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置静态资源不被拦截 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置自定义异常解析器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.briup.web.resolver.MyExceptionResolver&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，将自定义的异常解析器，配置到spring容器中即可</p>
</blockquote>
<h3 id="1-2-注解"><a href="#1-2-注解" class="headerlink" title="1.2 注解"></a>1.2 注解</h3><p><strong>1、@ExceptionHandler</strong></p>
<p>使用@ExceptionHandler注解作用在方法上面，参数是具体的异常类型。一旦系统抛出这种类型的异常时，会引导到该方法来处理</p>
<p>例如，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/error&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ErrorController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">		Random random = <span class="keyword">new</span> Random();</span><br><span class="line">		<span class="keyword">int</span> num = random.nextInt(<span class="number">10</span>);</span><br><span class="line">		<span class="keyword">if</span>(num%<span class="number">2</span>==<span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;Runtime异常测试&quot;</span>);</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> IOException(<span class="string">&quot;IO异常测试&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//指定需要的处理的异常类型</span></span><br><span class="line">	<span class="meta">@ExceptionHandler(&#123;Exception.class&#125;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">ex</span><span class="params">(Exception ex,Model model)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		model.addAttribute(<span class="string">&quot;ex&quot;</span>, ex);</span><br><span class="line">		</span><br><span class="line">		String viewName = <span class="string">&quot;error/error&quot;</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>(ex <span class="keyword">instanceof</span> IOException) &#123;</span><br><span class="line">			viewName = <span class="string">&quot;error/error_io&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(ex <span class="keyword">instanceof</span> SQLException) &#123;</span><br><span class="line">			viewName = <span class="string">&quot;error/error_sql&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> viewName;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，处理异常的方法 和 抛出异常的方法 必须 在同一个controller中</p>
</blockquote>
<blockquote>
<p>注意，此外就不需要其他配置了</p>
</blockquote>
<p><strong>2、@ControllerAdvice + @ExceptionHandler</strong></p>
<p>使用@ControllerAdvice 和@ExceptionHandler 可以全局控制异常，异常处理方法 和 抛出异常方法可以分开</p>
<p>例如，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/error&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ErrorController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">		Random random = <span class="keyword">new</span> Random();</span><br><span class="line">		<span class="keyword">int</span> num = random.nextInt(<span class="number">10</span>);</span><br><span class="line">		<span class="keyword">if</span>(num%<span class="number">2</span>==<span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;Runtime异常测试&quot;</span>);</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> IOException(<span class="string">&quot;IO异常测试&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这里删除了异常处理代码</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.resolver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ControllerAdvice;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalExceptionHandler</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ExceptionHandler(&#123;Exception.class&#125;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">ex</span><span class="params">(Exception ex,Model model)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		model.addAttribute(<span class="string">&quot;ex&quot;</span>, ex);</span><br><span class="line">		</span><br><span class="line">		String viewName = <span class="string">&quot;error/error&quot;</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>(ex <span class="keyword">instanceof</span> IOException) &#123;</span><br><span class="line">			viewName = <span class="string">&quot;error/error_io&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(ex <span class="keyword">instanceof</span> SQLException) &#123;</span><br><span class="line">			viewName = <span class="string">&quot;error/error_sql&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> viewName;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，此时全局的异常处理器可以单独编写，和其他Controller分开</p>
</blockquote>
<p>修改xml配置，添加一个新的spring扫描路径，因为这里使用注解配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;</span>&gt;</span></span><br><span class="line">   	</span><br><span class="line">   	<span class="comment">&lt;!-- 指定spring扫描的包路径 --&gt;</span></span><br><span class="line">   	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.briup.web.annotation,com.briup.web.resolver&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 开启springmvc的注解功能 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置视图解析器--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span>  </span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;viewClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;org.springframework.web.servlet.view.JstlView&quot;</span>/&gt;</span>  </span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/jsp/&quot;</span>/&gt;</span>  </span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>/&gt;</span>  </span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span> </span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置静态资源不被拦截 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，<code>&lt;context:component-scan&gt;</code>中配置了俩个包路径，逗号隔开</p>
</blockquote>
<h2 id="2-文件上传"><a href="#2-文件上传" class="headerlink" title="2 文件上传"></a>2 文件上传</h2><p>1、使用上传功能，项目中需要引入俩个jar包：</p>
<ul>
<li>commons-fileupload-1.2.2.jar</li>
<li>commons-io-2.0.1.jar</li>
</ul>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201112120116899.png" alt="image-20201112120116899"></p>
<p>2、上传页面upload_test.jsp</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> contentType=<span class="string">&quot;text/html; charset=UTF-8&quot;</span></span><br><span class="line">    pageEncoding=<span class="string">&quot;UTF-8&quot;</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span><br><span class="line">&lt;title&gt;upload.jsp&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;h1&gt;普通上传&lt;/h1&gt;</span><br><span class="line">	&lt;form action=<span class="string">&quot;/upload/test&quot;</span> method=<span class="string">&quot;post&quot;</span> enctype=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span><br><span class="line">		&lt;input type=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;file&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">		&lt;input type=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;file&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">		&lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;上传&quot;</span>&gt;</span><br><span class="line">	&lt;/form&gt;</span><br><span class="line">	</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，enctype的属性值，一定要设置为<code>&quot;multipart/form-data</code>，这里可以同时上传俩个文件</p>
</blockquote>
<p>3、Controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/upload&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UploadController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">(<span class="meta">@RequestParam(&quot;file&quot;)</span> MultipartFile[] files, HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (files != <span class="keyword">null</span> &amp;&amp; files.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">for</span> (MultipartFile file : files) &#123;</span><br><span class="line">				<span class="comment">// 保存文件</span></span><br><span class="line">				saveFile(request, file);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 重定向到/upload，在xml文件中可以配置/upload路径对应 upload_test 逻辑视图名</span></span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;redirect:/upload&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">saveFile</span><span class="params">(HttpServletRequest request, MultipartFile file)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 判断文件是否为空</span></span><br><span class="line">		<span class="keyword">if</span> (!file.isEmpty()) &#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				<span class="comment">//保存的文件路径</span></span><br><span class="line">				<span class="comment">//需要的话，可以给文件名上加时间戳</span></span><br><span class="line">				String filePath = <span class="string">&quot;D:/briup/upload/&quot;</span>+file.getOriginalFilename();</span><br><span class="line">				</span><br><span class="line">				File newFile = <span class="keyword">new</span> File(filePath);</span><br><span class="line">				</span><br><span class="line">				<span class="comment">//文件所在目录不存在就创建</span></span><br><span class="line">				<span class="keyword">if</span> (!newFile.getParentFile().exists())&#123;</span><br><span class="line">					newFile.getParentFile().mkdirs();</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				<span class="comment">// 转存文件</span></span><br><span class="line">				file.transferTo(newFile);</span><br><span class="line">			&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>4、xml配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;</span>&gt;</span></span><br><span class="line">   	</span><br><span class="line">   	<span class="comment">&lt;!-- 指定spring扫描的包路径 --&gt;</span></span><br><span class="line">   	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.briup.web.annotation,com.briup.web.resolver&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 开启springmvc的注解功能 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置视图解析器--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span>  </span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;viewClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;org.springframework.web.servlet.view.JstlView&quot;</span>/&gt;</span>  </span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/jsp/&quot;</span>/&gt;</span>  </span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>/&gt;</span>  </span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span> </span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置静态资源不被拦截 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- SpringMVC上传文件时，需要配置MultipartResolver处理器 --&gt;</span> </span><br><span class="line">	<span class="comment">&lt;!-- 注意:bean的名字不要改,一定要叫multipartResolver,否则上传报错 --&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;multipartResolver&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;</span>&gt;</span> </span><br><span class="line">	    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;defaultEncoding&quot;</span> <span class="attr">value</span>=<span class="string">&quot;UTF-8&quot;</span>/&gt;</span> </span><br><span class="line">	    <span class="comment">&lt;!-- 指定所上传文件的总大小不能超过指定字节大小 --&gt;</span> </span><br><span class="line">	    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxUploadSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;20000000&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">    <span class="comment">&lt;!-- 配置请求中如果访问/upload路径，那么就直接返回 upload_test 逻辑视图名 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:view-controller</span> <span class="attr">path</span>=<span class="string">&quot;/upload&quot;</span> <span class="attr">view-name</span>=<span class="string">&quot;upload_test&quot;</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这里新增了最后的俩个的配置</p>
</blockquote>
<h2 id="3-ajax上传"><a href="#3-ajax上传" class="headerlink" title="3 ajax上传"></a>3 ajax上传</h2><blockquote>
<p>在页面中，引入ajax上传的插件，也可以使用ajax完成上传功能</p>
</blockquote>
<p>1、xml文件中配置解析器</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;multipartResolver&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;defaultEncoding&quot;</span> <span class="attr">value</span>=<span class="string">&quot;UTF-8&quot;</span>/&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxUploadSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;20000000&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span> </span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这个和之前保持一致，没有变化</p>
</blockquote>
<p>2、页面中引入jquery以及ajax上传的插件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/static/js/jquery-1.8.3.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/static/js/ajaxfileupload.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，引入的js文件的先后顺序</p>
</blockquote>
<p>3、jsp页面代码，upload_test.jsp</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> contentType=<span class="string">&quot;text/html; charset=UTF-8&quot;</span></span><br><span class="line">    pageEncoding=<span class="string">&quot;UTF-8&quot;</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span><br><span class="line">&lt;title&gt;upload.jsp&lt;/title&gt;</span><br><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span> src=<span class="string">&quot;/static/js/jquery-1.8.3.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span> src=<span class="string">&quot;/static/js/ajaxfileupload.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">	</span><br><span class="line">	$(function()&#123;</span><br><span class="line">		$(<span class="string">&quot;input:button&quot;</span>).on(<span class="string">&quot;click&quot;</span>,function()&#123;</span><br><span class="line">			<span class="keyword">if</span>(!$(<span class="string">&quot;#myfile&quot;</span>).val())&#123;</span><br><span class="line">				alert(<span class="string">&quot;请选择上传文件&quot;</span>);</span><br><span class="line">				<span class="keyword">return</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			ajaxFileUpload();</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;);</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="function">function <span class="title">ajaxFileUpload</span><span class="params">()</span></span>&#123;</span><br><span class="line">		$.ajaxFileUpload(</span><br><span class="line">			&#123;</span><br><span class="line">				url: <span class="string">&#x27;/upload/ajax&#x27;</span>,</span><br><span class="line">				fileElementId: <span class="string">&#x27;myfile&#x27;</span>,</span><br><span class="line">				dataType: <span class="string">&#x27;text&#x27;</span>,</span><br><span class="line">				success: function (data)&#123;</span><br><span class="line">					$(<span class="string">&quot;input:file&quot;</span>).val(<span class="string">&quot;&quot;</span>);</span><br><span class="line">					$(<span class="string">&quot;#sp&quot;</span>).html(data).css(<span class="string">&quot;color&quot;</span>,<span class="string">&quot;green&quot;</span>);</span><br><span class="line">				&#125;,</span><br><span class="line">				error: function (data)&#123;</span><br><span class="line">					$(<span class="string">&quot;#sp&quot;</span>).html(data).css(<span class="string">&quot;color&quot;</span>,<span class="string">&quot;red&quot;</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;h1&gt;普通上传&lt;/h1&gt;</span><br><span class="line">	&lt;form action=<span class="string">&quot;/upload/test&quot;</span> method=<span class="string">&quot;post&quot;</span> enctype=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span><br><span class="line">		&lt;input type=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;file&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">		&lt;input type=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;file&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">		&lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;上传&quot;</span>&gt;</span><br><span class="line">	&lt;/form&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;h1&gt;ajax上传&lt;/h1&gt;</span><br><span class="line">	&lt;!-- ajax上传不需要表单 --&gt;</span><br><span class="line">	&lt;!-- 这个上传框的id值一定要写,需要和js中的设置对应 --&gt;</span><br><span class="line">	&lt;input id=<span class="string">&quot;myfile&quot;</span> type=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;myfile&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">	&lt;input type=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;上传&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">	&lt;span id=<span class="string">&quot;sp&quot;</span>&gt;&lt;/span&gt;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>



<p>4、UploadController.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/upload&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UploadController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">(<span class="meta">@RequestParam(&quot;file&quot;)</span> MultipartFile[] files, HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (files != <span class="keyword">null</span> &amp;&amp; files.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">for</span> (MultipartFile file : files) &#123;</span><br><span class="line">				<span class="comment">// 保存文件</span></span><br><span class="line">				saveFile(request, file);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 重定向</span></span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;redirect:/upload&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/ajax&quot;)</span></span><br><span class="line">	<span class="meta">@ResponseBody</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">ajax</span><span class="params">(<span class="meta">@RequestParam(value=&quot;myfile&quot;,required=false)</span> MultipartFile[] files, HttpServletRequest request)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (files != <span class="keyword">null</span> &amp;&amp; files.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">for</span> (MultipartFile file : files) &#123;</span><br><span class="line">				saveFile(request, file);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;上传成功&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">saveFile</span><span class="params">(HttpServletRequest request, MultipartFile file)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 判断文件是否为空</span></span><br><span class="line">		<span class="keyword">if</span> (!file.isEmpty()) &#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				<span class="comment">//保存的文件路径</span></span><br><span class="line">				<span class="comment">//需要的话可以给文件名上加时间戳</span></span><br><span class="line">				String filePath = <span class="string">&quot;D:/briup/upload/&quot;</span>+file.getOriginalFilename();</span><br><span class="line">				</span><br><span class="line">				File newFile = <span class="keyword">new</span> File(filePath);</span><br><span class="line">				</span><br><span class="line">				<span class="comment">//文件所在目录不存在就创建</span></span><br><span class="line">				<span class="keyword">if</span> (!newFile.getParentFile().exists())&#123;</span><br><span class="line">					newFile.getParentFile().mkdirs();</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				<span class="comment">// 转存文件</span></span><br><span class="line">				file.transferTo(newFile);</span><br><span class="line">			&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这里比之前多了一个名为ajax()的功能处理方法</p>
</blockquote>
<p>5、测试</p>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201113095656779.png" alt="image-20201113095656779"></p>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201113095713304.png" alt="image-20201113095713304"></p>
<blockquote>
<p>可以看出，上传成功后，返回的字符串”上传成功”，在页面中显示的乱码</p>
</blockquote>
<p>6、乱码</p>
<p>SpringMVC默认处理的字符集是ISO-8859-1，使用 <code>@ResponseBody</code>注解后，springmvc会用<code>HttpMessageConverter</code> 消息转换机制。</p>
<p><code>HttpMessageConverter</code>接口的作用，就是可以将一个指定类型的数据，转换为HTTP协议的消息。</p>
<p>例如，</p>
<ul>
<li>将一个字符串，封装为HTTP协议的响应（<code>StringHttpMessageConverter</code>）</li>
<li>将一个对象转换为json字符串，再封装为HTTP协议的响应（<code>MappingJackson2HttpMessageConverter</code>）</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/ajax&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">ajax</span><span class="params">(<span class="meta">@RequestParam(value=&quot;myfile&quot;,required=false)</span> MultipartFile[] files, HttpServletRequest request)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (files != <span class="keyword">null</span> &amp;&amp; files.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (MultipartFile file : files) &#123;</span><br><span class="line">            saveFile(request, file);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;上传成功&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，这里使用<code>@ResponseBody</code>注解，并返回了字符串类型数据</p>
</blockquote>
<p>支持 <code>String</code> 类型的消息转换器有 <code>StringHttpMessageConverter</code>，它默认的字符编码为ISO-8859-1</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringHttpMessageConverter</span> <span class="keyword">extends</span> <span class="title">AbstractHttpMessageConverter</span>&lt;<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Charset DEFAULT_CHARSET = StandardCharsets.ISO_8859_1;</span><br><span class="line"> 	<span class="comment">//....   </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201113101404037.png" alt="image-20201113101404037"></p>
<blockquote>
<p>注意，发生乱码的时候，其响应头信息中的Context-Type属性的值</p>
</blockquote>
<p>7、解决</p>
<p>解决这个问题，可以在配置文件中，配置<code>StringHttpMessageConverter</code>，在该消息转换器中注入媒体类型，并指定编码即可</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 开启springmvc的注解功能 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置消息转换器，指定返回的字符编码 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:message-converters</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.http.converter.StringHttpMessageConverter&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;supportedMediaTypes&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">value</span>&gt;</span>text/plain;charset=utf-8<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">value</span>&gt;</span>text/html;charset=utf-8<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:message-converters</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201113101757736.png" alt="image-20201113101757736"></p>
<h2 id="4-文件下载"><a href="#4-文件下载" class="headerlink" title="4 文件下载"></a>4 文件下载</h2><p>SpringMVC的下载功能，只需要自己设置response信息中的各个部分就可以，可以使用之前学习过的<code>ResponseEntity&lt;T&gt;</code>来完成</p>
<p>1、jsp页面，/WEB-INF/jsp/download_test.jsp</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> contentType=<span class="string">&quot;text/html; charset=UTF-8&quot;</span></span><br><span class="line">    pageEncoding=<span class="string">&quot;UTF-8&quot;</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span><br><span class="line">&lt;title&gt;download.jsp&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;a href=<span class="string">&quot;/download/test?fileName=测试.txt&quot;</span>&gt;点击下载&lt;/a&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>



<p>2、xml配置，新增路径/download和逻辑视图名字download_test 的对应关系</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:view-controller</span> <span class="attr">path</span>=<span class="string">&quot;/download&quot;</span> <span class="attr">view-name</span>=<span class="string">&quot;download_test&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>



<p>3、DownloadController.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.FileUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpHeaders;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.MediaType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.ResponseEntity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/download&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DownloadController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> ResponseEntity&lt;<span class="keyword">byte</span>[]&gt; test(String fileName,HttpServletRequest request) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">		<span class="comment">//指定下载文件所在路径 可以指向系统中的任意一个有权访问的路径</span></span><br><span class="line">		<span class="comment">//这里可以设置从之前的上传目录中下载</span></span><br><span class="line">		String downLoadPath = <span class="string">&quot;D:/briup/upload/&quot;</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//创建要下载的文件对象</span></span><br><span class="line">		File file = <span class="keyword">new</span> File(downLoadPath,fileName);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//处理一下要下载的文件名字,解决中文乱码</span></span><br><span class="line">		String downFileName = <span class="keyword">new</span> String(fileName.getBytes(<span class="string">&quot;UTF-8&quot;</span>), <span class="string">&quot;iso-8859-1&quot;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//创建响应头信息的对象</span></span><br><span class="line">		HttpHeaders headers = <span class="keyword">new</span> HttpHeaders();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//设置下载的响应头信息,通知浏览器，响应正文的内容是要下载的,不用浏览器解析</span></span><br><span class="line">		headers.setContentType(MediaType.APPLICATION_OCTET_STREAM);</span><br><span class="line">		<span class="comment">//设置下载的文件显示的名字</span></span><br><span class="line">		headers.setContentDispositionFormData(<span class="string">&quot;attachment&quot;</span>, downFileName);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//通过响应内容、响应头信息、响应状态来构建一个响应对象并返回</span></span><br><span class="line">		<span class="comment">//org.apache.commons.io.FileUtils</span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;<span class="keyword">byte</span>[]&gt;(FileUtils.readFileToByteArray(file), headers, HttpStatus.CREATED);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，因为下载的文件名字，在响应头中，所以这里要专门设置一下编码，以免中文乱码</p>
</blockquote>
<h2 id="5-SSM整合"><a href="#5-SSM整合" class="headerlink" title="5 SSM整合"></a>5 SSM整合</h2><blockquote>
<p>可以参考之前servlet+spring+myabits的整合部分，这里只是把servlet换成了springmvc</p>
</blockquote>
<p>1、建表语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> teacher;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> teacher(</span><br><span class="line">	id number <span class="keyword">primary</span> key,</span><br><span class="line">	name varchar2(<span class="number">22</span>),</span><br><span class="line">    age number,</span><br><span class="line">    salary number</span><br><span class="line">);</span><br></pre></td></tr></table></figure>





<p>2、新建项目，导入jar</p>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201113114352425.png" alt="image-20201113114352425"></p>
<blockquote>
<p>注意，这里的每一个jar，之前都是用过的</p>
</blockquote>
<p>3、引入jquery文件，方便发送ajax请求</p>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201113114447506.png" alt="image-20201113114447506"></p>
<p>4、实体类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Teacher</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Integer id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> Integer age;</span><br><span class="line">	<span class="keyword">private</span> Double salary;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> age;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.age = age;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Double <span class="title">getSalary</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> salary;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSalary</span><span class="params">(Double salary)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.salary = salary;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;Teacher [id=&quot;</span> + id + <span class="string">&quot;, name=&quot;</span> + name + <span class="string">&quot;, age=&quot;</span> + age + <span class="string">&quot;, salary=&quot;</span> + salary + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>5、dao层接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Teacher;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ITeacherDao</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertTeacher</span><span class="params">(Teacher t)</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Teacher <span class="title">selectTeacherById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>6、mybaits映射文件，TeacherMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span> </span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> </span></span><br><span class="line"><span class="meta">   <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.briup.dao.ITeacherDao&quot;</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertTeacher&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Teacher&quot;</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		<span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">order</span>=<span class="string">&quot;BEFORE&quot;</span>&gt;</span></span><br><span class="line">			select my_seq.nextVal from dual</span><br><span class="line">		<span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		insert into teacher(id,name,age,salary)</span><br><span class="line">		values(#&#123;id&#125;,#&#123;name&#125;,#&#123;age&#125;,#&#123;salary&#125;)</span><br><span class="line">		</span><br><span class="line">	<span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectTeacherById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Teacher&quot;</span>&gt;</span></span><br><span class="line">		select id,name,age,salary</span><br><span class="line">		from teacher</span><br><span class="line">		where id = #&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span> </span><br></pre></td></tr></table></figure>



<p>7、service接口和实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Teacher;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ITeacherService</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">save</span><span class="params">(Teacher t)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Teacher;</span><br><span class="line"><span class="keyword">import</span> com.briup.dao.ITeacherDao;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.ITeacherService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TeacherServiceImpl</span> <span class="keyword">implements</span> <span class="title">ITeacherService</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> ITeacherDao teacherDao;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Teacher t)</span> </span>&#123;</span><br><span class="line">		teacherDao.insertTeacher(t);</span><br><span class="line"><span class="comment">//		throw new RuntimeException(&quot;异常测试&quot;);</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>8、Controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.briup.web.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.briup.bean.Teacher;</span><br><span class="line"><span class="keyword">import</span> com.briup.service.ITeacherService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/teacher&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TeacherController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> ITeacherService teacherService;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ResponseBody</span></span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">(<span class="meta">@RequestBody</span> Teacher t)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		String msg = <span class="string">&quot;添加成功！&quot;</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			teacherService.save(t);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			msg = <span class="string">&quot;添加失败！&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> msg;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>9、日志配置文件，log4j.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">log4j.rootLogger</span>=<span class="string">DEBUG, stdout </span></span><br><span class="line"><span class="meta">log4j.appender.stdout</span>=<span class="string">org.apache.log4j.ConsoleAppender </span></span><br><span class="line"><span class="meta">log4j.appender.stdout.layout</span>=<span class="string">org.apache.log4j.PatternLayout </span></span><br><span class="line"><span class="meta">log4j.appender.stdout.layout.ConversionPattern</span>=<span class="string">%d [%-5p] %c - %m%n</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#show sql</span></span><br><span class="line"><span class="meta">log4j.logger.java.sql.ResultSet</span>=<span class="string">INFO  </span></span><br><span class="line"><span class="meta">log4j.logger.org.apache</span>=<span class="string">INFO  </span></span><br><span class="line"><span class="meta">log4j.logger.java.sql.Connection</span>=<span class="string">DEBUG  </span></span><br><span class="line"><span class="meta">log4j.logger.java.sql.Statement</span>=<span class="string">DEBUG  </span></span><br><span class="line"><span class="meta">log4j.logger.java.sql.PreparedStatement</span>=<span class="string">DEBUG</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># set springframework log-level</span></span><br><span class="line"><span class="meta">log4j.logger.org.springframework</span>=<span class="string">WARN</span></span><br><span class="line"><span class="comment"># set mybatis log-level</span></span><br><span class="line"><span class="meta">log4j.logger.org.mybatis</span>=<span class="string">WARN</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>10、资源文件，jdbc.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">jdbc.driverClassName</span>=<span class="string">oracle.jdbc.OracleDriver</span></span><br><span class="line"><span class="meta">jdbc.url</span>=<span class="string">jdbc:oracle:thin:@127.0.0.1:1521:XE</span></span><br><span class="line"><span class="meta">jdbc.username</span>=<span class="string">briup</span></span><br><span class="line"><span class="meta">jdbc.password</span>=<span class="string">briup</span></span><br><span class="line"><span class="meta">jdbc.initialSize</span>=<span class="string">5</span></span><br><span class="line"><span class="meta">jdbc.maxActive</span>=<span class="string">10</span></span><br></pre></td></tr></table></figure>



<p>11、dao层配置文件，spring-dao.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">						 http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">						 http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="string"><span class="tag">						 http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">						 http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        				 http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        				 http://www.springframework.org/schema/tx </span></span></span><br><span class="line"><span class="string"><span class="tag">						 http://www.springframework.org/schema/tx/spring-tx.xsd&quot;</span>&gt;</span></span><br><span class="line">   </span><br><span class="line">   	</span><br><span class="line">   	<span class="comment">&lt;!-- 读取资源文件 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:jdbc.properties&quot;</span>/&gt;</span></span><br><span class="line">   	</span><br><span class="line">   	<span class="comment">&lt;!-- 配置数据源 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">   		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driverClassName&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;initialSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.initialSize&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxActive&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.maxActive&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置sqlSessionFactoryBean到spring容器中 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;typeAliasesPackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.briup.bean&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;mapperLocations&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:com/briup/mapper/*Mapper.xml&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">	<span class="comment">&lt;!-- 让spring扫描映射接口所在包 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;basePackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.briup.dao&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>12、service配置文件，spring-service.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">						 http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">						 http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="string"><span class="tag">						 http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">						 http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        				 http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        				 http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="string"><span class="tag">						 http://www.springframework.org/schema/tx/spring-tx.xsd&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.briup.service&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置事务管理器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 事务通知（拦截器） --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">&quot;txAdvice&quot;</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;*&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRED&quot;</span> <span class="attr">rollback-for</span>=<span class="string">&quot;Exception&quot;</span> <span class="attr">timeout</span>=<span class="string">&quot;5&quot;</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;find*&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;true&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;SUPPORTS&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 事务AOP配置 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* com.briup.service..*.*(..))&quot;</span> <span class="attr">id</span>=<span class="string">&quot;txPointCut&quot;</span>/&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- advisor可以将已经存在的advice和pointcut结合起来 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">&quot;txAdvice&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;txPointCut&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>13、web层配置文件，spring-web-mvc.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 指定spring需要扫描的包路径 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.briup.web.controller&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 开启springmvc的注解功能 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line">	    <span class="comment">&lt;!-- 配置消息转换器，指定返回的字符编码 --&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">mvc:message-converters</span>&gt;</span></span><br><span class="line">	        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.http.converter.StringHttpMessageConverter&quot;</span>&gt;</span></span><br><span class="line">	            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;supportedMediaTypes&quot;</span>&gt;</span></span><br><span class="line">	                <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">	                    <span class="tag">&lt;<span class="name">value</span>&gt;</span>text/plain;charset=utf-8<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	                    <span class="tag">&lt;<span class="name">value</span>&gt;</span>text/html;charset=utf-8<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	                <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">	            <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	        <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;/<span class="name">mvc:message-converters</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 视图解析器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span></span></span><br><span class="line"><span class="tag">		<span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;viewClass&quot;</span></span></span><br><span class="line"><span class="tag">			<span class="attr">value</span>=<span class="string">&quot;org.springframework.web.servlet.view.JstlView&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/jsp/&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 处理静态资源 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span> /&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置指定路径对应的逻辑视图名 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:view-controller</span> <span class="attr">path</span>=<span class="string">&quot;/ajax&quot;</span> <span class="attr">view-name</span>=<span class="string">&quot;ajax&quot;</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>14、dao层和service层的总配置文件，applicationContext.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">						 http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">						 http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="string"><span class="tag">						 http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">						 http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        				 http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        				 http://www.springframework.org/schema/tx </span></span></span><br><span class="line"><span class="string"><span class="tag">						 http://www.springframework.org/schema/tx/spring-tx.xsd&quot;</span>&gt;</span></span><br><span class="line">   </span><br><span class="line">   	</span><br><span class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;spring-dao.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;spring-service.xml&quot;</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>14、web.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">version</span>=<span class="string">&quot;3.1&quot;</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置编码过滤器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>characterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>characterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置springmvc的前端控制器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>SpringMVC<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring-web-mvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>SpringMVC<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置spring监听器，在服务器启动期间就会读取spring的配置文件或配置类，从而创建spring容器对象 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置spring启动时要读取的配置位置 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>15、/WEB-INF/jsp/ajax.jsp</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> contentType=<span class="string">&quot;text/html; charset=UTF-8&quot;</span></span><br><span class="line">    pageEncoding=<span class="string">&quot;UTF-8&quot;</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">&lt;title&gt;hello&lt;/title&gt;</span><br><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span> src=<span class="string">&quot;/static/js/jquery-1.8.3.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">	$(function()&#123;</span><br><span class="line"></span><br><span class="line">		</span><br><span class="line">		$(<span class="string">&quot;#btn&quot;</span>).on(<span class="string">&quot;click&quot;</span>,function()&#123;</span><br><span class="line">			<span class="keyword">var</span> json = &#123;</span><br><span class="line">				name:<span class="string">&quot;tom&quot;</span>,</span><br><span class="line">				age:<span class="number">20</span>,</span><br><span class="line">				salary:<span class="number">2000</span></span><br><span class="line">			&#125;;</span><br><span class="line">			$.ajax(&#123;</span><br><span class="line">				type:<span class="string">&quot;post&quot;</span>,</span><br><span class="line">		        url:<span class="string">&quot;/teacher/test&quot;</span>,</span><br><span class="line">		        contentType:<span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">		        data:JSON.stringify(json),</span><br><span class="line">		        dataType:<span class="string">&quot;text&quot;</span>,</span><br><span class="line">		        success:function(data)&#123;</span><br><span class="line">		            $(<span class="string">&quot;#dd&quot;</span>).html(<span class="string">&quot;&quot;</span>).html(data).hide().show(<span class="number">2000</span>);</span><br><span class="line">		        &#125;</span><br><span class="line">			&#125;);</span><br><span class="line"></span><br><span class="line">		&#125;);</span><br><span class="line"></span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;button id=<span class="string">&quot;btn&quot;</span>&gt;ajax&lt;/button&gt;</span><br><span class="line">	&lt;div id=<span class="string">&quot;dd&quot;</span>&gt;&lt;/div&gt;</span><br><span class="line">	</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>



<p>16、设置项目的ContextPath为/</p>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201113170648469.png" alt="image-20201113170648469"></p>
<p>17、测试</p>
<p>访问地址：<a target="_blank" rel="noopener" href="http://127.0.0.1:8989/ajax">http://127.0.0.1:8989/ajax</a></p>
<p>测试结果：</p>
<p><img src="https://gitee.com/vanse/images/raw/master/bruip_course/image-20201113125617008.png" alt="image-20201113125617008"></p>
<blockquote>
<p>注意，可以在service层，抛出异常，查看事务是否会回滚</p>
</blockquote>
<blockquote>
<p>注意，Controller中的参数上，一定要加注解<code> @RequestBody</code></p>
</blockquote>
<p>18、总结</p>
<p>搭建过程中的注意事项：</p>
<ol>
<li><p>SpringMVC和Spring</p>
<ul>
<li>不需要什么特殊的配置就可以结合</li>
</ul>
</li>
<li><p>MyBatis和Spring</p>
<ul>
<li><p>需要引入额外的jar包:mybatis-spring-1.x.x.jar</p>
</li>
<li><p>配置数据源到spring容器</p>
</li>
<li><p>把MyBatis中的SqlSessionFactory配置给Spring容器</p>
</li>
<li><p>在spring中配置需要扫描的MyBatis映射接口所在包的位置</p>
</li>
</ul>
</li>
<li><p>Spring中配置SqlSessionFactory</p>
<ul>
<li>可以在MyBatis的mybatis-config.xml中把MyBatis的信息配好,然后再让spring读取这个文件</li>
<li>可以删除mybatis-config.xml文件,然后MyBatis的信息都配置到Spring中（<strong>常用</strong>）</li>
</ul>
</li>
<li><p>spring配置文件中的重要信息</p>
<ul>
<li><p>可以写在外部的资源文件中,然后再使用spring的标签读出来使用</p>
<p><code>&lt;context:property-placeholder location=&quot;classpath:jdbc.properties&quot;/&gt;</code></p>
<p><code>$&#123;jdbc.username&#125;</code></p>
</li>
</ul>
</li>
<li><p>事务配置</p>
<ul>
<li>事务管理需要配置在service层方法上</li>
<li>配置事务需要三步<ul>
<li>配置事务管理器（使用jdbc的事务管理器）</li>
<li>配置事务拦截器（使用tx前缀的标签）</li>
<li>spring的aop配置（使用aop前缀的标签）</li>
</ul>
</li>
</ul>
</li>
<li><p>日志配置</p>
<ul>
<li><p>日志中可以屏蔽一些输出</p>
<p><code>log4j.logger.org.springframework = ERROR</code></p>
</li>
</ul>
</li>
<li><p>web.xml文件配置</p>
<ul>
<li>配置编码过滤器</li>
<li>配置spring读取的配置文件</li>
<li>配置前端控制器</li>
</ul>
</li>
</ol>
<p>SpringMVC的前端控制器，读取配置文件，会生成一个容器，Spring的监听器读取配置文件，也会生成一个容器，这俩个容器的关系是：</p>
<ul>
<li>使用xml或者注解进行配置,springMVC或者spring读取配置信息之后,会把配置的对象(就是spring中的bean)放到容器中进行管理</li>
<li>服务器启动的时候,SpirngMVC中的前端控制器会读取配置文件,把相关配置的对象放到自己产生的容器中进行管理(需要在web.xml配置)</li>
<li>服务器启动的时候spring也会读取配置文件,把相关配置的对象放到自己产生的容器中进行管理(需要在web.xml配置)</li>
<li>SpirngMVC创建容器中所管理的Bean一般是只对SpringMVC有效，如Controller、HandlerMapping、HandlerAdapter等等(因为它一般只读取SpringMVC的配置文件)</li>
<li>Spirng创建容器中所管理的Bean一般是对于整个应用程序共享的,一般如DAO层、Service层Bean。(因为它一般只读取service层和dao层的配置文件)</li>
<li>SpirngMVC创建的容器 【继承了】 Spirng创建的容器</li>
<li>子容器可以从父容器中拿出bean来使用,但是父容器不能从子容器中拿bean来使用。所以在Controller中可以注入service层的实现类对象,Controller在SpringMVC创建的容器中,service是在Spring创建的容器中。</li>
</ul>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/briup/" rel="tag">briup</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/" rel="tag">java</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-vanse_spring"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/archives/vanse_spring.html"
    >spring理解</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/archives/vanse_spring.html" class="article-date">
  <time datetime="2021-11-04T06:34:49.000Z" itemprop="datePublished">2021-11-04</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/java/">java</a>
  </div>
   
    </div>
     
	
	 
	
    <div class="article-entry" itemprop="articleBody">
       
  有东西被加密了, 请输入密码查看. 
      <a class="article-more-link" href="/archives/vanse_spring.html"
        >阅读更多...</a
      >
       
	  
	  
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/briup/" rel="tag">briup</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vanse-public/" rel="tag">vanse_public</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-briup_project_environment"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/archives/briup_project_environment.html"
    >environment</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/archives/briup_project_environment.html" class="article-date">
  <time datetime="2021-11-02T16:52:46.000Z" itemprop="datePublished">2021-11-03</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/project/">project</a>
  </div>
   
    </div>
     
	
	 
	
    <div class="article-entry" itemprop="articleBody">
       
  有东西被加密了, 请输入密码查看. 
      <a class="article-more-link" href="/archives/briup_project_environment.html"
        >阅读更多...</a
      >
       
	  
	  
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/briup/" rel="tag">briup</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/corejava/" rel="tag">corejava</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vanse-public/" rel="tag">vanse_public</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
  </article>
  

  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2015-2021
        <i class="ri-heart-fill heart_icon"></i> vanse
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>访问人数:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>浏览次数:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.svg" alt="vanse"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/playlist">音乐</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/photos">相册</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/friends">友链</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="https://gitee.com/vanse/images/raw/master/bruip_course/aliapy.png">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="https://gitee.com/vanse/images/raw/master/bruip_course/wechat.png">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->

<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script>

<script src="/js/clickBoom1.js"></script>
 
<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->
 
<script src="/js/dz.js"></script>
 
<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    <div id="music">
    
    
    
    <iframe frameborder="no" border="1" marginwidth="0" marginheight="0" width="200" height="52"
        src="//music.163.com/outchain/player?type=2&id=506654324&auto=0&height=32"></iframe>
</div>

<style>
    #music {
        position: fixed;
        right: 15px;
        bottom: 0;
        z-index: 998;
    }
</style>
    
    
<script>
  const password = "my world";
  const lock_password = window.sessionStorage.getItem("lock_password");
  console.log(password, lock_password);
  if (lock_password !== password) {
    Swal.fire({
      title: "请输入访问密码",
      input: "password",
      inputAttributes: {
        autocapitalize: "off",
      },
      showCancelButton: false,
      showLoaderOnConfirm: true,
      allowOutsideClick: false,
      confirmButtonText: "确定",
    }).then((result) => {
      console.log(result);
      if (result.isConfirmed) {
        console.log(password);
        if (result.value === password) {
          window.sessionStorage.setItem("lock_password", result.value);
        } else {
          Swal.fire({
            icon: "error",
            title: "密码错误，请重试",
            confirmButtonText: "确定",
            allowOutsideClick: false,
          }).then(() => {
            window.location.reload();
          });
        }
      }
    });
  }
</script>


  </div>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>

</html>